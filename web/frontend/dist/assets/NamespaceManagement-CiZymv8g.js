import{u as Y,G as z}from"./GDataFormModal-Zb0E5fbB.js";import{c as A,a as q,S as W,b as J}from"./SearchForm-Cc24qcuC.js";import{r as w,T as j,X as $,m as K,d as V,b as Q,e as P,w as _,f as n,ci as X,o as Z,a4 as U,_ as ee}from"./index-5VJHBj6L.js";import"./GDialog.vue_vue_type_style_index_0_scoped_82fcf09e_lang-ClbFLA8N.js";/* empty css                                                                    */import{A as ae,T as te}from"./TrashOutline-CbpFzqey.js";import{C as re}from"./CreateOutline-Dqq8N8uj.js";import{W as le}from"./WarningOutline-aI1XYqcD.js";import"./Scrollbar-DXAHdkVV.js";import"./OptionsOutline-TWS2pKTT.js";import"./DatePicker-BwrLRnfw.js";import"./Select-Bh16A4fA.js";import"./InformationCircleOutline-W1lbjTgu.js";import"./Grid-B_eJ5U4P.js";import"./InputNumber-DpwFKpUr.js";import"./Switch-DrDSc06v.js";import"./index-DR_R-bYe.js";import"./RefreshOutline-Ca0tCcaC.js";import"./download-C2161hUv.js";const L=[{label:"业务类型",value:"BUSINESS",description:"用于业务相关的服务分组"},{label:"系统类型",value:"SYSTEM",description:"用于系统基础设施相关的服务分组"},{label:"测试类型",value:"TEST",description:"用于测试环境的服务分组"}],oe=[{label:"HTTP",value:"HTTP",description:"HTTP协议"},{label:"HTTPS",value:"HTTPS",description:"HTTPS协议"},{label:"TCP",value:"TCP",description:"TCP协议"},{label:"UDP",value:"UDP",description:"UDP协议"}],se=[{label:"轮询",value:"ROUND_ROBIN",description:"按顺序轮询所有可用实例"},{label:"加权轮询",value:"WEIGHTED_ROUND_ROBIN",description:"根据权重进行轮询"},{label:"最少连接",value:"LEAST_CONNECTIONS",description:"选择连接数最少的实例"},{label:"随机",value:"RANDOM",description:"随机选择可用实例"},{label:"IP哈希",value:"IP_HASH",description:"根据客户端IP进行哈希选择"}],H=[{label:"启用",value:"Y",description:"启用访问控制，只有授权用户可以访问"},{label:"禁用",value:"N",description:"禁用访问控制，所有用户都可以访问"}],ne=[{label:"活动",value:"Y",description:"命名空间处于活动状态"},{label:"非活动",value:"N",description:"命名空间处于非活动状态"}];function ie(){const l="hub0040",r=w(!1),u=w([]),t=w(),o={fields:[{field:"groupName",label:"名称",type:"input",placeholder:"请输入英文命名空间名称",span:6,clearable:!0},{field:"groupType",label:"类型",type:"select",placeholder:"请选择类型",span:6,clearable:!0,options:[{label:"全部",value:""},...L.map(e=>({label:e.label,value:e.value}))]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},...ne.map(e=>({label:e.label,value:e.value}))]},{field:"accessControlEnabled",label:"访问控制",type:"select",placeholder:"请选择",span:6,clearable:!0,options:[{label:"全部",value:""},...H.map(e=>({label:e.label,value:e.value}))]}],toolbarButtons:[{key:"add",label:"新建命名空间",icon:ae,type:"primary",tooltip:"新建命名空间"},{key:"edit",label:"编辑",icon:re,tooltip:"编辑选中的命名空间"},{key:"delete",label:"删除",icon:te,type:"error",tooltip:"删除选中的命名空间"}],showSearchButton:!0,showResetButton:!0},m=[{key:"basic",label:"基本信息"},{key:"config",label:"默认配置"},{key:"permission",label:"权限配置"},{key:"other",label:"其他配置"}],d=[{field:"groupName",label:"命名空间名称",type:"input",placeholder:"请输入命名空间名称",span:12,tabKey:"basic",required:!0,primary:!0,props:{maxlength:50,showCount:!0}},{field:"groupType",label:"类型",type:"select",placeholder:"请选择类型",span:12,tabKey:"basic",required:!0,options:L.map(e=>({label:e.label,value:e.value})),defaultValue:"BUSINESS"},{field:"groupDescription",label:"描述",type:"textarea",placeholder:"请输入描述信息",span:24,tabKey:"basic",props:{maxlength:500,showCount:!0,rows:3}},{field:"accessControlEnabled",label:"访问控制",type:"select",span:12,tabKey:"basic",defaultValue:"N",options:H.map(e=>({label:e.label,value:e.value})),tips:"启用后只有授权用户可以访问此命名空间"},{field:"defaultProtocolType",label:"默认协议",type:"select",placeholder:"请选择默认协议",span:12,tabKey:"config",required:!0,options:oe.map(e=>({label:e.label,value:e.value})),defaultValue:"HTTP"},{field:"defaultLoadBalanceStrategy",label:"负载均衡策略",type:"select",placeholder:"请选择负载均衡策略",span:12,tabKey:"config",required:!0,options:se.map(e=>({label:e.label,value:e.value})),defaultValue:"ROUND_ROBIN"},{field:"defaultHealthCheckUrl",label:"健康检查URL",type:"input",placeholder:"请输入健康检查URL",span:12,tabKey:"config",required:!0,defaultValue:"/health"},{field:"defaultHealthCheckIntervalSeconds",label:"检查间隔(秒)",type:"number",placeholder:"请输入检查间隔",span:12,tabKey:"config",required:!0,defaultValue:30,props:{min:5,max:300,step:5}},{field:"adminUserIds",label:"管理员用户",type:"select",placeholder:"请选择管理员用户",span:24,tabKey:"permission",props:{multiple:!0,filterable:!0,remote:!0},show:e=>(e==null?void 0:e.accessControlEnabled)==="Y",tips:"管理员拥有命名空间的完全控制权限"},{field:"readUserIds",label:"只读用户",type:"select",placeholder:"请选择只读用户",span:24,tabKey:"permission",props:{multiple:!0,filterable:!0,remote:!0},show:e=>(e==null?void 0:e.accessControlEnabled)==="Y",tips:"只读用户仅能查看命名空间信息，无法修改"},{field:"noteText",label:"备注信息",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{maxlength:500,showCount:!0,rows:4}}];return{moduleId:l,loading:r,namespaceList:u,pageInfo:t,searchFormConfig:o,formTabs:m,formFields:d,gridConfig:{columns:[{field:"serviceGroupId",title:"分组ID",width:180,showOverflow:!0},{field:"groupName",title:"命名空间名称",width:160,sortable:!0,showOverflow:!0},{field:"groupType",title:"类型",width:100,align:"center",formatter:({cellValue:e})=>({BUSINESS:"业务",SYSTEM:"系统",TEST:"测试"})[e]||e,cellRender:{name:"VxeTag",props:({row:e})=>{const c={BUSINESS:{type:"success"},SYSTEM:{type:"warning"},TEST:{type:"info"}},p=e.groupType;return{type:(c[p]||{type:"default"}).type,content:c[p]?p==="BUSINESS"?"业务":p==="SYSTEM"?"系统":"测试":p}}}},{field:"groupDescription",title:"描述",width:200,showOverflow:"tooltip"},{field:"ownerUserName",title:"所有者",width:100,showOverflow:!0,formatter:({row:e})=>e.ownerUserName||e.ownerUserId||"-"},{field:"accessControlEnabled",title:"访问控制",width:90,align:"center",cellRender:{name:"VxeTag",props:({row:e})=>({type:e.accessControlEnabled==="Y"?"success":"default",content:e.accessControlEnabled==="Y"?"已启用":"未启用"})}},{field:"defaultProtocolType",title:"默认协议",width:90,align:"center",cellRender:{name:"VxeTag",props:({row:e})=>({type:"info",content:e.defaultProtocolType})}},{field:"defaultLoadBalanceStrategy",title:"负载均衡",width:120,showOverflow:!0,formatter:({cellValue:e})=>({ROUND_ROBIN:"轮询",WEIGHTED_ROUND_ROBIN:"加权轮询",LEAST_CONNECTIONS:"最少连接",RANDOM:"随机",IP_HASH:"IP哈希"})[e]||e},{field:"defaultHealthCheckUrl",title:"健康检查",width:130,showOverflow:!0,formatter:({row:e})=>`${e.defaultHealthCheckUrl} (${e.defaultHealthCheckIntervalSeconds}s)`},{field:"serviceCount",title:"服务数",width:80,align:"center",formatter:({cellValue:e})=>(e==null?void 0:e.toString())||"0"},{field:"instanceCount",title:"实例数",width:80,align:"center",formatter:({cellValue:e})=>(e==null?void 0:e.toString())||"0"},{field:"activeFlag",title:"状态",width:80,align:"center",cellRender:{name:"VxeTag",props:({row:e})=>({type:e.activeFlag==="Y"?"success":"error",content:e.activeFlag==="Y"?"活动":"非活动"})}},{field:"addTime",title:"创建时间",width:140,sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?j(e,"YYYY-MM-DD HH:mm"):""},{field:"addWhoName",title:"创建人",width:90,showOverflow:!0,formatter:({row:e})=>e.addWhoName||e.addWho||"-"}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:t,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},resetPagination:()=>{t.value=void 0},updatePagination:e=>{t.value?Object.assign(t.value,e):t.value=e},setNamespaceList:e=>{u.value=e},clearNamespaceList:()=>{u.value=[]},addNamespaceToList:e=>{u.value.unshift(e)},updateNamespaceInList:(e,c,p)=>{const N=u.value.findIndex(k=>k.serviceGroupId===e&&k.tenantId===c);N!==-1&&Object.assign(u.value[N],p)},removeNamespaceFromList:(e,c)=>{const p=u.value.findIndex(N=>N.serviceGroupId===e&&N.tenantId===c);p!==-1&&u.value.splice(p,1)}}}const M=$("/gateway/hub0040"),ce=async l=>M.post("/queryServiceGroups",l),x=async l=>M.post("/getServiceGroup",{serviceGroupId:l}),ue=async l=>M.post("/createServiceGroup",l),G=async l=>M.post("/updateServiceGroup",l),pe=async l=>M.post("/deleteServiceGroup",{serviceGroupId:l});function de(l){const r=K(),u=Y(),t=ie(),{loading:o,namespaceList:m,pageInfo:d,setNamespaceList:S,updatePagination:v,addNamespaceToList:b,updateNamespaceInList:h,removeNamespaceFromList:I}=t,f=async s=>{var a,i,g;o.value=!0;try{let T=s;!T&&((a=l==null?void 0:l.value)!=null&&a.getFormData)&&(T=l.value.getFormData()||{});const B=T?Object.fromEntries(Object.entries(T).filter(([,y])=>y!==""&&y!==null&&y!==void 0)):{},D=A((i=d.value)==null?void 0:i.pageIndex,(g=d.value)==null?void 0:g.pageSize),R={...B,pageIndex:D.pageIndex,pageSize:D.pageSize},C=await ce(R);if(C.oK){if(C.bizData){const y=JSON.parse(C.bizData),F=Array.isArray(y)?y:[];S(F)}if(C.pageQueryData){const y=JSON.parse(C.pageQueryData);v(y)}}else r.error(C.errMsg||"查询命名空间列表失败")}catch(T){console.error("加载命名空间列表失败:",T),r.error("加载命名空间列表失败")}finally{o.value=!1}};return{model:t,loadNamespaces:f,handleSearch:async s=>{await f(s)},handleReset:async()=>{t.resetPagination(),await f()},handlePageChange:async({currentPage:s,pageSize:a})=>{v({pageIndex:s,pageSize:a}),await f()},handleRefresh:async()=>{await f()},createNamespace:async s=>{o.value=!0;try{const a=await ue(s);if(a.oK&&a.state){if(r.success(a.popMsg||"创建命名空间成功"),a.bizData){const i=JSON.parse(a.bizData);b(i)}else await f();return!0}else return r.error(a.errMsg||a.popMsg||"创建命名空间失败"),!1}catch(a){return console.error("创建命名空间失败:",a),r.error("创建命名空间失败"),!1}finally{o.value=!1}},updateNamespace:async s=>{o.value=!0;try{const a=await G(s);if(a.oK&&a.state){if(r.success(a.popMsg||"更新命名空间成功"),a.bizData){const i=JSON.parse(a.bizData);h(i.serviceGroupId,i.tenantId,i)}else h(s.serviceGroupId,s.tenantId,s);return!0}else return r.error(a.errMsg||a.popMsg||"更新命名空间失败"),!1}catch(a){return console.error("更新命名空间失败:",a),r.error("更新命名空间失败"),!1}finally{o.value=!1}},enableNamespace:async s=>{o.value=!0;try{const a=await x(s);if(!a.oK||!a.state)return r.error(a.errMsg||a.popMsg||"获取命名空间详情失败"),!1;const i=a.bizData,g=await G({serviceGroupId:i.serviceGroupId,activeFlag:"Y"});return g.oK&&g.state?(r.success(g.popMsg||"启用成功"),await f(),!0):(r.error(g.errMsg||g.popMsg||"启用失败"),!1)}catch(a){return console.error("启用命名空间失败:",a),r.error("启用失败，请稍后重试"),!1}finally{o.value=!1}},disableNamespace:async s=>{o.value=!0;try{const a=await x(s);if(!a.oK||!a.state)return r.error(a.errMsg||a.popMsg||"获取命名空间详情失败"),!1;const i=a.bizData,g=await G({serviceGroupId:i.serviceGroupId,activeFlag:"N"});return g.oK&&g.state?(r.success(g.popMsg||"禁用成功"),await f(),!0):(r.error(g.errMsg||g.popMsg||"禁用失败"),!1)}catch(a){return console.error("禁用命名空间失败:",a),r.error("禁用失败，请稍后重试"),!1}finally{o.value=!1}},deleteNamespace:async s=>{if(!await u.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除命名空间 "${s.groupName}" 吗？`,icon:le,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;o.value=!0;try{const i=await pe(s.serviceGroupId);return i.oK&&i.state?(r.success(i.popMsg||"删除成功"),I(s.serviceGroupId,s.tenantId),m.value.length===0&&d.value&&d.value.pageIndex>1&&(v({pageIndex:d.value.pageIndex-1}),await f()),!0):(r.error(i.errMsg||i.popMsg||"删除失败"),!1)}catch(i){return console.error("删除命名空间失败:",i),r.error("删除失败，请稍后重试"),!1}finally{o.value=!1}},viewNamespace:async s=>{try{const a=await x(s.serviceGroupId);return a.oK?JSON.parse(a.bizData):(r.error(a.errMsg||"获取命名空间详情失败"),null)}catch(a){return console.error("获取命名空间详情失败:",a),r.error("获取命名空间详情失败"),null}}}}function me(l,r){const u=K(),t=de(r),o=w(!1),m=w("create"),d=w(null),S=async e=>{await t.handleSearch(e)},v=()=>{m.value="create",d.value=null,o.value=!0},b=e=>{m.value="edit",d.value=e,o.value=!0},h=()=>{o.value=!1,d.value=null},I=e=>{m.value="view",d.value=e,o.value=!0};return{service:t,formDialogVisible:o,formDialogMode:m,currentEditNamespace:d,openAddDialog:v,openEditDialog:b,openViewDialog:I,handleFormSubmit:async e=>{if(e&&m.value!=="view"){if(m.value==="create")await t.createNamespace(e)&&h();else if(m.value==="edit"){if(!d.value)return;const c={...d.value,...e};await t.updateNamespace(c)&&h()}}},handleToolbarClick:async(e,c)=>{switch(e){case"add":v();break;case"edit":{if(!(l!=null&&l.value)){u.warning("Grid 引用未设置");return}const p=l.value.getCurrentRecord();if(!p){u.warning("请先点击选择要编辑的命名空间");return}b(p);break}case"delete":{if(!(l!=null&&l.value)){u.warning("Grid 引用未设置");return}const p=l.value.getCurrentRecord();if(!p){u.warning("请先点击选择要删除的命名空间");return}await t.deleteNamespace(p);break}case"search":{await t.handleSearch(c);break}}},handleMenuClick:async({code:e,row:c})=>{if(c)switch(e){case"view":I(c);break;case"edit":b(c);break;case"delete":await t.deleteNamespace(c);break}},handleSearch:S}}const fe=["id"],ge=V({name:"NamespaceManagement",__name:"NamespaceManagement",setup(l){const r=w(),u=w(),{service:t,formDialogVisible:o,formDialogMode:m,currentEditNamespace:d,handleFormSubmit:S,handleToolbarClick:v,handleMenuClick:b,handleSearch:h}=me(u,r);return(I,f)=>(Z(),Q("div",{class:"namespace-management",id:n(t).model.moduleId},[P(n(J),{direction:"vertical","default-size":.1,min:.1,max:.5},{1:_(()=>[P(W,U({ref_key:"searchFormRef",ref:r,"module-id":n(t).model.moduleId},n(t).model.searchFormConfig,{onSearch:n(h),onToolbarClick:n(v)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:_(()=>[P(n(q),U({ref_key:"gridRef",ref:u,"module-id":n(t).model.moduleId,data:n(t).model.namespaceList,loading:n(t).model.loading},n(t).model.gridConfig,{onPageChange:n(t).handlePageChange,onMenuClick:n(b)}),null,16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),P(z,{visible:n(o),"onUpdate:visible":f[0]||(f[0]=O=>X(o)?o.value=O:null),mode:n(m),title:n(m)==="create"?"新增命名空间":n(m)==="edit"?"编辑命名空间":"查看命名空间详情",to:`#${n(t).model.moduleId}`,"form-fields":n(t).model.formFields,"form-tabs":n(t).model.formTabs,"initial-data":n(d)||void 0,"auto-close-on-confirm":!1,"confirm-loading":n(t).model.loading.value,onSubmit:n(S)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,fe))}}),Ke=ee(ge,[["__scopeId","data-v-066f76d0"]]);export{Ke as default};

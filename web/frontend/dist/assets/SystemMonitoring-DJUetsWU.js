import{d as pe,p as Oe,r as C,c as q,P as ue,v as ve,Q as ye,h as we,o as O,w,g as y,b as j,i as te,e as f,f as t,I as be,R as he,J as Me,K as oe,t as ee,j as ne,S as fe,T as E,_ as De,U as Ye,V as We,q as Ke,W as Ge,X as je,m as Qe,z as ie,A as le,B as ce,Y as _e,Z as Je}from"./index-Cn7INyMW.js";import{N as ke}from"./DatePicker-BRjB_IEK.js";import{R as Te,D as Xe,A as Be,a as Fe,C as Ze,G as et,W as tt,b as at}from"./WindowsOutlined-CDwD99KY.js";import{u as $e,i as xe,a as Ce,b as Ie,c as Le,d as Pe,e as Re,f as Ae,g as Ne,L as Ve}from"./installCanvasRenderer-BddeS-3K.js";import{_ as rt}from"./DataTable-BbWwvTUV.js";import{u as st}from"./usePagination-B9uf9Sr_.js";import{_ as ot}from"./Select-DnGgo6jM.js";import"./Checkbox-eyhQk6zD.js";import"./Radio-COXYUPog.js";import"./RadioGroup-DqrTUH7V.js";import"./prop-BjyUHhTu.js";import"./download-C2161hUv.js";import"./index-DR_R-bYe.js";const nt={class:"card-extra"},it={class:"chart-container"},lt={key:0,class:"chart-loading"},ct={key:1,class:"chart-empty"},ut=pe({__name:"CpuMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},cpuDetailData:{type:Array,default:()=>[]},userColor:{type:String,default:"#1890ff"},systemColor:{type:String,default:"#52c41a"},idleColor:{type:String,default:"#d9d9d9"}},emits:["refresh","time-range-change"],setup(s,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=C(null);let d=null;const D=s,_=x,k=Date.now(),z=k-3600*1e3,I=C([z,k]),A=q(()=>({[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const a=Date.now();return[a-3600*1e3,a]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const a=Date.now();return[a-6*3600*1e3,a]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const a=Date.now();return[a-12*3600*1e3,a]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const a=Date.now();return[a-24*3600*1e3,a]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const a=Date.now();return[a-7*24*3600*1e3,a]}})),B=()=>{M.value&&(d=xe(M.value),window.addEventListener("resize",Y),H())},H=()=>{if(!d)return;if(!D.data||!Array.isArray(D.data)||D.data.length===0){d.clear();return}const a=D.data.map(c=>c.collectTime).sort(),n=new Map;D.data.forEach(c=>{n.set(c.collectTime,c)});const r=[{name:e("hub0000.cpu.usage"),type:"line",data:a.map(c=>{const o=n.get(c);return{value:o?o.usagePercent:0,detail:o}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:D.userColor}},{name:e("hub0000.cpu.userUsage"),type:"line",data:a.map(c=>{const o=n.get(c);return{value:o?o.userPercent:0,detail:o}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:D.systemColor}},{name:e("hub0000.cpu.systemUsage"),type:"line",data:a.map(c=>{const o=n.get(c);return{value:o?o.systemPercent:0,detail:o}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:D.idleColor}}],i={tooltip:{trigger:"axis",formatter:c=>{const o=c[0].data.detail;let g="";return o&&(g+=`${e("hub0000.cpu.detailTitle")}:<br/>`,g+=`${e("hub0000.cpu.serverId")}: ${o.metricServerId}<br/>`,g+=`${e("hub0000.cpu.coreCount")}: ${o.coreCount}<br/>`,g+=`${e("hub0000.cpu.logicalCount")}: ${o.logicalCount}<br/>`,g+=`${e("hub0000.cpu.loadAvg1")}: ${o.loadAvg1.toFixed(2)}<br/>`,g+=`${e("hub0000.cpu.loadAvg5")}: ${o.loadAvg5.toFixed(2)}<br/>`,g+=`${e("hub0000.cpu.loadAvg15")}: ${o.loadAvg15.toFixed(2)}<br/>`,g+=`${e("hub0000.cpu.ioWaitUsage")}: ${o.ioWaitPercent.toFixed(2)}%<br/>`,g+=`${e("hub0000.cpu.irqUsage")}: ${o.irqPercent.toFixed(2)}%<br/>`,g+=`${e("hub0000.cpu.softIrqUsage")}: ${o.softIrqPercent.toFixed(2)}%<br/>`,g+="<br/>"),c.forEach(p=>{const T=p.marker,u=p.seriesName,v=`${p.value.toFixed(2)}%`;g+=`${T} ${u}: ${v}<br/>`}),g},axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:[e("hub0000.cpu.usage"),e("hub0000.cpu.userUsage"),e("hub0000.cpu.systemUsage")],type:"scroll",bottom:0},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:a.map(c=>E(c,"HH:mm:ss")),axisLabel:{interval:Math.floor(a.length/10)}},yAxis:{type:"value",axisLabel:{formatter:c=>c.toFixed(2)+"%"},max:100,min:0},series:r};d.setOption(i,!0)},Y=()=>{d==null||d.resize()},ae=()=>{_("refresh")},m=a=>{_("time-range-change",a)};return ue(()=>D.data,()=>{H()},{deep:!0}),ve(()=>{B(),_("time-range-change",I.value)}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",Y)}),(a,n)=>(O(),we(t(fe),{title:t(e)("hub0000.cpu.title"),bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",nt,[f(t(ke),{value:I.value,"onUpdate:value":[n[0]||(n[0]=r=>I.value=r),m],type:"datetimerange",shortcuts:A.value,placeholder:t(e)("hub0000.common.selectTimeRange"),size:"small"},null,8,["value","shortcuts","placeholder"]),f(t(Me),{size:"small",onClick:ae,loading:s.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("hub0000.common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",it,[y("div",{ref_key:"chartRef",ref:M,class:"chart-element"},null,512),s.loading?(O(),j("div",lt,[f(t(be),{size:"large"})])):te("",!0),!s.loading&&(!s.data||!Array.isArray(s.data)||s.data.length===0)?(O(),j("div",ct,[f(t(he),{description:t(e)("hub0000.common.noData")},null,8,["description"])])):te("",!0)])]),_:1},8,["title"]))}}),dt=De(ut,[["__scopeId","data-v-7ffafae8"]]),mt={class:"card-extra"},ht={class:"chart-container"},ft={key:0,class:"chart-loading"},gt={key:1,class:"chart-empty"},pt=pe({__name:"MemoryMonitor",props:{title:{type:String,default:"内存使用率"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},warningThreshold:{type:Number,default:80},dangerThreshold:{type:Number,default:90},memoryDetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(s,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=s,d=q(()=>M.title||e("hub0000.memory.title")),D=q(()=>M.warningThreshold),_=q(()=>M.dangerThreshold),k=x,z=C(null);let I=null;const A=Date.now(),B=A-3600*1e3,H=C([B,A]),Y=q(()=>({[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const o=Date.now();return[o-3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const o=Date.now();return[o-6*3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const o=Date.now();return[o-12*3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const o=Date.now();return[o-24*3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const o=Date.now();return[o-7*24*3600*1e3,o]}})),ae=q(()=>{if(!M.data||M.data.length===0)return[];const o=new Map;return M.data.forEach(p=>{const T=p.collectTime;o.has(T)||o.set(T,[]),o.get(T).push(p.usagePercent)}),Array.from(o.entries()).map(([p,T])=>{const u=M.data.find(v=>v.collectTime===p);return{time:p,value:Math.round(T.reduce((v,$)=>v+$,0)/T.length*100)/100,detail:u?{totalMemory:u.totalMemory,usedMemory:u.usedMemory,availableMemory:u.availableMemory,freeMemory:u.freeMemory,cachedMemory:u.cachedMemory,buffersMemory:u.buffersMemory,swapTotal:u.swapTotal,swapUsed:u.swapUsed,swapFree:u.swapFree,swapUsagePercent:u.swapUsagePercent}:null}}).sort((p,T)=>new Date(p.time).getTime()-new Date(T.time).getTime())}),m=o=>{if(o===0)return"0 B";const g=["B","KB","MB","GB","TB","PB"],p=Math.floor(Math.log(o)/Math.log(1024));return`${(o/Math.pow(1024,p)).toFixed(2)} ${g[p]}`},a=()=>{k("refresh")},n=o=>{k("time-range-change",o)},r=()=>{z.value&&(I=xe(z.value),window.addEventListener("resize",c),i())},i=()=>{if(!I)return;const o=ae.value;if(o.length===0){I.clear();return}const g={title:{show:!1},tooltip:{trigger:"axis",formatter:function(p){const T=p[0],u=T.data.detail;if(!u)return`${T.marker}${T.seriesName}: ${T.data.value}%`;let v="";return v+=`${T.marker}${e("hub0000.memory.usage")}: <b>${T.data.value}%</b><br/>`,v+=`<br/>${e("hub0000.memory.details")}:<br/>`,v+=`${e("hub0000.memory.total")}: ${m(u.totalMemory)}<br/>`,v+=`${e("hub0000.memory.used")}: ${m(u.usedMemory)}<br/>`,v+=`${e("hub0000.memory.available")}: ${m(u.availableMemory)}<br/>`,v+=`${e("hub0000.memory.free")}: ${m(u.freeMemory)}<br/>`,v+=`${e("hub0000.memory.cached")}: ${m(u.cachedMemory)}<br/>`,v+=`${e("hub0000.memory.buffers")}: ${m(u.buffersMemory)}<br/>`,v+=`<br/>${e("hub0000.memory.swap")}:<br/>`,v+=`${e("hub0000.memory.swapTotal")}: ${m(u.swapTotal)}<br/>`,v+=`${e("hub0000.memory.swapUsed")}: ${m(u.swapUsed)}<br/>`,v+=`${e("hub0000.memory.swapFree")}: ${m(u.swapFree)}<br/>`,v+=`${e("hub0000.memory.swapUsage")}: ${u.swapUsagePercent.toFixed(1)}%`,v}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o.map(p=>E(new Date(p.time),"HH:mm:ss")),axisLabel:{rotate:45}},yAxis:{type:"value",min:0,max:100,splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:"{value}%"}},series:[{name:e("hub0000.memory.usage"),type:"line",data:o.map(p=>({value:p.value,detail:p.detail})),smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:2,color:"#52c41a"},itemStyle:{color:function(p){const T=p.data.value;return T>=_.value?"#ff4d4f":T>=D.value?"#faad14":"#52c41a"}},areaStyle:{color:new Ve(0,0,0,1,[{offset:0,color:"rgba(82, 196, 26, 0.3)"},{offset:1,color:"rgba(82, 196, 26, 0.1)"}])},markLine:{silent:!0,lineStyle:{color:"#faad14"},data:[{yAxis:D.value,label:{formatter:`${e("hub0000.memory.warning")} ${D.value}%`,position:"start"}},{yAxis:_.value,lineStyle:{color:"#ff4d4f"},label:{formatter:`${e("hub0000.memory.danger")} ${_.value}%`,position:"start"}}]}}]};I.setOption(g)},c=()=>{I==null||I.resize()};return ue(()=>M.data,()=>{i()},{deep:!0}),ve(()=>{r(),k("time-range-change",H.value)}),ye(()=>{I&&(I.dispose(),I=null),window.removeEventListener("resize",c)}),(o,g)=>(O(),we(t(fe),{title:d.value,bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",mt,[f(t(ke),{value:H.value,"onUpdate:value":[g[0]||(g[0]=p=>H.value=p),n],type:"datetimerange",shortcuts:Y.value,placeholder:t(e)("common.selectTimeRange"),size:"small"},null,8,["value","shortcuts","placeholder"]),f(t(Me),{size:"small",onClick:a,loading:s.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",ht,[y("div",{ref_key:"chartRef",ref:z,class:"chart-element"},null,512),s.loading?(O(),j("div",ft,[f(t(be),{size:"large"})])):te("",!0),!s.loading&&!ae.value.length?(O(),j("div",gt,[f(t(he),{description:t(e)("common.noData")},null,8,["description"])])):te("",!0)])]),_:1},8,["title"]))}}),vt=De(pt,[["__scopeId","data-v-284035ac"]]),yt={class:"card-extra"},wt={class:"chart-container"},bt={key:0,class:"chart-loading"},Mt={key:1,class:"chart-empty"},Dt=pe({__name:"DiskMonitor",props:{title:{type:String,default:"磁盘使用率"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},warningThreshold:{type:Number,default:80},dangerThreshold:{type:Number,default:90},diskDetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(s,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=s,d=q(()=>M.title||e("hub0000.disk.title")),D=x,_=C(null);let k=null;const z=Date.now(),I=z-3600*1e3,A=C([I,z]),B=q(()=>({[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const i=Date.now();return[i-3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const i=Date.now();return[i-6*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const i=Date.now();return[i-12*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const i=Date.now();return[i-24*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const i=Date.now();return[i-7*24*3600*1e3,i]}})),H=q(()=>{if(!M.data||M.data.length===0)return[];const i=new Map;return M.data.forEach(c=>{const o=c.collectTime;i.has(o)||i.set(o,{values:[],partitions:[]});const g=i.get(o);g.values.push(c.usagePercent),g.partitions.push(c)}),Array.from(i.entries()).map(([c,o])=>({time:c,value:Math.round(o.values.reduce((g,p)=>g+p,0)/o.values.length*100)/100,detail:{partitions:o.partitions,partitionCount:o.partitions.length,totalSpace:o.partitions.reduce((g,p)=>g+p.totalSpace,0),usedSpace:o.partitions.reduce((g,p)=>g+p.usedSpace,0),freeSpace:o.partitions.reduce((g,p)=>g+p.freeSpace,0),avgUsagePercent:Math.round(o.values.reduce((g,p)=>g+p,0)/o.values.length*100)/100}}))}),Y=i=>{if(i===0)return"0 B";const c=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(i)/Math.log(1024));return`${(i/Math.pow(1024,o)).toFixed(2)} ${c[o]}`},ae=()=>{D("refresh")},m=i=>{D("time-range-change",i)},a=()=>{_.value&&(k=xe(_.value),window.addEventListener("resize",r),n())},n=()=>{if(!k)return;const i=H.value;if(i.length===0){k.clear();return}const c=q(()=>M.warningThreshold??80),o=q(()=>M.dangerThreshold??90),g={title:{show:!1},tooltip:{trigger:"axis",formatter:function(p){const T=p[0],u=T.data.detail;let v="";return v+=`${T.marker}${e("hub0000.disk.usage")}: <b>${T.data.value}%</b><br/>`,v+=`<br/>${e("hub0000.disk.details")}:<br/>`,v+=`${e("hub0000.disk.partitionCount")}: ${u.partitionCount}<br/>`,v+=`${e("hub0000.disk.totalSpace")}: ${Y(u.totalSpace)}<br/>`,v+=`${e("hub0000.disk.usedSpace")}: ${Y(u.usedSpace)}<br/>`,v+=`${e("hub0000.disk.freeSpace")}: ${Y(u.freeSpace)}<br/>`,u.partitions.length>0&&(v+=`<br/>${e("hub0000.disk.partitionDetails")}:<br/>`,u.partitions.slice(0,3).forEach(L=>{v+=`${L.mountPoint}: ${L.usagePercent.toFixed(1)}% (${Y(L.usedSpace)}/${Y(L.totalSpace)})<br/>`}),u.partitions.length>3&&(v+=`... ${e("hub0000.disk.morePartitions",{count:u.partitions.length-3})}`)),v}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:i.map(p=>E(new Date(p.time),"HH:mm:ss")),axisLabel:{rotate:45}},yAxis:{type:"value",min:0,max:100,splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:"{value}%"}},series:[{name:e("hub0000.disk.usage"),type:"line",data:i.map(p=>({value:p.value,detail:p.detail})),smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:2,color:"#faad14"},itemStyle:{color:function(p){const T=p.data.value;return T>=o.value?"#ff4d4f":(T>=c.value,"#faad14")}},areaStyle:{color:new Ve(0,0,0,1,[{offset:0,color:"rgba(250, 173, 20, 0.3)"},{offset:1,color:"rgba(250, 173, 20, 0.1)"}])},markLine:{silent:!0,lineStyle:{color:"#faad14"},data:[{yAxis:c.value,label:{formatter:`${e("hub0000.disk.warning")} ${c.value}%`,position:"start"}},{yAxis:o.value,lineStyle:{color:"#ff4d4f"},label:{formatter:`${e("hub0000.disk.danger")} ${o.value}%`,position:"start"}}]}}]};k.setOption(g)},r=()=>{k==null||k.resize()};return ue(()=>M.data,()=>{n()},{deep:!0}),ve(()=>{a(),D("time-range-change",A.value)}),ye(()=>{k&&(k.dispose(),k=null),window.removeEventListener("resize",r)}),(i,c)=>(O(),we(t(fe),{title:d.value,bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",yt,[f(t(ke),{value:A.value,"onUpdate:value":[c[0]||(c[0]=o=>A.value=o),m],type:"datetimerange",shortcuts:B.value,placeholder:t(e)("hub0000.common.selectTimeRange"),size:"small"},null,8,["value","shortcuts","placeholder"]),f(t(Me),{size:"small",onClick:ae,loading:s.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("hub0000.common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",wt,[y("div",{ref_key:"chartRef",ref:_,class:"chart-element"},null,512),s.loading?(O(),j("div",bt,[f(t(be),{size:"large"})])):te("",!0),!s.loading&&!H.value.length?(O(),j("div",Mt,[f(t(he),{description:t(e)("hub0000.common.noData")},null,8,["description"])])):te("",!0)])]),_:1},8,["title"]))}}),Tt=De(Dt,[["__scopeId","data-v-d7f5b2b1"]]),_t={class:"card-extra"},St={class:"chart-container"},kt={key:0,class:"chart-loading"},$t={key:1,class:"chart-empty"},xt={key:0,class:"detail-section"},Ct=pe({__name:"DiskIOMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},diskIODetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(s,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=C(null);let d=null;const D=s,_=x,k=Date.now(),z=k-3600*1e3,I=C([z,k]),A={[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const i=Date.now();return[i-3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const i=Date.now();return[i-6*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const i=Date.now();return[i-12*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const i=Date.now();return[i-24*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const i=Date.now();return[i-7*24*3600*1e3,i]}},B={pageSize:5,page:1},H=q(()=>[{title:e("hub0000.diskIO.deviceName"),key:"deviceName"},{title:e("hub0000.diskIO.readBytesRate"),key:"readRate",render:i=>Ye(i.readRate)+"/s"},{title:e("hub0000.diskIO.writeBytesRate"),key:"writeRate",render:i=>Ye(i.writeRate)+"/s"},{title:e("hub0000.diskIO.readCount"),key:"readCount"},{title:e("hub0000.diskIO.writeCount"),key:"writeCount"},{title:e("hub0000.diskIO.collectTime"),key:"collectTime",render:i=>E(i.collectTime)}]),Y=q(()=>{if(!D.diskIODetailData)return[];const i=new Map;return D.diskIODetailData.forEach(c=>{const o=i.get(c.deviceName);(!o||new Date(c.collectTime)>new Date(o.collectTime))&&i.set(c.deviceName,c)}),Array.from(i.values())}),ae=()=>{M.value&&(d=xe(M.value),window.addEventListener("resize",a),m())},m=()=>{if(!d)return;if(!D.data||!Array.isArray(D.data)||D.data.length===0){d.clear();return}const i=new Map;D.data.forEach(u=>{var v;i.has(u.collectTime)||i.set(u.collectTime,new Map),(v=i.get(u.collectTime))==null||v.set(u.deviceName,u)});const c=Array.from(i.keys()).sort(),o=new Set;D.data.forEach(u=>o.add(u.deviceName));const g=[{read:"#1890ff",write:"#36cfc9"},{read:"#722ed1",write:"#eb2f96"},{read:"#fa8c16",write:"#faad14"},{read:"#52c41a",write:"#a0d911"},{read:"#f5222d",write:"#ff7a45"}],p=[];Array.from(o).forEach((u,v)=>{const $=v%g.length,L=g[$],J=[],Q=[];c.forEach(F=>{var re;const U=(re=i.get(F))==null?void 0:re.get(u);J.push(U?U.readRate:0),Q.push(U?U.writeRate:0)}),p.push({name:`${u} ${e("hub0000.diskIO.read")}`,type:"line",data:J,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"solid"},itemStyle:{color:L.read}}),p.push({name:`${u} ${e("hub0000.diskIO.write")}`,type:"line",data:Q,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"dashed"},itemStyle:{color:L.write}})});const T={title:{show:!1},tooltip:{trigger:"axis",formatter:u=>{const v=Array.isArray(u)?u[0]:u,$=c[v.dataIndex];let L=E($,"YYYY-MM-DD HH:mm:ss")+"<br/>";const J=new Map;return u.forEach(Q=>{var re;const U=Q.seriesName.split(" ")[0];J.has(U)||J.set(U,[]),(re=J.get(U))==null||re.push(Q)}),J.forEach((Q,F)=>{L+=`<div style="margin-top: 3px;"><b>${F}</b></div>`,Q.forEach(U=>{const re=U.color,V=U.seriesName.includes(e("hub0000.diskIO.read")),W=e(V?"hub0000.diskIO.read":"hub0000.diskIO.write"),h=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${re};border:1px solid ${re}"></span>`;L+=`<div style="padding-left: 12px;line-height:18px">${h}${W}: ${Ye(Number(U.value))}/s</div>`})}),L}},legend:{type:"scroll",bottom:0,padding:[10,20],selected:p.reduce((u,v)=>(u[v.name]=!0,u),{}),formatter:u=>{const v=u.split(" ")[0],$=u.includes(e("hub0000.diskIO.read"))?e("hub0000.diskIO.read"):e("hub0000.diskIO.write");return`${v} ${$}`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:c.map(u=>E(u,"HH:mm:ss")),axisLabel:{interval:Math.floor(c.length/10)}},yAxis:{type:"value",axisLabel:{formatter:u=>Ye(u)+"/s"}},series:p};d.setOption(T,!0)},a=()=>{d==null||d.resize()},n=()=>{_("refresh")},r=i=>{_("time-range-change",i)};return ue(()=>D.data,()=>{m()},{deep:!0}),ve(()=>{ae(),_("time-range-change",I.value)}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",a)}),(i,c)=>(O(),we(t(fe),{title:t(e)("hub0000.diskIO.title"),bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",_t,[f(t(ke),{value:I.value,"onUpdate:value":[c[0]||(c[0]=o=>I.value=o),r],type:"datetimerange",shortcuts:A,placeholder:t(e)("common.selectTimeRange"),size:"small"},null,8,["value","placeholder"]),f(t(Me),{size:"small",onClick:n,loading:s.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",St,[y("div",{ref_key:"chartRef",ref:M,class:"chart-element"},null,512),s.loading?(O(),j("div",kt,[f(t(be),{size:"large"})])):te("",!0),!s.loading&&(!s.data||!Array.isArray(s.data)||s.data.length===0)?(O(),j("div",$t,[f(t(he),{description:t(e)("common.noData")},null,8,["description"])])):te("",!0)]),s.diskIODetailData&&s.diskIODetailData.length>0?(O(),j("div",xt,[f(t(We),null,{default:w(()=>[oe(ee(t(e)("hub0000.diskIO.detailTitle")),1)]),_:1}),f(t(rt),{columns:H.value,data:Y.value,pagination:B,bordered:!1,size:"small"},null,8,["columns","data"])])):te("",!0)]),_:1},8,["title"]))}}),It=De(Ct,[["__scopeId","data-v-c9355b22"]]),Lt={class:"card-extra"},Pt={class:"chart-container"},Rt={key:0,class:"chart-loading"},At={key:1,class:"chart-empty"},Nt=pe({__name:"NetworkMonitor",props:{title:{},data:{},loading:{type:Boolean},uploadColor:{},downloadColor:{}},emits:["refresh","time-range-change"],setup(s,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const e=s,M={title:"网络流量"},d=x,D=C(null);let _=null;const k=Date.now(),z=k-3600*1e3,I=C([z,k]),A={最近1小时:()=>{const r=Date.now();return[r-3600*1e3,r]},最近6小时:()=>{const r=Date.now();return[r-6*3600*1e3,r]},最近12小时:()=>{const r=Date.now();return[r-12*3600*1e3,r]},最近24小时:()=>{const r=Date.now();return[r-24*3600*1e3,r]},最近7天:()=>{const r=Date.now();return[r-7*24*3600*1e3,r]}},B=q(()=>{if(!e.data||e.data.length===0)return[];const r=new Map;return e.data.forEach(i=>{const c=i.collectTime;r.has(c)||r.set(c,{interfaces:[]}),r.get(c).interfaces.push(i)}),Array.from(r.entries()).sort((i,c)=>new Date(i[0]).getTime()-new Date(c[0]).getTime()).map(([i,c])=>({time:i,detail:{interfaces:c.interfaces,interfaceCount:c.interfaces.length}}))}),H=r=>r===0?"0 B/s":r<1024?`${r.toFixed(2)} B/s`:r<1024*1024?`${(r/1024).toFixed(2)} KB/s`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(2)} MB/s`:`${(r/(1024*1024*1024)).toFixed(2)} GB/s`,Y=()=>{d("refresh")},ae=r=>{d("time-range-change",r)},m=()=>{D.value&&(_=xe(D.value),window.addEventListener("resize",n),a())},a=()=>{if(!_)return;const r=B.value;if(r.length===0){_.clear();return}const i=r.map($=>E(new Date($.time),"HH:mm:ss")),c=new Set,o=[],g=[];r.forEach($=>{$.detail.interfaces.forEach(L=>{c.has(L.interfaceName)||(L.ipAddresses&&L.ipAddresses.includes(".")&&!L.ipAddresses.includes(":")||L.interfaceName.match(/eth\d+|en\d+|bond\d+|wlan\d+|ens\d+|enp\d+|lo\b|vlan\d+/i)?o.push(L.interfaceName):g.push(L.interfaceName),c.add(L.interfaceName))})});const p=[...o,...g],T=[{send:"#fa541c",receive:"#73d13d"},{send:"#722ed1",receive:"#13c2c2"},{send:"#f5222d",receive:"#52c41a"},{send:"#fa8c16",receive:"#1890ff"},{send:"#eb2f96",receive:"#fadb14"}],u=[];p.forEach(($,L)=>{const J=L%T.length,Q=T[J],F=r.map(V=>{const W=V.detail.interfaces.find(h=>h.interfaceName===$);return W?Math.round(W.sendRate/(1024*1024)*100)/100:0}),U=r.map(V=>{const W=V.detail.interfaces.find(h=>h.interfaceName===$);return W?Math.round(W.receiveRate/(1024*1024)*100)/100:0}),re=o.includes($)?2:1;u.push({name:`${$} 上传`,type:"line",data:F,smooth:!0,showSymbol:!1,lineStyle:{width:re,type:"solid"},itemStyle:{color:Q.send},emphasis:{focus:"series"},tooltip:{valueFormatter:V=>`${V} MB/s`}}),u.push({name:`${$} 下载`,type:"line",data:U,smooth:!0,showSymbol:!1,lineStyle:{width:re,type:"dashed"},itemStyle:{color:Q.receive},emphasis:{focus:"series"},tooltip:{valueFormatter:V=>`${V} MB/s`}})});const v={title:{show:!1},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function($){var re;const L=$[0].axisValue,J=i.indexOf(L),Q=(re=r[J])==null?void 0:re.detail;let F=`${L}<br/>`;const U=new Map;if($.forEach(V=>{const h=V.seriesName.split(" ")[0];U.has(h)||U.set(h,[]),U.get(h).push(V)}),Q){const V=new Set;U.forEach((R,G)=>{V.add(G)}),Q.interfaces.forEach(R=>{V.add(R.interfaceName)}),F+=`接口总数: ${Q.interfaceCount}<br/>`;const W=[],h=[];Array.from(V).forEach(R=>{const G=Q.interfaces.find(He=>He.interfaceName===R);if(!G)return;G.ipAddresses&&G.ipAddresses.includes(".")&&!G.ipAddresses.includes(":")||G.interfaceName.match(/eth\d+|en\d+|bond\d+|wlan\d+|ens\d+|enp\d+|lo\b|vlan\d+/i)?W.push(R):h.push(R)});const b=[...W,...h];b.length>0&&(F+="<br/>接口详情:<br/>",b.forEach(R=>{const G=Q.interfaces.find(He=>He.interfaceName===R);if(!G)return;F+='<div style="padding:3px 0;border-bottom:1px solid #eee;">',F+=`<b>${R}</b>: `,W.includes(R)&&(F+='<span style="color:#1890ff;">[IPv4]</span> '),F+=`<br/><span style="padding-left:10px;color:#ff4d4f;">↑${H(G.sendRate)}</span> `,F+=`<span style="padding-left:5px;color:#52c41a;">↓${H(G.receiveRate)}</span>`,(G.errorsReceived>0||G.errorsSent>0)&&(F+=` <span style="color:#ff7875;">(错误: ${G.errorsReceived+G.errorsSent})</span>`),G.ipAddresses&&(F+=`<br/><span style="padding-left:10px;color:#999;font-size:12px;">IP: ${G.ipAddresses}</span>`),F+="</div>"}))}return F}},legend:{type:"scroll",data:u.map($=>$.name),bottom:0,padding:[5,10],selected:u.reduce(($,L)=>{const J=L.name.split(" ")[0];return $[L.name]=o.includes(J),$},{})},grid:{left:"3%",right:"4%",bottom:"40px",top:"10px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:i,axisLabel:{rotate:45}},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:$=>$.toFixed(2)+" MB/s"}},series:u};_.setOption(v)},n=()=>{_==null||_.resize()};return ue(()=>e.data,()=>{a()},{deep:!0}),ve(()=>{m(),d("time-range-change",I.value)}),ye(()=>{_&&(_.dispose(),_=null),window.removeEventListener("resize",n)}),(r,i)=>(O(),we(t(fe),{title:r.title||M.title,bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",Lt,[f(t(ke),{value:I.value,"onUpdate:value":[i[0]||(i[0]=c=>I.value=c),ae],type:"datetimerange",shortcuts:A,placeholder:"选择时间范围",size:"small"},null,8,["value"]),f(t(Me),{size:"small",onClick:Y,loading:r.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[i[1]||(i[1]=oe(" 刷新 "))]),_:1},8,["loading"])])]),default:w(()=>[y("div",Pt,[y("div",{ref_key:"chartRef",ref:D,class:"chart-element"},null,512),r.loading?(O(),j("div",Rt,[f(t(be),{size:"large"})])):te("",!0),!r.loading&&!B.value.length?(O(),j("div",At,[f(t(he),{description:"暂无数据"})])):te("",!0)])]),_:1},8,["title"]))}}),Ot=De(Nt,[["__scopeId","data-v-ad4fba78"]]),Ht={class:"card-extra"},Yt={class:"chart-container"},zt={key:0,class:"chart-loading"},Et={key:1,class:"chart-empty"},Ut=pe({__name:"ProcessMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},processDetailData:{type:Array,default:()=>[]},cpuColor:{type:String,default:"#1890ff"},memoryColor:{type:String,default:"#52c41a"}},emits:["refresh","time-range-change"],setup(s,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=C(null);let d=null;const D=s,_=x,k=Date.now(),z=k-3600*1e3,I=C([z,k]),A={最近1小时:()=>{const a=Date.now();return[a-3600*1e3,a]},最近6小时:()=>{const a=Date.now();return[a-6*3600*1e3,a]},最近12小时:()=>{const a=Date.now();return[a-12*3600*1e3,a]},最近24小时:()=>{const a=Date.now();return[a-24*3600*1e3,a]},最近7天:()=>{const a=Date.now();return[a-7*24*3600*1e3,a]}},B=()=>{M.value&&(d=xe(M.value),window.addEventListener("resize",Y),H())},H=()=>{if(!d)return;if(!D.data||D.data.length===0){d.clear();return}const a=new Map;D.data.forEach(o=>{var g;a.has(o.collectTime)||a.set(o.collectTime,[]),(g=a.get(o.collectTime))==null||g.push(o)});const n=Array.from(a.keys()).sort(),r=[],i=[];n.forEach(o=>{const g=a.get(o)||[];if(g.length>0){const p=g.reduce((u,v)=>u+v.cpuPercent,0)/g.length,T=g.reduce((u,v)=>u+v.memoryPercent,0)/g.length;r.push(Number(p.toFixed(2))),i.push(Number(T.toFixed(2)))}else r.push(0),i.push(0)});const c={tooltip:{trigger:"axis",formatter:o=>{const g=o[0].dataIndex,p=a.get(n[g])||[];let T=E(n[g],"YYYY-MM-DD HH:mm:ss")+"<br/>";return o.forEach(u=>{const $=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${u.color};"></span>`;T+=$+u.seriesName+": "+u.value+"%<br/>"}),p.length>0&&(T+=`<span style="color:#666;">进程数量: ${p.length}</span><br/>`),p.length>0&&(T+="<br/><b>"+e("hub0000.process.detailTitle")+"</b><br/>",[...p].sort((v,$)=>$.cpuPercent-v.cpuPercent).slice(0,5).forEach((v,$)=>{T+='<div style="padding-left:10px;margin:2px 0;">',T+=`<b>${$+1}. ${v.processName}</b> <span style="color:#666;">(PID: ${v.processId})</span><br/>`,T+=`<span style="padding-left:15px;">CPU: ${v.cpuPercent.toFixed(2)}%, `,T+=`内存: ${v.memoryPercent.toFixed(2)}%, `,T+=`线程: ${v.threadCount}</span>`,T+="</div>"}),p.length>5&&(T+=`<div style="padding-left:10px;color:#999;">... 以及 ${p.length-5} 个其他进程</div>`)),T}},legend:{data:[e("hub0000.process.avgCpu"),e("hub0000.process.avgMemory")],bottom:0,padding:[10,20]},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:n.map(o=>E(o,"HH:mm:ss")),axisLabel:{interval:Math.floor(n.length/10)}},yAxis:{type:"value",min:0,max:100,position:"left",axisLabel:{formatter:"{value}%"}},series:[{name:e("hub0000.process.avgCpu"),type:"line",data:r,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"solid"},itemStyle:{color:D.cpuColor}},{name:e("hub0000.process.avgMemory"),type:"line",data:i,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"dashed"},itemStyle:{color:D.memoryColor}}]};d.setOption(c)},Y=()=>{d==null||d.resize()},ae=()=>{_("refresh")},m=a=>{_("time-range-change",a)};return ue(()=>D.data,()=>{H()},{deep:!0}),ve(()=>{B(),_("time-range-change",I.value)}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",Y)}),(a,n)=>(O(),we(t(fe),{title:t(e)("hub0000.process.title"),bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",Ht,[f(t(ke),{value:I.value,"onUpdate:value":[n[0]||(n[0]=r=>I.value=r),m],type:"datetimerange",shortcuts:A,placeholder:t(e)("common.selectTimeRange"),size:"small"},null,8,["value","placeholder"]),f(t(Me),{size:"small",onClick:ae,loading:s.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>{var r;return[y("div",Yt,[y("div",{ref_key:"chartRef",ref:M,class:"chart-element"},null,512),s.loading?(O(),j("div",zt,[f(t(be),{size:"large"})])):te("",!0),!s.loading&&!((r=s.data)!=null&&r.length)?(O(),j("div",Et,[f(t(he),{description:t(e)("common.noData")},null,8,["description"])])):te("",!0)])]}),_:1},8,["title"]))}}),qt=De(Ut,[["__scopeId","data-v-e0bbaa0b"]]);var Se=(s=>(s.ONLINE="online",s.OFFLINE="offline",s.WARNING="warning",s.CRITICAL="critical",s))(Se||{});const Z=Ge("SystemMonitorModel"),Bt=()=>{const s=C([]),x=C([]),e=C(!1),M=C(null),d=C([]),D=C([]),_=C(!1),k=C([]),z=C([]),I=C(!1),A=C([]),B=C([]),H=C(!1),Y=C([]),ae=C(!1),m=C([]),a=C([]),n=C(!1),r=C([]),i=C(!1),c=C([]),o=C(!1),g=Ke({pageNum:1,pageSize:200,activeFlag:"Y"}),p=st(),T=q(()=>{const l=new Date,K=5*60*1e3;return s.value.filter(P=>{const N=d.value.filter(se=>se.metricServerId===P.metricServerId).sort((se,me)=>new Date(me.collectTime).getTime()-new Date(se.collectTime).getTime())[0];if(!N)return!1;const X=new Date(N.collectTime);return l.getTime()-X.getTime()<=K}).length}),u=q(()=>s.value.length-T.value),v=q(()=>{if(d.value.length===0)return 0;const l=new Map;d.value.forEach(P=>{const N=l.get(P.metricServerId);(!N||new Date(P.collectTime)>new Date(N.collectTime))&&l.set(P.metricServerId,P)});const K=Array.from(l.values()).reduce((P,N)=>P+N.usagePercent,0);return Math.round(K/l.size*100)/100}),$=q(()=>{if(k.value.length===0)return 0;const l=new Map;k.value.forEach(P=>{const N=l.get(P.metricServerId);(!N||new Date(P.collectTime)>new Date(N.collectTime))&&l.set(P.metricServerId,P)});const K=Array.from(l.values()).reduce((P,N)=>P+N.usagePercent,0);return Math.round(K/l.size*100)/100}),L=q(()=>{if(A.value.length===0)return 0;const l=new Map;A.value.forEach(P=>{const N=l.get(P.metricServerId);(!N||new Date(P.collectTime)>new Date(N.collectTime))&&l.set(P.metricServerId,P)});const K=Array.from(l.values()).reduce((P,N)=>P+N.usagePercent,0);return Math.round(K/l.size*100)/100}),J=q(()=>{const l={online:0,offline:0,warning:0,critical:0},K=new Date,P=5*60*1e3,N=10*60*1e3;return s.value.forEach(X=>{const se=d.value.filter(ge=>ge.metricServerId===X.metricServerId).sort((ge,Ee)=>new Date(Ee.collectTime).getTime()-new Date(ge.collectTime).getTime())[0],me=k.value.filter(ge=>ge.metricServerId===X.metricServerId).sort((ge,Ee)=>new Date(Ee.collectTime).getTime()-new Date(ge.collectTime).getTime())[0];if(!se||!me){l.offline++;return}const ze=new Date(se.collectTime),qe=K.getTime()-ze.getTime();qe>N?l.offline++:qe>P?l.warning++:se.usagePercent>90||me.usagePercent>90?l.critical++:l.online++}),l});return{serverList:s,selectedServerIds:x,serverListLoading:e,currentServer:M,cpuMetrics:d,cpuTrendData:D,cpuLoading:_,memoryMetrics:k,memoryTrendData:z,memoryLoading:I,diskMetrics:A,diskTrendData:B,diskLoading:H,diskIOMetrics:Y,diskIOLoading:ae,networkMetrics:m,networkTrendData:a,networkLoading:n,processMetrics:r,processLoading:i,temperatureMetrics:c,temperatureLoading:o,queryParams:g,pagination:p,onlineServerCount:T,offlineServerCount:u,currentCpuUsage:v,currentMemoryUsage:$,currentDiskUsage:L,serverStatusDistribution:J,setServerList:l=>{s.value=l,Z.info("设置服务器列表数据",{count:l.length})},setCurrentServer:l=>{M.value=l,Z.info("设置当前服务器",{serverId:l==null?void 0:l.metricServerId})},upsertServerData:l=>{const K=s.value.findIndex(P=>P.metricServerId===l.metricServerId);K>=0?s.value[K]=l:s.value.push(l),Z.info("更新服务器数据",{serverId:l.metricServerId})},removeServerData:l=>{const K=s.value.findIndex(P=>P.metricServerId===l);K>=0&&s.value.splice(K,1),Z.info("删除服务器数据",{serverId:l})},setCpuMetrics:l=>{d.value=l,Z.info("设置CPU监控数据",{count:l.length})},setCpuTrendData:l=>{D.value=l,Z.info("设置CPU趋势数据",{count:l.length})},setMemoryMetrics:l=>{k.value=l,Z.info("设置内存监控数据",{count:l.length})},setMemoryTrendData:l=>{z.value=l,Z.info("设置内存趋势数据",{count:l.length})},setDiskMetrics:l=>{A.value=l,Z.info("设置磁盘监控数据",{count:l.length})},setDiskTrendData:l=>{B.value=l,Z.info("设置磁盘趋势数据",{count:l.length})},setDiskIOMetrics:l=>{Y.value=l,Z.info("设置磁盘IO指标数据",{count:l.length})},setNetworkMetrics:l=>{m.value=l,Z.info("设置网络监控数据",{count:l.length})},setNetworkTrendData:l=>{a.value=l,Z.info("设置网络趋势数据",{count:l.length})},setProcessMetrics:l=>{r.value=l,Z.info("设置进程监控数据",{count:l.length})},setTemperatureMetrics:l=>{c.value=l,Z.info("设置温度监控数据",{count:l.length})},clearAllMetrics:()=>{d.value=[],D.value=[],k.value=[],z.value=[],A.value=[],B.value=[],Y.value=[],m.value=[],a.value=[],r.value=[],c.value=[],Z.info("已清空所有监控数据")},updateQueryParams:l=>{Object.assign(g,l),Z.info("更新查询参数",l)},resetQueryParams:()=>{Object.assign(g,{pageNum:1,pageSize:20,activeFlag:"Y"}),Z.info("重置查询参数")},getServerStatus:l=>{const K=new Date,P=5*60*1e3,N=d.value.filter(me=>me.metricServerId===l).sort((me,ze)=>new Date(ze.collectTime).getTime()-new Date(me.collectTime).getTime())[0];if(!N)return Se.OFFLINE;const X=new Date(N.collectTime);return K.getTime()-X.getTime()>P?Se.OFFLINE:N.usagePercent>90?Se.CRITICAL:N.usagePercent>80?Se.WARNING:Se.ONLINE},getServerLatestMetrics:l=>{const K=d.value.filter(X=>X.metricServerId===l).sort((X,se)=>new Date(se.collectTime).getTime()-new Date(X.collectTime).getTime())[0],P=k.value.filter(X=>X.metricServerId===l).sort((X,se)=>new Date(se.collectTime).getTime()-new Date(X.collectTime).getTime())[0],N=A.value.filter(X=>X.metricServerId===l).sort((X,se)=>new Date(se.collectTime).getTime()-new Date(X.collectTime).getTime())[0];return{cpu:K,memory:P,disk:N}}}},de=je("/gateway/hub0000"),Ft=s=>de.post("/server/query",s),Gt=s=>de.post("/server/detail",s),Qt=s=>de.post("/cpu/query",s),Vt=s=>de.post("/memory/query",s),Wt=s=>de.post("/disk/partition/query",s),Kt=s=>de.post("/disk/io/query",s),jt=s=>de.post("/network/query",s),Jt=s=>de.post("/process/query",s),Xt=s=>de.post("/temperature/query",s),Zt=s=>de.post("/export",s),S=Ge("SystemMonitorManagement"),ea=s=>{const x=Qe(),e=C(!1),M=async m=>{try{s.serverListLoading.value=!0;const a={...s.queryParams,...m};S.info("开始加载服务器列表",a);const n=await Ft(a);if(ie(n)){const r=le(n,[]);return s.setServerList(r),x.success("服务器列表加载成功"),S.info("服务器列表加载成功",{count:r.length}),r}else{const r=ce(n,"加载服务器列表失败");return x.error(r),S.error("加载服务器列表失败",{error:r}),[]}}catch(a){const n="加载服务器列表异常";return x.error(n),S.error(n,a),[]}finally{s.serverListLoading.value=!1}},d=async m=>{try{e.value=!0,S.info("开始获取服务器详情",{serverId:m});const a=await Gt({metricServerId:m});if(ie(a)){const n=le(a);return S.info("获取服务器详情成功",{serverId:m}),n}else{const n=ce(a,"获取服务器详情失败");return x.error(n),S.error("获取服务器详情失败",{serverId:m,error:n}),null}}catch(a){const n="获取服务器详情异常";return x.error(n),S.error(n,{serverId:m,error:a}),null}finally{e.value=!1}},D=()=>s.serverList.value.length>0?s.serverList.value[0].metricServerId:"",_=async m=>{try{s.cpuLoading.value=!0,S.info("开始加载CPU监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await Qt(a);if(ie(n)){const r=le(n,[]);s.setCpuMetrics(r),S.info("CPU监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载CPU监控数据失败");S.error("加载CPU监控数据失败",{error:r})}}catch(a){S.error("加载CPU监控数据异常",a)}finally{s.cpuLoading.value=!1}},k=async m=>{try{s.memoryLoading.value=!0,S.info("开始加载内存监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await Vt(a);if(ie(n)){const r=le(n,[]);s.setMemoryMetrics(r),S.info("内存监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载内存监控数据失败");S.error("加载内存监控数据失败",{error:r})}}catch(a){S.error("加载内存监控数据异常",a)}finally{s.memoryLoading.value=!1}},z=async m=>{try{s.diskLoading.value=!0,S.info("开始加载磁盘监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await Wt(a);if(ie(n)){const r=le(n,[]);s.setDiskMetrics(r),S.info("磁盘监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载磁盘监控数据失败");S.error("加载磁盘监控数据失败",{error:r})}}catch(a){S.error("加载磁盘监控数据异常",a)}finally{s.diskLoading.value=!1}},I=async m=>{try{s.networkLoading.value=!0,S.info("开始加载网络监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await jt(a);if(ie(n)){const r=le(n,[]);s.setNetworkMetrics(r),S.info("网络监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载网络监控数据失败");S.error("加载网络监控数据失败",{error:r})}}catch(a){S.error("加载网络监控数据异常",a)}finally{s.networkLoading.value=!1}},A=async m=>{try{s.processLoading.value=!0,S.info("开始加载进程监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await Jt(a);if(ie(n)){const r=le(n,[]);s.setProcessMetrics(r),S.info("进程监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载进程监控数据失败");S.error("加载进程监控数据失败",{error:r})}}catch(a){S.error("加载进程监控数据异常",a)}finally{s.processLoading.value=!1}},B=async m=>{try{s.temperatureLoading.value=!0,S.info("开始加载温度监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await Xt(a);if(ie(n)){const r=le(n,[]);s.setTemperatureMetrics(r),S.info("温度监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载温度监控数据失败");S.error("加载温度监控数据失败",{error:r})}}catch(a){S.error("加载温度监控数据异常",a)}finally{s.temperatureLoading.value=!1}},H=async m=>{try{s.diskIOLoading.value=!0,S.info("开始加载磁盘IO监控数据",{serverId:m});const a={...m?{metricServerId:m}:{},...s.queryParams},n=await Kt(a);if(ie(n)){const r=le(n,[]);s.setDiskIOMetrics(r),S.info("磁盘IO监控数据加载成功",{count:r.length})}else{const r=ce(n,"加载磁盘IO监控数据失败");S.error("加载磁盘IO监控数据失败",{error:r})}}catch(a){S.error("加载磁盘IO监控数据异常",a)}finally{s.diskIOLoading.value=!1}};return{operationLoading:e,loadServerList:M,getServerInfo:d,getDefaultServerId:D,loadCPUMetrics:_,loadMemoryMetrics:k,loadDiskMetrics:z,loadDiskIOMetrics:H,loadNetworkMetrics:I,loadProcessMetrics:A,loadTemperatureMetrics:B,loadAllMetrics:async m=>{if(!m){S.warn("未提供服务器ID，无法加载监控数据");return}try{e.value=!0,S.info("开始加载所有监控数据",{serverId:m}),await Promise.all([_(m),k(m),z(m),H(m),I(m),A(m),B(m)]),S.info("所有监控数据加载成功")}catch(a){throw S.error("加载所有监控数据异常",a),a}finally{e.value=!1}},exportData:async m=>{try{e.value=!0,S.info("开始导出监控数据",m);const a=await Zt(m);if(ie(a)){const n=le(a);return x.success("数据导出成功"),S.info("数据导出成功",{downloadUrl:n}),n}else{const n=ce(a,"导出监控数据失败");return x.error(n),S.error("导出监控数据失败",{error:n}),null}}catch(a){const n="导出监控数据异常";return x.error(n),S.error(n,a),null}finally{e.value=!1}}}},ta={class:"system-monitoring"},aa={class:"server-selector"},ra={class:"selector-content"},sa={key:0,class:"overview-cards"},oa={class:"overview-grid"},na={class:"overview-item"},ia={class:"overview-icon hostname"},la={class:"overview-content"},ca={class:"overview-value text-truncate"},ua={class:"overview-item"},da={class:"overview-icon os"},ma={class:"overview-content"},ha={class:"overview-value text-truncate"},fa={class:"overview-item"},ga={class:"overview-icon version"},pa={class:"overview-content"},va={class:"overview-value text-truncate"},ya={class:"overview-item"},wa={class:"overview-icon architecture"},ba={class:"overview-content"},Ma={class:"overview-value text-truncate"},Da={class:"overview-item"},Ta={class:"overview-icon server-type"},_a={class:"overview-content"},Sa={class:"overview-value text-truncate"},ka={class:"overview-item"},$a={class:"overview-icon ip"},xa={class:"overview-content"},Ca={class:"overview-value text-truncate"},Ia={key:1,class:"loading-container"},La={key:2,class:"charts-container"},Pa={class:"chart-row"},Ra={class:"chart-item"},Aa={class:"chart-item"},Na={class:"chart-row"},Oa={class:"chart-item"},Ha={class:"chart-item"},Ya={class:"chart-row"},za={class:"chart-item"},Ea={class:"chart-item"},Ua={key:3,class:"no-data-container"},qa={key:4,class:"no-data-container"},Ba=pe({__name:"SystemMonitoring",setup(s){const x=Qe(),e=Bt(),M=ea(e),d=C(""),D=C(!0),_=q(()=>d.value&&e.serverList.value.find(h=>h.metricServerId===d.value)||null),k=h=>({physical:"物理机",virtual:"虚拟机",unknown:"未知"})[h||"unknown"]||"未知",z=h=>{const b=h.toLowerCase();return b.includes("windows")?tt:b.includes("linux")?Be:b.includes("mac")||b.includes("darwin")?at:Fe},I=h=>{if(!h)return"N/A";if(h.toLowerCase().includes("windows")){const b=h.match(/Windows (\d+(?:\.\d+)?)/i);if(b){const R=b[1],G=h.match(/Windows \d+(?:\.\d+)?\s+(\w+)/i);return G?`Windows ${R} ${G[1]}`:`Windows ${R}`}}return h.length>20?h.substring(0,17)+"...":h},A=q(()=>[...[{label:"全部服务器",value:""}],...e.serverList.value.map(b=>({label:`${b.hostname} (${b.ipAddress||"N/A"})`,value:b.metricServerId}))]),B=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadCPUMetrics(d.value)}},H=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadMemoryMetrics(d.value)}},Y=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadDiskMetrics(d.value)}},ae=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadNetworkMetrics(d.value)}},m=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadDiskIOMetrics(d.value)}},a=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadProcessMetrics(d.value)}};ue(()=>e.pagination.pagination.page,h=>{e.queryParams.pageNum=h,n()}),ue(()=>e.pagination.pagination.pageSize,h=>{e.queryParams.pageSize=h,n()}),ue(()=>({tenantId:e.queryParams.tenantId,hostname:e.queryParams.hostname,osType:e.queryParams.osType,serverType:e.queryParams.serverType,activeFlag:e.queryParams.activeFlag}),()=>{D.value||n()},{deep:!0});const n=async()=>{try{const h=await M.loadServerList();!d.value&&h.length>0&&(d.value=h[0].metricServerId,await r(h[0].metricServerId))}catch(h){console.error("加载服务器列表失败",h),x.error("加载服务器列表失败")}},r=async h=>{try{e.updateQueryParams({metricServerId:h,startTime:e.queryParams.startTime,endTime:e.queryParams.endTime}),await M.loadAllMetrics(h)}catch(b){console.error("加载服务器监控数据失败",b),x.error("加载服务器监控数据失败")}},i=async()=>{try{D.value=!0;const h=new Date,b=new Date(h.getTime()-3600*1e3);e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(h,"YYYY-MM-DD HH:mm:ss")}),await n()}catch(h){console.error("初始化数据失败",h),x.error("加载监控数据失败，请刷新页面重试")}finally{D.value=!1}},c=async h=>{if(h)try{W.value=!0,e.clearAllMetrics(),await r(h),x.success("服务器监控数据加载成功")}catch(b){console.error("加载服务器监控数据失败",b),x.error("加载服务器监控数据失败")}finally{W.value=!1}},o=async()=>{if(!d.value){x.warning("请先选择一个服务器");return}try{W.value=!0,await r(d.value),x.success("所有监控数据刷新成功")}catch(h){console.error("刷新监控数据失败",h),x.error("刷新监控数据失败")}finally{W.value=!1}},g=async()=>{await M.loadCPUMetrics(d.value),x.success("CPU数据刷新成功")},p=async()=>{await M.loadMemoryMetrics(d.value),x.success("内存数据刷新成功")},T=async()=>{await M.loadDiskMetrics(d.value),x.success("磁盘数据刷新成功")},u=async()=>{await M.loadNetworkMetrics(d.value),x.success("网络数据刷新成功")},v=async()=>{await M.loadDiskIOMetrics(d.value),x.success("磁盘IO数据刷新成功")},$=async()=>{await M.loadProcessMetrics(d.value),x.success("进程数据刷新成功")};ue(()=>e.serverList.value,h=>{h.length>0&&!d.value&&(d.value=h[0].metricServerId)}),ve(()=>{i()}),ye(()=>{console.log("SystemMonitoring组件已卸载")});const{serverListLoading:L,cpuLoading:J,memoryLoading:Q,diskLoading:F,diskIOLoading:U,networkLoading:re,processLoading:V}=e,{operationLoading:W}=M;return(h,b)=>(O(),j("div",ta,[y("div",aa,[f(t(fe),{title:"服务器选择",embedded:""},{default:w(()=>[y("div",ra,[f(t(ot),{value:d.value,"onUpdate:value":[b[0]||(b[0]=R=>d.value=R),c],options:A.value,placeholder:"选择服务器",loading:t(L),clearable:""},null,8,["value","options","loading"]),f(t(Me),{onClick:o,loading:t(W)},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[b[1]||(b[1]=oe(" 刷新数据 "))]),_:1},8,["loading"])])]),_:1})]),_.value?(O(),j("div",sa,[f(t(fe),{title:"服务器信息",embedded:""},{default:w(()=>[y("div",oa,[y("div",na,[y("div",ia,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Xe))]),_:1})]),y("div",la,[b[2]||(b[2]=y("div",{class:"overview-label"},"主机名",-1)),f(t(_e),{"show-arrow":!1},{trigger:w(()=>[y("div",ca,ee(_.value.hostname),1)]),default:w(()=>[oe(" "+ee(_.value.hostname),1)]),_:1})])]),y("div",ua,[y("div",da,[f(t(ne),{size:"24"},{default:w(()=>[(O(),we(Je(z(_.value.osType))))]),_:1})]),y("div",ma,[b[3]||(b[3]=y("div",{class:"overview-label"},"操作系统",-1)),f(t(_e),{"show-arrow":!1},{trigger:w(()=>[y("div",ha,ee(_.value.osType),1)]),default:w(()=>[oe(" "+ee(_.value.osType),1)]),_:1})])]),y("div",fa,[y("div",ga,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Be))]),_:1})]),y("div",pa,[b[4]||(b[4]=y("div",{class:"overview-label"},"系统版本",-1)),f(t(_e),{"show-arrow":!1},{trigger:w(()=>[y("div",va,ee(I(_.value.osVersion)),1)]),default:w(()=>[oe(" "+ee(_.value.osVersion),1)]),_:1})])]),y("div",ya,[y("div",wa,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Fe))]),_:1})]),y("div",ba,[b[5]||(b[5]=y("div",{class:"overview-label"},"系统架构",-1)),f(t(_e),{"show-arrow":!1},{trigger:w(()=>[y("div",Ma,ee(_.value.architecture),1)]),default:w(()=>[oe(" "+ee(_.value.architecture),1)]),_:1})])]),y("div",Da,[y("div",Ta,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Ze))]),_:1})]),y("div",_a,[b[6]||(b[6]=y("div",{class:"overview-label"},"服务器类型",-1)),f(t(_e),{"show-arrow":!1},{trigger:w(()=>[y("div",Sa,ee(k(_.value.serverType)),1)]),default:w(()=>[oe(" "+ee(k(_.value.serverType)),1)]),_:1})])]),y("div",ka,[y("div",$a,[f(t(ne),{size:"24"},{default:w(()=>[f(t(et))]),_:1})]),y("div",xa,[b[7]||(b[7]=y("div",{class:"overview-label"},"IP地址",-1)),f(t(_e),{"show-arrow":!1},{trigger:w(()=>[y("div",Ca,ee(_.value.ipAddress||"N/A"),1)]),default:w(()=>[oe(" "+ee(_.value.ipAddress||"N/A"),1)]),_:1})])])])]),_:1})])):te("",!0),D.value?(O(),j("div",Ia,[f(t(be),{size:"large"}),b[8]||(b[8]=y("p",null,"正在加载服务器监控数据，请稍候...",-1))])):te("",!0),!D.value&&d.value?(O(),j("div",La,[y("div",Pa,[y("div",Ra,[f(t(dt),{data:t(e).cpuMetrics.value,loading:t(J),"warning-threshold":80,"danger-threshold":90,"cpu-detail-data":t(e).cpuMetrics.value,onRefresh:g,onTimeRangeChange:B},null,8,["data","loading","cpu-detail-data"])]),y("div",Aa,[f(t(vt),{data:t(e).memoryMetrics.value,loading:t(Q),"warning-threshold":80,"danger-threshold":90,"memory-detail-data":t(e).memoryMetrics.value,onRefresh:p,onTimeRangeChange:H},null,8,["data","loading","memory-detail-data"])])]),y("div",Na,[y("div",Oa,[f(t(Tt),{data:t(e).diskMetrics.value,loading:t(F),"warning-threshold":80,"danger-threshold":90,"disk-detail-data":t(e).diskMetrics.value,onRefresh:T,onTimeRangeChange:Y},null,8,["data","loading","disk-detail-data"])]),y("div",Ha,[f(t(It),{data:t(e).diskIOMetrics.value,loading:t(U),"disk-io-detail-data":t(e).diskIOMetrics.value,onRefresh:v,onTimeRangeChange:m},null,8,["data","loading","disk-io-detail-data"])])]),y("div",Ya,[y("div",za,[f(t(Ot),{data:t(e).networkMetrics.value,loading:t(re),"network-detail-data":t(e).networkMetrics.value,"upload-color":"#ff4d4f","download-color":"#52c41a",onRefresh:u,onTimeRangeChange:ae},null,8,["data","loading","network-detail-data"])]),y("div",Ea,[f(t(qt),{data:t(e).processMetrics.value,loading:t(V),"process-detail-data":t(e).processMetrics.value,onRefresh:$,onTimeRangeChange:a},null,8,["data","loading","process-detail-data"])])])])):te("",!0),!D.value&&!d.value&&t(e).serverList.value.length>0?(O(),j("div",Ua,[f(t(he),{description:"请选择一个服务器查看监控数据"})])):te("",!0),!D.value&&t(e).serverList.value.length===0?(O(),j("div",qa,[f(t(he),{description:"暂无可用的服务器"})])):te("",!0)]))}}),dr=De(Ba,[["__scopeId","data-v-733bd8b9"]]);export{dr as default};

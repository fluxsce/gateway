import{d as ae,c as $,o as R,ad as it,a as c,ag as Y,a3 as Oe,ac as V,W as L,di as he,I as pe,a7 as Le,r as I,g as me,$ as ut,b as Re,a0 as ge,a1 as ke,a2 as ve,Z as dt,cD as ct,R as Ee,q as B,w as t,al as pt,m as e,t as H,V as Se,a8 as mt,a9 as ft,J as y,x as v,n as i,U as He,H as $e,_ as ze,f as xe,T as Ue,O as gt,h as Ae,v as Ge,d7 as qe,Y as Fe,ao as _e,E as Be,cz as je,M as vt,A as _t,B as yt,cU as Ne,aa as ht}from"./index-CzIbiPcR.js";import{u as wt}from"./usePagination-rBGSs64l.js";import{N as bt,_ as Tt}from"./DataTable-CMD0QL_W.js";import{N as Ct}from"./Code-C9OmRaPm.js";import"./index-5BFifUcw.js";import{i as de}from"./installCanvasRenderer-BddeS-3K.js";import{C as kt}from"./CheckmarkCircleOutline-DaZKMTJF.js";import{C as xt}from"./CloseCircleOutline-Dzm8Wp_s.js";import{T as ye}from"./TimeOutline-e6ea6nIg.js";import{R as Me}from"./RefreshOutline-CA3Zk8OZ.js";import{P as Mt}from"./PieChartOutline-Co3d5RCR.js";import{_ as Ve,a as We}from"./Grid-DtPWGMN9.js";import{_ as Rt}from"./Statistic-BLv2tZo5.js";import{N as Je}from"./DatePicker-B9xNNxDH.js";import{_ as Ke}from"./RadioGroup-BBKwhzSS.js";import{I as Ye}from"./InformationCircleOutline-DB_x5CQ_.js";import{R as St}from"./ReloadOutline-Btqzp1-L.js";import{C as zt}from"./ChevronUpOutline-BNduPpW9.js";import{C as Dt}from"./ChevronDownOutline-DbTRakv4.js";import{D as Pt}from"./DownloadOutline-BMa0jTqz.js";import{_ as It}from"./Alert-B2DIZRvN.js";import{_ as Ot}from"./FormItemGridItem-B8BBWZsl.js";import{N as qt}from"./InputNumber-DYqA-vrb.js";import{N as Nt}from"./Switch-DmPX386B.js";import"./index-C9U1NGvg.js";const Yt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Lt=ae({name:"CalendarOutline",render:function(l,n){return R(),$("svg",Yt,n[0]||(n[0]=[it('<rect fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" x="48" y="80" width="416" height="384" rx="48"></rect><circle cx="296" cy="232" r="24" fill="currentColor"></circle><circle cx="376" cy="232" r="24" fill="currentColor"></circle><circle cx="296" cy="312" r="24" fill="currentColor"></circle><circle cx="376" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="312" r="24" fill="currentColor"></circle><circle cx="216" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="392" r="24" fill="currentColor"></circle><circle cx="216" cy="392" r="24" fill="currentColor"></circle><circle cx="296" cy="392" r="24" fill="currentColor"></circle><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" stroke-linecap="round" d="M128 48v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" stroke-linecap="round" d="M384 48v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M464 160H48"></path>',13)]))}}),Et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ht=ae({name:"FlameOutline",render:function(l,n){return R(),$("svg",Et,n[0]||(n[0]=[c("path",{d:"M112 320c0-93 124-165 96-272c66 0 192 96 192 272a144 144 0 0 1-288 0z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),c("path",{d:"M320 368c0 57.71-32 80-64 80s-64-22.29-64-80s40-86 32-128c42 0 96 70.29 96 128z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),$t={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ut=ae({name:"StatsChartOutline",render:function(l,n){return R(),$("svg",$t,n[0]||(n[0]=[c("rect",{x:"64",y:"320",width:"48",height:"160",rx:"8",ry:"8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),c("rect",{x:"288",y:"224",width:"48",height:"256",rx:"8",ry:"8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),c("rect",{x:"400",y:"112",width:"48",height:"368",rx:"8",ry:"8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),c("rect",{x:"176",y:"32",width:"48",height:"448",rx:"8",ry:"8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),At={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Gt=ae({name:"TrendingUpOutline",render:function(l,n){return R(),$("svg",At,n[0]||(n[0]=[c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M352 144h112v112"},null,-1),c("path",{d:"M48 368l121.37-121.37a32 32 0 0 1 45.26 0l50.74 50.74a32 32 0 0 0 45.26 0L448 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Ft=p=>[{type:"selection",disabled:l=>l.resetFlag==="Y"},{title:"链路追踪ID",key:"traceId",width:140,ellipsis:{tooltip:!0},render:l=>Y(Oe,{trigger:"hover"},{trigger:()=>Y("span",{class:"text-primary cursor-pointer"},l.traceId.slice(-8)),default:()=>l.traceId})},{title:"网关实例",key:"gatewayInstanceName",width:120,ellipsis:{tooltip:!0},render:l=>l.gatewayInstanceName||l.gatewayInstanceId},{title:"请求方法",key:"requestMethod",width:80,render:l=>Y(V,{size:"small",type:{GET:"success",POST:"info",PUT:"warning",DELETE:"error",PATCH:"default",HEAD:"default",OPTIONS:"default"}[l.requestMethod]||"default"},()=>l.requestMethod)},{title:"请求路径",key:"requestPath",width:200,ellipsis:{tooltip:!0}},{title:"客户端IP",key:"clientIpAddress",width:160},{title:"状态码",key:"gatewayStatusCode",width:80,render:l=>{const n=l.gatewayStatusCode;let m="default";return n>=200&&n<300?m="success":n>=300&&n<400?m="warning":n>=400&&(m="error"),Y(V,{size:"small",type:m},()=>n.toString())}},{title:"后端状态码",key:"backendStatusCode",width:100,render:l=>{if(l.backendStatusCode==null)return"-";const n=l.backendStatusCode;let m="default";return n>=200&&n<300?m="success":n>=300&&n<400?m="warning":n>=400&&(m="error"),Y(V,{size:"small",type:m},()=>n.toString())}},{title:"开始时间",key:"gatewayStartProcessingTime",width:200,render:l=>L(l.gatewayStartProcessingTime,"YYYY-MM-DD HH:mm:ss.SSS")},{title:"总处理时间",key:"totalProcessingTimeMs",width:110,render:l=>{if(l.totalProcessingTimeMs==null)return"-";const n=l.totalProcessingTimeMs;let m="default";return n>5e3?m="error":n>1e3?m="warning":m="success",Y(V,{size:"small",type:m},()=>`${n}ms`)}},{title:"网关耗时",key:"gatewayProcessingTimeMs",width:100,render:l=>{if(l.gatewayProcessingTimeMs==null)return"-";const n=l.gatewayProcessingTimeMs;let m="default";return n>2e3?m="error":n>500?m="warning":m="success",Y(V,{size:"small",type:m},()=>`${n}ms`)}},{title:"后端耗时",key:"backendResponseTimeMs",width:100,render:l=>{if(l.backendResponseTimeMs==null)return"-";const n=l.backendResponseTimeMs;let m="default";return n>3e3?m="error":n>1e3?m="warning":m="success",Y(V,{size:"small",type:m},()=>`${n}ms`)}},{title:"完成时间",key:"gatewayFinishedProcessingTime",width:200,render:l=>l.gatewayFinishedProcessingTime?L(l.gatewayFinishedProcessingTime,"YYYY-MM-DD HH:mm:ss.SSS"):"-"},{title:"处理状态",key:"processingStatus",width:100,render:l=>{const n=!!l.gatewayFinishedProcessingTime;return l.errorMessage?Y(V,{size:"small",type:"error"},()=>"异常"):n?Y(V,{size:"small",type:"success"},()=>"已完成"):Y(V,{size:"small",type:"warning"},()=>"处理中")}},{title:"路由名称",key:"routeName",width:120,ellipsis:{tooltip:!0},render:l=>l.routeName||l.matchedRoute||"-"},{title:"服务名称",key:"serviceName",width:120,ellipsis:{tooltip:!0},render:l=>l.serviceName||"-"},{title:"代理类型",key:"proxyType",width:100,render:l=>l.proxyType?Y(V,{size:"small",type:{http:"info",websocket:"warning",tcp:"success",udp:"error"}[l.proxyType]||"default"},()=>l.proxyType.toUpperCase()):"-"},{title:"重置状态",key:"resetFlag",width:100,render:l=>Y(V,{size:"small",type:l.resetFlag==="Y"?"warning":"default"},()=>l.resetFlag==="Y"?"已重置":"未重置")},{title:"用户标识",key:"userIdentifier",width:120,ellipsis:{tooltip:!0},render:l=>l.userIdentifier||"-"},{title:"请求大小",key:"requestSize",width:100,render:l=>l.requestSize==null?"-":he(l.requestSize)},{title:"响应大小",key:"responseSize",width:100,render:l=>l.responseSize==null?"-":he(l.responseSize)},{title:"重置次数",key:"resetCount",width:100,render:l=>l.resetCount!=null?l.resetCount:"-"},{title:"错误信息",key:"errorMessage",width:150,ellipsis:{tooltip:!0},render:l=>l.errorMessage?Y(Oe,{trigger:"hover"},{trigger:()=>Y("span",{class:"text-error"},"查看错误"),default:()=>l.errorMessage}):"-"},{title:"日志级别",key:"logLevel",width:100,render:l=>Y(V,{size:"small",type:{DEBUG:"default",INFO:"info",WARN:"warning",ERROR:"error"}[l.logLevel]||"default"},()=>l.logLevel)},{title:"操作",key:"actions",width:160,fixed:"right",render:l=>Y(Le,{size:"small"},()=>[Y(pe,{size:"small",type:"primary",ghost:!0,onClick:()=>p.onView(l)},()=>"查看详情"),Y(pe,{size:"small",type:"warning",ghost:!0,disabled:l.resetFlag==="Y",onClick:()=>p.onReset(l)},()=>"重发")])}],Bt=()=>{const p=I(!1),l=I(!1),n=I([]),m=I([]),h=I([]);let a=null;const M=wt({onPageChange:async(S,E)=>{a&&await a({pageIndex:S,pageSize:E})},onPageSizeChange:async(S,E)=>{a&&await a({pageIndex:S,pageSize:E})}}),D=me(()=>({...M.queryParams.value,sortField:"gatewayStartProcessingTime",sortOrder:"DESC"})),x=me(()=>m.value.length>0&&m.value.some(S=>S.resetFlag==="N")),g=S=>{a=S},b=S=>{p.value=S},T=S=>{l.value=S},C=S=>{n.value=S||[]},q=()=>{m.value=[],h.value=[]},O=S=>{m.value=S,h.value=S.map(E=>E.traceId)},F=()=>{M.resetPagination(),q()},j=()=>{q()},w=S=>Ft(S);return{loading:p,searchLoading:l,dataSource:n,selectedRows:m,selectedRowKeys:h,queryParams:D,pagination:M.pagination,paginationConfig:M.naiveConfig,updatePagination:M.updatePagination,resetPagination:M.resetPagination,setTotal:M.setTotal,goToPage:M.goToPage,canBatchReset:x,setLoading:b,setSearchLoading:T,setDataSource:C,clearSelection:q,setSelectedRows:O,createTableColumns:w,setDataLoadCallback:g,resetSearch:F,refreshData:j}},oe=ut("/gateway/hub0023"),jt=async p=>oe.post("/gateway-log/query",p),Vt=async p=>oe.post("/gateway-log/get",p),Wt=async p=>oe.post("/gateway-log/reset",p),Jt=async p=>oe.post("/gateway-log/export",p),Kt=async p=>oe.post("/gateway-log/monitoring/overview",p),Qt=async p=>oe.post("/gateway-log/monitoring/chart-data",p),ce=dt("GatewayLogManagement"),re=(p,l)=>(ce.error(`${l}异常`,p),`${l}异常，请稍后重试`),Xt=p=>{const l=Re(),n=async x=>{try{p.setLoading(!0);const g={...p.queryParams.value,...x},b=await jt(g);if(ge(b)){const T=ke(b,[]);p.setDataSource(T);try{const C=ct(b);C&&Object.keys(C).length>0&&p.updatePagination(C)}catch(C){ce.warn("分页信息解析失败:",C)}}else{const T=ve(b,"查询网关日志列表失败");ce.error("查询网关日志列表失败",T),l.error(T),p.setDataSource([])}}catch(g){const b=re(g,"查询网关日志列表");l.error(b),p.setDataSource([])}finally{p.setLoading(!1)}};return{loadGatewayLogs:n,getGatewayLogDetail:async(x,g)=>{try{const T=await Vt({traceId:x,tenantId:g});if(ge(T)){const C=ke(T);return ce.info("成功获取网关日志详情"),C}else{const C=ve(T,"获取网关日志详情失败");return l.error(C),null}}catch(b){const T=re(b,"获取网关日志详情");return l.error(T),null}},resetGatewayLogsBatch:async(x,g="手动重置",b="current_user")=>{try{if(x.length===0)return l.warning("请选择要重置的日志"),!1;const T=x.filter(O=>O.resetFlag==="N");if(T.length===0)return l.warning("所选日志都已重置，无需再次重置"),!1;const C={tenantId:T[0].tenantId,traceIds:T.map(O=>O.traceId),resetReason:g,operatorId:b},q=await Wt(C);if(ge(q)){const O=T.length;return l.success(`成功重置 ${O} 条网关日志`),ce.info(`成功重置网关日志，共 ${O} 条`),p.clearSelection(),await n(),!0}else{const O=ve(q,"重置网关日志失败");return l.error(O),!1}}catch(T){const C=re(T,"重置网关日志");return l.error(C),!1}},exportGatewayLogList:async x=>{try{const g={...p.queryParams.value,...x},b=await Jt(g);if(ge(b)){const T=ke(b),C=document.createElement("a");C.href=T,C.download=`网关日志_${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.xlsx`,document.body.appendChild(C),C.click(),document.body.removeChild(C),l.success("网关日志导出成功")}else{const T=ve(b,"导出网关日志失败");l.error(T)}}catch(g){const b=re(g,"导出网关日志");l.error(b)}},searchGatewayLogs:async x=>{try{p.setSearchLoading(!0),await n({...x,pageIndex:1})}catch(g){const b=re(g,"搜索网关日志");l.error(b)}finally{p.setSearchLoading(!1)}},resetSearchAndRefresh:async()=>{try{p.resetSearch(),await n()}catch(x){const g=re(x,"重置搜索");l.error(g)}}}},Zt={key:0,class:"log-detail-container"},ea={class:"error-message"},ta={class:"note-text"},aa=ae({__name:"GatewayLogDetailDialog",props:{visible:{type:Boolean,default:!1},traceId:{default:""},tenantId:{default:""},getDetailMethod:{type:Function,default:void 0}},emits:["update:visible"],setup(p,{emit:l}){const n=p,m=l,h=I(!1),a=I(null),M=me(()=>a.value?`网关日志详情 - ${a.value.traceId}`:"网关日志详情"),D=me({get(){return n.visible},set(s){m("update:visible",s)}});Ee(()=>n.visible,s=>{s&&n.traceId&&n.tenantId&&x()},{immediate:!0});const x=async()=>{if(!(!n.traceId||!n.tenantId||!n.getDetailMethod))try{h.value=!0,a.value=await n.getDetailMethod(n.traceId,n.tenantId)}finally{h.value=!1}},g=s=>{if(typeof s=="string")try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}return JSON.stringify(s,null,2)},b=s=>({ERROR:"error",WARN:"warning",INFO:"info",DEBUG:"success"})[s]||"default",T=s=>({ERROR:"错误",WARN:"警告",INFO:"信息",DEBUG:"调试"})[s]||s,C=s=>({ACCESS:"info",ERROR:"error",SYSTEM:"warning"})[s]||"default",q=s=>({ACCESS:"访问日志",ERROR:"错误日志",SYSTEM:"系统日志"})[s]||s,O=s=>({GET:"info",POST:"success",PUT:"warning",DELETE:"error",PATCH:"default",HEAD:"default",OPTIONS:"default"})[s]||"default",F=s=>s>=200&&s<300?"success":s>=300&&s<400?"warning":s>=400&&s<500||s>=500?"error":"default",j=s=>s<100?"success":s<500?"warning":"error",w=s=>({http:"info",websocket:"warning",tcp:"success",udp:"error"})[s]||"default",S=s=>({http:"HTTP",websocket:"WebSocket",tcp:"TCP",udp:"UDP"})[s]||s,E=()=>{D.value=!1},_=()=>{a.value=null};return(s,r)=>{const P=pe,d=V,o=ft,U=mt,z=Se,G=bt,W=Ct,J=He,ie=$e,se=pt;return R(),B(se,{show:D.value,"onUpdate:show":r[0]||(r[0]=le=>D.value=le),preset:"dialog",title:M.value,style:{width:"90%",maxWidth:"1200px"},"show-icon":!1,"mask-closable":!0,"on-after-leave":_},{action:t(()=>[e(P,{size:"small",onClick:E},{default:t(()=>r[1]||(r[1]=[y("关闭")])),_:1})]),default:t(()=>[e(ie,{show:h.value},{default:t(()=>[a.value?(R(),$("div",Zt,[e(z,{title:"基本信息",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:3,size:"small",bordered:""},{default:t(()=>[e(o,{label:"链路追踪ID"},{default:t(()=>[e(d,{type:"info",size:"small"},{default:t(()=>[y(v(a.value.traceId),1)]),_:1})]),_:1}),e(o,{label:"网关实例ID"},{default:t(()=>[e(d,{type:"success",size:"small"},{default:t(()=>[y(v(a.value.gatewayInstanceId),1)]),_:1})]),_:1}),e(o,{label:"租户ID"},{default:t(()=>[e(d,{type:"warning",size:"small"},{default:t(()=>[y(v(a.value.tenantId),1)]),_:1})]),_:1}),e(o,{label:"日志级别"},{default:t(()=>[e(d,{type:b(a.value.logLevel),size:"small"},{default:t(()=>[y(v(T(a.value.logLevel)),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"日志类型"},{default:t(()=>[e(d,{type:C(a.value.logType),size:"small"},{default:t(()=>[y(v(q(a.value.logType)),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"记录时间"},{default:t(()=>[c("span",null,v(i(L)(a.value.addTime)),1)]),_:1})]),_:1})]),_:1}),e(z,{title:"请求信息",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:2,size:"small",bordered:""},{default:t(()=>[e(o,{label:"请求方法"},{default:t(()=>[e(d,{type:O(a.value.requestMethod),size:"small"},{default:t(()=>[y(v(a.value.requestMethod),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"请求路径"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.requestPath),1)]),_:1})]),_:1}),e(o,{label:"请求查询参数"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.requestQuery||"无"),1)]),_:1})]),_:1}),e(o,{label:"客户端IP"},{default:t(()=>[e(d,{type:"info",size:"small"},{default:t(()=>[y(v(a.value.clientIpAddress),1)]),_:1})]),_:1}),e(o,{label:"请求大小"},{default:t(()=>[e(d,{type:"info",size:"small"},{default:t(()=>[y(v(i(he)(a.value.requestSize||0)),1)]),_:1})]),_:1}),e(o,{label:"客户端端口"},{default:t(()=>[c("span",null,v(a.value.clientPort||"无"),1)]),_:1}),e(o,{label:"User-Agent"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.userAgent||"无"),1)]),_:1})]),_:1}),e(o,{label:"Referer"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.referer||"无"),1)]),_:1})]),_:1}),e(o,{label:"用户标识"},{default:t(()=>[c("span",null,v(a.value.userIdentifier||"无"),1)]),_:1}),e(o,{label:"父链路追踪ID"},{default:t(()=>[c("span",null,v(a.value.parentTraceId||"无"),1)]),_:1})]),_:1})]),_:1}),e(z,{title:"响应信息",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:3,size:"small",bordered:""},{default:t(()=>[e(o,{label:"网关状态码"},{default:t(()=>[e(d,{type:F(a.value.gatewayStatusCode),size:"small"},{default:t(()=>[y(v(a.value.gatewayStatusCode),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"后端状态码"},{default:t(()=>[e(d,{type:F(a.value.backendStatusCode||0),size:"small"},{default:t(()=>[y(v(a.value.backendStatusCode||"无"),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"总处理时间"},{default:t(()=>[e(d,{type:j(a.value.totalProcessingTimeMs||0),size:"small"},{default:t(()=>[y(v(a.value.totalProcessingTimeMs||0)+"ms ",1)]),_:1},8,["type"])]),_:1}),e(o,{label:"网关处理时间"},{default:t(()=>[e(d,{type:j(a.value.gatewayProcessingTimeMs||0),size:"small"},{default:t(()=>[y(v(a.value.gatewayProcessingTimeMs||0)+"ms ",1)]),_:1},8,["type"])]),_:1}),e(o,{label:"后端响应时间"},{default:t(()=>[e(d,{type:j(a.value.backendResponseTimeMs||0),size:"small"},{default:t(()=>[y(v(a.value.backendResponseTimeMs||0)+"ms ",1)]),_:1},8,["type"])]),_:1}),e(o,{label:"响应大小"},{default:t(()=>[e(d,{type:"info",size:"small"},{default:t(()=>[y(v(i(he)(a.value.responseSize||0)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{title:"时间跟踪",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:2,size:"small",bordered:""},{default:t(()=>[e(o,{label:"网关开始处理"},{default:t(()=>[c("span",null,v(i(L)(a.value.gatewayStartProcessingTime,"YYYY-MM-DD HH:mm:ss.SSS")),1)]),_:1}),e(o,{label:"网关完成处理"},{default:t(()=>[c("span",null,v(a.value.gatewayFinishedProcessingTime?i(L)(a.value.gatewayFinishedProcessingTime,"YYYY-MM-DD HH:mm:ss.SSS"):"未完成"),1)]),_:1}),e(o,{label:"后端请求开始"},{default:t(()=>[c("span",null,v(a.value.backendRequestStartTime?i(L)(a.value.backendRequestStartTime,"YYYY-MM-DD HH:mm:ss.SSS"):"无"),1)]),_:1}),e(o,{label:"后端响应接收"},{default:t(()=>[c("span",null,v(a.value.backendResponseReceivedTime?i(L)(a.value.backendResponseReceivedTime,"YYYY-MM-DD HH:mm:ss.SSS"):"无"),1)]),_:1}),e(o,{label:"重试次数"},{default:t(()=>[e(d,{type:"warning",size:"small"},{default:t(()=>[y(v(a.value.retryCount||0),1)]),_:1})]),_:1}),e(o,{label:"重置次数"},{default:t(()=>[e(d,{type:"error",size:"small"},{default:t(()=>[y(v(a.value.resetCount||0),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{title:"转发信息",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:2,size:"small",bordered:""},{default:t(()=>[e(o,{label:"代理类型"},{default:t(()=>[e(d,{type:w(a.value.proxyType||"http"),size:"small"},{default:t(()=>[y(v(S(a.value.proxyType||"http")),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"匹配路由"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.matchedRoute||"无"),1)]),_:1})]),_:1}),e(o,{label:"路由名称"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.routeName||"无"),1)]),_:1})]),_:1}),e(o,{label:"目标服务"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.serviceName||"无"),1)]),_:1})]),_:1}),e(o,{label:"转发地址"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.forwardAddress||"无"),1)]),_:1})]),_:1}),e(o,{label:"转发方法"},{default:t(()=>[e(d,{type:O(a.value.forwardMethod||a.value.requestMethod),size:"small"},{default:t(()=>[y(v(a.value.forwardMethod||a.value.requestMethod),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"网关节点IP"},{default:t(()=>[e(d,{type:"info",size:"small"},{default:t(()=>[y(v(a.value.gatewayNodeIp||"无"),1)]),_:1})]),_:1}),e(o,{label:"负载均衡决策"},{default:t(()=>[e(G,{"line-clamp":2},{default:t(()=>[y(v(a.value.loadBalancerDecision||"无"),1)]),_:1})]),_:1})]),_:1})]),_:1}),a.value.errorCode||a.value.errorMessage?(R(),B(z,{key:0,title:"错误信息",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:1,size:"small",bordered:""},{default:t(()=>[a.value.errorCode?(R(),B(o,{key:0,label:"错误码"},{default:t(()=>[e(d,{type:"error",size:"small"},{default:t(()=>[y(v(a.value.errorCode),1)]),_:1})]),_:1})):H("",!0),a.value.errorMessage?(R(),B(o,{key:1,label:"错误消息"},{default:t(()=>[c("div",ea,v(a.value.errorMessage),1)]),_:1})):H("",!0)]),_:1})]),_:1})):H("",!0),e(z,{title:"重置状态信息",size:"small",class:"detail-card"},{default:t(()=>[e(U,{column:3,size:"small",bordered:""},{default:t(()=>[e(o,{label:"重置标记"},{default:t(()=>[e(d,{type:a.value.resetFlag==="Y"?"warning":"success",size:"small"},{default:t(()=>[y(v(a.value.resetFlag==="Y"?"已重置":"正常"),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"活动状态"},{default:t(()=>[e(d,{type:a.value.activeFlag==="Y"?"success":"error",size:"small"},{default:t(()=>[y(v(a.value.activeFlag==="Y"?"活动":"非活动"),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"当前版本"},{default:t(()=>[e(d,{type:"info",size:"small"},{default:t(()=>[y("v"+v(a.value.currentVersion),1)]),_:1})]),_:1}),e(o,{label:"创建人"},{default:t(()=>[c("span",null,v(a.value.addWho),1)]),_:1}),e(o,{label:"最后修改人"},{default:t(()=>[c("span",null,v(a.value.editWho),1)]),_:1}),e(o,{label:"最后修改时间"},{default:t(()=>[c("span",null,v(i(L)(a.value.editTime,"YYYY-MM-DD HH:mm:ss.SSS")),1)]),_:1}),a.value.noteText?(R(),B(o,{key:0,label:"备注信息",span:3},{default:t(()=>[c("div",ta,v(a.value.noteText),1)]),_:1})):H("",!0)]),_:1})]),_:1}),a.value.requestHeaders?(R(),B(z,{key:1,title:"请求头",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.requestHeaders),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.requestBody?(R(),B(z,{key:2,title:"请求体",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.requestBody),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.responseHeaders?(R(),B(z,{key:3,title:"响应头",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.responseHeaders),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.responseBody?(R(),B(z,{key:4,title:"响应体",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.responseBody),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.forwardParams?(R(),B(z,{key:5,title:"转发参数",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.forwardParams),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.forwardHeaders?(R(),B(z,{key:6,title:"转发头信息",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.forwardHeaders),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.forwardBody?(R(),B(z,{key:7,title:"转发体",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.forwardBody),language:"json"},null,8,["code"])]),_:1})):H("",!0),a.value.extProperty?(R(),B(z,{key:8,title:"扩展信息",size:"small",class:"detail-card"},{default:t(()=>[e(W,{code:g(a.value.extProperty),language:"json"},null,8,["code"])]),_:1})):H("",!0)])):(R(),B(J,{key:1,description:"暂无数据"}))]),_:1},8,["show"])]),_:1},8,["show","title"])}}}),sa=ze(aa,[["__scopeId","data-v-932e8ec4"]]);var Z=(p=>(p.MINUTE="MINUTE",p.HOUR="HOUR",p.DAY="DAY",p))(Z||{});function la(){const p=Re(),l=I(!1),n=I(null),m=I(Z.MINUTE),h=I(""),a=I(""),M=xe({totalRequests:0,successRequests:0,failedRequests:0,requestsPerSecond:0,avgResponseTimeMs:0,minResponseTimeMs:0,maxResponseTimeMs:0}),D=xe({requestTrend:[],responseTimeTrend:[],statusCodeDistribution:[],hotRoutes:[]}),x={最近1小时:()=>{const w=Date.now();return[w-36e5,w]},最近6小时:()=>{const w=Date.now();return[w-216e5,w]},最近12小时:()=>{const w=Date.now();return[w-432e5,w]},最近24小时:()=>{const w=Date.now();return[w-864e5,w]}},g=[{label:"按分钟",value:Z.MINUTE,description:"以分钟为单位展示监控数据"},{label:"按小时",value:Z.HOUR,description:"以小时为单位展示监控数据"},{label:"按天",value:Z.DAY,description:"以天为单位展示监控数据"}],b=()=>{switch(m.value){case Z.MINUTE:return"按分钟";case Z.HOUR:return"按小时";case Z.DAY:return"按天";default:return"按分钟"}},T=w=>{if(!w||w.length!==2)return p.error("请选择时间范围"),!1;const S=w[0],_=w[1]-S,s=24*60*60*1e3;return _>s?(p.error("时间范围不能超过24小时，请重新选择"),!1):_<=0?(p.error("结束时间必须大于开始时间"),!1):!0},C=async()=>{if(T(n.value)){l.value=!0;try{const[w,S]=n.value,E={startTime:L(w,"YYYY-MM-DDTHH:mm:ss"),endTime:L(S,"YYYY-MM-DDTHH:mm:ss"),timeGranularity:m.value,...h.value&&{routeName:h.value},...a.value&&{requestPath:a.value}},[_,s]=await Promise.all([Kt(E),Qt(E)]);if(_.oK&&_.bizData){const r=JSON.parse(_.bizData);Object.assign(M,r)}else console.warn("概览数据获取失败:",_);if(s.oK&&s.bizData){const r=JSON.parse(s.bizData);Object.assign(D,r)}else console.warn("图表数据获取失败:",s);p.success("监控数据加载成功")}catch(w){console.error("加载监控数据失败:",w),p.error("加载监控数据失败，请检查网络连接或联系管理员")}finally{l.value=!1}}},q=async()=>{await C()};return{loading:l,timeRange:n,timeGranularity:m,overviewData:M,chartData:D,routeName:h,requestPath:a,timeRangeShortcuts:x,timeGranularityOptions:g,getTimeGranularityLabel:b,validateTimeRange:T,loadMonitoringData:C,refreshMonitoringData:q,handleTimeRangeChange:w=>{n.value=w,w&&T(w)&&q()},handleTimeGranularityChange:w=>{m.value=w,n.value&&T(n.value)&&q()},initTimeRange:()=>{const w=Date.now();n.value=[w-36e5,w]}}}function na(){const p=I(),l=I(),n=I(),m=I(),h=I();let a=null,M=null,D=null,x=null,g=null;const b=_=>{const s={success:["#52c41a","#73d13d","#95de64","#b7eb8f","#d9f7be","#389e0d","#237804"],redirect:["#fa8c16","#ffa940","#ffc069","#ffd591","#ffe7ba","#d46b08","#ad4e00"],clientError:["#faad14","#ffc53d","#ffd666","#ffe58f","#fff1b8","#d48806","#ad6800"],serverError:["#ff4d4f","#ff7875","#ffa39e","#ffccc7","#ffe1e1","#f5222d","#cf1322"],other:["#d9d9d9","#bfbfbf","#8c8c8c","#595959","#434343","#262626","#1f1f1f"]},r={200:s.success[0],201:s.success[1],202:s.success[2],204:s.success[3],206:s.success[4],301:s.redirect[0],302:s.redirect[1],304:s.redirect[2],307:s.redirect[3],308:s.redirect[4],400:s.clientError[0],401:s.clientError[1],403:s.clientError[2],404:s.clientError[3],405:s.clientError[4],409:s.clientError[5],429:s.clientError[6],500:s.serverError[0],501:s.serverError[1],502:s.serverError[2],503:s.serverError[3],504:s.serverError[4],505:s.serverError[5]};if(r[_])return r[_];const P=parseInt(_);let d,o=0;return P>=200&&P<300?(d=s.success,o=(P-200)%d.length):P>=300&&P<400?(d=s.redirect,o=(P-300)%d.length):P>=400&&P<500?(d=s.clientError,o=(P-400)%d.length):P>=500&&P<600?(d=s.serverError,o=(P-500)%d.length):(d=s.other,o=P%d.length),d[o]},T=_=>_<=1?"#52c41a":_<=5?"#faad14":_<=10?"#fa8c16":"#ff4d4f",C=_=>{p.value&&(a=de(p.value),a.setOption({tooltip:{trigger:"axis"},xAxis:{type:"time",axisLabel:{formatter:function(s){return L(s,"HH:mm")}}},yAxis:{type:"value",name:"请求数"},grid:{top:40,bottom:60,left:80,right:40},series:[{name:"总请求数",type:"line",data:_.requestTrend.map(s=>[s.timestamp,s.totalRequests]),smooth:!0,areaStyle:{opacity:.3},itemStyle:{color:"#18a058"}}]}))},q=_=>{l.value&&(M=de(l.value),M.setOption({tooltip:{trigger:"axis",formatter:function(s){let r=`<div style="padding: 8px;"><strong>${L(s[0].axisValue,"MM-DD HH:mm")}</strong><br/>`;const P=_.responseTimeTrend.find(d=>d.timestamp===s[0].axisValue);return P&&(r+=`请求数量: ${P.requestCount}<br/>`),s.forEach(d=>{r+=`${d.seriesName}: ${d.value[1]}ms<br/>`}),r+="</div>",r}},xAxis:{type:"time",axisLabel:{formatter:function(s){return L(s,"HH:mm")}}},yAxis:{type:"value",name:"毫秒"},legend:{top:0,type:"scroll",orient:"horizontal",itemGap:20},grid:{top:60,bottom:60,left:80,right:40},series:[{name:"平均响应时间",type:"line",data:_.responseTimeTrend.map(s=>[s.timestamp,s.avgResponseTimeMs]),smooth:!0,itemStyle:{color:"#5470c6"}},{name:"P50响应时间",type:"line",data:_.responseTimeTrend.map(s=>[s.timestamp,s.p50ResponseTimeMs]),smooth:!0,itemStyle:{color:"#91cc75"}},{name:"P90响应时间",type:"line",data:_.responseTimeTrend.map(s=>[s.timestamp,s.p90ResponseTimeMs]),smooth:!0,itemStyle:{color:"#fac858"}},{name:"P99响应时间",type:"line",data:_.responseTimeTrend.map(s=>[s.timestamp,s.p99ResponseTimeMs]),smooth:!0,itemStyle:{color:"#ee6666"}},{name:"最大响应时间",type:"line",data:_.responseTimeTrend.map(s=>[s.timestamp,s.maxResponseTimeMs]),smooth:!0,itemStyle:{color:"#73c0de"},lineStyle:{type:"dashed"}}]}))},O=_=>{n.value&&(D=de(n.value),D.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",top:"center"},series:[{name:"请求指标",type:"pie",data:[{name:"成功请求",value:_.successRequests,itemStyle:{color:"#52c41a"}},{name:"失败请求",value:_.failedRequests,itemStyle:{color:"#ff4d4f"}}],radius:["40%","70%"],center:["65%","50%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!0,formatter:"{b}: {d}%"}}]}))},F=_=>{m.value&&(x=de(m.value),x.setOption({tooltip:{trigger:"item",formatter:function(s){const r=_.statusCodeDistribution.find(P=>P.statusCode===s.name);return r?`
                                <div style="padding: 8px;">
                                    <div><strong>${r.statusCode}</strong></div>
                                    <div>分类: ${r.category||"未分类"}</div>
                                    <div>描述: ${r.description||"无描述"}</div>
                                    <div>数量: ${r.count}</div>
                                    <div>百分比: ${r.percentage.toFixed(2)}%</div>
                                </div>
                            `:`${s.name}: ${s.value} (${s.percent}%)`}},legend:{orient:"vertical",left:"left",top:"center"},series:[{name:"状态码",type:"pie",data:_.statusCodeDistribution.map(s=>({name:s.statusCode,value:s.count,itemStyle:{color:b(s.statusCode)}})),radius:["40%","70%"],center:["65%","50%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!0,formatter:"{b}: {d}%"}}]}))},j=_=>{h.value&&(g=de(h.value),g.setOption({tooltip:{trigger:"axis",formatter:function(s){const r=_.hotRoutes.find(P=>P.routePath===s[0].name);return r?`
                                <div style="padding: 8px;">
                                    <div><strong>${r.routePath}</strong></div>
                                    <div>请求数量: ${r.requestCount}</div>
                                    <div>最大响应时间: ${r.maxResponseTimeMs||"N/A"}ms</div>
                                    <div>最小响应时间: ${r.minResponseTimeMs||"N/A"}ms</div>
                                    <div>错误率: ${r.errorRate}%</div>
                                    <div>QPS: ${r.qps}</div>
                                    <div>服务名称: ${r.serviceName||"N/A"}</div>
                                </div>
                            `:""}},xAxis:{type:"value",name:"请求数"},yAxis:{type:"category",data:_.hotRoutes.map(s=>s.routePath),axisLabel:{formatter:function(s){return s.length>20?s.substring(0,20)+"...":s}}},grid:{top:40,bottom:60,left:140,right:80},series:[{name:"请求量",type:"bar",data:_.hotRoutes.map(s=>s.requestCount),itemStyle:{color:"#5470c6"},barMaxWidth:40}]}))},w=async(_,s)=>{await gt(),s.requestTrend.length>0&&C(s),s.responseTimeTrend.length>0&&q(s),_.totalRequests>0&&O(_),s.statusCodeDistribution.length>0&&F(s),s.hotRoutes.length>0&&j(s)},S=(_,s)=>{s.requestTrend.length>0?a?a.setOption({xAxis:{type:"time",axisLabel:{formatter:function(r){return L(r,"HH:mm")}}},series:[{data:s.requestTrend.map(r=>[r.timestamp,r.totalRequests]),itemStyle:{color:"#18a058"}}]}):C(s):a&&(a.dispose(),a=null),s.responseTimeTrend.length>0?M?M.setOption({xAxis:{type:"time",axisLabel:{formatter:function(r){return L(r,"HH:mm")}}},legend:{top:0,type:"scroll",orient:"horizontal",itemGap:20},series:[{data:s.responseTimeTrend.map(r=>[r.timestamp,r.avgResponseTimeMs])},{data:s.responseTimeTrend.map(r=>[r.timestamp,r.p50ResponseTimeMs])},{data:s.responseTimeTrend.map(r=>[r.timestamp,r.p90ResponseTimeMs])},{data:s.responseTimeTrend.map(r=>[r.timestamp,r.p99ResponseTimeMs])},{data:s.responseTimeTrend.map(r=>[r.timestamp,r.maxResponseTimeMs])}]}):q(s):M&&(M.dispose(),M=null),_.totalRequests>0?D?D.setOption({legend:{orient:"vertical",left:"left",top:"center"},series:[{data:[{name:"成功请求",value:_.successRequests,itemStyle:{color:"#52c41a"}},{name:"失败请求",value:_.failedRequests,itemStyle:{color:"#ff4d4f"}}],center:["65%","50%"]}]}):O(_):D&&(D.dispose(),D=null),s.statusCodeDistribution.length>0?x?x.setOption({legend:{orient:"vertical",left:"left",top:"center"},series:[{data:s.statusCodeDistribution.map(r=>({name:r.statusCode,value:r.count,itemStyle:{color:b(r.statusCode)}})),center:["65%","50%"]}]}):F(s):x&&(x.dispose(),x=null),s.hotRoutes.length>0?g?g.setOption({yAxis:{data:s.hotRoutes.map(r=>r.routePath),axisLabel:{formatter:function(r){return r.length>20?r.substring(0,20)+"...":r}}},series:[{data:s.hotRoutes.map(r=>({value:r.requestCount,itemStyle:{color:T(r.errorRate)}}))}]}):j(s):g&&(g.dispose(),g=null)},E=()=>{a&&(a.dispose(),a=null),M&&(M.dispose(),M=null),D&&(D.dispose(),D=null),x&&(x.dispose(),x=null),g&&(g.dispose(),g=null)};return Ue(()=>{E()}),{requestTrendChartRef:p,responseTimeChartRef:l,requestMetricsChartRef:n,statusCodeChartRef:m,hotRoutesChartRef:h,initCharts:w,updateCharts:S,destroyCharts:E}}const ra={class:"gateway-log-monitoring-panel"},oa={class:"overview-header"},ia={class:"overview-content"},ua={class:"time-range-header"},da={class:"time-range-content"},ca={class:"chart-header"},pa={key:0,class:"chart-loading"},ma={key:1,class:"chart-empty"},fa={class:"chart-header"},ga={key:0,class:"chart-loading"},va={key:1,class:"chart-empty"},_a={class:"chart-header"},ya={key:0,class:"chart-loading"},ha={key:1,class:"chart-empty"},wa={class:"chart-header"},ba={key:0,class:"chart-loading"},Ta={key:1,class:"chart-empty"},Ca={class:"chart-header"},ka={key:0,class:"chart-loading"},xa={key:1,class:"chart-empty"},Ma=ae({__name:"GatewayLogMonitoringPanel",setup(p){const{loading:l,timeRange:n,timeGranularity:m,overviewData:h,chartData:a,routeName:M,requestPath:D,timeRangeShortcuts:x,timeGranularityOptions:g,getTimeGranularityLabel:b,refreshMonitoringData:T,handleTimeRangeChange:C,handleTimeGranularityChange:q,initTimeRange:O,loadMonitoringData:F}=la(),{requestTrendChartRef:j,responseTimeChartRef:w,requestMetricsChartRef:S,statusCodeChartRef:E,hotRoutesChartRef:_,initCharts:s,updateCharts:r}=na();return Ee([h,a],()=>{r(h,a)},{deep:!0}),Ae(async()=>{O(),await s(h,a),n.value&&await F()}),(P,d)=>{const o=Ge,U=Rt,z=We,G=Ve,W=Fe,J=Se,ie=Je,se=Ke,le=Be,we=pe,ue=Le,be=je,ee=$e,Q=He;return R(),$("div",ra,[e(J,{class:"overview-card",size:"small"},{header:t(()=>[c("div",oa,[e(o,{size:"18",color:"#18a058"},{default:t(()=>[e(i(Ut))]),_:1}),d[4]||(d[4]=c("span",null,"监控概览",-1))])]),default:t(()=>[c("div",ia,[e(G,{cols:3,"x-gap":24,"y-gap":16},{default:t(()=>[e(z,null,{default:t(()=>[e(U,{label:"总请求数",value:i(h).totalRequests},{prefix:t(()=>[e(o,{color:"#18a058"},{default:t(()=>[e(i(qe))]),_:1})]),_:1},8,["value"])]),_:1}),e(z,null,{default:t(()=>[e(U,{label:"成功请求数",value:i(h).successRequests},{prefix:t(()=>[e(o,{color:"#18a058"},{default:t(()=>[e(i(kt))]),_:1})]),_:1},8,["value"])]),_:1}),e(z,null,{default:t(()=>[e(U,{label:"失败请求数",value:i(h).failedRequests},{prefix:t(()=>[e(o,{color:"#d03050"},{default:t(()=>[e(i(xt))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(W,{style:{margin:"20px 0"}}),e(G,{cols:3,"x-gap":24},{default:t(()=>[e(z,null,{default:t(()=>[e(U,{label:"平均响应时间",value:i(h).avgResponseTimeMs,suffix:"ms"},{prefix:t(()=>[e(o,{color:"#2080f0"},{default:t(()=>[e(i(ye))]),_:1})]),_:1},8,["value"])]),_:1}),e(z,null,{default:t(()=>[e(U,{label:"最小响应时间",value:i(h).minResponseTimeMs,suffix:"ms"},{prefix:t(()=>[e(o,{color:"#52c41a"},{default:t(()=>[e(i(ye))]),_:1})]),_:1},8,["value"])]),_:1}),e(z,null,{default:t(()=>[e(U,{label:"最大响应时间",value:i(h).maxResponseTimeMs,suffix:"ms"},{prefix:t(()=>[e(o,{color:"#ff4d4f"},{default:t(()=>[e(i(ye))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])]),_:1}),e(J,{class:"time-range-card",size:"small"},{header:t(()=>[c("div",ua,[e(o,{size:"18",color:"#2080f0"},{default:t(()=>[e(i(Lt))]),_:1}),d[5]||(d[5]=c("span",null,"时间范围",-1))])]),default:t(()=>[c("div",da,[e(ue,{size:"large",align:"center",wrap:""},{default:t(()=>[e(ie,{value:i(n),"onUpdate:value":[d[0]||(d[0]=K=>_e(n)?n.value=K:null),i(C)],type:"datetimerange",shortcuts:i(x),placeholder:"选择时间范围（必填，不超过24小时）",style:{"min-width":"300px"}},null,8,["value","onUpdate:value","shortcuts"]),e(se,{value:i(m),"onUpdate:value":[d[1]||(d[1]=K=>_e(m)?m.value=K:null),i(q)],options:i(g),placeholder:"选择时间粒度",style:{width:"140px"}},null,8,["value","options","onUpdate:value"]),e(le,{value:i(M),"onUpdate:value":d[2]||(d[2]=K=>_e(M)?M.value=K:null),placeholder:"路由名称",clearable:"",style:{width:"180px"}},null,8,["value"]),e(le,{value:i(D),"onUpdate:value":d[3]||(d[3]=K=>_e(D)?D.value=K:null),placeholder:"请求路径",clearable:"",style:{width:"180px"}},null,8,["value"]),e(we,{type:"primary",onClick:i(T),loading:i(l),size:"medium"},{icon:t(()=>[e(o,{component:i(Me)},null,8,["component"])]),default:t(()=>[d[6]||(d[6]=y(" 刷新数据 "))]),_:1},8,["onClick","loading"])]),_:1}),e(be,{depth:"3",style:{"font-size":"12px","margin-top":"12px",display:"block"}},{default:t(()=>d[7]||(d[7]=[y(" * 时间范围为必填项，最大支持24小时范围查询。路由名称和请求路径为可选筛选条件，可进一步精确查询结果 ")])),_:1})])]),_:1}),e(G,{cols:2,"x-gap":20,"y-gap":20},{default:t(()=>[e(z,null,{default:t(()=>[e(J,{class:"chart-card",size:"small"},{header:t(()=>[c("div",ca,[e(o,{size:"18",color:"#18a058"},{default:t(()=>[e(i(Gt))]),_:1}),c("span",null,"请求量趋势("+v(i(b)())+")",1)])]),default:t(()=>[c("div",{class:"chart-container",ref_key:"requestTrendChartRef",ref:j},[i(l)?(R(),$("div",pa,[e(ee,{size:"large"})])):i(a).requestTrend.length?H("",!0):(R(),$("div",ma,[e(Q,{description:"暂无数据"})]))],512)]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(J,{class:"chart-card",size:"small"},{header:t(()=>[c("div",fa,[e(o,{size:"18",color:"#2080f0"},{default:t(()=>[e(i(ye))]),_:1}),c("span",null,"响应时间趋势("+v(i(b)())+")",1)])]),default:t(()=>[c("div",{class:"chart-container",ref_key:"responseTimeChartRef",ref:w},[i(l)?(R(),$("div",ga,[e(ee,{size:"large"})])):i(a).responseTimeTrend.length?H("",!0):(R(),$("div",va,[e(Q,{description:"暂无数据"})]))],512)]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(J,{class:"chart-card",size:"small"},{header:t(()=>[c("div",_a,[e(o,{size:"18",color:"#f0a020"},{default:t(()=>[e(i(Mt))]),_:1}),d[8]||(d[8]=c("span",null,"请求指标分布",-1))])]),default:t(()=>[c("div",{class:"chart-container",ref_key:"requestMetricsChartRef",ref:S},[i(l)?(R(),$("div",ya,[e(ee,{size:"large"})])):i(h).totalRequests===0?(R(),$("div",ha,[e(Q,{description:"暂无数据"})])):H("",!0)],512)]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(J,{class:"chart-card",size:"small"},{header:t(()=>[c("div",wa,[e(o,{size:"18",color:"#8a2be2"},{default:t(()=>[e(i(qe))]),_:1}),d[9]||(d[9]=c("span",null,"状态码分布",-1))])]),default:t(()=>[c("div",{class:"chart-container",ref_key:"statusCodeChartRef",ref:E},[i(l)?(R(),$("div",ba,[e(ee,{size:"large"})])):i(a).statusCodeDistribution.length?H("",!0):(R(),$("div",Ta,[e(Q,{description:"暂无数据"})]))],512)]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(J,{class:"chart-card",size:"small"},{header:t(()=>[c("div",Ca,[e(o,{size:"18",color:"#d03050"},{default:t(()=>[e(i(Ht))]),_:1}),d[10]||(d[10]=c("span",null,"热点路由TOP10",-1))])]),default:t(()=>[c("div",{class:"chart-container",ref_key:"hotRoutesChartRef",ref:_},[i(l)?(R(),$("div",ka,[e(ee,{size:"large"})])):i(a).hotRoutes.length?H("",!0):(R(),$("div",xa,[e(Q,{description:"暂无数据"})]))],512)]),_:1})]),_:1})]),_:1})])}}}),Ra=ze(Ma,[["__scopeId","data-v-1ef3388d"]]),Sa={class:"gateway-log-management"},za={class:"tab-content"},Da={class:"tab-description"},Pa={class:"info-content"},Ia={class:"search-header"},Oa={class:"search-content"},qa={class:"inline-actions"},Na={class:"toolbar-content"},Ya={class:"toolbar-left"},La={class:"tab-content"},Ea={class:"tab-description"},Ha={class:"info-content"},$a=ae({__name:"GatewayLogManagement",setup(p){const l=Re(),n=I("logs"),m=I(!1),h=I(null),a=xe({traceId:"",gatewayInstanceName:"",requestPath:"",clientIpAddress:"",requestMethod:void 0,routeName:"",serviceName:"",proxyType:void 0,gatewayStatusCode:void 0,backendStatusCode:void 0,resetFlag:void 0,userIdentifier:"",errorOnly:!1,minProcessingTime:void 0}),M=I(!1),D=I(""),x=I("");let g=null;const b=Bt(),T=Xt(b),{loading:C,searchLoading:q,dataSource:O,selectedRows:F,selectedRowKeys:j,paginationConfig:w,queryParams:S,canBatchReset:E,setSelectedRows:_,setDataLoadCallback:s}=b,{loadGatewayLogs:r,getGatewayLogDetail:P,resetGatewayLogsBatch:d,exportGatewayLogList:o,searchGatewayLogs:U,resetSearchAndRefresh:z}=T,G=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"HEAD",value:"HEAD"},{label:"OPTIONS",value:"OPTIONS"}],W=[{label:"HTTP",value:"http"},{label:"WebSocket",value:"websocket"},{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],J=[{label:"未重置",value:"N"},{label:"已重置",value:"Y"}],ie={今天:()=>{const f=new Date,u=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),N=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59);return[u.getTime(),N.getTime()]},昨天:()=>{const f=new Date;f.setDate(f.getDate()-1);const u=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),N=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59);return[u.getTime(),N.getTime()]},最近1小时:()=>{const f=Date.now();return[f-36e5,f]},最近6小时:()=>{const f=Date.now();return[f-216e5,f]},最近24小时:()=>{const f=Date.now();return[f-864e5,f]},最近7天:()=>{const f=Date.now();return[f-6048e5,f]}},se={onView:f=>{D.value=f.traceId,x.value=f.tenantId,M.value=!0},onReset:async f=>{await d([f],"手动重置","current_user")&&l.success("日志重置成功")},onBatchReset:async f=>{await d(f,"批量重置","current_user")&&l.success(`成功重置 ${f.length} 条日志`)},onExport:async f=>{await o(f)}},le=me(()=>b.createTableColumns(se)),we=()=>{m.value=!m.value},ue=()=>{const f=new Date,u=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),N=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59);h.value=[u.getTime(),N.getTime()],De(h.value)},be=async()=>{if(!h.value){l.error("请选择时间范围");return}const f={...a,startTime:L(h.value[0],"YYYY-MM-DDTHH:mm:ss"),endTime:L(h.value[1],"YYYY-MM-DDTHH:mm:ss")};await U(f)},ee=async()=>{a.traceId="",a.gatewayInstanceName="",a.requestPath="",a.clientIpAddress="",a.requestMethod=void 0,a.routeName="",a.serviceName="",a.proxyType=void 0,a.gatewayStatusCode=void 0,a.backendStatusCode=void 0,a.resetFlag=void 0,a.userIdentifier="",a.errorOnly=!1,a.minProcessingTime=void 0,ue(),await z()},Q=async()=>{h.value||ue(),b.refreshData(),await Pe()},K=async()=>{if(F.value.length===0){l.warning("请选择要重置的日志");return}await se.onBatchReset(F.value)},Qe=async()=>{await o(S.value)},De=f=>{h.value=f},Xe=f=>{const u=f.map(X=>String(X)),N=O.value.filter(X=>u.includes(X.traceId));_(N)},Pe=async(f={})=>{if(g!=null&&g.signal.aborted)return;const u={...a,...f};if(h.value){const[N,X]=h.value;u.startTime=L(N,"YYYY-MM-DDTHH:mm:ss"),u.endTime=L(X,"YYYY-MM-DDTHH:mm:ss")}await r(u)};return Ae(()=>{g=new AbortController,s(Pe),ue(),Q()}),Ue(()=>{g&&(g.abort(),g=null),s(null),b.clearSelection(),b.setDataSource([])}),(f,u)=>{const N=Ge,X=It,Ze=Je,A=Ot,te=Be,Te=qt,ne=pe,et=je,tt=Fe,at=We,Ce=Ke,st=Nt,lt=Ve,nt=yt,fe=Se,rt=Tt,Ie=_t,ot=vt;return R(),$("div",Sa,[e(fe,{class:"main-content"},{default:t(()=>[e(ot,{type:"segment",size:"large",value:n.value,"onUpdate:value":u[15]||(u[15]=k=>n.value=k)},{default:t(()=>[e(Ie,{name:"logs",tab:"日志查询"},{default:t(()=>[c("div",za,[c("div",Da,[e(X,{type:"info","show-icon":!1},{default:t(()=>[c("div",Pa,[e(N,{size:"16",color:"#2080f0"},{default:t(()=>[e(i(Ye))]),_:1}),u[17]||(u[17]=c("span",null,"查询和管理网关日志，支持按时间范围、状态码、IP地址等多种条件筛选",-1))])]),_:1})]),e(fe,{class:"search-card",size:"small"},{header:t(()=>[c("div",Ia,[e(N,{size:"18",color:"#18a058"},{default:t(()=>[e(i(Ne))]),_:1}),u[18]||(u[18]=c("span",null,"查询条件",-1))])]),default:t(()=>[c("div",Oa,[e(nt,{model:a,"label-width":80},{default:t(()=>[e(lt,{cols:24,"x-gap":8,"y-gap":8},{default:t(()=>[e(A,{span:10,label:"时间范围",required:""},{default:t(()=>[e(Ze,{value:h.value,"onUpdate:value":[u[0]||(u[0]=k=>h.value=k),De],type:"datetimerange",shortcuts:ie,placeholder:"请选择时间范围",style:{width:"100%"}},null,8,["value"])]),_:1}),e(A,{span:6,label:"实例名称"},{default:t(()=>[e(te,{value:a.gatewayInstanceName,"onUpdate:value":u[1]||(u[1]=k=>a.gatewayInstanceName=k),placeholder:"实例名称",clearable:""},null,8,["value"])]),_:1}),e(A,{span:8,label:"路由名称"},{default:t(()=>[e(te,{value:a.routeName,"onUpdate:value":u[2]||(u[2]=k=>a.routeName=k),placeholder:"路由名称",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"服务名称"},{default:t(()=>[e(te,{value:a.serviceName,"onUpdate:value":u[3]||(u[3]=k=>a.serviceName=k),placeholder:"服务名称",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"网关耗时"},{default:t(()=>[e(Te,{value:a.minProcessingTime,"onUpdate:value":u[4]||(u[4]=k=>a.minProcessingTime=k),min:0,placeholder:"最小耗时(毫秒)",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(A,{span:12},{default:t(()=>[c("div",qa,[e(ne,{type:"primary",onClick:be,loading:i(q),size:"medium"},{icon:t(()=>[e(N,{component:i(Ne)},null,8,["component"])]),default:t(()=>[u[19]||(u[19]=y(" 查询 "))]),_:1},8,["loading"]),e(ne,{onClick:ee,size:"medium"},{icon:t(()=>[e(N,{component:i(Me)},null,8,["component"])]),default:t(()=>[u[20]||(u[20]=y(" 重置 "))]),_:1}),e(ne,{onClick:Q,size:"medium"},{icon:t(()=>[e(N,{component:i(St)},null,8,["component"])]),default:t(()=>[u[21]||(u[21]=y(" 刷新 "))]),_:1}),e(ne,{text:"",onClick:we,size:"medium"},{icon:t(()=>[e(N,{component:m.value?i(zt):i(Dt)},null,8,["component"])]),default:t(()=>[y(" "+v(m.value?"收起":"更多"),1)]),_:1})])]),_:1}),m.value?(R(),$(ht,{key:0},[e(at,{span:24},{default:t(()=>[e(tt,{dashed:"",style:{margin:"8px 0"}},{default:t(()=>[e(et,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>u[22]||(u[22]=[y("高级查询条件")])),_:1})]),_:1})]),_:1}),e(A,{span:6,label:"链路追踪ID"},{default:t(()=>[e(te,{value:a.traceId,"onUpdate:value":u[5]||(u[5]=k=>a.traceId=k),placeholder:"链路追踪ID",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"请求路径"},{default:t(()=>[e(te,{value:a.requestPath,"onUpdate:value":u[6]||(u[6]=k=>a.requestPath=k),placeholder:"请求路径",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"客户端IP"},{default:t(()=>[e(te,{value:a.clientIpAddress,"onUpdate:value":u[7]||(u[7]=k=>a.clientIpAddress=k),placeholder:"客户端IP",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"请求方法"},{default:t(()=>[e(Ce,{value:a.requestMethod,"onUpdate:value":u[8]||(u[8]=k=>a.requestMethod=k),options:G,placeholder:"请求方法",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"代理类型"},{default:t(()=>[e(Ce,{value:a.proxyType,"onUpdate:value":u[9]||(u[9]=k=>a.proxyType=k),options:W,placeholder:"代理类型",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"状态码"},{default:t(()=>[e(Te,{value:a.gatewayStatusCode,"onUpdate:value":u[10]||(u[10]=k=>a.gatewayStatusCode=k),min:100,max:599,placeholder:"状态码",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(A,{span:6,label:"后端状态码"},{default:t(()=>[e(Te,{value:a.backendStatusCode,"onUpdate:value":u[11]||(u[11]=k=>a.backendStatusCode=k),min:100,max:599,placeholder:"后端状态码",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(A,{span:6,label:"重置状态"},{default:t(()=>[e(Ce,{value:a.resetFlag,"onUpdate:value":u[12]||(u[12]=k=>a.resetFlag=k),options:J,placeholder:"重置状态",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"用户标识"},{default:t(()=>[e(te,{value:a.userIdentifier,"onUpdate:value":u[13]||(u[13]=k=>a.userIdentifier=k),placeholder:"用户标识",clearable:""},null,8,["value"])]),_:1}),e(A,{span:6,label:"只显示错误"},{default:t(()=>[e(st,{value:a.errorOnly,"onUpdate:value":u[14]||(u[14]=k=>a.errorOnly=k)},{checked:t(()=>u[23]||(u[23]=[y("显示错误")])),unchecked:t(()=>u[24]||(u[24]=[y("全部日志")])),_:1},8,["value"])]),_:1})],64)):H("",!0)]),_:1})]),_:1},8,["model"])])]),_:1}),e(fe,{class:"toolbar-card",size:"small"},{default:t(()=>[c("div",Na,[c("div",Ya,[e(ne,{type:"error",disabled:!i(E),onClick:K,loading:i(C)},{icon:t(()=>[e(N,{component:i(Me)},null,8,["component"])]),default:t(()=>[y(" 批量重发 ("+v(i(F).length)+") ",1)]),_:1},8,["disabled","loading"]),e(ne,{onClick:Qe,loading:i(C)},{icon:t(()=>[e(N,{component:i(Pt)},null,8,["component"])]),default:t(()=>[u[25]||(u[25]=y(" 导出日志 "))]),_:1},8,["loading"])])])]),_:1}),e(fe,{class:"table-card",size:"small"},{default:t(()=>[e(rt,{columns:le.value,data:i(O)||[],loading:i(C),pagination:i(w),"row-key":k=>k.traceId,"checked-row-keys":i(j),"onUpdate:checkedRowKeys":Xe,"scroll-x":3200,size:"small",remote:""},null,8,["columns","data","loading","pagination","row-key","checked-row-keys"])]),_:1})])]),_:1}),e(Ie,{name:"monitoring",tab:"监控图表"},{default:t(()=>[c("div",La,[c("div",Ea,[e(X,{type:"info","show-icon":!1},{default:t(()=>[c("div",Ha,[e(N,{size:"16",color:"#2080f0"},{default:t(()=>[e(i(Ye))]),_:1}),u[26]||(u[26]=c("span",null,"实时监控网关日志数据，展示请求量趋势、响应时间分布、状态码统计等关键指标",-1))])]),_:1})]),e(Ra)])]),_:1})]),_:1},8,["value"])]),_:1}),e(sa,{visible:M.value,"onUpdate:visible":u[16]||(u[16]=k=>M.value=k),"trace-id":D.value,"tenant-id":x.value,"get-detail-method":i(P)},null,8,["visible","trace-id","tenant-id","get-detail-method"])])}}}),ps=ze($a,[["__scopeId","data-v-bceda6a6"]]);export{ps as default};

import{s as ne,h as ie,g as de,i as ce,j as pe,k as me,l as fe,S as ve,m as ge}from"./index-Dv94Dnvh.js";import{d as H,c as ee,o as _,a as V,b as le,cT as ye,f as re,r as x,g as z,R as J,q as R,w as r,n as e,m as l,t as $,C as i,E as T,cz as P,J as m,x as Q,B as ae,I as k,a7 as G,al as be,a0 as he,a2 as Te,_ as se,h as Ce,v as U,cU as Ne,V as j,cY as xe,cZ as ke,ag as b,ac as Oe,a3 as K,cQ as Z}from"./index-x2UIW6rt.js";import{_ as D,a as W,b as F}from"./RadioGroup-DcXP1pnc.js";import{N as X}from"./InputNumber-D_OTG2Un.js";import{R as Ue}from"./RefreshOutline-ClIKSIMl.js";import{A as _e}from"./AddOutline-CGjDgn0r.js";import{S as Me}from"./SyncOutline-BLKSydne.js";import{R as Se}from"./ReloadOutline-DeaP78U7.js";import{T as Re}from"./TrashOutline-BVFrNGkO.js";import{_ as we}from"./DataTable-BPEIkg8T.js";import{N as Ee}from"./Tree-CCov9_TI.js";import"./Popconfirm-bPhIDBu0.js";const Ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Pe=H({name:"AddCircleOutline",render:function(p,d){return _(),ee("svg",Ie,d[0]||(d[0]=[V("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),V("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 176v160"},null,-1),V("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 256H176"},null,-1)]))}});function Ae(){const v=le(),p=ye(),d=re({resourceName:"",resourceCode:"",resourceType:void 0,moduleCode:"",resourceStatus:void 0}),w=x([]),M=x([]),g=x(!1),C=x(!0),O=async()=>{try{g.value=!0;const n=await ce(d);if(n.oK&&n.bizData){const c=Array.isArray(n.bizData)?n.bizData:JSON.parse(n.bizData);w.value=c.list||c}else v.error(n.errMsg||"获取权限资源列表失败")}catch(n){console.error("加载权限资源列表失败:",n),v.error("获取权限资源列表失败")}finally{g.value=!1}},s=async()=>{try{g.value=!0;const n=await de();if(n.oK&&n.bizData){const c=Array.isArray(n.bizData)?n.bizData:JSON.parse(n.bizData);M.value=c}else v.error(n.errMsg||"获取权限资源树失败")}catch(n){console.error("加载权限资源树失败:",n),v.error("获取权限资源树失败")}finally{g.value=!1}},N=()=>{C.value?s():O()};return{queryParams:d,resourceList:w,resourceTreeData:M,loading:g,isTreeView:C,loadResourceList:O,loadResourceTree:s,handleSearch:N,resetQuery:()=>{Object.assign(d,{resourceName:"",resourceCode:"",resourceType:void 0,moduleCode:"",resourceStatus:void 0}),N()},handleRefresh:()=>{N()},toggleTreeView:()=>{C.value=!C.value,N()},handleDelete:n=>{p.warning({title:"确认删除",content:`确定要删除资源"${n.resourceName}"吗？此操作不可恢复。`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const c=await ie(n.resourceId);c.oK?(v.success("删除成功"),N()):v.error(c.errMsg||"删除失败")}catch(c){console.error("删除资源失败:",c),v.error("删除失败")}}})},handleSync:()=>{p.info({title:"同步模块资源",content:"确定要同步模块权限资源吗？此操作会自动扫描系统模块并创建相应的权限资源。",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{g.value=!0;const n=await ne();n.oK?(v.success("模块资源同步成功"),N()):v.error(n.errMsg||"同步失败")}catch(n){console.error("同步模块资源失败:",n),v.error("同步失败")}finally{g.value=!1}}})}}}const Le=H({__name:"ResourceFormDialog",props:{visible:{type:Boolean,default:!1},formData:{default:()=>({})},parentResource:{default:()=>({})},isEdit:{type:Boolean,default:!1}},emits:["update:visible","success"],setup(v,{emit:p}){const d=v,w=p,M=le(),g=x(),C=x(!1),O=x({}),s=re({resourceName:"",resourceCode:"",resourceType:"MODULE",resourcePath:"",resourceMethod:"",resourceLevel:1,sortOrder:0,moduleCode:"",moduleName:"",displayName:"",iconClass:"",description:"",resourceStatus:"Y",visibleFlag:"Y",noteText:""}),N=z({get:()=>d.visible,set:o=>w("update:visible",o)}),I=z(()=>s.resourceType==="MENU"||s.resourceType==="API"),A=z(()=>[{label:"模块",value:"MODULE"},{label:"菜单",value:"MENU"},{label:"按钮",value:"BUTTON"},{label:"API接口",value:"API"}]),L=z(()=>[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"}]),S=()=>{var o;return(o=d.parentResource)!=null&&o.resourceId?`添加子资源 - ${d.parentResource.resourceName}`:d.isEdit?"编辑资源":"新建资源"},E={resourceName:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:2,max:100,message:"资源名称长度应在 2-100 个字符之间",trigger:"blur"}],resourceCode:[{required:!0,message:"请输入资源编码",trigger:"blur"},{pattern:/^[a-zA-Z0-9][a-zA-Z0-9:_-]*$/,message:"资源编码只能包含字母、数字、冒号、下划线和连字符，且必须以字母或数字开头",trigger:"blur"},{min:2,max:100,message:"资源编码长度应在 2-100 个字符之间",trigger:"blur"}],resourceType:[{required:!0,message:"请选择资源类型",trigger:"change"}],resourceLevel:[{required:!0,type:"number",message:"请输入资源级别",trigger:"blur"},{type:"number",min:1,max:10,message:"资源级别应在 1-10 之间",trigger:"blur"}],sortOrder:[{required:!0,type:"number",message:"请输入排序顺序",trigger:"blur"},{type:"number",min:0,max:9999,message:"排序顺序应在 0-9999 之间",trigger:"blur"}],resourceStatus:[{required:!0,message:"请选择资源状态",trigger:"change"}],visibleFlag:[{required:!0,message:"请选择是否可见",trigger:"change"}]},n=o=>{o==="MODULE"?s.resourceLevel=1:o==="MENU"?s.resourceLevel=2:(o==="BUTTON"||o==="API")&&(s.resourceLevel=3),o!=="API"&&(s.resourceMethod=""),o!=="MENU"&&o!=="API"&&(s.resourcePath="")};J(()=>d.formData,o=>{o&&Object.keys(o).length>0?(O.value={...o},Object.assign(s,{resourceName:o.resourceName||"",resourceCode:o.resourceCode||"",resourceType:o.resourceType||"MODULE",resourcePath:o.resourcePath||"",resourceMethod:o.resourceMethod||"",resourceLevel:o.resourceLevel||1,sortOrder:o.sortOrder||0,moduleCode:o.moduleCode||"",moduleName:o.moduleName||"",displayName:o.displayName||"",iconClass:o.iconClass||"",description:o.description||"",resourceStatus:o.resourceStatus||"Y",visibleFlag:o.visibleFlag||"Y",noteText:o.noteText||""})):c()},{immediate:!0}),J(()=>d.parentResource,o=>{o!=null&&o.resourceId&&(s.resourceLevel=(o.resourceLevel||1)+1,s.moduleCode=o.moduleCode||"",s.moduleName=o.moduleName||"")},{immediate:!0});const c=()=>{Object.assign(s,{resourceName:"",resourceCode:"",resourceType:"MODULE",resourcePath:"",resourceMethod:"",resourceLevel:1,sortOrder:0,moduleCode:"",moduleName:"",displayName:"",iconClass:"",description:"",resourceStatus:"Y",visibleFlag:"Y",noteText:""}),O.value={}},q=()=>{c(),N.value=!1},B=async()=>{var o,a;try{await((o=g.value)==null?void 0:o.validate()),C.value=!0;const f={...s,parentResourceId:(a=d.parentResource)==null?void 0:a.resourceId};let t;d.isEdit&&O.value.resourceId?t=await pe({...f,resourceId:O.value.resourceId}):t=await me(f),he(t)?(M.success(d.isEdit?"资源更新成功":"资源创建成功"),c(),w("success")):M.error(Te(t,"操作失败"))}catch(f){console.error("提交资源表单失败:",f),f!=null&&f.message?M.error(f.message):M.error("操作失败")}finally{C.value=!1}};return(o,a)=>(_(),R(e(be),{show:N.value,"onUpdate:show":a[15]||(a[15]=f=>N.value=f),"mask-closable":!1,preset:"dialog",title:S(),class:"resource-form-dialog",style:{width:"700px"}},{action:r(()=>[l(e(G),null,{default:r(()=>[l(e(k),{onClick:q},{default:r(()=>a[24]||(a[24]=[m("取消")])),_:1}),l(e(k),{type:"primary",loading:C.value,onClick:B},{default:r(()=>[m(Q(o.isEdit?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:r(()=>[l(e(ae),{ref_key:"formRef",ref:g,model:s,rules:E,"label-placement":"left","label-width":"120px","require-mark-placement":"right-hanging"},{default:r(()=>{var f;return[(f=o.parentResource)!=null&&f.resourceId?(_(),R(e(i),{key:0,label:"父级资源"},{default:r(()=>[l(e(T),{value:`${o.parentResource.resourceName} (${o.parentResource.resourceCode})`,readonly:"",disabled:""},null,8,["value"])]),_:1})):$("",!0),l(e(i),{label:"资源名称",path:"resourceName"},{default:r(()=>[l(e(T),{value:s.resourceName,"onUpdate:value":a[0]||(a[0]=t=>s.resourceName=t),placeholder:"请输入资源名称",maxlength:"100","show-count":""},null,8,["value"])]),_:1}),l(e(i),{label:"资源编码",path:"resourceCode"},{feedback:r(()=>[l(e(P),{depth:"3",style:{"font-size":"12px"}},{default:r(()=>a[16]||(a[16]=[m(" 建议格式：hub0005:resource:action，如 hub0005:role:create ")])),_:1})]),default:r(()=>{var t;return[l(e(T),{value:s.resourceCode,"onUpdate:value":a[1]||(a[1]=Y=>s.resourceCode=Y),placeholder:"请输入资源编码",maxlength:"100","show-count":"",disabled:o.isEdit&&((t=O.value)==null?void 0:t.builtInFlag)==="Y"},null,8,["value","disabled"])]}),_:1}),l(e(i),{label:"资源类型",path:"resourceType"},{default:r(()=>[l(e(D),{value:s.resourceType,"onUpdate:value":[a[2]||(a[2]=t=>s.resourceType=t),n],placeholder:"请选择资源类型",options:A.value},null,8,["value","options"])]),_:1}),l(e(i),{label:"所属模块",path:"moduleCode"},{feedback:r(()=>[l(e(P),{depth:"3",style:{"font-size":"12px"}},{default:r(()=>a[17]||(a[17]=[m(" 模块编码，如：hub0005、hub0002 等 ")])),_:1})]),default:r(()=>[l(e(T),{value:s.moduleCode,"onUpdate:value":a[3]||(a[3]=t=>s.moduleCode=t),placeholder:"请输入模块编码",maxlength:"50"},null,8,["value"])]),_:1}),l(e(i),{label:"模块名称",path:"moduleName"},{default:r(()=>[l(e(T),{value:s.moduleName,"onUpdate:value":a[4]||(a[4]=t=>s.moduleName=t),placeholder:"请输入模块名称",maxlength:"100"},null,8,["value"])]),_:1}),l(e(i),{label:"显示名称",path:"displayName"},{default:r(()=>[l(e(T),{value:s.displayName,"onUpdate:value":a[5]||(a[5]=t=>s.displayName=t),placeholder:"请输入显示名称",maxlength:"100"},null,8,["value"])]),_:1}),I.value?(_(),R(e(i),{key:1,label:"资源路径",path:"resourcePath"},{feedback:r(()=>[l(e(P),{depth:"3",style:{"font-size":"12px"}},{default:r(()=>[m(Q(s.resourceType==="API"?"API路径，如：/api/hub0005/roles":"菜单路由路径，如：/permission/roles"),1)]),_:1})]),default:r(()=>[l(e(T),{value:s.resourcePath,"onUpdate:value":a[6]||(a[6]=t=>s.resourcePath=t),placeholder:"请输入资源路径",maxlength:"500"},null,8,["value"])]),_:1})):$("",!0),s.resourceType==="API"?(_(),R(e(i),{key:2,label:"请求方法",path:"resourceMethod"},{default:r(()=>[l(e(D),{value:s.resourceMethod,"onUpdate:value":a[7]||(a[7]=t=>s.resourceMethod=t),placeholder:"请选择请求方法",options:L.value},null,8,["value","options"])]),_:1})):$("",!0),l(e(i),{label:"资源级别",path:"resourceLevel"},{feedback:r(()=>[l(e(P),{depth:"3",style:{"font-size":"12px"}},{default:r(()=>a[18]||(a[18]=[m(" 资源层级深度，从1开始，最大10层 ")])),_:1})]),default:r(()=>[l(e(X),{value:s.resourceLevel,"onUpdate:value":a[8]||(a[8]=t=>s.resourceLevel=t),placeholder:"请输入资源级别",min:1,max:10,style:{width:"100%"}},null,8,["value"])]),_:1}),l(e(i),{label:"排序顺序",path:"sortOrder"},{default:r(()=>[l(e(X),{value:s.sortOrder,"onUpdate:value":a[9]||(a[9]=t=>s.sortOrder=t),placeholder:"请输入排序顺序",min:0,max:9999,style:{width:"100%"}},null,8,["value"])]),_:1}),l(e(i),{label:"图标样式",path:"iconClass"},{feedback:r(()=>[l(e(P),{depth:"3",style:{"font-size":"12px"}},{default:r(()=>a[19]||(a[19]=[m(" 图标CSS类名或图标名称 ")])),_:1})]),default:r(()=>[l(e(T),{value:s.iconClass,"onUpdate:value":a[10]||(a[10]=t=>s.iconClass=t),placeholder:"请输入图标样式类",maxlength:"100"},null,8,["value"])]),_:1}),l(e(i),{label:"资源状态",path:"resourceStatus"},{default:r(()=>[l(e(W),{value:s.resourceStatus,"onUpdate:value":a[11]||(a[11]=t=>s.resourceStatus=t)},{default:r(()=>[l(e(F),{value:"Y"},{default:r(()=>a[20]||(a[20]=[m("启用")])),_:1}),l(e(F),{value:"N"},{default:r(()=>a[21]||(a[21]=[m("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),l(e(i),{label:"是否可见",path:"visibleFlag"},{default:r(()=>[l(e(W),{value:s.visibleFlag,"onUpdate:value":a[12]||(a[12]=t=>s.visibleFlag=t)},{default:r(()=>[l(e(F),{value:"Y"},{default:r(()=>a[22]||(a[22]=[m("可见")])),_:1}),l(e(F),{value:"N"},{default:r(()=>a[23]||(a[23]=[m("隐藏")])),_:1})]),_:1},8,["value"])]),_:1}),l(e(i),{label:"资源描述",path:"description"},{default:r(()=>[l(e(T),{value:s.description,"onUpdate:value":a[13]||(a[13]=t=>s.description=t),type:"textarea",placeholder:"请输入资源描述",rows:3,maxlength:"500","show-count":""},null,8,["value"])]),_:1}),l(e(i),{label:"备注信息",path:"noteText"},{default:r(()=>[l(e(T),{value:s.noteText,"onUpdate:value":a[14]||(a[14]=t=>s.noteText=t),type:"textarea",placeholder:"请输入备注信息",rows:2,maxlength:"500","show-count":""},null,8,["value"])]),_:1})]}),_:1},8,["model"])]),_:1},8,["show","title"]))}}),ze=se(Le,[["__scopeId","data-v-d6fe90e2"]]),Fe={class:"resource-management-container"},De=H({__name:"ResourceManagement",setup(v){const{queryParams:p,resourceList:d,resourceTreeData:w,loading:M,isTreeView:g,handleSearch:C,resetQuery:O,handleRefresh:s,toggleTreeView:N,handleDelete:I,handleSync:A}=Ae(),L=x(),S=x(!1),E=x({}),n=x({}),c=x(!1),q=ge(o,I,a),B=()=>{E.value={},n.value={},c.value=!1,S.value=!0};function o(y){E.value={...y},n.value={},c.value=!0,S.value=!0}function a(y){E.value={},n.value={...y},c.value=!1,S.value=!0}const f=()=>{S.value=!1,C()},t=({option:y})=>{const u=y;return b("div",{class:"tree-node-label"},[b(U,{component:oe(u.resourceType),style:{marginRight:"8px"}}),b("span",u.resourceName),b(Oe,{size:"small",type:te(u.resourceType),style:{marginLeft:"8px"}},()=>ue(u.resourceType))])},Y=({option:y})=>{const u=y;return b(G,{size:"small"},()=>[b(K,{},{trigger:()=>b(k,{size:"small",quaternary:!0,onClick:()=>a(u)},()=>b(U,{component:Pe})),default:()=>"添加子资源"}),b(K,{},{trigger:()=>b(k,{size:"small",quaternary:!0,onClick:()=>o(u)},()=>b(U,{component:Z})),default:()=>"编辑"}),u.builtInFlag!=="Y"&&b(K,{},{trigger:()=>b(k,{size:"small",quaternary:!0,type:"error",onClick:()=>I(u)},()=>b(U,{component:Re})),default:()=>"删除"})])},oe=y=>Z,te=y=>({MODULE:"success",MENU:"info",BUTTON:"warning",API:"error"})[y]||"default",ue=y=>({MODULE:"模块",MENU:"菜单",BUTTON:"按钮",API:"API"})[y]||y;return Ce(()=>{C()}),(y,u)=>(_(),ee("div",Fe,[l(e(j),{size:"small",class:"search-card"},{default:r(()=>[l(e(ae),{inline:"",model:e(p),"label-placement":"left"},{default:r(()=>[l(e(i),{label:"资源名称"},{default:r(()=>[l(e(T),{value:e(p).resourceName,"onUpdate:value":u[0]||(u[0]=h=>e(p).resourceName=h),placeholder:"请输入资源名称",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),l(e(i),{label:"资源编码"},{default:r(()=>[l(e(T),{value:e(p).resourceCode,"onUpdate:value":u[1]||(u[1]=h=>e(p).resourceCode=h),placeholder:"请输入资源编码",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),l(e(i),{label:"资源类型"},{default:r(()=>[l(e(D),{value:e(p).resourceType,"onUpdate:value":u[2]||(u[2]=h=>e(p).resourceType=h),placeholder:"请选择资源类型",clearable:"",style:{width:"150px"},options:e(fe)},null,8,["value","options"])]),_:1}),l(e(i),{label:"所属模块"},{default:r(()=>[l(e(T),{value:e(p).moduleCode,"onUpdate:value":u[3]||(u[3]=h=>e(p).moduleCode=h),placeholder:"请输入模块编码",clearable:"",style:{width:"150px"}},null,8,["value"])]),_:1}),l(e(i),{label:"状态"},{default:r(()=>[l(e(D),{value:e(p).resourceStatus,"onUpdate:value":u[4]||(u[4]=h=>e(p).resourceStatus=h),placeholder:"请选择状态",style:{width:"120px"},options:e(ve)},null,8,["value","options"])]),_:1}),l(e(i),null,{default:r(()=>[l(e(k),{type:"primary",onClick:e(C)},{icon:r(()=>[l(e(U),null,{default:r(()=>[l(e(Ne))]),_:1})]),default:r(()=>[u[6]||(u[6]=m(" 搜索 "))]),_:1},8,["onClick"]),l(e(k),{onClick:e(O),style:{"margin-left":"8px"}},{icon:r(()=>[l(e(U),null,{default:r(()=>[l(e(Ue))]),_:1})]),default:r(()=>[u[7]||(u[7]=m(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),l(e(j),{size:"small",class:"action-card"},{default:r(()=>[l(e(G),null,{default:r(()=>[l(e(k),{type:"primary",onClick:B},{icon:r(()=>[l(e(U),null,{default:r(()=>[l(e(_e))]),_:1})]),default:r(()=>[u[8]||(u[8]=m(" 新建资源 "))]),_:1}),l(e(k),{type:"success",onClick:e(A)},{icon:r(()=>[l(e(U),null,{default:r(()=>[l(e(Me))]),_:1})]),default:r(()=>[u[9]||(u[9]=m(" 同步模块资源 "))]),_:1},8,["onClick"]),l(e(k),{onClick:e(s)},{icon:r(()=>[l(e(U),null,{default:r(()=>[l(e(Se))]),_:1})]),default:r(()=>[u[10]||(u[10]=m(" 刷新 "))]),_:1},8,["onClick"]),l(e(k),{onClick:e(N)},{icon:r(()=>[l(e(U),null,{default:r(()=>[e(g)?(_(),R(e(xe),{key:0})):(_(),R(e(ke),{key:1}))]),_:1})]),default:r(()=>[m(" "+Q(e(g)?"列表视图":"树形视图"),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(e(j),{size:"small",class:"table-card"},{default:r(()=>[e(g)?(_(),R(e(Ee),{key:1,data:e(w),"render-label":t,"render-suffix":Y,"key-field":"resourceId","label-field":"resourceName","children-field":"children","default-expand-all":"",style:{height:"600px",overflow:"auto"}},null,8,["data"])):(_(),R(e(we),{key:0,ref_key:"dataTableRef",ref:L,columns:e(q),data:e(d),loading:e(M),pagination:!1,"row-key":h=>h.resourceId,"flex-height":"",style:{height:"600px"}},null,8,["columns","data","loading","row-key"]))]),_:1}),l(ze,{visible:S.value,"onUpdate:visible":u[5]||(u[5]=h=>S.value=h),"form-data":E.value,"is-edit":c.value,"parent-resource":n.value,onSuccess:f},null,8,["visible","form-data","is-edit","parent-resource"])]))}}),We=se(De,[["__scopeId","data-v-92aa7c05"]]);export{We as default};

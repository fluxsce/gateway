import{c as q,a as z,S as H,b as W}from"./SearchForm-ZHBBAje7.js";import{u as j,G as J}from"./GDataFormModal-DNztNj_r.js";import{r as M,T as A,X,m as $,d as Q,b as Z,e as P,w as B,f as s,ci as ee,o as ae,a4 as _,_ as te}from"./index-MyDFJZSo.js";import"./GDialog.vue_vue_type_style_index_0_scoped_82fcf09e_lang-C8KHTAkL.js";/* empty css                                                                    */import{E as re}from"./EyeOutline-C1zCJ8pC.js";import{W as F}from"./WarningOutline-D46pPEf8.js";import"./index-DR_R-bYe.js";import"./RefreshOutline-Cm25EJPz.js";import"./OptionsOutline-Bw1df6uf.js";import"./DatePicker-BxiXFW_J.js";import"./Select-XrnkiBu4.js";import"./Grid-BI1r5n77.js";import"./InputNumber-BlyQ9L6f.js";import"./Switch-4JwQa4HN.js";import"./Scrollbar-pDL85XdD.js";import"./InformationCircleOutline-UlT6wmQH.js";import"./download-C2161hUv.js";var D=(e=>(e.ENABLED="Y",e.DISABLED="N",e))(D||{}),m=(e=>(e.MODULE="MODULE",e.MENU="MENU",e.BUTTON="BUTTON",e.API="API",e))(m||{}),L=(e=>(e.YES="Y",e.NO="N",e))(L||{}),E=(e=>(e.BUILT_IN="Y",e.CUSTOM="N",e))(E||{});function le(){const e="hub0006",l=M(!1),c=M([]),t=M(),n={fields:[{field:"resourceName",label:"资源名称",type:"input",placeholder:"请输入资源名称",span:6,clearable:!0},{field:"resourceCode",label:"资源编码",type:"input",placeholder:"请输入资源编码",span:6,clearable:!0},{field:"resourceType",label:"资源类型",type:"select",placeholder:"请选择资源类型",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"模块",value:m.MODULE},{label:"菜单",value:m.MENU},{label:"按钮",value:m.BUTTON},{label:"接口",value:m.API}]},{field:"resourceStatus",label:"状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"启用",value:D.ENABLED},{label:"禁用",value:D.DISABLED}]},{field:"builtInFlag",label:"类型",type:"select",placeholder:"请选择类型",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"内置",value:E.BUILT_IN},{label:"自定义",value:E.CUSTOM}]}],toolbarButtons:[{key:"view",label:"查看详情",icon:re,tooltip:"查看选中资源的详情"}],showSearchButton:!0,showResetButton:!0},p=[{key:"basic",label:"基本信息"},{key:"hierarchy",label:"层级关系"},{key:"other",label:"其他信息"}],d=[{field:"resourceId",label:"资源ID",type:"input",placeholder:"请输入资源ID",span:8,tabKey:"basic",required:!0,primary:!0},{field:"resourceName",label:"资源名称",type:"input",placeholder:"请输入资源名称",span:8,tabKey:"basic",required:!0},{field:"resourceCode",label:"资源编码",type:"input",placeholder:"请输入资源编码",span:8,tabKey:"basic",required:!0},{field:"resourceType",label:"资源类型",type:"select",placeholder:"请选择资源类型",span:8,tabKey:"basic",required:!0,options:[{label:"模块",value:m.MODULE},{label:"菜单",value:m.MENU},{label:"按钮",value:m.BUTTON},{label:"接口",value:m.API}]},{field:"resourcePath",label:"资源路径",type:"input",placeholder:"请输入资源路径（菜单路径或API路径）",span:12,tabKey:"basic"},{field:"resourceMethod",label:"请求方法",type:"select",placeholder:"请选择请求方法",span:6,tabKey:"basic",options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"}]},{field:"displayName",label:"显示名称",type:"input",placeholder:"请输入显示名称",span:8,tabKey:"basic"},{field:"iconClass",label:"图标样式类",type:"input",placeholder:"请输入图标样式类",span:8,tabKey:"basic"},{field:"description",label:"资源描述",type:"textarea",placeholder:"请输入资源描述",span:24,tabKey:"basic"},{field:"resourceStatus",label:"资源状态",type:"select",placeholder:"请选择状态",span:8,tabKey:"basic",defaultValue:D.ENABLED,options:[{label:"启用",value:D.ENABLED},{label:"禁用",value:D.DISABLED}]},{field:"builtInFlag",label:"内置标记",type:"select",placeholder:"请选择类型",span:8,tabKey:"basic",defaultValue:E.CUSTOM,options:[{label:"内置",value:E.BUILT_IN},{label:"自定义",value:E.CUSTOM}]},{field:"parentResourceId",label:"父资源ID",type:"input",placeholder:"请输入父资源ID",span:8,tabKey:"hierarchy"},{field:"resourceLevel",label:"资源层级",type:"number",placeholder:"请输入资源层级",span:8,tabKey:"hierarchy",defaultValue:1},{field:"sortOrder",label:"排序顺序",type:"number",placeholder:"请输入排序顺序",span:8,tabKey:"hierarchy",defaultValue:0},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"activeFlag",label:"活动标记",type:"select",span:8,tabKey:"basic",defaultValue:L.YES,options:[{label:"活动",value:L.YES},{label:"非活动",value:L.NO}]},{field:"noteText",label:"备注",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"basic"}],w={rowId:"resourceId",columns:[{field:"resourceId",title:"资源ID",showOverflow:!0,width:200,treeNode:!0},{field:"resourceName",title:"资源名称",sortable:!0,showOverflow:!0},{field:"resourceCode",title:"资源编码",sortable:!0,width:200,showOverflow:!0},{field:"resourceType",title:"资源类型",align:"center",cellRender:{name:"VxeTag",props:({row:a})=>({[m.MODULE]:{type:"info",content:"模块"},[m.MENU]:{type:"success",content:"菜单"},[m.BUTTON]:{type:"warning",content:"按钮"},[m.API]:{type:"primary",content:"接口"}})[a.resourceType]||{type:"default",content:a.resourceType}}},{field:"resourcePath",title:"资源路径",showOverflow:"tooltip"},{field:"resourceMethod",title:"请求方法",align:"center",showOverflow:!0},{field:"resourceLevel",title:"层级",align:"center",sortable:!0},{field:"sortOrder",title:"排序",align:"center",sortable:!0},{field:"resourceStatus",title:"状态",align:"center",formatter:({cellValue:a})=>a===D.ENABLED?"启用":"禁用"},{field:"builtInFlag",title:"类型",align:"center",formatter:({cellValue:a})=>a===E.BUILT_IN?"内置":"自定义"},{field:"activeFlag",title:"活动标记",align:"center",formatter:({cellValue:a})=>a===L.YES?"活动":"非活动"},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:a})=>a?A(a,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:a})=>a?A(a,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0},{field:"description",title:"描述",showOverflow:"tooltip"}],showCheckbox:!1,paginationConfig:{show:!1},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"}]},treeConfig:{transform:!1,childrenField:"children",indent:20,iconOpen:"vxe-icon-arrow-down",iconClose:"vxe-icon-arrow-right",expandAll:!1,accordion:!1,trigger:"default"},expandConfig:{mode:"fixed"},height:"100%"},h=()=>{t.value=void 0},I=a=>{t.value?Object.assign(t.value,a):t.value=a},v=a=>{c.value=a},O=()=>{c.value=[]},C=a=>{c.value.unshift(a)},b=(a,u,R)=>{const S=c.value.findIndex(K=>K.resourceId===a&&K.tenantId===u);S!==-1&&Object.assign(c.value[S],R)},N=(a,u)=>{const R=c.value.findIndex(S=>S.resourceId===a&&S.tenantId===u);R!==-1&&c.value.splice(R,1)};return{moduleId:e,loading:l,resourceList:c,pageInfo:t,searchFormConfig:n,formTabs:p,formFields:d,gridConfig:w,resetPagination:h,updatePagination:I,setResourceList:v,clearResourceList:O,addResourceToList:C,updateResourceInList:b,removeResourceFromList:N,removeResourcesFromList:a=>{a.forEach(u=>{N(u.resourceId,u.tenantId)})}}}const k=X("/gateway/hub0006");async function oe(e){return k.post("/queryResources",e)}async function se(e){return k.post("/addResource",e)}async function ne(e){return k.post("/editResource",e)}async function Y(e,l){return k.post("/deleteResource",{resourceId:e,tenantId:l})}function ie(e){const l=$(),c=j(),t=le(),{loading:n,resourceList:p,pageInfo:d,setResourceList:w,updatePagination:h,addResourceToList:I,updateResourceInList:v,removeResourceFromList:O,removeResourcesFromList:C}=t,b=async i=>{var r,o,T;n.value=!0;try{let g=i;!g&&((r=e==null?void 0:e.value)!=null&&r.getFormData)&&(g=e.value.getFormData()||{});const G={...g?Object.fromEntries(Object.entries(g).filter(([,y])=>y!==""&&y!==null&&y!==void 0)):{},...q((o=d.value)==null?void 0:o.pageIndex,(T=d.value)==null?void 0:T.pageSize)},x=await oe(G);if(x.oK){if(x.bizData){const y=JSON.parse(x.bizData),V=Array.isArray(y)?y:Array.isArray(y==null?void 0:y.data)?y.data:[];w(V)}}else l.error(x.errMsg||"查询资源列表失败")}catch(g){console.error("加载资源列表失败:",g),l.error("加载资源列表失败")}finally{n.value=!1}};return{model:t,loadResources:b,handleSearch:async i=>{await b(i)},handleReset:async()=>{t.resetPagination(),await b()},handlePageChange:async({currentPage:i,pageSize:r})=>{h({pageIndex:i,pageSize:r}),await b()},handleRefresh:async()=>{await b()},addResource:async i=>{n.value=!0;try{const r=await se(i);if(r.oK&&r.state){if(l.success(r.popMsg||"新增资源成功"),r.bizData){const o=JSON.parse(r.bizData);I(o)}else await b();return!0}else return l.error(r.errMsg||r.popMsg||"新增资源失败"),!1}catch(r){return console.error("新增资源失败:",r),l.error("新增资源失败"),!1}finally{n.value=!1}},editResource:async i=>{n.value=!0;try{const r=await ne(i);if(r.oK&&r.state){if(l.success(r.popMsg||"编辑资源成功"),r.bizData){const o=JSON.parse(r.bizData);v(o.resourceId,o.tenantId,o)}else v(i.resourceId,i.tenantId,i);return!0}else return l.error(r.errMsg||r.popMsg||"编辑资源失败"),!1}catch(r){return console.error("编辑资源失败:",r),l.error("编辑资源失败"),!1}finally{n.value=!1}},deleteResource:async i=>{if(!await c.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除资源 "${i.resourceName}" 吗？`,icon:F,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;n.value=!0;try{const o=await Y(i.resourceId,i.tenantId);return o.oK&&o.state?(l.success(o.popMsg||"删除资源成功"),O(i.resourceId,i.tenantId),p.value.length===0&&d.value&&d.value.pageIndex>1&&(h({pageIndex:d.value.pageIndex-1}),await b()),!0):(l.error(o.errMsg||o.popMsg||"删除资源失败"),!1)}catch(o){return console.error("删除资源失败:",o),l.error("删除资源失败"),!1}finally{n.value=!1}},batchDeleteResources:async i=>{if(!await c.warning({title:"确认批量删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除选中的 ${i.length} 个资源吗？`,icon:F,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;n.value=!0;try{let o=0,T=0;for(const g of i)try{const U=await Y(g.resourceId,g.tenantId);U.oK&&U.state?o++:T++}catch{T++}return o>0?(l.success(`成功删除 ${o} 个资源${T>0?`，失败 ${T} 个`:""}`),C(i.slice(0,o)),await b(),!0):(l.error(`删除失败，共 ${T} 个`),!1)}catch(o){return console.error("批量删除资源失败:",o),l.error("批量删除资源失败"),!1}finally{n.value=!1}}}}function ce(e,l){const c=$(),t=ie(l),n=M(!1),p=M("create"),d=M(null),w=()=>{p.value="create",d.value=null,n.value=!0},h=f=>{p.value="edit",d.value=f,n.value=!0},I=()=>{n.value=!1,d.value=null},v=f=>{p.value="view",d.value=f,n.value=!0};return{service:t,formDialogVisible:n,formDialogMode:p,currentEditResource:d,openAddDialog:w,openEditDialog:h,openViewDialog:v,handleFormSubmit:async f=>{if(f&&p.value!=="view"){if(p.value==="create")await t.addResource(f)&&I();else if(p.value==="edit"){if(!d.value)return;const a={...d.value,...f};await t.editResource(a)&&I()}}},handleToolbarClick:async(f,a)=>{switch(f){case"view":{if(!(e!=null&&e.value)){c.warning("Grid 引用未设置");return}const u=e.value.getCurrentRecord();if(!u){c.warning("请先点击选择要查看的资源");return}v(u);break}case"add":w();break;case"edit":{if(!(e!=null&&e.value)){c.warning("Grid 引用未设置");return}const u=e.value.getCurrentRecord();if(!u){c.warning("请先点击选择要编辑的资源");return}h(u);break}case"delete":{if(!(e!=null&&e.value)){c.warning("Grid 引用未设置");return}const u=e.value.getCurrentRecord();if(!u){c.warning("请先点击选择要删除的资源");return}await t.deleteResource(u);break}}},handleMenuClick:async({code:f,row:a})=>{if(a)switch(f){case"view":v(a);break;case"edit":h(a);break;case"delete":await t.deleteResource(a);break}},handleSearch:async f=>{await t.handleSearch(f)}}}const ue=["id"],de=Q({name:"ResourceManagement",__name:"ResourceManagement",setup(e){const l=M(),c=M(),{service:t,formDialogVisible:n,formDialogMode:p,currentEditResource:d,handleFormSubmit:w,handleToolbarClick:h,handleMenuClick:I,handleSearch:v}=ce(c,l);return(O,C)=>(ae(),Z("div",{class:"resource-management",id:s(t).model.moduleId},[P(s(W),{direction:"vertical","default-size":.1,min:.1,max:.5},{1:B(()=>[P(H,_({ref_key:"searchFormRef",ref:l,"module-id":s(t).model.moduleId},s(t).model.searchFormConfig,{onSearch:s(v),onToolbarClick:s(h)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:B(()=>[P(s(z),_({ref_key:"gridRef",ref:c,"module-id":s(t).model.moduleId,data:s(t).model.resourceList,loading:s(t).model.loading},s(t).model.gridConfig,{onPageChange:s(t).handlePageChange,onMenuClick:s(I)}),null,16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),P(J,{visible:s(n),"onUpdate:visible":C[0]||(C[0]=b=>ee(n)?n.value=b:null),mode:s(p),title:s(p)==="create"?"新增资源":s(p)==="edit"?"编辑资源":"查看资源详情",to:`#${s(t).model.moduleId}`,"form-fields":s(t).model.formFields,"form-tabs":s(t).model.formTabs,"initial-data":s(d)||void 0,"auto-close-on-confirm":!1,"confirm-loading":s(t).model.loading.value,onSubmit:s(w)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,ue))}}),Ne=te(de,[["__scopeId","data-v-420e8a30"]]);export{Ne as default};

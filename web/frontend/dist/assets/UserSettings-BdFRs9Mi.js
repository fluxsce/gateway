import{p as q,m as de,bJ as he,r as I,q as W,y as _,c as k,z as K,B as Z,A as Ne,d as Pe,v as Ie,b as ie,e as l,w as s,f as e,I as Fe,o as Q,S as ye,L as Ue,D as Ce,E as Ae,g as T,F as Se,bK as Re,J as Te,K as c,t as u,G as ke,bL as De,bM as Le,bN as ze,aI as xe,bO as Be,h as Ee,aG as qe,_ as Ge}from"./index-Cn7INyMW.js";import{N as Oe}from"./GDialog.vue_vue_type_style_index_0_scoped_82fcf09e_lang-tjYvd7T8.js";/* empty css                                                                    */import{c as Me,e as Ve,g as Ye}from"./index-BIrikhXV.js";import{_ as $e}from"./RadioGroup-DqrTUH7V.js";import{N as He}from"./Radio-COXYUPog.js";import{N as je}from"./Alert-BWCuOFRz.js";import{N as Je}from"./Switch-B6SVKmbM.js";import{_ as We}from"./Select-DnGgo6jM.js";import"./download-C2161hUv.js";function Ke(){const{t:d}=q("hub0002");q("common");const a=de(),y=he(),U=I(null),P=I(null),g=I(!1),C=I(!1),A=I(!1),o=I(null),p=W({userId:"",userName:"",realName:"",email:"",mobile:"",gender:0,avatar:"",deptName:"",tenantId:""}),D=async()=>{try{if(g.value=!0,!_.user.isAuthenticated){a.error(d("profile.fetchFailed"));return}const i=await Ye(_.user.userId,_.user.tenantId);if(K(i)){const r=Ne(i);o.value=r,Object.assign(p,{userId:r.userId,userName:r.userName,realName:r.realName,email:r.email||"",mobile:r.mobile||"",gender:r.gender||0,avatar:r.avatar||"",deptName:r.deptName||"",tenantId:r.tenantId})}else a.error(Z(i,d("profile.fetchFailed")))}catch(i){console.error("Fetch user info error:",i),a.error(d("profile.fetchFailed"))}finally{g.value=!1}},G=()=>{o.value&&Object.assign(p,{userId:o.value.userId,userName:o.value.userName,realName:o.value.realName,email:o.value.email||"",mobile:o.value.mobile||"",gender:o.value.gender||0,avatar:o.value.avatar||"",deptName:o.value.deptName||"",tenantId:o.value.tenantId})},b={realName:[{required:!0,message:()=>d("profile.realNameRequired"),trigger:["blur","input"]},{min:2,max:50,message:()=>d("profile.realNameLength"),trigger:["blur","input"]}],email:[{type:"email",message:()=>d("profile.emailInvalid"),trigger:["blur","input"]}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:()=>d("profile.mobileInvalid"),trigger:["blur","input"]}]},w=W({oldPassword:"",newPassword:"",confirmPassword:""}),O={oldPassword:[{required:!0,message:()=>d("password.oldPasswordRequired"),trigger:["blur","input"]}],newPassword:[{required:!0,message:()=>d("password.newPasswordRequired"),trigger:["blur","input"]},{min:8,max:20,message:()=>d("password.passwordLength"),trigger:["blur","input"]},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,message:()=>d("password.passwordPattern"),trigger:["blur","input"]}],confirmPassword:[{required:!0,message:()=>d("password.confirmPasswordRequired"),trigger:["blur","input"]},{validator:(i,r)=>r!==w.newPassword?new Error(d("password.passwordMismatch")):!0,trigger:["blur","input"]}]},S=W({theme:_.user.theme,language:_.user.language,showGuide:!1,notificationEnabled:!0}),v=k(()=>[{label:d("settings.lightTheme"),value:"light"},{label:d("settings.darkTheme"),value:"dark"},{label:d("settings.autoTheme"),value:"auto"}]),M=k(()=>[{label:"简体中文",value:"zh-CN"},{label:"English",value:"en"}]),V=async()=>{var i;try{if(await((i=U.value)==null?void 0:i.validate()),C.value=!0,!o.value){a.error(d("profile.saveFailed"));return}const r=await Ve({userId:p.userId,tenantId:p.tenantId,userName:p.userName,realName:p.realName,deptId:o.value.deptId||"",email:p.email,mobile:p.mobile,gender:p.gender,avatar:p.avatar,statusFlag:o.value.statusFlag||"Y",deptAdminFlag:o.value.deptAdminFlag||"N",tenantAdminFlag:o.value.tenantAdminFlag||"N",userExpireDate:o.value.userExpireDate||"",addTime:o.value.addTime||new Date().toISOString(),addWho:o.value.addWho||o.value.userId,editTime:new Date().toISOString(),editWho:o.value.userId,oprSeqFlag:o.value.oprSeqFlag||"",currentVersion:o.value.currentVersion||1,activeFlag:o.value.activeFlag||"Y"});K(r)?(a.success(d("profile.saveSuccess")),await D(),_.user.update({realName:p.realName,email:p.email,mobile:p.mobile,avatar:p.avatar})):a.error(Z(r,d("profile.saveFailed")))}catch(r){r!=null&&r.errorFields?a.error(d("profile.validationFailed")):(console.error("Save profile error:",r),a.error(d("profile.saveFailed")))}finally{C.value=!1}},Y=()=>{var i;G(),(i=U.value)==null||i.restoreValidation()},$=async()=>{var i;try{await((i=P.value)==null?void 0:i.validate()),A.value=!0;const r=await Me({userId:_.user.userId,tenantId:_.user.tenantId,oldPassword:w.oldPassword,newPassword:w.newPassword});K(r)?(a.success(d("password.changeSuccess")),L(),setTimeout(()=>{_.user.clearUserInfo(),window.location.href="/"},2e3)):a.error(Z(r,d("password.changeFailed")))}catch(r){r!=null&&r.errorFields?a.error(d("password.validationFailed")):(console.error("Change password error:",r),a.error(d("password.changeFailed")))}finally{A.value=!1}},L=()=>{var i;w.oldPassword="",w.newPassword="",w.confirmPassword="",(i=P.value)==null||i.restoreValidation()};return{userInfo:o,loading:g,fetchUserInfo:D,profileForm:p,profileFormRef:U,profileRules:b,savingProfile:C,handleSaveProfile:V,handleResetProfile:Y,passwordForm:w,passwordFormRef:P,passwordRules:O,changingPassword:A,handleChangePassword:$,handleResetPassword:L,settingsForm:S,themeOptions:v,languageOptions:M,handleThemeChange:i=>{_.user.updateSettings({theme:i}),a.success(d("settings.themeChanged"))},handleLanguageChange:i=>{_.user.updateSettings({language:i}),y.locale.value=i,a.success(d("settings.languageChanged"))},handleNotificationChange:i=>{S.notificationEnabled=i,a.success(d(i?"settings.notificationEnabled":"settings.notificationDisabled"))},handleGuideChange:i=>{S.showGuide=i},convertFileToBase64:i=>new Promise((r,z)=>{const F=new FileReader;F.readAsDataURL(i),F.onload=()=>r(F.result),F.onerror=H=>z(H)})}}const Ze="/gatewayweb/assets/logo-CQ1xvCtI.png",Qe={class:"user-settings-container"},Xe={class:"avatar-section"},ea={class:"avatar-upload"},aa=["innerHTML"],la={class:"setting-desc"},sa={class:"setting-desc"},ta=Pe({__name:"UserSettings",setup(d){const{t:a}=q("hub0002");q("common");const y=de(),U=I("profile"),P=I(""),{userInfo:g,loading:C,fetchUserInfo:A,profileForm:o,profileFormRef:p,profileRules:D,savingProfile:G,passwordForm:b,passwordFormRef:w,passwordRules:O,changingPassword:S,settingsForm:v,themeOptions:M,languageOptions:V,handleSaveProfile:Y,handleResetProfile:$,handleChangePassword:L,handleResetPassword:X,handleThemeChange:ee,handleLanguageChange:ae,handleNotificationChange:le,handleGuideChange:se,convertFileToBase64:i}=Ke(),r=k(()=>{var f;return((f=g.value)==null?void 0:f.tenantAdminFlag)==="Y"}),z=k(()=>{var f;return((f=g.value)==null?void 0:f.deptAdminFlag)==="Y"}),F=k(()=>{var f;return(f=g.value)==null?void 0:f.statusFlag}),H=async f=>{const n=f.file.file;return n.size>500*1024?(y.error(a("profile.avatarSizeLimitBase64")),!1):["image/jpeg","image/png","image/gif"].includes(n.type)?!0:(y.error(a("profile.avatarTypeInvalid")),!1)},ue=async({file:f})=>{try{if(!f.file)return;const n=await i(f.file);if(n.length>500*1024){y.error(a("profile.avatarSizeLimitBase64"));return}P.value=n,o.avatar=n}catch(n){console.error("Avatar upload error:",n),y.error(a("profile.avatarUploadFailed"))}},pe=async()=>{await Y(),P.value=""},me=()=>{$(),P.value=""};return Ie(async()=>{await A()}),(f,n)=>{const te=Re,R=Te,ce=Oe,m=Se,h=ke,j=He,x=De,fe=$e,J=Ae,B=Ce,ge=je,oe=We,ne=Je,N=ze,E=qe,ve=Le,_e=Ue,be=ye,we=Fe;return Q(),ie("div",Qe,[l(we,{show:e(C)},{default:s(()=>[l(be,{title:e(a)("title"),bordered:!1},{default:s(()=>[l(_e,{value:U.value,"onUpdate:value":n[14]||(n[14]=t=>U.value=t),type:"line",animated:""},{default:s(()=>[l(B,{name:"profile",tab:e(a)("tabs.profile")},{default:s(()=>[l(J,{ref_key:"profileFormRef",ref:p,model:e(o),rules:e(D),"label-placement":"left","label-width":"120",size:"medium",class:"profile-form"},{default:s(()=>[T("div",Xe,[l(m,{label:e(a)("profile.avatar")},{default:s(()=>[T("div",ea,[l(te,{size:80,src:P.value||e(o).avatar||e(Ze),class:"user-avatar"},null,8,["src"]),l(ce,{"show-file-list":!1,"custom-request":ue,accept:"image/*",onBeforeUpload:H},{default:s(()=>[l(R,{size:"small",class:"upload-btn"},{default:s(()=>[c(u(e(a)("profile.changeAvatar")),1)]),_:1})]),_:1})])]),_:1},8,["label"])]),l(m,{label:e(a)("profile.userId"),path:"userId"},{default:s(()=>[l(h,{value:e(o).userId,"onUpdate:value":n[0]||(n[0]=t=>e(o).userId=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.userName"),path:"userName"},{default:s(()=>[l(h,{value:e(o).userName,"onUpdate:value":n[1]||(n[1]=t=>e(o).userName=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.realName"),path:"realName"},{default:s(()=>[l(h,{value:e(o).realName,"onUpdate:value":n[2]||(n[2]=t=>e(o).realName=t),placeholder:e(a)("profile.realNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.email"),path:"email"},{default:s(()=>[l(h,{value:e(o).email,"onUpdate:value":n[3]||(n[3]=t=>e(o).email=t),placeholder:e(a)("profile.emailPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.mobile"),path:"mobile"},{default:s(()=>[l(h,{value:e(o).mobile,"onUpdate:value":n[4]||(n[4]=t=>e(o).mobile=t),placeholder:e(a)("profile.mobilePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.gender"),path:"gender"},{default:s(()=>[l(fe,{value:e(o).gender,"onUpdate:value":n[5]||(n[5]=t=>e(o).gender=t)},{default:s(()=>[l(x,null,{default:s(()=>[l(j,{value:1},{default:s(()=>[c(u(e(a)("profile.male")),1)]),_:1}),l(j,{value:2},{default:s(()=>[c(u(e(a)("profile.female")),1)]),_:1}),l(j,{value:0},{default:s(()=>[c(u(e(a)("profile.unknown")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.deptName")},{default:s(()=>[l(h,{value:e(o).deptName,"onUpdate:value":n[6]||(n[6]=t=>e(o).deptName=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(m,null,{default:s(()=>[l(x,null,{default:s(()=>[l(R,{type:"primary",loading:e(G),onClick:pe},{default:s(()=>[c(u(e(a)("common.save")),1)]),_:1},8,["loading"]),l(R,{onClick:me},{default:s(()=>[c(u(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),l(B,{name:"password",tab:e(a)("tabs.password")},{default:s(()=>[l(J,{ref_key:"passwordFormRef",ref:w,model:e(b),rules:e(O),"label-placement":"left","label-width":"120",size:"medium",class:"password-form"},{default:s(()=>[l(m,{label:e(a)("password.oldPassword"),path:"oldPassword"},{default:s(()=>[l(h,{value:e(b).oldPassword,"onUpdate:value":n[7]||(n[7]=t=>e(b).oldPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("password.newPassword"),path:"newPassword"},{default:s(()=>[l(h,{value:e(b).newPassword,"onUpdate:value":n[8]||(n[8]=t=>e(b).newPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.newPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("password.confirmPassword"),path:"confirmPassword"},{default:s(()=>[l(h,{value:e(b).confirmPassword,"onUpdate:value":n[9]||(n[9]=t=>e(b).confirmPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(ge,{type:"info","show-icon":!1,class:"password-tips"},{default:s(()=>[T("div",{innerHTML:e(a)("password.tips")},null,8,aa)]),_:1}),l(m,null,{default:s(()=>[l(x,null,{default:s(()=>[l(R,{type:"primary",loading:e(S),onClick:e(L)},{default:s(()=>[c(u(e(a)("password.changeButton")),1)]),_:1},8,["loading","onClick"]),l(R,{onClick:e(X)},{default:s(()=>[c(u(e(a)("common.reset")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),l(B,{name:"settings",tab:e(a)("tabs.settings")},{default:s(()=>[l(J,{model:e(v),"label-placement":"left","label-width":"120",size:"medium",class:"settings-form"},{default:s(()=>[l(m,{label:e(a)("settings.theme")},{default:s(()=>[l(oe,{value:e(v).theme,"onUpdate:value":[n[10]||(n[10]=t=>e(v).theme=t),e(ee)],options:e(M)},null,8,["value","options","onUpdate:value"])]),_:1},8,["label"]),l(m,{label:e(a)("settings.language")},{default:s(()=>[l(oe,{value:e(v).language,"onUpdate:value":[n[11]||(n[11]=t=>e(v).language=t),e(ae)],options:e(V)},null,8,["value","options","onUpdate:value"])]),_:1},8,["label"]),l(m,{label:e(a)("settings.notification")},{default:s(()=>[l(ne,{value:e(v).notificationEnabled,"onUpdate:value":[n[12]||(n[12]=t=>e(v).notificationEnabled=t),e(le)]},null,8,["value","onUpdate:value"]),T("span",la,u(e(a)("settings.notificationDesc")),1)]),_:1},8,["label"]),l(m,{label:e(a)("settings.showGuide")},{default:s(()=>[l(ne,{value:e(v).showGuide,"onUpdate:value":[n[13]||(n[13]=t=>e(v).showGuide=t),e(se)]},null,8,["value","onUpdate:value"]),T("span",sa,u(e(a)("settings.showGuideDesc")),1)]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["tab"]),l(B,{name:"account",tab:e(a)("tabs.account")},{default:s(()=>[l(ve,{column:1,"label-placement":"left","label-style":"width: 120px; font-weight: 500;",bordered:"",class:"account-info"},{default:s(()=>[l(N,{label:e(a)("account.userId")},{default:s(()=>{var t;return[c(u((t=e(g))==null?void 0:t.userId),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.tenantId")},{default:s(()=>{var t;return[c(u((t=e(g))==null?void 0:t.tenantId),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.roles")},{default:s(()=>[l(x,null,{default:s(()=>{var t;return[(Q(!0),ie(xe,null,Be(((t=e(g))==null?void 0:t.roles)||[],re=>(Q(),Ee(E,{key:re,type:"info",size:"small"},{default:s(()=>[c(u(re),1)]),_:2},1024))),128))]}),_:1})]),_:1},8,["label"]),l(N,{label:e(a)("account.tenantAdmin")},{default:s(()=>[l(E,{type:r.value?"success":"default",size:"small"},{default:s(()=>[c(u(r.value?e(a)("common.yes"):e(a)("common.no")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.deptAdmin")},{default:s(()=>[l(E,{type:z.value?"success":"default",size:"small"},{default:s(()=>[c(u(z.value?e(a)("common.yes"):e(a)("common.no")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.status")},{default:s(()=>[l(E,{type:F.value==="Y"?"success":"error",size:"small"},{default:s(()=>[c(u(F.value==="Y"?e(a)("account.enabled"):e(a)("account.disabled")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.lastLoginTime")},{default:s(()=>{var t;return[c(u(((t=e(g))==null?void 0:t.lastLoginTime)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.lastLoginIp")},{default:s(()=>{var t;return[c(u(((t=e(g))==null?void 0:t.lastLoginIp)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.userExpireDate")},{default:s(()=>{var t;return[c(u(((t=e(g))==null?void 0:t.userExpireDate)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"])]),_:1},8,["value"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),ga=Ge(ta,[["__scopeId","data-v-f27886f2"]]);export{ga as default};

import{G as ee}from"./GDataFormModal-CSMMbGYO.js";import{c as re,G as oe,S as ue}from"./SearchForm-DE-Qtsds.js";import{G as de}from"./GModal-CvXv33Ng.js";import{G as ce}from"./GPane--Prg37Qg.js";import{b_ as Fe,d1 as De,d2 as Ve,cJ as Le,cI as Me,O as _e,P as Pe,d as X,T as C,bV as Ke,aO as B,G as xe,J as Ue,ay as Ne,ch as Re,V as Ee,a$ as Ye,b0 as He,W as Oe,r as k,Y as Be,Z as Je,j as Z,M as fe,a1 as Ie,d3 as qe,a3 as We,aa as $,ag as ge,d4 as ke,af as je,m as Y,z as L,A as N,B as x,d5 as pe,d6 as J,a7 as E,g as he,w as F,e as m,o as te,f as me,b as D,am as G,K as q,t as W,cr as ae,_ as le,c as Ae,d7 as Te,d8 as Se,ct as ie}from"./index-B5iwLEhr.js";/* empty css                                                                    */import{u as ye}from"./useGDialog-Cwnj3s3l.js";import{A as be}from"./AddOutline-B-id1ApB.js";import{C as ve}from"./CreateOutline-BfzQYr6W.js";import{T as we}from"./TrashOutline-CSUZLE0I.js";import{_ as se}from"./Select-DZOKbeI6.js";import{W as Ce}from"./WarningOutline-DxiSA20j.js";import{N as ze}from"./InputNumber-DRvou0Uu.js";import{N as $e}from"./Switch-Dznk0CX3.js";import{s as Ge}from"./prop-NnGblK-3.js";import{N as ne}from"./Alert-CJWv8rhV.js";const Xe=Fe({name:"DynamicTags",common:_e,peers:{Input:Me,Button:Le,Tag:Ve,Space:De},self(){return{inputWidth:"64px"}}}),Qe=Pe("dynamic-tags",[Pe("input",{minWidth:"var(--n-input-width)"})]),Ze=Object.assign(Object.assign(Object.assign({},Oe.props),qe),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputClass:String,inputStyle:[String,Object],inputProps:Object,max:Number,tagClass:String,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:r=>r},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),j=X({name:"DynamicTags",props:Ze,slots:Object,setup(r){const{mergedClsPrefixRef:d,inlineThemeDisabled:t}=Ee(r),{localeRef:n}=Ye("DynamicTags"),v=He(r),{mergedDisabledRef:h}=v,p=k(""),l=k(!1),a=k(!0),y=k(null),u=Oe("DynamicTags","-dynamic-tags",Qe,Xe,r,d),g=k(r.defaultValue),i=We(r,"value"),o=Be(i,g),f=Z(()=>n.value.add),c=Z(()=>Ge(r.size)),P=Z(()=>h.value||!!r.max&&o.value.length>=r.max);function b(w){const{onChange:S,"onUpdate:value":V,onUpdateValue:_}=r,{nTriggerFormInput:H,nTriggerFormChange:R}=v;S&&Ie(S,w),_&&Ie(_,w),V&&Ie(V,w),g.value=w,H(),R()}function e(w){const S=o.value.slice(0);S.splice(w,1),b(S)}function s(w){switch(w.key){case"Enter":T()}}function T(w){const S=w??p.value;if(S){const V=o.value.slice(0);V.push(r.onCreate(S)),b(V)}l.value=!1,a.value=!0,p.value=""}function A(){T()}function z(){l.value=!0,fe(()=>{var w;(w=y.value)===null||w===void 0||w.focus(),a.value=!1})}const O=Z(()=>{const{self:{inputWidth:w}}=u.value;return{"--n-input-width":w}}),I=t?Je("dynamic-tags",void 0,O,r):void 0;return{mergedClsPrefix:d,inputInstRef:y,localizedAdd:f,inputSize:c,inputValue:p,showInput:l,inputForceFocused:a,mergedValue:o,mergedDisabled:h,triggerDisabled:P,handleInputKeyDown:s,handleAddClick:z,handleInputBlur:A,handleCloseClick:e,handleInputConfirm:T,mergedTheme:u,cssVars:t?void 0:O,themeClass:I==null?void 0:I.themeClass,onRender:I==null?void 0:I.onRender}},render(){const{mergedTheme:r,cssVars:d,mergedClsPrefix:t,onRender:n,renderTag:v}=this;return n==null||n(),C(Ke,{class:[`${t}-dynamic-tags`,this.themeClass],size:"small",style:d,theme:r.peers.Space,themeOverrides:r.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:h,tagClass:p,tagStyle:l,type:a,round:y,size:u,color:g,closable:i,mergedDisabled:o,showInput:f,inputValue:c,inputClass:P,inputStyle:b,inputSize:e,inputForceFocused:s,triggerDisabled:T,handleInputKeyDown:A,handleInputBlur:z,handleAddClick:O,handleCloseClick:I,handleInputConfirm:w,$slots:S}=this;return this.mergedValue.map((V,_)=>v?v(V,_):C(B,{key:_,theme:h.peers.Tag,themeOverrides:h.peerOverrides.Tag,class:p,style:l,type:a,round:y,size:u,color:g,closable:i,disabled:o,onClose:()=>{I(_)}},{default:()=>typeof V=="string"?V:V.label})).concat(f?S.input?S.input({submit:w,deactivate:z}):C(xe,Object.assign({placeholder:"",size:e,style:b,class:P,autosize:!0},this.inputProps,{ref:"inputInstRef",value:c,onUpdateValue:V=>{this.inputValue=V},theme:h.peers.Input,themeOverrides:h.peerOverrides.Input,onKeydown:A,onBlur:z,internalForceFocus:s})):S.trigger?S.trigger({activate:O,disabled:T}):C(Ue,{dashed:!0,disabled:T,theme:h.peers.Button,themeOverrides:h.peerOverrides.Button,size:e,onClick:O},{icon:()=>C(Ne,{clsPrefix:t},{default:()=>C(Re,null)})}))}})}});function et(r){const d=k(!1),t=k([]),n=k(),v={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:be,type:"primary",tooltip:"新建User-Agent访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:we,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},h=(f,c)=>P=>{const b=P[f]||[];return C(j,{value:b,"onUpdate:value":e=>{P[f]=e},inputProps:{placeholder:c}})},p=[{field:"useragentAccessConfigId",label:"User-Agent访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:f=>C(ge,{trigger:"hover",placement:"top"},{trigger:()=>C("div",{style:"width: 100%;"},[C(se,{value:f.defaultPolicy,"onUpdate:value":c=>{f.defaultPolicy=c},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>C("div",{style:"max-width: 320px; line-height: 1.5;"},[C("p",{style:"margin: 0 0 8px 0;"},[C("strong","默认策略说明：")]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的User-Agent会被拒绝"]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的User-Agent才被允许"]),C("p",{style:"margin: 0; color: #f0a020;"},[C("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的User-Agent都会被拒绝"])])})},{field:"blockEmptyUserAgent",label:"阻止空User-Agent",type:"switch",span:12,defaultValue:"N",tips:"阻止没有User-Agent头的请求",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistPatterns",label:"User-Agent白名单",type:"custom",span:24,defaultValue:[],tips:"支持正则表达式匹配，如：Mozilla/.*Chrome.*，白名单中的User-Agent将被允许访问",render:h("whitelistPatterns","输入允许的User-Agent模式，如：Mozilla/.*Chrome.*"),rules:[{validator:(f,c)=>{if(!c||c.length===0)return!0;const P=ke(c);return P.valid?!0:new Error(`无效的正则表达式：${P.invalidPatterns.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistPatterns",label:"User-Agent黑名单",type:"custom",span:24,defaultValue:[],tips:"支持正则表达式匹配，优先级高于白名单，黑名单中的User-Agent会被直接拒绝访问",render:h("blacklistPatterns","输入禁止的User-Agent模式，如：.*Bot.*"),rules:[{validator:(f,c)=>{if(!c||c.length===0)return!0;const P=ke(c);return P.valid?!0:new Error(`无效的正则表达式：${P.invalidPatterns.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:r,loading:d,configList:t,pageInfo:n,searchFormConfig:v,formFields:p,gridConfig:{columns:[{field:"useragentAccessConfigId",title:"User-Agent访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"whitelistPatterns",title:"User-Agent白名单",align:"left",width:300,showOverflow:!0},{field:"blacklistPatterns",title:"User-Agent黑名单",align:"left",width:300,showOverflow:!0},{field:"blockEmptyUserAgent",title:"阻止空User-Agent",align:"center",width:150,slots:{default:"blockEmptyUserAgent"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?$(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?$(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},setConfigList:f=>{t.value=f},updatePagination:f=>{n.value?Object.assign(n.value,f):n.value=f},resetPagination:()=>{n.value=void 0},addConfigToList:f=>{t.value.unshift(f)},updateConfigInList:f=>{const c=t.value.findIndex(P=>P.useragentAccessConfigId===f.useragentAccessConfigId);c!==-1&&Object.assign(t.value[c],f)},removeConfigFromList:f=>{const c=t.value.findIndex(P=>P.useragentAccessConfigId===f);c!==-1&&t.value.splice(c,1)}}}const M=je("/gateway/hubcommon002");async function tt(r){return M.post("/ip-access/add",r)}async function at(r){return M.post("/ip-access/get",r)}async function lt(r){return M.post("/ip-access/update",r)}async function it(r){return M.post("/ip-access/delete",r)}async function nt(r){return M.post("/ip-access/query",r)}async function st(r){return M.post("/useragent-access/add",r)}async function rt(r){return M.post("/useragent-access/get",r)}async function ot(r){return M.post("/useragent-access/update",r)}async function ut(r){return M.post("/useragent-access/delete",r)}async function dt(r){return M.post("/useragent-access/query",r)}async function ct(r){return M.post("/api-access/add",r)}async function ft(r){return M.post("/api-access/get",r)}async function gt(r){return M.post("/api-access/update",r)}async function pt(r){return M.post("/api-access/delete",r)}async function ht(r){return M.post("/api-access/query",r)}async function mt(r){return M.post("/domain-access/add",r)}async function yt(r){return M.post("/domain-access/get",r)}async function bt(r){return M.post("/domain-access/update",r)}async function vt(r){return M.post("/domain-access/delete",r)}async function wt(r){return M.post("/domain-access/query",r)}async function Ct(r){return M.post("/cors/add",r)}async function It(r){return M.post("/cors/update",r)}async function At(r){return M.post("/cors/query",r)}async function Pt(r){return M.post("/auth/add",r)}async function kt(r){return M.post("/auth/update",r)}async function Tt(r){return M.post("/auth/query",r)}async function St(r){return M.post("/rate-limit/add",r)}async function xt(r){return M.post("/rate-limit/update",r)}async function Ot(r){return M.post("/rate-limit/query",r)}function Ft(r,d,t){const n=Y(),v=ye(),h=et(r),{loading:p,configList:l,pageInfo:a,setConfigList:y,updatePagination:u,addConfigToList:g,updateConfigInList:i,removeConfigFromList:o}=h,f=async O=>{var I,w,S;p.value=!0;try{let V=O;!V&&((I=t==null?void 0:t.value)!=null&&I.getFormData)&&(V=t.value.getFormData()||{});const _=V?Object.fromEntries(Object.entries(V).filter(([,K])=>K!==""&&K!==null&&K!==void 0)):{},H={..._,...re((w=a.value)==null?void 0:w.pageIndex,(S=a.value)==null?void 0:S.pageSize)};if(d!=null&&d.value)H.securityConfigId=d.value;else if(!_.securityConfigId){n.error("securityConfigId不能为空");return}const R=await dt(H);if(L(R)){const K=N(R,[]);y(K);const U=pe(R);U&&Object.keys(U).length>0&&u(U)}else n.error(x(R,"查询User-Agent访问控制配置列表失败"))}catch{n.error("加载User-Agent访问控制配置列表失败")}finally{p.value=!1}};return{model:h,loadConfigs:f,handleSearch:async O=>{h.resetPagination(),await f(O)},handleReset:async()=>{h.resetPagination(),await f()},handlePageChange:async({currentPage:O,pageSize:I})=>{u({pageIndex:O,pageSize:I}),await f()},handleRefresh:async()=>{await f()},addConfig:async O=>{p.value=!0;try{const I=await st(O);if(L(I)){n.success(x(I,"新增User-Agent访问控制配置成功"));const w=N(I,null);return w?g(w):await f(),!0}else return n.error(x(I,"新增User-Agent访问控制配置失败")),!1}catch{return n.error("新增User-Agent访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async O=>{p.value=!0;try{const I=await ot(O);if(L(I)){n.success(x(I,"编辑User-Agent访问控制配置成功"));const w=N(I,null);return w?i(w):await f(),!0}else return n.error(x(I,"编辑User-Agent访问控制配置失败")),!1}catch{return n.error("编辑User-Agent访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async O=>{if(!await v.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除User-Agent访问控制配置 "${O.configName}" 吗？`,icon:Ce,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const w=await ut({useragentAccessConfigId:O.useragentAccessConfigId,tenantId:O.tenantId});return L(w)?(n.success(x(w,"删除User-Agent访问控制配置成功")),o(O.useragentAccessConfigId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(u({pageIndex:a.value.pageIndex-1}),await f()),!0):(n.error(x(w,"删除User-Agent访问控制配置失败")),!1)}catch{return n.error("删除User-Agent访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async O=>{try{const I=await rt({useragentAccessConfigId:O});return L(I)?N(I,{}):(n.error(x(I,"获取User-Agent访问控制配置详情失败")),null)}catch{return n.error("获取User-Agent访问控制配置详情失败"),null}}}}function Dt(r,d,t,n){const v=Y(),h=Ft(r.value,t,n),p=k(!1),l=k("create"),a=k(null),y=e=>({...e,whitelistPatterns:J(e.whitelistPatterns),blacklistPatterns:J(e.blacklistPatterns)}),u=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.useragentAccessConfigId)try{const s=await h.getConfigDetail(e.useragentAccessConfigId);if(s){l.value="edit",a.value=y(s),p.value=!0;return}}catch{}l.value="edit",a.value=y(e),p.value=!0},i=()=>{p.value=!1,a.value=null},o=async e=>{if(e.useragentAccessConfigId)try{const s=await h.getConfigDetail(e.useragentAccessConfigId);if(s){l.value="view",a.value=y(s),p.value=!0;return}}catch{}l.value="view",a.value=y(e),p.value=!0};return{service:h,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:u,openEditDialog:g,openViewDialog:o,closeFormDialog:i,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistPatterns:Array.isArray(e.whitelistPatterns)?JSON.stringify(e.whitelistPatterns):e.whitelistPatterns,blacklistPatterns:Array.isArray(e.blacklistPatterns)?JSON.stringify(e.blacklistPatterns):e.blacklistPatterns};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){v.error("安全配置ID不能为空");return}s.securityConfigId=T,await h.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await h.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){v.warning("请先选择安全配置");return}u(T);break;case"edit":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要编辑的配置");return}g(A);break}case"delete":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要删除的配置");return}await h.deleteConfig(A);break}case"search":{await h.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":o(s);break;case"edit":g(s);break;case"delete":await h.deleteConfig(s);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const Vt={class:"useragent-access-config-list-modal",id:"useragent-access-config-list-modal"},Lt=X({name:"UserAgentAccessConfigListModal",__name:"UserAgentAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"User-Agent访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(),h=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:y,formDialogVisible:u,formDialogMode:g,currentEditConfig:i,handleFormSubmit:o,handleToolbarClick:f,handleMenuClick:c,handleSearch:P}=Dt(p,h,a,v),b=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(u.value=!1,g.value="create",i.value=null,y.model.configList.value=[],y.model.resetPagination())};return(s,T)=>(te(),he(m(de),{visible:l.value,title:t.title||"User-Agent访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":b,onAfterLeave:e},{default:F(()=>[me("div",Vt,[D(m(ce),{direction:"vertical","no-resize":!0},{1:F(()=>[D(ue,G({ref_key:"searchFormRef",ref:v,"module-id":m(y).model.moduleId},m(y).model.searchFormConfig,{onSearch:m(P),onToolbarClick:m(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:F(()=>[D(m(oe),G({ref_key:"gridRef",ref:h,"module-id":m(y).model.moduleId,data:m(y).model.configList,loading:m(y).model.loading},m(y).model.gridConfig,{onPageChange:m(y).handlePageChange,onMenuClick:m(c)}),{defaultPolicy:F(({row:A})=>[D(m(B),{type:A.defaultPolicy==="allow"?"success":"error",size:"small"},{default:F(()=>[q(W(A.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:F(({row:A})=>[D(m(B),{type:A.activeFlag==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),blockEmptyUserAgent:F(({row:A})=>[D(m(B),{type:A.blockEmptyUserAgent==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.blockEmptyUserAgent==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(ee,{visible:m(u),"onUpdate:visible":T[0]||(T[0]=A=>ae(u)?u.value=A:null),mode:m(g),title:m(g)==="create"?"新增User-Agent访问控制配置":m(g)==="edit"?"编辑User-Agent访问控制配置":"查看User-Agent访问控制配置详情",to:"#useragent-access-config-list-modal","form-fields":m(y).model.formFields,"initial-data":m(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(y).model.loading.value,onSubmit:m(o)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),Ta=le(Lt,[["__scopeId","data-v-d692cd6b"]]);function Mt(r){const d=k(!1),t=k([]),n=k(),v={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:be,type:"primary",tooltip:"新建API访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:we,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},h=(c,P)=>b=>{const e=b[c]||[];return C(j,{value:e,"onUpdate:value":s=>{b[c]=s},inputProps:{placeholder:P}})},p=(c,P)=>b=>{const e=b[c]||[];return C(j,{value:e,"onUpdate:value":s=>{b[c]=s},inputProps:{placeholder:P}})},l=[{field:"apiAccessConfigId",label:"API访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:c=>C(ge,{trigger:"hover",placement:"top"},{trigger:()=>C("div",{style:"width: 100%;"},[C(se,{value:c.defaultPolicy,"onUpdate:value":P=>{c.defaultPolicy=P},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>C("div",{style:"max-width: 320px; line-height: 1.5;"},[C("p",{style:"margin: 0 0 8px 0;"},[C("strong","默认策略说明：")]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的API路径会被拒绝"]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的API路径才被允许"]),C("p",{style:"margin: 0; color: #f0a020;"},[C("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的API路径都会被拒绝"])])})}]},{field:"pathConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistPaths",label:"API路径白名单",type:"custom",span:12,defaultValue:[],tips:"支持通配符匹配，如：/api/v1/*",render:h("whitelistPaths","输入允许的API路径，如：/api/v1/*")},{field:"blacklistPaths",label:"API路径黑名单",type:"custom",span:12,defaultValue:[],tips:"支持通配符匹配，优先级高于白名单",render:h("blacklistPaths","输入禁止的API路径，如：/api/admin/*")}]},{field:"methodConfig",label:"",type:"fieldset",span:24,children:[{field:"allowedMethods",label:"允许的HTTP方法",type:"custom",span:12,defaultValue:[],tips:"如：GET, POST, PUT, DELETE",render:p("allowedMethods","输入允许的HTTP方法，如：GET, POST")},{field:"blockedMethods",label:"禁止的HTTP方法",type:"custom",span:12,defaultValue:[],tips:"优先级高于允许的方法",render:p("blockedMethods","输入禁止的HTTP方法，如：DELETE")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:r,loading:d,configList:t,pageInfo:n,searchFormConfig:v,formFields:l,gridConfig:{columns:[{field:"apiAccessConfigId",title:"API访问配置ID",width:200,visible:!1},{field:"tenantId",title:"租户ID",width:200,visible:!1},{field:"securityConfigId",title:"安全配置ID",width:200,visible:!1},{field:"configName",title:"配置名称",width:200,showOverflow:!0},{field:"defaultPolicy",title:"默认策略",width:120,align:"center",slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"活动状态",width:100,align:"center",slots:{default:"activeFlag"}},{field:"whitelistPaths",title:"路径白名单",width:200,showOverflow:!0},{field:"blacklistPaths",title:"路径黑名单",width:200,showOverflow:!0},{field:"allowedMethods",title:"允许的方法",width:150,showOverflow:!0},{field:"blockedMethods",title:"禁止的方法",width:150,showOverflow:!0},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:c})=>c?$(c,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:c})=>c?$(c,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},resetPagination:()=>{n.value=void 0},updatePagination:c=>{n.value?Object.assign(n.value,c):n.value=c},setConfigList:c=>{t.value=c},addConfigToList:c=>{t.value.push(c)},updateConfigInList:(c,P,b)=>{const e=t.value.findIndex(s=>s.apiAccessConfigId===c&&s.tenantId===P);e!==-1&&Object.assign(t.value[e],b)},removeConfigFromList:(c,P)=>{const b=t.value.findIndex(e=>e.apiAccessConfigId===c&&e.tenantId===P);b!==-1&&t.value.splice(b,1)}}}function _t(r,d,t){const n=Y(),v=ye(),h=Mt(r),{loading:p,configList:l,pageInfo:a,setConfigList:y,updatePagination:u,addConfigToList:g,updateConfigInList:i,removeConfigFromList:o,resetPagination:f}=h,c=async I=>{var w,S,V;p.value=!0;try{let _=I;!_&&((w=t==null?void 0:t.value)!=null&&w.getFormData)&&(_=t.value.getFormData()||{});const H=_?Object.fromEntries(Object.entries(_).filter(([,U])=>U!==""&&U!==null&&U!==void 0)):{},R={...H,...re((S=a.value)==null?void 0:S.pageIndex,(V=a.value)==null?void 0:V.pageSize)};if(d!=null&&d.value)R.securityConfigId=d.value;else if(!H.securityConfigId){n.error("securityConfigId不能为空");return}const K=await ht(R);if(L(K)){const U=N(K,[]);y(U);const Q=pe(K);Q&&Object.keys(Q).length>0&&u(Q)}else n.error(x(K,"查询API访问控制配置列表失败"))}catch{n.error("加载API访问控制配置列表失败")}finally{p.value=!1}};return{model:h,loadConfigs:c,handleSearch:async I=>{f(),await c(I)},handleReset:async()=>{f(),await c()},handlePageChange:async({currentPage:I,pageSize:w})=>{u({pageIndex:I,pageSize:w}),await c()},handleRefresh:async()=>{await c()},addConfig:async I=>{p.value=!0;try{const w=await ct(I);if(L(w)){n.success(x(w,"新增API访问控制配置成功"));const S=N(w,null);return S?g(S):await c(),!0}else return n.error(x(w,"新增API访问控制配置失败")),!1}catch{return n.error("新增API访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async I=>{p.value=!0;try{const w=await gt(I);if(L(w)){n.success(x(w,"编辑API访问控制配置成功"));const S=N(w,null);return S?i(S.apiAccessConfigId,S.tenantId,S):await c(),!0}else return n.error(x(w,"编辑API访问控制配置失败")),!1}catch{return n.error("编辑API访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async I=>{if(!await v.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除API访问控制配置 "${I.configName}" 吗？`,icon:Ce,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const S=await pt({apiAccessConfigId:I.apiAccessConfigId,tenantId:I.tenantId});return L(S)?(n.success(x(S,"删除API访问控制配置成功")),o(I.apiAccessConfigId,I.tenantId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(u({pageIndex:a.value.pageIndex-1}),await c()),!0):(n.error(x(S,"删除API访问控制配置失败")),!1)}catch{return n.error("删除API访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async I=>{try{const w=await ft({apiAccessConfigId:I});return L(w)?N(w,{}):(n.error(x(w,"获取API访问控制配置详情失败")),null)}catch{return n.error("获取API访问控制配置详情失败"),null}}}}function Kt(r,d,t,n){const v=Y(),h=_t(r.value,t,n),p=k(!1),l=k("create"),a=k(null),y=e=>({...e,whitelistPaths:J(e.whitelistPaths),blacklistPaths:J(e.blacklistPaths),allowedMethods:J(e.allowedMethods),blockedMethods:J(e.blockedMethods)}),u=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.apiAccessConfigId)try{const s=await h.getConfigDetail(e.apiAccessConfigId);if(s){l.value="edit",a.value=y(s),p.value=!0;return}}catch{}l.value="edit",a.value=y(e),p.value=!0},i=()=>{p.value=!1,a.value=null},o=async e=>{if(e.apiAccessConfigId)try{const s=await h.getConfigDetail(e.apiAccessConfigId);if(s){l.value="view",a.value=y(s),p.value=!0;return}}catch{}l.value="view",a.value=y(e),p.value=!0};return{service:h,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:u,openEditDialog:g,openViewDialog:o,closeFormDialog:i,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistPaths:Array.isArray(e.whitelistPaths)?JSON.stringify(e.whitelistPaths):e.whitelistPaths,blacklistPaths:Array.isArray(e.blacklistPaths)?JSON.stringify(e.blacklistPaths):e.blacklistPaths,allowedMethods:Array.isArray(e.allowedMethods)?JSON.stringify(e.allowedMethods):e.allowedMethods,blockedMethods:Array.isArray(e.blockedMethods)?JSON.stringify(e.blockedMethods):e.blockedMethods};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){v.error("安全配置ID不能为空");return}s.securityConfigId=T,await h.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await h.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){v.warning("请先选择安全配置");return}u(T);break;case"edit":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要编辑的配置");return}g(A);break}case"delete":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要删除的配置");return}await h.deleteConfig(A);break}case"search":{await h.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":o(s);break;case"edit":g(s);break;case"delete":await h.deleteConfig(s);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const Ut={class:"api-access-config-list-modal",id:"api-access-config-list-modal"},Nt=X({name:"ApiAccessConfigListModal",__name:"ApiAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"API访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(),h=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s}),E(()=>t.moduleId,s=>{p.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:y,formDialogVisible:u,formDialogMode:g,currentEditConfig:i,handleFormSubmit:o,handleToolbarClick:f,handleMenuClick:c,handleSearch:P}=Kt(p,h,a,v),b=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(u.value=!1,g.value="create",i.value=null,y.model.configList.value=[],y.model.resetPagination())};return(s,T)=>(te(),he(m(de),{visible:l.value,title:t.title||"API访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":b,onAfterLeave:e},{default:F(()=>[me("div",Ut,[D(m(ce),{direction:"vertical","no-resize":!0},{1:F(()=>[D(ue,G({ref_key:"searchFormRef",ref:v,"module-id":m(y).model.moduleId},m(y).model.searchFormConfig,{onSearch:m(P),onToolbarClick:m(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:F(()=>[D(m(oe),G({ref_key:"gridRef",ref:h,"module-id":m(y).model.moduleId,data:m(y).model.configList,loading:m(y).model.loading},m(y).model.gridConfig,{onPageChange:m(y).handlePageChange,onMenuClick:m(c)}),{defaultPolicy:F(({row:A})=>[D(m(B),{type:A.defaultPolicy==="allow"?"success":"error",size:"small"},{default:F(()=>[q(W(A.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:F(({row:A})=>[D(m(B),{type:A.activeFlag==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(ee,{visible:m(u),"onUpdate:visible":T[0]||(T[0]=A=>ae(u)?u.value=A:null),mode:m(g),title:m(g)==="create"?"新增API访问控制配置":m(g)==="edit"?"编辑API访问控制配置":"查看API访问控制配置详情",to:"#api-access-config-list-modal","form-fields":m(y).model.formFields,"initial-data":m(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(y).model.loading.value,onSubmit:m(o)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),Sa=le(Nt,[["__scopeId","data-v-ffd5e83d"]]);function Rt(r){const d=k(!1),t=(u,g)=>i=>{const o=i[u]||[];return C(j,{value:o,"onUpdate:value":f=>{i[u]=f},inputProps:{placeholder:g}})},n=[{label:"JWT认证",value:"JWT"},{label:"API Key认证",value:"API_KEY"},{label:"OAuth2认证",value:"OAUTH2"},{label:"Basic认证",value:"BASIC"}],v=[{label:"必需认证",value:"REQUIRED"},{label:"可选认证",value:"OPTIONAL"},{label:"禁用认证",value:"DISABLED"}],h=[{label:"HS256",value:"HS256"},{label:"HS384",value:"HS384"},{label:"HS512",value:"HS512"},{label:"RS256",value:"RS256"},{label:"RS384",value:"RS384"},{label:"RS512",value:"RS512"}],p=[{label:"Header",value:"header"},{label:"Query参数",value:"query"}],l=(u,g,i)=>o=>{const f=`authConfig.${u}`,c=o[f];return g==="input"?C(xe,{value:c||"",type:(i==null?void 0:i.type)||"text",placeholder:(i==null?void 0:i.placeholder)||"","onUpdate:value":P=>{o[f]=P}}):g==="select"?C(se,{value:c||(i==null?void 0:i.defaultValue)||"",options:(i==null?void 0:i.options)||[],placeholder:(i==null?void 0:i.placeholder)||"","onUpdate:value":P=>{o[f]=P}}):g==="number"?C(ze,{value:c??(i==null?void 0:i.defaultValue)??0,min:i==null?void 0:i.min,max:i==null?void 0:i.max,placeholder:(i==null?void 0:i.placeholder)||"",style:"width: 100%;","onUpdate:value":P=>{o[f]=P??(i==null?void 0:i.defaultValue)??0}}):g==="switch"?C($e,{value:c??(i==null?void 0:i.defaultValue)??!1,"onUpdate:value":P=>{o[f]=P}}):g==="tags"?C(j,{value:c||[],"onUpdate:value":P=>{o[f]=P},inputProps:{placeholder:(i==null?void 0:i.placeholder)||""}}):C("div")},a=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],y=[{field:"authConfigId",label:"认证配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"authName",label:"认证配置名称",type:"input",placeholder:"请输入认证配置名称",span:12,required:!0,defaultValue:"认证配置",tabKey:"basic"},{field:"authType",label:"认证类型",type:"select",span:12,required:!0,defaultValue:"JWT",tabKey:"basic",props:{options:n,placeholder:"选择认证类型"},tips:"支持JWT、API Key、OAuth2、Basic认证"},{field:"authStrategy",label:"认证策略",type:"select",span:12,required:!0,defaultValue:"REQUIRED",tabKey:"basic",props:{options:v,placeholder:"选择认证策略"},tips:"必需：必须认证才能访问；可选：可以认证但不强制；禁用：不进行认证"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"failureStatusCode",label:"失败状态码",type:"number",placeholder:"认证失败HTTP状态码",span:12,defaultValue:401,tabKey:"basic",props:{min:400,max:599},tips:"认证失败时返回的HTTP状态码"},{field:"failureMessage",label:"失败提示消息",type:"input",placeholder:"认证失败提示消息",span:12,defaultValue:"认证失败",tabKey:"basic",tips:"认证失败时返回的错误消息"}]},{field:"authConfigDetails",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"authConfig.secret",label:"JWT密钥",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",required:!0,tips:"JWT签名密钥，用于验证和生成Token",render:l("secret","input",{type:"password",placeholder:"JWT签名密钥"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="JWT"){const o=i["authConfig.secret"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("JWT密钥不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.algorithm",label:"签名算法",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",required:!0,tips:"JWT签名算法，如HS256、RS256等",render:l("algorithm","select",{options:h,defaultValue:"HS256",placeholder:"选择签名算法"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="JWT"){const o=i["authConfig.algorithm"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("签名算法不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.issuer",label:"签发者(Issuer)",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",tips:"JWT签发者标识，可选",render:l("issuer","input",{placeholder:"JWT签发者"})},{field:"authConfig.expiration",label:"过期时间(秒)",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",defaultValue:3600,tips:"Token过期时间，默认3600秒",render:l("expiration","number",{min:60,max:86400,defaultValue:3600,placeholder:"Token过期时间"})},{field:"authConfig.verifyExpiration",label:"验证过期时间",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",tips:"是否验证Token过期时间",render:l("verifyExpiration","switch",{defaultValue:!0})},{field:"authConfig.verifyIssuer",label:"验证签发者",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",tips:"是否验证Token签发者",render:l("verifyIssuer","switch",{defaultValue:!1})},{field:"authConfig.refreshWindow",label:"刷新窗口(秒)",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",defaultValue:300,tips:"过期前多少秒可以刷新Token",render:l("refreshWindow","number",{min:0,max:3600,defaultValue:300,placeholder:"过期前多少秒可刷新"})},{field:"authConfig.includeInResponse",label:"响应包含Token",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",tips:"是否在响应头中包含生成的Token",render:l("includeInResponse","switch",{defaultValue:!1})},{field:"authConfig.responseHeaderName",label:"响应头名称",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="JWT",defaultValue:"X-Auth-Token",tips:"响应头中Token的字段名",render:l("responseHeaderName","input",{placeholder:"X-Auth-Token",defaultValue:"X-Auth-Token"})},{field:"authConfig.keyLocation",label:"API Key位置",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="API_KEY",required:!0,tips:"API Key的获取位置，Header或Query参数",render:l("keyLocation","select",{options:p,defaultValue:"header",placeholder:"API Key获取位置"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="API_KEY"){const o=i["authConfig.keyLocation"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("API Key位置不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.keyName",label:"参数名称",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="API_KEY",required:!0,tips:"API Key的参数名称，如X-API-Key",render:l("keyName","input",{placeholder:"api_key",defaultValue:"X-API-Key"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="API_KEY"){const o=i["authConfig.keyName"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("参数名称不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.validKeys",label:"有效API Keys",type:"custom",span:24,tabKey:"basic",show:u=>u.authType==="API_KEY",required:!0,tips:"允许访问的API Key列表，至少配置一个",render:l("validKeys","tags",{placeholder:"输入API Key"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="API_KEY"){const o=i["authConfig.validKeys"];if(!o||!Array.isArray(o)||o.length===0)return new Error("至少需要配置一个有效API Key")}return!0},trigger:["blur","change"]}]},{field:"authConfig.tokenEndpoint",label:"Token端点URL",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="OAUTH2",required:!0,tips:"OAuth2 Token获取端点URL",render:l("tokenEndpoint","input",{placeholder:"https://auth.example.com/oauth/token"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="OAUTH2"){const o=i["authConfig.tokenEndpoint"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("Token端点URL不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.introspectEndpoint",label:"内省端点URL",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="OAUTH2",tips:"OAuth2 Token内省端点URL，可选",render:l("introspectEndpoint","input",{placeholder:"https://auth.example.com/oauth/introspect"})},{field:"authConfig.clientID",label:"Client ID",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="OAUTH2",required:!0,tips:"OAuth2客户端ID",render:l("clientID","input",{placeholder:"客户端ID"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="OAUTH2"){const o=i["authConfig.clientID"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("Client ID不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.clientSecret",label:"Client Secret",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="OAUTH2",required:!0,tips:"OAuth2客户端密钥",render:l("clientSecret","input",{type:"password",placeholder:"客户端密钥"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="OAUTH2"){const o=i["authConfig.clientSecret"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("Client Secret不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.scope",label:"Scope",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="OAUTH2",tips:"OAuth2授权范围，多个用空格分隔",render:l("scope","input",{placeholder:"read write"})},{field:"authConfig.username",label:"用户名",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="BASIC",required:!0,tips:"Basic认证用户名",render:l("username","input",{placeholder:"认证用户名"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="BASIC"){const o=i["authConfig.username"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("用户名不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.password",label:"密码",type:"custom",span:12,tabKey:"basic",show:u=>u.authType==="BASIC",required:!0,tips:"Basic认证密码",render:l("password","input",{type:"password",placeholder:"认证密码"}),rules:[{validator:(u,g)=>{const i=u.source||{};if(i.authType==="BASIC"){const o=i["authConfig.password"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("密码不能为空")}return!0},trigger:["blur","change"]}]}]},{field:"exemptConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"exemptPaths",label:"豁免路径",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"支持通配符，如：/public/*, /health, /api/v1/status",render:t("exemptPaths","输入豁免路径")},{field:"exemptHeaders",label:"豁免请求头",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"包含指定请求头的请求将跳过认证",render:t("exemptHeaders","输入豁免请求头")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"}];return{moduleId:r,loading:d,formTabs:a,formFields:y}}function Et(r){const d=Y(),t=Rt(r),{loading:n}=t;return{model:t,getConfigDetail:async l=>{try{const a=await Tt(l);return L(a)?N(a,null):(d.error(x(a,"获取认证配置详情失败")),null)}catch{return d.error("获取认证配置详情失败"),null}},addConfig:async l=>{n.value=!0;try{const a=await Pt(l);return L(a)?(d.success(x(a,"新增认证配置成功")),!0):(d.error(x(a,"新增认证配置失败")),!1)}catch{return d.error("新增认证配置失败"),!1}finally{n.value=!1}},editConfig:async l=>{n.value=!0;try{const a=await kt(l);return L(a)?(d.success(x(a,"编辑认证配置成功")),!0):(d.error(x(a,"编辑认证配置失败")),!1)}catch{return d.error("编辑认证配置失败"),!1}finally{n.value=!1}}}}function Yt(r,d){Y();const t=Et(r.value),n=k(!1),v=k("create"),h=k(null),p=i=>{const o=b=>{if(typeof b=="string"&&b)try{return JSON.parse(b)}catch{return b}return b},f=b=>{if(Array.isArray(b))return b;if(typeof b=="string"&&b)try{return JSON.parse(b)}catch{return[]}return[]},c=o(i.authConfig)||{},P={...i,exemptPaths:f(i.exemptPaths),exemptHeaders:f(i.exemptHeaders)};return c&&typeof c=="object"&&Object.keys(c).forEach(b=>{P[`authConfig.${b}`]=c[b]}),P},l=i=>{const o={};Object.keys(i).forEach(c=>{if(c.startsWith("authConfig.")){const P=c.replace("authConfig.","");o[P]=i[c]}});const f={};return Object.keys(i).forEach(c=>{c.startsWith("authConfig.")||(f[c]=i[c])}),{...f,authConfig:Object.keys(o).length>0?JSON.stringify(o):"{}",exemptPaths:Array.isArray(i.exemptPaths)?JSON.stringify(i.exemptPaths):i.exemptPaths||"[]",exemptHeaders:Array.isArray(i.exemptHeaders)?JSON.stringify(i.exemptHeaders):i.exemptHeaders||"[]"}},a=async()=>{var c,P;const i=(c=d.gatewayInstanceId)==null?void 0:c.value,o=(P=d.routeConfigId)==null?void 0:P.value;if(!i&&!o)return;const f=await t.getConfigDetail({gatewayInstanceId:i,routeConfigId:o});f?(h.value=p(f),v.value="edit"):(h.value=null,v.value="create")},y=async()=>{await a(),n.value=!0},u=()=>{n.value=!1,h.value=null},g=async i=>{var f,c;if(!i||v.value==="view")return;const o=l(i);if((f=d.gatewayInstanceId)!=null&&f.value&&(o.gatewayInstanceId=d.gatewayInstanceId.value),(c=d.routeConfigId)!=null&&c.value&&(o.routeConfigId=d.routeConfigId.value),v.value==="create")await t.addConfig(o)&&await a();else if(v.value==="edit"){if(!h.value)return;const P={...o,authConfigId:h.value.authConfigId,tenantId:h.value.tenantId};await t.editConfig(P)&&await a()}};return E(()=>{var i,o;return[(i=d.gatewayInstanceId)==null?void 0:i.value,(o=d.routeConfigId)==null?void 0:o.value]},()=>{n.value&&a()}),{service:t,formDialogVisible:n,formDialogMode:v,currentEditConfig:h,openDialog:y,closeFormDialog:u,handleFormSubmit:g,loadConfig:a}}const Ht={class:"auth-config-form-modal",id:"auth-config-form-modal"},Bt=X({name:"AuthConfigFormModal",__name:"AuthConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(t.gatewayInstanceId),h=k(t.routeConfigId),p=k(t.moduleId),l=Yt(p,{gatewayInstanceId:v,routeConfigId:h}),{service:a,formDialogVisible:y,formDialogMode:u,currentEditConfig:g,openDialog:i,closeFormDialog:o,handleFormSubmit:f}=l,c=Z(()=>t.title?t.title:u.value==="create"?"新增认证配置":u.value==="edit"?"编辑认证配置":"查看认证配置详情");E(()=>t.visible,async b=>{b?(v.value=t.gatewayInstanceId,h.value=t.routeConfigId,y.value&&(o(),await fe()),await i()):y.value&&o()});const P=b=>{b||(n("update:visible",!1),n("close"),n("refresh"))};return(b,e)=>(te(),Ae("div",Ht,[D(ee,{visible:m(y),"onUpdate:visible":[e[0]||(e[0]=s=>ae(y)?y.value=s:null),P],mode:m(u),title:c.value,width:t.width||800,to:t.to||"#auth-config-form-modal","form-fields":m(a).model.formFields,"form-tabs":m(a).model.formTabs,"initial-data":m(g)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(a).model.loading.value,onSubmit:m(f)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])]))}}),xa=le(Bt,[["__scopeId","data-v-688ba2ef"]]);function Jt(r){const d=k(!1),t=(h,p)=>l=>{const a=l[h]||[];return C(j,{value:a,"onUpdate:value":y=>{l[h]=y},inputProps:{placeholder:p}})},n=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],v=[{field:"corsConfigId",label:"CORS配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入CORS配置名称",span:12,required:!0,defaultValue:"CORS跨域配置",tabKey:"basic"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"allowCredentials",label:"允许携带凭证",type:"switch",span:12,defaultValue:"N",tabKey:"basic",tips:"是否允许跨域请求携带Cookie、Authorization等凭证信息",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"maxAgeSeconds",label:"预检缓存时间",type:"number",placeholder:"预检请求缓存时间(秒)",span:12,defaultValue:86400,tabKey:"basic",props:{min:0,max:86400},tips:"OPTIONS预检请求的缓存时间，0表示不缓存，最大86400秒(24小时)"}]},{field:"allowOriginsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowOrigins",label:"允许的源",type:"custom",span:24,defaultValue:[],required:!0,tabKey:"basic",tips:"支持具体域名(https://example.com)、通配符(*)，建议避免使用*以提高安全性",render:t("allowOrigins","输入允许的源，如：https://example.com"),rules:[{required:!0,message:"请至少配置一个允许的源",trigger:"blur",validator:(h,p)=>!p||p.length===0?new Error("请至少配置一个允许的源"):!0}]}]},{field:"allowMethodsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowMethods",label:"允许的HTTP方法",type:"custom",span:24,defaultValue:["GET","POST","PUT","DELETE","OPTIONS"],required:!0,tabKey:"basic",tips:"常用方法：GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD",render:t("allowMethods","输入HTTP方法，如：GET, POST"),rules:[{required:!0,message:"请至少配置一个允许的HTTP方法",trigger:"blur",validator:(h,p)=>!p||p.length===0?new Error("请至少配置一个允许的HTTP方法"):!0}]}]},{field:"headersConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowHeaders",label:"允许的请求头",type:"custom",span:12,defaultValue:["Content-Type","Authorization","X-Requested-With"],tabKey:"basic",tips:"如：Content-Type, Authorization, X-Requested-With",render:t("allowHeaders","输入允许的请求头")},{field:"exposeHeaders",label:"暴露的响应头",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"浏览器可以访问的自定义响应头",render:t("exposeHeaders","输入暴露的响应头")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"noteText",label:"备注",type:"textarea",span:24,disabled:!0,tabKey:"other"}];return{moduleId:r,loading:d,formTabs:n,formFields:v}}function qt(r){const d=Y(),t=Jt(r),{loading:n}=t;return{model:t,getConfigDetail:async l=>{try{const a=await At(l);return L(a)?N(a,null):(d.error(x(a,"获取CORS配置详情失败")),null)}catch{return d.error("获取CORS配置详情失败"),null}},addConfig:async l=>{n.value=!0;try{const a=await Ct(l);return L(a)?(d.success(x(a,"新增CORS配置成功")),!0):(d.error(x(a,"新增CORS配置失败")),!1)}catch{return d.error("新增CORS配置失败"),!1}finally{n.value=!1}},editConfig:async l=>{n.value=!0;try{const a=await It(l);return L(a)?(d.success(x(a,"编辑CORS配置成功")),!0):(d.error(x(a,"编辑CORS配置失败")),!1)}catch{return d.error("编辑CORS配置失败"),!1}finally{n.value=!1}}}}function Wt(r){Y();const d=qt(r.moduleId.value),t=k(!1),n=k("create"),v=k(null),h=g=>{const i=o=>{if(Array.isArray(o))return o;if(typeof o=="string"&&o)try{return JSON.parse(o)}catch{return[]}return[]};return{...g,allowOrigins:i(g.allowOrigins),allowMethods:typeof g.allowMethods=="string"?g.allowMethods.split(",").map(o=>o.trim()).filter(o=>o):Array.isArray(g.allowMethods)?g.allowMethods:[],allowHeaders:i(g.allowHeaders),exposeHeaders:i(g.exposeHeaders)}},p=g=>({...g,allowOrigins:Array.isArray(g.allowOrigins)?JSON.stringify(g.allowOrigins):g.allowOrigins,allowMethods:Array.isArray(g.allowMethods)?g.allowMethods.join(","):g.allowMethods,allowHeaders:Array.isArray(g.allowHeaders)?JSON.stringify(g.allowHeaders):g.allowHeaders,exposeHeaders:Array.isArray(g.exposeHeaders)?JSON.stringify(g.exposeHeaders):g.exposeHeaders}),l=async()=>{var f,c;const g=(f=r.gatewayInstanceId)==null?void 0:f.value,i=(c=r.routeConfigId)==null?void 0:c.value;if(!g&&!i)return;const o=await d.getConfigDetail({gatewayInstanceId:g,routeConfigId:i});o?(v.value=h(o),n.value="edit"):(v.value=null,n.value="create")},a=async()=>{await l(),t.value=!0},y=()=>{t.value=!1,v.value=null},u=async g=>{var o,f;if(!g||n.value==="view")return;const i=p(g);if((o=r.gatewayInstanceId)!=null&&o.value&&(i.gatewayInstanceId=r.gatewayInstanceId.value),(f=r.routeConfigId)!=null&&f.value&&(i.routeConfigId=r.routeConfigId.value),n.value==="create")await d.addConfig(i)&&await l();else if(n.value==="edit"){if(!v.value)return;const c={...p(v.value),...i,corsConfigId:v.value.corsConfigId,tenantId:v.value.tenantId};await d.editConfig(c)&&await l()}};return E(()=>{var g,i;return[(g=r.gatewayInstanceId)==null?void 0:g.value,(i=r.routeConfigId)==null?void 0:i.value]},()=>{t.value&&l()}),{service:d,formDialogVisible:t,formDialogMode:n,currentEditConfig:v,openDialog:a,closeFormDialog:y,handleFormSubmit:u,loadConfig:l}}const jt={class:"cors-config-form-modal",id:"cors-config-form-modal"},zt=X({name:"CorsConfigFormModal",__name:"CorsConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(t.gatewayInstanceId),h=k(t.routeConfigId),p=k(t.moduleId),l=Wt({gatewayInstanceId:v,routeConfigId:h,moduleId:p}),{service:a,formDialogVisible:y,formDialogMode:u,currentEditConfig:g,openDialog:i,closeFormDialog:o,handleFormSubmit:f}=l,c=Z(()=>t.title?t.title:u.value==="create"?"新增CORS配置":u.value==="edit"?"编辑CORS配置":"查看CORS配置详情");E(()=>t.visible,async b=>{b?(v.value=t.gatewayInstanceId,h.value=t.routeConfigId,p.value=t.moduleId,y.value&&(o(),await fe()),await i()):y.value&&o()});const P=b=>{b||(n("update:visible",!1),n("close"),n("refresh"))};return(b,e)=>(te(),Ae("div",jt,[D(ee,{visible:m(y),"onUpdate:visible":[e[0]||(e[0]=s=>ae(y)?y.value=s:null),P],mode:m(u),title:c.value,width:t.width||800,to:t.to||"#cors-config-form-modal","form-fields":m(a).model.formFields,"form-tabs":m(a).model.formTabs,"initial-data":m(g)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(a).model.loading.value,onSubmit:m(f)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])]))}}),Oa=le(zt,[["__scopeId","data-v-03d3ceef"]]);function $t(r){const d=k(!1),t=k([]),n=k(),v={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:be,type:"primary",tooltip:"新建域名访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:we,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},h=(f,c)=>P=>{const b=P[f]||[];return C(j,{value:b,"onUpdate:value":e=>{P[f]=e},inputProps:{placeholder:c}})},p=[{field:"domainAccessConfigId",label:"域名访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:f=>C(ge,{trigger:"hover",placement:"top"},{trigger:()=>C("div",{style:"width: 100%;"},[C(se,{value:f.defaultPolicy,"onUpdate:value":c=>{f.defaultPolicy=c},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>C("div",{style:"max-width: 320px; line-height: 1.5;"},[C("p",{style:"margin: 0 0 8px 0;"},[C("strong","默认策略说明：")]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的域名会被拒绝"]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的域名才被允许"]),C("p",{style:"margin: 0; color: #f0a020;"},[C("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的域名都会被拒绝"])])})},{field:"allowSubdomains",label:"允许子域名",type:"switch",span:12,defaultValue:"Y",tips:"是否允许匹配子域名（如：*.example.com）",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistDomains",label:"域名白名单",type:"custom",span:24,defaultValue:[],tips:"如：example.com, api.example.com，白名单中的域名将被允许访问",render:h("whitelistDomains","输入允许的域名，如：example.com")}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistDomains",label:"域名黑名单",type:"custom",span:24,defaultValue:[],tips:"优先级高于白名单，直接拒绝访问",render:h("blacklistDomains","输入禁止的域名，如：malicious.com")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:r,loading:d,configList:t,pageInfo:n,searchFormConfig:v,formFields:p,gridConfig:{columns:[{field:"domainAccessConfigId",title:"域名访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"allowSubdomains",title:"允许子域名",align:"center",width:120,slots:{default:"allowSubdomains"}},{field:"whitelistDomains",title:"域名白名单",align:"left",width:300,showOverflow:!0},{field:"blacklistDomains",title:"域名黑名单",align:"left",width:300,showOverflow:!0},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?$(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?$(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},setConfigList:f=>{t.value=f},updatePagination:f=>{n.value?Object.assign(n.value,f):n.value=f},resetPagination:()=>{n.value=void 0},addConfigToList:f=>{t.value.unshift(f)},updateConfigInList:(f,c,P)=>{const b=t.value.findIndex(e=>e.domainAccessConfigId===f&&e.tenantId===c);b!==-1&&Object.assign(t.value[b],P)},removeConfigFromList:(f,c)=>{const P=t.value.findIndex(b=>b.domainAccessConfigId===f&&b.tenantId===c);P!==-1&&t.value.splice(P,1)}}}function Gt(r,d,t){const n=Y(),v=ye(),h=$t(r),{loading:p,configList:l,pageInfo:a,setConfigList:y,updatePagination:u,addConfigToList:g,updateConfigInList:i,removeConfigFromList:o,resetPagination:f}=h,c=async I=>{var w,S,V;p.value=!0;try{let _=I;!_&&((w=t==null?void 0:t.value)!=null&&w.getFormData)&&(_=t.value.getFormData()||{});const H=_?Object.fromEntries(Object.entries(_).filter(([,U])=>U!==""&&U!==null&&U!==void 0)):{},R={...H,...re((S=a.value)==null?void 0:S.pageIndex,(V=a.value)==null?void 0:V.pageSize)};if(d!=null&&d.value)R.securityConfigId=d.value;else if(!H.securityConfigId){n.error("securityConfigId不能为空");return}const K=await wt(R);if(L(K)){const U=N(K,[]);y(U);const Q=pe(K);Q&&Object.keys(Q).length>0&&u(Q)}else n.error(x(K,"查询域名访问控制配置列表失败"))}catch{n.error("加载域名访问控制配置列表失败")}finally{p.value=!1}};return{model:h,loadConfigs:c,handleSearch:async I=>{f(),await c(I)},handleReset:async()=>{f(),await c()},handlePageChange:async({currentPage:I,pageSize:w})=>{u({pageIndex:I,pageSize:w}),await c()},handleRefresh:async()=>{await c()},addConfig:async I=>{p.value=!0;try{const w=await mt(I);if(L(w)){n.success(x(w,"新增域名访问控制配置成功"));const S=N(w,null);return S?g(S):await c(),!0}else return n.error(x(w,"新增域名访问控制配置失败")),!1}catch{return n.error("新增域名访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async I=>{p.value=!0;try{const w=await bt(I);if(L(w)){n.success(x(w,"编辑域名访问控制配置成功"));const S=N(w,null);return S?i(S.domainAccessConfigId,S.tenantId,S):await c(),!0}else return n.error(x(w,"编辑域名访问控制配置失败")),!1}catch{return n.error("编辑域名访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async I=>{if(!await v.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除域名访问控制配置 "${I.configName}" 吗？`,icon:Ce,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const S=await vt({domainAccessConfigId:I.domainAccessConfigId,tenantId:I.tenantId});return L(S)?(n.success(x(S,"删除域名访问控制配置成功")),o(I.domainAccessConfigId,I.tenantId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(u({pageIndex:a.value.pageIndex-1}),await c()),!0):(n.error(x(S,"删除域名访问控制配置失败")),!1)}catch{return n.error("删除域名访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async I=>{try{const w=await yt({domainAccessConfigId:I});return L(w)?N(w,{}):(n.error(x(w,"获取域名访问控制配置详情失败")),null)}catch{return n.error("获取域名访问控制配置详情失败"),null}}}}function Xt(r,d,t,n){const v=Y(),h=Gt(r.value,t,n),p=k(!1),l=k("create"),a=k(null),y=e=>({...e,whitelistDomains:J(e.whitelistDomains),blacklistDomains:J(e.blacklistDomains)}),u=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.domainAccessConfigId)try{const s=await h.getConfigDetail(e.domainAccessConfigId);if(s){l.value="edit",a.value=y(s),p.value=!0;return}}catch{}l.value="edit",a.value=y(e),p.value=!0},i=()=>{p.value=!1,a.value=null},o=async e=>{if(e.domainAccessConfigId)try{const s=await h.getConfigDetail(e.domainAccessConfigId);if(s){l.value="view",a.value=y(s),p.value=!0;return}}catch{}l.value="view",a.value=y(e),p.value=!0};return{service:h,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:u,openEditDialog:g,openViewDialog:o,closeFormDialog:i,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistDomains:Array.isArray(e.whitelistDomains)?JSON.stringify(e.whitelistDomains):e.whitelistDomains,blacklistDomains:Array.isArray(e.blacklistDomains)?JSON.stringify(e.blacklistDomains):e.blacklistDomains};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){v.error("安全配置ID不能为空");return}s.securityConfigId=T,await h.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await h.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){v.warning("请先选择安全配置");return}u(T);break;case"edit":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要编辑的配置");return}g(A);break}case"delete":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要删除的配置");return}await h.deleteConfig(A);break}case"search":{await h.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":o(s);break;case"edit":g(s);break;case"delete":await h.deleteConfig(s);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const Qt={class:"domain-access-config-list-modal",id:"domain-access-config-list-modal"},Zt=X({name:"DomainAccessConfigListModal",__name:"DomainAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"域名访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(),h=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s}),E(()=>t.moduleId,s=>{p.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:y,formDialogVisible:u,formDialogMode:g,currentEditConfig:i,handleFormSubmit:o,handleToolbarClick:f,handleMenuClick:c,handleSearch:P}=Xt(p,h,a,v),b=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(u.value=!1,g.value="create",i.value=null,y.model.configList.value=[],y.model.resetPagination())};return(s,T)=>(te(),he(m(de),{visible:l.value,title:t.title||"域名访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":b,onAfterLeave:e},{default:F(()=>[me("div",Qt,[D(m(ce),{direction:"vertical","no-resize":!0},{1:F(()=>[D(ue,G({ref_key:"searchFormRef",ref:v,"module-id":m(y).model.moduleId},m(y).model.searchFormConfig,{onSearch:m(P),onToolbarClick:m(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:F(()=>[D(m(oe),G({ref_key:"gridRef",ref:h,"module-id":m(y).model.moduleId,data:m(y).model.configList,loading:m(y).model.loading},m(y).model.gridConfig,{onPageChange:m(y).handlePageChange,onMenuClick:m(c)}),{defaultPolicy:F(({row:A})=>[D(m(B),{type:A.defaultPolicy==="allow"?"success":"error",size:"small"},{default:F(()=>[q(W(A.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:F(({row:A})=>[D(m(B),{type:A.activeFlag==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),allowSubdomains:F(({row:A})=>[D(m(B),{type:A.allowSubdomains==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.allowSubdomains==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(ee,{visible:m(u),"onUpdate:visible":T[0]||(T[0]=A=>ae(u)?u.value=A:null),mode:m(g),title:m(g)==="create"?"新增域名访问控制配置":m(g)==="edit"?"编辑域名访问控制配置":"查看域名访问控制配置详情",to:"#domain-access-config-list-modal","form-fields":m(y).model.formFields,"initial-data":m(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(y).model.loading.value,onSubmit:m(o)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),Fa=le(Zt,[["__scopeId","data-v-3cffb1cb"]]);function ea(r){const d=k(!1),t=k([]),n=k(),v={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:be,type:"primary",tooltip:"新建IP访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:we,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},h=b=>e=>{const s=e[b]||[];return C(j,{value:s,"onUpdate:value":T=>{e[b]=T},inputProps:{placeholder:"输入IP地址，如：192.168.1.100"}})},p=b=>e=>{const s=e[b]||[];return C(j,{value:s,"onUpdate:value":T=>{e[b]=T},inputProps:{placeholder:"输入CIDR网段，如：192.168.1.0/24"}})},l=[{field:"ipAccessConfigId",label:"IP访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:b=>C(ge,{trigger:"hover",placement:"top"},{trigger:()=>C("div",{style:"width: 100%;"},[C(se,{value:b.defaultPolicy,"onUpdate:value":e=>{b.defaultPolicy=e},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>C("div",{style:"max-width: 320px; line-height: 1.5;"},[C("p",{style:"margin: 0 0 8px 0;"},[C("strong","默认策略说明：")]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的IP会被拒绝"]),C("p",{style:"margin: 0 0 8px 0;"},[C("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的IP才被允许"]),C("p",{style:"margin: 0; color: #f0a020;"},[C("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的IP都会被拒绝"])])})},{field:"trustXForwardedFor",label:"信任X-Forwarded-For",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"trustXRealIp",label:"信任X-Real-IP",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistIps",label:"IP白名单",type:"custom",span:12,defaultValue:[],tips:"精确匹配单个IP地址，白名单中的IP将被允许访问",render:h("whitelistIps"),rules:[{validator:(b,e)=>{if(!e||e.length===0)return!0;const s=Te(e);return s.valid?!0:new Error(`无效的IP地址：${s.invalidIps.join(", ")}`)},trigger:["blur","input"]}]},{field:"whitelistCidrs",label:"CIDR白名单",type:"custom",span:12,defaultValue:[],tips:"匹配网段范围，如：192.168.1.0/24（192.168.1.1-254）",render:p("whitelistCidrs"),rules:[{validator:(b,e)=>{if(!e||e.length===0)return!0;const s=Se(e);return s.valid?!0:new Error(`无效的CIDR网段：${s.invalidCidrs.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistIps",label:"IP黑名单",type:"custom",span:12,defaultValue:[],tips:"精确匹配单个IP地址，黑名单优先级最高，直接拒绝访问",render:h("blacklistIps"),rules:[{validator:(b,e)=>{if(!e||e.length===0)return!0;const s=Te(e);return s.valid?!0:new Error(`无效的IP地址：${s.invalidIps.join(", ")}`)},trigger:["blur","input"]}]},{field:"blacklistCidrs",label:"CIDR黑名单",type:"custom",span:12,defaultValue:[],tips:"匹配网段范围，黑名单优先级最高，直接拒绝访问",render:p("blacklistCidrs"),rules:[{validator:(b,e)=>{if(!e||e.length===0)return!0;const s=Se(e);return s.valid?!0:new Error(`无效的CIDR网段：${s.invalidCidrs.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}],a={columns:[{field:"ipAccessConfigId",title:"IP访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"whitelistIps",title:"IP白名单",align:"left",width:200,showOverflow:!0},{field:"whitelistCidrs",title:"CIDR白名单",align:"left",width:200,showOverflow:!0},{field:"blacklistIps",title:"IP黑名单",align:"left",width:200,showOverflow:!0},{field:"blacklistCidrs",title:"CIDR黑名单",align:"left",width:200,showOverflow:!0},{field:"trustXForwardedFor",title:"信任X-Forwarded-For",align:"center",width:150,slots:{default:"trustXForwardedFor"}},{field:"trustXRealIp",title:"信任X-Real-IP",align:"center",width:130,slots:{default:"trustXRealIp"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:b})=>b?$(b,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:b})=>b?$(b,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},y=()=>{n.value=void 0},u=b=>{n.value?Object.assign(n.value,b):n.value=b},g=b=>{t.value=b},i=()=>{t.value=[]},o=b=>{t.value.unshift(b)},f=(b,e,s)=>{const T=t.value.findIndex(A=>A.ipAccessConfigId===b&&A.tenantId===e);T!==-1&&Object.assign(t.value[T],s)},c=(b,e)=>{const s=t.value.findIndex(T=>T.ipAccessConfigId===b&&T.tenantId===e);s!==-1&&t.value.splice(s,1)};return{moduleId:r,loading:d,configList:t,pageInfo:n,searchFormConfig:v,formFields:l,gridConfig:a,resetPagination:y,updatePagination:u,setConfigList:g,clearConfigList:i,addConfigToList:o,updateConfigInList:f,removeConfigFromList:c,removeConfigsFromList:b=>{b.forEach(e=>{c(e.ipAccessConfigId,e.tenantId)})}}}function ta(r,d,t){const n=Y(),v=ye(),h=ea(r),{loading:p,configList:l,pageInfo:a,setConfigList:y,updatePagination:u,addConfigToList:g,updateConfigInList:i,removeConfigFromList:o}=h,f=async O=>{var I,w,S;p.value=!0;try{let V=O;!V&&((I=t==null?void 0:t.value)!=null&&I.getFormData)&&(V=t.value.getFormData()||{});const _=V?Object.fromEntries(Object.entries(V).filter(([,K])=>K!==""&&K!==null&&K!==void 0)):{},H={..._,...re((w=a.value)==null?void 0:w.pageIndex,(S=a.value)==null?void 0:S.pageSize)};if(d!=null&&d.value)H.securityConfigId=d.value;else if(!_.securityConfigId){n.error("securityConfigId不能为空");return}const R=await nt(H);if(L(R)){const K=N(R,[]);y(K);const U=pe(R);U&&Object.keys(U).length>0&&u(U)}else n.error(x(R,"查询IP访问控制配置列表失败"))}catch{n.error("加载IP访问控制配置列表失败")}finally{p.value=!1}};return{model:h,loadConfigs:f,handleSearch:async O=>{h.resetPagination(),await f(O)},handleReset:async()=>{h.resetPagination(),await f()},handlePageChange:async({currentPage:O,pageSize:I})=>{u({pageIndex:O,pageSize:I}),await f()},handleRefresh:async()=>{await f()},addConfig:async O=>{p.value=!0;try{const I=await tt(O);if(L(I)){n.success(x(I,"新增IP访问控制配置成功"));const w=N(I,null);return w?g(w):await f(),!0}else return n.error(x(I,"新增IP访问控制配置失败")),!1}catch{return n.error("新增IP访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async O=>{p.value=!0;try{const I=await lt(O);if(L(I)){n.success(x(I,"编辑IP访问控制配置成功"));const w=N(I,null);return w?i(w.ipAccessConfigId,w.tenantId,w):await f(),!0}else return n.error(x(I,"编辑IP访问控制配置失败")),!1}catch{return n.error("编辑IP访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async O=>{if(!await v.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除IP访问控制配置 "${O.configName}" 吗？`,icon:Ce,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const w=await it({ipAccessConfigId:O.ipAccessConfigId,tenantId:O.tenantId});return L(w)?(n.success(x(w,"删除IP访问控制配置成功")),o(O.ipAccessConfigId,O.tenantId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(u({pageIndex:a.value.pageIndex-1}),await f()),!0):(n.error(x(w,"删除IP访问控制配置失败")),!1)}catch{return n.error("删除IP访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async O=>{try{const I=await at({ipAccessConfigId:O});return L(I)?N(I,{}):(n.error(x(I,"获取IP访问控制配置详情失败")),null)}catch{return n.error("获取IP访问控制配置详情失败"),null}}}}function aa(r,d,t,n){const v=Y(),h=ta(r.value,t,n),p=k(!1),l=k("create"),a=k(null),y=e=>({...e,whitelistIps:J(e.whitelistIps),blacklistIps:J(e.blacklistIps),whitelistCidrs:J(e.whitelistCidrs),blacklistCidrs:J(e.blacklistCidrs)}),u=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.ipAccessConfigId)try{const s=await h.getConfigDetail(e.ipAccessConfigId);if(s){l.value="edit",a.value=y(s),p.value=!0;return}}catch{}l.value="edit",a.value=y(e),p.value=!0},i=()=>{p.value=!1,a.value=null},o=async e=>{if(e.ipAccessConfigId)try{const s=await h.getConfigDetail(e.ipAccessConfigId);if(s){l.value="view",a.value=y(s),p.value=!0;return}}catch{}l.value="view",a.value=y(e),p.value=!0};return{service:h,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:u,openEditDialog:g,openViewDialog:o,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistIps:Array.isArray(e.whitelistIps)?JSON.stringify(e.whitelistIps):e.whitelistIps,blacklistIps:Array.isArray(e.blacklistIps)?JSON.stringify(e.blacklistIps):e.blacklistIps,whitelistCidrs:Array.isArray(e.whitelistCidrs)?JSON.stringify(e.whitelistCidrs):e.whitelistCidrs,blacklistCidrs:Array.isArray(e.blacklistCidrs)?JSON.stringify(e.blacklistCidrs):e.blacklistCidrs};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){v.error("安全配置ID不能为空");return}s.securityConfigId=T,await h.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await h.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){v.warning("请先选择安全配置");return}u(T);break;case"edit":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要编辑的配置");return}g(A);break}case"delete":{if(!(d!=null&&d.value)){v.warning("Grid 引用未设置");return}const A=d.value.getCurrentRecord();if(!A){v.warning("请先点击选择要删除的配置");return}await h.deleteConfig(A);break}case"search":{await h.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":o(s);break;case"edit":g(s);break;case"delete":await h.deleteConfig(s);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const la={class:"ip-access-config-list-modal",id:"ip-access-config-list-modal"},ia=X({name:"IpAccessConfigListModal",__name:"IpAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"IP访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(),h=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s}),E(()=>t.moduleId,s=>{p.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:y,formDialogVisible:u,formDialogMode:g,currentEditConfig:i,handleFormSubmit:o,handleToolbarClick:f,handleMenuClick:c,handleSearch:P}=aa(p,h,a,v),b=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(u.value=!1,g.value="create",i.value=null,y.model.configList.value=[],y.model.resetPagination())};return(s,T)=>(te(),he(m(de),{visible:l.value,title:t.title||"IP访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":b,onAfterLeave:e},{default:F(()=>[me("div",la,[D(m(ce),{direction:"vertical","no-resize":!0},{1:F(()=>[D(ue,G({ref_key:"searchFormRef",ref:v,"module-id":m(y).model.moduleId},m(y).model.searchFormConfig,{onSearch:m(P),onToolbarClick:m(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:F(()=>[D(m(oe),G({ref_key:"gridRef",ref:h,"module-id":m(y).model.moduleId,data:m(y).model.configList,loading:m(y).model.loading},m(y).model.gridConfig,{onPageChange:m(y).handlePageChange,onMenuClick:m(c)}),{defaultPolicy:F(({row:A})=>[D(m(B),{type:A.defaultPolicy==="allow"?"success":"error",size:"small"},{default:F(()=>[q(W(A.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:F(({row:A})=>[D(m(B),{type:A.activeFlag==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),trustXForwardedFor:F(({row:A})=>[D(m(B),{type:A.trustXForwardedFor==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.trustXForwardedFor==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),trustXRealIp:F(({row:A})=>[D(m(B),{type:A.trustXRealIp==="Y"?"success":"default",size:"small"},{default:F(()=>[q(W(A.trustXRealIp==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(ee,{visible:m(u),"onUpdate:visible":T[0]||(T[0]=A=>ae(u)?u.value=A:null),mode:m(g),title:m(g)==="create"?"新增IP访问控制配置":m(g)==="edit"?"编辑IP访问控制配置":"查看IP访问控制配置详情",to:"#ip-access-config-list-modal","form-fields":m(y).model.formFields,"initial-data":m(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(y).model.loading.value,onSubmit:m(o)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),Da=le(ia,[["__scopeId","data-v-5fe62d38"]]);function na(r){const d=k(!1),t=[{label:"IP策略",value:"ip"},{label:"用户策略",value:"user"},{label:"路径策略",value:"path"},{label:"服务策略",value:"service"},{label:"路由策略",value:"route"}],n=[{label:"令牌桶算法",value:"token-bucket"},{label:"漏桶算法",value:"leaky-bucket"},{label:"滑动窗口算法",value:"sliding-window"},{label:"固定窗口算法",value:"fixed-window"},{label:"无限流",value:"none"}],v=()=>l=>{const a=l.algorithm;return a==="token-bucket"?C(ne,{type:"info"},{default:()=>C(ie,null,{default:()=>[C("strong",null,"令牌桶算法："),"以固定速率向桶中放入令牌，请求需要消耗令牌才能通过。支持突发流量，桶满时多余令牌会被丢弃。",C("br"),"• 限流速率：每秒向桶中填充的令牌数（令牌/秒）",C("br"),"• 突发容量：桶的最大容量（最大令牌数），决定了最大突发请求数"]})}):a==="leaky-bucket"?C(ne,{type:"info"},{default:()=>C(ie,null,{default:()=>[C("strong",null,"漏桶算法："),"请求先进入桶中，然后以固定速率从桶中流出。能够平滑突发流量，但不支持突发处理。",C("br"),"• 限流速率：每秒从桶中漏出的请求数（处理速率）",C("br"),"• 突发容量：桶的最大容量（最大可容纳的请求数），超出时请求会被拒绝"]})}):a==="sliding-window"?C(ne,{type:"info"},{default:()=>C(ie,null,{default:()=>[C("strong",null,"滑动窗口算法："),"在固定时间窗口内限制请求数量。窗口会随时间滑动，提供更精确的限流控制，避免边界突刺问题。",C("br"),"• 限流速率：时间窗口内允许的最大请求数",C("br"),"• 时间窗口：统计请求数量的时间范围（秒）"]})}):a==="fixed-window"?C(ne,{type:"info"},{default:()=>C(ie,null,{default:()=>[C("strong",null,"固定窗口算法："),"在固定时间窗口内限制请求数量。窗口到期后重置计数器，可能出现边界突发（临界问题）。",C("br"),"• 限流速率：时间窗口内允许的最大请求数",C("br"),"• 时间窗口：统计请求数量的时间范围（秒）"]})}):a==="none"?C(ne,{type:"warning"},{default:()=>C(ie,null,{default:()=>[C("strong",null,"无限流："),"不进行任何限流控制，所有请求都会通过。通常用于临时关闭限流或测试环境。"]})}):C("div")},h=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],p=[{field:"rateLimitConfigId",label:"限流配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"limitName",label:"限流规则名称",type:"input",placeholder:"请输入限流规则名称",span:12,required:!0,defaultValue:"限流规则",tabKey:"basic"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"keyStrategy",label:"限流键策略",type:"select",span:12,required:!0,defaultValue:"ip",tabKey:"basic",props:{options:t,placeholder:"选择限流键策略"},tips:"IP策略：按IP地址限流；用户策略：按用户ID限流；路径策略：按请求路径限流；服务策略：按服务名限流；路由策略：按路由配置限流"},{field:"algorithm",label:"限流算法",type:"select",span:12,required:!0,defaultValue:"token-bucket",tabKey:"basic",props:{options:n,placeholder:"选择限流算法"},tips:"支持令牌桶、漏桶、滑动窗口、固定窗口等限流算法"}]},{field:"limitParamsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"limitRate",label:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"填充速率(令牌/秒)":a==="leaky-bucket"?"漏出速率(请求/秒)":a==="sliding-window"||a==="fixed-window"?"窗口内最大请求数":"限流速率(次/秒)"},type:"number",placeholder:"每秒允许的请求数",span:12,required:!0,defaultValue:100,tabKey:"basic",props:{min:1,max:1e4},tips:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"每秒向桶中填充的令牌数（令牌/秒）。每个请求需要消耗一个令牌才能通过。":a==="leaky-bucket"?"每秒从桶中漏出的请求数（处理速率）。无论输入如何，输出速率都严格限制为此值。":a==="sliding-window"||a==="fixed-window"?"时间窗口内允许的最大请求数。超过此数量的请求将被拒绝。":"每秒允许通过的请求数量"}},{field:"burstCapacity",label:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"桶容量(令牌)":a==="leaky-bucket"?"桶容量(请求)":"突发容量"},type:"number",placeholder:"允许的突发请求数",span:12,required:!0,defaultValue:200,tabKey:"basic",show:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"||a==="leaky-bucket"},props:{min:0,max:1e5},tips:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"桶的最大容量（最大令牌数）。桶满时可以处理此数量的突发请求。":a==="leaky-bucket"?"桶的最大容量（最大可容纳的请求数）。超出此容量时，新请求会被拒绝。":"允许的突发请求数量，用于令牌桶和漏桶算法"}},{field:"timeWindowSeconds",label:"时间窗口(秒)",type:"number",placeholder:"限流时间窗口",span:12,required:!0,defaultValue:1,tabKey:"basic",show:l=>{const a=l==null?void 0:l.algorithm;return a==="sliding-window"||a==="fixed-window"},props:{min:1,max:3600},tips:l=>{const a=l==null?void 0:l.algorithm;return a==="sliding-window"?"滑动时间窗口的大小（秒）。窗口会随时间滑动，提供更精确的限流控制。":a==="fixed-window"?"固定时间窗口的大小（秒）。窗口到期后重置计数器，可能出现边界突发。":"限流时间窗口，用于滑动窗口和固定窗口算法"}},{field:"rejectionStatusCode",label:"拒绝状态码",type:"number",placeholder:"限流时返回的HTTP状态码",span:12,required:!0,defaultValue:429,tabKey:"basic",props:{min:400,max:599},tips:"限流时返回的HTTP状态码，通常为429（Too Many Requests）"},{field:"rejectionMessage",label:"拒绝提示消息",type:"input",placeholder:"限流时的提示消息",span:24,required:!0,defaultValue:"请求过于频繁，请稍后再试",tabKey:"basic",tips:"限流时返回给客户端的错误消息"}]},{field:"algorithmDescription",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"algorithmDesc",label:"算法说明",type:"custom",span:24,tabKey:"basic",show:l=>l.algorithm&&l.algorithm!=="none",render:v()}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"noteText",label:"备注",type:"textarea",span:24,tabKey:"other",placeholder:"请输入备注信息"}];return{moduleId:r,loading:d,formTabs:h,formFields:p}}function sa(r){const d=Y(),t=na(r),{loading:n}=t;return{model:t,getConfigDetail:async l=>{try{const a=await Ot(l);return L(a)?N(a,null):(d.error(x(a,"获取限流配置详情失败")),null)}catch{return d.error("获取限流配置详情失败"),null}},addConfig:async l=>{n.value=!0;try{const a=await St(l);return L(a)?(d.success(x(a,"新增限流配置成功")),!0):(d.error(x(a,"新增限流配置失败")),!1)}catch{return d.error("新增限流配置失败"),!1}finally{n.value=!1}},editConfig:async l=>{n.value=!0;try{const a=await xt(l);return L(a)?(d.success(x(a,"编辑限流配置成功")),!0):(d.error(x(a,"编辑限流配置失败")),!1)}catch{return d.error("编辑限流配置失败"),!1}finally{n.value=!1}}}}function ra(r){Y();const d=sa(r.moduleId.value),t=k(!1),n=k("create"),v=k(null),h=g=>({...g,customConfig:(o=>{if(typeof o=="string"&&o)try{return JSON.parse(o)}catch{return o}return o})(g.customConfig)||{}}),p=g=>({...g,customConfig:typeof g.customConfig=="object"?JSON.stringify(g.customConfig):g.customConfig||"{}"}),l=async()=>{var f,c;const g=(f=r.gatewayInstanceId)==null?void 0:f.value,i=(c=r.routeConfigId)==null?void 0:c.value;if(!g&&!i)return;const o=await d.getConfigDetail({gatewayInstanceId:g,routeConfigId:i});o?(v.value=h(o),n.value="edit"):(v.value=null,n.value="create")},a=async()=>{await l(),t.value=!0},y=()=>{t.value=!1,v.value=null},u=async g=>{var o,f;if(!g||n.value==="view")return;const i=p(g);if((o=r.gatewayInstanceId)!=null&&o.value&&(i.gatewayInstanceId=r.gatewayInstanceId.value),(f=r.routeConfigId)!=null&&f.value&&(i.routeConfigId=r.routeConfigId.value),n.value==="create")await d.addConfig(i)&&await l();else if(n.value==="edit"){if(!v.value)return;const c={...i,rateLimitConfigId:v.value.rateLimitConfigId,tenantId:v.value.tenantId};await d.editConfig(c)&&await l()}};return E(()=>{var g,i;return[(g=r.gatewayInstanceId)==null?void 0:g.value,(i=r.routeConfigId)==null?void 0:i.value]},()=>{t.value&&l()}),{service:d,formDialogVisible:t,formDialogMode:n,currentEditConfig:v,openDialog:a,closeFormDialog:y,handleFormSubmit:u,loadConfig:l}}const oa={class:"rate-limit-config-form-modal",id:"rate-limit-config-form-modal"},ua=X({name:"RateLimitConfigFormModal",__name:"RateLimitConfigFormModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(r,{emit:d}){const t=r,n=d,v=k(t.gatewayInstanceId),h=k(t.routeConfigId),p=k(t.moduleId),l=ra({gatewayInstanceId:v,routeConfigId:h,moduleId:p}),{service:a,formDialogVisible:y,formDialogMode:u,currentEditConfig:g,openDialog:i,closeFormDialog:o,handleFormSubmit:f}=l,c=Z(()=>t.title?t.title:u.value==="create"?"新增限流配置":u.value==="edit"?"编辑限流配置":"查看限流配置详情");E(()=>t.visible,async b=>{b?(v.value=t.gatewayInstanceId,h.value=t.routeConfigId,p.value=t.moduleId,y.value&&(o(),await fe()),await i()):y.value&&o()});const P=b=>{b||(n("update:visible",!1),n("close"),n("refresh"))};return(b,e)=>(te(),Ae("div",oa,[D(ee,{visible:m(y),"onUpdate:visible":[e[0]||(e[0]=s=>ae(y)?y.value=s:null),P],mode:m(u),title:c.value,width:t.width||800,to:t.to||"#rate-limit-config-form-modal","form-fields":m(a).model.formFields,"form-tabs":m(a).model.formTabs,"initial-data":m(g)||void 0,"auto-close-on-confirm":!1,"confirm-loading":m(a).model.loading.value,onSubmit:m(f)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])]))}}),Va=le(ua,[["__scopeId","data-v-1d0aa81a"]]);export{Sa as A,Oa as C,Fa as D,Da as I,j as N,Va as R,Ta as U,xa as a};

import{G as j,S as te}from"./SearchForm-C8LTWaYg.js";import{G as Z}from"./GDataFormModal-gmXxtq1x.js";import{G as Y}from"./GCard-fZHfsnnc.js";import{G as q}from"./GPane-D8xjug3o.js";import{d as K,db as oe,m as X,c as A,o as k,b as i,e,am as V,w as a,bV as ne,g as J,h as z,J as G,K as b,t as C,aO as B,r as N,aa as re,_ as W,f as $,i as Q,bW as ce,bX as F,q as de,j as ee,cr as ae}from"./index-ESHYz3i9.js";import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-C1Vti-fj.js";import"./useNamespaceService-0bQNacss.js";import{u as ue}from"./useNamespacePage-DSAd-HQf.js";/* empty css                                                                              */import{G as me}from"./GTextShow-DlOCcva3.js";import{e as fe,o as ve,a as pe,u as he}from"./useServiceService-DwdhwEjK.js";import{c as ge}from"./index-D1t35l7m.js";import{C as be}from"./CreateOutline--XfT6bD4.js";import{A as Se}from"./ArrowBackOutline-Degg1Yks.js";import{u as Ne}from"./useGDialog-B-gHIdxi.js";import"./RefreshOutline-DOzShYFT.js";import"./Select-BnP-dm7-.js";import"./GModal-LRdvAYBQ.js";import"./ContractOutline-B9EpDXpK.js";import"./CloseOutline-CgDR_1U8.js";import"./DownloadOutline-BED41JVn.js";import"./Upload-DBIwIbVZ.js";import"./download-C2161hUv.js";import"./DocumentOutline-CzFXHj6K.js";import"./useServiceCenterInstanceService-D8dXhTXq.js";import"./KeyOutline-mOR-j_95.js";import"./AddOutline-I2AMvI0I.js";import"./TrashOutline-BfDLtdZv.js";import"./DynamicTags-CAL5qUJa.js";import"./prop-NnGblK-3.js";import"./WarningOutline-sOXT_Ym-.js";import"./CheckmarkCircleOutline-C4di1qbH.js";import"./AlertCircleOutline-BSIn_YiE.js";import"./HourglassOutline-DAC4Qa65.js";import"./StopCircleOutline-s0vZCGh1.js";import"./EllipsisHorizontalOutline-B50J1pPB.js";import"./InputGroup-BvHp3tMx.js";import"./CopyOutline-sQiB4ajy.js";import"./CodeOutline-BxCvzJCL.js";import"./GDialog-CJLCnuOH.js";const Ce={class:"service-node-list",id:"service-node-list"},we=K({name:"ServiceNodeList",__name:"ServiceNodeList",props:{nodes:{default:()=>[]},loading:{type:Boolean,default:!1},moduleId:{default:"service-node-list"}},emits:["refresh"],setup(m,{emit:y}){const h=y,w=oe(),o=X(),g=N(!1),v=N(null),p=N(!1),r=[{field:"nodeId",label:"节点ID",type:"input",disabled:!0,required:!0},{field:"ipAddress",label:"IP地址",type:"input",disabled:!0,required:!0},{field:"portNumber",label:"端口号",type:"input",disabled:!0,required:!0},{field:"weight",label:"权重",type:"input",required:!0,defaultValue:1},{field:"instanceStatus",label:"实例状态",type:"select",required:!0,options:[{label:"运行中",value:"UP"},{label:"已下线",value:"DOWN"},{label:"启动中",value:"STARTING"},{label:"停止服务",value:"OUT_OF_SERVICE"}]},{field:"healthyStatus",label:"健康状态",type:"select",required:!0,options:[{label:"健康",value:"HEALTHY"},{label:"不健康",value:"UNHEALTHY"},{label:"未知",value:"UNKNOWN"}]},{field:"ephemeral",label:"临时实例",type:"select",required:!0,options:[{label:"是",value:"Y"},{label:"否",value:"N"}]},{field:"metadataJson",label:"元数据",type:"textarea",placeholder:"JSON 格式"}],n={columns:[{field:"nodeId",title:"节点ID",align:"center",width:200,showOverflow:!0,sortable:!0,filters:[{data:""}],filterRender:{name:"input"}},{field:"ipAddress",title:"IP",align:"center",showOverflow:!0,sortable:!0,filters:[{data:""}],filterRender:{name:"input"}},{field:"portNumber",title:"端口",align:"center",width:100,sortable:!0,filters:[{data:""}],filterRender:{name:"input"}},{field:"ephemeral",title:"临时实例",align:"center",width:100,slots:{default:"ephemeral"},filterRender:{name:"select",options:[{label:"全部",value:""},{label:"是",value:"Y"},{label:"否",value:"N"}]}},{field:"weight",title:"权重",align:"center",width:100,sortable:!0,filters:[{data:""}],filterRender:{name:"input"}},{field:"instanceStatus",title:"实例状态",align:"center",width:120,slots:{default:"instanceStatus"},filterRender:{name:"select",options:[{label:"全部",value:""},{label:"运行中",value:"UP"},{label:"已下线",value:"DOWN"},{label:"启动中",value:"STARTING"},{label:"停止服务",value:"OUT_OF_SERVICE"}]}},{field:"healthyStatus",title:"健康状态",align:"center",width:120,slots:{default:"healthyStatus"},filterRender:{name:"select",options:[{label:"全部",value:""},{label:"健康",value:"HEALTHY"},{label:"不健康",value:"UNHEALTHY"},{label:"未知",value:"UNKNOWN"}]}},{field:"metadataJson",title:"元数据",align:"left",showOverflow:!0,slots:{default:"metadataJson"}},{field:"lastBeatTime",title:"心跳时间",align:"center",width:180,sortable:!0,slots:{default:"lastBeatTime"}},{field:"action",title:"操作",align:"center",width:160,slots:{default:"action"}}],filterConfig:{remote:!1},showCheckbox:!1,showSeq:!0,paginationConfig:{show:!1},menuConfig:{enabled:!0,showCopyRow:!1,showCopyCell:!1,customMenus:[{code:"edit",name:"编辑"},{code:"online",name:"上线"},{code:"offline",name:"下线"},{code:"refresh",name:"刷新"}]},height:"100%"},S=t=>{if(!t)return"-";try{const l=JSON.parse(t);return Object.entries(l).map(([f,U])=>`${f}=${U}`).join(", ")}catch{return t}},_=t=>({UP:"success",DOWN:"error",STARTING:"warning",OUT_OF_SERVICE:"info"})[t]||"default",I=t=>({UP:"运行中",DOWN:"已下线",STARTING:"启动中",OUT_OF_SERVICE:"停止服务"})[t]||t,T=t=>({HEALTHY:"success",UNHEALTHY:"error",UNKNOWN:"warning"})[t]||"default",R=t=>({HEALTHY:"健康",UNHEALTHY:"不健康",UNKNOWN:"未知"})[t]||t,O=t=>t&&re(t,"YYYY-MM-DD HH:mm:ss")||"-",M=({code:t,row:l})=>{if(t==="refresh"){L();return}if(!l)return;const f=l;switch(t){case"edit":D(f);break;case"online":d(f);break;case"offline":c(f);break}},L=()=>{o.info("正在刷新节点列表..."),h("refresh")},D=t=>{v.value={...t},g.value=!0},x=t=>{d(t)},P=t=>{c(t)},s=async t=>{if(!t||!t.nodeId){o.error("节点ID不能为空");return}p.value=!0;try{const l=await fe(t);l.oK?(o.success("节点编辑成功"),g.value=!1,v.value=null,h("refresh")):o.error(l.messageId||"节点编辑失败")}catch(l){o.error(l.message||"节点编辑失败")}finally{p.value=!1}},d=t=>{w.warning({title:"确认上线",content:`确定要上线节点 ${t.ipAddress}:${t.portNumber} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const l=await ve(t.nodeId);l.oK?(o.success("节点上线成功"),h("refresh")):o.error(l.messageId||"节点上线失败")}catch(l){o.error(l.message||"节点上线失败")}}})},c=t=>{w.warning({title:"确认下线",content:`确定要下线节点 ${t.ipAddress}:${t.portNumber} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const l=await pe(t.nodeId);l.oK?(o.success("节点下线成功"),h("refresh")):o.error(l.messageId||"节点下线失败")}catch(l){o.error(l.message||"节点下线失败")}}})};return(t,l)=>(k(),A("div",Ce,[i(e(j),V({"module-id":m.moduleId,data:m.nodes,loading:m.loading},n,{onMenuClick:M}),{ephemeral:a(({row:f})=>[i(e(B),{type:f.ephemeral==="Y"?"warning":"default",size:"small"},{default:a(()=>[b(C(f.ephemeral==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),instanceStatus:a(({row:f})=>[i(e(B),{type:_(f.instanceStatus),size:"small"},{default:a(()=>[b(C(I(f.instanceStatus)),1)]),_:2},1032,["type"])]),healthyStatus:a(({row:f})=>[i(e(B),{type:T(f.healthyStatus),size:"small"},{default:a(()=>[b(C(R(f.healthyStatus)),1)]),_:2},1032,["type"])]),metadataJson:a(({row:f})=>[i(e(ge),{"line-clamp":1,tooltip:!1},{default:a(()=>[b(C(S(f.metadataJson)),1)]),_:2},1024)]),lastBeatTime:a(({row:f})=>[b(C(O(f.lastBeatTime)),1)]),action:a(({row:f})=>[i(e(ne),{size:8},{default:a(()=>[i(e(G),{size:"small",type:"primary",onClick:U=>D(f)},{default:a(()=>[...l[1]||(l[1]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"]),f.instanceStatus==="UP"?(k(),J(e(G),{key:0,size:"small",type:"warning",onClick:U=>P(f)},{default:a(()=>[...l[2]||(l[2]=[b(" 下线 ",-1)])]),_:1},8,["onClick"])):z("",!0),f.instanceStatus==="DOWN"?(k(),J(e(G),{key:1,size:"small",type:"success",onClick:U=>x(f)},{default:a(()=>[...l[3]||(l[3]=[b(" 上线 ",-1)])]),_:1},8,["onClick"])):z("",!0)]),_:2},1024)]),_:1},16,["module-id","data","loading"]),i(Z,{visible:g.value,"onUpdate:visible":l[0]||(l[0]=f=>g.value=f),mode:"edit",title:"编辑节点",to:"#service-node-list","form-fields":r,"initial-data":v.value||void 0,"auto-close-on-confirm":!1,"confirm-loading":p.value,onSubmit:s},null,8,["visible","initial-data","confirm-loading"])]))}}),ye=W(we,[["__scopeId","data-v-7f075df2"]]),ke={key:0,class:"service-detail"},_e={class:"service-detail-header"},Ie={class:"service-detail-actions"},Te={class:"instance-list-header"},Re=K({name:"ServiceDetail",__name:"ServiceDetail",props:{service:{default:null},loading:{type:Boolean,default:!1}},emits:["back","edit","refresh"],setup(m,{emit:y}){const h=y,w=r=>({INTERNAL:"内部服务",NACOS:"Nacos",CONSUL:"Consul",EUREKA:"Eureka",ETCD:"ETCD",ZOOKEEPER:"Zookeeper"})[r]||r,o=r=>{if(!r)return"none";try{return JSON.parse(r).type||"none"}catch{return"none"}},g=()=>{h("back")},v=()=>{h("edit")},p=()=>{h("refresh")};return(r,n)=>m.service?(k(),A("div",ke,[$("div",_e,[n[2]||(n[2]=$("h2",{class:"service-detail-title"},"服务详情",-1)),$("div",Ie,[i(e(G),{type:"default",onClick:v},{icon:a(()=>[i(e(Q),null,{default:a(()=>[i(e(be))]),_:1})]),default:a(()=>[n[0]||(n[0]=b(" 编辑服务 ",-1))]),_:1}),i(e(G),{type:"primary",onClick:g},{icon:a(()=>[i(e(Q),null,{default:a(()=>[i(e(Se))]),_:1})]),default:a(()=>[n[1]||(n[1]=b(" 返回 ",-1))]),_:1})])]),i(e(Y),{class:"service-detail-card"},{default:a(()=>[i(e(ce),{column:2,bordered:"",size:"small"},{default:a(()=>[i(e(F),{label:"服务名"},{default:a(()=>[b(C(m.service.serviceName),1)]),_:1}),i(e(F),{label:"分组"},{default:a(()=>[b(C(m.service.groupName),1)]),_:1}),i(e(F),{label:"保护阈值"},{default:a(()=>[b(C(m.service.protectThreshold??0),1)]),_:1}),i(e(F),{label:"服务类型"},{default:a(()=>[b(C(w(m.service.serviceType)),1)]),_:1}),i(e(F),{label:"服务版本"},{default:a(()=>[b(C(m.service.serviceVersion||"-"),1)]),_:1}),i(e(F),{label:"服务路由类型"},{default:a(()=>[b(C(o(m.service.selectorJson)),1)]),_:1}),i(e(F),{label:"服务描述",span:2},{default:a(()=>[b(C(m.service.serviceDescription||"-"),1)]),_:1}),i(e(F),{label:"元数据",span:2},{default:a(()=>[i(me,{content:m.service.metadataJson||"{}",format:"json","auto-format":!0,"max-height":200,"show-copy-button":!0},null,8,["content"])]),_:1})]),_:1})]),_:1}),i(e(Y),{class:"service-detail-card service-instance-list-card"},{header:a(()=>[$("div",Te,[n[3]||(n[3]=$("span",null,"服务实例列表",-1)),i(e(B),{type:"info",size:"small"},{default:a(()=>{var S;return[b(" 共 "+C(((S=m.service.nodes)==null?void 0:S.length)||0)+" 个实例 ",1)]}),_:1})])]),default:a(()=>[i(ye,{nodes:m.service.nodes||[],loading:m.loading,"module-id":`service-detail-${m.service.serviceName}`,onRefresh:p},null,8,["nodes","loading","module-id"])]),_:1})])):z("",!0)}}),De=W(Re,[["__scopeId","data-v-e8fbff62"]]);function Ee(m,y){const h=X(),w=Ne(),o=he(y),g=N(!1),v=N("create"),p=N(null),r=N(!1),n=s=>{v.value="create",s!=null&&s.namespaceId?p.value={namespaceId:s.namespaceId,groupName:"DEFAULT_GROUP"}:p.value=null,g.value=!0},S=async s=>{try{const d=await o.getServiceDetail(s.namespaceId,s.groupName,s.serviceName);if(!d){h.error("获取服务详情失败");return}v.value="edit",p.value=d,g.value=!0}catch{h.error("获取服务详情失败")}},_=async s=>{try{const d=await o.getServiceDetail(s.namespaceId,s.groupName,s.serviceName);if(!d){h.error("获取服务详情失败");return}v.value="view",p.value=d,g.value=!0}catch{h.error("获取服务详情失败")}},I=()=>{g.value=!1,p.value=null},T=async s=>{r.value=!0;try{let d=!1;v.value==="create"?d=await o.addService(s):v.value==="edit"&&(d=await o.editService({...s,namespaceId:p.value.namespaceId,groupName:p.value.groupName,serviceName:p.value.serviceName})),d&&(I(),await o.handleRefresh())}finally{r.value=!1}},R=()=>{var c,t;const s=((c=m==null?void 0:m.value)==null?void 0:c.getCheckboxRecords())||[];if(s.length>0)return s;const d=(t=m==null?void 0:m.value)==null?void 0:t.getCurrentRecord();return d?[d]:[]},O=(s,d)=>{switch(s){case"add":n(d);break;case"edit":const c=R();if(c.length===0){h.warning("请先选择要编辑的服务");return}if(c.length>1){h.warning("只能编辑一个服务");return}S(c[0]);break;case"delete":const t=R();if(t.length===0){h.warning("请先选择要删除的服务");return}M(t);break}},M=async s=>{if(!await w.warning({title:"确认批量删除",subtitle:`将删除 ${s.length} 个服务`,content:"此操作不可恢复，请谨慎操作",positiveText:"确定删除",negativeText:"取消",width:500}))return;let c=0;for(const t of s)await o.deleteService(t)&&c++;c>0&&(h.success(`成功删除 ${c} 个服务`),await o.handleRefresh())},L=async s=>{if(!s.row)return;const d=s.row;switch(s.code){case"view":break;case"edit":await S(d);break;case"delete":await o.deleteService(d),await o.handleRefresh();break}},D=()=>{o.handleSearch()},x=s=>{s&&T(s)};return{service:o,formDialogVisible:g,formDialogMode:v,currentEditService:p,submitting:r,openAddDialog:n,openEditDialog:S,openViewDialog:_,closeFormDialog:I,handleSubmit:T,handleFormSubmit:x,handleServiceFormSubmit:(s,d)=>{s&&(d&&!s.namespaceId&&(s.namespaceId=d.namespaceId),x(s))},handleToolbarClick:O,handleMenuClick:L,handleSearch:D}}const Fe=["id"],Oe=K({name:"NamespaceList",__name:"NamespaceList",props:{showDialog:{type:Boolean,default:!0},autoLoad:{type:Boolean,default:!0},moduleId:{default:"hub0041"}},emits:["row-click","namespace-select"],setup(m,{expose:y,emit:h}){const w=m,o=ee(()=>w.moduleId),g=h,v=N(),p=N(),{service:r,formDialogVisible:n,formDialogMode:S,currentEditNamespace:_,submitting:I,handleFormSubmit:T,handleMenuClick:R,handleSearch:O}=ue(p,v),M=ee(()=>{var t,l;const c=r.model.gridConfig;return{...c,menuConfig:{enabled:!0,showCopyRow:((t=c.menuConfig)==null?void 0:t.showCopyRow)||!1,showCopyCell:((l=c.menuConfig)==null?void 0:l.showCopyCell)||!1,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"}]}}}),L=c=>{c.code==="view"&&c.row&&R(c)},D=({row:c})=>{g("row-click",c),g("namespace-select",c)};return y({refresh:()=>{r.handleRefresh()},load:()=>{r.loadNamespaces()},getSelectedNamespace:()=>{var t;const c=((t=p.value)==null?void 0:t.getCheckboxRecords())||[];return c.length>0?c[0]:null},getCurrentNamespace:()=>{var c;return((c=p.value)==null?void 0:c.getCurrentRecord())||null},namespaceService:r}),de(()=>{w.autoLoad&&r.loadNamespaces()}),(c,t)=>(k(),A("div",{class:"namespace-list",id:o.value},[i(e(q),{direction:"vertical","default-size":"80px"},{1:a(()=>[i(te,{ref_key:"searchFormRef",ref:v,"module-id":o.value,fields:e(r).model.searchFormConfig.fields,"show-search-button":!0,"show-reset-button":!0,onSearch:e(O)},null,8,["module-id","fields","onSearch"])]),2:a(()=>[i(e(j),V({ref_key:"gridRef",ref:p,"module-id":o.value,data:e(r).model.namespaceList,loading:e(r).model.loading},M.value,{onPageChange:e(r).handlePageChange,onMenuClick:L,onRowClick:D}),{activeFlag:a(({row:l})=>[i(e(B),{type:l.activeFlag==="Y"?"success":"default",size:"small"},{default:a(()=>[b(C(l.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),m.showDialog?(k(),J(Z,{key:0,visible:e(n),"onUpdate:visible":t[0]||(t[0]=l=>ae(n)?n.value=l:null),mode:e(S),title:e(S)==="create"?"新增命名空间":e(S)==="edit"?"编辑命名空间":"查看命名空间详情",to:`#${o.value}`,"form-fields":e(r).model.namespaceFormConfig.fields,"form-tabs":e(r).model.namespaceFormConfig.tabs,"initial-data":e(_)||void 0,"auto-close-on-confirm":!1,"confirm-loading":e(I),onSubmit:e(T)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])):z("",!0)],8,Fe))}}),Me=W(Oe,[["__scopeId","data-v-5a86c99c"]]),Le=["id"],xe={key:0,class:"service-list-view"},Ue={key:1,class:"service-detail-view"},Ae=K({name:"ServiceList",__name:"ServiceList",setup(m){const y=N(),h=N(),w=N(),o=N(null),g=N(!1),v=N(null),p=N(!1),r=X(),{service:n,formDialogVisible:S,formDialogMode:_,currentEditService:I,submitting:T,handleServiceFormSubmit:R,handleToolbarClick:O,handleMenuClick:M}=Ee(w,h),L=async u=>{u&&(o.value=u,await n.loadServices({},u.namespaceId))},D=u=>{o.value=u,u||n.model.setServiceList([])},x=()=>{if(!o.value){r.warning("请先在上方命名空间列表中选择一个命名空间");return}n.handleSearch(o.value.namespaceId)},P=u=>{if(u==="add"&&!o.value){r.warning("请先在上方命名空间列表中选择一个命名空间");return}O(u,o.value)},s=u=>{o.value&&n.handlePageChange(u.currentPage,u.pageSize)},d=u=>{R(u,o.value)},c=async u=>{if(!u.row)return;const E=u.row;if(u.code==="view"){await t(E);return}await M(u)},t=async u=>{p.value=!0;try{const E=await n.getServiceDetail(u.namespaceId,u.groupName,u.serviceName);E?(v.value=E,g.value=!0):r.error("获取服务详情失败")}catch{r.error("获取服务详情失败")}finally{p.value=!1}},l=()=>{g.value=!1,v.value=null},f=()=>{v.value&&(g.value=!1,c({code:"edit",row:v.value}))},U=async()=>{if(v.value){p.value=!0;try{const u=await n.getServiceDetail(v.value.namespaceId,v.value.groupName,v.value.serviceName);u?(v.value=u,r.success("服务详情已刷新")):r.error("刷新服务详情失败")}catch{r.error("刷新服务详情失败")}finally{p.value=!1}}},le=()=>{r.info("集群配置功能开发中")},ie=u=>{r.info("节点编辑功能开发中")};return(u,E)=>{const se=te;return k(),A("div",{class:"service-list",id:e(n).model.moduleId},[g.value?(k(),A("div",Ue,[i(De,{service:v.value,loading:p.value,onBack:l,onEdit:f,onRefresh:U,onClusterConfig:le,onEditNode:ie},null,8,["service","loading"])])):(k(),A("div",xe,[i(e(q),{direction:"vertical","default-size":"300px"},{1:a(()=>[i(e(Y),null,{default:a(()=>[i(e(Me),{ref_key:"namespaceListRef",ref:y,moduleId:"hub0042-namespace","show-dialog":!0,"auto-load":!0,onRowClick:L,onNamespaceSelect:D},null,512)]),_:1})]),2:a(()=>[i(e(Y),null,{default:a(()=>[i(e(q),{direction:"vertical","default-size":"80px"},{1:a(()=>[i(se,V({ref_key:"serviceSearchFormRef",ref:h,"module-id":e(n).model.moduleId},e(n).model.searchFormConfig,{onSearch:x,onToolbarClick:P}),null,16,["module-id"])]),2:a(()=>[i(e(j),V({ref_key:"serviceGridRef",ref:w,"module-id":e(n).model.moduleId,data:e(n).model.serviceList,loading:e(n).model.loading},e(n).model.gridConfig,{onPageChange:s,onMenuClick:c}),{activeFlag:a(({row:H})=>[i(e(B),{type:H.activeFlag==="Y"?"success":"default",size:"small"},{default:a(()=>[b(C(H.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading"])]),_:1})]),_:1})]),_:1})])),i(Z,{visible:e(S),"onUpdate:visible":E[0]||(E[0]=H=>ae(S)?S.value=H:null),mode:e(_),title:e(_)==="create"?"新增服务":"编辑服务",to:`#${e(n).model.moduleId}`,"form-fields":e(n).model.serviceFormConfig.fields,"form-tabs":e(n).model.serviceFormConfig.tabs,"initial-data":e(I)||void 0,"auto-close-on-confirm":!1,"confirm-loading":e(T),onSubmit:d},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading"])],8,Le)}}}),kt=W(Ae,[["__scopeId","data-v-3679fdbc"]]);export{kt as default};

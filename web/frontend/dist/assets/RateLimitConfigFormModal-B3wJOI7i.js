import{c as se,a as re,S as oe,b as ue,G as ce}from"./SearchForm-B7rqpwYi.js";import{u as de,G as Z}from"./GDataFormModal-B9PoaKcn.js";import{bQ as Oe,cT as Fe,cU as De,cL as Ve,cK as Le,bS as _e,ak as Ae,d as G,a2 as v,bL as Me,aG as H,G as Se,J as Ke,ai as Ue,c8 as Ne,au as Ee,aY as Re,aZ as Ye,r as k,aw as xe,aa as He,aV as Be,c as j,aB as Je,M as fe,b1 as Ce,cV as qe,T as $,Y as pe,cW as Pe,X as We,m as Y,z as L,A as U,B as S,cX as ge,cY as B,P as R,h as he,w as O,f as g,o as ee,g as me,e as D,a4 as X,K as J,t as q,ci as te,_ as ae,b as Ie,cZ as ke,c_ as Te,cH as le}from"./index-jHKRbIks.js";import"./GDialog.vue_vue_type_style_index_0_scoped_82fcf09e_lang-ipra4ei3.js";/* empty css                                                                    */import{A as ye,T as be}from"./TrashOutline-DyDUTVAn.js";import{C as ve}from"./CreateOutline-CGY5f7Sz.js";import{_ as ne}from"./Select-CGsj-ZtY.js";import{W as we}from"./WarningOutline-mxXhdHS1.js";import{N as je}from"./InputNumber-BwbhDD7_.js";import{N as ze}from"./Switch-C69H-VEY.js";import{s as $e}from"./prop-BjyUHhTu.js";import{N as ie}from"./Alert-BaHRQFWE.js";const Xe=Oe({name:"DynamicTags",common:_e,peers:{Input:Le,Button:Ve,Tag:De,Space:Fe},self(){return{inputWidth:"64px"}}}),Ge=Ae("dynamic-tags",[Ae("input",{minWidth:"var(--n-input-width)"})]),Qe=Object.assign(Object.assign(Object.assign({},xe.props),qe),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputClass:String,inputStyle:[String,Object],inputProps:Object,max:Number,tagClass:String,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:a=>a},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),z=G({name:"DynamicTags",props:Qe,slots:Object,setup(a){const{mergedClsPrefixRef:y,inlineThemeDisabled:l}=Ee(a),{localeRef:f}=Re("DynamicTags"),h=Ye(a),{mergedDisabledRef:c}=h,p=k(""),t=k(!1),s=k(!0),P=k(null),d=xe("DynamicTags","-dynamic-tags",Ge,Xe,a,y),r=k(a.defaultValue),n=He(a,"value"),o=Be(n,r),u=j(()=>f.value.add),m=j(()=>$e(a.size)),C=j(()=>c.value||!!a.max&&o.value.length>=a.max);function e(T){const{onChange:F,"onUpdate:value":V,onUpdateValue:N}=a,{nTriggerFormInput:E,nTriggerFormChange:M}=h;F&&Ce(F,T),N&&Ce(N,T),V&&Ce(V,T),r.value=T,E(),M()}function i(T){const F=o.value.slice(0);F.splice(T,1),e(F)}function I(T){switch(T.key){case"Enter":b()}}function b(T){const F=T??p.value;if(F){const V=o.value.slice(0);V.push(a.onCreate(F)),e(V)}t.value=!1,s.value=!0,p.value=""}function W(){b()}function x(){t.value=!0,fe(()=>{var T;(T=P.value)===null||T===void 0||T.focus(),s.value=!1})}const w=j(()=>{const{self:{inputWidth:T}}=d.value;return{"--n-input-width":T}}),A=l?Je("dynamic-tags",void 0,w,a):void 0;return{mergedClsPrefix:y,inputInstRef:P,localizedAdd:u,inputSize:m,inputValue:p,showInput:t,inputForceFocused:s,mergedValue:o,mergedDisabled:c,triggerDisabled:C,handleInputKeyDown:I,handleAddClick:x,handleInputBlur:W,handleCloseClick:i,handleInputConfirm:b,mergedTheme:d,cssVars:l?void 0:w,themeClass:A==null?void 0:A.themeClass,onRender:A==null?void 0:A.onRender}},render(){const{mergedTheme:a,cssVars:y,mergedClsPrefix:l,onRender:f,renderTag:h}=this;return f==null||f(),v(Me,{class:[`${l}-dynamic-tags`,this.themeClass],size:"small",style:y,theme:a.peers.Space,themeOverrides:a.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:c,tagClass:p,tagStyle:t,type:s,round:P,size:d,color:r,closable:n,mergedDisabled:o,showInput:u,inputValue:m,inputClass:C,inputStyle:e,inputSize:i,inputForceFocused:I,triggerDisabled:b,handleInputKeyDown:W,handleInputBlur:x,handleAddClick:w,handleCloseClick:A,handleInputConfirm:T,$slots:F}=this;return this.mergedValue.map((V,N)=>h?h(V,N):v(H,{key:N,theme:c.peers.Tag,themeOverrides:c.peerOverrides.Tag,class:p,style:t,type:s,round:P,size:d,color:r,closable:n,disabled:o,onClose:()=>{A(N)}},{default:()=>typeof V=="string"?V:V.label})).concat(u?F.input?F.input({submit:T,deactivate:x}):v(Se,Object.assign({placeholder:"",size:i,style:e,class:C,autosize:!0},this.inputProps,{ref:"inputInstRef",value:m,onUpdateValue:V=>{this.inputValue=V},theme:c.peers.Input,themeOverrides:c.peerOverrides.Input,onKeydown:W,onBlur:x,internalForceFocus:I})):F.trigger?F.trigger({activate:w,disabled:b}):v(Ke,{dashed:!0,disabled:b,theme:c.peers.Button,themeOverrides:c.peerOverrides.Button,size:i,onClick:w},{icon:()=>v(Ue,{clsPrefix:l},{default:()=>v(Ne,null)})}))}})}});function Ze(){const a="hubcommon002-useragent-access",y=k(!1),l=k([]),f=k(),h={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:ye,type:"primary",tooltip:"新建User-Agent访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},c=(u,m)=>C=>{const e=C[u]||[];return v(z,{value:e,"onUpdate:value":i=>{C[u]=i},inputProps:{placeholder:m}})},p=[{field:"useragentAccessConfigId",label:"User-Agent访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:u=>v(pe,{trigger:"hover",placement:"top"},{trigger:()=>v("div",{style:"width: 100%;"},[v(ne,{value:u.defaultPolicy,"onUpdate:value":m=>{u.defaultPolicy=m},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>v("div",{style:"max-width: 320px; line-height: 1.5;"},[v("p",{style:"margin: 0 0 8px 0;"},[v("strong","默认策略说明：")]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的User-Agent会被拒绝"]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的User-Agent才被允许"]),v("p",{style:"margin: 0; color: #f0a020;"},[v("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的User-Agent都会被拒绝"])])})},{field:"blockEmptyUserAgent",label:"阻止空User-Agent",type:"switch",span:12,defaultValue:"N",tips:"阻止没有User-Agent头的请求",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistPatterns",label:"User-Agent白名单",type:"custom",span:24,defaultValue:[],tips:"支持正则表达式匹配，如：Mozilla/.*Chrome.*，白名单中的User-Agent将被允许访问",render:c("whitelistPatterns","输入允许的User-Agent模式，如：Mozilla/.*Chrome.*"),rules:[{validator:(u,m)=>{if(!m||m.length===0)return!0;const C=Pe(m);return C.valid?!0:new Error(`无效的正则表达式：${C.invalidPatterns.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistPatterns",label:"User-Agent黑名单",type:"custom",span:24,defaultValue:[],tips:"支持正则表达式匹配，优先级高于白名单，黑名单中的User-Agent会被直接拒绝访问",render:c("blacklistPatterns","输入禁止的User-Agent模式，如：.*Bot.*"),rules:[{validator:(u,m)=>{if(!m||m.length===0)return!0;const C=Pe(m);return C.valid?!0:new Error(`无效的正则表达式：${C.invalidPatterns.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:a,loading:y,configList:l,pageInfo:f,searchFormConfig:h,formFields:p,gridConfig:{columns:[{field:"useragentAccessConfigId",title:"User-Agent访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"whitelistPatterns",title:"User-Agent白名单",align:"left",width:300,showOverflow:!0},{field:"blacklistPatterns",title:"User-Agent黑名单",align:"left",width:300,showOverflow:!0},{field:"blockEmptyUserAgent",title:"阻止空User-Agent",align:"center",width:150,slots:{default:"blockEmptyUserAgent"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:u})=>u?$(u,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:u})=>u?$(u,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:f,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},setConfigList:u=>{l.value=u},updatePagination:u=>{f.value?Object.assign(f.value,u):f.value=u},resetPagination:()=>{f.value=void 0},addConfigToList:u=>{l.value.unshift(u)},updateConfigInList:u=>{const m=l.value.findIndex(C=>C.useragentAccessConfigId===u.useragentAccessConfigId);m!==-1&&Object.assign(l.value[m],u)},removeConfigFromList:u=>{const m=l.value.findIndex(C=>C.useragentAccessConfigId===u);m!==-1&&l.value.splice(m,1)}}}const _=We("/gateway/hubcommon002");async function et(a){return _.post("/ip-access/add",a)}async function tt(a){return _.post("/ip-access/get",a)}async function at(a){return _.post("/ip-access/update",a)}async function lt(a){return _.post("/ip-access/delete",a)}async function it(a){return _.post("/ip-access/query",a)}async function nt(a){return _.post("/useragent-access/add",a)}async function st(a){return _.post("/useragent-access/get",a)}async function rt(a){return _.post("/useragent-access/update",a)}async function ot(a){return _.post("/useragent-access/delete",a)}async function ut(a){return _.post("/useragent-access/query",a)}async function ct(a){return _.post("/api-access/add",a)}async function dt(a){return _.post("/api-access/get",a)}async function ft(a){return _.post("/api-access/update",a)}async function pt(a){return _.post("/api-access/delete",a)}async function gt(a){return _.post("/api-access/query",a)}async function ht(a){return _.post("/domain-access/add",a)}async function mt(a){return _.post("/domain-access/get",a)}async function yt(a){return _.post("/domain-access/update",a)}async function bt(a){return _.post("/domain-access/delete",a)}async function vt(a){return _.post("/domain-access/query",a)}async function wt(a){return _.post("/cors/add",a)}async function Ct(a){return _.post("/cors/update",a)}async function It(a){return _.post("/cors/query",a)}async function At(a){return _.post("/auth/add",a)}async function Pt(a){return _.post("/auth/update",a)}async function kt(a){return _.post("/auth/query",a)}async function Tt(a){return _.post("/rate-limit/add",a)}async function St(a){return _.post("/rate-limit/update",a)}async function xt(a){return _.post("/rate-limit/query",a)}function Ot(a,y){const l=Y(),f=de(),h=Ze(),{loading:c,configList:p,pageInfo:t,setConfigList:s,updatePagination:P,addConfigToList:d,updateConfigInList:r,removeConfigFromList:n}=h,o=async x=>{var w,A,T;c.value=!0;try{let F=x;!F&&((w=y==null?void 0:y.value)!=null&&w.getFormData)&&(F=y.value.getFormData()||{});const V=F?Object.fromEntries(Object.entries(F).filter(([,M])=>M!==""&&M!==null&&M!==void 0)):{},N={...V,...se((A=t.value)==null?void 0:A.pageIndex,(T=t.value)==null?void 0:T.pageSize)};if(a!=null&&a.value)N.securityConfigId=a.value;else if(!V.securityConfigId){l.error("securityConfigId不能为空");return}const E=await ut(N);if(L(E)){const M=U(E,[]);s(M);const K=ge(E);K&&Object.keys(K).length>0&&P(K)}else l.error(S(E,"查询User-Agent访问控制配置列表失败"))}catch{l.error("加载User-Agent访问控制配置列表失败")}finally{c.value=!1}};return{model:h,loadConfigs:o,handleSearch:async x=>{h.resetPagination(),await o(x)},handleReset:async()=>{h.resetPagination(),await o()},handlePageChange:async({currentPage:x,pageSize:w})=>{P({pageIndex:x,pageSize:w}),await o()},handleRefresh:async()=>{await o()},addConfig:async x=>{c.value=!0;try{const w=await nt(x);if(L(w)){l.success(S(w,"新增User-Agent访问控制配置成功"));const A=U(w,null);return A?d(A):await o(),!0}else return l.error(S(w,"新增User-Agent访问控制配置失败")),!1}catch{return l.error("新增User-Agent访问控制配置失败"),!1}finally{c.value=!1}},editConfig:async x=>{c.value=!0;try{const w=await rt(x);if(L(w)){l.success(S(w,"编辑User-Agent访问控制配置成功"));const A=U(w,null);return A?r(A):await o(),!0}else return l.error(S(w,"编辑User-Agent访问控制配置失败")),!1}catch{return l.error("编辑User-Agent访问控制配置失败"),!1}finally{c.value=!1}},deleteConfig:async x=>{if(!await f.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除User-Agent访问控制配置 "${x.configName}" 吗？`,icon:we,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;c.value=!0;try{const A=await ot({useragentAccessConfigId:x.useragentAccessConfigId,tenantId:x.tenantId});return L(A)?(l.success(S(A,"删除User-Agent访问控制配置成功")),n(x.useragentAccessConfigId),p.value.length===0&&t.value&&t.value.pageIndex>1&&(P({pageIndex:t.value.pageIndex-1}),await o()),!0):(l.error(S(A,"删除User-Agent访问控制配置失败")),!1)}catch{return l.error("删除User-Agent访问控制配置失败"),!1}finally{c.value=!1}},getConfigDetail:async x=>{try{const w=await st({useragentAccessConfigId:x});return L(w)?U(w,{}):(l.error(S(w,"获取User-Agent访问控制配置详情失败")),null)}catch{return l.error("获取User-Agent访问控制配置详情失败"),null}}}}function Ft(a,y,l){const f=Y(),h=Ot(y,l),c=k(!1),p=k("create"),t=k(null),s=e=>({...e,whitelistPatterns:B(e.whitelistPatterns),blacklistPatterns:B(e.blacklistPatterns)}),P=e=>{p.value="create",t.value=e?{securityConfigId:e}:null,c.value=!0},d=async e=>{if(e.useragentAccessConfigId)try{const i=await h.getConfigDetail(e.useragentAccessConfigId);if(i){p.value="edit",t.value=s(i),c.value=!0;return}}catch{}p.value="edit",t.value=s(e),c.value=!0},r=()=>{c.value=!1,t.value=null},n=async e=>{if(e.useragentAccessConfigId)try{const i=await h.getConfigDetail(e.useragentAccessConfigId);if(i){p.value="view",t.value=s(i),c.value=!0;return}}catch{}p.value="view",t.value=s(e),c.value=!0};return{service:h,formDialogVisible:c,formDialogMode:p,currentEditConfig:t,openAddDialog:P,openEditDialog:d,openViewDialog:n,closeFormDialog:r,handleFormSubmit:async e=>{if(!e||p.value==="view")return;const i={...e,whitelistPatterns:Array.isArray(e.whitelistPatterns)?JSON.stringify(e.whitelistPatterns):e.whitelistPatterns,blacklistPatterns:Array.isArray(e.blacklistPatterns)?JSON.stringify(e.blacklistPatterns):e.blacklistPatterns};if(p.value==="create"){const I=i.securityConfigId||(y==null?void 0:y.value);if(!I){f.error("安全配置ID不能为空");return}i.securityConfigId=I,await h.addConfig(i)&&r()}else if(p.value==="edit"){if(!t.value)return;const I={...t.value,...i};await h.editConfig(I)&&r()}},handleToolbarClick:async(e,i)=>{switch(e){case"add":const I=y==null?void 0:y.value;if(!I){f.warning("请先选择安全配置");return}P(I);break;case"edit":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要编辑的配置");return}d(b);break}case"delete":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要删除的配置");return}await h.deleteConfig(b);break}case"search":{await h.handleSearch(i);break}}},handleMenuClick:async({code:e,row:i})=>{if(i)switch(e){case"view":n(i);break;case"edit":d(i);break;case"delete":await h.deleteConfig(i);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const Dt=["id"],Vt=G({name:"UserAgentAccessConfigListModal",__name:"UserAgentAccessConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:"User-Agent访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(),c=k(),p=k(l.visible);R(()=>l.visible,i=>{p.value=i});const t=k(l.securityConfigId);R(()=>l.securityConfigId,i=>{t.value=i});const{service:s,formDialogVisible:P,formDialogMode:d,currentEditConfig:r,handleFormSubmit:n,handleToolbarClick:o,handleMenuClick:u,handleSearch:m}=Ft(c,t,h),C=i=>{p.value=i,f("update:visible",i),f(i?"refresh":"close")},e=()=>{p.value||(P.value=!1,d.value="create",r.value=null,s.model.configList.value=[],s.model.resetPagination())};return(i,I)=>(ee(),he(g(ce),{visible:p.value,title:l.title||"User-Agent访问控制配置列表",width:l.width||1200,to:l.to,"show-footer":!1,"onUpdate:visible":C,onAfterLeave:e},{default:O(()=>[me("div",{class:"useragent-access-config-list-modal",id:g(s).model.moduleId},[D(g(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[D(oe,X({ref_key:"searchFormRef",ref:h,"module-id":g(s).model.moduleId},g(s).model.searchFormConfig,{onSearch:g(m),onToolbarClick:g(o)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[D(g(re),X({ref_key:"gridRef",ref:c,"module-id":g(s).model.moduleId,data:g(s).model.configList,loading:g(s).model.loading},g(s).model.gridConfig,{onPageChange:g(s).handlePageChange,onMenuClick:g(u)}),{defaultPolicy:O(({row:b})=>[D(g(H),{type:b.defaultPolicy==="allow"?"success":"error",size:"small"},{default:O(()=>[J(q(b.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:b})=>[D(g(H),{type:b.activeFlag==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),blockEmptyUserAgent:O(({row:b})=>[D(g(H),{type:b.blockEmptyUserAgent==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.blockEmptyUserAgent==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(Z,{visible:g(P),"onUpdate:visible":I[0]||(I[0]=b=>te(P)?P.value=b:null),mode:g(d),title:g(d)==="create"?"新增User-Agent访问控制配置":g(d)==="edit"?"编辑User-Agent访问控制配置":"查看User-Agent访问控制配置详情",to:`#${g(s).model.moduleId}`,"form-fields":g(s).model.formFields,"initial-data":g(r)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(s).model.loading.value,onSubmit:g(n)},null,8,["visible","mode","title","to","form-fields","initial-data","confirm-loading","onSubmit"])],8,Dt)]),_:1},8,["visible","title","width","to"]))}}),Ia=ae(Vt,[["__scopeId","data-v-daa9c2be"]]);function Lt(){const a="hubcommon002-api-access",y=k(!1),l=k([]),f=k(),h={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:ye,type:"primary",tooltip:"新建API访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},c=(m,C)=>e=>{const i=e[m]||[];return v(z,{value:i,"onUpdate:value":I=>{e[m]=I},inputProps:{placeholder:C}})},p=(m,C)=>e=>{const i=e[m]||[];return v(z,{value:i,"onUpdate:value":I=>{e[m]=I},inputProps:{placeholder:C}})},t=[{field:"apiAccessConfigId",label:"API访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:m=>v(pe,{trigger:"hover",placement:"top"},{trigger:()=>v("div",{style:"width: 100%;"},[v(ne,{value:m.defaultPolicy,"onUpdate:value":C=>{m.defaultPolicy=C},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>v("div",{style:"max-width: 320px; line-height: 1.5;"},[v("p",{style:"margin: 0 0 8px 0;"},[v("strong","默认策略说明：")]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的API路径会被拒绝"]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的API路径才被允许"]),v("p",{style:"margin: 0; color: #f0a020;"},[v("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的API路径都会被拒绝"])])})}]},{field:"pathConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistPaths",label:"API路径白名单",type:"custom",span:12,defaultValue:[],tips:"支持通配符匹配，如：/api/v1/*",render:c("whitelistPaths","输入允许的API路径，如：/api/v1/*")},{field:"blacklistPaths",label:"API路径黑名单",type:"custom",span:12,defaultValue:[],tips:"支持通配符匹配，优先级高于白名单",render:c("blacklistPaths","输入禁止的API路径，如：/api/admin/*")}]},{field:"methodConfig",label:"",type:"fieldset",span:24,children:[{field:"allowedMethods",label:"允许的HTTP方法",type:"custom",span:12,defaultValue:[],tips:"如：GET, POST, PUT, DELETE",render:p("allowedMethods","输入允许的HTTP方法，如：GET, POST")},{field:"blockedMethods",label:"禁止的HTTP方法",type:"custom",span:12,defaultValue:[],tips:"优先级高于允许的方法",render:p("blockedMethods","输入禁止的HTTP方法，如：DELETE")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:a,loading:y,configList:l,pageInfo:f,searchFormConfig:h,formFields:t,gridConfig:{columns:[{field:"apiAccessConfigId",title:"API访问配置ID",width:200,visible:!1},{field:"tenantId",title:"租户ID",width:200,visible:!1},{field:"securityConfigId",title:"安全配置ID",width:200,visible:!1},{field:"configName",title:"配置名称",width:200,showOverflow:!0},{field:"defaultPolicy",title:"默认策略",width:120,align:"center",slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"活动状态",width:100,align:"center",slots:{default:"activeFlag"}},{field:"whitelistPaths",title:"路径白名单",width:200,showOverflow:!0},{field:"blacklistPaths",title:"路径黑名单",width:200,showOverflow:!0},{field:"allowedMethods",title:"允许的方法",width:150,showOverflow:!0},{field:"blockedMethods",title:"禁止的方法",width:150,showOverflow:!0},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:m})=>m?$(m,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:m})=>m?$(m,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:f,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},resetPagination:()=>{f.value=void 0},updatePagination:m=>{f.value?Object.assign(f.value,m):f.value=m},setConfigList:m=>{l.value=m},addConfigToList:m=>{l.value.push(m)},updateConfigInList:(m,C,e)=>{const i=l.value.findIndex(I=>I.apiAccessConfigId===m&&I.tenantId===C);i!==-1&&Object.assign(l.value[i],e)},removeConfigFromList:(m,C)=>{const e=l.value.findIndex(i=>i.apiAccessConfigId===m&&i.tenantId===C);e!==-1&&l.value.splice(e,1)}}}function _t(a,y){const l=Y(),f=de(),h=Lt(),{loading:c,configList:p,pageInfo:t,setConfigList:s,updatePagination:P,addConfigToList:d,updateConfigInList:r,removeConfigFromList:n,resetPagination:o}=h,u=async w=>{var A,T,F;c.value=!0;try{let V=w;!V&&((A=y==null?void 0:y.value)!=null&&A.getFormData)&&(V=y.value.getFormData()||{});const N=V?Object.fromEntries(Object.entries(V).filter(([,K])=>K!==""&&K!==null&&K!==void 0)):{},E={...N,...se((T=t.value)==null?void 0:T.pageIndex,(F=t.value)==null?void 0:F.pageSize)};if(a!=null&&a.value)E.securityConfigId=a.value;else if(!N.securityConfigId){l.error("securityConfigId不能为空");return}const M=await gt(E);if(L(M)){const K=U(M,[]);s(K);const Q=ge(M);Q&&Object.keys(Q).length>0&&P(Q)}else l.error(S(M,"查询API访问控制配置列表失败"))}catch{l.error("加载API访问控制配置列表失败")}finally{c.value=!1}};return{model:h,loadConfigs:u,handleSearch:async w=>{o(),await u(w)},handleReset:async()=>{o(),await u()},handlePageChange:async({currentPage:w,pageSize:A})=>{P({pageIndex:w,pageSize:A}),await u()},handleRefresh:async()=>{await u()},addConfig:async w=>{c.value=!0;try{const A=await ct(w);if(L(A)){l.success(S(A,"新增API访问控制配置成功"));const T=U(A,null);return T?d(T):await u(),!0}else return l.error(S(A,"新增API访问控制配置失败")),!1}catch{return l.error("新增API访问控制配置失败"),!1}finally{c.value=!1}},editConfig:async w=>{c.value=!0;try{const A=await ft(w);if(L(A)){l.success(S(A,"编辑API访问控制配置成功"));const T=U(A,null);return T?r(T.apiAccessConfigId,T.tenantId,T):await u(),!0}else return l.error(S(A,"编辑API访问控制配置失败")),!1}catch{return l.error("编辑API访问控制配置失败"),!1}finally{c.value=!1}},deleteConfig:async w=>{if(!await f.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除API访问控制配置 "${w.configName}" 吗？`,icon:we,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;c.value=!0;try{const T=await pt({apiAccessConfigId:w.apiAccessConfigId,tenantId:w.tenantId});return L(T)?(l.success(S(T,"删除API访问控制配置成功")),n(w.apiAccessConfigId,w.tenantId),p.value.length===0&&t.value&&t.value.pageIndex>1&&(P({pageIndex:t.value.pageIndex-1}),await u()),!0):(l.error(S(T,"删除API访问控制配置失败")),!1)}catch{return l.error("删除API访问控制配置失败"),!1}finally{c.value=!1}},getConfigDetail:async w=>{try{const A=await dt({apiAccessConfigId:w});return L(A)?U(A,{}):(l.error(S(A,"获取API访问控制配置详情失败")),null)}catch{return l.error("获取API访问控制配置详情失败"),null}}}}function Mt(a,y,l){const f=Y(),h=_t(y,l),c=k(!1),p=k("create"),t=k(null),s=e=>({...e,whitelistPaths:B(e.whitelistPaths),blacklistPaths:B(e.blacklistPaths),allowedMethods:B(e.allowedMethods),blockedMethods:B(e.blockedMethods)}),P=e=>{p.value="create",t.value=e?{securityConfigId:e}:null,c.value=!0},d=async e=>{if(e.apiAccessConfigId)try{const i=await h.getConfigDetail(e.apiAccessConfigId);if(i){p.value="edit",t.value=s(i),c.value=!0;return}}catch{}p.value="edit",t.value=s(e),c.value=!0},r=()=>{c.value=!1,t.value=null},n=async e=>{if(e.apiAccessConfigId)try{const i=await h.getConfigDetail(e.apiAccessConfigId);if(i){p.value="view",t.value=s(i),c.value=!0;return}}catch{}p.value="view",t.value=s(e),c.value=!0};return{service:h,formDialogVisible:c,formDialogMode:p,currentEditConfig:t,openAddDialog:P,openEditDialog:d,openViewDialog:n,closeFormDialog:r,handleFormSubmit:async e=>{if(!e||p.value==="view")return;const i={...e,whitelistPaths:Array.isArray(e.whitelistPaths)?JSON.stringify(e.whitelistPaths):e.whitelistPaths,blacklistPaths:Array.isArray(e.blacklistPaths)?JSON.stringify(e.blacklistPaths):e.blacklistPaths,allowedMethods:Array.isArray(e.allowedMethods)?JSON.stringify(e.allowedMethods):e.allowedMethods,blockedMethods:Array.isArray(e.blockedMethods)?JSON.stringify(e.blockedMethods):e.blockedMethods};if(p.value==="create"){const I=i.securityConfigId||(y==null?void 0:y.value);if(!I){f.error("安全配置ID不能为空");return}i.securityConfigId=I,await h.addConfig(i)&&r()}else if(p.value==="edit"){if(!t.value)return;const I={...t.value,...i};await h.editConfig(I)&&r()}},handleToolbarClick:async(e,i)=>{switch(e){case"add":const I=y==null?void 0:y.value;if(!I){f.warning("请先选择安全配置");return}P(I);break;case"edit":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要编辑的配置");return}d(b);break}case"delete":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要删除的配置");return}await h.deleteConfig(b);break}case"search":{await h.handleSearch(i);break}}},handleMenuClick:async({code:e,row:i})=>{if(i)switch(e){case"view":n(i);break;case"edit":d(i);break;case"delete":await h.deleteConfig(i);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const Kt=["id"],Ut=G({name:"ApiAccessConfigListModal",__name:"ApiAccessConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:"API访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(),c=k(),p=k(l.visible);R(()=>l.visible,i=>{p.value=i});const t=k(l.securityConfigId);R(()=>l.securityConfigId,i=>{t.value=i});const{service:s,formDialogVisible:P,formDialogMode:d,currentEditConfig:r,handleFormSubmit:n,handleToolbarClick:o,handleMenuClick:u,handleSearch:m}=Mt(c,t,h),C=i=>{p.value=i,f("update:visible",i),f(i?"refresh":"close")},e=()=>{p.value||(P.value=!1,d.value="create",r.value=null,s.model.configList.value=[],s.model.resetPagination())};return(i,I)=>(ee(),he(g(ce),{visible:p.value,title:l.title||"API访问控制配置列表",width:l.width||1200,to:l.to,"show-footer":!1,"onUpdate:visible":C,onAfterLeave:e},{default:O(()=>[me("div",{class:"api-access-config-list-modal",id:g(s).model.moduleId},[D(g(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[D(oe,X({ref_key:"searchFormRef",ref:h,"module-id":g(s).model.moduleId},g(s).model.searchFormConfig,{onSearch:g(m),onToolbarClick:g(o)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[D(g(re),X({ref_key:"gridRef",ref:c,"module-id":g(s).model.moduleId,data:g(s).model.configList,loading:g(s).model.loading},g(s).model.gridConfig,{onPageChange:g(s).handlePageChange,onMenuClick:g(u)}),{defaultPolicy:O(({row:b})=>[D(g(H),{type:b.defaultPolicy==="allow"?"success":"error",size:"small"},{default:O(()=>[J(q(b.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:b})=>[D(g(H),{type:b.activeFlag==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(Z,{visible:g(P),"onUpdate:visible":I[0]||(I[0]=b=>te(P)?P.value=b:null),mode:g(d),title:g(d)==="create"?"新增API访问控制配置":g(d)==="edit"?"编辑API访问控制配置":"查看API访问控制配置详情",to:`#${g(s).model.moduleId}`,"form-fields":g(s).model.formFields,"initial-data":g(r)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(s).model.loading.value,onSubmit:g(n)},null,8,["visible","mode","title","to","form-fields","initial-data","confirm-loading","onSubmit"])],8,Kt)]),_:1},8,["visible","title","width","to"]))}}),Aa=ae(Ut,[["__scopeId","data-v-e38745e7"]]);function Nt(){const a="hubcommon002-auth",y=k(!1),l=(d,r)=>n=>{const o=n[d]||[];return v(z,{value:o,"onUpdate:value":u=>{n[d]=u},inputProps:{placeholder:r}})},f=[{label:"JWT认证",value:"JWT"},{label:"API Key认证",value:"API_KEY"},{label:"OAuth2认证",value:"OAUTH2"},{label:"Basic认证",value:"BASIC"}],h=[{label:"必需认证",value:"REQUIRED"},{label:"可选认证",value:"OPTIONAL"},{label:"禁用认证",value:"DISABLED"}],c=[{label:"HS256",value:"HS256"},{label:"HS384",value:"HS384"},{label:"HS512",value:"HS512"},{label:"RS256",value:"RS256"},{label:"RS384",value:"RS384"},{label:"RS512",value:"RS512"}],p=[{label:"Header",value:"header"},{label:"Query参数",value:"query"}],t=(d,r,n)=>o=>{const u=`authConfig.${d}`,m=o[u];return r==="input"?v(Se,{value:m||"",type:(n==null?void 0:n.type)||"text",placeholder:(n==null?void 0:n.placeholder)||"","onUpdate:value":C=>{o[u]=C}}):r==="select"?v(ne,{value:m||(n==null?void 0:n.defaultValue)||"",options:(n==null?void 0:n.options)||[],placeholder:(n==null?void 0:n.placeholder)||"","onUpdate:value":C=>{o[u]=C}}):r==="number"?v(je,{value:m??(n==null?void 0:n.defaultValue)??0,min:n==null?void 0:n.min,max:n==null?void 0:n.max,placeholder:(n==null?void 0:n.placeholder)||"",style:"width: 100%;","onUpdate:value":C=>{o[u]=C??(n==null?void 0:n.defaultValue)??0}}):r==="switch"?v(ze,{value:m??(n==null?void 0:n.defaultValue)??!1,"onUpdate:value":C=>{o[u]=C}}):r==="tags"?v(z,{value:m||[],"onUpdate:value":C=>{o[u]=C},inputProps:{placeholder:(n==null?void 0:n.placeholder)||""}}):v("div")},s=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],P=[{field:"authConfigId",label:"认证配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"authName",label:"认证配置名称",type:"input",placeholder:"请输入认证配置名称",span:12,required:!0,defaultValue:"认证配置",tabKey:"basic"},{field:"authType",label:"认证类型",type:"select",span:12,required:!0,defaultValue:"JWT",tabKey:"basic",props:{options:f,placeholder:"选择认证类型"},tips:"支持JWT、API Key、OAuth2、Basic认证"},{field:"authStrategy",label:"认证策略",type:"select",span:12,required:!0,defaultValue:"REQUIRED",tabKey:"basic",props:{options:h,placeholder:"选择认证策略"},tips:"必需：必须认证才能访问；可选：可以认证但不强制；禁用：不进行认证"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"failureStatusCode",label:"失败状态码",type:"number",placeholder:"认证失败HTTP状态码",span:12,defaultValue:401,tabKey:"basic",props:{min:400,max:599},tips:"认证失败时返回的HTTP状态码"},{field:"failureMessage",label:"失败提示消息",type:"input",placeholder:"认证失败提示消息",span:12,defaultValue:"认证失败",tabKey:"basic",tips:"认证失败时返回的错误消息"}]},{field:"authConfigDetails",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"authConfig.secret",label:"JWT密钥",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",required:!0,tips:"JWT签名密钥，用于验证和生成Token",render:t("secret","input",{type:"password",placeholder:"JWT签名密钥"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="JWT"){const o=n["authConfig.secret"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("JWT密钥不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.algorithm",label:"签名算法",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",required:!0,tips:"JWT签名算法，如HS256、RS256等",render:t("algorithm","select",{options:c,defaultValue:"HS256",placeholder:"选择签名算法"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="JWT"){const o=n["authConfig.algorithm"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("签名算法不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.issuer",label:"签发者(Issuer)",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",tips:"JWT签发者标识，可选",render:t("issuer","input",{placeholder:"JWT签发者"})},{field:"authConfig.expiration",label:"过期时间(秒)",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",defaultValue:3600,tips:"Token过期时间，默认3600秒",render:t("expiration","number",{min:60,max:86400,defaultValue:3600,placeholder:"Token过期时间"})},{field:"authConfig.verifyExpiration",label:"验证过期时间",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",tips:"是否验证Token过期时间",render:t("verifyExpiration","switch",{defaultValue:!0})},{field:"authConfig.verifyIssuer",label:"验证签发者",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",tips:"是否验证Token签发者",render:t("verifyIssuer","switch",{defaultValue:!1})},{field:"authConfig.refreshWindow",label:"刷新窗口(秒)",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",defaultValue:300,tips:"过期前多少秒可以刷新Token",render:t("refreshWindow","number",{min:0,max:3600,defaultValue:300,placeholder:"过期前多少秒可刷新"})},{field:"authConfig.includeInResponse",label:"响应包含Token",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",tips:"是否在响应头中包含生成的Token",render:t("includeInResponse","switch",{defaultValue:!1})},{field:"authConfig.responseHeaderName",label:"响应头名称",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="JWT",defaultValue:"X-Auth-Token",tips:"响应头中Token的字段名",render:t("responseHeaderName","input",{placeholder:"X-Auth-Token",defaultValue:"X-Auth-Token"})},{field:"authConfig.keyLocation",label:"API Key位置",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="API_KEY",required:!0,tips:"API Key的获取位置，Header或Query参数",render:t("keyLocation","select",{options:p,defaultValue:"header",placeholder:"API Key获取位置"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="API_KEY"){const o=n["authConfig.keyLocation"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("API Key位置不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.keyName",label:"参数名称",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="API_KEY",required:!0,tips:"API Key的参数名称，如X-API-Key",render:t("keyName","input",{placeholder:"api_key",defaultValue:"X-API-Key"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="API_KEY"){const o=n["authConfig.keyName"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("参数名称不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.validKeys",label:"有效API Keys",type:"custom",span:24,tabKey:"basic",show:d=>d.authType==="API_KEY",required:!0,tips:"允许访问的API Key列表，至少配置一个",render:t("validKeys","tags",{placeholder:"输入API Key"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="API_KEY"){const o=n["authConfig.validKeys"];if(!o||!Array.isArray(o)||o.length===0)return new Error("至少需要配置一个有效API Key")}return!0},trigger:["blur","change"]}]},{field:"authConfig.tokenEndpoint",label:"Token端点URL",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="OAUTH2",required:!0,tips:"OAuth2 Token获取端点URL",render:t("tokenEndpoint","input",{placeholder:"https://auth.example.com/oauth/token"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="OAUTH2"){const o=n["authConfig.tokenEndpoint"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("Token端点URL不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.introspectEndpoint",label:"内省端点URL",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="OAUTH2",tips:"OAuth2 Token内省端点URL，可选",render:t("introspectEndpoint","input",{placeholder:"https://auth.example.com/oauth/introspect"})},{field:"authConfig.clientID",label:"Client ID",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="OAUTH2",required:!0,tips:"OAuth2客户端ID",render:t("clientID","input",{placeholder:"客户端ID"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="OAUTH2"){const o=n["authConfig.clientID"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("Client ID不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.clientSecret",label:"Client Secret",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="OAUTH2",required:!0,tips:"OAuth2客户端密钥",render:t("clientSecret","input",{type:"password",placeholder:"客户端密钥"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="OAUTH2"){const o=n["authConfig.clientSecret"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("Client Secret不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.scope",label:"Scope",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="OAUTH2",tips:"OAuth2授权范围，多个用空格分隔",render:t("scope","input",{placeholder:"read write"})},{field:"authConfig.username",label:"用户名",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="BASIC",required:!0,tips:"Basic认证用户名",render:t("username","input",{placeholder:"认证用户名"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="BASIC"){const o=n["authConfig.username"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("用户名不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.password",label:"密码",type:"custom",span:12,tabKey:"basic",show:d=>d.authType==="BASIC",required:!0,tips:"Basic认证密码",render:t("password","input",{type:"password",placeholder:"认证密码"}),rules:[{validator:(d,r)=>{const n=d.source||{};if(n.authType==="BASIC"){const o=n["authConfig.password"];if(!o||typeof o=="string"&&o.trim()==="")return new Error("密码不能为空")}return!0},trigger:["blur","change"]}]}]},{field:"exemptConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"exemptPaths",label:"豁免路径",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"支持通配符，如：/public/*, /health, /api/v1/status",render:l("exemptPaths","输入豁免路径")},{field:"exemptHeaders",label:"豁免请求头",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"包含指定请求头的请求将跳过认证",render:l("exemptHeaders","输入豁免请求头")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"}];return{moduleId:a,loading:y,formTabs:s,formFields:P}}function Et(){const a=Y(),y=Nt(),{loading:l}=y;return{model:y,getConfigDetail:async p=>{try{const t=await kt(p);return L(t)?U(t,null):(a.error(S(t,"获取认证配置详情失败")),null)}catch{return a.error("获取认证配置详情失败"),null}},addConfig:async p=>{l.value=!0;try{const t=await At(p);return L(t)?(a.success(S(t,"新增认证配置成功")),!0):(a.error(S(t,"新增认证配置失败")),!1)}catch{return a.error("新增认证配置失败"),!1}finally{l.value=!1}},editConfig:async p=>{l.value=!0;try{const t=await Pt(p);return L(t)?(a.success(S(t,"编辑认证配置成功")),!0):(a.error(S(t,"编辑认证配置失败")),!1)}catch{return a.error("编辑认证配置失败"),!1}finally{l.value=!1}}}}function Rt(a){Y();const y=Et(),l=k(!1),f=k("create"),h=k(null),c=r=>{const n=C=>{if(typeof C=="string"&&C)try{return JSON.parse(C)}catch{return C}return C},o=C=>{if(Array.isArray(C))return C;if(typeof C=="string"&&C)try{return JSON.parse(C)}catch{return[]}return[]},u=n(r.authConfig)||{},m={...r,exemptPaths:o(r.exemptPaths),exemptHeaders:o(r.exemptHeaders)};return u&&typeof u=="object"&&Object.keys(u).forEach(C=>{m[`authConfig.${C}`]=u[C]}),m},p=r=>{const n={};Object.keys(r).forEach(u=>{if(u.startsWith("authConfig.")){const m=u.replace("authConfig.","");n[m]=r[u]}});const o={};return Object.keys(r).forEach(u=>{u.startsWith("authConfig.")||(o[u]=r[u])}),{...o,authConfig:Object.keys(n).length>0?JSON.stringify(n):"{}",exemptPaths:Array.isArray(r.exemptPaths)?JSON.stringify(r.exemptPaths):r.exemptPaths||"[]",exemptHeaders:Array.isArray(r.exemptHeaders)?JSON.stringify(r.exemptHeaders):r.exemptHeaders||"[]"}},t=async()=>{var u,m;const r=(u=a.gatewayInstanceId)==null?void 0:u.value,n=(m=a.routeConfigId)==null?void 0:m.value;if(!r&&!n)return;const o=await y.getConfigDetail({gatewayInstanceId:r,routeConfigId:n});o?(h.value=c(o),f.value="edit"):(h.value=null,f.value="create")},s=async()=>{await t(),l.value=!0},P=()=>{l.value=!1,h.value=null},d=async r=>{var o,u;if(!r||f.value==="view")return;const n=p(r);if((o=a.gatewayInstanceId)!=null&&o.value&&(n.gatewayInstanceId=a.gatewayInstanceId.value),(u=a.routeConfigId)!=null&&u.value&&(n.routeConfigId=a.routeConfigId.value),f.value==="create")await y.addConfig(n)&&await t();else if(f.value==="edit"){if(!h.value)return;const m={...n,authConfigId:h.value.authConfigId,tenantId:h.value.tenantId};await y.editConfig(m)&&await t()}};return R(()=>{var r,n;return[(r=a.gatewayInstanceId)==null?void 0:r.value,(n=a.routeConfigId)==null?void 0:n.value]},()=>{l.value&&t()}),{service:y,formDialogVisible:l,formDialogMode:f,currentEditConfig:h,openDialog:s,closeFormDialog:P,handleFormSubmit:d,loadConfig:t}}const Yt=["id"],Ht=G({name:"AuthConfigFormModal",__name:"AuthConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{default:"auth-config-form-modal"},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(l.gatewayInstanceId),c=k(l.routeConfigId),p=Rt({gatewayInstanceId:h,routeConfigId:c}),{service:t,formDialogVisible:s,formDialogMode:P,currentEditConfig:d,openDialog:r,closeFormDialog:n,handleFormSubmit:o}=p,u=j(()=>l.moduleId||"auth-config-form-modal"),m=j(()=>l.title?l.title:P.value==="create"?"新增认证配置":P.value==="edit"?"编辑认证配置":"查看认证配置详情");R(()=>l.visible,async e=>{e?(h.value=l.gatewayInstanceId,c.value=l.routeConfigId,s.value&&(n(),await fe()),await r()):s.value&&n()});const C=e=>{e||(f("update:visible",!1),f("close"),f("refresh"))};return(e,i)=>(ee(),Ie("div",{class:"auth-config-form-modal",id:u.value},[D(Z,{visible:g(s),"onUpdate:visible":[i[0]||(i[0]=I=>te(s)?s.value=I:null),C],mode:g(P),title:m.value,width:l.width||800,to:l.to||(u.value?`#${u.value}`:void 0),"form-fields":g(t).model.formFields,"form-tabs":g(t).model.formTabs,"initial-data":g(d)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(t).model.loading.value,onSubmit:g(o)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,Yt))}}),Pa=ae(Ht,[["__scopeId","data-v-165f3dea"]]);function Bt(){const a="hubcommon002-cors",y=k(!1),l=(c,p)=>t=>{const s=t[c]||[];return v(z,{value:s,"onUpdate:value":P=>{t[c]=P},inputProps:{placeholder:p}})},f=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],h=[{field:"corsConfigId",label:"CORS配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入CORS配置名称",span:12,required:!0,defaultValue:"CORS跨域配置",tabKey:"basic"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"allowCredentials",label:"允许携带凭证",type:"switch",span:12,defaultValue:"N",tabKey:"basic",tips:"是否允许跨域请求携带Cookie、Authorization等凭证信息",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"maxAgeSeconds",label:"预检缓存时间",type:"number",placeholder:"预检请求缓存时间(秒)",span:12,defaultValue:86400,tabKey:"basic",props:{min:0,max:86400},tips:"OPTIONS预检请求的缓存时间，0表示不缓存，最大86400秒(24小时)"}]},{field:"allowOriginsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowOrigins",label:"允许的源",type:"custom",span:24,defaultValue:[],required:!0,tabKey:"basic",tips:"支持具体域名(https://example.com)、通配符(*)，建议避免使用*以提高安全性",render:l("allowOrigins","输入允许的源，如：https://example.com"),rules:[{required:!0,message:"请至少配置一个允许的源",trigger:"blur",validator:(c,p)=>!p||p.length===0?new Error("请至少配置一个允许的源"):!0}]}]},{field:"allowMethodsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowMethods",label:"允许的HTTP方法",type:"custom",span:24,defaultValue:["GET","POST","PUT","DELETE","OPTIONS"],required:!0,tabKey:"basic",tips:"常用方法：GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD",render:l("allowMethods","输入HTTP方法，如：GET, POST"),rules:[{required:!0,message:"请至少配置一个允许的HTTP方法",trigger:"blur",validator:(c,p)=>!p||p.length===0?new Error("请至少配置一个允许的HTTP方法"):!0}]}]},{field:"headersConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowHeaders",label:"允许的请求头",type:"custom",span:12,defaultValue:["Content-Type","Authorization","X-Requested-With"],tabKey:"basic",tips:"如：Content-Type, Authorization, X-Requested-With",render:l("allowHeaders","输入允许的请求头")},{field:"exposeHeaders",label:"暴露的响应头",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"浏览器可以访问的自定义响应头",render:l("exposeHeaders","输入暴露的响应头")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"noteText",label:"备注",type:"textarea",span:24,disabled:!0,tabKey:"other"}];return{moduleId:a,loading:y,formTabs:f,formFields:h}}function Jt(){const a=Y(),y=Bt(),{loading:l}=y;return{model:y,getConfigDetail:async p=>{try{const t=await It(p);return L(t)?U(t,null):(a.error(S(t,"获取CORS配置详情失败")),null)}catch{return a.error("获取CORS配置详情失败"),null}},addConfig:async p=>{l.value=!0;try{const t=await wt(p);return L(t)?(a.success(S(t,"新增CORS配置成功")),!0):(a.error(S(t,"新增CORS配置失败")),!1)}catch{return a.error("新增CORS配置失败"),!1}finally{l.value=!1}},editConfig:async p=>{l.value=!0;try{const t=await Ct(p);return L(t)?(a.success(S(t,"编辑CORS配置成功")),!0):(a.error(S(t,"编辑CORS配置失败")),!1)}catch{return a.error("编辑CORS配置失败"),!1}finally{l.value=!1}}}}function qt(a){Y();const y=Jt(),l=k(!1),f=k("create"),h=k(null),c=r=>{const n=o=>{if(Array.isArray(o))return o;if(typeof o=="string"&&o)try{return JSON.parse(o)}catch{return[]}return[]};return{...r,allowOrigins:n(r.allowOrigins),allowMethods:typeof r.allowMethods=="string"?r.allowMethods.split(",").map(o=>o.trim()).filter(o=>o):Array.isArray(r.allowMethods)?r.allowMethods:[],allowHeaders:n(r.allowHeaders),exposeHeaders:n(r.exposeHeaders)}},p=r=>({...r,allowOrigins:Array.isArray(r.allowOrigins)?JSON.stringify(r.allowOrigins):r.allowOrigins,allowMethods:Array.isArray(r.allowMethods)?r.allowMethods.join(","):r.allowMethods,allowHeaders:Array.isArray(r.allowHeaders)?JSON.stringify(r.allowHeaders):r.allowHeaders,exposeHeaders:Array.isArray(r.exposeHeaders)?JSON.stringify(r.exposeHeaders):r.exposeHeaders}),t=async()=>{var u,m;const r=(u=a.gatewayInstanceId)==null?void 0:u.value,n=(m=a.routeConfigId)==null?void 0:m.value;if(!r&&!n)return;const o=await y.getConfigDetail({gatewayInstanceId:r,routeConfigId:n});o?(h.value=c(o),f.value="edit"):(h.value=null,f.value="create")},s=async()=>{await t(),l.value=!0},P=()=>{l.value=!1,h.value=null},d=async r=>{var o,u;if(!r||f.value==="view")return;const n=p(r);if((o=a.gatewayInstanceId)!=null&&o.value&&(n.gatewayInstanceId=a.gatewayInstanceId.value),(u=a.routeConfigId)!=null&&u.value&&(n.routeConfigId=a.routeConfigId.value),f.value==="create")await y.addConfig(n)&&await t();else if(f.value==="edit"){if(!h.value)return;const m={...p(h.value),...n,corsConfigId:h.value.corsConfigId,tenantId:h.value.tenantId};await y.editConfig(m)&&await t()}};return R(()=>{var r,n;return[(r=a.gatewayInstanceId)==null?void 0:r.value,(n=a.routeConfigId)==null?void 0:n.value]},()=>{l.value&&t()}),{service:y,formDialogVisible:l,formDialogMode:f,currentEditConfig:h,openDialog:s,closeFormDialog:P,handleFormSubmit:d,loadConfig:t}}const Wt=["id"],jt=G({name:"CorsConfigFormModal",__name:"CorsConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{default:"cors-config-form-modal"},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(l.gatewayInstanceId),c=k(l.routeConfigId),p=qt({gatewayInstanceId:h,routeConfigId:c}),{service:t,formDialogVisible:s,formDialogMode:P,currentEditConfig:d,openDialog:r,closeFormDialog:n,handleFormSubmit:o}=p,u=j(()=>l.moduleId||"cors-config-form-modal"),m=j(()=>l.title?l.title:P.value==="create"?"新增CORS配置":P.value==="edit"?"编辑CORS配置":"查看CORS配置详情");R(()=>l.visible,async e=>{e?(h.value=l.gatewayInstanceId,c.value=l.routeConfigId,s.value&&(n(),await fe()),await r()):s.value&&n()});const C=e=>{e||(f("update:visible",!1),f("close"),f("refresh"))};return(e,i)=>(ee(),Ie("div",{class:"cors-config-form-modal",id:u.value},[D(Z,{visible:g(s),"onUpdate:visible":[i[0]||(i[0]=I=>te(s)?s.value=I:null),C],mode:g(P),title:m.value,width:l.width||800,to:l.to||(u.value?`#${u.value}`:void 0),"form-fields":g(t).model.formFields,"form-tabs":g(t).model.formTabs,"initial-data":g(d)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(t).model.loading.value,onSubmit:g(o)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,Wt))}}),ka=ae(jt,[["__scopeId","data-v-3667e145"]]);function zt(){const a="hubcommon002-domain-access",y=k(!1),l=k([]),f=k(),h={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:ye,type:"primary",tooltip:"新建域名访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},c=(u,m)=>C=>{const e=C[u]||[];return v(z,{value:e,"onUpdate:value":i=>{C[u]=i},inputProps:{placeholder:m}})},p=[{field:"domainAccessConfigId",label:"域名访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:u=>v(pe,{trigger:"hover",placement:"top"},{trigger:()=>v("div",{style:"width: 100%;"},[v(ne,{value:u.defaultPolicy,"onUpdate:value":m=>{u.defaultPolicy=m},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>v("div",{style:"max-width: 320px; line-height: 1.5;"},[v("p",{style:"margin: 0 0 8px 0;"},[v("strong","默认策略说明：")]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的域名会被拒绝"]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的域名才被允许"]),v("p",{style:"margin: 0; color: #f0a020;"},[v("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的域名都会被拒绝"])])})},{field:"allowSubdomains",label:"允许子域名",type:"switch",span:12,defaultValue:"Y",tips:"是否允许匹配子域名（如：*.example.com）",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistDomains",label:"域名白名单",type:"custom",span:24,defaultValue:[],tips:"如：example.com, api.example.com，白名单中的域名将被允许访问",render:c("whitelistDomains","输入允许的域名，如：example.com")}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistDomains",label:"域名黑名单",type:"custom",span:24,defaultValue:[],tips:"优先级高于白名单，直接拒绝访问",render:c("blacklistDomains","输入禁止的域名，如：malicious.com")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:a,loading:y,configList:l,pageInfo:f,searchFormConfig:h,formFields:p,gridConfig:{columns:[{field:"domainAccessConfigId",title:"域名访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"allowSubdomains",title:"允许子域名",align:"center",width:120,slots:{default:"allowSubdomains"}},{field:"whitelistDomains",title:"域名白名单",align:"left",width:300,showOverflow:!0},{field:"blacklistDomains",title:"域名黑名单",align:"left",width:300,showOverflow:!0},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:u})=>u?$(u,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:u})=>u?$(u,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:f,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},setConfigList:u=>{l.value=u},updatePagination:u=>{f.value?Object.assign(f.value,u):f.value=u},resetPagination:()=>{f.value=void 0},addConfigToList:u=>{l.value.unshift(u)},updateConfigInList:(u,m,C)=>{const e=l.value.findIndex(i=>i.domainAccessConfigId===u&&i.tenantId===m);e!==-1&&Object.assign(l.value[e],C)},removeConfigFromList:(u,m)=>{const C=l.value.findIndex(e=>e.domainAccessConfigId===u&&e.tenantId===m);C!==-1&&l.value.splice(C,1)}}}function $t(a,y){const l=Y(),f=de(),h=zt(),{loading:c,configList:p,pageInfo:t,setConfigList:s,updatePagination:P,addConfigToList:d,updateConfigInList:r,removeConfigFromList:n,resetPagination:o}=h,u=async w=>{var A,T,F;c.value=!0;try{let V=w;!V&&((A=y==null?void 0:y.value)!=null&&A.getFormData)&&(V=y.value.getFormData()||{});const N=V?Object.fromEntries(Object.entries(V).filter(([,K])=>K!==""&&K!==null&&K!==void 0)):{},E={...N,...se((T=t.value)==null?void 0:T.pageIndex,(F=t.value)==null?void 0:F.pageSize)};if(a!=null&&a.value)E.securityConfigId=a.value;else if(!N.securityConfigId){l.error("securityConfigId不能为空");return}const M=await vt(E);if(L(M)){const K=U(M,[]);s(K);const Q=ge(M);Q&&Object.keys(Q).length>0&&P(Q)}else l.error(S(M,"查询域名访问控制配置列表失败"))}catch{l.error("加载域名访问控制配置列表失败")}finally{c.value=!1}};return{model:h,loadConfigs:u,handleSearch:async w=>{o(),await u(w)},handleReset:async()=>{o(),await u()},handlePageChange:async({currentPage:w,pageSize:A})=>{P({pageIndex:w,pageSize:A}),await u()},handleRefresh:async()=>{await u()},addConfig:async w=>{c.value=!0;try{const A=await ht(w);if(L(A)){l.success(S(A,"新增域名访问控制配置成功"));const T=U(A,null);return T?d(T):await u(),!0}else return l.error(S(A,"新增域名访问控制配置失败")),!1}catch{return l.error("新增域名访问控制配置失败"),!1}finally{c.value=!1}},editConfig:async w=>{c.value=!0;try{const A=await yt(w);if(L(A)){l.success(S(A,"编辑域名访问控制配置成功"));const T=U(A,null);return T?r(T.domainAccessConfigId,T.tenantId,T):await u(),!0}else return l.error(S(A,"编辑域名访问控制配置失败")),!1}catch{return l.error("编辑域名访问控制配置失败"),!1}finally{c.value=!1}},deleteConfig:async w=>{if(!await f.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除域名访问控制配置 "${w.configName}" 吗？`,icon:we,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;c.value=!0;try{const T=await bt({domainAccessConfigId:w.domainAccessConfigId,tenantId:w.tenantId});return L(T)?(l.success(S(T,"删除域名访问控制配置成功")),n(w.domainAccessConfigId,w.tenantId),p.value.length===0&&t.value&&t.value.pageIndex>1&&(P({pageIndex:t.value.pageIndex-1}),await u()),!0):(l.error(S(T,"删除域名访问控制配置失败")),!1)}catch{return l.error("删除域名访问控制配置失败"),!1}finally{c.value=!1}},getConfigDetail:async w=>{try{const A=await mt({domainAccessConfigId:w});return L(A)?U(A,{}):(l.error(S(A,"获取域名访问控制配置详情失败")),null)}catch{return l.error("获取域名访问控制配置详情失败"),null}}}}function Xt(a,y,l){const f=Y(),h=$t(y,l),c=k(!1),p=k("create"),t=k(null),s=e=>({...e,whitelistDomains:B(e.whitelistDomains),blacklistDomains:B(e.blacklistDomains)}),P=e=>{p.value="create",t.value=e?{securityConfigId:e}:null,c.value=!0},d=async e=>{if(e.domainAccessConfigId)try{const i=await h.getConfigDetail(e.domainAccessConfigId);if(i){p.value="edit",t.value=s(i),c.value=!0;return}}catch{}p.value="edit",t.value=s(e),c.value=!0},r=()=>{c.value=!1,t.value=null},n=async e=>{if(e.domainAccessConfigId)try{const i=await h.getConfigDetail(e.domainAccessConfigId);if(i){p.value="view",t.value=s(i),c.value=!0;return}}catch{}p.value="view",t.value=s(e),c.value=!0};return{service:h,formDialogVisible:c,formDialogMode:p,currentEditConfig:t,openAddDialog:P,openEditDialog:d,openViewDialog:n,closeFormDialog:r,handleFormSubmit:async e=>{if(!e||p.value==="view")return;const i={...e,whitelistDomains:Array.isArray(e.whitelistDomains)?JSON.stringify(e.whitelistDomains):e.whitelistDomains,blacklistDomains:Array.isArray(e.blacklistDomains)?JSON.stringify(e.blacklistDomains):e.blacklistDomains};if(p.value==="create"){const I=i.securityConfigId||(y==null?void 0:y.value);if(!I){f.error("安全配置ID不能为空");return}i.securityConfigId=I,await h.addConfig(i)&&r()}else if(p.value==="edit"){if(!t.value)return;const I={...t.value,...i};await h.editConfig(I)&&r()}},handleToolbarClick:async(e,i)=>{switch(e){case"add":const I=y==null?void 0:y.value;if(!I){f.warning("请先选择安全配置");return}P(I);break;case"edit":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要编辑的配置");return}d(b);break}case"delete":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要删除的配置");return}await h.deleteConfig(b);break}case"search":{await h.handleSearch(i);break}}},handleMenuClick:async({code:e,row:i})=>{if(i)switch(e){case"view":n(i);break;case"edit":d(i);break;case"delete":await h.deleteConfig(i);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const Gt=["id"],Qt=G({name:"DomainAccessConfigListModal",__name:"DomainAccessConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:"域名访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(),c=k(),p=k(l.visible);R(()=>l.visible,i=>{p.value=i});const t=k(l.securityConfigId);R(()=>l.securityConfigId,i=>{t.value=i});const{service:s,formDialogVisible:P,formDialogMode:d,currentEditConfig:r,handleFormSubmit:n,handleToolbarClick:o,handleMenuClick:u,handleSearch:m}=Xt(c,t,h),C=i=>{p.value=i,f("update:visible",i),f(i?"refresh":"close")},e=()=>{p.value||(P.value=!1,d.value="create",r.value=null,s.model.configList.value=[],s.model.resetPagination())};return(i,I)=>(ee(),he(g(ce),{visible:p.value,title:l.title||"域名访问控制配置列表",width:l.width||1200,to:l.to,"show-footer":!1,"onUpdate:visible":C,onAfterLeave:e},{default:O(()=>[me("div",{class:"domain-access-config-list-modal",id:g(s).model.moduleId},[D(g(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[D(oe,X({ref_key:"searchFormRef",ref:h,"module-id":g(s).model.moduleId},g(s).model.searchFormConfig,{onSearch:g(m),onToolbarClick:g(o)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[D(g(re),X({ref_key:"gridRef",ref:c,"module-id":g(s).model.moduleId,data:g(s).model.configList,loading:g(s).model.loading},g(s).model.gridConfig,{onPageChange:g(s).handlePageChange,onMenuClick:g(u)}),{defaultPolicy:O(({row:b})=>[D(g(H),{type:b.defaultPolicy==="allow"?"success":"error",size:"small"},{default:O(()=>[J(q(b.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:b})=>[D(g(H),{type:b.activeFlag==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),allowSubdomains:O(({row:b})=>[D(g(H),{type:b.allowSubdomains==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.allowSubdomains==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(Z,{visible:g(P),"onUpdate:visible":I[0]||(I[0]=b=>te(P)?P.value=b:null),mode:g(d),title:g(d)==="create"?"新增域名访问控制配置":g(d)==="edit"?"编辑域名访问控制配置":"查看域名访问控制配置详情",to:`#${g(s).model.moduleId}`,"form-fields":g(s).model.formFields,"initial-data":g(r)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(s).model.loading.value,onSubmit:g(n)},null,8,["visible","mode","title","to","form-fields","initial-data","confirm-loading","onSubmit"])],8,Gt)]),_:1},8,["visible","title","width","to"]))}}),Ta=ae(Qt,[["__scopeId","data-v-f8237f04"]]);function Zt(){const a="hubcommon002-ip-access",y=k(!1),l=k([]),f=k(),h={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:ye,type:"primary",tooltip:"新建IP访问控制配置"},{key:"edit",label:"编辑",icon:ve,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},c=e=>i=>{const I=i[e]||[];return v(z,{value:I,"onUpdate:value":b=>{i[e]=b},inputProps:{placeholder:"输入IP地址，如：192.168.1.100"}})},p=e=>i=>{const I=i[e]||[];return v(z,{value:I,"onUpdate:value":b=>{i[e]=b},inputProps:{placeholder:"输入CIDR网段，如：192.168.1.0/24"}})},t=[{field:"ipAccessConfigId",label:"IP访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:e=>v(pe,{trigger:"hover",placement:"top"},{trigger:()=>v("div",{style:"width: 100%;"},[v(ne,{value:e.defaultPolicy,"onUpdate:value":i=>{e.defaultPolicy=i},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>v("div",{style:"max-width: 320px; line-height: 1.5;"},[v("p",{style:"margin: 0 0 8px 0;"},[v("strong","默认策略说明：")]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的IP会被拒绝"]),v("p",{style:"margin: 0 0 8px 0;"},[v("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的IP才被允许"]),v("p",{style:"margin: 0; color: #f0a020;"},[v("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的IP都会被拒绝"])])})},{field:"trustXForwardedFor",label:"信任X-Forwarded-For",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"trustXRealIp",label:"信任X-Real-IP",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistIps",label:"IP白名单",type:"custom",span:12,defaultValue:[],tips:"精确匹配单个IP地址，白名单中的IP将被允许访问",render:c("whitelistIps"),rules:[{validator:(e,i)=>{if(!i||i.length===0)return!0;const I=ke(i);return I.valid?!0:new Error(`无效的IP地址：${I.invalidIps.join(", ")}`)},trigger:["blur","input"]}]},{field:"whitelistCidrs",label:"CIDR白名单",type:"custom",span:12,defaultValue:[],tips:"匹配网段范围，如：192.168.1.0/24（192.168.1.1-254）",render:p("whitelistCidrs"),rules:[{validator:(e,i)=>{if(!i||i.length===0)return!0;const I=Te(i);return I.valid?!0:new Error(`无效的CIDR网段：${I.invalidCidrs.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistIps",label:"IP黑名单",type:"custom",span:12,defaultValue:[],tips:"精确匹配单个IP地址，黑名单优先级最高，直接拒绝访问",render:c("blacklistIps"),rules:[{validator:(e,i)=>{if(!i||i.length===0)return!0;const I=ke(i);return I.valid?!0:new Error(`无效的IP地址：${I.invalidIps.join(", ")}`)},trigger:["blur","input"]}]},{field:"blacklistCidrs",label:"CIDR黑名单",type:"custom",span:12,defaultValue:[],tips:"匹配网段范围，黑名单优先级最高，直接拒绝访问",render:p("blacklistCidrs"),rules:[{validator:(e,i)=>{if(!i||i.length===0)return!0;const I=Te(i);return I.valid?!0:new Error(`无效的CIDR网段：${I.invalidCidrs.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}],s={columns:[{field:"ipAccessConfigId",title:"IP访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"whitelistIps",title:"IP白名单",align:"left",width:200,showOverflow:!0},{field:"whitelistCidrs",title:"CIDR白名单",align:"left",width:200,showOverflow:!0},{field:"blacklistIps",title:"IP黑名单",align:"left",width:200,showOverflow:!0},{field:"blacklistCidrs",title:"CIDR黑名单",align:"left",width:200,showOverflow:!0},{field:"trustXForwardedFor",title:"信任X-Forwarded-For",align:"center",width:150,slots:{default:"trustXForwardedFor"}},{field:"trustXRealIp",title:"信任X-Real-IP",align:"center",width:130,slots:{default:"trustXRealIp"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?$(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?$(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:f,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},P=()=>{f.value=void 0},d=e=>{f.value?Object.assign(f.value,e):f.value=e},r=e=>{l.value=e},n=()=>{l.value=[]},o=e=>{l.value.unshift(e)},u=(e,i,I)=>{const b=l.value.findIndex(W=>W.ipAccessConfigId===e&&W.tenantId===i);b!==-1&&Object.assign(l.value[b],I)},m=(e,i)=>{const I=l.value.findIndex(b=>b.ipAccessConfigId===e&&b.tenantId===i);I!==-1&&l.value.splice(I,1)};return{moduleId:a,loading:y,configList:l,pageInfo:f,searchFormConfig:h,formFields:t,gridConfig:s,resetPagination:P,updatePagination:d,setConfigList:r,clearConfigList:n,addConfigToList:o,updateConfigInList:u,removeConfigFromList:m,removeConfigsFromList:e=>{e.forEach(i=>{m(i.ipAccessConfigId,i.tenantId)})}}}function ea(a,y){const l=Y(),f=de(),h=Zt(),{loading:c,configList:p,pageInfo:t,setConfigList:s,updatePagination:P,addConfigToList:d,updateConfigInList:r,removeConfigFromList:n}=h,o=async x=>{var w,A,T;c.value=!0;try{let F=x;!F&&((w=y==null?void 0:y.value)!=null&&w.getFormData)&&(F=y.value.getFormData()||{});const V=F?Object.fromEntries(Object.entries(F).filter(([,M])=>M!==""&&M!==null&&M!==void 0)):{},N={...V,...se((A=t.value)==null?void 0:A.pageIndex,(T=t.value)==null?void 0:T.pageSize)};if(a!=null&&a.value)N.securityConfigId=a.value;else if(!V.securityConfigId){l.error("securityConfigId不能为空");return}const E=await it(N);if(L(E)){const M=U(E,[]);s(M);const K=ge(E);K&&Object.keys(K).length>0&&P(K)}else l.error(S(E,"查询IP访问控制配置列表失败"))}catch{l.error("加载IP访问控制配置列表失败")}finally{c.value=!1}};return{model:h,loadConfigs:o,handleSearch:async x=>{h.resetPagination(),await o(x)},handleReset:async()=>{h.resetPagination(),await o()},handlePageChange:async({currentPage:x,pageSize:w})=>{P({pageIndex:x,pageSize:w}),await o()},handleRefresh:async()=>{await o()},addConfig:async x=>{c.value=!0;try{const w=await et(x);if(L(w)){l.success(S(w,"新增IP访问控制配置成功"));const A=U(w,null);return A?d(A):await o(),!0}else return l.error(S(w,"新增IP访问控制配置失败")),!1}catch{return l.error("新增IP访问控制配置失败"),!1}finally{c.value=!1}},editConfig:async x=>{c.value=!0;try{const w=await at(x);if(L(w)){l.success(S(w,"编辑IP访问控制配置成功"));const A=U(w,null);return A?r(A.ipAccessConfigId,A.tenantId,A):await o(),!0}else return l.error(S(w,"编辑IP访问控制配置失败")),!1}catch{return l.error("编辑IP访问控制配置失败"),!1}finally{c.value=!1}},deleteConfig:async x=>{if(!await f.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除IP访问控制配置 "${x.configName}" 吗？`,icon:we,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;c.value=!0;try{const A=await lt({ipAccessConfigId:x.ipAccessConfigId,tenantId:x.tenantId});return L(A)?(l.success(S(A,"删除IP访问控制配置成功")),n(x.ipAccessConfigId,x.tenantId),p.value.length===0&&t.value&&t.value.pageIndex>1&&(P({pageIndex:t.value.pageIndex-1}),await o()),!0):(l.error(S(A,"删除IP访问控制配置失败")),!1)}catch{return l.error("删除IP访问控制配置失败"),!1}finally{c.value=!1}},getConfigDetail:async x=>{try{const w=await tt({ipAccessConfigId:x});return L(w)?U(w,{}):(l.error(S(w,"获取IP访问控制配置详情失败")),null)}catch{return l.error("获取IP访问控制配置详情失败"),null}}}}function ta(a,y,l){const f=Y(),h=ea(y,l),c=k(!1),p=k("create"),t=k(null),s=e=>({...e,whitelistIps:B(e.whitelistIps),blacklistIps:B(e.blacklistIps),whitelistCidrs:B(e.whitelistCidrs),blacklistCidrs:B(e.blacklistCidrs)}),P=e=>{p.value="create",t.value=e?{securityConfigId:e}:null,c.value=!0},d=async e=>{if(e.ipAccessConfigId)try{const i=await h.getConfigDetail(e.ipAccessConfigId);if(i){p.value="edit",t.value=s(i),c.value=!0;return}}catch{}p.value="edit",t.value=s(e),c.value=!0},r=()=>{c.value=!1,t.value=null},n=async e=>{if(e.ipAccessConfigId)try{const i=await h.getConfigDetail(e.ipAccessConfigId);if(i){p.value="view",t.value=s(i),c.value=!0;return}}catch{}p.value="view",t.value=s(e),c.value=!0};return{service:h,formDialogVisible:c,formDialogMode:p,currentEditConfig:t,openAddDialog:P,openEditDialog:d,openViewDialog:n,handleFormSubmit:async e=>{if(!e||p.value==="view")return;const i={...e,whitelistIps:Array.isArray(e.whitelistIps)?JSON.stringify(e.whitelistIps):e.whitelistIps,blacklistIps:Array.isArray(e.blacklistIps)?JSON.stringify(e.blacklistIps):e.blacklistIps,whitelistCidrs:Array.isArray(e.whitelistCidrs)?JSON.stringify(e.whitelistCidrs):e.whitelistCidrs,blacklistCidrs:Array.isArray(e.blacklistCidrs)?JSON.stringify(e.blacklistCidrs):e.blacklistCidrs};if(p.value==="create"){const I=i.securityConfigId||(y==null?void 0:y.value);if(!I){f.error("安全配置ID不能为空");return}i.securityConfigId=I,await h.addConfig(i)&&r()}else if(p.value==="edit"){if(!t.value)return;const I={...t.value,...i};await h.editConfig(I)&&r()}},handleToolbarClick:async(e,i)=>{switch(e){case"add":const I=y==null?void 0:y.value;if(!I){f.warning("请先选择安全配置");return}P(I);break;case"edit":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要编辑的配置");return}d(b);break}case"delete":{if(!(a!=null&&a.value)){f.warning("Grid 引用未设置");return}const b=a.value.getCurrentRecord();if(!b){f.warning("请先点击选择要删除的配置");return}await h.deleteConfig(b);break}case"search":{await h.handleSearch(i);break}}},handleMenuClick:async({code:e,row:i})=>{if(i)switch(e){case"view":n(i);break;case"edit":d(i);break;case"delete":await h.deleteConfig(i);break}},handleSearch:async e=>{await h.handleSearch(e)}}}const aa=["id"],la=G({name:"IpAccessConfigListModal",__name:"IpAccessConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:"IP访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(),c=k(),p=k(l.visible);R(()=>l.visible,i=>{p.value=i});const t=k(l.securityConfigId);R(()=>l.securityConfigId,i=>{t.value=i});const{service:s,formDialogVisible:P,formDialogMode:d,currentEditConfig:r,handleFormSubmit:n,handleToolbarClick:o,handleMenuClick:u,handleSearch:m}=ta(c,t,h),C=i=>{p.value=i,f("update:visible",i),f(i?"refresh":"close")},e=()=>{p.value||(P.value=!1,d.value="create",r.value=null,s.model.configList.value=[],s.model.resetPagination())};return(i,I)=>(ee(),he(g(ce),{visible:p.value,title:l.title||"IP访问控制配置列表",width:l.width||1200,to:l.to,"show-footer":!1,"onUpdate:visible":C,onAfterLeave:e},{default:O(()=>[me("div",{class:"ip-access-config-list-modal",id:g(s).model.moduleId},[D(g(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[D(oe,X({ref_key:"searchFormRef",ref:h,"module-id":g(s).model.moduleId},g(s).model.searchFormConfig,{onSearch:g(m),onToolbarClick:g(o)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[D(g(re),X({ref_key:"gridRef",ref:c,"module-id":g(s).model.moduleId,data:g(s).model.configList,loading:g(s).model.loading},g(s).model.gridConfig,{onPageChange:g(s).handlePageChange,onMenuClick:g(u)}),{defaultPolicy:O(({row:b})=>[D(g(H),{type:b.defaultPolicy==="allow"?"success":"error",size:"small"},{default:O(()=>[J(q(b.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:b})=>[D(g(H),{type:b.activeFlag==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),trustXForwardedFor:O(({row:b})=>[D(g(H),{type:b.trustXForwardedFor==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.trustXForwardedFor==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),trustXRealIp:O(({row:b})=>[D(g(H),{type:b.trustXRealIp==="Y"?"success":"default",size:"small"},{default:O(()=>[J(q(b.trustXRealIp==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),D(Z,{visible:g(P),"onUpdate:visible":I[0]||(I[0]=b=>te(P)?P.value=b:null),mode:g(d),title:g(d)==="create"?"新增IP访问控制配置":g(d)==="edit"?"编辑IP访问控制配置":"查看IP访问控制配置详情",to:`#${g(s).model.moduleId}`,"form-fields":g(s).model.formFields,"initial-data":g(r)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(s).model.loading.value,onSubmit:g(n)},null,8,["visible","mode","title","to","form-fields","initial-data","confirm-loading","onSubmit"])],8,aa)]),_:1},8,["visible","title","width","to"]))}}),Sa=ae(la,[["__scopeId","data-v-397908ec"]]);function ia(){const a="hubcommon002-rate-limit",y=k(!1),l=[{label:"IP策略",value:"ip"},{label:"用户策略",value:"user"},{label:"路径策略",value:"path"},{label:"服务策略",value:"service"},{label:"路由策略",value:"route"}],f=[{label:"令牌桶算法",value:"token-bucket"},{label:"漏桶算法",value:"leaky-bucket"},{label:"滑动窗口算法",value:"sliding-window"},{label:"固定窗口算法",value:"fixed-window"},{label:"无限流",value:"none"}],h=()=>t=>{const s=t.algorithm;return s==="token-bucket"?v(ie,{type:"info"},{default:()=>v(le,null,{default:()=>[v("strong",null,"令牌桶算法："),"以固定速率向桶中放入令牌，请求需要消耗令牌才能通过。支持突发流量，桶满时多余令牌会被丢弃。",v("br"),"• 限流速率：每秒向桶中填充的令牌数（令牌/秒）",v("br"),"• 突发容量：桶的最大容量（最大令牌数），决定了最大突发请求数"]})}):s==="leaky-bucket"?v(ie,{type:"info"},{default:()=>v(le,null,{default:()=>[v("strong",null,"漏桶算法："),"请求先进入桶中，然后以固定速率从桶中流出。能够平滑突发流量，但不支持突发处理。",v("br"),"• 限流速率：每秒从桶中漏出的请求数（处理速率）",v("br"),"• 突发容量：桶的最大容量（最大可容纳的请求数），超出时请求会被拒绝"]})}):s==="sliding-window"?v(ie,{type:"info"},{default:()=>v(le,null,{default:()=>[v("strong",null,"滑动窗口算法："),"在固定时间窗口内限制请求数量。窗口会随时间滑动，提供更精确的限流控制，避免边界突刺问题。",v("br"),"• 限流速率：时间窗口内允许的最大请求数",v("br"),"• 时间窗口：统计请求数量的时间范围（秒）"]})}):s==="fixed-window"?v(ie,{type:"info"},{default:()=>v(le,null,{default:()=>[v("strong",null,"固定窗口算法："),"在固定时间窗口内限制请求数量。窗口到期后重置计数器，可能出现边界突发（临界问题）。",v("br"),"• 限流速率：时间窗口内允许的最大请求数",v("br"),"• 时间窗口：统计请求数量的时间范围（秒）"]})}):s==="none"?v(ie,{type:"warning"},{default:()=>v(le,null,{default:()=>[v("strong",null,"无限流："),"不进行任何限流控制，所有请求都会通过。通常用于临时关闭限流或测试环境。"]})}):v("div")},c=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],p=[{field:"rateLimitConfigId",label:"限流配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"limitName",label:"限流规则名称",type:"input",placeholder:"请输入限流规则名称",span:12,required:!0,defaultValue:"限流规则",tabKey:"basic"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"keyStrategy",label:"限流键策略",type:"select",span:12,required:!0,defaultValue:"ip",tabKey:"basic",props:{options:l,placeholder:"选择限流键策略"},tips:"IP策略：按IP地址限流；用户策略：按用户ID限流；路径策略：按请求路径限流；服务策略：按服务名限流；路由策略：按路由配置限流"},{field:"algorithm",label:"限流算法",type:"select",span:12,required:!0,defaultValue:"token-bucket",tabKey:"basic",props:{options:f,placeholder:"选择限流算法"},tips:"支持令牌桶、漏桶、滑动窗口、固定窗口等限流算法"}]},{field:"limitParamsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"limitRate",label:t=>{const s=t==null?void 0:t.algorithm;return s==="token-bucket"?"填充速率(令牌/秒)":s==="leaky-bucket"?"漏出速率(请求/秒)":s==="sliding-window"||s==="fixed-window"?"窗口内最大请求数":"限流速率(次/秒)"},type:"number",placeholder:"每秒允许的请求数",span:12,required:!0,defaultValue:100,tabKey:"basic",props:{min:1,max:1e4},tips:t=>{const s=t==null?void 0:t.algorithm;return s==="token-bucket"?"每秒向桶中填充的令牌数（令牌/秒）。每个请求需要消耗一个令牌才能通过。":s==="leaky-bucket"?"每秒从桶中漏出的请求数（处理速率）。无论输入如何，输出速率都严格限制为此值。":s==="sliding-window"||s==="fixed-window"?"时间窗口内允许的最大请求数。超过此数量的请求将被拒绝。":"每秒允许通过的请求数量"}},{field:"burstCapacity",label:t=>{const s=t==null?void 0:t.algorithm;return s==="token-bucket"?"桶容量(令牌)":s==="leaky-bucket"?"桶容量(请求)":"突发容量"},type:"number",placeholder:"允许的突发请求数",span:12,required:!0,defaultValue:200,tabKey:"basic",show:t=>{const s=t==null?void 0:t.algorithm;return s==="token-bucket"||s==="leaky-bucket"},props:{min:0,max:1e5},tips:t=>{const s=t==null?void 0:t.algorithm;return s==="token-bucket"?"桶的最大容量（最大令牌数）。桶满时可以处理此数量的突发请求。":s==="leaky-bucket"?"桶的最大容量（最大可容纳的请求数）。超出此容量时，新请求会被拒绝。":"允许的突发请求数量，用于令牌桶和漏桶算法"}},{field:"timeWindowSeconds",label:"时间窗口(秒)",type:"number",placeholder:"限流时间窗口",span:12,required:!0,defaultValue:1,tabKey:"basic",show:t=>{const s=t==null?void 0:t.algorithm;return s==="sliding-window"||s==="fixed-window"},props:{min:1,max:3600},tips:t=>{const s=t==null?void 0:t.algorithm;return s==="sliding-window"?"滑动时间窗口的大小（秒）。窗口会随时间滑动，提供更精确的限流控制。":s==="fixed-window"?"固定时间窗口的大小（秒）。窗口到期后重置计数器，可能出现边界突发。":"限流时间窗口，用于滑动窗口和固定窗口算法"}},{field:"rejectionStatusCode",label:"拒绝状态码",type:"number",placeholder:"限流时返回的HTTP状态码",span:12,required:!0,defaultValue:429,tabKey:"basic",props:{min:400,max:599},tips:"限流时返回的HTTP状态码，通常为429（Too Many Requests）"},{field:"rejectionMessage",label:"拒绝提示消息",type:"input",placeholder:"限流时的提示消息",span:24,required:!0,defaultValue:"请求过于频繁，请稍后再试",tabKey:"basic",tips:"限流时返回给客户端的错误消息"}]},{field:"algorithmDescription",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"algorithmDesc",label:"算法说明",type:"custom",span:24,tabKey:"basic",show:t=>t.algorithm&&t.algorithm!=="none",render:h()}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"noteText",label:"备注",type:"textarea",span:24,tabKey:"other",placeholder:"请输入备注信息"}];return{moduleId:a,loading:y,formTabs:c,formFields:p}}function na(){const a=Y(),y=ia(),{loading:l}=y;return{model:y,getConfigDetail:async p=>{try{const t=await xt(p);return L(t)?U(t,null):(a.error(S(t,"获取限流配置详情失败")),null)}catch{return a.error("获取限流配置详情失败"),null}},addConfig:async p=>{l.value=!0;try{const t=await Tt(p);return L(t)?(a.success(S(t,"新增限流配置成功")),!0):(a.error(S(t,"新增限流配置失败")),!1)}catch{return a.error("新增限流配置失败"),!1}finally{l.value=!1}},editConfig:async p=>{l.value=!0;try{const t=await St(p);return L(t)?(a.success(S(t,"编辑限流配置成功")),!0):(a.error(S(t,"编辑限流配置失败")),!1)}catch{return a.error("编辑限流配置失败"),!1}finally{l.value=!1}}}}function sa(a){Y();const y=na(),l=k(!1),f=k("create"),h=k(null),c=r=>({...r,customConfig:(o=>{if(typeof o=="string"&&o)try{return JSON.parse(o)}catch{return o}return o})(r.customConfig)||{}}),p=r=>({...r,customConfig:typeof r.customConfig=="object"?JSON.stringify(r.customConfig):r.customConfig||"{}"}),t=async()=>{var u,m;const r=(u=a.gatewayInstanceId)==null?void 0:u.value,n=(m=a.routeConfigId)==null?void 0:m.value;if(!r&&!n)return;const o=await y.getConfigDetail({gatewayInstanceId:r,routeConfigId:n});o?(h.value=c(o),f.value="edit"):(h.value=null,f.value="create")},s=async()=>{await t(),l.value=!0},P=()=>{l.value=!1,h.value=null},d=async r=>{var o,u;if(!r||f.value==="view")return;const n=p(r);if((o=a.gatewayInstanceId)!=null&&o.value&&(n.gatewayInstanceId=a.gatewayInstanceId.value),(u=a.routeConfigId)!=null&&u.value&&(n.routeConfigId=a.routeConfigId.value),f.value==="create")await y.addConfig(n)&&await t();else if(f.value==="edit"){if(!h.value)return;const m={...n,rateLimitConfigId:h.value.rateLimitConfigId,tenantId:h.value.tenantId};await y.editConfig(m)&&await t()}};return R(()=>{var r,n;return[(r=a.gatewayInstanceId)==null?void 0:r.value,(n=a.routeConfigId)==null?void 0:n.value]},()=>{l.value&&t()}),{service:y,formDialogVisible:l,formDialogMode:f,currentEditConfig:h,openDialog:s,closeFormDialog:P,handleFormSubmit:d,loadConfig:t}}const ra=["id"],oa=G({name:"RateLimitConfigFormModal",__name:"RateLimitConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{default:"rate-limit-config-form-modal"},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(a,{emit:y}){const l=a,f=y,h=k(l.gatewayInstanceId),c=k(l.routeConfigId),p=sa({gatewayInstanceId:h,routeConfigId:c}),{service:t,formDialogVisible:s,formDialogMode:P,currentEditConfig:d,openDialog:r,closeFormDialog:n,handleFormSubmit:o}=p,u=j(()=>l.moduleId||"rate-limit-config-form-modal"),m=j(()=>l.title?l.title:P.value==="create"?"新增限流配置":P.value==="edit"?"编辑限流配置":"查看限流配置详情");R(()=>l.visible,async e=>{e?(h.value=l.gatewayInstanceId,c.value=l.routeConfigId,s.value&&(n(),await fe()),await r()):s.value&&n()});const C=e=>{e||(f("update:visible",!1),f("close"),f("refresh"))};return(e,i)=>(ee(),Ie("div",{class:"rate-limit-config-form-modal",id:u.value},[D(Z,{visible:g(s),"onUpdate:visible":[i[0]||(i[0]=I=>te(s)?s.value=I:null),C],mode:g(P),title:m.value,width:l.width||800,to:l.to||(u.value?`#${u.value}`:void 0),"form-fields":g(t).model.formFields,"form-tabs":g(t).model.formTabs,"initial-data":g(d)||void 0,"auto-close-on-confirm":!1,"confirm-loading":g(t).model.loading.value,onSubmit:g(o)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,ra))}}),xa=ae(oa,[["__scopeId","data-v-e947f20c"]]);export{Aa as A,ka as C,Ta as D,Sa as I,z as N,xa as R,Ia as U,Pa as a};

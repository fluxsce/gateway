import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Ds-H5BDS.js";import{u as y}from"./useGDialog-DyYy8db0.js";import{u as D}from"./useNamespaceService-Ci56zPwP.js";import{m as S,r as u}from"./index-talhFt-3.js";function V(c,g){const s=S(),b=y(),t=D(g),r=u(!1),n=u("create"),l=u(null),d=u(!1),w=()=>{n.value="create",l.value=null,r.value=!0},h=async a=>{try{const e=await t.getNamespaceDetail(a.namespaceId);if(!e){s.error("获取命名空间详情失败");return}n.value="edit",l.value=e,r.value=!0}catch{s.error("获取命名空间详情失败")}},v=async a=>{try{const e=await t.getNamespaceDetail(a.namespaceId);if(!e){s.error("获取命名空间详情失败");return}n.value="view",l.value=e,r.value=!0}catch{s.error("获取命名空间详情失败")}},f=()=>{r.value=!1,l.value=null},p=async a=>{d.value=!0;try{let e=!1;n.value==="create"?e=await t.addNamespace(a):n.value==="edit"&&(e=await t.editNamespace({...a,namespaceId:l.value.namespaceId})),e&&(f(),await t.handleRefresh())}finally{d.value=!1}},k=a=>{var e,o;switch(a){case"add":w();break;case"edit":const i=((e=c==null?void 0:c.value)==null?void 0:e.getCheckboxRecords())||[];if(i.length===0){s.warning("请先选择要编辑的命名空间");return}if(i.length>1){s.warning("只能编辑一个命名空间");return}h(i[0]);break;case"delete":const m=((o=c==null?void 0:c.value)==null?void 0:o.getCheckboxRecords())||[];if(m.length===0){s.warning("请先选择要删除的命名空间");return}N(m);break}},N=async a=>{if(!await b.warning({title:"确认批量删除",subtitle:`将删除 ${a.length} 个命名空间`,content:"此操作不可恢复，请谨慎操作",positiveText:"确定删除",negativeText:"取消",width:500}))return;let o=0;for(const i of a)await t.deleteNamespace(i)&&o++;o>0&&(s.success(`成功删除 ${o} 个命名空间`),await t.handleRefresh())};return{service:t,formDialogVisible:r,formDialogMode:n,currentEditNamespace:l,submitting:d,openAddDialog:w,openEditDialog:h,openViewDialog:v,closeFormDialog:f,handleSubmit:p,handleFormSubmit:a=>{a&&p(a)},handleToolbarClick:k,handleMenuClick:async a=>{if(!a.row)return;const e=a.row;switch(a.code){case"view":await v(e);break;case"edit":await h(e);break;case"delete":await t.deleteNamespace(e),await t.handleRefresh();break}},handleSearch:()=>{t.handleSearch()}}}export{V as u};

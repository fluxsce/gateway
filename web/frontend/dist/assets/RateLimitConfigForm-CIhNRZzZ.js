import{d as ie,c as H,o as p,a as F,$ as ke,Z as xe,a8 as ne,aM as J,I as oe,v as L,cQ as _e,a3 as be,bR as b,r as T,g as ee,f as de,R as re,b as fe,a0 as ae,a1 as le,a2 as ce,h as pe,m as t,q as E,t as A,n as e,w as a,aX as ve,V as Y,cz as w,J as r,aY as ye,E as q,x as K,d2 as G,d3 as Pe,d4 as Ae,_ as ge,B as Se,D as Ne,M as De,A as Ce,U as we,S as Ie,co as ze,cT as Ue}from"./index-Bm8WTrgo.js";import{T as Fe}from"./TrashOutline-lFSebtJX.js";import{I as Z}from"./InformationCircleOutline-BTXjnBdJ.js";import{N as te}from"./Switch-Bksdye9l.js";import{_ as V}from"./Grid-BszSwIPR.js";import{_ as m}from"./FormItemGridItem-B5vUm4-s.js";import{_ as ue}from"./RadioGroup-DeGnoaYt.js";import{_ as Q}from"./DynamicTags-0c3x5b1s.js";import{_ as me}from"./Alert-DJnAu6Nd.js";import{C as Te}from"./CreateOutline-B_iFUquS.js";import{C as Oe}from"./CheckmarkCircleOutline-zm_tlaJ3.js";import{N as se}from"./InputNumber-Da0ADIUs.js";import{A as Re}from"./AddOutline-Crq49hC7.js";import{R as Me}from"./RefreshOutline-BMOJJPWL.js";import{_ as Ee}from"./DataTable-C88L71Mp.js";const je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$e=ie({name:"ChatboxOutline",render:function(z,u){return p(),H("svg",je,u[0]||(u[0]=[F("path",{d:"M408 64H104a56.16 56.16 0 0 0-56 56v192a56.16 56.16 0 0 0 56 56h40v80l93.72-78.14a8 8 0 0 1 5.13-1.86H408a56.16 56.16 0 0 0 56-56V120a56.16 56.16 0 0 0-56-56z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),He={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Be=ie({name:"FlagOutline",render:function(z,u){return p(),H("svg",He,u[0]||(u[0]=[F("path",{d:"M80 464V68.14a8 8 0 0 1 4-6.9C91.81 56.66 112.92 48 160 48c64 0 145 48 192 48a199.53 199.53 0 0 0 77.23-15.77a2 2 0 0 1 2.77 1.85v219.36a4 4 0 0 1-2.39 3.65C421.37 308.7 392.33 320 352 320c-48 0-128-32-192-32s-80 16-80 16",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Je=ie({name:"ReaderOutline",render:function(z,u){return p(),H("svg",Le,u[0]||(u[0]=[F("rect",{x:"96",y:"48",width:"320",height:"416",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),F("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 128h160"},null,-1),F("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 208h160"},null,-1),F("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 288h80"},null,-1)]))}}),We={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ye=ie({name:"SaveOutline",render:function(z,u){return p(),H("svg",We,u[0]||(u[0]=[F("path",{d:"M380.93 57.37A32 32 0 0 0 358.3 48H94.22A46.21 46.21 0 0 0 48 94.22v323.56A46.21 46.21 0 0 0 94.22 464h323.56A46.36 46.36 0 0 0 464 417.78V153.7a32 32 0 0 0-9.37-22.63zM256 416a64 64 0 1 1 64-64a63.92 63.92 0 0 1-64 64zm48-224H112a16 16 0 0 1-16-16v-64a16 16 0 0 1 16-16h192a16 16 0 0 1 16 16v64a16 16 0 0 1-16 16z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),X=ke("/gateway/hubcommon002");async function Xe(g){return X.post("/addSecurityConfig",g)}async function Ke(g){return X.post("/editSecurityConfig",g)}async function qe(g,z){return X.post("/deleteSecurityConfig",{securityConfigId:g,tenantId:z})}async function Ve(g){return X.post("/querySecurityConfigsByGatewayInstance",g)}async function Qe(g){return X.post("/querySecurityConfigsByRouteConfig",g)}async function Ge(g){return X.post("/ip-access/add",g)}async function Ze(g){return X.post("/ip-access/get",g)}async function et(g){return X.post("/ip-access/update",g)}async function tt(g){return X.post("/useragent-access/add",g)}async function at(g){return X.post("/useragent-access/get",g)}async function lt(g){return X.post("/useragent-access/update",g)}async function nt(g){return X.post("/api-access/add",g)}async function it(g){return X.post("/api-access/get",g)}async function st(g){return X.post("/api-access/update",g)}async function ot(g){return X.post("/domain-access/add",g)}async function ut(g){return X.post("/domain-access/get",g)}async function rt(g){return X.post("/domain-access/update",g)}async function dt(g){return X.post("/cors/add",g)}async function ft(g){return X.post("/cors/get",g)}async function gt(g){return X.post("/cors/update",g)}async function ct(g){return X.post("/auth/add",g)}async function pt(g){return X.post("/auth/get",g)}async function vt(g){return X.post("/auth/update",g)}async function yt(g){return X.post("/rate-limit/add",g)}async function mt(g){return X.post("/rate-limit/get",g)}async function It(g){return X.post("/rate-limit/update",g)}xe("SecurityConfig");function Ct(){const g=n=>n.filter(x=>x.activeFlag==="Y"),z=n=>{const x=n.activeFlag==="Y";return ne(J,{type:x?"success":"default",size:"small"},()=>x?"活动":"非活动")},u=n=>n.gatewayInstanceId?ne(J,{type:"info",size:"small"},()=>"实例级"):n.routeConfigId?ne(J,{type:"warning",size:"small"},()=>"路由级"):ne(J,{type:"default",size:"small"},()=>"全局"),I=(n,x)=>{const y=ne(be,{trigger:"hover"},{trigger:()=>ne(oe,{size:"small",type:"primary",secondary:!0,onClick:()=>x("edit",n)},{icon:()=>ne(L,null,()=>ne(_e))}),default:()=>"编辑配置"}),D=ne(be,{trigger:"hover"},{trigger:()=>ne(oe,{size:"small",type:"error",secondary:!0,onClick:()=>x("delete",n)},{icon:()=>ne(L,null,()=>ne(Fe))}),default:()=>"删除配置"});return ne(b,{size:"small"},()=>[y,D])};return{getActiveConfigs:g,renderActiveTag:z,renderConfigType:u,renderActionButtons:I,createTableColumns:n=>[{title:"配置名称",key:"configName",width:180,ellipsis:{tooltip:!0}},{title:"描述",key:"configDesc",width:200,ellipsis:{tooltip:!0},render:x=>x.configDesc||"-"},{title:"配置类型",key:"configType",width:100,render:u},{title:"优先级",key:"configPriority",width:80,render:x=>x.configPriority},{title:"状态",key:"activeFlag",width:100,render:z},{title:"创建时间",key:"addTime",width:160,render:x=>x.addTime||"-"},{title:"最后修改",key:"editTime",width:160,render:x=>x.editTime||"-"},{title:"操作",key:"actions",width:150,fixed:"right",render:x=>I(x,n)}]}}function wt(){const g=fe(),z={configName:[{required:!0,message:"请输入配置名称",trigger:"blur"},{min:2,max:50,message:"配置名称长度在2-50个字符",trigger:"blur"}],configDesc:[{required:!0,message:"请输入配置描述",trigger:"blur"}],configPriority:[{required:!0,type:"number",message:"请输入配置优先级",trigger:"blur"}]},u=()=>({configName:"",configDesc:"",configPriority:1,noteText:""});return{formRules:z,createDefaultFormData:u,fillEditData:(M,n)=>{n?Object.assign(M,n):Object.assign(M,u())},message:g}}function bt(g){const{formRules:z,createDefaultFormData:u,fillEditData:I,message:M}=wt(),n=T(),x=T(!1),y=T(""),D=T(!1),d=ee(()=>!!g.editData),j=de(u());re(()=>g.editData,h=>{I(j,h),h&&(y.value=h.securityConfigId||"",D.value=!1)},{immediate:!0});const s=()=>{D.value=!0},N=async()=>{var h;try{await((h=n.value)==null?void 0:h.validate()),x.value=!0;const S={configName:j.configName,configDesc:j.configDesc,configPriority:j.configPriority,noteText:j.noteText,gatewayInstanceId:g.gatewayInstanceId,routeConfigId:g.routeConfigId};let k;if(d.value&&y.value?k=await Ke({...S,securityConfigId:y.value}):k=await Xe(S),ae(k)){const i=le(k);y.value=(i==null?void 0:i.securityConfigId)||y.value,D.value=!1,M.success(d.value?"基础配置更新成功":"基础配置创建成功")}else{const i=ce(k,"基础配置保存失败");M.error(i)}}catch{M.error("请检查基础配置输入")}finally{x.value=!1}},$=h=>{M.success(`${U(h)}保存成功`)},B=(h,S)=>{M.error(`${U(h)}保存失败: ${S}`)},U=h=>({ip:"IP访问控制",useragent:"User-Agent控制",api:"API访问控制",domain:"域名访问控制"})[h]||h;return{formRef:n,formData:j,formRules:z,isEdit:d,basicConfigSaving:x,currentSecurityConfigId:y,hasBasicConfigChanges:D,markBasicConfigChanged:s,handleSaveBasicConfig:N,handleSubModuleSaveSuccess:$,handleSubModuleSaveError:B}}const ht={class:"ip-access-config"},kt={key:0},xt={key:0},_t={key:0},Pt={key:0},At={key:0},St=ie({__name:"IpAccessConfigForm",props:{securityConfigId:{default:""},gatewayInstanceId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=()=>({activeFlag:"N",configName:"IP访问控制配置",defaultPolicy:"allow",whitelistIps:[],blacklistIps:[],whitelistCidrs:[],blacklistCidrs:[],trustXForwardedFor:"N",trustXRealIp:"N",...u.initialData}),n=de(M()),x=T(!1),y=T(!1),D=T(!1),d=T(""),j=T(!1),s=de({whitelistIps:[],blacklistIps:[],whitelistCidrs:[],blacklistCidrs:[]}),N=[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}],$=ee(()=>!!(u.securityConfigId&&u.gatewayInstanceId)),B=ee(()=>{const _=JSON.stringify(n);return new Blob([_]).size}),U=ee(()=>!h.value&&y.value),h=ee(()=>s.whitelistIps.length>0||s.blacklistIps.length>0||s.whitelistCidrs.length>0||s.blacklistCidrs.length>0),S=(_,c)=>{const P=Pe(_);return s[c]=P.invalidIps,P.valid},k=(_,c)=>{const P=Ae(_);return s[c]=P.invalidCidrs,P.valid},i=_=>{if(_===0)return"0 B";const c=1024,P=["B","KB","MB"],he=Math.floor(Math.log(_)/Math.log(c));return parseFloat((_/Math.pow(c,he)).toFixed(2))+" "+P[he]},l=()=>{const{defaultPolicy:_}=n,c=n.whitelistIps.length>0||n.whitelistCidrs.length>0,P=n.blacklistIps.length>0||n.blacklistCidrs.length>0;return _==="allow"?P?"默认允许，黑名单拒绝":"默认允许所有IP":c?"默认拒绝，白名单允许":"默认拒绝所有IP"},o=async _=>{n.activeFlag=_,y.value=!0,d.value&&await f()},W=()=>{y.value=!0},C=_=>{s[_]=[],S(n[_],_),y.value=!0},O=_=>{s[_]=[],k(n[_],_),y.value=!0},R=async()=>{if($.value)try{const _=await Ze({securityConfigId:u.securityConfigId});if(ae(_)){const c=le(_);let P=null;Array.isArray(c)&&c.length>0?P=c[0]:c&&typeof c=="object"&&c.ipAccessConfigId&&(P=c),P&&(d.value=P.ipAccessConfigId,Object.assign(n,{activeFlag:P.activeFlag||"N",configName:P.configName||n.configName,defaultPolicy:P.defaultPolicy||n.defaultPolicy,whitelistIps:G(P.whitelistIps),blacklistIps:G(P.blacklistIps),whitelistCidrs:G(P.whitelistCidrs),blacklistCidrs:G(P.blacklistCidrs),trustXForwardedFor:P.trustXForwardedFor||"N",trustXRealIp:P.trustXRealIp||"N"}),D.value=!0,y.value=!1,S(n.whitelistIps,"whitelistIps"),S(n.blacklistIps,"blacklistIps"),k(n.whitelistCidrs,"whitelistCidrs"),k(n.blacklistCidrs,"blacklistCidrs"))}}catch(_){console.error("加载IP访问控制配置失败:",_)}finally{j.value=!0}},f=async()=>{if(!$.value){I.warning("请先保存基础配置");return}if(!n.configName.trim()){I.warning("请输入配置名称");return}x.value=!0;try{const _={securityConfigId:u.securityConfigId,gatewayInstanceId:u.gatewayInstanceId,configName:n.configName,defaultPolicy:n.defaultPolicy,whitelistIps:JSON.stringify(n.whitelistIps),blacklistIps:JSON.stringify(n.blacklistIps),whitelistCidrs:JSON.stringify(n.whitelistCidrs),blacklistCidrs:JSON.stringify(n.blacklistCidrs),trustXForwardedFor:n.trustXForwardedFor,trustXRealIp:n.trustXRealIp,activeFlag:n.activeFlag};let c;if(d.value?c=await et({..._,ipAccessConfigId:d.value}):c=await Ge(_),ae(c)){if(y.value=!1,D.value=!0,!d.value){const P=le(c);P!=null&&P.ipAccessConfigId&&(d.value=P.ipAccessConfigId)}I.success("IP访问控制配置保存成功")}else{const P=ce(c,"IP访问控制配置保存失败");I.error(P)}}catch(_){const c=_ instanceof Error?_.message:"保存失败";I.error(c),console.error("保存IP访问控制配置失败:",_)}finally{x.value=!1}},v=()=>{Object.assign(n,M()),Object.keys(s).forEach(_=>{s[_]=[]}),y.value=!1,D.value=!1,d.value=""};return re([()=>u.securityConfigId,()=>u.gatewayInstanceId],()=>{$.value?R():v()},{immediate:!1}),pe(()=>{$.value?R():j.value=!0}),z({save:f,reset:v,hasChanges:()=>y.value,isConfigured:()=>D.value}),(_,c)=>(p(),H("div",ht,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>c[13]||(c[13]=[r("启用IP访问控制")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>c[14]||(c[14]=[r(" 基于客户端IP地址控制访问权限，支持单IP和CIDR网段配置 ")])),_:1})]),t(e(te),{value:n.activeFlag,"onUpdate:value":[c[0]||(c[0]=P=>n.activeFlag=P),o],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),n.activeFlag==="Y"?ve((p(),H("div",kt,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"配置名称"},{default:a(()=>[t(e(q),{value:n.configName,"onUpdate:value":c[1]||(c[1]=P=>n.configName=P),placeholder:"IP访问控制配置名称",onInput:W},null,8,["value"])]),_:1}),t(e(m),{label:"默认策略"},{default:a(()=>[t(e(be),{trigger:"hover",placement:"top"},{trigger:a(()=>[t(e(ue),{value:n.defaultPolicy,"onUpdate:value":[c[2]||(c[2]=P=>n.defaultPolicy=P),W],options:N,placeholder:"选择默认策略"},null,8,["value"])]),default:a(()=>[c[15]||(c[15]=F("div",{style:{"max-width":"320px","line-height":"1.5"}},[F("p",null,[F("strong",null,"默认策略说明：")]),F("p",null,[F("strong",null,"• allow（允许）:"),r(" 默认允许访问，只有在黑名单中的IP会被拒绝")]),F("p",null,[F("strong",null,"• deny（拒绝）:"),r(" 默认拒绝访问，只有在白名单中的IP才被允许")]),F("p",{style:{color:"#f0a020"}},[F("strong",null,"⚠️ 重要："),r("黑名单优先级高于白名单，无论默认策略如何，黑名单中的IP都会被拒绝 ")])],-1))]),_:1})]),_:1}),t(e(m),{label:"信任X-Forwarded-For"},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[t(e(te),{value:n.trustXForwardedFor,"onUpdate:value":[c[3]||(c[3]=P=>n.trustXForwardedFor=P),W],"checked-value":"Y","unchecked-value":"N"},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>c[16]||(c[16]=[r("信任代理服务器的X-Forwarded-For头")])),_:1})]),_:1})]),_:1}),t(e(m),{label:"信任X-Real-IP"},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[t(e(te),{value:n.trustXRealIp,"onUpdate:value":[c[4]||(c[4]=P=>n.trustXRealIp=P),W],"checked-value":"Y","unchecked-value":"N"},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>c[17]||(c[17]=[r("信任代理服务器的X-Real-IP头")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"IP白名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.whitelistIps,"onUpdate:value":[c[5]||(c[5]=P=>n.whitelistIps=P),c[6]||(c[6]=P=>C("whitelistIps"))],"input-props":{placeholder:"输入IP地址，如：192.168.1.100"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),c[18]||(c[18]=r(" 精确匹配单个IP地址，白名单中的IP将被允许访问 "))]),_:1}),s.whitelistIps.length>0?(p(),H("div",xt,[t(e(w),{type:"error",style:{"font-size":"12px"}},{default:a(()=>[r(" 无效的IP地址："+K(s.whitelistIps.join(", ")),1)]),_:1})])):A("",!0)]),_:1})]),_:1}),t(e(m),{label:"CIDR白名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.whitelistCidrs,"onUpdate:value":[c[7]||(c[7]=P=>n.whitelistCidrs=P),c[8]||(c[8]=P=>O("whitelistCidrs"))],"input-props":{placeholder:"输入CIDR网段，如：192.168.1.0/24"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),c[19]||(c[19]=r(" 匹配网段范围，如：192.168.1.0/24（192.168.1.1-254） "))]),_:1}),s.whitelistCidrs.length>0?(p(),H("div",_t,[t(e(w),{type:"error",style:{"font-size":"12px"}},{default:a(()=>[r(" 无效的CIDR网段："+K(s.whitelistCidrs.join(", ")),1)]),_:1})])):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"IP黑名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.blacklistIps,"onUpdate:value":[c[9]||(c[9]=P=>n.blacklistIps=P),c[10]||(c[10]=P=>C("blacklistIps"))],"input-props":{placeholder:"输入IP地址，如：192.168.1.100"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),c[20]||(c[20]=r(" 精确匹配单个IP地址，黑名单优先级最高，直接拒绝访问 "))]),_:1}),s.blacklistIps.length>0?(p(),H("div",Pt,[t(e(w),{type:"error",style:{"font-size":"12px"}},{default:a(()=>[r(" 无效的IP地址："+K(s.blacklistIps.join(", ")),1)]),_:1})])):A("",!0)]),_:1})]),_:1}),t(e(m),{label:"CIDR黑名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.blacklistCidrs,"onUpdate:value":[c[11]||(c[11]=P=>n.blacklistCidrs=P),c[12]||(c[12]=P=>O("blacklistCidrs"))],"input-props":{placeholder:"输入CIDR网段，如：192.168.1.0/24"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),c[21]||(c[21]=r(" 匹配网段范围，黑名单优先级最高，直接拒绝访问 "))]),_:1}),s.blacklistCidrs.length>0?(p(),H("div",At,[t(e(w),{type:"error",style:{"font-size":"12px"}},{default:a(()=>[r(" 无效的CIDR网段："+K(s.blacklistCidrs.join(", ")),1)]),_:1})])):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[y.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>c[22]||(c[22]=[r("有变更")])),_:1})):A("",!0),!y.value&&D.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>c[23]||(c[23]=[r("已保存")])),_:1})):A("",!0),$.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>c[24]||(c[24]=[r("需要基础配置")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 策略："+K(l()),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[$.value?(p(),E(e(oe),{key:0,type:"primary",onClick:f,loading:x.value,disabled:!U.value},{default:a(()=>c[25]||(c[25]=[r(" 保存IP配置 ")])),_:1},8,["loading","disabled"])):A("",!0),h.value?(p(),E(e(w),{key:1,type:"error",style:{"font-size":"12px"}},{default:a(()=>c[26]||(c[26]=[r(" 请修复验证错误后再保存 ")])),_:1})):A("",!0)]),_:1})]),_:1})],512)),[[ye,j.value]]):A("",!0)]),_:1}),n.activeFlag==="Y"&&B.value>5120?(p(),E(e(me),{key:0,type:"warning",title:"数据量提醒",style:{"margin-top":"16px"}},{default:a(()=>[r(" 当前IP配置数据量较大（"+K(i(B.value))+"），建议分批次配置。 ",1)]),_:1})):A("",!0)]))}}),Nt=ge(St,[["__scopeId","data-v-513e277e"]]),Dt={class:"useragent-access-config"},zt={key:0},Ut=ie({__name:"UserAgentAccessConfigForm",props:{securityConfigId:{default:""},gatewayInstanceId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=()=>({activeFlag:"N",configName:"User-Agent访问控制配置",defaultPolicy:"allow",whitelistPatterns:[],blacklistPatterns:[],blockEmptyUserAgent:"N",...u.initialData}),n=de(M()),x=T(!1),y=T(!1),D=T(!1),d=T(""),j=T(!1),s=[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}],N=ee(()=>!!(u.securityConfigId&&u.gatewayInstanceId)),$=()=>{const{defaultPolicy:i}=n,l=n.whitelistPatterns.length>0,o=n.blacklistPatterns.length>0;return i==="allow"?o?"默认允许，黑名单拒绝":"默认允许所有User-Agent":l?"默认拒绝，白名单允许":"默认拒绝所有User-Agent"},B=async i=>{n.activeFlag=i,y.value=!0,d.value&&await S()},U=()=>{y.value=!0},h=async()=>{if(N.value)try{const i=await at({securityConfigId:u.securityConfigId});if(ae(i)){const l=le(i);let o=null;Array.isArray(l)&&l.length>0?o=l[0]:l&&typeof l=="object"&&l.useragentAccessConfigId&&(o=l),o&&(d.value=o.useragentAccessConfigId,Object.assign(n,{activeFlag:o.activeFlag||"N",configName:o.configName||n.configName,defaultPolicy:o.defaultPolicy||n.defaultPolicy,whitelistPatterns:G(o.whitelistPatterns),blacklistPatterns:G(o.blacklistPatterns),blockEmptyUserAgent:o.blockEmptyUserAgent||"N"}),D.value=!0,y.value=!1)}}catch(i){console.error("加载User-Agent访问控制配置失败:",i)}finally{j.value=!0}},S=async()=>{if(!N.value){I.warning("请先保存基础配置");return}if(!n.configName.trim()){I.warning("请输入配置名称");return}x.value=!0;try{const i={securityConfigId:u.securityConfigId,gatewayInstanceId:u.gatewayInstanceId,configName:n.configName,defaultPolicy:n.defaultPolicy,whitelistPatterns:JSON.stringify(n.whitelistPatterns),blacklistPatterns:JSON.stringify(n.blacklistPatterns),blockEmptyUserAgent:n.blockEmptyUserAgent,activeFlag:n.activeFlag};let l;if(d.value?l=await lt({...i,useragentAccessConfigId:d.value}):l=await tt(i),ae(l)){if(y.value=!1,D.value=!0,!d.value){const o=le(l);o!=null&&o.useragentAccessConfigId&&(d.value=o.useragentAccessConfigId)}I.success("User-Agent访问控制配置保存成功")}else{const o=ce(l,"User-Agent访问控制配置保存失败");I.error(o)}}catch(i){const l=i instanceof Error?i.message:"保存失败";I.error(l),console.error("保存User-Agent访问控制配置失败:",i)}finally{x.value=!1}},k=()=>{Object.assign(n,M()),y.value=!1,D.value=!1,d.value=""};return re([()=>u.securityConfigId,()=>u.gatewayInstanceId],()=>{N.value?h():k()},{immediate:!1}),pe(()=>{N.value?h():j.value=!0}),z({save:S,reset:k,hasChanges:()=>y.value,isConfigured:()=>D.value}),(i,l)=>(p(),H("div",Dt,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>l[6]||(l[6]=[r("启用User-Agent访问控制")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>l[7]||(l[7]=[r(" 根据客户端User-Agent字符串控制访问权限 ")])),_:1})]),t(e(te),{value:n.activeFlag,"onUpdate:value":[l[0]||(l[0]=o=>n.activeFlag=o),B],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),n.activeFlag==="Y"?ve((p(),H("div",zt,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"配置名称"},{default:a(()=>[t(e(q),{value:n.configName,"onUpdate:value":l[1]||(l[1]=o=>n.configName=o),placeholder:"User-Agent控制配置名称",onInput:U},null,8,["value"])]),_:1}),t(e(m),{label:"默认策略"},{default:a(()=>[t(e(ue),{value:n.defaultPolicy,"onUpdate:value":[l[2]||(l[2]=o=>n.defaultPolicy=o),U],options:s,placeholder:"选择默认策略"},null,8,["value"])]),_:1}),t(e(m),{label:"阻止空User-Agent",span:2},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[t(e(te),{value:n.blockEmptyUserAgent,"onUpdate:value":[l[3]||(l[3]=o=>n.blockEmptyUserAgent=o),U],"checked-value":"Y","unchecked-value":"N"},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>l[8]||(l[8]=[r("阻止没有User-Agent头的请求")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>l[9]||(l[9]=[r("User-Agent白名单")])),_:1}),t(e(Q),{value:n.whitelistPatterns,"onUpdate:value":[l[4]||(l[4]=o=>n.whitelistPatterns=o),U],"input-props":{placeholder:"输入允许的User-Agent模式"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[10]||(l[10]=r(" 支持正则表达式匹配，如：Mozilla/.*Chrome.* "))]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>l[11]||(l[11]=[r("User-Agent黑名单")])),_:1}),t(e(Q),{value:n.blacklistPatterns,"onUpdate:value":[l[5]||(l[5]=o=>n.blacklistPatterns=o),U],"input-props":{placeholder:"输入禁止的User-Agent模式"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[12]||(l[12]=r(" 支持正则表达式匹配，优先级高于白名单 "))]),_:1})]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[y.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>l[13]||(l[13]=[r("有变更")])),_:1})):A("",!0),!y.value&&D.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>l[14]||(l[14]=[r("已保存")])),_:1})):A("",!0),N.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>l[15]||(l[15]=[r("需要基础配置")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 策略："+K($()),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[N.value?(p(),E(e(oe),{key:0,type:"primary",onClick:S,loading:x.value,disabled:!y.value},{default:a(()=>l[16]||(l[16]=[r(" 保存User-Agent配置 ")])),_:1},8,["loading","disabled"])):A("",!0)]),_:1})]),_:1})],512)),[[ye,j.value]]):A("",!0)]),_:1})]))}}),Ft=ge(Ut,[["__scopeId","data-v-cd82fa8d"]]),Tt={class:"api-access-config"},Ot={key:0},Rt=ie({__name:"ApiAccessConfigForm",props:{securityConfigId:{default:""},gatewayInstanceId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=()=>({activeFlag:"N",configName:"API访问控制配置",defaultPolicy:"allow",whitelistPaths:[],blacklistPaths:[],allowedMethods:[],blockedMethods:[],...u.initialData}),n=de(M()),x=T(!1),y=T(!1),D=T(!1),d=T(""),j=T(!1),s=[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}],N=ee(()=>!!(u.securityConfigId&&u.gatewayInstanceId)),$=()=>{const{defaultPolicy:i}=n,l=n.whitelistPaths.length>0,o=n.blacklistPaths.length>0;return i==="allow"?o?"默认允许，黑名单拒绝":"默认允许所有API":l?"默认拒绝，白名单允许":"默认拒绝所有API"},B=async i=>{n.activeFlag=i,y.value=!0,d.value&&await S()},U=()=>{y.value=!0},h=async()=>{if(N.value)try{const i=await it({securityConfigId:u.securityConfigId});if(ae(i)){const l=le(i);let o=null;Array.isArray(l)&&l.length>0?o=l[0]:l&&typeof l=="object"&&l.apiAccessConfigId&&(o=l),o&&(d.value=o.apiAccessConfigId,Object.assign(n,{activeFlag:o.activeFlag||"N",configName:o.configName||n.configName,defaultPolicy:o.defaultPolicy||n.defaultPolicy,whitelistPaths:G(o.whitelistPaths),blacklistPaths:G(o.blacklistPaths),allowedMethods:G(o.allowedMethods),blockedMethods:G(o.blockedMethods)}),D.value=!0,y.value=!1)}}catch(i){console.error("加载API访问控制配置失败:",i)}finally{j.value=!0}},S=async()=>{if(!N.value){I.warning("请先保存基础配置");return}if(!n.configName.trim()){I.warning("请输入配置名称");return}x.value=!0;try{const i={securityConfigId:u.securityConfigId,gatewayInstanceId:u.gatewayInstanceId,configName:n.configName,defaultPolicy:n.defaultPolicy,whitelistPaths:JSON.stringify(n.whitelistPaths),blacklistPaths:JSON.stringify(n.blacklistPaths),allowedMethods:JSON.stringify(n.allowedMethods),blockedMethods:JSON.stringify(n.blockedMethods),activeFlag:n.activeFlag};let l;if(d.value?l=await st({...i,apiAccessConfigId:d.value}):l=await nt(i),ae(l)){if(y.value=!1,D.value=!0,!d.value){const o=le(l);o!=null&&o.apiAccessConfigId&&(d.value=o.apiAccessConfigId)}I.success("API访问控制配置保存成功")}else{const o=ce(l,"API访问控制配置保存失败");I.error(o)}}catch(i){const l=i instanceof Error?i.message:"保存失败";I.error(l),console.error("保存API访问控制配置失败:",i)}finally{x.value=!1}},k=()=>{Object.assign(n,M()),y.value=!1,D.value=!1,d.value=""};return re([()=>u.securityConfigId,()=>u.gatewayInstanceId],()=>{N.value?h():k()},{immediate:!1}),pe(()=>{N.value?h():j.value=!0}),z({save:S,reset:k,hasChanges:()=>y.value,isConfigured:()=>D.value}),(i,l)=>(p(),H("div",Tt,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>l[7]||(l[7]=[r("启用API访问控制")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>l[8]||(l[8]=[r(" 基于API路径和HTTP方法控制访问权限 ")])),_:1})]),t(e(te),{value:n.activeFlag,"onUpdate:value":[l[0]||(l[0]=o=>n.activeFlag=o),B],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),n.activeFlag==="Y"?ve((p(),H("div",Ot,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"配置名称"},{default:a(()=>[t(e(q),{value:n.configName,"onUpdate:value":l[1]||(l[1]=o=>n.configName=o),placeholder:"API访问控制配置名称",onInput:U},null,8,["value"])]),_:1}),t(e(m),{label:"默认策略"},{default:a(()=>[t(e(ue),{value:n.defaultPolicy,"onUpdate:value":[l[2]||(l[2]=o=>n.defaultPolicy=o),U],options:s,placeholder:"选择默认策略"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"API路径白名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.whitelistPaths,"onUpdate:value":[l[3]||(l[3]=o=>n.whitelistPaths=o),U],"input-props":{placeholder:"输入允许的API路径"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[9]||(l[9]=r(" 支持通配符匹配，如：/api/v1/* "))]),_:1})]),_:1})]),_:1}),t(e(m),{label:"API路径黑名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.blacklistPaths,"onUpdate:value":[l[4]||(l[4]=o=>n.blacklistPaths=o),U],"input-props":{placeholder:"输入禁止的API路径"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[10]||(l[10]=r(" 支持通配符匹配，优先级高于白名单 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"允许的HTTP方法"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.allowedMethods,"onUpdate:value":[l[5]||(l[5]=o=>n.allowedMethods=o),U],"input-props":{placeholder:"输入允许的HTTP方法"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[11]||(l[11]=r(" 如：GET, POST, PUT, DELETE "))]),_:1})]),_:1})]),_:1}),t(e(m),{label:"禁止的HTTP方法"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.blockedMethods,"onUpdate:value":[l[6]||(l[6]=o=>n.blockedMethods=o),U],"input-props":{placeholder:"输入禁止的HTTP方法"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[12]||(l[12]=r(" 优先级高于允许的方法 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[y.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>l[13]||(l[13]=[r("有变更")])),_:1})):A("",!0),!y.value&&D.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>l[14]||(l[14]=[r("已保存")])),_:1})):A("",!0),N.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>l[15]||(l[15]=[r("需要基础配置")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 策略："+K($()),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[N.value?(p(),E(e(oe),{key:0,type:"primary",onClick:S,loading:x.value,disabled:!y.value},{default:a(()=>l[16]||(l[16]=[r(" 保存API配置 ")])),_:1},8,["loading","disabled"])):A("",!0)]),_:1})]),_:1})],512)),[[ye,j.value]]):A("",!0)]),_:1})]))}}),Mt=ge(Rt,[["__scopeId","data-v-e657fa41"]]),Et={class:"domain-access-config"},jt={key:0},$t=ie({__name:"DomainAccessConfigForm",props:{securityConfigId:{default:""},gatewayInstanceId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=()=>({activeFlag:"N",configName:"域名访问控制配置",defaultPolicy:"allow",whitelistDomains:[],blacklistDomains:[],allowSubdomains:"Y",...u.initialData}),n=de(M()),x=T(!1),y=T(!1),D=T(!1),d=T(""),j=T(!1),s=[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}],N=ee(()=>!!(u.securityConfigId&&u.gatewayInstanceId)),$=()=>{const{defaultPolicy:i}=n,l=n.whitelistDomains.length>0,o=n.blacklistDomains.length>0;return i==="allow"?o?"默认允许，黑名单拒绝":"默认允许所有域名":l?"默认拒绝，白名单允许":"默认拒绝所有域名"},B=async i=>{n.activeFlag=i,y.value=!0,d.value&&await S()},U=()=>{y.value=!0},h=async()=>{if(N.value)try{const i=await ut({securityConfigId:u.securityConfigId});if(ae(i)){const l=le(i);let o=null;Array.isArray(l)&&l.length>0?o=l[0]:l&&typeof l=="object"&&l.domainAccessConfigId&&(o=l),o&&(d.value=o.domainAccessConfigId,Object.assign(n,{activeFlag:o.activeFlag||"N",configName:o.configName||n.configName,defaultPolicy:o.defaultPolicy||n.defaultPolicy,whitelistDomains:G(o.whitelistDomains),blacklistDomains:G(o.blacklistDomains),allowSubdomains:o.allowSubdomains||"Y"}),D.value=!0,y.value=!1)}}catch(i){console.error("加载域名访问控制配置失败:",i)}finally{j.value=!0}},S=async()=>{if(!N.value){I.warning("请先保存基础配置");return}if(!n.configName.trim()){I.warning("请输入配置名称");return}x.value=!0;try{const i={securityConfigId:u.securityConfigId,gatewayInstanceId:u.gatewayInstanceId,configName:n.configName,defaultPolicy:n.defaultPolicy,whitelistDomains:JSON.stringify(n.whitelistDomains),blacklistDomains:JSON.stringify(n.blacklistDomains),allowSubdomains:n.allowSubdomains,activeFlag:n.activeFlag};let l;if(d.value?l=await rt({...i,domainAccessConfigId:d.value}):l=await ot(i),ae(l)){if(y.value=!1,D.value=!0,!d.value){const o=le(l);o!=null&&o.domainAccessConfigId&&(d.value=o.domainAccessConfigId)}I.success("域名访问控制配置保存成功")}else{const o=ce(l,"域名访问控制配置保存失败");I.error(o)}}catch(i){const l=i instanceof Error?i.message:"保存失败";I.error(l),console.error("保存域名访问控制配置失败:",i)}finally{x.value=!1}},k=()=>{Object.assign(n,M()),y.value=!1,D.value=!1,d.value=""};return re([()=>u.securityConfigId,()=>u.gatewayInstanceId],()=>{N.value?h():k()},{immediate:!1}),pe(()=>{N.value?h():j.value=!0}),z({save:S,reset:k,hasChanges:()=>y.value,isConfigured:()=>D.value}),(i,l)=>(p(),H("div",Et,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>l[6]||(l[6]=[r("启用域名访问控制")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>l[7]||(l[7]=[r(" 基于请求域名控制访问权限 ")])),_:1})]),t(e(te),{value:n.activeFlag,"onUpdate:value":[l[0]||(l[0]=o=>n.activeFlag=o),B],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),n.activeFlag==="Y"?ve((p(),H("div",jt,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"配置名称"},{default:a(()=>[t(e(q),{value:n.configName,"onUpdate:value":l[1]||(l[1]=o=>n.configName=o),placeholder:"域名访问控制配置名称",onInput:U},null,8,["value"])]),_:1}),t(e(m),{label:"默认策略"},{default:a(()=>[t(e(ue),{value:n.defaultPolicy,"onUpdate:value":[l[2]||(l[2]=o=>n.defaultPolicy=o),U],options:s,placeholder:"选择默认策略"},null,8,["value"])]),_:1}),t(e(m),{label:"允许子域名",span:2},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[t(e(te),{value:n.allowSubdomains,"onUpdate:value":[l[3]||(l[3]=o=>n.allowSubdomains=o),U],"checked-value":"Y","unchecked-value":"N"},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>l[8]||(l[8]=[r("是否允许匹配子域名（如：*.example.com）")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"域名白名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.whitelistDomains,"onUpdate:value":[l[4]||(l[4]=o=>n.whitelistDomains=o),U],"input-props":{placeholder:"输入允许的域名"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[9]||(l[9]=r(" 如：example.com, api.example.com "))]),_:1})]),_:1})]),_:1}),t(e(m),{label:"域名黑名单"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.blacklistDomains,"onUpdate:value":[l[5]||(l[5]=o=>n.blacklistDomains=o),U],"input-props":{placeholder:"输入禁止的域名"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),l[10]||(l[10]=r(" 优先级高于白名单，直接拒绝访问 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[y.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>l[11]||(l[11]=[r("有变更")])),_:1})):A("",!0),!y.value&&D.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>l[12]||(l[12]=[r("已保存")])),_:1})):A("",!0),N.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>l[13]||(l[13]=[r("需要基础配置")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 策略："+K($()),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[N.value?(p(),E(e(oe),{key:0,type:"primary",onClick:S,loading:x.value,disabled:!y.value},{default:a(()=>l[14]||(l[14]=[r(" 保存域名配置 ")])),_:1},8,["loading","disabled"])):A("",!0)]),_:1})]),_:1})],512)),[[ye,j.value]]):A("",!0)]),_:1})]))}}),Ht=ge($t,[["__scopeId","data-v-a67afdee"]]),Bt={class:"basic-config-content"},Lt={class:"tab-content-wrapper"},Jt={key:0,class:"empty-state"},Wt={class:"tab-content-wrapper"},Yt={key:0,class:"empty-state"},Xt={class:"tab-content-wrapper"},Kt={key:0,class:"empty-state"},qt={class:"tab-content-wrapper"},Vt={key:0,class:"empty-state"},Qt=ie({__name:"SecurityConfigDialog",props:{visible:{type:Boolean,default:!1},editData:{default:null},gatewayInstanceId:{default:""},routeConfigId:{default:""}},emits:["update:visible","submit"],setup(g,{emit:z}){const u=g,I=z,{formRef:M,formData:n,formRules:x,isEdit:y,basicConfigSaving:D,currentSecurityConfigId:d,hasBasicConfigChanges:j,markBasicConfigChanged:s,handleSaveBasicConfig:N}=bt(u),$=x,B=T("ip");return(U,h)=>(p(),E(e(ze),{show:U.visible,"onUpdate:show":h[5]||(h[5]=S=>I("update:visible",S)),"mask-closable":!1,preset:"dialog",title:e(y)?"编辑安全配置":"新建安全配置",style:{width:"75%",maxWidth:"1600px",minWidth:"1000px",minHeight:"800px"},class:"security-config-modal"},{action:a(()=>h[10]||(h[10]=[])),default:a(()=>[t(e(Y),{title:"基础配置",size:"small",bordered:!1,class:"config-section basic-config-card"},{"header-extra":a(()=>[t(e(b),{align:"center",size:12},{default:a(()=>[e(j)?(p(),E(e(J),{key:0,type:"warning",size:"small",round:""},{icon:a(()=>[t(e(L),null,{default:a(()=>[t(e(Te))]),_:1})]),default:a(()=>[h[6]||(h[6]=r(" 未保存 "))]),_:1})):e(d)?(p(),E(e(J),{key:1,type:"success",size:"small",round:""},{icon:a(()=>[t(e(L),null,{default:a(()=>[t(e(Oe))]),_:1})]),default:a(()=>[h[7]||(h[7]=r(" 已保存 "))]),_:1})):A("",!0),t(e(oe),{size:"small",type:"primary",onClick:e(N),loading:e(D),disabled:!e(j),round:""},{icon:a(()=>[t(e(L),null,{default:a(()=>[t(e(Ye))]),_:1})]),default:a(()=>[r(" "+K(e(y)?"更新基础配置":"保存基础配置"),1)]),_:1},8,["onClick","loading","disabled"])]),_:1})]),default:a(()=>[F("div",Bt,[t(e(Se),{ref_key:"formRef",ref:M,model:e(n),rules:e($),"label-placement":"left","label-width":"140px","require-mark-placement":"right-hanging",size:"medium",class:"config-form"},{default:a(()=>[t(e(V),{cols:2,"x-gap":24,"y-gap":20},{default:a(()=>[t(e(m),{label:"配置名称",path:"configName"},{default:a(()=>[t(e(q),{value:e(n).configName,"onUpdate:value":h[0]||(h[0]=S=>e(n).configName=S),placeholder:"请输入配置名称",disabled:e(y),onInput:e(s),round:"",clearable:""},{prefix:a(()=>[t(e(L),null,{default:a(()=>[t(e(Ne))]),_:1})]),_:1},8,["value","disabled","onInput"])]),_:1}),t(e(m),{label:"配置优先级",path:"configPriority"},{default:a(()=>[t(e(se),{value:e(n).configPriority,"onUpdate:value":[h[1]||(h[1]=S=>e(n).configPriority=S),e(s)],min:1,max:999,placeholder:"数值越小优先级越高",style:{width:"100%"}},{prefix:a(()=>[t(e(L),null,{default:a(()=>[t(e(Be))]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1}),t(e(m),{label:"配置描述",path:"configDesc",span:2},{default:a(()=>[t(e(q),{value:e(n).configDesc,"onUpdate:value":h[2]||(h[2]=S=>e(n).configDesc=S),placeholder:"请输入配置描述",type:"textarea",rows:3,onInput:e(s),round:"",maxlength:200,"show-count":"",clearable:""},{prefix:a(()=>[t(e(L),null,{default:a(()=>[t(e(Je))]),_:1})]),_:1},8,["value","onInput"])]),_:1}),t(e(m),{label:"备注信息",path:"noteText",span:2},{default:a(()=>[t(e(q),{value:e(n).noteText,"onUpdate:value":h[3]||(h[3]=S=>e(n).noteText=S),placeholder:"请输入备注信息",type:"textarea",rows:2,onInput:e(s),round:"",maxlength:100,"show-count":"",clearable:""},{prefix:a(()=>[t(e(L),null,{default:a(()=>[t(e($e))]),_:1})]),_:1},8,["value","onInput"])]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1}),t(e(Y),{title:"安全策略配置",size:"small",bordered:!1,class:"config-section modules-config-card"},{"header-extra":a(()=>[t(e(b),{align:"center",size:8},{default:a(()=>[t(e(L),{size:"18",color:"#18a058"},{default:a(()=>[t(e(Ie))]),_:1}),t(e(w),{depth:"3",style:{"font-size":"13px"}},{default:a(()=>h[8]||(h[8]=[r("选择并配置所需的安全策略模块")])),_:1}),e(d)?A("",!0):(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>h[9]||(h[9]=[r(" 请先保存基础配置 ")])),_:1}))]),_:1})]),default:a(()=>[t(e(De),{type:"card",animated:"",size:"medium",class:"security-tabs",placement:"top","justify-content":"space-evenly",value:B.value,"onUpdate:value":h[4]||(h[4]=S=>B.value=S),disabled:!e(d)},{default:a(()=>[t(e(Ce),{name:"ip",tab:"🌐 IP访问控制",class:"tab-pane-content"},{default:a(()=>[F("div",Lt,[e(d)?(p(),E(Nt,{key:1,"security-config-id":e(d),"gateway-instance-id":u.gatewayInstanceId},null,8,["security-config-id","gateway-instance-id"])):(p(),H("div",Jt,[t(e(we),{size:"large",description:"请先保存基础配置后再进行安全策略配置"},{icon:a(()=>[t(e(L),{size:"48",color:"#d1d5db"},{default:a(()=>[t(e(Ie))]),_:1})]),_:1})]))])]),_:1}),t(e(Ce),{name:"useragent",tab:"💻 User-Agent控制",class:"tab-pane-content"},{default:a(()=>[F("div",Wt,[e(d)?(p(),E(Ft,{key:1,"security-config-id":e(d),"gateway-instance-id":u.gatewayInstanceId},null,8,["security-config-id","gateway-instance-id"])):(p(),H("div",Yt,[t(e(we),{size:"large",description:"请先保存基础配置后再进行安全策略配置"},{icon:a(()=>[t(e(L),{size:"48",color:"#d1d5db"},{default:a(()=>[t(e(Ie))]),_:1})]),_:1})]))])]),_:1}),t(e(Ce),{name:"api",tab:"🔗 API访问控制",class:"tab-pane-content"},{default:a(()=>[F("div",Xt,[e(d)?(p(),E(Mt,{key:1,"security-config-id":e(d),"gateway-instance-id":u.gatewayInstanceId},null,8,["security-config-id","gateway-instance-id"])):(p(),H("div",Kt,[t(e(we),{size:"large",description:"请先保存基础配置后再进行安全策略配置"},{icon:a(()=>[t(e(L),{size:"48",color:"#d1d5db"},{default:a(()=>[t(e(Ie))]),_:1})]),_:1})]))])]),_:1}),t(e(Ce),{name:"domain",tab:"🔗 域名访问控制",class:"tab-pane-content"},{default:a(()=>[F("div",qt,[e(d)?(p(),E(Ht,{key:1,"security-config-id":e(d),"gateway-instance-id":u.gatewayInstanceId},null,8,["security-config-id","gateway-instance-id"])):(p(),H("div",Vt,[t(e(we),{size:"large",description:"请先保存基础配置后再进行安全策略配置"},{icon:a(()=>[t(e(L),{size:"48",color:"#d1d5db"},{default:a(()=>[t(e(Ie))]),_:1})]),_:1})]))])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1},8,["show","title"]))}}),Gt=ge(Qt,[["__scopeId","data-v-4f68454b"]]),Zt={class:"security-config-table"},ea={class:"table-header"},ta={class:"header-left"},aa={class:"header-actions"},la=ie({__name:"SecurityConfigTable",props:{routeConfigId:{default:""},gatewayInstanceId:{default:""}},setup(g){const z=g,u=fe(),I=Ue(),M=T([]),n=T(!1),x=T(!1),y=T(null),{getActiveConfigs:D,createTableColumns:d}=Ct(),j=ee(()=>D(M.value)),s=ee(()=>d((l,o)=>{switch(l){case"edit":B(o);break;case"delete":U(o);break;default:console.warn("未知的事件类型:",l)}})),N=async()=>{if(!z.routeConfigId&&!z.gatewayInstanceId){M.value=[];return}try{n.value=!0;let i;if(z.routeConfigId?i=await Qe({routeConfigId:z.routeConfigId,pageNo:1,pageSize:100}):z.gatewayInstanceId&&(i=await Ve({gatewayInstanceId:z.gatewayInstanceId,pageNo:1,pageSize:100})),i!=null&&i.oK){const l=i.bizData;if(l)try{const o=JSON.parse(l);M.value=Array.isArray(o)?o:o.records||[]}catch(o){console.warn("解析安全配置数据失败:",o),M.value=[]}else console.info("未获取到安全配置数据"),M.value=[]}else u.error((i==null?void 0:i.errMsg)||"加载安全配置失败"),M.value=[]}catch(i){console.error("加载安全配置异常:",i),u.error("加载安全配置失败"),M.value=[]}finally{n.value=!1}},$=()=>{y.value=null,x.value=!0},B=i=>{const l={configName:i.configName,configDesc:i.configDesc||"",configPriority:i.configPriority,gatewayInstanceId:i.gatewayInstanceId,routeConfigId:i.routeConfigId,customConfigJson:i.customConfigJson,noteText:i.noteText||""};l.securityConfigId=i.securityConfigId,l.tenantId=i.tenantId,l.activeFlag=i.activeFlag,y.value=l,x.value=!0},U=i=>{I.warning({title:"确认删除",content:`确定要删除安全配置"${i.configName}"吗？此操作不可恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:async()=>{await h(i)}})},h=async i=>{try{const l=await qe(i.securityConfigId,i.tenantId||"default");l!=null&&l.oK?(u.success("删除安全配置成功"),await N()):u.error((l==null?void 0:l.errMsg)||"删除安全配置失败")}catch(l){console.error("删除安全配置异常:",l);const o=l instanceof Error?l.message:String(l);u.error(`删除安全配置失败: ${o}`)}},S=async()=>{await N(),M.value.length>0&&u.success("刷新完成")},k=async()=>{try{x.value=!1,await N()}catch(i){console.error("提交安全配置失败:",i),u.error("提交安全配置失败")}};return re(()=>z.routeConfigId,()=>{(z.routeConfigId||z.gatewayInstanceId)&&N()},{immediate:!0}),re(()=>z.gatewayInstanceId,()=>{(z.gatewayInstanceId||z.routeConfigId)&&N()}),pe(()=>{(z.routeConfigId||z.gatewayInstanceId)&&N()}),(i,l)=>{const o=w,W=oe,C=b,O=Ee;return p(),H("div",Zt,[F("div",ea,[t(C,{justify:"space-between"},{default:a(()=>[F("div",ta,[l[1]||(l[1]=F("h3",null,"安全配置列表",-1)),t(o,{depth:"3"},{default:a(()=>[r("共 "+K(M.value.length)+" 个配置，"+K(j.value.length)+" 个活动",1)]),_:1})]),F("div",aa,[t(W,{type:"primary",onClick:$},{icon:a(()=>[t(e(L),null,{default:a(()=>[t(e(Re))]),_:1})]),default:a(()=>[l[2]||(l[2]=r(" 新建安全配置 "))]),_:1}),t(W,{onClick:S,loading:n.value},{icon:a(()=>[t(e(L),null,{default:a(()=>[t(e(Me))]),_:1})]),default:a(()=>[l[3]||(l[3]=r(" 刷新 "))]),_:1},8,["loading"])])]),_:1})]),t(O,{columns:s.value,data:M.value,loading:n.value,bordered:!1,size:"medium","flex-height":"",style:{height:"600px"}},null,8,["columns","data","loading"]),t(Gt,{visible:x.value,"onUpdate:visible":l[0]||(l[0]=R=>x.value=R),"edit-data":y.value,"route-config-id":z.routeConfigId,"gateway-instance-id":z.gatewayInstanceId,onSubmit:k},null,8,["visible","edit-data","route-config-id","gateway-instance-id"])])}}}),Ma=ge(la,[["__scopeId","data-v-d90aecfe"]]),na={class:"cors-config"},ia={key:0},sa=ie({__name:"CorsConfigForm",props:{securityConfigId:{default:""},gatewayInstanceId:{default:""},routeConfigId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=()=>({activeFlag:"N",configName:"CORS跨域配置",allowOrigins:[],allowMethods:["GET","POST","PUT","DELETE","OPTIONS"],allowHeaders:["Content-Type","Authorization","X-Requested-With"],exposeHeaders:[],allowCredentials:"N",maxAgeSeconds:86400,configPriority:1,...u.initialData}),n=de(M()),x=T(!1),y=T(!1),D=T(!1),d=T(""),j=T(!1),s=ee(()=>!!(u.routeConfigId||u.gatewayInstanceId&&!u.routeConfigId||u.securityConfigId)),N=ee(()=>u.routeConfigId?"路由级":u.gatewayInstanceId?"实例级":u.securityConfigId?"安全配置级":""),$=async k=>{n.activeFlag=k,y.value=!0,d.value&&await h()},B=()=>{y.value=!0},U=async()=>{if(s.value)try{const k={};u.gatewayInstanceId&&(k.gatewayInstanceId=u.gatewayInstanceId),u.routeConfigId&&(k.routeConfigId=u.routeConfigId),u.securityConfigId&&(k.securityConfigId=u.securityConfigId);const i=await ft(k);if(ae(i)){const l=le(i);let o=null;Array.isArray(l)&&l.length>0?o=l[0]:l&&typeof l=="object"&&l.corsConfigId&&(o=l),o&&(d.value=o.corsConfigId,Object.assign(n,{activeFlag:o.activeFlag||"N",configName:o.configName||n.configName,allowOrigins:G(o.allowOrigins),allowMethods:G(o.allowMethods),allowHeaders:G(o.allowHeaders),exposeHeaders:G(o.exposeHeaders),allowCredentials:o.allowCredentials||"N",maxAgeSeconds:o.maxAgeSeconds||86400,configPriority:o.configPriority||1}),D.value=!0,y.value=!1)}}catch(k){console.error("加载CORS配置失败:",k)}finally{j.value=!0}},h=async()=>{if(!s.value){I.warning("请提供路由配置ID、网关实例ID或安全配置ID");return}if(!n.configName.trim()){I.warning("请输入配置名称");return}if(n.allowOrigins.length===0){I.warning("请至少配置一个允许的源");return}if(n.allowMethods.length===0){I.warning("请至少配置一个允许的HTTP方法");return}x.value=!0;try{const k={configName:n.configName,allowOrigins:JSON.stringify(n.allowOrigins),allowMethods:n.allowMethods.join(","),allowHeaders:JSON.stringify(n.allowHeaders),exposeHeaders:JSON.stringify(n.exposeHeaders),allowCredentials:n.allowCredentials,maxAgeSeconds:n.maxAgeSeconds,configPriority:n.configPriority,activeFlag:n.activeFlag};u.gatewayInstanceId&&(k.gatewayInstanceId=u.gatewayInstanceId),u.routeConfigId&&(k.routeConfigId=u.routeConfigId),u.securityConfigId&&(k.securityConfigId=u.securityConfigId);let i;if(d.value?i=await gt({...k,corsConfigId:d.value}):i=await dt(k),ae(i)){if(y.value=!1,D.value=!0,!d.value){const l=le(i);l!=null&&l.corsConfigId&&(d.value=l.corsConfigId)}I.success("CORS配置保存成功")}else{const l=ce(i,"CORS配置保存失败");I.error(l)}}catch(k){const i=k instanceof Error?k.message:"保存失败";I.error(i),console.error("保存CORS配置失败:",k)}finally{x.value=!1}},S=()=>{Object.assign(n,M()),y.value=!1,D.value=!1,d.value=""};return re([()=>u.securityConfigId,()=>u.gatewayInstanceId,()=>u.routeConfigId],()=>{s.value?U():S()},{immediate:!1}),pe(()=>{s.value?U():j.value=!0}),z({save:h,reset:S,hasChanges:()=>y.value,isConfigured:()=>D.value}),(k,i)=>(p(),H("div",na,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>i[9]||(i[9]=[r("启用CORS跨域配置")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>i[10]||(i[10]=[r(" 配置跨域资源共享(CORS)策略，控制浏览器跨域访问权限 ")])),_:1}),N.value?(p(),E(e(J),{key:0,type:N.value==="实例级"?"primary":"warning",size:"small",style:{"margin-top":"8px"}},{default:a(()=>[r(K(N.value)+"配置 ",1)]),_:1},8,["type"])):A("",!0)]),t(e(te),{value:n.activeFlag,"onUpdate:value":[i[0]||(i[0]=l=>n.activeFlag=l),$],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),n.activeFlag==="Y"?ve((p(),H("div",ia,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"配置名称"},{default:a(()=>[t(e(q),{value:n.configName,"onUpdate:value":i[1]||(i[1]=l=>n.configName=l),placeholder:"CORS配置名称",onInput:B},null,8,["value"])]),_:1}),t(e(m),{label:"配置优先级"},{default:a(()=>[t(e(se),{value:n.configPriority,"onUpdate:value":[i[2]||(i[2]=l=>n.configPriority=l),B],min:0,max:999,placeholder:"数值越小优先级越高"},null,8,["value"])]),_:1}),t(e(m),{label:"允许携带凭证",span:2},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[t(e(te),{value:n.allowCredentials,"onUpdate:value":[i[3]||(i[3]=l=>n.allowCredentials=l),B],"checked-value":"Y","unchecked-value":"N"},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>i[11]||(i[11]=[r("是否允许跨域请求携带Cookie、Authorization等凭证信息")])),_:1})]),_:1})]),_:1}),t(e(m),{label:"预检缓存时间",span:2},{default:a(()=>[t(e(se),{value:n.maxAgeSeconds,"onUpdate:value":[i[4]||(i[4]=l=>n.maxAgeSeconds=l),B],min:0,max:86400,placeholder:"预检请求缓存时间(秒)"},{suffix:a(()=>[t(e(w),{depth:"3"},{default:a(()=>i[12]||(i[12]=[r("秒")])),_:1})]),_:1},8,["value"]),t(e(w),{depth:"3",style:{"margin-top":"4px"}},{default:a(()=>i[13]||(i[13]=[r(" OPTIONS预检请求的缓存时间，0表示不缓存，最大86400秒(24小时) ")])),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>i[14]||(i[14]=[r("允许的源 (Access-Control-Allow-Origin)")])),_:1}),t(e(Q),{value:n.allowOrigins,"onUpdate:value":[i[5]||(i[5]=l=>n.allowOrigins=l),B],"input-props":{placeholder:"输入允许的源"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),i[15]||(i[15]=r(" 支持具体域名(https://example.com)、通配符(*)，建议避免使用*以提高安全性 "))]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>i[16]||(i[16]=[r("允许的HTTP方法 (Access-Control-Allow-Methods)")])),_:1}),t(e(Q),{value:n.allowMethods,"onUpdate:value":[i[6]||(i[6]=l=>n.allowMethods=l),B],"input-props":{placeholder:"输入HTTP方法"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),i[17]||(i[17]=r(" 常用方法：GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD "))]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"允许的请求头"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.allowHeaders,"onUpdate:value":[i[7]||(i[7]=l=>n.allowHeaders=l),B],"input-props":{placeholder:"输入允许的请求头"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),i[18]||(i[18]=r(" 如：Content-Type, Authorization, X-Requested-With "))]),_:1})]),_:1})]),_:1}),t(e(m),{label:"暴露的响应头"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:n.exposeHeaders,"onUpdate:value":[i[8]||(i[8]=l=>n.exposeHeaders=l),B],"input-props":{placeholder:"输入暴露的响应头"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),i[19]||(i[19]=r(" 浏览器可以访问的自定义响应头 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[y.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>i[20]||(i[20]=[r("有变更")])),_:1})):A("",!0),!y.value&&D.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>i[21]||(i[21]=[r("已保存")])),_:1})):A("",!0),s.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>i[22]||(i[22]=[r("需要网关实例ID或路由配置ID")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 优先级："+K(n.configPriority)+" | 凭证："+K(n.allowCredentials==="Y"?"允许":"禁止"),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[s.value?(p(),E(e(oe),{key:0,type:"primary",onClick:h,loading:x.value,disabled:!y.value},{default:a(()=>i[23]||(i[23]=[r(" 保存CORS配置 ")])),_:1},8,["loading","disabled"])):A("",!0)]),_:1})]),_:1})],512)),[[ye,j.value]]):A("",!0)]),_:1})]))}}),Ea=ge(sa,[["__scopeId","data-v-c16b7112"]]),oa={class:"auth-config"},ua={key:0},ra={key:0},da={key:1},fa={key:2},ga={key:3},ca=ie({__name:"AuthConfigForm",props:{gatewayInstanceId:{default:""},routeConfigId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=[{label:"JWT认证",value:"JWT"},{label:"API Key认证",value:"API_KEY"},{label:"OAuth2认证",value:"OAUTH2"},{label:"Basic认证",value:"BASIC"}],n=[{label:"必需认证",value:"REQUIRED"},{label:"可选认证",value:"OPTIONAL"},{label:"禁用认证",value:"DISABLED"}],x=[{label:"HS256",value:"HS256"},{label:"HS384",value:"HS384"},{label:"HS512",value:"HS512"},{label:"RS256",value:"RS256"},{label:"RS384",value:"RS384"},{label:"RS512",value:"RS512"}],y=[{label:"Header",value:"header"},{label:"Query参数",value:"query"}],D={JWT:"JWT",API_KEY:"API Key",OAUTH2:"OAuth2",BASIC:"Basic"},d={REQUIRED:"必需",OPTIONAL:"可选",DISABLED:"禁用"},j=()=>({activeFlag:"N",authName:"认证配置",authType:"JWT",authStrategy:"REQUIRED",authConfig:{secret:"",algorithm:"HS256",issuer:"",expiration:3600,verifyExpiration:!0,verifyIssuer:!1,refreshWindow:300,includeInResponse:!1,responseHeaderName:"X-Auth-Token",keyLocation:"header",keyName:"X-API-Key",validKeys:[],tokenEndpoint:"",introspectEndpoint:"",clientID:"",clientSecret:"",scope:"",username:"",password:""},exemptPaths:[],exemptHeaders:[],failureStatusCode:401,failureMessage:"认证失败",configPriority:1,...u.initialData}),s=de(j()),N=T(!1),$=T(!1),B=T(!1),U=T(""),h=T(!1),S=ee(()=>!!(u.routeConfigId||u.gatewayInstanceId&&!u.routeConfigId)),k=ee(()=>u.routeConfigId?"路由级":u.gatewayInstanceId?"实例级":""),i=async R=>{s.activeFlag=R,$.value=!0,U.value&&await C()},l=()=>{$.value=!0},o=R=>{s.authType=R,s.authConfig=j().authConfig,$.value=!0},W=async()=>{if(S.value)try{const R={};u.gatewayInstanceId&&(R.gatewayInstanceId=u.gatewayInstanceId),u.routeConfigId&&(R.routeConfigId=u.routeConfigId);const f=await pt(R);if(ae(f)){const v=le(f);let _=null;Array.isArray(v)&&v.length>0?_=v[0]:v&&typeof v=="object"&&v.authConfigId&&(_=v),_&&(U.value=_.authConfigId,Object.assign(s,{activeFlag:_.activeFlag||"N",authName:_.authName||s.authName,authType:_.authType||"JWT",authStrategy:_.authStrategy||"REQUIRED",authConfig:typeof _.authConfig=="string"?JSON.parse(_.authConfig):_.authConfig||s.authConfig,exemptPaths:G(_.exemptPaths),exemptHeaders:G(_.exemptHeaders),failureStatusCode:_.failureStatusCode||401,failureMessage:_.failureMessage||"认证失败",configPriority:_.configPriority||1}),B.value=!0,$.value=!1)}}catch(R){console.error("加载认证配置失败:",R)}finally{h.value=!0}},C=async()=>{if(!S.value){I.warning("请提供路由配置ID或网关实例ID");return}if(!s.authName.trim()){I.warning("请输入认证配置名称");return}if(s.authType==="JWT"){if(!s.authConfig.secret){I.warning("请输入JWT密钥");return}if(!s.authConfig.algorithm){I.warning("请选择签名算法");return}}if(s.authType==="API_KEY"&&(!s.authConfig.validKeys||s.authConfig.validKeys.length===0)){I.warning("请配置至少一个有效的API Key");return}if(s.authType==="OAUTH2"){if(!s.authConfig.tokenEndpoint){I.warning("请输入Token端点URL");return}if(!s.authConfig.clientID){I.warning("请输入Client ID");return}if(!s.authConfig.clientSecret){I.warning("请输入Client Secret");return}}if(s.authType==="BASIC"){if(!s.authConfig.username){I.warning("请输入用户名");return}if(!s.authConfig.password){I.warning("请输入密码");return}}N.value=!0;try{const R={authName:s.authName,authType:s.authType,authStrategy:s.authStrategy,authConfig:JSON.stringify(s.authConfig),exemptPaths:JSON.stringify(s.exemptPaths),exemptHeaders:JSON.stringify(s.exemptHeaders),failureStatusCode:s.failureStatusCode,failureMessage:s.failureMessage,configPriority:s.configPriority,activeFlag:s.activeFlag};if(u.gatewayInstanceId&&(R.gatewayInstanceId=u.gatewayInstanceId),u.routeConfigId&&(R.routeConfigId=u.routeConfigId),!R.gatewayInstanceId&&!R.routeConfigId){I.error("缺少路由配置ID或网关实例ID，无法保存认证配置");return}let f;if(U.value?f=await vt({...R,authConfigId:U.value}):f=await ct(R),ae(f)){if($.value=!1,B.value=!0,!U.value){const v=le(f);v!=null&&v.authConfigId&&(U.value=v.authConfigId)}I.success("认证配置保存成功")}else{const v=ce(f,"认证配置保存失败");I.error(v)}}catch(R){const f=R instanceof Error?R.message:"保存失败";I.error(f),console.error("保存认证配置失败:",R)}finally{N.value=!1}},O=()=>{Object.assign(s,j()),$.value=!1,B.value=!1,U.value=""};return re([()=>u.gatewayInstanceId,()=>u.routeConfigId],()=>{S.value?W():O()},{immediate:!1}),pe(()=>{S.value?W():h.value=!0}),z({save:C,reset:O,hasChanges:()=>$.value,isConfigured:()=>B.value}),(R,f)=>(p(),H("div",oa,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>f[28]||(f[28]=[r("启用认证配置")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>f[29]||(f[29]=[r(" 配置API认证策略，支持JWT、API Key、OAuth2、Basic Auth等认证方式 ")])),_:1}),k.value?(p(),E(e(J),{key:0,type:k.value==="实例级"?"primary":"warning",size:"small",style:{"margin-top":"8px"}},{default:a(()=>[r(K(k.value)+"配置 ",1)]),_:1},8,["type"])):A("",!0)]),t(e(te),{value:s.activeFlag,"onUpdate:value":[f[0]||(f[0]=v=>s.activeFlag=v),i],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),s.activeFlag==="Y"?ve((p(),H("div",ua,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"认证配置名称"},{default:a(()=>[t(e(q),{value:s.authName,"onUpdate:value":f[1]||(f[1]=v=>s.authName=v),placeholder:"认证配置名称",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"配置优先级"},{default:a(()=>[t(e(se),{value:s.configPriority,"onUpdate:value":[f[2]||(f[2]=v=>s.configPriority=v),l],min:0,max:999,placeholder:"数值越小优先级越高"},null,8,["value"])]),_:1}),t(e(m),{label:"认证类型"},{default:a(()=>[t(e(ue),{value:s.authType,"onUpdate:value":[f[3]||(f[3]=v=>s.authType=v),o],options:M,placeholder:"选择认证类型"},null,8,["value"])]),_:1}),t(e(m),{label:"认证策略"},{default:a(()=>[t(e(ue),{value:s.authStrategy,"onUpdate:value":[f[4]||(f[4]=v=>s.authStrategy=v),l],options:n,placeholder:"选择认证策略"},null,8,["value"])]),_:1}),t(e(m),{label:"失败状态码",span:1},{default:a(()=>[t(e(se),{value:s.failureStatusCode,"onUpdate:value":[f[5]||(f[5]=v=>s.failureStatusCode=v),l],min:400,max:599,placeholder:"认证失败HTTP状态码"},null,8,["value"])]),_:1}),t(e(m),{label:"失败提示消息",span:1},{default:a(()=>[t(e(q),{value:s.failureMessage,"onUpdate:value":f[6]||(f[6]=v=>s.failureMessage=v),placeholder:"认证失败提示消息",onInput:l},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>[r(K(D[s.authType])+"认证参数",1)]),_:1}),s.authType==="JWT"?(p(),H("div",ra,[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"JWT密钥"},{default:a(()=>[t(e(q),{value:s.authConfig.secret,"onUpdate:value":f[7]||(f[7]=v=>s.authConfig.secret=v),type:"password",placeholder:"JWT签名密钥",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"签名算法"},{default:a(()=>[t(e(ue),{value:s.authConfig.algorithm,"onUpdate:value":[f[8]||(f[8]=v=>s.authConfig.algorithm=v),l],options:x,placeholder:"选择签名算法"},null,8,["value"])]),_:1}),t(e(m),{label:"签发者(Issuer)"},{default:a(()=>[t(e(q),{value:s.authConfig.issuer,"onUpdate:value":f[9]||(f[9]=v=>s.authConfig.issuer=v),placeholder:"JWT签发者",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"过期时间(秒)"},{default:a(()=>[t(e(se),{value:s.authConfig.expiration,"onUpdate:value":[f[10]||(f[10]=v=>s.authConfig.expiration=v),l],min:60,max:86400,placeholder:"Token过期时间"},null,8,["value"])]),_:1}),t(e(m),{label:"验证过期时间"},{default:a(()=>[t(e(te),{value:s.authConfig.verifyExpiration,"onUpdate:value":[f[11]||(f[11]=v=>s.authConfig.verifyExpiration=v),l]},null,8,["value"])]),_:1}),t(e(m),{label:"验证签发者"},{default:a(()=>[t(e(te),{value:s.authConfig.verifyIssuer,"onUpdate:value":[f[12]||(f[12]=v=>s.authConfig.verifyIssuer=v),l]},null,8,["value"])]),_:1}),t(e(m),{label:"刷新窗口(秒)"},{default:a(()=>[t(e(se),{value:s.authConfig.refreshWindow,"onUpdate:value":[f[13]||(f[13]=v=>s.authConfig.refreshWindow=v),l],min:0,max:3600,placeholder:"过期前多少秒可刷新"},null,8,["value"])]),_:1}),t(e(m),{label:"响应包含Token"},{default:a(()=>[t(e(te),{value:s.authConfig.includeInResponse,"onUpdate:value":[f[14]||(f[14]=v=>s.authConfig.includeInResponse=v),l]},null,8,["value"])]),_:1}),t(e(m),{label:"响应头名称",span:2},{default:a(()=>[t(e(q),{value:s.authConfig.responseHeaderName,"onUpdate:value":f[15]||(f[15]=v=>s.authConfig.responseHeaderName=v),placeholder:"X-Auth-Token",onInput:l},null,8,["value"])]),_:1})]),_:1})])):A("",!0),s.authType==="API_KEY"?(p(),H("div",da,[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"API Key位置"},{default:a(()=>[t(e(ue),{value:s.authConfig.keyLocation,"onUpdate:value":[f[16]||(f[16]=v=>s.authConfig.keyLocation=v),l],options:y,placeholder:"API Key获取位置"},null,8,["value"])]),_:1}),t(e(m),{label:"参数名称"},{default:a(()=>[t(e(q),{value:s.authConfig.keyName,"onUpdate:value":f[17]||(f[17]=v=>s.authConfig.keyName=v),placeholder:"api_key",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"有效API Keys",span:2},{default:a(()=>[t(e(Q),{value:s.authConfig.validKeys,"onUpdate:value":[f[18]||(f[18]=v=>s.authConfig.validKeys=v),l],"input-props":{placeholder:"输入API Key"}},null,8,["value"])]),_:1})]),_:1})])):A("",!0),s.authType==="OAUTH2"?(p(),H("div",fa,[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"Token端点URL"},{default:a(()=>[t(e(q),{value:s.authConfig.tokenEndpoint,"onUpdate:value":f[19]||(f[19]=v=>s.authConfig.tokenEndpoint=v),placeholder:"https://auth.example.com/oauth/token",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"内省端点URL"},{default:a(()=>[t(e(q),{value:s.authConfig.introspectEndpoint,"onUpdate:value":f[20]||(f[20]=v=>s.authConfig.introspectEndpoint=v),placeholder:"https://auth.example.com/oauth/introspect",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"Client ID"},{default:a(()=>[t(e(q),{value:s.authConfig.clientID,"onUpdate:value":f[21]||(f[21]=v=>s.authConfig.clientID=v),placeholder:"客户端ID",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"Client Secret"},{default:a(()=>[t(e(q),{value:s.authConfig.clientSecret,"onUpdate:value":f[22]||(f[22]=v=>s.authConfig.clientSecret=v),type:"password",placeholder:"客户端密钥",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"Scope",span:2},{default:a(()=>[t(e(q),{value:s.authConfig.scope,"onUpdate:value":f[23]||(f[23]=v=>s.authConfig.scope=v),placeholder:"read write",onInput:l},null,8,["value"])]),_:1})]),_:1})])):A("",!0),s.authType==="BASIC"?(p(),H("div",ga,[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"用户名"},{default:a(()=>[t(e(q),{value:s.authConfig.username,"onUpdate:value":f[24]||(f[24]=v=>s.authConfig.username=v),placeholder:"认证用户名",onInput:l},null,8,["value"])]),_:1}),t(e(m),{label:"密码"},{default:a(()=>[t(e(q),{value:s.authConfig.password,"onUpdate:value":f[25]||(f[25]=v=>s.authConfig.password=v),type:"password",placeholder:"认证密码",onInput:l},null,8,["value"])]),_:1})]),_:1})])):A("",!0)]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"豁免路径"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:s.exemptPaths,"onUpdate:value":[f[26]||(f[26]=v=>s.exemptPaths=v),l],"input-props":{placeholder:"输入豁免路径"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),f[30]||(f[30]=r(" 支持通配符，如：/public/*, /health, /api/v1/status "))]),_:1})]),_:1})]),_:1}),t(e(m),{label:"豁免请求头"},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(Q),{value:s.exemptHeaders,"onUpdate:value":[f[27]||(f[27]=v=>s.exemptHeaders=v),l],"input-props":{placeholder:"输入豁免请求头"}},null,8,["value"]),t(e(w),{depth:"3"},{default:a(()=>[t(e(L),{size:"16",style:{"margin-right":"4px"}},{default:a(()=>[t(e(Z))]),_:1}),f[31]||(f[31]=r(" 包含指定请求头的请求将跳过认证 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[$.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>f[32]||(f[32]=[r("有变更")])),_:1})):A("",!0),!$.value&&B.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>f[33]||(f[33]=[r("已保存")])),_:1})):A("",!0),S.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>f[34]||(f[34]=[r("需要网关实例ID或路由配置ID")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 类型："+K(D[s.authType])+" | 策略："+K(d[s.authStrategy])+" | 优先级："+K(s.configPriority),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[S.value?(p(),E(e(oe),{key:0,type:"primary",onClick:C,loading:N.value,disabled:!$.value},{default:a(()=>f[35]||(f[35]=[r(" 保存认证配置 ")])),_:1},8,["loading","disabled"])):A("",!0)]),_:1})]),_:1})],512)),[[ye,h.value]]):A("",!0)]),_:1})]))}}),ja=ge(ca,[["__scopeId","data-v-85e79a62"]]),pa={class:"rate-limit-config"},va={key:0},ya={key:0},ma={key:1},Ia={key:2},Ca={key:3},wa={key:4},ba=ie({__name:"RateLimitConfigForm",props:{gatewayInstanceId:{default:""},routeConfigId:{default:""},initialData:{default:()=>({})}},setup(g,{expose:z}){const u=g,I=fe(),M=[{label:"IP策略",value:"ip"},{label:"用户策略",value:"user"},{label:"路径策略",value:"path"},{label:"服务策略",value:"service"},{label:"路由策略",value:"route"}],n=[{label:"令牌桶算法",value:"token-bucket"},{label:"漏桶算法",value:"leaky-bucket"},{label:"滑动窗口算法",value:"sliding-window"},{label:"固定窗口算法",value:"fixed-window"},{label:"无限流",value:"none"}],x={ip:"IP",user:"用户",path:"路径",service:"服务",route:"路由"},y={"token-bucket":"令牌桶","leaky-bucket":"漏桶","sliding-window":"滑动窗口","fixed-window":"固定窗口",none:"无限流"},D=()=>({activeFlag:"N",limitName:"限流规则",keyStrategy:"ip",algorithm:"token-bucket",limitRate:100,burstCapacity:200,timeWindowSeconds:1,rejectionStatusCode:429,rejectionMessage:"请求过于频繁，请稍后再试",configPriority:1,customConfig:{},...u.initialData}),d=de(D()),j=T(!1),s=T(!1),N=T(!1),$=T(""),B=T(!1),U=ee(()=>!!(u.routeConfigId||u.gatewayInstanceId&&!u.routeConfigId)),h=ee(()=>u.routeConfigId?"路由级":u.gatewayInstanceId?"实例级":""),S=async W=>{d.activeFlag=W,s.value=!0,$.value&&await l()},k=()=>{s.value=!0},i=async()=>{if(U.value)try{const W={};u.gatewayInstanceId&&(W.gatewayInstanceId=u.gatewayInstanceId),u.routeConfigId&&(W.routeConfigId=u.routeConfigId);const C=await mt(W);if(ae(C)){const O=le(C);let R=null;Array.isArray(O)&&O.length>0?R=O[0]:O&&typeof O=="object"&&O.rateLimitConfigId&&(R=O),R&&($.value=R.rateLimitConfigId,Object.assign(d,{activeFlag:R.activeFlag||"N",limitName:R.limitName||d.limitName,keyStrategy:R.keyStrategy||"ip",algorithm:R.algorithm||"token-bucket",limitRate:R.limitRate||100,burstCapacity:R.burstCapacity||200,timeWindowSeconds:R.timeWindowSeconds||1,rejectionStatusCode:R.rejectionStatusCode||429,rejectionMessage:R.rejectionMessage||"请求过于频繁，请稍后再试",configPriority:R.configPriority||1,customConfig:R.customConfig||{}}),N.value=!0,s.value=!1)}}catch(W){console.error("加载限流配置失败:",W)}finally{B.value=!0}},l=async()=>{if(!U.value){I.warning("请提供路由配置ID或网关实例ID");return}if(!d.limitName.trim()){I.warning("请输入限流规则名称");return}if(d.limitRate<=0){I.warning("限流速率必须大于0");return}if(d.burstCapacity<0){I.warning("突发容量不能小于0");return}if(d.timeWindowSeconds<=0){I.warning("时间窗口必须大于0");return}j.value=!0;try{const W={limitName:d.limitName,keyStrategy:d.keyStrategy,algorithm:d.algorithm,limitRate:d.limitRate,burstCapacity:d.burstCapacity,timeWindowSeconds:d.timeWindowSeconds,rejectionStatusCode:d.rejectionStatusCode,rejectionMessage:d.rejectionMessage,configPriority:d.configPriority,customConfig:d.customConfig,activeFlag:d.activeFlag};if(u.gatewayInstanceId&&(W.gatewayInstanceId=u.gatewayInstanceId),u.routeConfigId&&(W.routeConfigId=u.routeConfigId),!W.gatewayInstanceId&&!W.routeConfigId){I.error("缺少路由配置ID或网关实例ID，无法保存限流配置");return}let C;if($.value?C=await It({...W,rateLimitConfigId:$.value}):C=await yt(W),ae(C)){if(s.value=!1,N.value=!0,!$.value){const O=le(C);O!=null&&O.rateLimitConfigId&&($.value=O.rateLimitConfigId)}I.success("限流配置保存成功")}else{const O=ce(C,"限流配置保存失败");I.error(O)}}catch(W){const C=W instanceof Error?W.message:"保存失败";I.error(C),console.error("保存限流配置失败:",W)}finally{j.value=!1}},o=()=>{Object.assign(d,D()),s.value=!1,N.value=!1,$.value=""};return re([()=>u.gatewayInstanceId,()=>u.routeConfigId],()=>{U.value?i():o()},{immediate:!1}),pe(()=>{U.value?i():B.value=!0}),z({save:l,reset:o,hasChanges:()=>s.value,isConfigured:()=>N.value}),(W,C)=>(p(),H("div",pa,[t(e(b),{vertical:"",size:"medium"},{default:a(()=>[t(e(Y),{size:"small",bordered:!1,embedded:""},{default:a(()=>[t(e(b),{align:"center",justify:"space-between"},{default:a(()=>[F("div",null,[t(e(w),{strong:""},{default:a(()=>C[10]||(C[10]=[r("启用限流配置")])),_:1}),t(e(w),{depth:"3",style:{display:"block","margin-top":"4px"}},{default:a(()=>C[11]||(C[11]=[r(" 配置API流量控制策略，支持令牌桶、漏桶、滑动窗口等限流算法 ")])),_:1}),h.value?(p(),E(e(J),{key:0,type:h.value==="实例级"?"primary":"warning",size:"small",style:{"margin-top":"8px"}},{default:a(()=>[r(K(h.value)+"配置 ",1)]),_:1},8,["type"])):A("",!0)]),t(e(te),{value:d.activeFlag,"onUpdate:value":[C[0]||(C[0]=O=>d.activeFlag=O),S],"checked-value":"Y","unchecked-value":"N"},null,8,["value"])]),_:1})]),_:1}),d.activeFlag==="Y"?ve((p(),H("div",va,[t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"限流规则名称"},{default:a(()=>[t(e(q),{value:d.limitName,"onUpdate:value":C[1]||(C[1]=O=>d.limitName=O),placeholder:"限流规则名称",onInput:k},null,8,["value"])]),_:1}),t(e(m),{label:"配置优先级"},{default:a(()=>[t(e(se),{value:d.configPriority,"onUpdate:value":[C[2]||(C[2]=O=>d.configPriority=O),k],min:0,max:999,placeholder:"数值越小优先级越高"},null,8,["value"])]),_:1}),t(e(m),{label:"限流键策略"},{default:a(()=>[t(e(ue),{value:d.keyStrategy,"onUpdate:value":[C[3]||(C[3]=O=>d.keyStrategy=O),k],options:M,placeholder:"选择限流键策略"},null,8,["value"])]),_:1}),t(e(m),{label:"限流算法"},{default:a(()=>[t(e(ue),{value:d.algorithm,"onUpdate:value":[C[4]||(C[4]=O=>d.algorithm=O),k],options:n,placeholder:"选择限流算法"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>C[12]||(C[12]=[r("限流参数配置")])),_:1}),t(e(V),{cols:2,"x-gap":16,"y-gap":16},{default:a(()=>[t(e(m),{label:"限流速率(次/秒)"},{default:a(()=>[t(e(se),{value:d.limitRate,"onUpdate:value":[C[5]||(C[5]=O=>d.limitRate=O),k],min:1,max:1e4,placeholder:"每秒允许的请求数"},null,8,["value"])]),_:1}),t(e(m),{label:"突发容量"},{default:a(()=>[t(e(se),{value:d.burstCapacity,"onUpdate:value":[C[6]||(C[6]=O=>d.burstCapacity=O),k],min:0,max:1e5,placeholder:"允许的突发请求数"},null,8,["value"])]),_:1}),t(e(m),{label:"时间窗口(秒)"},{default:a(()=>[t(e(se),{value:d.timeWindowSeconds,"onUpdate:value":[C[7]||(C[7]=O=>d.timeWindowSeconds=O),k],min:1,max:3600,placeholder:"限流时间窗口"},null,8,["value"])]),_:1}),t(e(m),{label:"拒绝状态码"},{default:a(()=>[t(e(se),{value:d.rejectionStatusCode,"onUpdate:value":[C[8]||(C[8]=O=>d.rejectionStatusCode=O),k],min:400,max:599,placeholder:"限流时返回的HTTP状态码"},null,8,["value"])]),_:1}),t(e(m),{label:"拒绝提示消息",span:2},{default:a(()=>[t(e(q),{value:d.rejectionMessage,"onUpdate:value":C[9]||(C[9]=O=>d.rejectionMessage=O),placeholder:"限流时的提示消息",onInput:k},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Y),{size:"small",style:{"margin-bottom":"16px"}},{default:a(()=>[t(e(b),{vertical:"",size:"small",style:{width:"100%"}},{default:a(()=>[t(e(w),{strong:""},{default:a(()=>C[13]||(C[13]=[r("算法说明")])),_:1}),d.algorithm==="token-bucket"?(p(),H("div",ya,[t(e(me),{type:"info"},{default:a(()=>[t(e(w),null,{default:a(()=>C[14]||(C[14]=[F("strong",null,"令牌桶算法：",-1),r("以固定速率向桶中放入令牌，请求需要消耗令牌才能通过。 支持突发流量，桶满时多余令牌会被丢弃。 "),F("br",null,null,-1),r(" • 限流速率：每秒放入桶中的令牌数 "),F("br",null,null,-1),r(" • 突发容量：桶的最大容量，决定了最大突发请求数 ")])),_:1})]),_:1})])):d.algorithm==="leaky-bucket"?(p(),H("div",ma,[t(e(me),{type:"info"},{default:a(()=>[t(e(w),null,{default:a(()=>C[15]||(C[15]=[F("strong",null,"漏桶算法：",-1),r("请求先进入桶中，然后以固定速率从桶中流出。 能够平滑突发流量，但不支持突发处理。 "),F("br",null,null,-1),r(" • 限流速率：每秒从桶中流出的请求数 "),F("br",null,null,-1),r(" • 突发容量：桶的最大容量，超出时请求会被丢弃 ")])),_:1})]),_:1})])):d.algorithm==="sliding-window"?(p(),H("div",Ia,[t(e(me),{type:"info"},{default:a(()=>[t(e(w),null,{default:a(()=>C[16]||(C[16]=[F("strong",null,"滑动窗口算法：",-1),r("在固定时间窗口内限制请求数量。 窗口会随时间滑动，提供更精确的限流控制。 "),F("br",null,null,-1),r(" • 限流速率：时间窗口内允许的最大请求数 "),F("br",null,null,-1),r(" • 时间窗口：统计请求数量的时间范围 ")])),_:1})]),_:1})])):d.algorithm==="fixed-window"?(p(),H("div",Ca,[t(e(me),{type:"info"},{default:a(()=>[t(e(w),null,{default:a(()=>C[17]||(C[17]=[F("strong",null,"固定窗口算法：",-1),r("在固定时间窗口内限制请求数量。 窗口到期后重置计数器，可能出现边界突发。 "),F("br",null,null,-1),r(" • 限流速率：时间窗口内允许的最大请求数 "),F("br",null,null,-1),r(" • 时间窗口：统计请求数量的时间范围 ")])),_:1})]),_:1})])):d.algorithm==="none"?(p(),H("div",wa,[t(e(me),{type:"warning"},{default:a(()=>[t(e(w),null,{default:a(()=>C[18]||(C[18]=[F("strong",null,"无限流：",-1),r("不进行任何限流控制，所有请求都会通过。 通常用于临时关闭限流或测试环境。 ")])),_:1})]),_:1})])):A("",!0)]),_:1})]),_:1}),t(e(b),{justify:"space-between",style:{"margin-top":"16px"}},{default:a(()=>[t(e(b),{align:"center"},{default:a(()=>[s.value?(p(),E(e(J),{key:0,type:"warning",size:"small"},{default:a(()=>C[19]||(C[19]=[r("有变更")])),_:1})):A("",!0),!s.value&&N.value?(p(),E(e(J),{key:1,type:"success",size:"small"},{default:a(()=>C[20]||(C[20]=[r("已保存")])),_:1})):A("",!0),U.value?A("",!0):(p(),E(e(J),{key:2,type:"info",size:"small"},{default:a(()=>C[21]||(C[21]=[r("需要网关实例ID或路由配置ID")])),_:1})),t(e(w),{depth:"3"},{default:a(()=>[r(" 策略："+K(x[d.keyStrategy])+" | 算法："+K(y[d.algorithm])+" | 速率："+K(d.limitRate)+"/秒 | 优先级："+K(d.configPriority),1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[U.value?(p(),E(e(oe),{key:0,type:"primary",onClick:l,loading:j.value,disabled:!s.value},{default:a(()=>C[22]||(C[22]=[r(" 保存限流配置 ")])),_:1},8,["loading","disabled"])):A("",!0)]),_:1})]),_:1})],512)),[[ye,B.value]]):A("",!0)]),_:1})]))}}),$a=ge(ba,[["__scopeId","data-v-540a5501"]]);export{ja as A,Ea as C,$a as R,Ma as S,Ye as a};

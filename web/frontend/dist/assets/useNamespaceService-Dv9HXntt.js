import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Cl3FsyCO.js";import{u as J}from"./useGDialog-CebP_ODM.js";import{d as $,r as w,a7 as A,av as j,g as L,o as P,w as v,f as Z,e as l,b,am as z,aO as E,K as F,t as K,i as q,_ as H,c as X,G as ee,J as ae,aQ as te,aa as U,T as Y,af as se,m as le,z as R,B as C}from"./index-bKVtVsSX.js";import{G as ne,S as re,c as ie}from"./SearchForm-wLSWNkX3.js";import{G as oe}from"./GModal-DETqCgwG.js";import{G as ce}from"./GPane-L7gHnozL.js";import{u as ue}from"./useServiceCenterInstanceService-iVc2PufY.js";import{C as de}from"./CheckmarkCircleOutline-C9yk_iJ8.js";import{A as pe}from"./AlertCircleOutline-DnAHPF1H.js";import{H as me}from"./HourglassOutline-4mMg2fZp.js";import{S as fe}from"./StopCircleOutline-bs3-DvpJ.js";import{E as ve}from"./EllipsisHorizontalOutline-wlPychfE.js";import{N as be}from"./InputGroup-Cfyn4FCC.js";import{A as ge}from"./AddOutline-e9mIKA9k.js";import{C as he}from"./CreateOutline-LmOn9niU.js";import{T as Ne}from"./TrashOutline-fmGjC74g.js";import{W as ye}from"./WarningOutline-Bmg_55lx.js";const Ie=["id"],Se=$({name:"ServiceCenterInstanceListModal",__name:"ServiceCenterInstanceListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{default:void 0},modelValue:{default:""}},emits:["update:visible","after-leave","select","update:modelValue"],setup(n,{emit:O}){const s=n,i=O,c=w(),r=w(),y=w(s.visible),I=A(()=>s.visible,u=>{y.value=u,u&&N()}),p=ue(c);p.loadInstances();const o=u=>{y.value=u,i("update:visible",u)},h=()=>{i("after-leave")},N=()=>{p.handleSearch()},M=({row:u})=>{u&&(i("update:modelValue",u.instanceName),i("select",u),o(!1))};function G(u){return{RUNNING:"success",STOPPED:"default",STARTING:"info",STOPPING:"warning",ERROR:"error"}[u]||"default"}function g(u){return{RUNNING:"运行中",STOPPED:"停止",STARTING:"启动中",STOPPING:"停止中",ERROR:"异常"}[u]||u}return j(()=>{I()}),(u,e)=>(P(),L(l(oe),{visible:y.value,title:s.title||"选择服务中心实例",width:s.width||1200,to:s.to,"show-footer":!1,"onUpdate:visible":o,onAfterLeave:h},{default:v(()=>[Z("div",{class:"service-center-instance-list-modal",id:l(p).model.moduleId},[b(l(ce),{direction:"vertical","no-resize":!0},{1:v(()=>[b(re,z({ref_key:"searchFormRef",ref:c,"module-id":l(p).model.moduleId},l(p).model.searchFormConfig,{onSearch:N}),null,16,["module-id"])]),2:v(()=>[b(l(ne),z({ref_key:"gridRef",ref:r,"module-id":l(p).model.moduleId,data:l(p).model.instanceList,loading:l(p).model.loading},l(p).model.gridConfig,{onPageChange:l(p).handlePageChange,onRowClick:M}),{instanceStatus:v(({row:a})=>[b(l(E),{type:G(a.instanceStatus),size:"small"},{icon:v(()=>[b(l(q),null,{default:v(()=>[a.instanceStatus==="RUNNING"?(P(),L(l(de),{key:0})):a.instanceStatus==="ERROR"?(P(),L(l(pe),{key:1})):a.instanceStatus==="STARTING"||a.instanceStatus==="STOPPING"?(P(),L(l(me),{key:2})):(P(),L(l(fe),{key:3}))]),_:2},1024)]),default:v(()=>[F(" "+K(g(a.instanceStatus)),1)]),_:2},1032,["type"])]),activeFlag:v(({row:a})=>[b(l(E),{type:a.activeFlag==="Y"?"success":"default",size:"small"},{default:v(()=>[F(K(a.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,Ie)]),_:1},8,["visible","title","width","to"]))}}),we=H(Se,[["__scopeId","data-v-a93d689a"]]),Oe=$({name:"ServiceCenterInstanceNameSelector",__name:"ServiceCenterInstanceNameSelector",props:{modelValue:{default:""}},emits:["update:modelValue","select"],setup(n,{emit:O}){const s=n,i=O,c=w(!1),r=w(s.modelValue);A(()=>s.modelValue,o=>{r.value=o}),A(r,o=>{i("update:modelValue",o)});const y=o=>{r.value=o},I=()=>{c.value=!0},p=o=>{o&&(r.value=o.instanceName,i("select",o))};return(o,h)=>(P(),X(te,null,[b(l(be),null,{default:v(()=>[b(l(ee),{value:n.modelValue,placeholder:"请输入实例名称或点击选择",clearable:"",size:"small","onUpdate:value":y},null,8,["value"]),b(l(ae),{type:"primary",size:"small",onClick:I},{icon:v(()=>[b(l(q),null,{default:v(()=>[b(l(ve))]),_:1})]),_:1})]),_:1}),b(we,{visible:c.value,"onUpdate:visible":h[0]||(h[0]=N=>c.value=N),"model-value":r.value,"onUpdate:modelValue":h[1]||(h[1]=N=>r.value=N),title:"选择服务中心实例",width:1200,onSelect:p},null,8,["visible","model-value"])],64))}}),B=H(Oe,[["__scopeId","data-v-4f712468"]]);function Ce(n){const O=n||"hub0041",s=w(!1),i=w([]),c=w(),r={fields:[{field:"namespaceName",label:"命名空间名称",type:"input",placeholder:"请输入命名空间名称",span:6,clearable:!0},{field:"instanceName",label:"服务中心实例",type:"custom",span:6,render:e=>Y(B,{modelValue:e.instanceName||"","onUpdate:modelValue":a=>{e.instanceName=a}})},{field:"environment",label:"部署环境",type:"select",placeholder:"请选择环境",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"开发环境",value:"DEVELOPMENT"},{label:"预发布环境",value:"STAGING"},{label:"生产环境",value:"PRODUCTION"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建命名空间",icon:ge,type:"primary",tooltip:"新建命名空间"},{key:"edit",label:"编辑",icon:he,tooltip:"编辑选中的命名空间"},{key:"delete",label:"删除",icon:Ne,type:"error",tooltip:"删除选中的命名空间"}],showSearchButton:!0,showResetButton:!0},y={tabs:[{key:"basic",label:"基本信息"},{key:"quota",label:"配额配置"},{key:"other",label:"其它"}],fields:[{field:"namespaceId",label:"命名空间ID",type:"input",placeholder:"自动生成或手动输入（32个字符：字母、数字、下划线）",span:12,tabKey:"basic",primary:!0,required:!0,tips:"命名空间唯一标识（主键），32个字符：字母、数字、下划线，如果不填写将自动生成",rules:[{pattern:/^[a-zA-Z0-9_]{1,32}$/,message:"命名空间ID只能包含字母、数字、下划线，且长度不超过32个字符",trigger:["change","blur"]}],props:{maxlength:32}},{field:"namespaceName",label:"命名空间名称",type:"input",placeholder:"请输入命名空间名称（32个字符：字母、数字、下划线）",span:12,tabKey:"basic",required:!0,rules:[{pattern:/^[a-zA-Z0-9_]{1,32}$/,message:"命名空间名称只能包含字母、数字、下划线，且长度不超过32个字符",trigger:["change","blur"]}],props:{maxlength:32}},{field:"instanceName",label:"服务中心实例",type:"custom",span:12,tabKey:"basic",required:!0,tips:"关联的服务中心实例名称",render:e=>Y(B,{modelValue:e.instanceName||"","onUpdate:modelValue":a=>{e.instanceName=a},onSelect:a=>{a&&a.environment&&(e.environment=a.environment)}})},{field:"environment",label:"部署环境",type:"select",placeholder:"请选择部署环境",span:12,tabKey:"basic",required:!0,disabled:!0,options:[{label:"开发环境",value:"DEVELOPMENT"},{label:"预发布环境",value:"STAGING"},{label:"生产环境",value:"PRODUCTION"}],tips:"部署环境由选择的服务中心实例自动确定"},{field:"namespaceDescription",label:"命名空间描述",type:"textarea",placeholder:"请输入命名空间描述",span:24,tabKey:"basic",props:{rows:3}},{field:"activeFlag",label:"活动状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"serviceQuotaLimit",label:"服务数量配额限制",type:"number",placeholder:"200",span:12,tabKey:"quota",defaultValue:200,tips:"该命名空间下允许的最大服务数量，0表示无限制",props:{min:0}},{field:"configQuotaLimit",label:"配置数量配额限制",type:"number",placeholder:"200",span:12,tabKey:"quota",defaultValue:200,tips:"该命名空间下允许的最大配置数量，0表示无限制",props:{min:0}},{field:"noteText",label:"备注",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{rows:3}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}]},I={columns:[{field:"namespaceId",title:"命名空间ID",sortable:!0,align:"center",showOverflow:!0},{field:"namespaceName",title:"命名空间名称",sortable:!0,align:"center",showOverflow:!0},{field:"instanceName",title:"服务中心实例",sortable:!0,align:"center",showOverflow:!0},{field:"environment",title:"部署环境",sortable:!0,align:"center",showOverflow:!0,formatter:({cellValue:e})=>({DEVELOPMENT:"开发环境",STAGING:"预发布环境",PRODUCTION:"生产环境"})[e]||e},{field:"namespaceDescription",title:"描述",align:"left",showOverflow:!0,width:200},{field:"serviceQuotaLimit",title:"服务配额",align:"center",formatter:({cellValue:e})=>e===0?"无限制":e},{field:"configQuotaLimit",title:"配置配额",align:"center",formatter:({cellValue:e})=>e===0?"无限制":e},{field:"activeFlag",title:"活动状态",align:"center",slots:{default:"activeFlag"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?U(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?U(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:c,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},p=()=>{c.value=void 0},o=e=>{c.value?Object.assign(c.value,e):c.value=e},h=e=>{i.value=e},N=()=>{i.value=[]},M=e=>{i.value.unshift(e)},G=(e,a,_)=>{const T=i.value.findIndex(V=>V.namespaceId===e&&V.tenantId===a);T!==-1&&Object.assign(i.value[T],_)},g=(e,a)=>{const _=i.value.findIndex(T=>T.namespaceId===e&&T.tenantId===a);_!==-1&&i.value.splice(_,1)};return{moduleId:O,loading:s,namespaceList:i,pageInfo:c,searchFormConfig:r,namespaceFormConfig:y,gridConfig:I,resetPagination:p,updatePagination:o,setNamespaceList:h,clearNamespaceList:N,addNamespaceToList:M,updateNamespaceInList:G,removeNamespaceFromList:g,removeNamespacesFromList:e=>{e.forEach(a=>{g(a.namespaceId,a.tenantId)})}}}const k=se("/gateway/hub0041");async function Te(n){return k.post("/queryNamespaces",n)}async function De(n){return k.post("/getNamespace",{namespaceId:n})}async function Pe(n){return k.post("/addNamespace",n)}async function Me(n){return k.post("/editNamespace",n)}async function _e(n){return k.post("/deleteNamespace",{namespaceId:n})}function je(n,O){const s=le(),i=J(),c=Ce(O),{loading:r,namespaceList:y,pageInfo:I,setNamespaceList:p,updatePagination:o,addNamespaceToList:h,updateNamespaceInList:N,removeNamespaceFromList:M,removeNamespacesFromList:G}=c,g=async d=>{var t,m,f;r.value=!0;try{let x=d;!x&&((t=n==null?void 0:n.value)!=null&&t.getFormData)&&(x=n.value.getFormData()||{});const Q={...x?Object.fromEntries(Object.entries(x).filter(([,S])=>S!==""&&S!==null&&S!==void 0)):{},...ie((m=I.value)==null?void 0:m.pageIndex,(f=I.value)==null?void 0:f.pageSize)},D=await Te(Q);if(D.oK){if(D.bizData){const S=JSON.parse(D.bizData),W=Array.isArray(S)?S:[];p(W)}if(D.pageQueryData){const S=JSON.parse(D.pageQueryData);o(S)}}else s.error(D.errMsg||"查询命名空间列表失败")}catch{s.error("加载命名空间列表失败")}finally{r.value=!1}};return{model:c,loadNamespaces:g,handleSearch:async d=>{await g(d)},handleReset:async()=>{c.resetPagination(),await g()},handlePageChange:async({currentPage:d,pageSize:t})=>{o({pageIndex:d,pageSize:t}),await g()},handleRefresh:async()=>{await g()},addNamespace:async d=>{r.value=!0;try{const t=await Pe(d);if(R(t)){const m=C(t,"命名空间创建成功");if(s.success(m),t.bizData){const f=JSON.parse(t.bizData);h(f)}else await g();return!0}else{const m=C(t,"新增命名空间失败");return s.error(m),!1}}catch{return s.error("新增命名空间失败"),!1}finally{r.value=!1}},editNamespace:async d=>{r.value=!0;try{const t=await Me(d);if(R(t)){const m=C(t,"命名空间更新成功");if(s.success(m),t.bizData){const f=JSON.parse(t.bizData);N(f.namespaceId,f.tenantId,f)}return!0}else{const m=C(t,"编辑命名空间失败");return s.error(m),!1}}catch{return s.error("编辑命名空间失败"),!1}finally{r.value=!1}},deleteNamespace:async d=>{if(!await i.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除命名空间 "${d.namespaceName}" (${d.namespaceId}) 吗？`,icon:ye,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;r.value=!0;try{const m=await _e(d.namespaceId);if(R(m)){const f=C(m,"命名空间删除成功");return s.success(f),M(d.namespaceId,d.tenantId),!0}else{const f=C(m,"删除命名空间失败");return s.error(f),!1}}catch{return s.error("删除命名空间失败"),!1}finally{r.value=!1}},getNamespaceDetail:async d=>{r.value=!0;try{const t=await De(d);return R(t)&&t.bizData?JSON.parse(t.bizData):(s.error(C(t,"获取命名空间详情失败")),null)}catch{return s.error("获取命名空间详情失败"),null}finally{r.value=!1}}}}export{je as u};

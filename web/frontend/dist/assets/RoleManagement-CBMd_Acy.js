import{u as se,G as ne}from"./GDataFormModal-Dxsxu0OT.js";import{c as ie,G as ce,S as de}from"./SearchForm-QXeOPYmP.js";import{G as ue}from"./GPane-CsXIYqCJ.js";import{d as H,c as K,b as V,o as N,e as A,w as R,f as s,cR as fe,g as $,a5 as G,a4 as pe,cS as he,i as Y,bO as me,h as z,J as q,K as j,t as U,_ as W,af as ye,m as J,r as w,a7 as ve,I as be,z as Q,B as X,A as ge,ab as Z,cj as ee,am as te}from"./index-DjxxKbEp.js";import{G as we}from"./GTree-Dw-mfFaq.js";/* empty css                                                                    */import{A as Ie,T as Ce}from"./TrashOutline-BcWY-t3t.js";import{C as Se}from"./CreateOutline-BrBZbaeY.js";import{W as ae}from"./WarningOutline-CZUg3Xyp.js";import"./GDialog-BJEb9xfq.js";import"./Scrollbar-Cn85cQCv.js";import"./CloseOutline-BhR4kvnt.js";import"./GModal-Bj4TqfQo.js";import"./DownloadOutline-BfRf1_li.js";import"./OptionsOutline-CJ-6A-d8.js";import"./DatePicker-CHfUawd3.js";import"./Select-DKaQ0jI7.js";import"./Upload-CJqFWVTs.js";import"./download-C2161hUv.js";import"./Grid-DuzVlp9K.js";import"./InputNumber-CTlCGkXq.js";import"./Switch-CTvADbq_.js";import"./index-DR_R-bYe.js";import"./RefreshOutline-RMMvHLjq.js";import"./InformationCircleOutline-Co9yRxRj.js";import"./CopyOutline-CPowUVP4.js";import"./Checkbox-DyGGdka1.js";const Re={class:"g-drawer"},ke={class:"g-drawer__header"},De={class:"g-drawer__header-main"},_e={class:"g-drawer__title"},xe={class:"g-drawer__body"},Te={key:0,class:"g-drawer__footer"},Ae=H({name:"GDrawer",__name:"GDrawer",props:{show:{type:Boolean,default:!1},title:{default:""},width:{default:400},placement:{default:"right"},maskClosable:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},showCancel:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0},cancelText:{default:"取消"},confirmText:{default:"确定"},confirmLoading:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!0},mask:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!0},to:{type:[String,Boolean]},resizable:{type:Boolean,default:!1},style:{type:[Boolean,null,String,Object,Array]},headerClass:{},headerStyle:{},footerClass:{},footerStyle:{},bodyClass:{},bodyStyle:{},bodyContentClass:{},bodyContentStyle:{}},emits:["update:show","cancel","confirm","close","after-enter","after-leave"],setup(a,{emit:f}){const e=a,o=f,c=K(()=>typeof e.width=="number"?`${e.width}px`:e.width),h=K(()=>{if(e.style)return Array.isArray(e.style),e.style}),p=K(()=>{const u={height:"var(--g-drawer-header-height)",minHeight:"var(--g-drawer-header-height)",maxHeight:"var(--g-drawer-header-height)"};return e.headerStyle?typeof e.headerStyle=="string"?e.headerStyle:{...u,...e.headerStyle}:u}),y=K(()=>{const u={height:"var(--g-drawer-footer-height)",minHeight:"var(--g-drawer-footer-height)",maxHeight:"var(--g-drawer-footer-height)"};return e.footerStyle?typeof e.footerStyle=="string"?e.footerStyle:{...u,...e.footerStyle}:u}),v=u=>{o("update:show",u),u||o("close")},I=()=>{o("cancel"),o("update:show",!1)},b=()=>{o("confirm")};return(u,C)=>(N(),V("div",Re,[A(s(he),{show:e.show,width:c.value,placement:e.placement,"mask-closable":e.maskClosable,closable:e.closable,"auto-focus":e.autoFocus,"show-mask":e.mask,"block-scroll":e.blockScroll,to:e.to===!1?void 0:e.to,resizable:e.resizable,style:pe(h.value),"trap-focus":!1,"onUpdate:show":v,onAfterEnter:C[0]||(C[0]=m=>o("after-enter")),onAfterLeave:C[1]||(C[1]=m=>o("after-leave"))},{default:R(()=>[A(s(fe),{title:e.title,closable:e.closable,"header-class":e.headerClass,"header-style":p.value,"footer-class":e.footerClass,"footer-style":y.value,"body-class":e.bodyClass,"body-style":e.bodyStyle,"body-content-class":e.bodyContentClass,"body-content-style":e.bodyContentStyle},{header:R(()=>[$("div",ke,[$("div",De,[G(u.$slots,"header",{},()=>[$("span",_e,U(e.title),1)],!0)])])]),footer:R(()=>[G(u.$slots,"footer",{},()=>[e.showFooter?(N(),V("div",Te,[A(s(me),{justify:"end",size:8},{default:R(()=>[e.showCancel?(N(),z(s(q),{key:0,size:"small",onClick:I},{default:R(()=>[j(U(e.cancelText),1)]),_:1})):Y("",!0),e.showConfirm?(N(),z(s(q),{key:1,type:"primary",size:"small",loading:e.confirmLoading,onClick:b},{default:R(()=>[j(U(e.confirmText),1)]),_:1},8,["loading"])):Y("",!0)]),_:1})])):Y("",!0)],!0)]),default:R(()=>[$("div",xe,[G(u.$slots,"default",{},void 0,!0)])]),_:3},8,["title","closable","header-class","header-style","footer-class","footer-style","body-class","body-style","body-content-class","body-content-style"])]),_:3},8,["show","width","placement","mask-closable","closable","auto-focus","show-mask","block-scroll","to","resizable","style"])]))}}),Ne=W(Ae,[["__scopeId","data-v-8de639dc"]]),E=ye("/gateway/hub0005");async function Be(a){return E.post("/queryRoles",a)}async function Me(a){return E.post("/addRole",a)}async function Le(a){return E.post("/editRole",a)}async function oe(a,f){return E.post("/deleteRole",{roleId:a,tenantId:f})}async function Oe(a){return E.post("/getRoleResources",{roleId:a})}async function Ke(a){return E.post("/saveRoleResources",a)}const Ee={class:"role-resource-drawer"},$e=H({name:"RoleResourceDrawer",__name:"RoleResourceDrawer",props:{show:{type:Boolean,default:!1},roleId:{default:""},roleName:{default:""}},emits:["update:show","close","success"],setup(a,{emit:f}){const e=a,o=f,c=J(),h=K({get:()=>e.show,set:t=>o("update:show",t)}),p=K(()=>e.roleName?`角色授权 - ${e.roleName}`:"角色授权"),y=w(!1),v=w([]),I=w([]),b=w([]),u=w([]);ve(()=>e.show,t=>{t&&e.roleId?C():t||(v.value=[],b.value=[],u.value=[],I.value=[])});async function C(){if(e.roleId){y.value=!0;try{const t=await Oe(e.roleId);if(Q(t)){const r=ge(t,[]);v.value=m(r);const l=k(r);b.value=l,u.value=[...l],I.value=L(r)}else c.error(X(t)||"加载资源列表失败")}catch(t){c.error(t.message||"加载资源列表失败")}finally{y.value=!1}}}function m(t){return t.map(r=>({key:r.resourceId,label:r.resourceName,children:r.children&&r.children.length>0?m(r.children):void 0}))}function k(t){const r=[];function l(d){for(const i of d)i.checked===!0&&r.push(i.resourceId),i.children&&i.children.length>0&&l(i.children)}return l(t),r}function L(t){const r=[];function l(d){for(const i of d)r.push(i.resourceId),i.children&&i.children.length>0&&l(i.children)}return l(t),r}function n(t){b.value=t,u.value=t}async function g(){if(!e.roleId){c.warning("角色ID不能为空");return}y.value=!0;try{const t=u.value.join(","),r=await Ke({roleId:e.roleId,resourceIds:t,permissionType:"ALLOW"});Q(r)?(c.success("保存成功"),o("success"),S()):c.error(X(r)||"保存失败")}catch(t){c.error(t.message||"保存失败")}finally{y.value=!1}}function _(){S()}function S(){o("update:show",!1),o("close")}return(t,r)=>(N(),z(s(Ne),{show:h.value,"onUpdate:show":r[0]||(r[0]=l=>h.value=l),title:p.value,width:600,to:"#hub0005",mask:!1,"show-footer":!0,"show-cancel":!0,"show-confirm":!0,"confirm-loading":y.value,"cancel-text":"取消","confirm-text":"保存",onConfirm:g,onCancel:_,onClose:S},{default:R(()=>[$("div",Ee,[y.value&&!v.value.length?(N(),z(s(be),{key:0,show:!0},{description:R(()=>r[1]||(r[1]=[j("加载资源列表...")])),_:1})):(N(),z(s(we),{key:1,data:v.value,checkable:!0,cascade:!0,"check-strategy":"all","show-line":!0,"default-expanded-keys":I.value,"checked-keys":b.value,"virtual-scroll":!0,"onUpdate:checkedKeys":n},null,8,["data","default-expanded-keys","checked-keys"]))])]),_:1},8,["show","title","confirm-loading"]))}}),Fe=W($e,[["__scopeId","data-v-93cece68"]]);var B=(a=>(a.ENABLED="Y",a.DISABLED="N",a))(B||{}),F=(a=>(a.YES="Y",a.NO="N",a))(F||{}),M=(a=>(a.BUILT_IN="Y",a.CUSTOM="N",a))(M||{});function ze(){const a="hub0005",f=w(!1),e=w([]),o=w(),c={fields:[{field:"roleName",label:"角色名称",type:"input",placeholder:"请输入角色名称",span:6,clearable:!0},{field:"roleStatus",label:"状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"启用",value:B.ENABLED},{label:"禁用",value:B.DISABLED}]},{field:"builtInFlag",label:"类型",type:"select",placeholder:"请选择类型",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"内置",value:M.BUILT_IN},{label:"自定义",value:M.CUSTOM}]}],toolbarButtons:[{key:"add",label:"新增",icon:Ie,type:"primary",tooltip:"新增角色"},{key:"edit",label:"编辑",icon:Se,tooltip:"编辑选中的角色"},{key:"delete",label:"删除",icon:Ce,type:"error",tooltip:"删除选中的角色"}],showSearchButton:!0,showResetButton:!0},h=[{key:"basic",label:"基本信息"},{key:"other",label:"其他信息"}],p=[{field:"roleId",label:"角色ID",type:"input",placeholder:"请输入角色ID",span:8,tabKey:"basic",required:!0,primary:!0},{field:"roleName",label:"角色名称",type:"input",placeholder:"请输入角色名称",span:8,tabKey:"basic",required:!0},{field:"roleDescription",label:"角色描述",type:"textarea",placeholder:"请输入角色描述",span:24,tabKey:"basic"},{field:"roleStatus",label:"角色状态",type:"select",placeholder:"请选择状态",span:8,tabKey:"basic",defaultValue:B.ENABLED,options:[{label:"启用",value:B.ENABLED},{label:"禁用",value:B.DISABLED}]},{field:"builtInFlag",label:"内置标记",type:"select",placeholder:"请选择类型",span:8,tabKey:"basic",defaultValue:M.CUSTOM,options:[{label:"内置",value:M.BUILT_IN},{label:"自定义",value:M.CUSTOM}]},{field:"dataScope",label:"数据权限范围",type:"textarea",placeholder:"请输入数据权限范围配置（JSON格式）",span:24,tabKey:"basic"},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,tabKey:"other",disabled:!0},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"activeFlag",label:"活动标记",type:"select",span:8,tabKey:"basic",defaultValue:F.YES,options:[{label:"活动",value:F.YES},{label:"非活动",value:F.NO}]},{field:"noteText",label:"备注",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"basic"}],y={columns:[{field:"roleId",title:"角色ID",showOverflow:!0},{field:"roleName",title:"角色名称",sortable:!0,showOverflow:!0},{field:"roleDescription",title:"角色描述",showOverflow:"tooltip"},{field:"roleStatus",title:"状态",align:"center",formatter:({cellValue:n})=>n===B.ENABLED?"启用":"禁用"},{field:"builtInFlag",title:"类型",align:"center",formatter:({cellValue:n})=>n===M.BUILT_IN?"内置":"自定义"},{field:"activeFlag",title:"活动标记",align:"center",formatter:({cellValue:n})=>n===F.YES?"活动":"非活动"},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:n})=>n?Z(n,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:n})=>n?Z(n,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0},{field:"noteText",title:"备注",showOverflow:"tooltip"}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:o,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"},{code:"roleAuth",name:"角色授权",prefixIcon:"vxe-icon-user"}]},height:"100%"},v=()=>{o.value=void 0},I=n=>{o.value?Object.assign(o.value,n):o.value=n},b=n=>{e.value=n},u=()=>{e.value=[]},C=n=>{e.value.unshift(n)},m=(n,g,_)=>{const S=e.value.findIndex(t=>t.roleId===n&&t.tenantId===g);S!==-1&&Object.assign(e.value[S],_)},k=(n,g)=>{const _=e.value.findIndex(S=>S.roleId===n&&S.tenantId===g);_!==-1&&e.value.splice(_,1)};return{moduleId:a,loading:f,roleList:e,pageInfo:o,searchFormConfig:c,formTabs:h,formFields:p,gridConfig:y,resetPagination:v,updatePagination:I,setRoleList:b,clearRoleList:u,addRoleToList:C,updateRoleInList:m,removeRoleFromList:k,removeRolesFromList:n=>{n.forEach(g=>{k(g.roleId,g.tenantId)})}}}function Pe(a){const f=J(),e=se(),o=ze(),{loading:c,roleList:h,pageInfo:p,setRoleList:y,updatePagination:v,addRoleToList:I,updateRoleInList:b,removeRoleFromList:u,removeRolesFromList:C}=o,m=async l=>{var d,i,x;c.value=!0;try{let D=l;!D&&((d=a==null?void 0:a.value)!=null&&d.getFormData)&&(D=a.value.getFormData()||{});const le={...D?Object.fromEntries(Object.entries(D).filter(([,T])=>T!==""&&T!==null&&T!==void 0)):{},...ie((i=p.value)==null?void 0:i.pageIndex,(x=p.value)==null?void 0:x.pageSize)},O=await Be(le);if(O.oK){if(O.bizData){const T=JSON.parse(O.bizData),re=Array.isArray(T)?T:[];y(re)}if(O.pageQueryData){const T=JSON.parse(O.pageQueryData);v(T)}}else f.error(O.errMsg||"查询角色列表失败")}catch(D){console.error("加载角色列表失败:",D),f.error("加载角色列表失败")}finally{c.value=!1}};return{model:o,loadRoles:m,handleSearch:async l=>{await m(l)},handleReset:async()=>{o.resetPagination(),await m()},handlePageChange:async({currentPage:l,pageSize:d})=>{v({pageIndex:l,pageSize:d}),await m()},handleRefresh:async()=>{await m()},addRole:async l=>{c.value=!0;try{const d=await Me(l);if(d.oK&&d.state){if(f.success(d.popMsg||"新增角色成功"),d.bizData){const i=JSON.parse(d.bizData);I(i)}else await m();return!0}else return f.error(d.errMsg||d.popMsg||"新增角色失败"),!1}catch(d){return console.error("新增角色失败:",d),f.error("新增角色失败"),!1}finally{c.value=!1}},editRole:async l=>{c.value=!0;try{const d=await Le(l);if(d.oK&&d.state){if(f.success(d.popMsg||"编辑角色成功"),d.bizData){const i=JSON.parse(d.bizData);b(i.roleId,i.tenantId,i)}else b(l.roleId,l.tenantId,l);return!0}else return f.error(d.errMsg||d.popMsg||"编辑角色失败"),!1}catch(d){return console.error("编辑角色失败:",d),f.error("编辑角色失败"),!1}finally{c.value=!1}},deleteRole:async l=>{if(!await e.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除角色 "${l.roleName}" 吗？`,icon:ae,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;c.value=!0;try{const i=await oe(l.roleId,l.tenantId);return i.oK&&i.state?(f.success(i.popMsg||"删除角色成功"),u(l.roleId,l.tenantId),h.value.length===0&&p.value&&p.value.pageIndex>1&&(v({pageIndex:p.value.pageIndex-1}),await m()),!0):(f.error(i.errMsg||i.popMsg||"删除角色失败"),!1)}catch(i){return console.error("删除角色失败:",i),f.error("删除角色失败"),!1}finally{c.value=!1}},batchDeleteRoles:async l=>{if(!await e.warning({title:"确认批量删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除选中的 ${l.length} 个角色吗？`,icon:ae,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;c.value=!0;try{let i=0,x=0;for(const D of l)try{const P=await oe(D.roleId,D.tenantId);P.oK&&P.state?i++:x++}catch{x++}return i>0?(f.success(`成功删除 ${i} 个角色${x>0?`，失败 ${x} 个`:""}`),C(l.slice(0,i)),await m(),!0):(f.error(`删除失败，共 ${x} 个`),!1)}catch(i){return console.error("批量删除角色失败:",i),f.error("批量删除角色失败"),!1}finally{c.value=!1}}}}function Ge(a,f){const e=J(),o=Pe(f),c=w(!1),h=w("create"),p=w(null),y=w(!1),v=w(""),I=w(""),b=()=>{h.value="create",p.value=null,c.value=!0},u=t=>{h.value="edit",p.value=t,c.value=!0},C=()=>{c.value=!1,p.value=null},m=t=>{h.value="view",p.value=t,c.value=!0},k=async t=>{await o.handleSearch(t)},L=async t=>{if(t&&h.value!=="view"){if(h.value==="create")await o.addRole(t)&&C();else if(h.value==="edit"){if(!p.value)return;const r={...p.value,...t};await o.editRole(r)&&C()}}},n=async(t,r)=>{switch(t){case"add":b();break;case"edit":{if(!(a!=null&&a.value)){e.warning("Grid 引用未设置");return}const l=a.value.getCurrentRecord();if(!l){e.warning("请先点击选择要编辑的角色");return}u(l);break}case"delete":{if(!(a!=null&&a.value)){e.warning("Grid 引用未设置");return}const l=a.value.getCurrentRecord();if(!l){e.warning("请先点击选择要删除的角色");return}await o.deleteRole(l);break}case"search":{await o.handleSearch(r);break}}},g=t=>{v.value=t.roleId,I.value=t.roleName,y.value=!0};return{service:o,formDialogVisible:c,formDialogMode:h,currentEditRole:p,openAddDialog:b,openEditDialog:u,openViewDialog:m,handleFormSubmit:L,roleAuthDrawerVisible:y,roleAuthRoleId:v,roleAuthRoleName:I,openRoleAuthDrawer:g,closeRoleAuthDrawer:()=>{y.value=!1,v.value="",I.value=""},handleToolbarClick:n,handleMenuClick:async({code:t,row:r})=>{if(r)switch(t){case"view":m(r);break;case"edit":u(r);break;case"delete":await o.deleteRole(r);break;case"roleAuth":g(r);break}},handleSearch:k}}const Ye=["id"],Ue=H({name:"RoleManagement",__name:"RoleManagement",setup(a){const f=w(),e=w(),{service:o,formDialogVisible:c,formDialogMode:h,currentEditRole:p,handleFormSubmit:y,handleToolbarClick:v,handleMenuClick:I,handleSearch:b,roleAuthDrawerVisible:u,roleAuthRoleId:C,roleAuthRoleName:m,closeRoleAuthDrawer:k}=Ge(e,f);return(L,n)=>(N(),V("div",{class:"role-management",id:s(o).model.moduleId},[A(s(ue),{direction:"vertical","default-size":"80px"},{1:R(()=>[A(de,te({ref_key:"searchFormRef",ref:f,"module-id":s(o).model.moduleId},s(o).model.searchFormConfig,{onSearch:s(b),onToolbarClick:s(v)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:R(()=>[A(s(ce),te({ref_key:"gridRef",ref:e,"module-id":s(o).model.moduleId,data:s(o).model.roleList,loading:s(o).model.loading},s(o).model.gridConfig,{onPageChange:s(o).handlePageChange,onMenuClick:s(I)}),null,16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),A(ne,{visible:s(c),"onUpdate:visible":n[0]||(n[0]=g=>ee(c)?c.value=g:null),mode:s(h),title:s(h)==="create"?"新增角色":s(h)==="edit"?"编辑角色":"查看角色详情",to:`#${s(o).model.moduleId}`,"form-fields":s(o).model.formFields,"form-tabs":s(o).model.formTabs,"initial-data":s(p)||void 0,"auto-close-on-confirm":!1,"confirm-loading":s(o).model.loading.value,onSubmit:s(y)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),A(Fe,{show:s(u),"onUpdate:show":n[1]||(n[1]=g=>ee(u)?u.value=g:null),"role-id":s(C),"role-name":s(m),onClose:s(k)},null,8,["show","role-id","role-name","onClose"])],8,Ye))}}),bt=W(Ue,[["__scopeId","data-v-19c912d9"]]);export{bt as default};

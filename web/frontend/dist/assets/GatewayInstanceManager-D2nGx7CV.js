import{G as ge}from"./GDataFormModal-CVDITwbR.js";import{G as be,S as he,c as De}from"./SearchForm-YJ2LWOI7.js";import{G as ve}from"./GPane-MizfBz4X.js";import{d as ae,r as p,a7 as ee,av as Me,g as te,o as W,w as S,f as Ne,e as t,b,am as Q,aO as H,K as B,t as U,_ as le,c as Ie,G as Oe,J as Ee,i as ne,aQ as Ye,T as j,aa as me,m as Ce,z as K,A as we,B as L,cr as Y}from"./index-talhFt-3.js";import{I as Ke,U as Ge,A as _e,D as ze,C as He,a as Be,R as Ue}from"./RateLimitConfigFormModal-BGd80brc.js";import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Ds-H5BDS.js";import{u as $e,C as Re}from"./AlertChannelNameSelector.vue_vue_type_style_index_0_scoped_90f3078b_lang-BFQ7mLkq.js";import{u as Se}from"./useGDialog-DyYy8db0.js";import{g as Je,r as je,s as We,a as qe,d as Qe,e as Xe,b as Ze,q as et,c as tt,f as at}from"./index-B4oO4plJ.js";import{G as lt}from"./GModal-CCcCEJqk.js";import{E as nt}from"./EllipsisHorizontalOutline-CQvCckwd.js";import{N as st}from"./InputGroup-C4T1Hgnm.js";import{D as it}from"./DocumentOutline-BjVf7Dk_.js";import{K as ot}from"./KeyOutline-CIJanbLW.js";import{A as rt}from"./AddOutline-_WyjpAxi.js";import{C as ct}from"./CreateOutline-5HZeJ_Zc.js";import{T as dt}from"./TrashOutline-B0_nSqhO.js";import{G as ut}from"./GlobeOutline-D51dYNTA.js";import{N as ye}from"./DynamicTags-6ZvqYpG4.js";import{W as pt}from"./WarningOutline-DmMvjmvd.js";import{R as ft}from"./RefreshOutline-CA3DFaJQ.js";import{S as gt}from"./StopCircleOutline-Dq9VUHq4.js";import{P as mt}from"./PlayCircleOutline-DvvrWF_2.js";import{C as yt}from"./CheckmarkCircleOutline-DgcYcMd5.js";import{A as bt}from"./AlertCircleOutline-KYOuJ1zE.js";import"./index-Do6tdfLc.js";import"./Select-B2cdGhy0.js";import"./DownloadOutline-BSXu5v1r.js";import"./Upload-CvnZ1nba.js";import"./download-C2161hUv.js";import"./Alert-BFZllQbg.js";import"./index-DjonybgA.js";import"./GDialog-CQwmJXZh.js";import"./CloseOutline-Dpm_uP78.js";import"./ContractOutline-BiyZGpf6.js";import"./prop-NnGblK-3.js";const ht=["id"],vt=ae({name:"AlertChannelListModal",__name:"AlertChannelListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{default:void 0},modelValue:{default:""}},emits:["update:visible","after-leave","select","update:modelValue"],setup(A,{emit:f}){const d=A,s=f,r=p(),C=p(),v=p(d.visible),w=ee(()=>d.visible,g=>{v.value=g,g&&E()}),{service:h,handleSearch:F,handlePageChange:x}=$e(C,r),N=g=>{const I=Re.find(k=>k.value===g);return(I==null?void 0:I.label)||g},O=g=>({email:"primary",qq:"info",wechat_work:"success",dingtalk:"warning",webhook:"default",sms:"error"})[g]||"default",T=g=>{v.value=g,s("update:visible",g)},D=()=>{s("after-leave")},E=async()=>{await F()},n=async({currentPage:g,pageSize:I})=>{await x({currentPage:g,pageSize:I})},m=({row:g})=>{g&&g.channelName&&(s("update:modelValue",g.channelName),s("select",g),T(!1))};return Me(()=>{w()}),(g,I)=>(W(),te(t(lt),{visible:v.value,title:d.title||"选择告警渠道",width:d.width||1200,to:d.to,"show-footer":!1,"onUpdate:visible":T,onAfterLeave:D},{default:S(()=>[Ne("div",{class:"alert-channel-list-modal",id:t(h).model.moduleId},[b(t(ve),{direction:"vertical","no-resize":!0},{1:S(()=>[b(he,Q({ref_key:"searchFormRef",ref:r,"module-id":t(h).model.moduleId},t(h).model.searchFormConfig,{onSearch:E}),null,16,["module-id"])]),2:S(()=>[b(t(be),Q({ref_key:"gridRef",ref:C,"module-id":t(h).model.moduleId,data:t(h).model.configList,loading:t(h).model.loading},t(h).model.gridConfig,{onPageChange:n,onRowClick:m}),{channelType:S(({row:k})=>[b(t(H),{size:"small",type:O(k.channelType)},{default:S(()=>[B(U(N(k.channelType)),1)]),_:2},1032,["type"])]),activeFlag:S(({row:k})=>[b(t(H),{size:"small",type:k.activeFlag==="Y"?"success":"default"},{default:S(()=>[B(U(k.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),defaultFlag:S(({row:k})=>[b(t(H),{size:"small",type:k.defaultFlag==="Y"?"warning":"default"},{default:S(()=>[B(U(k.defaultFlag==="Y"?"默认":"-"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading"])]),_:1})],8,ht)]),_:1},8,["visible","title","width","to"]))}}),It=le(vt,[["__scopeId","data-v-0f0a6989"]]),Ct=ae({name:"AlertChannelNameSelector",__name:"AlertChannelNameSelector",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(A,{emit:f}){const d=A,s=f,r=p(!1),C=p(d.modelValue);ee(()=>d.modelValue,h=>{C.value=h}),ee(C,h=>{s("update:modelValue",h)});const v=h=>{C.value=h},w=()=>{r.value=!0};return(h,F)=>(W(),Ie(Ye,null,[b(t(st),null,{default:S(()=>[b(t(Oe),{value:A.modelValue,placeholder:"请输入告警渠道名称或点击选择",clearable:"",size:"small","onUpdate:value":v},null,8,["value"]),b(t(Ee),{type:"primary",size:"small",onClick:w},{icon:S(()=>[b(t(ne),null,{default:S(()=>[b(t(nt))]),_:1})]),_:1})]),_:1}),b(It,{visible:r.value,"onUpdate:visible":F[0]||(F[0]=x=>r.value=x),"model-value":C.value,"onUpdate:modelValue":F[1]||(F[1]=x=>C.value=x),title:"选择告警渠道",width:1200},null,8,["visible","model-value"])],64))}}),wt=le(Ct,[["__scopeId","data-v-90f3078b"]]);function St(){const A="hub0020",f=p(!1),d=p([]),s=p(),r={fields:[{field:"instanceName",label:"实例名称",type:"input",placeholder:"请输入实例名称",span:6,clearable:!0},{field:"healthStatus",label:"健康状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"健康",value:"Y"},{label:"不健康",value:"N"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建实例",icon:rt,type:"primary",tooltip:"新建网关实例"},{key:"edit",label:"编辑",icon:ct,tooltip:"编辑选中的实例"},{key:"delete",label:"删除",icon:dt,type:"error",tooltip:"删除选中的实例"}],showSearchButton:!0,showResetButton:!0},C={tabs:[{key:"basic",label:"基本信息"},{key:"tls",label:"TLS配置"},{key:"performance",label:"性能配置"},{key:"other",label:"其它"}],fields:[{field:"instanceName",label:"实例名称",type:"input",placeholder:"请输入实例名称",span:12,tabKey:"basic",required:!0},{field:"bindAddress",label:"绑定地址",type:"input",placeholder:"如: 0.0.0.0",span:12,tabKey:"basic",defaultValue:"0.0.0.0",tips:"服务器绑定的网络地址，0.0.0.0表示监听所有网络接口"},{field:"httpPort",label:"HTTP端口",type:"number",placeholder:"如: 8080",span:12,tabKey:"basic",defaultValue:8080,props:{min:1,max:65535}},{field:"httpsPort",label:"HTTPS端口",type:"number",placeholder:"如: 8443",span:12,tabKey:"basic",defaultValue:8443,tips:"HTTPS服务监听的端口号，范围1-65535，需要启用TLS后生效",props:{min:1,max:65535}},{field:"activeFlag",label:"自动启动",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"instanceDesc",label:"实例描述",type:"textarea",placeholder:"请输入实例描述",span:24,tabKey:"basic",props:{rows:3}},{field:"tls-config-group",label:"TLS安全配置",type:"fieldset",tabKey:"tls",children:[{field:"certStorageType",label:"证书存储类型",type:"select",span:12,defaultValue:"DATABASE",show:!1,options:[{label:"文件存储",value:"FILE"},{label:"数据库存储",value:"DATABASE"}]},{field:"tlsEnabled",label:"启用TLS",type:"switch",span:12,defaultValue:"N",tips:"启用HTTPS/TLS加密传输，保护数据传输安全",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"certPassword",label:"证书密码",type:"input",placeholder:"请输入证书密码(可选)",span:12,tips:"如果私钥文件已加密，需要提供密码进行解密",props:{type:"password",showPasswordOn:"click"}},{field:"tlsVersion",label:"TLS版本",type:"select",placeholder:"选择支持的TLS版本",span:12,defaultValue:["1.2"],tips:"选择支持的TLS协议版本，建议至少启用TLS 1.2，TLS 1.0和1.1已不安全",props:{multiple:!0,maxTagCount:2},options:[{label:"TLS 1.0",value:"1.0"},{label:"TLS 1.1",value:"1.1"},{label:"TLS 1.2",value:"1.2"},{label:"TLS 1.3",value:"1.3"}]},{field:"enableHttp2",label:"启用HTTP/2",type:"switch",span:12,defaultValue:"Y",tips:"启用HTTP/2协议，支持多路复用、头部压缩等特性，提升性能（需要TLS支持）",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"tlsCipherSuites",label:"TLS密码套件",type:"input",placeholder:"多个密码套件用逗号分隔，如: TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256，留空使用默认配置",span:24,tips:"指定允许的TLS密码套件，留空使用系统默认的安全配置，建议使用强加密套件",clearable:!0},{field:"certFileList",label:"证书文件",type:"file",span:12,props:{title:"证书文件",titleIcon:it,titleIconColor:"#18a058",showDownload:!0,config:{accept:".crt,.pem,.cer",max:1,maxSize:10*1024*1024,mode:"text",uploadText:"点击或拖拽上传证书",uploadDescription:"支持 .crt, .pem, .cer"}}},{field:"keyFileList",label:"私钥文件",type:"file",span:12,props:{title:"私钥文件",titleIcon:ot,titleIconColor:"#f0a020",showDownload:!0,config:{accept:".key,.pem",max:1,maxSize:10*1024*1024,mode:"text",uploadText:"点击或拖拽上传私钥",uploadDescription:"支持 .key, .pem"}}}]},{field:"performance-config-group",label:"性能配置",type:"fieldset",tabKey:"performance",children:[{field:"maxConnections",label:"最大连接数",type:"number",placeholder:"10000",span:12,defaultValue:1e4,tips:"同时处理的最大并发连接数，超过此值的新连接将被拒绝",props:{min:100,max:1e5}},{field:"maxWorkers",label:"最大工作协程数",type:"number",placeholder:"1000",span:12,defaultValue:1e3,tips:"用于处理请求的最大工作协程数，影响并发处理能力",props:{min:100,max:1e4}},{field:"readTimeoutMs",label:"读取超时(ms)",type:"number",placeholder:"30000",span:12,defaultValue:3e4,tips:"从客户端读取请求头的最大时间，超时则关闭连接",props:{min:1e3,max:3e5}},{field:"writeTimeoutMs",label:"写入超时(ms)",type:"number",placeholder:"30000",span:12,defaultValue:3e4,tips:"向客户端写入响应的最大时间，超时则关闭连接",props:{min:1e3,max:3e5}},{field:"idleTimeoutMs",label:"空闲超时(ms)",type:"number",placeholder:"60000",span:12,defaultValue:6e4,tips:"保持连接空闲的最大时间，超时则关闭连接（用于HTTP Keep-Alive）",props:{min:1e3,max:6e5}},{field:"maxHeaderBytes",label:"最大请求头大小(字节)",type:"number",placeholder:"1048576",span:12,defaultValue:1048576,tips:"限制单个请求头的最大字节数，防止恶意请求头过大，对应 http.Server.MaxHeaderBytes",props:{min:1024,max:10485760}}]},{field:"keepalive-config-group",label:"Keep-Alive配置",type:"fieldset",tabKey:"performance",children:[{field:"keepAliveEnabled",label:"HTTP Keep-Alive",type:"switch",span:12,defaultValue:"Y",tips:"启用HTTP Keep-Alive，允许在同一个TCP连接上发送多个HTTP请求，提高性能",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"tcpKeepAliveEnabled",label:"TCP Keep-Alive",type:"switch",span:12,defaultValue:"Y",tips:"启用TCP Keep-Alive，定期发送探测包检测连接是否存活，自动清理僵尸连接",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"noteText",label:"备注",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{rows:3}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}]},v={tabs:[{key:"basic",label:"基础配置"},{key:"alert",label:"预警配置"},{key:"other",label:"其它"}],fields:[{field:"logConfigId",label:"日志配置ID",type:"input",span:12,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:12,show:!1},{field:"configName",label:"日志配置名称",type:"input",placeholder:"请输入日志配置名称",span:12,tabKey:"basic",required:!0},{field:"logFormat",label:"日志格式",type:"select",placeholder:"选择日志格式",span:12,tabKey:"basic",defaultValue:"JSON",options:[{label:"JSON格式",value:"JSON"},{label:"文本格式",value:"TEXT"},{label:"CSV格式",value:"CSV"}]},{field:"configDesc",label:"日志配置描述",type:"textarea",placeholder:"请输入日志配置描述",span:24,tabKey:"basic",props:{rows:2}},{field:"content-control-group",label:"日志内容控制",type:"fieldset",tabKey:"basic",props:{titleSize:300},children:[{field:"recordRequestBody",label:"记录请求体",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"recordResponseBody",label:"记录响应体",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"recordHeaders",label:"记录请求头",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"maxBodySizeBytes",label:"最大报文大小(字节)",type:"number",placeholder:"1048576",span:12,defaultValue:1048576,props:{min:0}}]},{field:"output-target-group",label:"日志输出目标",type:"fieldset",tabKey:"basic",props:{titleSize:300},children:[{field:"outputTargets",label:"输出目标",type:"select",placeholder:"选择日志输出目标",span:24,defaultValue:"DATABASE",options:[{label:"文件输出",value:"FILE"},{label:"数据库输出",value:"DATABASE"},{label:"MongoDB输出",value:"MONGODB"},{label:"Elasticsearch输出",value:"ELASTICSEARCH"},{label:"ClickHouse输出",value:"CLICKHOUSE"}]},{field:"fileConfig.filePath",label:"文件路径",type:"input",placeholder:"./logs/gateway.log",span:12,defaultValue:"./logs/gateway.log",show:n=>{const m=n.outputTargets||"";return typeof m=="string"&&m.includes("FILE")}},{field:"logRetentionDays",label:"文件保留天数",type:"number",placeholder:"30",span:12,defaultValue:30,props:{min:1},show:n=>{const m=n.outputTargets||"";return typeof m=="string"&&m.includes("FILE")}}]},{field:"async-processing-group",label:"异步和批量处理",type:"fieldset",tabKey:"basic",props:{titleSize:300},children:[{field:"enableAsyncLogging",label:"启用异步日志",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"asyncQueueSize",label:"异步队列大小",type:"number",placeholder:"1000",span:12,defaultValue:1e3,props:{min:1}},{field:"batchSize",label:"批处理大小",type:"number",placeholder:"100",span:12,defaultValue:100,props:{min:1}},{field:"asyncFlushIntervalMs",label:"异步刷新间隔(ms)",type:"number",placeholder:"5000",span:12,defaultValue:5e3,props:{min:100,max:6e4}},{field:"enableBatchProcessing",label:"启用批量处理",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"batchTimeoutMs",label:"批处理超时(ms)",type:"number",placeholder:"1000",span:12,defaultValue:1e3,props:{min:1e3,max:3e5}}]},{field:"sensitive-data-group",label:"敏感数据处理",type:"fieldset",tabKey:"basic",props:{titleSize:300},children:[{field:"enableSensitiveDataMasking",label:"启用敏感数据脱敏",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"maskingPattern",label:"脱敏模式",type:"select",placeholder:"选择脱敏模式",span:12,defaultValue:"****",options:[{label:"替换为*",value:"****"},{label:"替换为[MASKED]",value:"[MASKED]"},{label:"保留前后字符",value:"KEEP_EDGE"},{label:"自定义规则",value:"CUSTOM"}]},{field:"sensitiveFields",label:"敏感字段",type:"custom",span:24,defaultValue:[],render:n=>j(ye,{value:n.sensitiveFields||[],"onUpdate:value":m=>{n.sensitiveFields=m},placeholder:"添加敏感字段"})}]},{field:"alert-config-group",label:"告警配置",type:"fieldset",tabKey:"alert",props:{titleSize:300},children:[{field:"extProperty.alertEnabled",label:"开启告警",type:"switch",span:12,defaultValue:"N",tips:"开启后才会对 404 / 超时 等事件触发告警",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"extProperty.channelName",label:"告警渠道名称",type:"custom",span:12,placeholder:"请输入告警渠道名称或点击选择",tips:"不填写则使用默认告警渠道",render:n=>j(wt,{modelValue:n["extProperty.channelName"]||"","onUpdate:modelValue":m=>{n["extProperty.channelName"]=m}})},{field:"extProperty.alertStatusCodes",label:"状态码告警",type:"custom",span:24,defaultValue:["502"],tips:"选择需要告警的HTTP状态码，多个状态码用逗号分隔",render:n=>{const m=n["extProperty.alertStatusCodes"]||[],g=Array.isArray(m)?m.map(I=>String(I)):typeof m=="string"?m.split(",").map(I=>I.trim()).filter(Boolean):[];return j(ye,{value:g,"onUpdate:value":I=>{n["extProperty.alertStatusCodes"]=I},placeholder:"输入状态码，如: 502, 503, 504"})}},{field:"extProperty.alertOnTimeout",label:"超时告警",type:"switch",span:8,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"extProperty.timeoutThresholdMs",label:"超时阈值(ms)",type:"number",span:8,defaultValue:12e4,tips:"当总耗时 >= 阈值（毫秒）时触发超时告警"}]},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}]},w={columns:[{field:"gatewayInstanceId",title:"实例ID",sortable:!0,align:"center",showOverflow:!0},{field:"instanceName",title:"实例名称",sortable:!0,align:"center",showOverflow:!0},{field:"instanceDesc",title:"实例描述",align:"center",showOverflow:"tooltip"},{field:"bindAddress",title:"绑定地址",align:"center",showOverflow:!0},{field:"httpPort",title:"HTTP端口",align:"center"},{field:"httpsPort",title:"HTTPS端口",align:"center"},{field:"tlsEnabled",title:"TLS",align:"center",slots:{default:"tlsEnabled"}},{field:"maxConnections",title:"最大连接数",align:"center",formatter:({cellValue:n})=>n?n.toLocaleString():"0"},{field:"healthStatus",title:"健康状态",align:"center",slots:{default:"healthStatus"}},{field:"activeFlag",title:"活动状态",align:"center",slots:{default:"activeFlag"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:n})=>n?me(n,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:n})=>n?me(n,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:s,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"},{code:"start",name:"启动",prefixIcon:"vxe-icon-caret-right"},{code:"stop",name:"停止",prefixIcon:"vxe-icon-square"},{code:"globalConfig",name:"全局配置",prefixIcon:"vxe-icon-setting",children:[{code:"ipAccessControl",name:"IP访问控制",prefixIcon:"vxe-icon-lock"},{code:"userAgentAccessControl",name:"User-Agent访问控制",prefixIcon:"vxe-icon-user"},{code:"apiAccessControl",name:"API访问控制",prefixIcon:"vxe-icon-link"},{code:"domainAccessControl",name:"域名访问控制",prefixIcon:()=>j(ne,{size:12},{default:()=>j(ut)})},{code:"corsConfig",name:"跨域配置",prefixIcon:"vxe-icon-link"},{code:"authConfig",name:"认证配置",prefixIcon:"vxe-icon-setting"},{code:"rateLimitConfig",name:"限流配置",prefixIcon:"vxe-icon-setting"}]},{code:"logConfig",name:"日志配置",prefixIcon:"vxe-icon-setting"},{code:"reload",name:"网关重载",prefixIcon:"vxe-icon-refresh"}]},height:"100%"},h=()=>{s.value=void 0},F=n=>{s.value?Object.assign(s.value,n):s.value=n},x=n=>{d.value=n},N=()=>{d.value=[]},O=n=>{d.value.unshift(n)},T=(n,m,g)=>{const I=d.value.findIndex(k=>k.gatewayInstanceId===n&&k.tenantId===m);I!==-1&&Object.assign(d.value[I],g)},D=(n,m)=>{const g=d.value.findIndex(I=>I.gatewayInstanceId===n&&I.tenantId===m);g!==-1&&d.value.splice(g,1)};return{moduleId:A,loading:f,instanceList:d,pageInfo:s,searchFormConfig:r,instanceFormConfig:C,logConfigFormConfig:v,gridConfig:w,resetPagination:h,updatePagination:F,setInstanceList:x,clearInstanceList:N,addInstanceToList:O,updateInstanceInList:T,removeInstanceFromList:D,removeInstancesFromList:n=>{n.forEach(m=>{D(m.gatewayInstanceId,m.tenantId)})}}}function At(A){const f=Ce(),d=Se(),s=St(),{loading:r,instanceList:C,pageInfo:v,setInstanceList:w,updatePagination:h,addInstanceToList:F,updateInstanceInList:x,removeInstanceFromList:N,removeInstancesFromList:O}=s,T=async i=>{var u,o,V;r.value=!0;try{let P=i;!P&&((u=A==null?void 0:A.value)!=null&&u.getFormData)&&(P=A.value.getFormData()||{});const J={...P?Object.fromEntries(Object.entries(P).filter(([,c])=>c!==""&&c!==null&&c!==void 0)):{},...De((o=v.value)==null?void 0:o.pageIndex,(V=v.value)==null?void 0:V.pageSize)},y=await et(J);if(y.oK){if(y.bizData){const c=JSON.parse(y.bizData),q=Array.isArray(c)?c:[];w(q)}if(y.pageQueryData){const c=JSON.parse(y.pageQueryData);h(c)}}else f.error(y.errMsg||"查询实例列表失败")}catch{f.error("加载实例列表失败")}finally{r.value=!1}};return{model:s,loadInstances:T,handleSearch:async i=>{await T(i)},handleReset:async()=>{s.resetPagination(),await T()},handlePageChange:async({currentPage:i,pageSize:u})=>{h({pageIndex:i,pageSize:u}),await T()},handleRefresh:async()=>{await T()},addInstance:async i=>{r.value=!0;try{const u={...i,tlsVersion:Array.isArray(i.tlsVersion)?i.tlsVersion.join(","):i.tlsVersion};delete u.logConfig;const o=await Ze(u);if(K(o)){const V=L(o,"网关实例创建成功");if(f.success(V),o.bizData){const P=JSON.parse(o.bizData);F(P)}else await T();return!0}else{const V=L(o,"新增实例失败");return f.error(V),!1}}catch{return f.error("新增实例失败"),!1}finally{r.value=!1}},editInstance:async i=>{r.value=!0;try{const u={...i,tlsVersion:Array.isArray(i.tlsVersion)?i.tlsVersion.join(","):i.tlsVersion};delete u.logConfig;const o=await Xe(u);if(K(o)){const V=L(o,"网关实例更新成功");if(f.success(V),o.bizData){const P=JSON.parse(o.bizData);x(P.gatewayInstanceId,P.tenantId,P)}else{const P=C.value.find(z=>z.gatewayInstanceId===i.gatewayInstanceId);P&&x(i.gatewayInstanceId,P.tenantId,u)}return!0}else{const V=L(o,"编辑实例失败");return f.error(V),!1}}catch{return f.error("编辑实例失败"),!1}finally{r.value=!1}},deleteInstance:async i=>{if(!await d.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除实例 "${i.instanceName}" 吗？`,icon:pt,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;r.value=!0;try{const o=await Qe(i.gatewayInstanceId,i.tenantId);if(K(o)){const V=L(o,"删除实例成功");return f.success(V),N(i.gatewayInstanceId,i.tenantId),C.value.length===0&&v.value&&v.value.pageIndex>1&&(h({pageIndex:v.value.pageIndex-1}),await T()),!0}else{const V=L(o,"删除实例失败");return f.error(V),!1}}catch{return f.error("删除实例失败"),!1}finally{r.value=!1}},startInstance:async i=>{r.value=!0;try{const u=await qe(i.gatewayInstanceId,i.tenantId);if(K(u)){const o=L(u,"实例启动成功");return f.success(o),x(i.gatewayInstanceId,i.tenantId,{healthStatus:"Y"}),!0}else{const o=L(u,"启动失败");return f.error(o),!1}}catch{return f.error("启动失败"),!1}finally{r.value=!1}},stopInstance:async i=>{r.value=!0;try{const u=await We(i.gatewayInstanceId,i.tenantId);if(K(u)){const o=L(u,"实例停止成功");return f.success(o),x(i.gatewayInstanceId,i.tenantId,{healthStatus:"N"}),!0}else{const o=L(u,"停止失败");return f.error(o),!1}}catch{return f.error("停止失败"),!1}finally{r.value=!1}},reloadInstance:async i=>{r.value=!0;try{const u=await je(i.gatewayInstanceId,i.tenantId);if(K(u)){const o=L(u,"网关重载成功");return f.success(o),await T(),!0}else{const o=L(u,"网关重载失败");return f.error(o),!1}}catch{return f.error("网关重载失败"),!1}finally{r.value=!1}},getInstanceDetail:async(i,u)=>{try{const o=await Je(i,u);return K(o)?we(o,null):(f.error(L(o,"获取实例详情失败")),null)}catch{return f.error("获取实例详情失败"),null}}}}function kt(A,f){const d=Ce(),s=Se(),r=At(f),C=p(!1),v=p("create"),w=p(null),h=p(!1),F=p(!1),x=p(""),N=p(!1),O=p("edit"),T=p(null),D=p(!1),E=p(!1),n=p(""),m=async a=>{n.value=a.gatewayInstanceId,E.value=!0},g=p(!1),I=p(""),k=async a=>{I.value=a.gatewayInstanceId,g.value=!0},$=p(!1),G=p(""),R=async a=>{G.value=a.gatewayInstanceId,$.value=!0},_=p(!1),i=p(""),u=async a=>{i.value=a.gatewayInstanceId,_.value=!0},o=p(!1),V=p(""),P=async a=>{V.value=a.gatewayInstanceId,o.value=!0},z=p(!1),J=p(""),y=async a=>{J.value=a.gatewayInstanceId,z.value=!0},c=p(!1),q=p(""),se=async a=>{q.value=a.gatewayInstanceId,c.value=!0},ie=()=>{v.value="create",w.value=null,C.value=!0},X=async a=>{try{const e=await r.getInstanceDetail(a.gatewayInstanceId,a.tenantId);if(!e){d.error("获取实例详情失败");return}const l={...e};e.certContent?l.certFileList=[{id:"cert-file",name:e.certFilePath||"certificate.pem",content:e.certContent,status:"finished"}]:l.certFileList=[],e.keyContent?l.keyFileList=[{id:"key-file",name:e.keyFilePath||"private-key.pem",content:e.keyContent,status:"finished"}]:l.keyFileList=[],v.value="edit",w.value=l,C.value=!0}catch{d.error("获取实例详情失败")}},oe=()=>{C.value=!1,w.value=null},re=async a=>{try{const e=await r.getInstanceDetail(a.gatewayInstanceId,a.tenantId);if(!e){d.error("获取实例详情失败");return}const l={...e};e.certContent?l.certFileList=[{id:"cert-file",name:e.certFilePath||"certificate.pem",content:e.certContent,status:"finished"}]:l.certFileList=[],e.keyContent?l.keyFileList=[{id:"key-file",name:e.keyFilePath||"private-key.pem",content:e.keyContent,status:"finished"}]:l.keyFileList=[],v.value="view",w.value=l,C.value=!0}catch{d.error("获取实例详情失败")}},Ae=async a=>{await r.handleSearch(a)},ke=async a=>{if(a&&v.value!=="view"){h.value=!0;try{const e={...a};if(e.certFileList&&Array.isArray(e.certFileList)&&e.certFileList.length>0){const l=e.certFileList[0];l&&(l.content&&(e.certContent=l.content),l.name&&(e.certFilePath=l.name))}else v.value==="edit"&&w.value&&w.value.certFilePath&&!e.certFilePath&&(e.certFilePath=w.value.certFilePath);if(delete e.certFileList,e.keyFileList&&Array.isArray(e.keyFileList)&&e.keyFileList.length>0){const l=e.keyFileList[0];l&&(l.content&&(e.keyContent=l.content),l.name&&(e.keyFilePath=l.name))}else v.value==="edit"&&w.value&&w.value.keyFilePath&&!e.keyFilePath&&(e.keyFilePath=w.value.keyFilePath);if(delete e.keyFileList,v.value==="create")await r.addInstance(e)&&oe();else if(v.value==="edit"){if(!w.value)return;await r.editInstance({...e,gatewayInstanceId:w.value.gatewayInstanceId})&&oe()}}finally{h.value=!1}}},Ve=async(a,e)=>{switch(a){case"add":ie();break;case"edit":{if(!(A!=null&&A.value)){d.warning("Grid 引用未设置");return}const l=A.value.getCurrentRecord();if(!l){d.warning("请先点击选择要编辑的实例");return}await X(l);break}case"delete":{if(!(A!=null&&A.value)){d.warning("Grid 引用未设置");return}const l=A.value.getCurrentRecord();if(!l){d.warning("请先点击选择要删除的实例");return}await r.deleteInstance(l);break}case"search":{await r.handleSearch(e);break}}},xe=a=>{x.value=a.gatewayInstanceId,F.value=!0},Te=a=>{if(!(!a.extProperty||typeof a.extProperty!="string"))try{const e=JSON.parse(a.extProperty||"{}");e&&typeof e=="object"&&Object.keys(e).forEach(l=>{const M=e[l];l==="alertStatusCodes"?Array.isArray(M)?a[`extProperty.${l}`]=M.map(Z=>String(Z)):typeof M=="string"&&(a[`extProperty.${l}`]=M.split(",").map(Z=>Z.trim()).filter(Boolean)):a[`extProperty.${l}`]=M})}catch{}},Pe=a=>{const e={};if(Object.keys(a).forEach(l=>{if(l.startsWith("extProperty.")){const M=l.substring(12);e[M]=a[l],delete a[l]}}),Object.keys(e).length===0)a.extProperty="";else try{a.extProperty=JSON.stringify(e)}catch{a.extProperty=""}},ce=async a=>{O.value="edit";try{if(!a.logConfigId){d.warning("该实例尚未配置日志，请先创建日志配置");return}const e=await at(a.logConfigId);if(K(e)){const l=we(e,{});if(l.sensitiveFields){if(typeof l.sensitiveFields=="string")try{l.sensitiveFields=JSON.parse(l.sensitiveFields)}catch{l.sensitiveFields=l.sensitiveFields.split(",").map(M=>M.trim()).filter(Boolean)}}else l.sensitiveFields=[];Te(l),T.value=l,N.value=!0}else{const l=L(e,"获取日志配置失败");d.error(l)}}catch(e){d.error("获取日志配置失败"),console.error("Error fetching log config:",e)}},de=()=>{N.value=!1,T.value=null},Fe=async a=>{if(a&&O.value!=="view"){D.value=!0;try{if(!a.logConfigId){d.error("日志配置信息不完整");return}const e={...a};e.sensitiveFields&&Array.isArray(e.sensitiveFields)&&(e.sensitiveFields=JSON.stringify(e.sensitiveFields)),Pe(e);const l=await tt(e);if(K(l)){const M=L(l,"日志配置保存成功");d.success(M),de()}else{const M=L(l,"保存日志配置失败");d.error(M)}}catch(e){d.error("保存日志配置失败"),console.error("Error saving log config:",e)}finally{D.value=!1}}},Le=()=>{F.value=!1,x.value=""},ue=async a=>{await s.warning({title:"确认启动",subtitle:"启动后将开始处理请求",content:`确定要启动实例"${a.instanceName}"吗？`,icon:mt,headerStyle:"gradient",positiveText:"确定启动",negativeText:"取消",width:500})&&r.startInstance(a)},pe=async a=>{await s.warning({title:"确认停止",subtitle:"停止后将无法处理请求",content:`确定要停止实例"${a.instanceName}"吗？`,icon:gt,headerStyle:"gradient",positiveText:"确定停止",negativeText:"取消",width:500})&&r.stopInstance(a)},fe=async a=>{await s.warning({title:"确认网关重载",subtitle:"重载将重新加载配置",content:`确定要对实例"${a.instanceName}"执行网关重载操作吗？`,icon:ft,headerStyle:"gradient",positiveText:"确定重载",negativeText:"取消",width:500})&&r.reloadInstance(a)};return{service:r,formDialogVisible:C,formDialogMode:v,currentEditInstance:w,submitting:h,openAddDialog:ie,openEditDialog:X,openViewDialog:re,handleFormSubmit:ke,configDialogVisible:F,currentConfigInstanceId:x,openConfigDialog:xe,closeConfigDialog:Le,logConfigDialogVisible:N,logConfigDialogMode:O,currentLogConfig:T,logConfigSubmitting:D,openLogConfigDialog:ce,closeLogConfigDialog:de,handleLogConfigSubmit:Fe,ipAccessControlDialogVisible:E,ipAccessControlSecurityConfigId:n,openIpAccessControlDialog:m,userAgentAccessControlDialogVisible:g,userAgentAccessControlSecurityConfigId:I,openUserAgentAccessControlDialog:k,apiAccessControlDialogVisible:$,apiAccessControlSecurityConfigId:G,openApiAccessControlDialog:R,domainAccessControlDialogVisible:_,domainAccessControlSecurityConfigId:i,openDomainAccessControlDialog:u,corsConfigDialogVisible:o,corsConfigGatewayInstanceId:V,openCorsConfigDialog:P,authConfigDialogVisible:z,authConfigGatewayInstanceId:J,openAuthConfigDialog:y,rateLimitConfigDialogVisible:c,rateLimitConfigGatewayInstanceId:q,openRateLimitConfigDialog:se,handleToolbarClick:Ve,handleMenuClick:async({code:a,row:e})=>{if(e)switch(a){case"view":await re(e);break;case"edit":await X(e);break;case"delete":await r.deleteInstance(e);break;case"start":ue(e);break;case"stop":pe(e);break;case"ipAccessControl":await m(e);break;case"userAgentAccessControl":await k(e);break;case"apiAccessControl":await R(e);break;case"domainAccessControl":await u(e);break;case"corsConfig":await P(e);break;case"authConfig":await y(e);break;case"rateLimitConfig":await se(e);break;case"logConfig":ce(e);break;case"reload":fe(e);break}},handleSearch:Ae,handleStartInstance:ue,handleStopInstance:pe,handleReloadInstance:fe}}const Vt=["id"],xt=ae({name:"GatewayInstanceManager",__name:"GatewayInstanceManager",setup(A){const f=p(),d=p(),{service:s,formDialogVisible:r,formDialogMode:C,currentEditInstance:v,submitting:w,handleFormSubmit:h,logConfigDialogVisible:F,logConfigDialogMode:x,currentLogConfig:N,logConfigSubmitting:O,handleLogConfigSubmit:T,ipAccessControlDialogVisible:D,ipAccessControlSecurityConfigId:E,userAgentAccessControlDialogVisible:n,userAgentAccessControlSecurityConfigId:m,apiAccessControlDialogVisible:g,apiAccessControlSecurityConfigId:I,domainAccessControlDialogVisible:k,domainAccessControlSecurityConfigId:$,corsConfigDialogVisible:G,corsConfigGatewayInstanceId:R,authConfigDialogVisible:_,authConfigGatewayInstanceId:i,rateLimitConfigDialogVisible:u,rateLimitConfigGatewayInstanceId:o,handleToolbarClick:V,handleMenuClick:P,handleSearch:z}=kt(d,f);return(J,y)=>(W(),Ie("div",{class:"gateway-instance-manager",id:t(s).model.moduleId},[b(t(ve),{direction:"vertical","default-size":"80px"},{1:S(()=>[b(he,Q({ref_key:"searchFormRef",ref:f,"module-id":t(s).model.moduleId},t(s).model.searchFormConfig,{onSearch:t(z),onToolbarClick:t(V)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:S(()=>[b(t(be),Q({ref_key:"gridRef",ref:d,"module-id":t(s).model.moduleId,data:t(s).model.instanceList,loading:t(s).model.loading},t(s).model.gridConfig,{onPageChange:t(s).handlePageChange,onMenuClick:t(P)}),{tlsEnabled:S(({row:c})=>[b(t(H),{type:c.tlsEnabled==="Y"?"success":"default",size:"small"},{default:S(()=>[B(U(c.tlsEnabled==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),healthStatus:S(({row:c})=>[b(t(H),{type:c.healthStatus==="Y"?"success":"error",size:"small"},{icon:S(()=>[b(t(ne),null,{default:S(()=>[c.healthStatus==="Y"?(W(),te(t(yt),{key:0})):(W(),te(t(bt),{key:1}))]),_:2},1024)]),default:S(()=>[B(" "+U(c.healthStatus==="Y"?"在线":"离线"),1)]),_:2},1032,["type"])]),activeFlag:S(({row:c})=>[b(t(H),{type:c.activeFlag==="Y"?"success":"default",size:"small"},{default:S(()=>[B(U(c.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),b(ge,{visible:t(r),"onUpdate:visible":y[0]||(y[0]=c=>Y(r)?r.value=c:null),mode:t(C),title:t(C)==="create"?"新增实例":t(C)==="edit"?"编辑实例":"查看实例详情",to:`#${t(s).model.moduleId}`,"form-fields":t(s).model.instanceFormConfig.fields,"form-tabs":t(s).model.instanceFormConfig.tabs,"initial-data":t(v)||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(w),onSubmit:t(h)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),b(ge,{visible:t(F),"onUpdate:visible":y[1]||(y[1]=c=>Y(F)?F.value=c:null),mode:t(x),title:t(x)==="edit"?"编辑日志配置":"查看日志配置",to:`#${t(s).model.moduleId}`,"form-tabs":t(s).model.logConfigFormConfig.tabs,"form-fields":t(s).model.logConfigFormConfig.fields,"initial-data":t(N)||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(O),onSubmit:t(T)},null,8,["visible","mode","title","to","form-tabs","form-fields","initial-data","confirm-loading","onSubmit"]),b(Ke,{visible:t(D),"onUpdate:visible":y[2]||(y[2]=c=>Y(D)?D.value=c:null),"module-id":"hub0020:ipAccessControl","security-config-id":t(E),title:"IP访问控制配置",width:1200,to:`#${t(s).model.moduleId}`},null,8,["visible","security-config-id","to"]),b(Ge,{visible:t(n),"onUpdate:visible":y[3]||(y[3]=c=>Y(n)?n.value=c:null),"module-id":"hub0020:userAgentAccessControl","security-config-id":t(m),title:"User-Agent访问控制配置",width:1200,to:`#${t(s).model.moduleId}`},null,8,["visible","security-config-id","to"]),b(_e,{visible:t(g),"onUpdate:visible":y[4]||(y[4]=c=>Y(g)?g.value=c:null),"module-id":"hub0020:apiAccessControl","security-config-id":t(I),title:"API访问控制配置",width:1200,to:`#${t(s).model.moduleId}`},null,8,["visible","security-config-id","to"]),b(ze,{visible:t(k),"onUpdate:visible":y[5]||(y[5]=c=>Y(k)?k.value=c:null),"module-id":"hub0020:domainAccessControl","security-config-id":t($),title:"域名访问控制配置",width:1200,to:`#${t(s).model.moduleId}`},null,8,["visible","security-config-id","to"]),b(He,{visible:t(G),"onUpdate:visible":y[6]||(y[6]=c=>Y(G)?G.value=c:null),"gateway-instance-id":t(R),width:800,to:`#${t(s).model.moduleId}`,"module-id":"hub0020:corsConfig"},null,8,["visible","gateway-instance-id","to"]),b(Be,{visible:t(_),"onUpdate:visible":y[7]||(y[7]=c=>Y(_)?_.value=c:null),"gateway-instance-id":t(i),width:800,to:`#${t(s).model.moduleId}`,"module-id":"hub0020:authConfig"},null,8,["visible","gateway-instance-id","to"]),b(Ue,{visible:t(u),"onUpdate:visible":y[8]||(y[8]=c=>Y(u)?u.value=c:null),"gateway-instance-id":t(o),width:800,to:`#${t(s).model.moduleId}`,"module-id":"hub0020:rateLimitConfig"},null,8,["visible","gateway-instance-id","to"])],8,Vt))}}),ua=le(xt,[["__scopeId","data-v-c8ba6cfe"]]);export{ua as default};

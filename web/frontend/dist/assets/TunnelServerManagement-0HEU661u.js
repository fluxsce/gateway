import{aI as A,aL as z,aJ as Q,d as j,ag as g,aS as Ce,bW as Pe,$ as we,g as J,c as ee,m as t,n as e,w as a,o as D,V as q,a as n,v as S,cO as ve,x as U,P as Ie,_ as te,W as oe,ac as re,S as Ne,a3 as V,I as C,a7 as se,b as ae,cT as me,r as P,f as $e,a0 as F,a1 as Z,dj as Ae,a2 as w,R as ge,h as he,E as M,cU as ne,J as $,ao as ze,q as ie,M as Ue,A as X,C as k,t as ue,aa as Me,B as Fe,al as Ee}from"./index-x2UIW6rt.js";import{P as fe}from"./PlayOutline-_yQt-ieg.js";import{S as be}from"./StopCircleOutline-CEO76SI5.js";import{A as Le}from"./AlertCircleOutline-0_n7Z19A.js";import{N as de}from"./Progress-qBcla2TB.js";import{L as Re,P as He}from"./PencilOutline-D_QOGCBS.js";import{a as G,_ as ce}from"./Grid-DN5dJWuI.js";import{R as Oe}from"./ReloadOutline-DeaP78U7.js";import{G as qe}from"./GlobeOutline-BrmbSoif.js";import{T as ye}from"./TrashOutline-BVFrNGkO.js";import{N as Be}from"./Popconfirm-bPhIDBu0.js";import{u as Ke}from"./usePagination-DTfRntL7.js";import{R as _e}from"./RefreshOutline-ClIKSIMl.js";import{A as Ye}from"./AddOutline-CGjDgn0r.js";import{_ as Se}from"./RadioGroup-DcXP1pnc.js";import{N as R}from"./InputNumber-D_OTG2Un.js";import{_ as Ve}from"./DataTable-BPEIkg8T.js";import{N as pe}from"./Switch-DwTaBB0v.js";import"./index-C9U1NGvg.js";const Ge=A("input-group",`
 display: inline-flex;
 width: 100%;
 flex-wrap: nowrap;
 vertical-align: bottom;
`,[z(">",[A("input",[z("&:not(:last-child)",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),z("&:not(:first-child)",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 margin-left: -1px!important;
 `)]),A("button",[z("&:not(:last-child)",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `,[Q("state-border, border",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `)]),z("&:not(:first-child)",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `,[Q("state-border, border",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `)])]),z("*",[z("&:not(:last-child)",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `,[z(">",[A("input",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),A("base-selection",[A("base-selection-label",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),A("base-selection-tags",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),Q("box-shadow, border, state-border",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `)])])]),z("&:not(:first-child)",`
 margin-left: -1px!important;
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `,[z(">",[A("input",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `),A("base-selection",[A("base-selection-label",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `),A("base-selection-tags",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `),Q("box-shadow, border, state-border",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `)])])])])])]),De={},Je=j({name:"InputGroup",props:De,setup(c){const{mergedClsPrefixRef:i}=Ce(c);return Pe("-input-group",Ge,i),{mergedClsPrefix:i}},render(){const{mergedClsPrefix:c}=this;return g("div",{class:`${c}-input-group`},this.$slots)}}),H=we("/gateway/hub0060"),We=async c=>H.post("/queryTunnelServers",c),je=async c=>H.post("/createTunnelServer",c),Qe=async c=>H.post("/updateTunnelServer",c),Te=async c=>H.post("/deleteTunnelServer",{tunnelServerId:c}),le=async(c,i,u)=>H.post("/updateTunnelServerStatus",{tunnelServerId:c,serverStatus:i,operation:u}),Xe=async c=>H.post("/testServerConnection",{tunnelServerId:c}),Ze=async()=>H.post("/getTunnelServerStats",{}),et=async()=>H.post("/generateAuthToken",{}),tt=async c=>le(c,"running","start"),rt=async c=>le(c,"stopped","stop"),st=async c=>le(c,"running","restart"),at=async c=>Promise.all(c.map(i=>Te(i))),lt={class:"tunnel-server-stats"},ot={class:"stat-content"},nt={class:"stat-icon total"},it={class:"stat-info"},ut={class:"stat-value"},dt={class:"stat-content"},ct={class:"stat-icon running"},pt={class:"stat-info"},vt={class:"stat-value"},mt={class:"stat-content"},gt={class:"stat-icon stopped"},ht={class:"stat-info"},ft={class:"stat-value"},bt={class:"stat-content"},yt={class:"stat-icon error"},_t={class:"stat-info"},St={class:"stat-value"},Tt={class:"card-header"},kt={class:"detail-content"},xt={class:"detail-item"},Ct={class:"detail-value primary"},Pt={class:"detail-progress"},wt={class:"progress-text"},It={class:"card-header"},Nt={class:"detail-content"},$t={class:"detail-item"},At={class:"detail-value success"},zt={class:"detail-progress"},Ut={class:"progress-text"},Mt=j({__name:"TunnelServerStats",props:{statistics:{}},setup(c){const i=c,u=J(()=>{const p=i.statistics.totalClients||0;return Math.min(Math.round(p/1e3*100),100)}),T=J(()=>{const p=i.statistics.totalConnections||0;return Math.min(Math.round(p/5e3*100),100)}),_=v=>v<50?"#52c41a":v<80?"#faad14":"#ff4d4f";return(v,p)=>(D(),ee("div",lt,[t(e(ce),{cols:4,"x-gap":12,"y-gap":12,responsive:"screen"},{default:a(()=>[t(e(G),null,{default:a(()=>[t(e(q),{class:"stat-card",hoverable:""},{default:a(()=>[n("div",ot,[n("div",nt,[t(e(S),{size:"24",component:e(ve)},null,8,["component"])]),n("div",it,[n("div",ut,U(v.statistics.totalServers||1),1),p[0]||(p[0]=n("div",{class:"stat-label"},"总服务器数",-1))])])]),_:1})]),_:1}),t(e(G),null,{default:a(()=>[t(e(q),{class:"stat-card",hoverable:""},{default:a(()=>[n("div",dt,[n("div",ct,[t(e(S),{size:"24",component:e(fe)},null,8,["component"])]),n("div",pt,[n("div",vt,U(v.statistics.runningServers||0),1),p[1]||(p[1]=n("div",{class:"stat-label"},"运行中",-1))])])]),_:1})]),_:1}),t(e(G),null,{default:a(()=>[t(e(q),{class:"stat-card",hoverable:""},{default:a(()=>[n("div",mt,[n("div",gt,[t(e(S),{size:"24",component:e(be)},null,8,["component"])]),n("div",ht,[n("div",ft,U(v.statistics.stoppedServers||0),1),p[2]||(p[2]=n("div",{class:"stat-label"},"已停止",-1))])])]),_:1})]),_:1}),t(e(G),null,{default:a(()=>[t(e(q),{class:"stat-card",hoverable:""},{default:a(()=>[n("div",bt,[n("div",yt,[t(e(S),{size:"24",component:e(Le)},null,8,["component"])]),n("div",_t,[n("div",St,U(v.statistics.errorServers||0),1),p[3]||(p[3]=n("div",{class:"stat-label"},"错误状态",-1))])])]),_:1})]),_:1})]),_:1}),t(e(ce),{cols:2,"x-gap":12,"y-gap":12,style:{"margin-top":"12px"},responsive:"screen"},{default:a(()=>[t(e(G),null,{default:a(()=>[t(e(q),{class:"detail-card",hoverable:""},{header:a(()=>[n("div",Tt,[t(e(S),{size:"20",component:e(Ie)},null,8,["component"]),p[4]||(p[4]=n("span",null,"客户端统计",-1))])]),default:a(()=>[n("div",kt,[n("div",xt,[p[5]||(p[5]=n("div",{class:"detail-label"},"总客户端数",-1)),n("div",Ct,U(v.statistics.totalClients||0),1)]),n("div",Pt,[t(e(de),{type:"line",percentage:u.value,"show-indicator":!1,height:8,color:_(u.value)},null,8,["percentage","color"]),n("div",wt,U(u.value)+"% 使用率 ",1)])])]),_:1})]),_:1}),t(e(G),null,{default:a(()=>[t(e(q),{class:"detail-card",hoverable:""},{header:a(()=>[n("div",It,[t(e(S),{size:"20",component:e(Re)},null,8,["component"]),p[6]||(p[6]=n("span",null,"连接统计",-1))])]),default:a(()=>[n("div",Nt,[n("div",$t,[p[7]||(p[7]=n("div",{class:"detail-label"},"总连接数",-1)),n("div",At,U(v.statistics.totalConnections||0),1)]),n("div",zt,[t(e(de),{type:"line",percentage:T.value,"show-indicator":!1,height:8,color:_(T.value)},null,8,["percentage","color"]),n("div",Ut,U(T.value)+"% 负载 ",1)])])]),_:1})]),_:1})]),_:1})]))}}),Ft=te(Mt,[["__scopeId","data-v-7095af72"]]),Et=c=>[{type:"selection"},{title:"服务器名称",key:"serverName",width:160,ellipsis:{tooltip:!0}},{title:"控制地址",key:"controlAddress",width:120,render:i=>`${i.controlAddress}:${i.controlPort}`},{title:"状态",key:"serverStatus",width:100,render:i=>{const T={running:{type:"success",text:"运行中"},stopped:{type:"warning",text:"已停止"},error:{type:"error",text:"错误"}}[i.serverStatus]||{type:"default",text:"未知"};return g(re,{type:T.type},{default:()=>T.text})}},{title:"客户端限制",key:"maxClients",width:100,render:i=>`${i.maxClients}`},{title:"认证",key:"tokenAuth",width:80,render:i=>g(re,{type:i.tokenAuth==="Y"?"success":"default",size:"small"},{default:()=>i.tokenAuth==="Y"?"启用":"禁用",icon:()=>g(S,{component:Ne})})},{title:"TLS",key:"tlsEnable",width:80,render:i=>g(re,{type:i.tlsEnable==="Y"?"success":"default",size:"small"},{default:()=>i.tlsEnable==="Y"?"启用":"禁用"})},{title:"心跳配置",key:"heartbeat",width:120,render:i=>`${i.heartbeatInterval}s / ${i.heartbeatTimeout}s`},{title:"启动时间",key:"startTime",width:150,render:i=>i.startTime?oe(i.startTime):"-"},{title:"创建时间",key:"addTime",width:150,render:i=>oe(i.addTime)},{title:"操作",key:"actions",width:280,fixed:"right",render:i=>g(se,{size:4},{default:()=>[i.serverStatus==="running"?g(V,{trigger:"hover"},{trigger:()=>g(C,{size:"small",type:"warning",secondary:!0,onClick:()=>c("stop",i)},{icon:()=>g(S,{component:be}),default:()=>"停止"}),default:()=>"停止服务器"}):g(V,{trigger:"hover"},{trigger:()=>g(C,{size:"small",type:"success",secondary:!0,onClick:()=>c("start",i)},{icon:()=>g(S,{component:fe}),default:()=>"启动"}),default:()=>"启动服务器"}),g(V,{trigger:"hover"},{trigger:()=>g(C,{size:"small",type:"info",secondary:!0,onClick:()=>c("restart",i)},{icon:()=>g(S,{component:Oe}),default:()=>"重启"}),default:()=>"重启服务器"}),g(V,{trigger:"hover"},{trigger:()=>g(C,{size:"small",type:"primary",secondary:!0,onClick:()=>c("test",i)},{icon:()=>g(S,{component:qe}),default:()=>"测试"}),default:()=>"测试连接"}),g(V,{trigger:"hover"},{trigger:()=>g(C,{size:"small",type:"primary",ghost:!0,onClick:()=>c("edit",i)},{icon:()=>g(S,{component:He})}),default:()=>"编辑服务器"}),g(Be,{onPositiveClick:()=>c("delete",i)},{trigger:()=>g(V,{trigger:"hover"},{trigger:()=>g(C,{size:"small",type:"error",ghost:!0},{icon:()=>g(S,{component:ye})}),default:()=>"删除服务器"}),default:()=>"确认删除这个隧道服务器吗？"})]})}],Lt=(c,i)=>{const u=ae();me();const T=P(!1),_=P([]),v=P(0),p=P([]),y=$e({tenantId:"default-tenant-001",serverName:"",serverStatus:void 0,controlAddress:"",controlPort:void 0,activeFlag:"Y",pageIndex:1,pageSize:20}),x=[{label:"运行中",value:"running"},{label:"已停止",value:"stopped"},{label:"错误",value:"error"}],E=J(()=>p.value.length>0),{naiveConfig:I,setTotal:l}=Ke({initialPage:1,initialPageSize:20,pageSizes:[10,20,50,100],showSizePicker:!0,showQuickJumper:!0,onPageChange:(m,o)=>{y.pageIndex=m,y.pageSize=o,f()},onPageSizeChange:(m,o)=>{y.pageIndex=m,y.pageSize=o,f()}}),f=async()=>{try{T.value=!0;const m=await We(y);if(F(m))try{const o=Z(m,[]);if(Array.isArray(o)){_.value=o;const h=Ae(m);v.value=h.itemCount,l(v.value)}else console.error("服务器返回的数据不是数组格式:",o),u.error("数据格式错误，请联系管理员"),_.value=[]}catch(o){console.error("解析服务器数据失败:",o),u.error("解析数据失败，请联系管理员"),_.value=[]}else{const o=w(m,"获取隧道服务器列表失败");u.error(o)}}catch(m){console.error("获取隧道服务器列表失败:",m),u.error("获取隧道服务器列表失败"),_.value=[]}finally{T.value=!1}},b=async m=>{try{const o=await Te(m);if(F(o)){const h=w(o,"隧道服务器删除成功");return u.success(h),await f(),!0}else{const h=w(o,"删除隧道服务器失败");return u.error(h),!1}}catch(o){return console.error("删除隧道服务器失败:",o),u.error("删除隧道服务器失败"),!1}},N=async()=>{if(p.value.length===0)return u.warning("请选择要删除的隧道服务器"),!1;try{return(await at(p.value)).every(h=>F(h))?(u.success(`成功删除 ${p.value.length} 个隧道服务器`),p.value=[],await f(),!0):(u.error("部分删除操作失败"),!1)}catch(m){return console.error("批量删除失败:",m),u.error("批量删除失败"),!1}},L=async m=>{try{const o=await tt(m);if(F(o)){const h=w(o,"启动隧道服务器成功");return u.success(h),await f(),!0}else{const h=w(o,"启动隧道服务器失败");return u.error(h),!1}}catch(o){return console.error("启动隧道服务器失败:",o),u.error("启动隧道服务器失败"),!1}},B=async m=>{try{const o=await rt(m);if(F(o)){const h=w(o,"停止隧道服务器成功");return u.success(h),await f(),!0}else{const h=w(o,"停止隧道服务器失败");return u.error(h),!1}}catch(o){return console.error("停止隧道服务器失败:",o),u.error("停止隧道服务器失败"),!1}},K=async m=>{try{const o=await st(m);if(F(o)){const h=w(o,"重启隧道服务器成功");return u.success(h),await f(),!0}else{const h=w(o,"重启隧道服务器失败");return u.error(h),!1}}catch(o){return console.error("重启隧道服务器失败:",o),u.error("重启隧道服务器失败"),!1}},Y=async m=>{try{const o=await Xe(m);if(F(o)){const h=Z(o,{}),ke=h.latency?` (延迟: ${h.latency}ms)`:"",xe=w(o,"连接测试成功");return u.success(xe+ke),!0}else{const h=w(o,"连接测试失败");return u.error(h),!1}}catch(o){return console.error("连接测试失败:",o),u.error("连接测试失败"),!1}},W=(m,o)=>{switch(m){case"start":L(o.tunnelServerId);break;case"stop":B(o.tunnelServerId);break;case"restart":K(o.tunnelServerId);break;case"test":Y(o.tunnelServerId);break;case"edit":c(o);break;case"delete":b(o.tunnelServerId);break}},O=J(()=>Et(W));return{loading:T,tunnelServers:_,total:v,selectedServerIds:p,queryParams:y,statusOptions:x,hasSelection:E,columns:O,tableConfig:{bordered:!1,striped:!0,size:"medium",scrollX:1200,rowKey:m=>m.tunnelServerId},naiveConfig:I,handleSearch:()=>{y.pageIndex=1,f()},handleReset:()=>{y.serverName="",y.serverStatus=void 0,y.controlAddress="",y.controlPort=void 0,y.pageIndex=1,y.pageSize=20,f()},handleCreate:()=>{i()},handleBatchDelete:N,initialize:()=>{f()},updateTotal:()=>{l(v.value)},getTunnelServers:f,deleteTunnelServer:b,startTunnelServer:L,stopTunnelServer:B,restartTunnelServer:K,testConnection:Y,setTotal:l}},Rt={class:"tunnel-server-table"},Ht={class:"table-header"},Ot={class:"search-section"},qt={class:"action-section"},Bt=j({__name:"TunnelServerTable",props:{onEdit:{type:Function},onCreate:{type:Function}},emits:["edit","create"],setup(c,{emit:i}){const u=i,T=me(),{loading:_,tunnelServers:v,total:p,selectedServerIds:y,queryParams:x,statusOptions:E,hasSelection:I,columns:l,naiveConfig:f,handleSearch:b,handleReset:N,initialize:L,updateTotal:B,handleBatchDelete:K}=Lt(O=>u("edit",O),()=>u("create"));ge(p,()=>{B()});const Y=()=>{u("create")},W=()=>{T.warning({title:"确认批量删除",content:`确认删除选中的 ${y.value.length} 个隧道服务器吗？`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:async()=>{await K()}})};return he(()=>{L()}),(O,s)=>(D(),ee("div",Rt,[n("div",Ht,[n("div",Ot,[t(e(se),{size:16},{default:a(()=>[t(e(M),{value:e(x).serverName,"onUpdate:value":s[0]||(s[0]=r=>e(x).serverName=r),placeholder:"搜索服务器名称",clearable:"",style:{width:"200px"}},{prefix:a(()=>[t(e(S),{component:e(ne)},null,8,["component"])]),_:1},8,["value"]),t(e(Se),{value:e(x).serverStatus,"onUpdate:value":s[1]||(s[1]=r=>e(x).serverStatus=r),placeholder:"服务器状态",clearable:"",style:{width:"150px"},options:e(E)},null,8,["value","options"]),t(e(M),{value:e(x).controlAddress,"onUpdate:value":s[2]||(s[2]=r=>e(x).controlAddress=r),placeholder:"控制地址",clearable:"",style:{width:"150px"}},null,8,["value"]),t(e(R),{value:e(x).controlPort,"onUpdate:value":s[3]||(s[3]=r=>e(x).controlPort=r),placeholder:"控制端口",clearable:"",style:{width:"120px"},min:1,max:65535},null,8,["value"])]),_:1})]),n("div",qt,[t(e(se),{size:12},{default:a(()=>[t(e(C),{onClick:e(b),type:"primary"},{icon:a(()=>[t(e(S),{component:e(ne)},null,8,["component"])]),default:a(()=>[s[5]||(s[5]=$(" 搜索 "))]),_:1},8,["onClick"]),t(e(C),{onClick:e(N)},{icon:a(()=>[t(e(S),{component:e(_e)},null,8,["component"])]),default:a(()=>[s[6]||(s[6]=$(" 重置 "))]),_:1},8,["onClick"]),t(e(C),{onClick:Y,type:"primary"},{icon:a(()=>[t(e(S),{component:e(Ye)},null,8,["component"])]),default:a(()=>[s[7]||(s[7]=$(" 新增服务器 "))]),_:1}),t(e(C),{onClick:W,disabled:!e(I),type:"error",secondary:""},{icon:a(()=>[t(e(S),{component:e(ye)},null,8,["component"])]),default:a(()=>[s[8]||(s[8]=$(" 批量删除 "))]),_:1},8,["disabled"])]),_:1})])]),t(e(Ve),{columns:e(l),data:e(v),loading:e(_),pagination:e(f),"row-key":r=>r.tunnelServerId,"checked-row-keys":e(y),"onUpdate:checkedRowKeys":s[4]||(s[4]=r=>ze(y)?y.value=r:null),"scroll-x":1200,striped:"","flex-height":"",style:{height:"calc(100vh - 280px)"}},null,8,["columns","data","loading","pagination","row-key","checked-row-keys"])]))}}),Kt=te(Bt,[["__scopeId","data-v-3165bcd1"]]),Yt={class:"dialog-header"},Vt={class:"dialog-content"},Gt={class:"form-section"},Dt={class:"form-section"},Jt={class:"form-section"},Wt={class:"form-section"},jt={class:"dialog-actions"},Qt=j({__name:"TunnelServerDialog",props:{show:{type:Boolean,default:!1},editData:{default:null}},emits:["update:show","success"],setup(c,{emit:i}){const u=c,T=i,_=ae(),v=P(!1),p=[{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warning",value:"warn"},{label:"Error",value:"error"}],y=async()=>{try{const s=await et();if(F(s)){const r=Z(s,{token:""});return _.success("认证令牌生成成功"),r.token}else{const r=w(s,"生成认证令牌失败");return _.error(r),null}}catch(s){return console.error("生成认证令牌失败:",s),_.error("生成认证令牌失败"),null}},x=P(),E=J({get:()=>u.show,set:s=>T("update:show",s)}),I=J(()=>!!u.editData),l=P({serverName:"",serverDescription:"",controlAddress:"0.0.0.0",controlPort:7e3,dashboardPort:7500,vhostHttpPort:80,vhostHttpsPort:443,maxClients:1e3,tokenAuth:"Y",authToken:"",tlsEnable:"N",tlsCertFile:"",tlsKeyFile:"",heartbeatInterval:30,heartbeatTimeout:90,logLevel:"info",maxPortsPerClient:10,allowPorts:"",noteText:""}),f=P(!0),b=P(!1),N={serverName:[{required:!0,message:"请输入服务器名称",trigger:"blur"},{min:2,max:100,message:"服务器名称长度应在2-100字符之间",trigger:"blur"}],controlAddress:[{required:!0,message:"请输入控制地址",trigger:"blur"}],controlPort:[{required:!0,type:"number",message:"请输入控制端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围应在1-65535之间",trigger:"blur"}],maxClients:[{required:!0,type:"number",message:"请输入最大客户端数",trigger:"blur"},{type:"number",min:1,max:1e4,message:"最大客户端数应在1-10000之间",trigger:"blur"}],heartbeatInterval:[{required:!0,type:"number",message:"请输入心跳间隔",trigger:"blur"},{type:"number",min:10,max:300,message:"心跳间隔应在10-300秒之间",trigger:"blur"}],heartbeatTimeout:[{required:!0,type:"number",message:"请输入心跳超时",trigger:"blur"},{type:"number",min:30,max:600,message:"心跳超时应在30-600秒之间",trigger:"blur"}],authToken:[{required:!0,message:"启用Token认证时必须提供认证Token",trigger:"blur",validator:(s,r)=>f.value&&!r?new Error("启用Token认证时必须提供认证Token"):!0}],tlsCertFile:[{required:!0,message:"启用TLS时必须提供证书文件路径",trigger:"blur",validator:(s,r)=>b.value&&!r?new Error("启用TLS时必须提供证书文件路径"):!0}],tlsKeyFile:[{required:!0,message:"启用TLS时必须提供私钥文件路径",trigger:"blur",validator:(s,r)=>b.value&&!r?new Error("启用TLS时必须提供私钥文件路径"):!0}]},L=()=>{l.value={serverName:"",serverDescription:"",controlAddress:"0.0.0.0",controlPort:7e3,dashboardPort:7500,vhostHttpPort:80,vhostHttpsPort:443,maxClients:1e3,tokenAuth:"Y",authToken:"",tlsEnable:"N",tlsCertFile:"",tlsKeyFile:"",heartbeatInterval:30,heartbeatTimeout:90,logLevel:"info",maxPortsPerClient:10,allowPorts:"",noteText:""},f.value=!0,b.value=!1};ge(()=>u.editData,s=>{try{s?(l.value={serverName:s.serverName||"",serverDescription:s.serverDescription||"",controlAddress:s.controlAddress||"",controlPort:s.controlPort||7e3,dashboardPort:s.dashboardPort||7500,vhostHttpPort:s.vhostHttpPort||80,vhostHttpsPort:s.vhostHttpsPort||443,maxClients:s.maxClients||100,tokenAuth:s.tokenAuth||"N",authToken:s.authToken||"",tlsEnable:s.tlsEnable||"N",tlsCertFile:s.tlsCertFile||"",tlsKeyFile:s.tlsKeyFile||"",heartbeatInterval:s.heartbeatInterval||30,heartbeatTimeout:s.heartbeatTimeout||90,logLevel:s.logLevel||"info",maxPortsPerClient:s.maxPortsPerClient||0,allowPorts:s.allowPorts||"",noteText:s.noteText||""},f.value=s.tokenAuth==="Y",b.value=s.tlsEnable==="Y"):L()}catch(r){console.error("处理编辑数据时出错:",r),_.error("处理编辑数据时出错，请重试"),L()}},{immediate:!0});const B=s=>{l.value.tokenAuth=s?"Y":"N",s||(l.value.authToken="")},K=s=>{l.value.tlsEnable=s?"Y":"N",s||(l.value.tlsCertFile="",l.value.tlsKeyFile="")},Y=async()=>{const s=await y();s&&(l.value.authToken=s)},W=async()=>{var s;try{await((s=x.value)==null?void 0:s.validate()),v.value=!0;let r;if(I.value&&u.editData?r=await Qe({...l.value,tunnelServerId:u.editData.tunnelServerId}):r=await je(l.value),r&&F(r))_.success(I.value?"更新成功":"创建成功"),T("success"),O();else{const d=w(r,I.value?"更新失败":"创建失败");_.error(d)}}catch(r){console.error("表单提交失败:",r),_.error(I.value?"更新失败":"创建失败")}finally{v.value=!1}},O=()=>{var s;E.value=!1,(s=x.value)==null||s.restoreValidation()};return(s,r)=>(D(),ie(e(Ee),{show:E.value,"onUpdate:show":r[19]||(r[19]=d=>E.value=d),"mask-closable":!1,preset:"dialog",style:{width:"800px"}},{header:a(()=>[n("div",Yt,[t(e(S),{size:"20",color:"#2080f0"},{default:a(()=>[t(e(ve))]),_:1}),n("span",null,U(I.value?"编辑隧道服务器":"创建隧道服务器"),1)])]),action:a(()=>[n("div",jt,[t(e(C),{onClick:O},{default:a(()=>r[25]||(r[25]=[$("取消")])),_:1}),t(e(C),{type:"primary",loading:v.value,onClick:W},{default:a(()=>[$(U(I.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[n("div",Vt,[t(e(Fe),{ref_key:"formRef",ref:x,model:l.value,rules:N,"label-placement":"left","label-width":"120px","require-mark-placement":"right-hanging"},{default:a(()=>[t(e(Ue),{type:"line",animated:""},{default:a(()=>[t(e(X),{name:"basic",tab:"基础配置"},{default:a(()=>[n("div",Gt,[t(e(k),{label:"服务器名称",path:"serverName"},{default:a(()=>[t(e(M),{value:l.value.serverName,"onUpdate:value":r[0]||(r[0]=d=>l.value.serverName=d),placeholder:"请输入服务器名称",maxlength:"100","show-count":""},null,8,["value"])]),_:1}),t(e(k),{label:"服务器描述",path:"serverDescription"},{default:a(()=>[t(e(M),{value:l.value.serverDescription,"onUpdate:value":r[1]||(r[1]=d=>l.value.serverDescription=d),type:"textarea",placeholder:"请输入服务器描述",maxlength:"500","show-count":"",autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1}),t(e(k),{label:"控制地址",path:"controlAddress"},{default:a(()=>[t(e(M),{value:l.value.controlAddress,"onUpdate:value":r[2]||(r[2]=d=>l.value.controlAddress=d),placeholder:"请输入控制地址，如: 0.0.0.0"},null,8,["value"])]),_:1}),t(e(k),{label:"控制端口",path:"controlPort"},{default:a(()=>[t(e(R),{value:l.value.controlPort,"onUpdate:value":r[3]||(r[3]=d=>l.value.controlPort=d),placeholder:"请输入控制端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"管理面板端口",path:"dashboardPort"},{default:a(()=>[t(e(R),{value:l.value.dashboardPort,"onUpdate:value":r[4]||(r[4]=d=>l.value.dashboardPort=d),placeholder:"请输入管理面板端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1})])]),_:1}),t(e(X),{name:"network",tab:"网络配置"},{default:a(()=>[n("div",Dt,[t(e(k),{label:"HTTP端口",path:"vhostHttpPort"},{default:a(()=>[t(e(R),{value:l.value.vhostHttpPort,"onUpdate:value":r[5]||(r[5]=d=>l.value.vhostHttpPort=d),placeholder:"虚拟主机HTTP端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"HTTPS端口",path:"vhostHttpsPort"},{default:a(()=>[t(e(R),{value:l.value.vhostHttpsPort,"onUpdate:value":r[6]||(r[6]=d=>l.value.vhostHttpsPort=d),placeholder:"虚拟主机HTTPS端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"最大客户端数",path:"maxClients"},{default:a(()=>[t(e(R),{value:l.value.maxClients,"onUpdate:value":r[7]||(r[7]=d=>l.value.maxClients=d),placeholder:"最大客户端连接数",min:1,max:1e4,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"每客户端最大端口",path:"maxPortsPerClient"},{default:a(()=>[t(e(R),{value:l.value.maxPortsPerClient,"onUpdate:value":r[8]||(r[8]=d=>l.value.maxPortsPerClient=d),placeholder:"每个客户端最大端口数",min:1,max:100,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"允许的端口范围",path:"allowPorts"},{default:a(()=>[t(e(M),{value:l.value.allowPorts,"onUpdate:value":r[9]||(r[9]=d=>l.value.allowPorts=d),placeholder:"如: 10000-20000,30000-40000"},null,8,["value"])]),_:1})])]),_:1}),t(e(X),{name:"auth",tab:"认证配置"},{default:a(()=>[n("div",Jt,[t(e(k),{label:"启用Token认证",path:"tokenAuth"},{default:a(()=>[t(e(pe),{value:f.value,"onUpdate:value":[r[10]||(r[10]=d=>f.value=d),B]},{checked:a(()=>r[20]||(r[20]=[$("启用")])),unchecked:a(()=>r[21]||(r[21]=[$("禁用")])),_:1},8,["value"])]),_:1}),f.value?(D(),ie(e(k),{key:0,label:"认证Token",path:"authToken"},{default:a(()=>[t(e(Je),null,{default:a(()=>[t(e(M),{value:l.value.authToken,"onUpdate:value":r[11]||(r[11]=d=>l.value.authToken=d),placeholder:"请输入或生成认证Token",style:{flex:"1"}},null,8,["value"]),t(e(C),{type:"primary",ghost:"",onClick:Y},{default:a(()=>r[22]||(r[22]=[$(" 生成Token ")])),_:1})]),_:1})]),_:1})):ue("",!0),t(e(k),{label:"启用TLS",path:"tlsEnable"},{default:a(()=>[t(e(pe),{value:b.value,"onUpdate:value":[r[12]||(r[12]=d=>b.value=d),K]},{checked:a(()=>r[23]||(r[23]=[$("启用")])),unchecked:a(()=>r[24]||(r[24]=[$("禁用")])),_:1},8,["value"])]),_:1}),b.value?(D(),ee(Me,{key:1},[t(e(k),{label:"TLS证书文件",path:"tlsCertFile"},{default:a(()=>[t(e(M),{value:l.value.tlsCertFile,"onUpdate:value":r[13]||(r[13]=d=>l.value.tlsCertFile=d),placeholder:"请输入TLS证书文件路径"},null,8,["value"])]),_:1}),t(e(k),{label:"TLS私钥文件",path:"tlsKeyFile"},{default:a(()=>[t(e(M),{value:l.value.tlsKeyFile,"onUpdate:value":r[14]||(r[14]=d=>l.value.tlsKeyFile=d),placeholder:"请输入TLS私钥文件路径"},null,8,["value"])]),_:1})],64)):ue("",!0)])]),_:1}),t(e(X),{name:"advanced",tab:"高级配置"},{default:a(()=>[n("div",Wt,[t(e(k),{label:"心跳间隔(秒)",path:"heartbeatInterval"},{default:a(()=>[t(e(R),{value:l.value.heartbeatInterval,"onUpdate:value":r[15]||(r[15]=d=>l.value.heartbeatInterval=d),placeholder:"心跳间隔时间",min:10,max:300,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"心跳超时(秒)",path:"heartbeatTimeout"},{default:a(()=>[t(e(R),{value:l.value.heartbeatTimeout,"onUpdate:value":r[16]||(r[16]=d=>l.value.heartbeatTimeout=d),placeholder:"心跳超时时间",min:30,max:600,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(k),{label:"日志级别",path:"logLevel"},{default:a(()=>[t(e(Se),{value:l.value.logLevel,"onUpdate:value":r[17]||(r[17]=d=>l.value.logLevel=d),placeholder:"请选择日志级别",options:p},null,8,["value"])]),_:1}),t(e(k),{label:"备注信息",path:"noteText"},{default:a(()=>[t(e(M),{value:l.value.noteText,"onUpdate:value":r[18]||(r[18]=d=>l.value.noteText=d),type:"textarea",placeholder:"请输入备注信息",maxlength:"500","show-count":"",autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["show"]))}}),Xt=te(Qt,[["__scopeId","data-v-c4ce0256"]]),Zt={class:"tunnel-server-management"},er={class:"stats-section"},tr={class:"main-content"},rr={class:"table-header"},sr=j({__name:"TunnelServerManagement",setup(c){const i=ae(),u=P(null),T=P(!1),_=P({totalServers:0,runningServers:0,stoppedServers:0,errorServers:0,totalClients:0,totalConnections:0}),v=P(!1),p=P(null),y=async()=>{try{const b=await Ze();if(F(b)){const N=Z(b,{totalServers:0,runningServers:0,stoppedServers:0,errorServers:0,totalClients:0,totalConnections:0});_.value=N}}catch(b){console.error("获取统计信息失败:",b)}},x=()=>{p.value=null,v.value=!0},E=b=>{p.value=b,v.value=!0},I=()=>{p.value=null,v.value=!1,f()},l=async()=>{T.value=!0;try{if(await y(),u.value){const b=u.value;typeof b.initialize=="function"&&await b.initialize()}i.success("数据刷新成功")}finally{T.value=!1}},f=async()=>{await l()};return he(()=>{f()}),(b,N)=>(D(),ee("div",Zt,[n("div",er,[t(Ft,{statistics:_.value},null,8,["statistics"])]),n("div",tr,[t(e(q),{bordered:!1,class:"content-card"},{default:a(()=>[n("div",rr,[t(e(C),{onClick:l,loading:T.value},{icon:a(()=>[t(e(S),{component:e(_e)},null,8,["component"])]),default:a(()=>[N[1]||(N[1]=$(" 刷新 "))]),_:1},8,["loading"])]),t(Kt,{ref_key:"tableRef",ref:u,onCreate:x,onEdit:E},null,512)]),_:1})]),t(Xt,{show:v.value,"onUpdate:show":N[0]||(N[0]=L=>v.value=L),"edit-data":p.value,onSuccess:I},null,8,["show","edit-data"])]))}}),Pr=te(sr,[["__scopeId","data-v-477f129b"]]);export{Pr as default};

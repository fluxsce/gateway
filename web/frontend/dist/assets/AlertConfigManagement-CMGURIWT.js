import{G as V}from"./GDataFormModal-CVDITwbR.js";import{G as L,S as E}from"./SearchForm-YJ2LWOI7.js";import{G as Y}from"./GPane-MizfBz4X.js";import{d as D,m as q,r as g,a7 as G,av as O,g as W,w as r,e,o as I,f as x,b as t,F as _,G as S,E as H,z as J,A as K,B as j,_ as P,c as Q,cr as $,am as w,aO as U,K as z,t as B}from"./index-talhFt-3.js";import{N as X}from"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Ds-H5BDS.js";import{G as Z}from"./GModal-CCcCEJqk.js";import{G as ee}from"./GCodeMirror-D3ww0dQz.js";import{C as ae,t as te,u as le}from"./AlertChannelNameSelector.vue_vue_type_style_index_0_scoped_90f3078b_lang-BFQ7mLkq.js";import"./index-Do6tdfLc.js";import"./Select-B2cdGhy0.js";import"./DownloadOutline-BSXu5v1r.js";import"./Upload-CvnZ1nba.js";import"./download-C2161hUv.js";import"./DocumentOutline-BjVf7Dk_.js";import"./RefreshOutline-CA3DFaJQ.js";import"./ContractOutline-BiyZGpf6.js";import"./CloseOutline-Dpm_uP78.js";import"./useGDialog-DyYy8db0.js";import"./GDialog-CQwmJXZh.js";import"./index-DjonybgA.js";import"./EllipsisHorizontalOutline-CQvCckwd.js";import"./InputGroup-C4T1Hgnm.js";import"./AddOutline-_WyjpAxi.js";import"./TrashOutline-B0_nSqhO.js";const oe={class:"alert-test-modal",id:"alert-test-modal"},ne={class:"alert-test-modal__codemirror-wrapper"},ie=D({name:"AlertTestModal",__name:"AlertTestModal",props:{visible:{type:Boolean,default:!1},config:{default:null},to:{type:[String,Boolean],default:void 0}},emits:["update:visible","close","success"],setup(k,{emit:b}){const m=k,l=b,f=g(),c=q(),p=g(m.visible),n=g(m.config),v=g(!1),d=g({title:"告警渠道测试",content:`这是一条测试告警消息，用于验证告警渠道配置是否正确。

测试时间：${new Date().toLocaleString("zh-CN")}

您可以在此编辑测试消息内容，然后点击"发送测试"按钮进行测试。`}),T={title:[{required:!0,message:"请输入测试消息主题",trigger:["blur","input"]},{max:200,message:"主题长度不能超过200个字符",trigger:["blur","input"]}],content:[{required:!0,message:"请输入测试消息内容",trigger:["blur","change"]}]},y=G(()=>m.visible,a=>{p.value=a,a&&M()}),N=G(()=>m.config,a=>{n.value=a,a&&(d.value.content=`这是一条测试告警消息，用于验证告警渠道配置是否正确。

测试时间：${new Date().toLocaleString("zh-CN")}
渠道名称：${a.channelName}
渠道类型：${h(a.channelType)}

您可以在此编辑测试消息内容，然后点击"发送测试"按钮进行测试。`)});O(()=>{y(),N()});const h=a=>{if(!a)return"";const i=ae.find(s=>s.value===a);return(i==null?void 0:i.label)||a},M=()=>{var a;d.value={title:"告警渠道测试",content:`这是一条测试告警消息，用于验证告警渠道配置是否正确。

测试时间：${new Date().toLocaleString("zh-CN")}
${n.value?`渠道名称：${n.value.channelName}
渠道类型：${h(n.value.channelType)}
`:""}
您可以在此编辑测试消息内容，然后点击"发送测试"按钮进行测试。`},(a=f.value)==null||a.restoreValidation()},C=a=>{p.value=a,l("update:visible",a),a||l("close")},A=async()=>{var a,i;if(!((a=n.value)!=null&&a.channelName)){c.warning("渠道配置不存在");return}try{await((i=f.value)==null?void 0:i.validate())}catch{return}try{v.value=!0;const s=await te(n.value.channelName,d.value.title,d.value.content);if(J(s)){const o=K(s),R=(o==null?void 0:o.message)||"测试消息发送成功";c.success(R),l("success",o)}else c.error(j(s,"测试消息发送失败"))}catch(s){console.error("测试告警渠道失败:",s),c.error(s.message||"测试告警渠道失败")}finally{v.value=!1}},u=()=>{C(!1)};return(a,i)=>{var s;return I(),W(e(Z),{visible:p.value,title:"预警测试 - "+(((s=n.value)==null?void 0:s.channelName)||""),width:800,to:m.to,"show-footer":!0,"show-cancel":!0,"show-confirm":!0,"cancel-text":"取消","confirm-text":"发送测试","confirm-loading":v.value,"onUpdate:visible":C,onConfirm:A,onCancel:u},{default:r(()=>[x("div",oe,[t(e(H),{ref_key:"formRef",ref:f,model:d.value,rules:T,"label-placement":"left","label-width":"100","require-mark-placement":"right-hanging"},{default:r(()=>[t(e(_),{label:"渠道名称",path:"channelName"},{default:r(()=>{var o;return[t(e(S),{value:((o=n.value)==null?void 0:o.channelName)||"",disabled:"",placeholder:"渠道名称"},null,8,["value"])]}),_:1}),t(e(_),{label:"渠道类型",path:"channelType"},{default:r(()=>{var o;return[t(e(S),{value:h((o=n.value)==null?void 0:o.channelType),disabled:"",placeholder:"渠道类型"},null,8,["value"])]}),_:1}),t(e(_),{label:"测试主题",path:"title"},{default:r(()=>[t(e(S),{value:d.value.title,"onUpdate:value":i[0]||(i[0]=o=>d.value.title=o),placeholder:"请输入测试消息主题",clearable:""},null,8,["value"])]),_:1}),t(e(_),{label:"测试内容",path:"content"},{default:r(()=>[x("div",ne,[t(e(ee),{modelValue:d.value.content,"onUpdate:modelValue":i[1]||(i[1]=o=>d.value.content=o),language:"plaintext",height:300,"min-height":200,"max-height":500,"line-numbers":!0,"line-wrapping":!0,placeholder:"请输入测试消息内容"},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible","title","to","confirm-loading"])}}}),re=P(ie,[["__scopeId","data-v-34e0d344"]]),F="hub0080-alert-config",se=D({name:"AlertConfigManagement",__name:"AlertConfigManagement",setup(k){const b=g(),m=g(),{service:l,formDialogVisible:f,formDialogMode:c,currentEditConfig:p,testModalVisible:n,currentTestConfig:v,handleFormSubmit:d,handleToolbarClick:T,handleMenuClick:y,handleSearch:N,handlePageChange:h,handleToggleStatus:M,closeTestModal:C}=le(m,b);return(A,u)=>(I(),Q("div",{class:"alert-config-management",id:F},[t(e(Y),{direction:"vertical","no-resize":!0},{1:r(()=>[t(E,w({ref_key:"searchFormRef",ref:b,"module-id":e(l).model.moduleId},e(l).model.searchFormConfig,{onSearch:e(N),onToolbarClick:e(T)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:r(()=>[t(e(L),w({ref_key:"gridRef",ref:m,"module-id":e(l).model.moduleId,data:e(l).model.configList,loading:e(l).model.loading},e(l).model.gridConfig,{onPageChange:e(h),onMenuClick:u[0]||(u[0]=({code:a,row:i})=>e(y)({menu:{code:a},row:i}))}),{channelType:r(({row:a})=>[t(e(U),{type:e(l).model.getChannelTypeTagType(a.channelType),size:"small"},{default:r(()=>[z(B(e(l).model.getChannelTypeLabel(a.channelType)),1)]),_:2},1032,["type"])]),defaultFlag:r(({row:a})=>[t(e(U),{type:a.defaultFlag==="Y"?"success":"default",size:"small"},{default:r(()=>[z(B(a.defaultFlag==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),activeFlag:r(({row:a})=>[t(e(X),{value:a.activeFlag==="Y","onUpdate:value":()=>e(M)(a),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),t(V,{visible:e(f),"onUpdate:visible":u[1]||(u[1]=a=>$(f)?f.value=a:null),mode:e(c),title:e(c)==="create"?"新增告警渠道配置":e(c)==="edit"?"编辑告警渠道配置":"查看告警渠道配置详情",to:`#${F}`,"form-fields":e(l).model.formFields,"form-tabs":e(l).model.formTabs,"initial-data":e(p)||void 0,"auto-close-on-confirm":!1,"confirm-loading":e(l).model.loading.value,onSubmit:e(d)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),t(e(re),{visible:e(n),"onUpdate:visible":u[2]||(u[2]=a=>$(n)?n.value=a:null),config:e(v),to:`#${F}`,onClose:e(C)},null,8,["visible","config","to","onClose"])]))}}),Ue=P(se,[["__scopeId","data-v-74d4d1bb"]]);export{Ue as default};

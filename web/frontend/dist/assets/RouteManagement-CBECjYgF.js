import{c as he,b as ue,a as be,S as me,G as ke,f as $e}from"./SearchForm-B7rqpwYi.js";import{u as Se,G as ve}from"./GDataFormModal-B9PoaKcn.js";import{G as Ue}from"./GTree-Ba08fDYe.js";import{r as P,a2 as W,T as ne,m as Z,z as K,B as D,A as ee,cX as Ae,d as oe,P as te,af as re,h as se,o as z,w as O,g as L,e as A,f as t,a4 as ie,aG as B,K as $,t as q,ci as Q,_ as le,c as ce,cq as Ge,j as X,v as Ne,b as j,i as _e,J as de,G as Je,ch as Be,I as We,R as je,aI as Ie,bO as Ye,bL as Qe,n as Xe}from"./index-jHKRbIks.js";import"./GDialog.vue_vue_type_style_index_0_scoped_82fcf09e_lang-ipra4ei3.js";/* empty css                                                                    */import{d as xe,e as Ze,a as et,g as tt,q as at,b as it,c as ot,f as lt,h as nt,i as st,j as Fe,M as U,k as Ce,l as Me,m as rt,n as ct,o as Ve,p as Le,r as ut,s as dt,t as ft,u as pt}from"./types-Cr88g74z.js";import{A as Oe,T as Pe}from"./TrashOutline-DyDUTVAn.js";import{N as Re}from"./Switch-C69H-VEY.js";import{F as gt,C as ht}from"./FunnelOutline-CYYWsCDU.js";import{S as ge}from"./ServerOutline-KasG8iTq.js";import{R as ze}from"./RefreshOutline-BQY32ySA.js";import{I as bt,U as mt,A as vt,D as yt,C as Ct,a as wt,R as Tt}from"./RateLimitConfigFormModal-B3wJOI7i.js";import{a as It}from"./OptionsOutline-CAwLTA62.js";import{N as kt,a as St}from"./Checkbox-B91i8S1b.js";import{C as At}from"./CheckmarkCircleOutline-DulKWnqe.js";import{G as Nt}from"./GlobeOutline-BUAMRcmH.js";import{W as Ee}from"./WarningOutline-mxXhdHS1.js";import"./index-DR_R-bYe.js";import"./DatePicker-yujoZiwS.js";import"./Select-CGsj-ZtY.js";import"./Grid-qwIbHEjp.js";import"./InputNumber-BwbhDD7_.js";import"./Scrollbar-Cp6RabE0.js";import"./InformationCircleOutline-DNMSQWXj.js";import"./CopyOutline-ddQy1ejR.js";import"./download-C2161hUv.js";import"./CreateOutline-CGY5f7Sz.js";import"./prop-BjyUHhTu.js";import"./Alert-BaHRQFWE.js";const we=[{label:"请求头处理",value:"header",description:"添加、修改或删除HTTP请求头/响应头"},{label:"查询参数处理",value:"query-param",description:"处理URL查询参数"},{label:"请求体处理",value:"body",description:"处理和验证请求体内容"},{label:"前缀剥离",value:"strip",description:"移除请求路径中的指定前缀"},{label:"路径重写",value:"rewrite",description:"重写或转换请求路径"},{label:"HTTP方法控制",value:"method",description:"控制允许的HTTP方法"},{label:"Cookie处理",value:"cookie",description:"处理HTTP Cookie"},{label:"响应处理",value:"response",description:"处理后端响应"}],fe=[{label:"前置处理",value:"pre-routing",description:"在路由匹配前执行"},{label:"后置处理",value:"post-routing",description:"在路由匹配后执行"},{label:"响应前处理",value:"pre-response",description:"在响应返回前执行"}];fe.filter(y=>y.value==="pre-routing");const _t=[{label:"添加",value:"add",description:"添加新的请求头"},{label:"设置",value:"set",description:"设置请求头（替换现有值）"},{label:"移除",value:"remove",description:"移除指定请求头"},{label:"重命名",value:"rename",description:"重命名请求头"}],Ot=[{label:"添加",value:"add",description:"添加新的查询参数"},{label:"设置",value:"set",description:"设置查询参数（替换现有值）"},{label:"移除",value:"remove",description:"移除指定查询参数"},{label:"重命名",value:"rename",description:"重命名查询参数"}],Pt=[{label:"转换",value:"transform",description:"转换请求体格式"},{label:"验证",value:"validate",description:"验证请求体内容"},{label:"修改",value:"modify",description:"修改请求体字段"},{label:"过滤",value:"filter",description:"过滤请求体字段"}],Rt=[{label:"添加",value:"add",description:"添加新的Cookie"},{label:"移除",value:"remove",description:"移除指定Cookie"},{label:"修改",value:"modify",description:"修改Cookie值"},{label:"验证",value:"validate",description:"验证Cookie格式"},{label:"过滤",value:"filter",description:"过滤Cookie内容"}],xt=[{label:"允许模式",value:"allow",description:"只允许指定的HTTP方法"},{label:"拒绝模式",value:"deny",description:"拒绝指定的HTTP方法"}],Ft=[{label:"简单替换",value:"simple",description:"直接替换路径中的特定部分"},{label:"正则替换",value:"regex",description:"使用正则表达式匹配和替换路径"}],Mt=[{label:"添加响应头",value:"add_headers",description:"添加HTTP响应头"},{label:"修改响应体",value:"modify_body",description:"修改响应体内容"},{label:"设置状态码",value:"set_status",description:"设置HTTP状态码"},{label:"过滤响应头",value:"filter_headers",description:"过滤响应头内容"},{label:"转换响应体",value:"transform_body",description:"转换响应体格式"},{label:"验证响应",value:"validate_response",description:"验证响应数据"}],qe=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"],Vt=["application/json","application/xml","text/plain","text/html","application/x-www-form-urlencoded","multipart/form-data"];function Lt(){const y="hub0021-filter-config",C=P(!1),o=P([]),u=P(),h={fields:[{field:"filterName",label:"过滤器名称",type:"input",placeholder:"请输入过滤器名称",span:6,clearable:!0},{field:"filterType",label:"过滤器类型",type:"select",placeholder:"请选择过滤器类型",span:6,clearable:!0,options:[{label:"全部",value:""},...we.map(e=>({label:e.label,value:e.value}))]},{field:"filterAction",label:"执行时机",type:"select",placeholder:"请选择执行时机",span:6,clearable:!0,options:[{label:"全部",value:""},...fe.map(e=>({label:e.label,value:e.value}))]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[{key:"add",label:"新增过滤器",icon:Oe,type:"primary",tooltip:"新增过滤器配置"},{key:"delete",label:"删除",icon:Pe,type:"error",tooltip:"批量删除选中的过滤器配置"}],showSearchButton:!0,showResetButton:!0},r=e=>{const g=we.find(l=>l.value===e);return(g==null?void 0:g.label)||e},d=e=>({header:"primary","query-param":"info",body:"warning",strip:"success",rewrite:"success",method:"error",cookie:"default",response:"info"})[e]||"default",p=e=>{const g=fe.find(l=>l.value===e);return(g==null?void 0:g.label)||e},b=e=>({"pre-routing":"success","post-routing":"info","pre-response":"warning"})[e]||"default",R={columns:[{field:"filterConfigId",title:"过滤器配置ID",visible:!1,width:0},{field:"filterOrder",title:"执行顺序",align:"center",width:120,slots:{default:"filterOrder"}},{field:"filterName",title:"过滤器名称",align:"center",showOverflow:"tooltip",width:200},{field:"filterType",title:"类型",align:"center",width:140,slots:{default:"filterType"}},{field:"filterAction",title:"执行时机",align:"center",width:120,slots:{default:"filterAction"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"filterDesc",title:"描述",align:"center",showOverflow:"tooltip",width:200},{field:"addTime",title:"创建时间",align:"center",formatter:({row:e})=>ne(e.addTime),width:180},{field:"addWho",title:"创建人",align:"center",showOverflow:"tooltip",width:120},{field:"editTime",title:"修改时间",align:"center",formatter:({row:e})=>ne(e.editTime),width:180},{field:"editWho",title:"修改人",align:"center",showOverflow:"tooltip",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"toggle-status",name:"切换状态",prefixIcon:"vxe-icon-check"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function T(e){o.value=e}function x(e){C.value=e}function k(){u.value=void 0}function V(e){u.value?Object.assign(u.value,e):u.value=e}function _(e){o.value.push(e),o.value.sort((g,l)=>(g.filterOrder||0)-(l.filterOrder||0))}function w(e,g,l){const i=o.value.findIndex(c=>c.filterConfigId===e&&(!g||c.tenantId===g));i!==-1&&(Object.assign(o.value[i],l),o.value.sort((c,a)=>(c.filterOrder||0)-(a.filterOrder||0)))}function S(e){const g=o.value.findIndex(l=>l.filterConfigId===e);g>=0&&o.value.splice(g,1)}function M(e){o.value=o.value.filter(g=>!e.includes(g.filterConfigId))}const N=[{key:"basic",label:"基本信息"},{key:"other",label:"其他信息"}],n=[{field:"filterConfigId",label:"过滤器配置ID",type:"input",span:12,primary:!0,show:!1},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:12,show:!1},{field:"routeConfigId",label:"路由配置ID",type:"input",span:12,show:!1},{field:"filterName",label:"过滤器名称",type:"input",placeholder:"请输入过滤器名称",span:12,required:!0,rules:[{required:!0,message:"请输入过滤器名称",trigger:["blur","input"]},{max:100,message:"过滤器名称不能超过100个字符",trigger:["blur","input"]}]},{field:"filterType",label:"过滤器类型",type:"select",placeholder:"请选择过滤器类型",span:12,tabKey:"basic",required:!0,defaultValue:"header",options:we.map(e=>({label:e.label,value:e.value})),rules:[{required:!0,message:"请选择过滤器类型",trigger:["blur","change"]}]},{field:"filterAction",label:"执行时机",type:"select",placeholder:"请选择执行时机",span:12,tabKey:"basic",required:!0,defaultValue:"pre-routing",show:!1,options:fe.map(e=>({label:e.label,value:e.value})),rules:[{required:!0,message:"请选择执行时机",trigger:["blur","change"]}]},{field:"filterOrder",label:"执行顺序",type:"number",placeholder:"数值越小优先级越高",span:12,tabKey:"basic",required:!0,defaultValue:1,props:{min:1,precision:0},rules:[{required:!0,type:"number",message:"请输入执行顺序",trigger:["blur","change"],validator:(e,g)=>{if(g==null||g==="")return new Error("请输入执行顺序");const l=typeof g=="number"?g:Number(g);return isNaN(l)?new Error("执行顺序必须是数字"):l<1?new Error("执行顺序必须大于等于1"):Number.isInteger(l)?!0:new Error("执行顺序必须是整数")}}]},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"filterDesc",label:"描述",type:"input",placeholder:"请输入过滤器描述",span:24,tabKey:"basic",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"filterConfigFieldset",label:"过滤器配置",type:"fieldset",span:24,tabKey:"basic",children:[{field:"config.headerConfig.modifierType",label:"修改类型",type:"select",placeholder:"请选择修改类型",span:12,show:e=>e.filterType==="header",options:_t.map(e=>({label:e.label,value:e.value}))},{field:"config.headerConfig.isRequestHeader",label:"作用范围",type:"custom",span:12,show:e=>e.filterType==="header",defaultValue:!0,render:e=>W(Re,{value:e["config.headerConfig.isRequestHeader"]??!0,checkedValue:!0,uncheckedValue:!1,"onUpdate:value":g=>{e["config.headerConfig.isRequestHeader"]=g}},{checked:()=>"请求头",unchecked:()=>"响应头"})},{field:"config.headerConfig.headerName",label:"Header名称",type:"input",placeholder:"请输入Header名称",span:12,show:e=>e.filterType==="header"},{field:"config.headerConfig.headerValue",label:"Header值",type:"input",placeholder:"请输入Header值",span:12,show:e=>e.filterType==="header"&&e["config.headerConfig.modifierType"]!=="remove"},{field:"config.headerConfig.targetHeaderName",label:"目标Header名称",type:"input",placeholder:"请输入重命名后的Header名称",span:12,show:e=>e.filterType==="header"&&e["config.headerConfig.modifierType"]==="rename"},{field:"config.queryParamConfig.modifierType",label:"修改类型",type:"select",placeholder:"请选择修改类型",span:12,show:e=>e.filterType==="query-param",options:Ot.map(e=>({label:e.label,value:e.value}))},{field:"config.queryParamConfig.paramName",label:"参数名称",type:"input",placeholder:"请输入参数名称",span:12,show:e=>e.filterType==="query-param"},{field:"config.queryParamConfig.paramValue",label:"参数值",type:"input",placeholder:"请输入参数值",span:12,show:e=>e.filterType==="query-param"&&e["config.queryParamConfig.modifierType"]!=="remove"},{field:"config.queryParamConfig.targetParamName",label:"目标参数名称",type:"input",placeholder:"请输入重命名后的参数名称",span:12,show:e=>e.filterType==="query-param"&&e["config.queryParamConfig.modifierType"]==="rename"},{field:"config.stripConfig.prefix",label:"要剥离的前缀",type:"input",placeholder:"请输入要剥离的路径前缀，如：/api/v1",span:24,show:e=>e.filterType==="strip"},{field:"config.rewriteConfig.mode",label:"重写模式",type:"select",placeholder:"请选择重写模式",span:12,show:e=>e.filterType==="rewrite",options:Ft.map(e=>({label:e.label,value:e.value}))},{field:"config.rewriteConfig.from",label:"查找内容",type:"input",placeholder:"请输入要替换的字符串或正则表达式",span:12,show:e=>e.filterType==="rewrite"},{field:"config.rewriteConfig.to",label:"替换内容",type:"input",placeholder:"请输入替换后的内容",span:12,show:e=>e.filterType==="rewrite"},{field:"config.methodConfig.mode",label:"过滤模式",type:"select",placeholder:"请选择过滤模式",span:12,show:e=>e.filterType==="method",options:xt.map(e=>({label:e.label,value:e.value}))},{field:"config.methodConfig.allowedMethods",label:"允许的方法",type:"select",placeholder:"请选择允许的HTTP方法",span:12,show:e=>e.filterType==="method"&&e["config.methodConfig.mode"]==="allow",props:{multiple:!0},options:qe.map(e=>({label:e,value:e}))},{field:"config.methodConfig.deniedMethods",label:"拒绝的方法",type:"select",placeholder:"请选择拒绝的HTTP方法",span:12,show:e=>e.filterType==="method"&&e["config.methodConfig.mode"]==="deny",props:{multiple:!0},options:qe.map(e=>({label:e,value:e}))},{field:"config.methodConfig.rejectStatusCode",label:"拒绝时状态码",type:"number",placeholder:"默认405",span:12,show:e=>e.filterType==="method",defaultValue:405,props:{min:400,max:599}},{field:"config.methodConfig.rejectMessage",label:"拒绝时消息",type:"input",placeholder:"请输入拒绝时的错误消息",span:12,show:e=>e.filterType==="method",defaultValue:"Method Not Allowed"},{field:"config.methodConfig.caseSensitive",label:"区分大小写",type:"switch",span:12,show:e=>e.filterType==="method",defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.bodyConfig.modifierType",label:"修改类型",type:"select",placeholder:"请选择修改类型",span:12,show:e=>e.filterType==="body",options:Pt.map(e=>({label:e.label,value:e.value}))},{field:"config.bodyConfig.operation",label:"操作描述",type:"input",placeholder:"请输入操作描述",span:12,show:e=>e.filterType==="body"},{field:"config.bodyConfig.allowedContentTypes",label:"允许的内容类型",type:"select",placeholder:"请选择允许的内容类型",span:12,show:e=>e.filterType==="body",props:{multiple:!0},options:Vt.map(e=>({label:e,value:e}))},{field:"config.bodyConfig.maxBodySize",label:"最大请求体大小(字节)",type:"number",placeholder:"请输入最大请求体大小",span:12,show:e=>e.filterType==="body",props:{min:0}},{field:"config.bodyConfig.filterConfigJson",label:"过滤器配置(JSON)",type:"input",placeholder:"请输入JSON格式的过滤器配置",span:24,show:e=>e.filterType==="body",props:{type:"textarea",rows:4}},{field:"config.cookieConfig.operation",label:"操作类型",type:"select",placeholder:"请选择操作类型",span:12,show:e=>e.filterType==="cookie",options:Rt.map(e=>({label:e.label,value:e.value}))},{field:"config.cookieConfig.applyToResponse",label:"应用到响应",type:"switch",span:12,show:e=>e.filterType==="cookie",defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.cookieConfig.cookieName",label:"Cookie名称",type:"input",placeholder:"请输入Cookie名称",span:12,show:e=>e.filterType==="cookie"},{field:"config.cookieConfig.cookieValue",label:"Cookie值",type:"input",placeholder:"请输入Cookie值",span:12,show:e=>e.filterType==="cookie"&&e["config.cookieConfig.operation"]!=="remove"},{field:"config.cookieConfig.cookieAttributes.domain",label:"域名",type:"input",placeholder:"如：.example.com",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify")},{field:"config.cookieConfig.cookieAttributes.path",label:"路径",type:"input",placeholder:"如：/",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify")},{field:"config.cookieConfig.cookieAttributes.maxAge",label:"最大年龄(秒)",type:"number",placeholder:"如：3600",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),props:{min:0}},{field:"config.cookieConfig.cookieAttributes.secure",label:"安全传输",type:"switch",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.cookieConfig.cookieAttributes.httpOnly",label:"仅HTTP",type:"switch",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.cookieConfig.cookieAttributes.sameSite",label:"SameSite",type:"select",placeholder:"请选择SameSite属性",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),options:[{label:"Strict",value:"Strict"},{label:"Lax",value:"Lax"},{label:"None",value:"None"}]},{field:"config.responseConfig.operation",label:"操作类型",type:"select",placeholder:"请选择操作类型",span:12,show:e=>e.filterType==="response",options:Mt.map(e=>({label:e.label,value:e.value}))},{field:"config.responseConfig.setInRequestPhase",label:"请求阶段设置",type:"switch",span:12,show:e=>e.filterType==="response",defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.responseConfig.filterConfigJson",label:"过滤器配置(JSON)",type:"input",placeholder:"请输入JSON格式的过滤器配置",span:24,show:e=>e.filterType==="response",props:{type:"textarea",rows:4}},{field:"config.responseConfig.conditionsJson",label:"条件配置(JSON)",type:"input",placeholder:"请输入JSON格式的条件配置",span:24,show:e=>e.filterType==="response",props:{type:"textarea",rows:3}}]},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}];return{moduleId:y,loading:C,filterList:o,pageInfo:u,searchFormConfig:h,gridConfig:R,formFields:n,formTabs:N,getFilterTypeLabel:r,getFilterTypeTagType:d,getFilterActionLabel:p,getFilterActionTagType:b,setFilterList:T,setLoading:x,resetPagination:k,updatePagination:V,addFilterToList:_,updateFilterInList:w,removeFilterFromList:S,removeFiltersFromList:M}}function Et(y,C,o){const u=Z(),h=()=>typeof y=="string"?y:y==null?void 0:y.value,r=()=>typeof C=="string"?C:C==null?void 0:C.value,d=Lt(),{addFilterToList:p,updateFilterInList:b,removeFilterFromList:R,removeFiltersFromList:T}=d,x=async N=>{var n,e,g;try{d.setLoading(!0);let l=N;!l&&((n=o==null?void 0:o.value)!=null&&n.getFormData)&&(l=o.value.getFormData()||{});const i=l?Object.fromEntries(Object.entries(l).filter(([,m])=>m!==""&&m!==null&&m!==void 0)):{},c=h(),a=r(),s={...i,...c?{gatewayInstanceId:c}:{},...a?{routeConfigId:a}:{},...he((e=d.pageInfo.value)==null?void 0:e.pageIndex,(g=d.pageInfo.value)==null?void 0:g.pageSize)},f=await at(s);if(K(f)){const m=ee(f,[])||[];Array.isArray(m)&&m.length>0&&m.sort((J,Y)=>(J.filterOrder||0)-(Y.filterOrder||0)),d.setFilterList(m);const G=Ae(f);G&&Object.keys(G).length>0?d.updatePagination(G):d.resetPagination()}else u.error(D(f,"加载过滤器列表失败")),d.setFilterList([]),d.resetPagination()}catch(l){console.error("加载过滤器列表失败:",l),u.error(l.message||"加载过滤器列表失败"),d.setFilterList([]),d.resetPagination()}finally{d.setLoading(!1)}},k=async N=>{try{const n=await tt(N);return K(n)?ee(n):(u.error(D(n,"获取过滤器详情失败")),null)}catch(n){return console.error("获取过滤器详情失败:",n),u.error(n.message||"获取过滤器详情失败"),null}},V=async N=>{try{d.setLoading(!0);const n={...N,tenantId:"default",gatewayInstanceId:h(),routeConfigId:r()},e=await et(n);if(K(e)){u.success("新增过滤器成功");const g=ee(e,null);return g?p(g):await x(),!0}else return u.error(D(e,"新增过滤器失败")),!1}catch(n){return console.error("新增过滤器失败:",n),u.error(n.message||"新增过滤器失败"),!1}finally{d.setLoading(!1)}},_=async(N,n)=>{try{d.setLoading(!0);const e={...n,filterConfigId:N,tenantId:"default"},g=await Ze(e);if(K(g)){u.success("编辑过滤器成功");const l=ee(g,null);return l?b(l.filterConfigId,l.tenantId,l):await x(),!0}else return u.error(D(g,"编辑过滤器失败")),!1}catch(e){return console.error("编辑过滤器失败:",e),u.error(e.message||"编辑过滤器失败"),!1}finally{d.setLoading(!1)}};return{model:d,loadFilterList:x,getFilterDetail:k,addFilter:V,editFilter:_,deleteFilter:async N=>{try{d.setLoading(!0);const n=await xe(N);return K(n)?(u.success("删除过滤器成功"),R(N),d.filterList.value.length===0&&d.pageInfo.value&&d.pageInfo.value.pageIndex>1&&(d.updatePagination({pageIndex:d.pageInfo.value.pageIndex-1}),await x()),!0):(u.error(D(n,"删除过滤器失败")),!1)}catch(n){return console.error("删除过滤器失败:",n),u.error(n.message||"删除过滤器失败"),!1}finally{d.setLoading(!1)}},deleteFilters:async N=>{try{d.setLoading(!0);const e=(await Promise.all(N.map(g=>xe(g)))).filter(g=>K(g)).length;return e===N.length?(u.success(`成功删除 ${e} 个过滤器`),T(N),d.filterList.value.length===0&&d.pageInfo.value&&d.pageInfo.value.pageIndex>1&&(d.updatePagination({pageIndex:d.pageInfo.value.pageIndex-1}),await x()),!0):(u.warning(`部分删除成功：${e}/${N.length}`),await x(),!1)}catch(n){return console.error("批量删除过滤器失败:",n),u.error(n.message||"批量删除过滤器失败"),!1}finally{d.setLoading(!1)}},toggleFilterStatus:async N=>{const n=N.activeFlag==="Y"?"N":"Y";return await _(N.filterConfigId,{...N,activeFlag:n})}}}function qt(y,C,o,u){const h=Z(),r=Se(),d=Et(C,o,u),p=P(!1),b=P("create"),R=P(null),T=(a=!0)=>{const s=typeof C=="string"?C:C==null?void 0:C.value,f=typeof o=="string"?o:o==null?void 0:o.value;return!s&&!f?(a&&h.warning("请先选择网关实例或路由"),!1):!0},x=async a=>{d.model.resetPagination(),await d.loadFilterList(a)},k=async({currentPage:a,pageSize:s})=>{d.model.updatePagination({pageIndex:a,pageSize:s}),await d.loadFilterList()},V=async a=>{switch(a){case"add":_();break;case"delete":await i();break;default:console.warn("未知的工具栏按钮:",a)}},_=()=>{T()&&(b.value="create",R.value=null,p.value=!0)},w=async a=>{if(!a.filterConfigId){h.warning("过滤器配置ID不能为空");return}try{const s=await d.getFilterDetail(a.filterConfigId);if(s){b.value="edit";const f=n(s.filterConfig,s.filterType);R.value={...s,...f},p.value=!0}else{b.value="edit";const f=n(a.filterConfig,a.filterType);R.value={...a,...f},p.value=!0}}catch{b.value="edit";const f=n(a.filterConfig,a.filterType);R.value={...a,...f},p.value=!0}},S=async a=>{if(!a.filterConfigId){h.warning("过滤器配置ID不能为空");return}try{const s=await d.getFilterDetail(a.filterConfigId);if(s){b.value="view";const f=n(s.filterConfig,s.filterType);R.value={...s,...f},p.value=!0}else{b.value="view";const f=n(a.filterConfig,a.filterType);R.value={...a,...f},p.value=!0}}catch{b.value="view";const f=n(a.filterConfig,a.filterType);R.value={...a,...f},p.value=!0}},M=()=>{p.value=!1,R.value=null},N=a=>{const s={};switch(a.filterType){case"header":s.headerConfig={modifierType:a["config.headerConfig.modifierType"],headerName:a["config.headerConfig.headerName"],headerValue:a["config.headerConfig.headerValue"],targetHeaderName:a["config.headerConfig.targetHeaderName"],isRequestHeader:a["config.headerConfig.isRequestHeader"]??!0};break;case"query-param":s.queryParamConfig={modifierType:a["config.queryParamConfig.modifierType"],paramName:a["config.queryParamConfig.paramName"],paramValue:a["config.queryParamConfig.paramValue"],targetParamName:a["config.queryParamConfig.targetParamName"]};break;case"strip":s.stripConfig={prefix:a["config.stripConfig.prefix"]};break;case"rewrite":s.rewriteConfig={mode:a["config.rewriteConfig.mode"],from:a["config.rewriteConfig.from"],to:a["config.rewriteConfig.to"]};break;case"method":s.methodConfig={mode:a["config.methodConfig.mode"],allowedMethods:a["config.methodConfig.allowedMethods"],deniedMethods:a["config.methodConfig.deniedMethods"],rejectStatusCode:a["config.methodConfig.rejectStatusCode"]??405,rejectMessage:a["config.methodConfig.rejectMessage"]??"Method Not Allowed",caseSensitive:a["config.methodConfig.caseSensitive"]??!1};break;case"body":s.bodyConfig={modifierType:a["config.bodyConfig.modifierType"],operation:a["config.bodyConfig.operation"],allowedContentTypes:a["config.bodyConfig.allowedContentTypes"],maxBodySize:a["config.bodyConfig.maxBodySize"],filterConfig:a["config.bodyConfig.filterConfigJson"]?JSON.parse(a["config.bodyConfig.filterConfigJson"]):{}};break;case"cookie":s.cookieConfig={operation:a["config.cookieConfig.operation"],cookieName:a["config.cookieConfig.cookieName"],cookieValue:a["config.cookieConfig.cookieValue"],applyToResponse:a["config.cookieConfig.applyToResponse"]??!1,cookieAttributes:{domain:a["config.cookieConfig.cookieAttributes.domain"],path:a["config.cookieConfig.cookieAttributes.path"],maxAge:a["config.cookieConfig.cookieAttributes.maxAge"],secure:a["config.cookieConfig.cookieAttributes.secure"]??!1,httpOnly:a["config.cookieConfig.cookieAttributes.httpOnly"]??!1,sameSite:a["config.cookieConfig.cookieAttributes.sameSite"]}};break;case"response":s.responseConfig={operation:a["config.responseConfig.operation"],setInRequestPhase:a["config.responseConfig.setInRequestPhase"]??!1,filterConfig:a["config.responseConfig.filterConfigJson"]?JSON.parse(a["config.responseConfig.filterConfigJson"]):{},conditions:a["config.responseConfig.conditionsJson"]?JSON.parse(a["config.responseConfig.conditionsJson"]):{}};break}return JSON.stringify(s)},n=(a,s)=>{const f={};if(!a)return f;try{const m=JSON.parse(a);switch(s){case"header":m.headerConfig&&(f["config.headerConfig.modifierType"]=m.headerConfig.modifierType,f["config.headerConfig.headerName"]=m.headerConfig.headerName,f["config.headerConfig.headerValue"]=m.headerConfig.headerValue,f["config.headerConfig.targetHeaderName"]=m.headerConfig.targetHeaderName,f["config.headerConfig.isRequestHeader"]=m.headerConfig.isRequestHeader??!0);break;case"query-param":m.queryParamConfig&&(f["config.queryParamConfig.modifierType"]=m.queryParamConfig.modifierType,f["config.queryParamConfig.paramName"]=m.queryParamConfig.paramName,f["config.queryParamConfig.paramValue"]=m.queryParamConfig.paramValue,f["config.queryParamConfig.targetParamName"]=m.queryParamConfig.targetParamName);break;case"strip":m.stripConfig&&(f["config.stripConfig.prefix"]=m.stripConfig.prefix);break;case"rewrite":m.rewriteConfig&&(f["config.rewriteConfig.mode"]=m.rewriteConfig.mode,f["config.rewriteConfig.from"]=m.rewriteConfig.from,f["config.rewriteConfig.to"]=m.rewriteConfig.to);break;case"method":m.methodConfig&&(f["config.methodConfig.mode"]=m.methodConfig.mode,f["config.methodConfig.allowedMethods"]=m.methodConfig.allowedMethods,f["config.methodConfig.deniedMethods"]=m.methodConfig.deniedMethods,f["config.methodConfig.rejectStatusCode"]=m.methodConfig.rejectStatusCode??405,f["config.methodConfig.rejectMessage"]=m.methodConfig.rejectMessage??"Method Not Allowed",f["config.methodConfig.caseSensitive"]=m.methodConfig.caseSensitive??!1);break;case"body":m.bodyConfig&&(f["config.bodyConfig.modifierType"]=m.bodyConfig.modifierType,f["config.bodyConfig.operation"]=m.bodyConfig.operation,f["config.bodyConfig.allowedContentTypes"]=m.bodyConfig.allowedContentTypes,f["config.bodyConfig.maxBodySize"]=m.bodyConfig.maxBodySize,f["config.bodyConfig.filterConfigJson"]=JSON.stringify(m.bodyConfig.filterConfig||{},null,2));break;case"cookie":m.cookieConfig&&(f["config.cookieConfig.operation"]=m.cookieConfig.operation,f["config.cookieConfig.cookieName"]=m.cookieConfig.cookieName,f["config.cookieConfig.cookieValue"]=m.cookieConfig.cookieValue,f["config.cookieConfig.applyToResponse"]=m.cookieConfig.applyToResponse??!1,m.cookieConfig.cookieAttributes&&(f["config.cookieConfig.cookieAttributes.domain"]=m.cookieConfig.cookieAttributes.domain,f["config.cookieConfig.cookieAttributes.path"]=m.cookieConfig.cookieAttributes.path,f["config.cookieConfig.cookieAttributes.maxAge"]=m.cookieConfig.cookieAttributes.maxAge,f["config.cookieConfig.cookieAttributes.secure"]=m.cookieConfig.cookieAttributes.secure??!1,f["config.cookieConfig.cookieAttributes.httpOnly"]=m.cookieConfig.cookieAttributes.httpOnly??!1,f["config.cookieConfig.cookieAttributes.sameSite"]=m.cookieConfig.cookieAttributes.sameSite));break;case"response":m.responseConfig&&(f["config.responseConfig.operation"]=m.responseConfig.operation,f["config.responseConfig.setInRequestPhase"]=m.responseConfig.setInRequestPhase??!1,f["config.responseConfig.filterConfigJson"]=JSON.stringify(m.responseConfig.filterConfig||{},null,2),f["config.responseConfig.conditionsJson"]=JSON.stringify(m.responseConfig.conditions||{},null,2));break}}catch(m){console.error("解析过滤器配置失败:",m)}return f},e=async a=>{if(a){if(b.value==="view"){M();return}if(!T())return!1;try{const s=N(a),f={filterConfigId:a.filterConfigId,gatewayInstanceId:a.gatewayInstanceId||(typeof C=="string"?C:C==null?void 0:C.value),routeConfigId:a.routeConfigId||(typeof o=="string"?o:o==null?void 0:o.value),filterName:a.filterName,filterType:a.filterType,filterAction:a.filterAction,filterOrder:a.filterOrder,filterDesc:a.filterDesc,activeFlag:a.activeFlag,noteText:a.noteText,filterConfig:s};let m=!1;b.value==="create"?m=await d.addFilter(f):b.value==="edit"&&R.value&&(m=await d.editFilter(R.value.filterConfigId,f)),m&&M()}catch(s){console.error("提交过滤器配置失败:",s),h.error(s.message||"提交失败，请重试")}}},g=async({menu:a,row:s})=>{switch(a.code){case"view":await S(s);break;case"edit":await w(s);break;case"toggle-status":await c(s);break;case"delete":await l(s);break;default:console.warn("未知的菜单项:",a.code)}},l=async a=>{await r.warning({title:"确认删除",content:`确定要删除过滤器"${a.filterName}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消"})&&await d.deleteFilter(a.filterConfigId)},i=async()=>{var m;if(!((m=y==null?void 0:y.value)!=null&&m.getCheckboxRecords)){h.warning("无法获取选中的记录");return}const a=y.value.getCheckboxRecords();if(!a||a.length===0){h.warning("请先选择要删除的过滤器");return}if(!await r.warning({title:"确认批量删除",content:`确定要删除选中的 ${a.length} 个过滤器吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消"}))return;const f=a.map(G=>G.filterConfigId);await d.deleteFilters(f)},c=async a=>{await d.toggleFilterStatus(a)};return{service:d,formDialogVisible:p,formDialogMode:b,currentEditFilter:R,handleSearch:x,handlePageChange:k,handleToolbarClick:V,handleMenuClick:g,openAddDialog:_,openEditDialog:w,openViewDialog:S,closeFormDialog:M,handleFormSubmit:e,handleDelete:l,handleBatchDelete:i,handleToggleStatus:c}}const Kt=["id"],Dt={style:{"font-weight":"bold",color:"#0066cc"}},Yt=oe({name:"FilterConfigListModal",__name:"FilterConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{type:[String,Boolean],default:void 0},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0},filterScope:{default:"global"}},emits:["update:visible","close","refresh"],setup(y,{emit:C}){const o=y,u=C,h=P(),r=P(),d=P(o.visible),p=te(()=>o.visible,c=>{d.value=c}),b=P(o.gatewayInstanceId),R=P(o.routeConfigId),T=te(()=>o.gatewayInstanceId,c=>{b.value=c}),x=te(()=>o.routeConfigId,c=>{R.value=c});re(()=>{p(),T(),x()});const{service:k,formDialogVisible:V,formDialogMode:_,currentEditFilter:w,handleFormSubmit:S,handleToolbarClick:M,handleMenuClick:N,handleSearch:n,handlePageChange:e,handleToggleStatus:g}=qt(r,b,R,h),l=c=>{d.value=c,u("update:visible",c),c?(u("refresh"),k.loadFilterList()):u("close")},i=()=>{d.value||(V.value=!1,_.value="create",w.value=null,k.model.filterList.value=[],k.model.resetPagination())};return(c,a)=>(z(),se(t(ke),{visible:d.value,title:o.title||(o.filterScope==="global"?"全局过滤器配置列表":"路由过滤器配置列表"),width:o.width||1200,to:o.to,"show-footer":!1,"onUpdate:visible":l,onAfterLeave:i},{default:O(()=>[L("div",{class:"filter-config-list-modal",id:t(k).model.moduleId},[A(t(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[A(me,ie({ref_key:"searchFormRef",ref:h,"module-id":t(k).model.moduleId},t(k).model.searchFormConfig,{onSearch:t(n),onToolbarClick:t(M)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[A(t(be),ie({ref_key:"gridRef",ref:r,"module-id":t(k).model.moduleId,data:t(k).model.filterList,loading:t(k).model.loading},t(k).model.gridConfig,{onPageChange:t(e),onMenuClick:a[0]||(a[0]=({code:s,row:f})=>t(N)({menu:{code:s},row:f}))}),{filterOrder:O(({row:s})=>[L("span",Dt,q(s.filterOrder),1)]),filterType:O(({row:s})=>[A(t(B),{type:t(k).model.getFilterTypeTagType(s.filterType),size:"small"},{default:O(()=>[$(q(t(k).model.getFilterTypeLabel(s.filterType)),1)]),_:2},1032,["type"])]),filterAction:O(({row:s})=>[A(t(B),{type:t(k).model.getFilterActionTagType(s.filterAction),size:"small"},{default:O(()=>[$(q(t(k).model.getFilterActionLabel(s.filterAction)),1)]),_:2},1032,["type"])]),activeFlag:O(({row:s})=>[A(t(Re),{value:s.activeFlag==="Y","onUpdate:value":()=>t(g)(s),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),A(ve,{visible:t(V),"onUpdate:visible":a[1]||(a[1]=s=>Q(V)?V.value=s:null),mode:t(_),title:t(_)==="create"?"新增过滤器配置":t(_)==="edit"?"编辑过滤器配置":"查看过滤器配置详情",to:`#${t(k).model.moduleId}`,"form-fields":t(k).model.formFields,"form-tabs":t(k).model.formTabs,"initial-data":t(w)||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(k).model.loading.value,onSubmit:t(S)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,Kt)]),_:1},8,["visible","title","width","to"]))}}),He=le(Yt,[["__scopeId","data-v-ee0972e4"]]);var pe=(y=>(y.SEQUENTIAL="SEQUENTIAL",y.PARALLEL="PARALLEL",y))(pe||{});function zt(){const y="hub0021",C=P(!1),o=P([]),u=P(1),h=P(20),r=P(0),d=P(""),p=ce(()=>o.value.map(n=>({key:n.gatewayInstanceId,label:b(n),instance:n})));function b(n){const e=n.tlsEnabled==="Y"?n.httpsPort:n.httpPort;return`${n.instanceName||"未命名"} (${n.bindAddress||"-"}:${e||"-"})`}function R(n){o.value=n}function T(n){C.value=n}function x(n){u.value=n}function k(n){h.value=n}function V(n){d.value=n}function _(n){r.value=n}function w(){u.value=1}function S(){d.value=""}const M={enabled:!0,showCopyNode:!0,customMenus:[{code:"routerConfig",name:"Router配置",prefixIcon:()=>W(X,{size:14},{default:()=>W(Ge)})},{code:"globalFilterConfig",name:"全局过滤器配置",prefixIcon:()=>W(X,{size:14},{default:()=>W(gt)})}]},N={tabs:[{key:"basic",label:"基本信息"},{key:"cache",label:"路由缓存配置"},{key:"filters",label:"全局过滤器配置"},{key:"performance",label:"性能优化配置"},{key:"error",label:"错误处理配置"},{key:"other",label:"其他配置"}],fields:[{field:"routerConfigId",label:"Router配置ID",type:"input",span:12,tabKey:"basic",primary:!0,show:!1},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:12,tabKey:"basic",show:!1},{field:"routerName",label:"Router名称",type:"input",placeholder:"请输入Router名称",span:12,tabKey:"basic",required:!0,tips:"Router配置的名称标识，用于区分不同的Router配置",rules:[{required:!0,message:"请输入Router名称",trigger:["blur","input"]},{max:50,message:"Router名称不能超过50个字符",trigger:["blur","input"]}]},{field:"defaultPriority",label:"默认优先级",type:"number",placeholder:"请输入默认优先级",span:12,tabKey:"basic",required:!0,defaultValue:100,tips:"默认路由优先级，数值越小优先级越高",props:{min:0,max:9999},rules:[{required:!0,type:"number",message:"请输入默认优先级",trigger:["blur","change"]}]},{field:"routerDesc",label:"Router描述",type:"textarea",placeholder:"请输入Router描述信息",span:24,tabKey:"basic",tips:"Router配置的描述说明，用于记录配置的用途、注意事项等信息",props:{rows:2}},{field:"enableRouteCache",label:"启用路由缓存",type:"switch",span:12,tabKey:"cache",defaultValue:"Y",tips:"是否启用路由缓存。启用后可以缓存路由匹配结果，提高路由匹配性能",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"routeCacheTtlSeconds",label:"缓存TTL(秒)",type:"number",placeholder:"请输入缓存TTL",span:12,tabKey:"cache",show:n=>n.enableRouteCache==="Y",required:!0,defaultValue:300,tips:"路由缓存的有效期，超过此时间的缓存将被清除",props:{min:1,max:86400},rules:[{required:!0,type:"number",message:"请输入缓存TTL",trigger:["blur","change"]}]},{field:"maxRoutes",label:"最大路由数",type:"number",placeholder:"请输入最大路由数",span:12,tabKey:"cache",show:n=>n.enableRouteCache==="Y",defaultValue:1e3,tips:"路由缓存中最多可以缓存的路由数量",props:{min:1,max:1e4}},{field:"routeMatchTimeout",label:"路由匹配超时(ms)",type:"number",placeholder:"请输入路由匹配超时时间",span:12,tabKey:"cache",show:n=>n.enableRouteCache==="Y",defaultValue:5e3,tips:"路由匹配的最大超时时间，超过此时间未匹配成功则返回未找到",props:{min:100,max:3e4}},{field:"enableGlobalFilters",label:"启用全局过滤器",type:"switch",span:12,tabKey:"filters",defaultValue:"Y",tips:"是否启用全局过滤器。全局过滤器作用于所有路由，在路由匹配前执行",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"filterExecutionMode",label:"过滤器执行模式",type:"select",placeholder:"请选择执行模式",span:12,tabKey:"filters",show:n=>n.enableGlobalFilters==="Y",defaultValue:pe.SEQUENTIAL,tips:"过滤器的执行模式：顺序执行或并行执行",options:[{label:"顺序执行",value:pe.SEQUENTIAL},{label:"并行执行",value:pe.PARALLEL}]},{field:"maxFilterChainDepth",label:"最大过滤器链深度",type:"number",placeholder:"请输入最大过滤器链深度",span:12,tabKey:"filters",show:n=>n.enableGlobalFilters==="Y",defaultValue:10,tips:"过滤器链的最大深度，防止过滤器链过长导致性能问题",props:{min:1,max:100}},{field:"enableAsyncProcessing",label:"启用异步处理",type:"switch",span:12,tabKey:"filters",show:n=>n.enableGlobalFilters==="Y",defaultValue:"N",tips:"是否启用过滤器的异步处理模式",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableStrictMode",label:"启用严格模式",type:"switch",span:12,tabKey:"performance",defaultValue:"N",tips:"是否启用严格模式。严格模式下路由匹配更加严格，性能可能略有下降",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableRoutePooling",label:"启用路由池",type:"switch",span:12,tabKey:"performance",defaultValue:"N",tips:"是否启用路由对象池。启用后可以复用路由对象，减少内存分配",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"routePoolSize",label:"路由池大小",type:"number",placeholder:"请输入路由池大小",span:12,tabKey:"performance",show:n=>n.enableRoutePooling==="Y",defaultValue:100,tips:"路由对象池的大小，影响可以复用的路由对象数量",props:{min:10,max:1e3}},{field:"caseSensitive",label:"大小写敏感",type:"switch",span:12,tabKey:"performance",defaultValue:"N",tips:"路径匹配是否区分大小写",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"removeTrailingSlash",label:"移除尾部斜杠",type:"switch",span:12,tabKey:"performance",defaultValue:"Y",tips:"是否自动移除路径尾部的斜杠进行匹配",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableMetrics",label:"启用监控指标",type:"switch",span:12,tabKey:"performance",defaultValue:"Y",tips:"是否启用路由监控指标收集",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableFallback",label:"启用降级处理",type:"switch",span:12,tabKey:"error",defaultValue:"N",tips:"是否启用降级处理。启用后当路由匹配失败时，可以降级到指定的路由",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"fallbackRoute",label:"降级路由",type:"input",placeholder:"请输入降级路由路径",span:12,tabKey:"error",show:n=>n.enableFallback==="Y",tips:"降级路由的路径，当路由匹配失败时使用此路由"},{field:"notFoundStatusCode",label:"404状态码",type:"number",placeholder:"请输入404状态码",span:12,tabKey:"error",required:!0,defaultValue:404,tips:"路由未找到时返回的HTTP状态码",props:{min:400,max:599},rules:[{required:!0,type:"number",message:"请输入404状态码",trigger:["blur","change"]}]},{field:"notFoundMessage",label:"404消息",type:"input",placeholder:"请输入404消息",span:12,tabKey:"error",required:!0,defaultValue:"Route not found",tips:"路由未找到时返回的错误消息",rules:[{required:!0,message:"请输入404消息",trigger:["blur","input"]}]},{field:"enableTracing",label:"启用链路追踪",type:"switch",span:12,tabKey:"other",defaultValue:"N",tips:"是否启用链路追踪功能",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"activeFlag",label:"配置状态",type:"switch",span:12,tabKey:"other",defaultValue:"Y",tips:"Router配置的启用状态",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"noteText",label:"备注信息",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",tips:"Router配置的备注说明",props:{rows:3}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"Router配置的创建时间"},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"Router配置的创建人"},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"Router配置的最后修改时间"},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"Router配置的最后修改人"},{field:"currentVersion",label:"版本号",type:"number",span:12,tabKey:"other",disabled:!0,tips:"Router配置的当前版本号"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:12,tabKey:"other",disabled:!0,show:!1,tips:"Router配置的操作序列标识"}]};return{moduleId:y,loading:C,instanceList:o,currentPage:u,pageSize:h,totalCount:r,filterKeyword:d,treeData:p,treeMenuConfig:M,routerFormConfig:N,getInstanceLabel:b,setInstanceList:R,setLoading:T,setCurrentPage:x,setPageSize:k,setTotalCount:_,setFilterKeyword:V,resetPage:w,clearFilter:S}}function Ht(y){const C=Z(),{loading:o,currentPage:u,pageSize:h,filterKeyword:r,setInstanceList:d,setTotalCount:p,setLoading:b,resetPage:R}=y;async function T(){try{b(!0);const x=await it({instanceName:r.value.trim()||void 0,pageIndex:u.value,pageSize:h.value});if(K(x)){const k=ee(x,[]);d(Array.isArray(k)?k:[]);try{const V=Ae(x);p(V.totalCount||0)}catch(V){console.warn("解析分页信息失败:",V),p(0)}}else C.error(x.errMsg||"获取网关实例列表失败"),d([]),p(0)}catch(x){console.error("加载网关实例失败:",x),C.error("加载网关实例失败"),d([]),p(0)}finally{b(!1)}}return{loadGatewayInstances:T}}function $t(){const y=Z(),C=zt(),o=Ht(C),u=P(!1),h=P("create"),r=P(null),d=P(!1),p=P(""),b=P(!1),R=te(C.filterKeyword,()=>{C.resetPage(),o.loadGatewayInstances()});re(()=>{R()});function T({option:i}){return i.instance?W(X,{size:16,color:"var(--g-primary)",style:{marginRight:"6px",flexShrink:0}},{default:()=>W(ge)}):null}function x({option:i}){return W("span",{class:"tree-node-label",style:{display:"inline-block",padding:"1px 4px",borderRadius:"4px",transition:"background-color 0.2s"}},i.label)}function k({option:i}){const c=i;return c.instance?W(B,{type:c.instance.healthStatus==="Y"?"success":"warning",size:"small",style:{marginLeft:"8px",flexShrink:0}},{default:()=>c.instance.healthStatus==="Y"?"健康":"异常"}):null}function V(i,c,a){const s=c;s.instance&&a("select",s.instance.gatewayInstanceId,s.instance)}function _({currentPage:i,pageSize:c}){C.setCurrentPage(i),C.setPageSize(c),o.loadGatewayInstances()}function w(){o.loadGatewayInstances()}const S=async()=>{const i=p.value;if(i)try{const c=await nt(i);if(K(c)){const a=ee(c,null);a?(r.value=a,h.value="edit"):(r.value=null,h.value="create")}else r.value=null,h.value="create"}catch{r.value=null,h.value="create"}},M=async i=>{p.value=i.gatewayInstanceId,await S(),u.value=!0},N=i=>{const c=a=>{if(typeof a=="string"&&a)try{return JSON.parse(a)}catch{return{}}return a||{}};return{...i,routerMetadata:c(i.routerMetadata),customConfig:c(i.customConfig)}},n=()=>{if(h.value==="create")return{gatewayInstanceId:p.value,routerName:"默认Router",routerDesc:"",defaultPriority:100,enableRouteCache:"Y",routeCacheTtlSeconds:300,maxRoutes:1e3,routeMatchTimeout:5e3,enableStrictMode:"N",enableMetrics:"Y",enableTracing:"N",caseSensitive:"N",removeTrailingSlash:"Y",enableGlobalFilters:"Y",filterExecutionMode:"SEQUENTIAL",maxFilterChainDepth:10,enableRoutePooling:"N",routePoolSize:100,enableAsyncProcessing:"N",enableFallback:"N",fallbackRoute:"",notFoundStatusCode:404,notFoundMessage:"Route not found",activeFlag:"Y",noteText:"",routerMetadata:{},customConfig:{}};if(r.value)return N(r.value)},e=async i=>{if(!i||h.value==="view")return!1;try{d.value=!0;const c={...i,gatewayInstanceId:p.value||i.gatewayInstanceId};i.routerMetadata?c.routerMetadata=typeof i.routerMetadata=="string"?i.routerMetadata:JSON.stringify(i.routerMetadata):c.routerMetadata="{}",i.customConfig?c.customConfig=typeof i.customConfig=="string"?i.customConfig:JSON.stringify(i.customConfig):c.customConfig="{}";let a=!1;if(h.value==="create"){const s=await ot(c);K(s)?(y.success(D(s,"创建Router配置成功")),a=!0):y.error(D(s,"创建Router配置失败"))}else if(h.value==="edit"&&r.value){const s=r.value.routerConfigId;if(!s)return y.error("Router配置ID不存在"),!1;const f=await lt({...c,routerConfigId:s});K(f)?(y.success(D(f,"更新Router配置成功")),a=!0):y.error(D(f,"更新Router配置失败"))}return a&&await S(),a}catch{return y.error("操作失败"),!1}finally{d.value=!1}};function g(i){p.value=i.gatewayInstanceId,b.value=!0}async function l({code:i,node:c}){if(!c)return;const a=c;if(!a.instance)return;const s=a.instance;switch(i){case"routerConfig":await M(s);break;case"globalFilterConfig":g(s);break}}return{model:C,service:o,routerFormDialogVisible:u,routerFormDialogMode:h,currentEditRouter:r,routerSubmitting:d,getRouterFormInitialData:n,currentGatewayInstanceId:p,globalFilterConfigDialogVisible:b,renderNodePrefix:T,renderNodeLabel:x,renderNodeSuffix:k,handleTreeSelect:V,handlePageChange:_,handleRefresh:w,handleMenuClick:l,handleRouterFormSubmit:e}}const Ut={class:"gateway-instance-tree"},Gt={class:"instance-tree-header"},Jt={class:"instance-header"},Bt={class:"instance-filter"},Wt={class:"instance-tree-container"},jt={key:0,class:"instance-pagination"},Qt=oe({name:"GatewayInstanceTree",__name:"GatewayInstanceTree",props:{parentModuleId:{default:"route-management"}},emits:["select"],setup(y,{expose:C,emit:o}){const u=y,h=o,r=$t();return Ne(()=>{r.service.loadGatewayInstances()}),C({refresh:r.service.loadGatewayInstances,resetPage:r.model.resetPage,clearFilter:r.model.clearFilter}),(d,p)=>(z(),j("div",Ut,[L("div",Gt,[L("div",Jt,[A(t(X),{size:"20",color:"var(--g-primary)"},{default:O(()=>[A(t(ge))]),_:1}),p[4]||(p[4]=L("span",null,"网关实例列表",-1)),p[5]||(p[5]=L("div",{class:"flex-spacer"},null,-1)),A(t(de),{text:"",size:"small",onClick:t(r).handleRefresh,disabled:t(r).model.loading.value,loading:t(r).model.loading.value},{icon:O(()=>[A(t(X),{component:t(ze)},null,8,["component"])]),_:1},8,["onClick","disabled","loading"])]),L("div",Bt,[A(t(Je),{value:t(r).model.filterKeyword.value,"onUpdate:value":p[0]||(p[0]=b=>t(r).model.filterKeyword.value=b),placeholder:"搜索实例名称、地址或端口",clearable:"",size:"small"},{prefix:O(()=>[A(t(X),{component:t(Be)},null,8,["component"])]),_:1},8,["value"])])]),L("div",Wt,[A(t(We),{show:t(r).model.loading.value},{default:O(()=>[t(r).model.treeData.value.length>0?(z(),se(t(Ue),{key:0,data:t(r).model.treeData.value,"show-icon":!0,"block-line":!0,"node-height":32,"show-line":!0,ellipsis:!0,"ellipsis-line-clamp":1,"ellipsis-tooltip":!0,"module-id":t(r).model.moduleId,"menu-config":t(r).model.treeMenuConfig,"render-prefix":t(r).renderNodePrefix,"render-label":t(r).renderNodeLabel,"render-suffix":t(r).renderNodeSuffix,onSelect:p[1]||(p[1]=(b,R)=>t(r).handleTreeSelect(b,R,h)),onMenuClick:t(r).handleMenuClick},null,8,["data","module-id","menu-config","render-prefix","render-label","render-suffix","onMenuClick"])):(z(),se(t(je),{key:1,description:"暂无可用的网关实例",style:{padding:"40px 0"}},{icon:O(()=>[A(t(X),{size:"40",color:"var(--g-primary)"},{default:O(()=>[A(t(ge))]),_:1})]),_:1}))]),_:1},8,["show"])]),t(r).model.totalCount.value>0?(z(),j("div",jt,[A(t($e),{"current-page":t(r).model.currentPage.value,"page-size":t(r).model.pageSize.value,total:t(r).model.totalCount.value,layouts:["PrevPage","NextPage"],align:"center",onPageChange:t(r).handlePageChange},null,8,["current-page","page-size","total","onPageChange"])])):_e("",!0),A(ve,{visible:t(r).routerFormDialogVisible.value,"onUpdate:visible":p[2]||(p[2]=b=>t(r).routerFormDialogVisible.value=b),mode:t(r).routerFormDialogMode.value,title:t(r).routerFormDialogMode.value==="create"?"新增Router配置":t(r).routerFormDialogMode.value==="edit"?"编辑Router配置":"查看Router配置详情",to:`#${u.parentModuleId}`,"form-fields":t(r).model.routerFormConfig.fields,"form-tabs":t(r).model.routerFormConfig.tabs,"initial-data":t(r).getRouterFormInitialData(),"auto-close-on-confirm":!1,"confirm-loading":t(r).routerSubmitting.value,onSubmit:t(r).handleRouterFormSubmit},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),A(He,{visible:t(r).globalFilterConfigDialogVisible.value,"onUpdate:visible":p[3]||(p[3]=b=>t(r).globalFilterConfigDialogVisible.value=b),"gateway-instance-id":t(r).currentGatewayInstanceId.value,"filter-scope":"global",to:`#${u.parentModuleId}`},null,8,["visible","gateway-instance-id","to"])]))}}),Xt=le(Qt,[["__scopeId","data-v-d98f5df0"]]);function Zt(){const y="hub0021-service-selector",C=P(!1),o=P([]),u=P(),h={fields:[{field:"serviceName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:8,clearable:!0},{field:"serviceDefinitionId",label:"服务ID",type:"input",placeholder:"请输入服务ID",span:8,clearable:!0},{field:"serviceType",label:"服务类型",type:"select",placeholder:"请选择服务类型",span:8,clearable:!0,options:[{label:"全部",value:""},{label:"服务发现",value:1},{label:"静态配置",value:0}]}],showSearchButton:!0,showResetButton:!0},r={paginationConfig:{show:!0,pageInfo:u},columns:[{field:"serviceDefinitionId",title:"服务ID",align:"center",showOverflow:"tooltip",width:200},{field:"serviceName",title:"服务名称",sortable:!0,align:"center",showOverflow:"tooltip",width:200},{field:"serviceDesc",title:"服务描述",align:"center",showOverflow:"tooltip",width:250},{field:"serviceType",title:"服务类型",align:"center",slots:{default:"serviceType"},width:120},{field:"loadBalanceStrategy",title:"负载均衡",align:"center",slots:{default:"loadBalanceStrategy"},width:150},{field:"healthCheckEnabled",title:"健康检查",align:"center",slots:{default:"healthCheckEnabled"},width:120},{field:"activeFlag",title:"状态",align:"center",slots:{default:"activeFlag"},width:100},{field:"editTime",title:"修改时间",sortable:!0,align:"center",showOverflow:"tooltip",formatter:({cellValue:T})=>T?ne(T,"YYYY-MM-DD HH:mm:ss"):"",width:180},{field:"editWho",title:"修改人",align:"center",showOverflow:"tooltip",width:120}],showCheckbox:!0};function d(T){o.value=T}function p(T){C.value=T}function b(T){u.value?Object.assign(u.value,T):u.value=T}function R(){u.value=void 0}return{moduleId:y,loading:C,serviceList:o,pageInfo:u,searchFormConfig:h,gridConfig:r,setServiceList:d,setLoading:p,updatePagination:b,resetPagination:R}}function ea(y,C,o){const u=Z(),{loading:h,setServiceList:r,setLoading:d,updatePagination:p}=y;async function b(R={}){var T,x,k;if(!C){r([]);return}try{d(!0);let V=R;!V&&((T=o==null?void 0:o.value)!=null&&T.getFormData)&&(V=o.value.getFormData()||{});const _=Object.fromEntries(Object.entries(V).filter(([,M])=>M!==""&&M!==null&&M!==void 0)),w={gatewayInstanceId:C,..._,...he((x=y.pageInfo.value)==null?void 0:x.pageIndex,(k=y.pageInfo.value)==null?void 0:k.pageSize)},S=await st(w);if(K(S)){const M=ee(S,[]);r(Array.isArray(M)?M:[]),p(Ae(S))}else u.error(S.errMsg||"获取服务定义列表失败"),r([]),p({})}catch(V){console.error("加载服务定义列表失败:",V),u.error("加载服务定义列表失败: "+((V==null?void 0:V.message)||"未知错误")),r([]),p({})}finally{d(!1)}}return{loadServiceDefinitions:b}}function ta(y,C,o,u){const h=Z(),r=()=>typeof C=="string"?C:C==null?void 0:C.value,d=ea(y,r(),u),p=async x=>{if(!r()){h.warning("请先选择网关实例");return}y.resetPagination(),await d.loadServiceDefinitions(x)},b=async()=>{var x;(x=u==null?void 0:u.value)!=null&&x.resetFields&&u.value.resetFields(),y.resetPagination(),await p()};return{service:d,handleSearch:p,handleReset:b,handlePageChange:async({currentPage:x,pageSize:k})=>{y.updatePagination({pageIndex:x,pageSize:k}),await d.loadServiceDefinitions()},handleToolbarClick:async(x,k)=>{switch(x){case"search":await p(k);break;case"reset":await b();break}}}}const aa=["id"],ia=oe({name:"ServiceDefinitionListModal",__name:"ServiceDefinitionListModal",props:{visible:{type:Boolean,default:!1},title:{default:"选择服务定义"},width:{default:1200},to:{type:[String,Boolean],default:void 0},gatewayInstanceId:{default:void 0}},emits:["update:visible","close","refresh","select"],setup(y,{emit:C}){const o=y,u=C,h=Z(),r=P(),d=P(),p=P([]),b=Zt(),R=P(o.gatewayInstanceId),T=te(()=>o.gatewayInstanceId,g=>{R.value=g}),{handleSearch:x,handlePageChange:k,handleToolbarClick:V}=ta(b,R,d,r),_=P(o.visible),w=te(()=>o.visible,g=>{_.value=g});re(()=>{T(),w()});const S=g=>({"round-robin":"轮询",random:"随机","ip-hash":"IP哈希","least-conn":"最少连接","weighted-round-robin":"加权轮询","consistent-hash":"一致性哈希",ROUND_ROBIN:"轮询",RANDOM:"随机",IP_HASH:"IP哈希",LEAST_CONN:"最少连接",WEIGHTED_ROUND_ROBIN:"加权轮询",CONSISTENT_HASH:"一致性哈希"})[g]||g,M=g=>{p.value=g},N=g=>{_.value=g,u("update:visible",g),g?u("refresh"):(p.value=[],u("close"))},n=()=>{if(p.value.length===0){h.warning("请至少选择一个服务定义");return}u("select",p.value),_.value=!1,u("update:visible",!1),u("close")},e=()=>{_.value=!1,u("update:visible",!1),u("close")};return(g,l)=>(z(),se(t(ke),{visible:_.value,title:o.title||"选择服务定义",width:o.width||1200,to:o.to,"show-footer":!0,"show-confirm":!0,"show-cancel":!0,"confirm-text":"确认选择","cancel-text":"取消","header-icon":t(ht),"onUpdate:visible":N,onConfirm:n,onCancel:e},{default:O(()=>[L("div",{class:"service-definition-list-modal",id:t(b).moduleId},[A(t(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[A(me,ie({ref_key:"searchFormRef",ref:r,"module-id":t(b).moduleId},t(b).searchFormConfig,{onSearch:t(x),onToolbarClick:t(V)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[A(t(be),ie({ref_key:"gridRef",ref:d,"module-id":t(b).moduleId,data:t(b).serviceList,loading:t(b).loading},t(b).gridConfig,{onPageChange:t(k),onCheckboxChange:M}),{serviceType:O(({row:i})=>[A(t(B),{type:i.serviceType===1?"success":"info",size:"small"},{default:O(()=>[$(q(i.serviceType===1?"服务发现":"静态配置"),1)]),_:2},1032,["type"])]),loadBalanceStrategy:O(({row:i})=>[A(t(B),{type:"default",size:"small"},{default:O(()=>[$(q(S(i.loadBalanceStrategy)),1)]),_:2},1024)]),healthCheckEnabled:O(({row:i})=>[A(t(B),{type:i.healthCheckEnabled==="Y"?"success":"default",size:"small"},{default:O(()=>[$(q(i.healthCheckEnabled==="Y"?"已启用":"未启用"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:i})=>[A(t(B),{type:i.activeFlag==="Y"?"success":"error",size:"small"},{default:O(()=>[$(q(i.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,aa)]),_:1},8,["visible","title","width","to","header-icon"]))}}),oa=le(ia,[["__scopeId","data-v-0bc55b5e"]]),la={class:"service-definition-selector"},na={key:0,class:"selected-service-card"},sa={class:"service-info"},ra={key:0,class:"services-list"},ca={class:"service-header"},ua={class:"service-avatar"},da={class:"avatar-circle"},fa={class:"service-main-info"},pa={class:"service-name"},ga={class:"service-id"},ha={class:"service-status"},ba={class:"service-details"},ma={class:"detail-row"},va={class:"detail-item"},ya={class:"detail-item"},Ca={class:"detail-value"},wa={class:"detail-row"},Ta={class:"detail-item full-width"},Ia={key:1,class:"service-item"},ka={class:"service-header"},Sa={class:"service-avatar"},Aa={class:"avatar-circle"},Na={class:"service-main-info"},_a={class:"service-name"},Oa={class:"service-id"},Pa={class:"service-status"},Ra={class:"service-details"},xa={class:"detail-row"},Fa={class:"detail-item"},Ma={class:"detail-item"},Va={class:"detail-value"},La={class:"detail-row"},Ea={class:"detail-item full-width"},qa={class:"service-actions"},Ka={key:1,class:"empty-selector"},Da=oe({__name:"ServiceDefinitionSelector",props:{modelValue:{},gatewayInstanceId:{}},emits:["update:modelValue","change"],setup(y,{emit:C}){const o=y,u=C,h=Z(),r=P(!1),d=P(!1),p=P(null),b=P([]),R=ce(()=>o.modelValue?typeof o.modelValue=="string"&&o.modelValue.includes(",")?o.modelValue.split(",").map(l=>l.trim()).filter(l=>l):[o.modelValue]:[]),T=ce(()=>{if(R.value.length>1)return null;if(R.value.length===1){const l=R.value[0];if(p.value&&p.value.serviceDefinitionId===l)return p.value}return null}),x=ce(()=>R.value.length<=1?[]:b.value.filter(l=>R.value.includes(l.serviceDefinitionId))),k=async l=>{if(!l){p.value=null;return}try{d.value=!0;const i=await Fe(l);if(K(i)){const c=JSON.parse(i.bizData);p.value=c}else console.warn("获取服务定义失败:",D(i,"获取服务定义失败")),p.value=null}catch(i){console.error("加载服务定义失败:",i),p.value=null}finally{d.value=!1}},V=async l=>{if(!l||l.length===0){b.value=[];return}try{d.value=!0;const i=l.map(s=>Fe(s)),c=await Promise.all(i),a=[];c.forEach((s,f)=>{if(K(s))try{const m=JSON.parse(s.bizData);a.push(m)}catch(m){console.warn(`解析服务定义 ${l[f]} 失败:`,m)}else console.warn(`获取服务定义 ${l[f]} 失败:`,D(s,"获取服务定义失败"))}),b.value=a}catch(i){console.error("加载服务定义列表失败:",i),b.value=[]}finally{d.value=!1}},_=l=>({"round-robin":"轮询",random:"随机","ip-hash":"IP哈希","least-conn":"最少连接","weighted-round-robin":"加权轮询","consistent-hash":"一致性哈希",ROUND_ROBIN:"轮询",RANDOM:"随机",IP_HASH:"IP哈希",LEAST_CONN:"最少连接",WEIGHTED_ROUND_ROBIN:"加权轮询",CONSISTENT_HASH:"一致性哈希"})[l]||l,w=l=>{if(!l)return"?";const i=l.charAt(0).toUpperCase();return/^[A-Z]$/.test(i)?i:l.charAt(0)},S=()=>{r.value=!0},M=()=>{r.value=!1},N=()=>{p.value=null,b.value=[],u("update:modelValue",null),u("change",null),h.info("已清除服务定义选择")},n=l=>{if(l.length===0){p.value=null,b.value=[],u("update:modelValue",null),u("change",null),M();return}if(l.length===1){const i=l[0];p.value=i,b.value=[],u("update:modelValue",i.serviceDefinitionId),u("change",i),h.success(`已选择服务：${i.serviceName}`)}else{p.value=null,b.value=l;const i=l.map(c=>c.serviceDefinitionId).join(",");u("update:modelValue",i),u("change",l),h.success(`已选择 ${l.length} 个服务`)}M()},e=te(()=>o.gatewayInstanceId,(l,i)=>{!l&&i&&(p.value=null)}),g=te(()=>o.modelValue,(l,i)=>{if(!l){p.value=null,b.value=[];return}if(l!==i){const c=typeof l=="string"&&l.includes(",")?l.split(",").map(a=>a.trim()).filter(a=>a):[l];if(c.length===1){const a=c[0];(!p.value||p.value.serviceDefinitionId!==a)&&k(a),b.value=[]}else if(c.length>1){const a=b.value.map(f=>f.serviceDefinitionId).sort(),s=[...c].sort();JSON.stringify(a)!==JSON.stringify(s)&&V(c),p.value=null}}},{immediate:!0});return re(()=>{e(),g()}),Ne(()=>{if(o.modelValue){const l=typeof o.modelValue=="string"&&o.modelValue.includes(",")?o.modelValue.split(",").map(i=>i.trim()).filter(i=>i):[o.modelValue];l.length===1?k(l[0]):l.length>1&&V(l)}}),(l,i)=>(z(),j("div",la,[l.modelValue&&(x.value.length>0||T.value)?(z(),j("div",na,[L("div",sa,[x.value.length>0?(z(),j("div",ra,[(z(!0),j(Ie,null,Ye(x.value,c=>(z(),j("div",{key:c.serviceDefinitionId,class:"service-item"},[L("div",ca,[L("div",ua,[L("div",da,q(w(c.serviceName)),1)]),L("div",fa,[L("div",pa,q(c.serviceName),1),L("div",ga,q(c.serviceDefinitionId),1)]),L("div",ha,[A(t(B),{type:c.activeFlag==="Y"?"success":"error",size:"small"},{default:O(()=>[$(q(c.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])])]),L("div",ba,[L("div",ma,[L("div",va,[i[1]||(i[1]=L("span",{class:"detail-label"},"服务类型",-1)),A(t(B),{type:c.serviceType===1?"success":"info",size:"small"},{default:O(()=>[$(q(c.serviceType===1?"服务发现":"静态配置"),1)]),_:2},1032,["type"])]),L("div",ya,[i[2]||(i[2]=L("span",{class:"detail-label"},"负载均衡",-1)),L("span",Ca,q(_(c.loadBalanceStrategy)),1)])]),L("div",wa,[L("div",Ta,[i[3]||(i[3]=L("span",{class:"detail-label"},"健康检查",-1)),A(t(B),{type:c.healthCheckEnabled==="Y"?"success":"default",size:"small"},{default:O(()=>[$(q(c.healthCheckEnabled==="Y"?"已启用":"已禁用"),1)]),_:2},1032,["type"])])])])]))),128))])):T.value?(z(),j("div",Ia,[L("div",ka,[L("div",Sa,[L("div",Aa,q(w(T.value.serviceName)),1)]),L("div",Na,[L("div",_a,q(T.value.serviceName),1),L("div",Oa,q(T.value.serviceDefinitionId),1)]),L("div",Pa,[A(t(B),{type:T.value.activeFlag==="Y"?"success":"error",size:"small"},{default:O(()=>[$(q(T.value.activeFlag==="Y"?"启用":"禁用"),1)]),_:1},8,["type"])])]),L("div",Ra,[L("div",xa,[L("div",Fa,[i[4]||(i[4]=L("span",{class:"detail-label"},"服务类型",-1)),A(t(B),{type:T.value.serviceType===1?"success":"info",size:"small"},{default:O(()=>[$(q(T.value.serviceType===1?"服务发现":"静态配置"),1)]),_:1},8,["type"])]),L("div",Ma,[i[5]||(i[5]=L("span",{class:"detail-label"},"负载均衡",-1)),L("span",Va,q(_(T.value.loadBalanceStrategy)),1)])]),L("div",La,[L("div",Ea,[i[6]||(i[6]=L("span",{class:"detail-label"},"健康检查",-1)),A(t(B),{type:T.value.healthCheckEnabled==="Y"?"success":"default",size:"small"},{default:O(()=>[$(q(T.value.healthCheckEnabled==="Y"?"已启用":"已禁用"),1)]),_:1},8,["type"])])])])])):_e("",!0),L("div",qa,[A(t(de),{onClick:S,size:"small",secondary:""},{icon:O(()=>[A(t(X),null,{default:O(()=>[A(t(ze))]),_:1})]),default:O(()=>[i[7]||(i[7]=$(" 重新选择 "))]),_:1}),A(t(de),{onClick:N,size:"small",type:"error",secondary:""},{icon:O(()=>[A(t(X),null,{default:O(()=>[A(t(It))]),_:1})]),default:O(()=>[i[8]||(i[8]=$(" 清除 "))]),_:1})])])])):(z(),j("div",Ka,[A(t(de),{onClick:S,dashed:"",block:"",size:"large",class:"select-btn"},{icon:O(()=>[A(t(X),null,{default:O(()=>[A(t(ge))]),_:1})]),default:O(()=>[i[9]||(i[9]=$(" 点击选择服务定义 "))]),_:1})])),A(oa,{visible:r.value,"onUpdate:visible":i[0]||(i[0]=c=>r.value=c),title:"选择服务定义",width:1200,"gateway-instance-id":l.gatewayInstanceId,to:"#hub0021-route-config-list",onSelect:n,onClose:M},null,8,["visible","gateway-instance-id"])]))}}),Ya=le(Da,[["__scopeId","data-v-1ce21caf"]]);function za(){const y="hub0021",C=P(!1),o=P([]),u=P(),h={fields:[{field:"routeName",label:"路由名称",type:"input",placeholder:"请输入路由名称",span:6,clearable:!0},{field:"routePath",label:"路由路径",type:"input",placeholder:"请输入路由路径",span:6,clearable:!0},{field:"matchType",label:"匹配类型",type:"select",placeholder:"请选择匹配类型",span:6,clearable:!0,options:[{label:"精确匹配",value:U.EXACT},{label:"前缀匹配",value:U.PREFIX},{label:"正则匹配",value:U.REGEX}]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[{key:"add",label:"新增路由",icon:Oe,type:"primary",tooltip:"新增路由配置"},{key:"delete",label:"删除",icon:Pe,type:"error",tooltip:"批量删除选中的路由配置"}],showSearchButton:!0,showResetButton:!0},r={columns:[{field:"routeConfigId",title:"路由配置ID",visible:!1,width:0},{field:"routeName",title:"路由名称",sortable:!0,align:"center",showOverflow:"tooltip",slots:{default:"routeName"},width:200},{field:"routePath",title:"路由路径",align:"center",showOverflow:"tooltip",width:250},{field:"matchType",title:"匹配类型",align:"center",slots:{default:"matchType"},width:120},{field:"routePriority",title:"优先级",align:"center",sortable:!0,width:100},{field:"allowedMethods",title:"HTTP方法",align:"center",slots:{default:"allowedMethods"},width:150},{field:"serviceName",title:"关联服务",align:"center",showOverflow:"tooltip",width:180},{field:"timeoutMs",title:"超时时间(ms)",align:"center",visible:!1,width:0},{field:"retryCount",title:"重试次数",align:"center",visible:!1,width:0},{field:"enableWebsocket",title:"WebSocket",align:"center",visible:!1,width:0},{field:"routeMetadata",title:"路由元数据",align:"center",visible:!1,width:0},{field:"activeFlag",title:"状态",align:"center",slots:{default:"activeFlag"},width:100},{field:"addTime",title:"创建时间",align:"center",formatter:({row:w})=>ne(w.addTime),width:180}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"routeConfig",name:"路由配置",prefixIcon:"vxe-icon-setting",children:[{code:"assertConfig",name:"路由断言配置",prefixIcon:()=>W(X,{size:12},{default:()=>W(At)})},{code:"ipAccessControl",name:"IP访问控制",prefixIcon:"vxe-icon-lock"},{code:"userAgentAccessControl",name:"User-Agent访问控制",prefixIcon:"vxe-icon-user"},{code:"apiAccessControl",name:"API访问控制",prefixIcon:"vxe-icon-link"},{code:"domainAccessControl",name:"域名访问控制",prefixIcon:()=>W(X,{size:12},{default:()=>W(Nt)})},{code:"corsConfig",name:"跨域配置",prefixIcon:"vxe-icon-link"},{code:"authConfig",name:"认证配置",prefixIcon:"vxe-icon-setting"},{code:"rateLimitConfig",name:"限流配置",prefixIcon:"vxe-icon-setting"},{code:"filters",name:"路由过滤器",prefixIcon:"vxe-icon-setting"}]},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function d(w){o.value=w}function p(w){C.value=w}function b(){u.value=void 0}function R(w){u.value?Object.assign(u.value,w):u.value=w}function T(w){o.value.unshift(w)}function x(w){const S=o.value.findIndex(M=>M.routeConfigId===w.routeConfigId);S>=0&&(o.value[S]=w)}function k(w){const S=o.value.findIndex(M=>M.routeConfigId===w);S>=0&&o.value.splice(S,1)}function V(w){o.value=o.value.filter(S=>!w.includes(S.routeConfigId))}const _={tabs:[{key:"basic",label:"基本信息"},{key:"metadata",label:"元数据配置"},{key:"other",label:"其他"}],fields:[{field:"routeConfigId",label:"路由配置ID",type:"input",span:12,tabKey:"basic",primary:!0,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:12,tabKey:"basic",show:!1},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:12,tabKey:"basic",show:!1},{field:"routeName",label:"路由名称",type:"input",placeholder:"请输入路由名称",span:12,tabKey:"basic",required:!0,tips:"路由的唯一标识名称，用于区分不同的路由规则",rules:[{required:!0,message:"请输入路由名称",trigger:["blur","input"]},{max:100,message:"路由名称不能超过100个字符",trigger:["blur","input"]}]},{field:"matchType",label:"匹配类型",type:"select",placeholder:"请选择匹配类型",span:12,tabKey:"basic",required:!0,defaultValue:U.EXACT,tips:"精确匹配：路径必须完全一致；前缀匹配：路径以指定前缀开头；正则匹配：使用正则表达式匹配路径",options:[{label:"精确匹配",value:U.EXACT},{label:"前缀匹配",value:U.PREFIX},{label:"正则匹配",value:U.REGEX}],rules:[{required:!0,message:"请选择匹配类型",trigger:["blur","change"],validator:(w,S)=>S==null||S===""?new Error("请选择匹配类型"):[U.EXACT,U.PREFIX,U.REGEX].includes(Number(S))?!0:new Error("请选择有效的匹配类型")}]},{field:"routePath",label:"路由路径",type:"input",placeholder:"请输入路由路径",span:24,tabKey:"basic",required:!0,tips:w=>{switch(w.matchType){case U.EXACT:return`精确匹配：请求路径必须完全匹配配置的路径
示例: /api/users/123`;case U.PREFIX:return`前缀匹配：请求路径以配置的路径为前缀即可匹配
示例: /api/users (匹配 /api/users/*)`;case U.REGEX:return`正则匹配：使用正则表达式匹配请求路径
示例: ^/api/users/\\d+$`;default:return"精确匹配示例：/api/users；前缀匹配示例：/api/；正则匹配示例：^/api/(users|orders)/?$"}},props:{onUpdateValue:(w,S)=>{w&&!w.startsWith("/")?S.routePath="/"+w:S.routePath=w}},rules:[{required:!0,message:"请输入路由路径",trigger:["blur","input"]},{pattern:/^\/.*/,message:"路由路径必须以 / 开头",trigger:["blur","input"]},{validator:(w,S)=>S?S.startsWith("/")?!0:new Error("路由路径必须以 / 开头"):!0,trigger:["blur","input"]}]},{field:"allowedMethods",label:"HTTP方法",type:"custom",span:24,tabKey:"basic",tips:"选择允许的HTTP请求方法，未选择表示允许所有方法",render:w=>{const S=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"],M=Array.isArray(w.allowedMethods)?w.allowedMethods:typeof w.allowedMethods=="string"&&w.allowedMethods?(()=>{try{const N=JSON.parse(w.allowedMethods);return Array.isArray(N)?N:[]}catch{return w.allowedMethods.split(",").map(N=>N.trim()).filter(Boolean)}})():[];return W(St,{value:M,"onUpdate:value":N=>{w.allowedMethods=N.map(n=>String(n))}},{default:()=>W(Qe,{},{default:()=>S.map(N=>W(kt,{value:N,label:N},{default:()=>N}))})})}},{field:"allowedHosts",label:"允许的主机",type:"input",placeholder:"留空表示允许所有主机，多个主机用逗号分隔",span:12,tabKey:"basic",tips:"限制允许的主机名，多个主机用逗号分隔，如：api.example.com,www.example.com"},{field:"routePriority",label:"路由优先级",type:"number",placeholder:"数值越小优先级越高",span:12,tabKey:"basic",required:!0,defaultValue:100,tips:"路由匹配的优先级，数值越小优先级越高，建议范围：1-999",props:{min:1,max:999,style:{width:"100%"}},rules:[{required:!0,message:"请输入路由优先级",trigger:["blur","change","input"],validator:(w,S)=>{if(S==null||S==="")return new Error("请输入路由优先级");const M=typeof S=="number"?S:Number(S);return isNaN(M)?new Error("路由优先级必须是数字"):M<1||M>999?new Error("优先级必须在1-999之间"):!0}}]},{field:"serviceDefinitionId",label:"关联服务",type:"custom",span:24,tabKey:"basic",required:!0,tips:"选择要关联的后端服务定义，多个服务使用逗号分割，如果没有可用选项，请先在服务管理中创建服务定义",render:(w,S)=>{const M=(S==null?void 0:S.gatewayInstanceId)||"";return W(Ya,{modelValue:w.serviceDefinitionId,"onUpdate:modelValue":N=>{w.serviceDefinitionId=N||""},gatewayInstanceId:M})}},{field:"routeMetadata.responseMergeStrategy",label:"响应合并策略",type:"select",span:8,tabKey:"basic",show:w=>w.serviceDefinitionId&&w.serviceDefinitionId.includes(","),defaultValue:"first",tips:`first: 使用第一个成功的响应（默认）
first_error: 使用第一个失败的响应
all: 返回所有响应`,options:[{label:"第一个成功响应",value:"first"},{label:"第一个失败响应",value:"first_error"},{label:"所有响应",value:"all"}]},{field:"routeMetadata.maxConcurrentRequests",label:"最大并发请求数",type:"number",span:8,tabKey:"basic",show:w=>w.serviceDefinitionId&&w.serviceDefinitionId.includes(","),defaultValue:0,tips:"0表示不限制（使用所有服务），大于0时限制并发数",props:{min:0,precision:0}},{field:"routeMetadata.requireAllSuccess",label:"要求所有服务成功",type:"switch",span:8,tabKey:"basic",show:w=>w.serviceDefinitionId&&w.serviceDefinitionId.includes(","),defaultValue:!1,tips:"如果为true，任何一个服务失败都会返回错误；如果为false，使用第一个成功的响应",props:{checkedValue:!0,uncheckedValue:!1}},{field:"logConfigId",label:"日志配置ID",type:"input",placeholder:"请输入日志配置ID（可选）",span:12,tabKey:"basic",tips:"关联的日志配置ID，用于路由请求的日志记录"},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",tips:"控制路由是否启用，禁用的路由不会参与匹配",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"routeMetadata",label:"路由元数据",type:"input",placeholder:"请输入JSON格式的元数据（可选）",span:24,tabKey:"metadata",tips:'用于存储路由的自定义元数据信息，格式为JSON字符串，如：{"key1":"value1","key2":"value2"}',props:{type:"textarea",rows:4}},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"metadata",tips:"路由配置的备注说明信息",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"路由配置的创建时间"},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"路由配置的创建人"},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"路由配置的最后修改时间"},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"路由配置的最后修改人"},{field:"currentVersion",label:"版本号",type:"number",span:12,tabKey:"other",disabled:!0,tips:"路由配置的当前版本号"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:12,tabKey:"other",disabled:!0,show:!1,tips:"路由配置的操作序列标识"}]};return{moduleId:y,loading:C,routeList:o,pageInfo:u,searchFormConfig:h,gridConfig:r,routeFormConfig:_,setRouteList:d,setLoading:p,resetPagination:b,updatePagination:R,addRouteToList:T,updateRouteInList:x,removeRouteFromList:k,removeRoutesFromList:V}}function Ha(y,C){const o=Z(),u=Se(),h=za(),{loading:r,routeList:d,pageInfo:p,setRouteList:b,updatePagination:R,addRouteToList:T,updateRouteInList:x,removeRouteFromList:k,removeRoutesFromList:V}=h,_=async c=>{var a,s,f;r.value=!0;try{let m=c;!m&&((a=C==null?void 0:C.value)!=null&&a.getFormData)&&(m=C.value.getFormData()||{});const G=m?Object.fromEntries(Object.entries(m).filter(([,v])=>v!==""&&v!==null&&v!==void 0)):{},J={...G,...G.gatewayInstanceId===void 0&&y?{gatewayInstanceId:y}:{},...he((s=p.value)==null?void 0:s.pageIndex,(f=p.value)==null?void 0:f.pageSize)},Y=await ct(J);if(Y.oK){if(Y.bizData){const v=JSON.parse(Y.bizData),I=Array.isArray(v)?v:[];b(I)}if(Y.pageQueryData){const v=JSON.parse(Y.pageQueryData);R(v)}}else o.error(Y.errMsg||"查询路由配置列表失败")}catch{o.error("加载路由配置列表失败")}finally{r.value=!1}};return{model:h,loadRouteList:_,handleSearch:async c=>{var a;R({pageIndex:1,pageSize:((a=p.value)==null?void 0:a.pageSize)||20}),await _(c)},handleReset:async()=>{var c;R({pageIndex:1,pageSize:((c=p.value)==null?void 0:c.pageSize)||20}),await _()},handlePageChange:async({currentPage:c,pageSize:a})=>{R({pageIndex:c,pageSize:a}),await _()},addRoute:async c=>{r.value=!0;try{const a=await rt(c);if(K(a)){const s=D(a,"路由配置创建成功");if(o.success(s),a.bizData){const f=JSON.parse(a.bizData);T(f)}else await _();return!0}else{const s=D(a,"新增路由配置失败");return o.error(s),!1}}catch{return o.error("新增路由配置失败"),!1}finally{r.value=!1}},editRoute:async(c,a)=>{r.value=!0;try{const s=await Ce({...a,routeConfigId:c});if(K(s)){const f=D(s,"路由配置更新成功");if(o.success(f),s.bizData){const m=JSON.parse(s.bizData);x(m)}else await _();return!0}else{const f=D(s,"更新路由配置失败");return o.error(f),!1}}catch{return o.error("更新路由配置失败"),!1}finally{r.value=!1}},deleteRoute:async c=>{const a=d.value.find(f=>f.routeConfigId===c);if(!a)return o.error("未找到要删除的路由配置"),!1;if(!await u.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除路由配置 "${a.routeName||a.routeConfigId}" 吗？`,icon:Ee,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;r.value=!0;try{const f=await Me(c);return f.oK?(o.success(D(f,"删除路由配置成功")),k(c),d.value.length===0&&p.value&&p.value.pageIndex>1?(R({pageIndex:p.value.pageIndex-1}),await _()):await _(),!0):(o.error(D(f,"删除路由配置失败")),!1)}catch{return o.error("删除路由配置失败"),!1}finally{r.value=!1}},batchDeleteRoutes:async c=>{if(await u.warning({title:"确认批量删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除选中的 ${c.length} 个路由配置吗？`,icon:Ee,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500})){r.value=!0;try{let s=0,f=0;for(const m of c)try{(await Me(m)).oK?s++:f++}catch{f++}s>0?(o.success(`成功删除 ${s} 个路由配置${f>0?`，失败 ${f} 个`:""}`),V(c.slice(0,s)),await _()):o.error(`删除失败，共 ${f} 个`)}catch{o.error("批量删除失败")}finally{r.value=!1}}},toggleRouteStatus:async c=>{const a=c.activeFlag==="Y"?"N":"Y",s=a==="Y"?"启用":"禁用";try{const f=await Ce({routeConfigId:c.routeConfigId,activeFlag:a});f.oK?(o.success(`${s}成功`),x({...c,activeFlag:a}),await _()):o.error(f.errMsg||`${s}失败`)}catch{o.error(`${s}失败`)}},batchToggleRouteStatus:async(c,a)=>{const s=a==="Y"?"启用":"禁用";try{const f=c.map(J=>d.value.find(v=>v.routeConfigId===J)?Ce({routeConfigId:J,activeFlag:a}):Promise.resolve({oK:!1})),G=(await Promise.all(f)).filter(J=>J.oK).length;G===c.length?o.success(`成功${s} ${G} 个路由配置`):o.warning(`${s}了 ${G}/${c.length} 个路由配置`),await _()}catch{o.error(`批量${s}失败`)}}}}function $a(y,C,o){const u=Z(),h=Ha(y,C),r=P(!1),d=P("create"),p=P(null),b=P(""),R=P(!1),T=P(!1),x=P(!1),k=P(!1),V=P(!1),_=P(!1),w=P(!1),S=P(!1),M=P(!1),N=(v=!0)=>y?!0:(v&&u.warning("请先选择网关实例"),!1),n=()=>{N()&&(d.value="create",r.value=!0,p.value=null)},e=async v=>{if(!N())return null;try{const I=await Ve(v.routeConfigId);if(K(I)){const F=JSON.parse(I.bizData);return d.value="edit",r.value=!0,p.value=F,F}else return u.error(D(I,"获取路由配置详情失败")),null}catch{return u.error("获取路由配置详情失败"),null}},g=async v=>{if(!N())return null;try{const I=await Ve(v.routeConfigId);if(K(I)){const F=JSON.parse(I.bizData);return d.value="view",r.value=!0,p.value=F,F}else return u.error(D(I,"获取路由配置详情失败")),null}catch{return u.error("获取路由配置详情失败"),null}},l=()=>{r.value=!1,p.value=null},i=()=>{if(!p.value)return;const v=p.value,I={...v};if(typeof v.allowedMethods=="string"&&v.allowedMethods)try{I.allowedMethods=JSON.parse(v.allowedMethods)}catch{I.allowedMethods=v.allowedMethods.split(",").map(H=>H.trim()).filter(Boolean)}else Array.isArray(v.allowedMethods)?I.allowedMethods=v.allowedMethods:I.allowedMethods=[];const E=(H=>{if(typeof H=="string"&&H)try{return JSON.parse(H)}catch{return H}return H})(v.routeMetadata);if(E&&typeof E=="object")try{I.routeMetadata=JSON.stringify(E,null,2)}catch{I.routeMetadata="{}"}else I.routeMetadata=v.routeMetadata||"{}";return["responseMergeStrategy","maxConcurrentRequests","requireAllSuccess"].forEach(H=>{E&&typeof E=="object"&&E[H]!==void 0&&(I[`routeMetadata.${H}`]=E[H])}),I},c=async v=>{if(v){if(d.value==="view"){l();return}if(!N())return!1;if(v.routePath){if(!v.routePath.startsWith("/"))return u.warning("路由路径必须以 / 开头"),!1;if(v.matchType===U.REGEX)try{new RegExp(v.routePath)}catch{return u.warning("请输入有效的正则表达式"),!1}}try{const I={...v,gatewayInstanceId:y||v.gatewayInstanceId};let F={};if(I.routeMetadata)if(typeof I.routeMetadata=="string")try{F=JSON.parse(I.routeMetadata)}catch{F={}}else typeof I.routeMetadata=="object"&&(F={...I.routeMetadata});Object.keys(v).forEach(H=>{if(H.startsWith("routeMetadata.")){const ye=H.replace("routeMetadata.","");F[ye]=v[H]}});const E={...I};Object.keys(E).forEach(H=>{H.startsWith("routeMetadata.")&&delete E[H]}),Array.isArray(E.allowedMethods)&&(E.allowedMethods=JSON.stringify(E.allowedMethods)),E.routeMetadata=JSON.stringify(F);let ae=!1;return d.value==="create"?ae=await h.addRoute(E):d.value==="edit"&&p.value&&(ae=await h.editRoute(p.value.routeConfigId,E)),ae&&(l(),h.loadRouteList()),ae}catch{return u.error("操作失败"),!1}}},a=async v=>{N()&&await h.deleteRoute(v.routeConfigId)},s=async()=>{var F,E,ae,H;if(!N())return;if(!(o!=null&&o.value)){u.warning("Grid 引用未设置");return}const v=((E=(F=o.value).getCheckboxRecords)==null?void 0:E.call(F))||((H=(ae=o.value).getSelectRecords)==null?void 0:H.call(ae))||[];if(v.length===0){u.warning("请选择要删除的路由配置");return}const I=v.map(ye=>ye.routeConfigId);await h.batchDeleteRoutes(I)},f=async v=>{if(!N())return;const I=v?{...v,...y?{gatewayInstanceId:y}:{}}:y?{gatewayInstanceId:y}:void 0;await h.handleSearch(I)},m=async(v,I)=>{switch(v){case"add":n();break;case"delete":await s();break;case"search":await f(I);break;case"reset":await h.handleReset();break}},G=async v=>{const{code:I,row:F}=v;if(!F)return;const E=F;switch(I){case"view":await g(E);break;case"edit":await e(E);break;case"assertConfig":b.value=E.routeConfigId,R.value=!0;break;case"filters":b.value=E.routeConfigId,M.value=!0;break;case"ipAccessControl":b.value=E.routeConfigId,T.value=!0;break;case"userAgentAccessControl":b.value=E.routeConfigId,x.value=!0;break;case"apiAccessControl":b.value=E.routeConfigId,k.value=!0;break;case"domainAccessControl":b.value=E.routeConfigId,V.value=!0;break;case"corsConfig":b.value=E.routeConfigId,_.value=!0;break;case"authConfig":b.value=E.routeConfigId,w.value=!0;break;case"rateLimitConfig":b.value=E.routeConfigId,S.value=!0;break;case"delete":await a(E);break}};Ne(()=>{y&&h.loadRouteList()});const J=h.model.routeFormConfig.fields.map(v=>{if(v.field==="serviceDefinitionId"&&v.render){const I=v.render;return{...v,render:F=>I(F,{gatewayInstanceId:y||""})}}return v}),Y={...h.model.routeFormConfig,fields:J};return{service:h,formDialogVisible:r,formDialogMode:d,currentEditRoute:p,currentRouteConfigId:b,assertConfigDialogVisible:R,ipAccessControlDialogVisible:T,userAgentAccessControlDialogVisible:x,apiAccessControlDialogVisible:k,domainAccessControlDialogVisible:V,corsConfigDialogVisible:_,authConfigDialogVisible:w,rateLimitConfigDialogVisible:S,filterConfigDialogVisible:M,routeFormConfig:Y,handleFormSubmit:c,getRouteFormInitialData:i,handleToolbarClick:m,handleMenuClick:G,handleSearch:f,openAddDialog:n,openEditDialog:e,openViewDialog:g,closeFormDialog:l}}const Te=[{label:"路径",value:"PATH",description:"路径匹配断言，用于复杂路径匹配规则"},{label:"请求头",value:"HEADER",description:"请求头断言，检查特定请求头的值"},{label:"查询参数",value:"QUERY",description:"查询参数断言，检查URL查询参数"},{label:"Cookie",value:"COOKIE",description:"Cookie断言，检查特定Cookie的值"},{label:"IP地址",value:"IP",description:"IP地址断言，基于客户端IP进行匹配"}],Ke=[{label:"等于",value:"EQUAL",description:"值必须完全相等"},{label:"不等于",value:"NOT_EQUAL",description:"值必须不相等"},{label:"包含",value:"CONTAINS",description:"值必须包含指定字符串"},{label:"不包含",value:"NOT_CONTAINS",description:"值必须不包含指定字符串"},{label:"正则匹配",value:"MATCHES",description:"值必须匹配正则表达式"},{label:"正则不匹配",value:"NOT_MATCHES",description:"值必须不匹配正则表达式"},{label:"开头匹配",value:"STARTS_WITH",description:"值必须以指定字符串开头"},{label:"结尾匹配",value:"ENDS_WITH",description:"值必须以指定字符串结尾"},{label:"在列表中",value:"IN",description:"值必须在指定列表中"},{label:"不在列表中",value:"NOT_IN",description:"值必须不在指定列表中"}];function Ua(){const y="hub0021-assert-config",C=P(!1),o=P([]),u=P(),h={fields:[{field:"assertionName",label:"断言名称",type:"input",placeholder:"请输入断言名称",span:6,clearable:!0},{field:"assertionType",label:"断言类型",type:"select",placeholder:"请选择断言类型",span:6,clearable:!0,options:[{label:"全部",value:""},...Te.map(n=>({label:n.label,value:n.value}))]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[{key:"add",label:"新增断言",icon:Oe,type:"primary",tooltip:"新增断言配置"},{key:"delete",label:"删除",icon:Pe,type:"error",tooltip:"批量删除选中的断言配置"}],showSearchButton:!0,showResetButton:!0},r=n=>{const e=Te.find(g=>g.value===n);return(e==null?void 0:e.label)||n},d=n=>({PATH:"primary",HEADER:"info",QUERY:"success",COOKIE:"warning",IP:"error"})[n]||"default",p=n=>{const e=Ke.find(g=>g.value===n);return(e==null?void 0:e.label)||n},b={columns:[{field:"routeAssertionId",title:"断言ID",visible:!1,width:0},{field:"assertionOrder",title:"执行顺序",align:"center",width:120,slots:{default:"assertionOrder"}},{field:"assertionName",title:"断言名称",align:"center",showOverflow:"tooltip",width:200},{field:"assertionType",title:"断言类型",align:"center",width:120,slots:{default:"assertionType"}},{field:"assertionOperator",title:"操作符",align:"center",width:120,slots:{default:"assertionOperator"}},{field:"fieldName",title:"字段名称",align:"center",showOverflow:"tooltip",width:150},{field:"expectedValue",title:"期望值/模式",align:"center",showOverflow:"tooltip",width:200,formatter:({row:n})=>n.expectedValue||n.patternValue||"-"},{field:"isRequired",title:"必须匹配",align:"center",width:100,slots:{default:"isRequired"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"assertionDesc",title:"描述",align:"center",showOverflow:"tooltip",width:200},{field:"addTime",title:"创建时间",align:"center",formatter:({row:n})=>ne(n.addTime),width:180},{field:"addWho",title:"创建人",align:"center",showOverflow:"tooltip",width:120},{field:"editTime",title:"修改时间",align:"center",formatter:({row:n})=>ne(n.editTime),width:180},{field:"editWho",title:"修改人",align:"center",showOverflow:"tooltip",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"toggle-status",name:"切换状态",prefixIcon:"vxe-icon-check"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function R(n){o.value=n}function T(n){C.value=n}function x(){u.value=void 0}function k(n){u.value?Object.assign(u.value,n):u.value=n}function V(n){o.value.push(n),o.value.sort((e,g)=>(e.assertionOrder||0)-(g.assertionOrder||0))}function _(n,e,g){const l=o.value.findIndex(i=>i.routeAssertionId===n&&(!e||i.tenantId===e));l!==-1&&(Object.assign(o.value[l],g),o.value.sort((i,c)=>(i.assertionOrder||0)-(c.assertionOrder||0)))}function w(n){const e=o.value.findIndex(g=>g.routeAssertionId===n);e>=0&&o.value.splice(e,1)}function S(n){o.value=o.value.filter(e=>!n.includes(e.routeAssertionId))}const M=[{key:"basic",label:"基本信息"},{key:"other",label:"其他信息"}],N=[{field:"routeAssertionId",label:"断言ID",type:"input",span:12,primary:!0,show:!1},{field:"routeConfigId",label:"路由配置ID",type:"input",span:12,show:!1},{field:"assertionName",label:"断言名称",type:"input",placeholder:"请输入断言名称",span:12,tabKey:"basic",required:!0,rules:[{required:!0,message:"请输入断言名称",trigger:["blur","input"]},{min:2,max:100,message:"断言名称长度应在2-100字符之间",trigger:["blur","input"]}]},{field:"assertionType",label:"断言类型",type:"select",placeholder:"请选择断言类型",span:12,tabKey:"basic",required:!0,defaultValue:"HEADER",options:Te.map(n=>({label:n.label,value:n.value})),rules:[{required:!0,message:"请选择断言类型",trigger:["blur","change"]}]},{field:"assertionOperator",label:"操作符",type:"select",placeholder:"请选择操作符",span:12,tabKey:"basic",required:!0,defaultValue:"EQUAL",options:Ke.map(n=>({label:n.label,value:n.value})),rules:[{required:!0,message:"请选择操作符",trigger:["blur","change"]}]},{field:"assertionOrder",label:"执行顺序",type:"number",placeholder:"数值越小优先级越高",span:12,tabKey:"basic",required:!0,defaultValue:100,props:{min:0,max:9999,precision:0},rules:[{required:!0,type:"number",message:"请输入执行顺序",trigger:["blur","change"]}]},{field:"isRequired",label:"是否必须匹配",type:"select",span:12,tabKey:"basic",required:!0,defaultValue:"Y",options:[{label:"必须匹配",value:"Y"},{label:"可选匹配",value:"N"}],rules:[{required:!0,message:"请选择是否必须匹配",trigger:["change"]}]},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"assertionConfigFieldset",label:"断言配置",type:"fieldset",span:24,tabKey:"basic",children:[{field:"fieldName",label:"字段名称",type:"input",placeholder:"请输入字段名称（HEADER/QUERY/COOKIE类型必填）",span:12,show:n=>["HEADER","QUERY","COOKIE"].includes(n.assertionType),rules:[{validator:(n,e,g)=>["HEADER","QUERY","COOKIE"].includes(g.assertionType)&&(!e||!e.trim())?new Error("请输入字段名称"):!0,trigger:["blur","input"]}]},{field:"expectedValue",label:"期望值",type:"input",placeholder:"请输入期望值",span:24,show:n=>["EQUAL","NOT_EQUAL","CONTAINS","NOT_CONTAINS","STARTS_WITH","ENDS_WITH","IN","NOT_IN"].includes(n.assertionOperator),props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"patternValue",label:"匹配模式",type:"input",placeholder:"请输入正则表达式或匹配模式",span:24,show:n=>["MATCHES","NOT_MATCHES"].includes(n.assertionOperator),props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"caseSensitive",label:"区分大小写",type:"select",span:12,defaultValue:"Y",show:n=>n.assertionType!=="IP",options:[{label:"区分大小写",value:"Y"},{label:"不区分大小写",value:"N"}]},{field:"assertionDesc",label:"断言描述",type:"input",placeholder:"请输入断言描述（可选）",span:24,props:{type:"textarea",rows:3,maxlength:200,showCount:!0}}]},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}];return{moduleId:y,loading:C,assertList:o,pageInfo:u,searchFormConfig:h,gridConfig:b,formFields:N,formTabs:M,getAssertionTypeLabel:r,getAssertionTypeTagType:d,getOperatorLabel:p,setAssertList:R,setLoading:T,resetPagination:x,updatePagination:k,addAssertToList:V,updateAssertInList:_,removeAssertFromList:w,removeAssertsFromList:S}}function Ga(y,C){const o=Z(),u=()=>typeof y=="string"?y:y==null?void 0:y.value,h=Ua(),{pageInfo:r,addAssertToList:d,updateAssertInList:p,removeAssertFromList:b,removeAssertsFromList:R,updatePagination:T,resetPagination:x}=h,k=async l=>{var i,c,a;try{h.setLoading(!0);const s=u();if(!s){h.setAssertList([]),h.resetPagination();return}let f=l;!f&&((i=C==null?void 0:C.value)!=null&&i.getFormData)&&(f=C.value.getFormData()||{});const m=f?Object.fromEntries(Object.entries(f).filter(([,Y])=>Y!==""&&Y!==null&&Y!==void 0)):{},G={routeConfigId:s,...m,...he((c=r.value)==null?void 0:c.pageIndex,(a=r.value)==null?void 0:a.pageSize)},J=await ft(G);if(K(J)){const Y=ee(J,[])||[];if(Array.isArray(Y)&&Y.length>0&&Y.sort((v,I)=>(v.assertionOrder||0)-(I.assertionOrder||0)),h.setAssertList(Y),J.pageQueryData)try{const v=JSON.parse(J.pageQueryData);T(v)}catch(v){console.error("解析分页信息失败:",v),h.resetPagination()}else h.resetPagination()}else o.error(D(J,"加载断言列表失败")),h.setAssertList([]),h.resetPagination()}catch(s){console.error("加载断言列表失败:",s),o.error("加载断言列表失败"),h.setAssertList([]),h.resetPagination()}finally{h.setLoading(!1)}},V=async l=>{try{h.setLoading(!0);const i=u();if(!i)return o.error("路由配置ID不能为空"),!1;const c={routeConfigId:i,assertionName:l.assertionName,assertionType:l.assertionType,assertionOperator:l.assertionOperator,fieldName:l.fieldName||"",expectedValue:l.expectedValue||"",patternValue:l.patternValue||"",caseSensitive:l.caseSensitive||"Y",assertionOrder:l.assertionOrder||100,isRequired:l.isRequired||"Y",assertionDesc:l.assertionDesc||"",activeFlag:l.activeFlag||"Y",noteText:l.noteText||""},a=await dt(c);if(K(a)){if(o.success("添加断言成功"),a.bizData)try{const s=ee(a);if(s)return d(s),!0}catch(s){console.error("解析返回数据失败:",s)}return await k(),!0}else return o.error(D(a,"添加断言失败")),!1}catch(i){return console.error("添加断言失败:",i),o.error("添加断言失败"),!1}finally{h.setLoading(!1)}},_=async l=>{try{h.setLoading(!0);const i=u();if(!i)return o.error("路由配置ID不能为空"),!1;if(!l.routeAssertionId)return o.error("断言ID不能为空"),!1;const c={routeAssertionId:l.routeAssertionId,routeConfigId:i,assertionName:l.assertionName,assertionType:l.assertionType,assertionOperator:l.assertionOperator,fieldName:l.fieldName||"",expectedValue:l.expectedValue||"",patternValue:l.patternValue||"",caseSensitive:l.caseSensitive||"Y",assertionOrder:l.assertionOrder||100,isRequired:l.isRequired||"Y",assertionDesc:l.assertionDesc||"",activeFlag:l.activeFlag||"Y",noteText:l.noteText||""},a=await ut(c);if(K(a)){if(o.success("编辑断言成功"),a.bizData)try{const s=ee(a);if(s)return p(s.routeAssertionId,s.tenantId,s),!0}catch(s){console.error("解析返回数据失败:",s)}return await k(),!0}else return o.error(D(a,"编辑断言失败")),!1}catch(i){return console.error("编辑断言失败:",i),o.error("编辑断言失败"),!1}finally{h.setLoading(!1)}};return{model:h,loadAssertList:k,addAssert:V,editAssert:_,deleteAssert:async l=>{try{h.setLoading(!0);const i=await Le(l);return K(i)?(o.success("删除断言成功"),b(l),!0):(o.error(D(i,"删除断言失败")),!1)}catch(i){return console.error("删除断言失败:",i),o.error("删除断言失败"),!1}finally{h.setLoading(!1)}},deleteAsserts:async l=>{if(!l||l.length===0)return o.warning("请选择要删除的断言"),!1;try{h.setLoading(!0);const i=await Promise.all(l.map(s=>Le(s))),c=i.filter(s=>K(s)).length,a=i.length-c;if(a===0)return o.success(`成功删除 ${c} 个断言`),R(l),!0;if(c>0){o.warning(`部分删除成功：成功 ${c} 个，失败 ${a} 个`);const s=l.filter((f,m)=>K(i[m]));return R(s),!0}else return o.error("批量删除失败"),!1}catch(i){return console.error("批量删除断言失败:",i),o.error("批量删除断言失败"),!1}finally{h.setLoading(!1)}},toggleAssertStatus:async l=>{try{const i=l.activeFlag==="Y"?"N":"Y",c={...l,activeFlag:i};return await _(c)}catch(i){return console.error("切换断言状态失败:",i),o.error("切换断言状态失败"),!1}},handleSearch:async l=>{h.resetPagination(),await k(l)},handleReset:async()=>{h.resetPagination(),await k()},handlePageChange:async({currentPage:l,pageSize:i})=>{T({pageIndex:l,pageSize:i}),await k()},handleRefresh:async()=>{await k()}}}function Ja(y,C,o){const u=Se(),h=Z(),r=Ga(y,o),d=P(!1),p=P("create"),b=P(null),R=()=>{b.value={assertionOrder:100,assertionType:"HEADER",assertionOperator:"EQUAL",caseSensitive:"Y",isRequired:"Y",activeFlag:"Y"},p.value="create",d.value=!0},T=async e=>{try{const g=await pt(e.routeAssertionId);if(K(g)){const l=ee(g);if(l){b.value={...l},p.value="edit",d.value=!0;return}}h.warning(D(g,"获取断言配置失败，使用缓存数据")),b.value={...e},p.value="edit",d.value=!0}catch(g){console.error("打开编辑对话框失败:",g),h.error("获取断言配置失败"),b.value={...e},p.value="edit",d.value=!0}},x=async e=>{try{b.value={...e},p.value="view",d.value=!0}catch(g){console.error("打开查看对话框失败:",g)}},k=()=>{d.value=!1,b.value=null,p.value="create"},V=async e=>{if(e)try{const g=p.value==="edit",l={...e,routeConfigId:typeof y=="string"?y:y==null?void 0:y.value};let i=!1;g?i=await r.editAssert(l):i=await r.addAssert(l),i&&k()}catch(g){console.error("提交表单失败:",g)}},_=async e=>{await r.handleSearch(e)},w=async(e,g)=>{switch(e){case"add":R();break;case"delete":await N();break;case"search":await _(g);break;case"reset":await r.handleReset();break}},S=async e=>{const{code:g,row:l}=e;if(!l)return;const i=l;switch(g){case"view":await x(i);break;case"edit":await T(i);break;case"toggle-status":await n(i);break;case"delete":await M(i);break}},M=async e=>{await u.warning({title:"确认删除",content:`确定要删除断言"${e.assertionName}"吗？`})&&await r.deleteAssert(e.routeAssertionId)},N=async()=>{if(!(C!=null&&C.value))return;const e=C.value.getSelectedRows();if(!e||e.length===0){u.warning({title:"提示",content:"请先选择要删除的断言"});return}if(await u.warning({title:"确认批量删除",content:`确定要删除选中的 ${e.length} 个断言吗？`})){const l=e.map(i=>i.routeAssertionId);await r.deleteAsserts(l)}},n=async e=>{await r.toggleAssertStatus(e)};return{service:r,formDialogVisible:d,formDialogMode:p,currentEditAssert:b,openAddDialog:R,openEditDialog:T,openViewDialog:x,closeFormDialog:k,handleFormSubmit:V,handleSearch:_,handleToolbarClick:w,handleMenuClick:S,handleDelete:M,handleBatchDelete:N,handleToggleStatus:n}}const Ba=["id"],Wa={style:{"font-weight":"bold",color:"#0066cc"}},ja=oe({name:"AssertConfigListModal",__name:"AssertConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{type:[String,Boolean],default:void 0},routeConfigId:{default:""}},emits:["update:visible","close","refresh"],setup(y,{emit:C}){const o=y,u=C,h=P(),r=P(),d=P(o.visible),p=te(()=>o.visible,g=>{d.value=g}),b=P(o.routeConfigId),R=te(()=>o.routeConfigId,g=>{b.value=g});re(()=>{p(),R()});const{service:T,formDialogVisible:x,formDialogMode:k,currentEditAssert:V,handleFormSubmit:_,handleToolbarClick:w,handleMenuClick:S,handleSearch:M,handleToggleStatus:N}=Ja(b,r,h),n=g=>{d.value=g,u("update:visible",g),g?(u("refresh"),T.loadAssertList()):u("close")},e=()=>{d.value||(x.value=!1,k.value="create",V.value=null,T.model.assertList.value=[],T.model.resetPagination())};return(g,l)=>(z(),se(t(ke),{visible:d.value,title:o.title||"路由断言配置列表",width:o.width||1200,to:o.to,"show-footer":!1,"onUpdate:visible":n,onAfterLeave:e},{default:O(()=>[L("div",{class:"assert-config-list-modal",id:t(T).model.moduleId},[A(t(ue),{direction:"vertical","no-resize":!0},{1:O(()=>[A(me,ie({ref_key:"searchFormRef",ref:h,"module-id":t(T).model.moduleId},t(T).model.searchFormConfig,{onSearch:t(M),onToolbarClick:t(w)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:O(()=>[A(t(be),ie({ref_key:"gridRef",ref:r,"module-id":t(T).model.moduleId,data:t(T).model.assertList,loading:t(T).model.loading},t(T).model.gridConfig,{onPageChange:t(T).handlePageChange,onMenuClick:l[0]||(l[0]=({code:i,row:c})=>t(S)({code:i,row:c}))}),{assertionOrder:O(({row:i})=>[L("span",Wa,q(i.assertionOrder),1)]),assertionType:O(({row:i})=>[A(t(B),{type:t(T).model.getAssertionTypeTagType(i.assertionType),size:"small"},{default:O(()=>[$(q(t(T).model.getAssertionTypeLabel(i.assertionType)),1)]),_:2},1032,["type"])]),assertionOperator:O(({row:i})=>[A(t(B),{type:"info",size:"small"},{default:O(()=>[$(q(t(T).model.getOperatorLabel(i.assertionOperator)),1)]),_:2},1024)]),isRequired:O(({row:i})=>[A(t(B),{type:i.isRequired==="Y"?"error":"default",size:"small"},{default:O(()=>[$(q(i.isRequired==="Y"?"必须":"可选"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:i})=>[A(t(Re),{value:i.activeFlag==="Y","onUpdate:value":()=>t(N)(i),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),A(ve,{visible:t(x),"onUpdate:visible":l[1]||(l[1]=i=>Q(x)?x.value=i:null),mode:t(k),title:t(k)==="create"?"新增断言配置":t(k)==="edit"?"编辑断言配置":"查看断言配置详情",to:`#${t(T).model.moduleId}`,"form-fields":t(T).model.formFields,"form-tabs":t(T).model.formTabs,"initial-data":t(V)||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(T).model.loading.value,onSubmit:t(_)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,Ba)]),_:1},8,["visible","title","width","to"]))}}),Qa=le(ja,[["__scopeId","data-v-4e2123b5"]]),Xa={class:"route-config-list",id:"hub0021-route-config-list"},Za={class:"route-name-text"},ei={class:"http-methods-container"},ti={key:0,class:"http-method-more"},ai={key:1,class:"http-method-empty"},ii=oe({name:"RouteConfigList",__name:"RouteConfigList",props:{gatewayInstanceId:{default:void 0}},setup(y,{expose:C}){const o=y,u=P(),h=P(),{service:r,formDialogVisible:d,formDialogMode:p,routeFormConfig:b,handleFormSubmit:R,getRouteFormInitialData:T,handleToolbarClick:x,handleMenuClick:k,handleSearch:V,currentRouteConfigId:_,assertConfigDialogVisible:w,ipAccessControlDialogVisible:S,userAgentAccessControlDialogVisible:M,apiAccessControlDialogVisible:N,domainAccessControlDialogVisible:n,corsConfigDialogVisible:e,authConfigDialogVisible:g,rateLimitConfigDialogVisible:l,filterConfigDialogVisible:i}=$a(o.gatewayInstanceId,u,h),c=te(()=>o.gatewayInstanceId,(v,I)=>{v&&v!==I?r.loadRouteList({gatewayInstanceId:v}):!v&&I&&(r.model.routeList.value=[])},{immediate:!1});re(()=>{c()});function a(v){if(!o.gatewayInstanceId)return;const I=v?{...v,...o.gatewayInstanceId?{gatewayInstanceId:o.gatewayInstanceId}:{}}:o.gatewayInstanceId?{gatewayInstanceId:o.gatewayInstanceId}:void 0;V(I)}function s(v){return{[U.EXACT]:"success",[U.PREFIX]:"info",[U.REGEX]:"warning"}[v]||"default"}function f(v){return{[U.EXACT]:"精确匹配",[U.PREFIX]:"前缀匹配",[U.REGEX]:"正则匹配"}[v]||"未知"}function m(v){if(!v)return[];if(Array.isArray(v))return v;if(typeof v=="string")try{const I=JSON.parse(v);return Array.isArray(I)?I:[]}catch{return[]}return[]}function G(v){return m(v).slice(0,2)}function J(v){const I=m(v);return Math.max(0,I.length-2)}function Y(v){return{GET:"method-get",POST:"method-post",PUT:"method-put",DELETE:"method-delete",PATCH:"method-patch",HEAD:"method-head",OPTIONS:"method-options"}[v.toUpperCase()]||"method-default"}return C({refresh:()=>{r.loadRouteList()}}),(v,I)=>(z(),j("div",Xa,[A(t(ue),{direction:"vertical","default-size":.1,min:.1,max:.5},{1:O(()=>[A(me,ie({ref_key:"searchFormRef",ref:u,"module-id":t(r).model.moduleId},t(r).model.searchFormConfig,{onSearch:a,onToolbarClick:t(x)}),null,16,["module-id","onToolbarClick"])]),2:O(()=>[A(t(be),ie({ref_key:"gridRef",ref:h,"module-id":t(r).model.moduleId,data:t(r).model.routeList,loading:t(r).model.loading},t(r).model.gridConfig,{onPageChange:t(r).handlePageChange,onMenuClick:t(k)}),{routeName:O(({row:F})=>[L("span",Za,q(F.routeName),1)]),matchType:O(({row:F})=>[A(t(B),{type:s(F.matchType),size:"small"},{default:O(()=>[$(q(f(F.matchType)),1)]),_:2},1032,["type"])]),allowedMethods:O(({row:F})=>[L("div",ei,[m(F.allowedMethods).length>0?(z(),j(Ie,{key:0},[(z(!0),j(Ie,null,Ye(G(F.allowedMethods),(E,ae)=>(z(),j("span",{key:E,class:Xe(["http-method-tag",Y(E)])},q(E),3))),128)),J(F.allowedMethods)>0?(z(),j("span",ti," +"+q(J(F.allowedMethods)),1)):_e("",!0)],64)):(z(),j("span",ai,"全部"))])]),enableWebsocket:O(({row:F})=>[A(t(B),{type:F.enableWebsocket==="Y"?"success":"default",size:"small"},{default:O(()=>[$(q(F.enableWebsocket==="Y"?"支持":"不支持"),1)]),_:2},1032,["type"])]),activeFlag:O(({row:F})=>[A(t(B),{type:F.activeFlag==="Y"?"success":"error",size:"small"},{default:O(()=>[$(q(F.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),A(ve,{visible:t(d),"onUpdate:visible":I[0]||(I[0]=F=>Q(d)?d.value=F:null),mode:t(p),title:t(p)==="create"?"新增路由配置":t(p)==="edit"?"编辑路由配置":"查看路由配置详情",to:"#hub0021-route-config-list","form-fields":t(b).fields,"form-tabs":t(b).tabs,"initial-data":t(T)()||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(r).model.loading.value,onSubmit:t(R)},null,8,["visible","mode","title","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),A(t(Qa),{visible:t(w),"onUpdate:visible":I[1]||(I[1]=F=>Q(w)?w.value=F:null),"route-config-id":t(_),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(bt,{visible:t(S),"onUpdate:visible":I[2]||(I[2]=F=>Q(S)?S.value=F:null),"security-config-id":t(_),title:"IP访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(mt,{visible:t(M),"onUpdate:visible":I[3]||(I[3]=F=>Q(M)?M.value=F:null),"security-config-id":t(_),title:"User-Agent访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(vt,{visible:t(N),"onUpdate:visible":I[4]||(I[4]=F=>Q(N)?N.value=F:null),"security-config-id":t(_),title:"API访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(yt,{visible:t(n),"onUpdate:visible":I[5]||(I[5]=F=>Q(n)?n.value=F:null),"security-config-id":t(_),title:"域名访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(Ct,{visible:t(e),"onUpdate:visible":I[6]||(I[6]=F=>Q(e)?e.value=F:null),"route-config-id":t(_),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(wt,{visible:t(g),"onUpdate:visible":I[7]||(I[7]=F=>Q(g)?g.value=F:null),"route-config-id":t(_),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(Tt,{visible:t(l),"onUpdate:visible":I[8]||(I[8]=F=>Q(l)?l.value=F:null),"route-config-id":t(_),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(t(He),{visible:t(i),"onUpdate:visible":I[9]||(I[9]=F=>Q(i)?i.value=F:null),"route-config-id":t(_),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"])]))}}),oi=le(ii,[["__scopeId","data-v-f5fd230f"]]),li={class:"left-panel"},De="route-management",ni=oe({name:"RouteManagement",__name:"RouteManagement",setup(y){const C=P(""),o=ce(()=>C.value||"");function u(h,r){C.value=h}return(h,r)=>(z(),j("div",{class:"route-management",id:De},[A(t(ue),{direction:"horizontal","default-size":.25,max:.4},{1:O(()=>[L("div",li,[A(t(Xt),{"parent-module-id":De,onSelect:u})])]),2:O(()=>[(z(),se(t(oi),{"gateway-instance-id":o.value,key:`routes-${o.value}`},null,8,["gateway-instance-id"]))]),_:1})]))}}),Ei=le(ni,[["__scopeId","data-v-db1572a6"]]);export{Ei as default};

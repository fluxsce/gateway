import{G as R}from"./GDataFormModal-jCrkrfPz.js";import{G as A,S as B}from"./SearchForm-DCaazdSn.js";import{G as D}from"./GPane-BTUOh7ra.js";import{m as M,r as y,d as W,c as x,b as m,w as c,e as i,cr as E,o as g,am as G,aO as S,K as F,t as C,i as $,g as T,_ as z}from"./index-DFGZIhYV.js";import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-DHrAwNdU.js";import{u as J}from"./useGDialog-Drbk1sbt.js";import{u as U}from"./useServiceCenterInstanceService-nOTsS2nY.js";import{R as Y}from"./RefreshOutline-Bblwr7zk.js";import{S as O}from"./StopCircleOutline-BcZIFQQh.js";import{P as V}from"./PlayCircleOutline-BOsVZ051.js";import{C as H}from"./CheckmarkCircleOutline-CyuISCiF.js";import{A as K}from"./AlertCircleOutline-Db7SqGAd.js";import{H as j}from"./HourglassOutline-DucYdKJ2.js";import"./GModal-BU-dfYjc.js";import"./ContractOutline-BOuVM6SO.js";import"./CloseOutline-DXK2Avno.js";import"./index-DURQnJ_r.js";import"./Select-BxZMQlCt.js";import"./DownloadOutline-DDFeFH05.js";import"./Upload-B0GKjiF_.js";import"./download-C2161hUv.js";import"./DocumentOutline-B9-kJVq4.js";import"./GDialog-CJ7WdD4F.js";import"./KeyOutline-BtT_SO51.js";import"./AddOutline-DgCmJB8N.js";import"./CreateOutline-BRBQ9kgF.js";import"./TrashOutline-DQN-WA1t.js";import"./DynamicTags-Dl_aAkgj.js";import"./prop-NnGblK-3.js";import"./WarningOutline-CMATMreo.js";function q(d,b){const o=M(),r=J(),s=U(b),f=y(!1),u=y("create"),l=y(null),k=y(!1),I=()=>{u.value="create",l.value=null,f.value=!0},v=async a=>{try{const e=await s.getInstanceDetail(a.instanceName,a.environment);if(!e){o.error("获取实例详情失败");return}const t={...e};if(e.certContent?t.certFileList=[{id:"cert-file",name:e.certFilePath||"certificate.pem",content:e.certContent,status:"finished"}]:t.certFileList=[],e.keyContent?t.keyFileList=[{id:"key-file",name:e.keyFilePath||"private-key.pem",content:e.keyContent,status:"finished"}]:t.keyFileList=[],t.ipWhitelist&&typeof t.ipWhitelist=="string")try{t.ipWhitelist=JSON.parse(t.ipWhitelist)}catch{t.ipWhitelist=[]}if(t.ipBlacklist&&typeof t.ipBlacklist=="string")try{t.ipBlacklist=JSON.parse(t.ipBlacklist)}catch{t.ipBlacklist=[]}u.value="edit",l.value=t,f.value=!0}catch{o.error("获取实例详情失败")}},N=()=>{f.value=!1,l.value=null},P=async a=>{try{const e=await s.getInstanceDetail(a.instanceName,a.environment);if(!e){o.error("获取实例详情失败");return}const t={...e};if(e.certContent?t.certFileList=[{id:"cert-file",name:e.certFilePath||"certificate.pem",content:e.certContent,status:"finished"}]:t.certFileList=[],e.keyContent?t.keyFileList=[{id:"key-file",name:e.keyFilePath||"private-key.pem",content:e.keyContent,status:"finished"}]:t.keyFileList=[],t.ipWhitelist&&typeof t.ipWhitelist=="string")try{t.ipWhitelist=JSON.parse(t.ipWhitelist)}catch{t.ipWhitelist=[]}if(t.ipBlacklist&&typeof t.ipBlacklist=="string")try{t.ipBlacklist=JSON.parse(t.ipBlacklist)}catch{t.ipBlacklist=[]}u.value="view",l.value=t,f.value=!0}catch{o.error("获取实例详情失败")}},_=async a=>{await s.handleSearch(a)},p=async a=>{if(a&&u.value!=="view"){k.value=!0;try{const e={...a};if(e.certFileList&&Array.isArray(e.certFileList)&&e.certFileList.length>0){const t=e.certFileList[0];t&&(t.content&&(e.certContent=t.content),t.name&&(e.certFilePath=t.name))}else u.value==="edit"&&l.value&&l.value.certFilePath&&!e.certFilePath&&(e.certFilePath=l.value.certFilePath);if(delete e.certFileList,e.keyFileList&&Array.isArray(e.keyFileList)&&e.keyFileList.length>0){const t=e.keyFileList[0];t&&(t.content&&(e.keyContent=t.content),t.name&&(e.keyFilePath=t.name))}else u.value==="edit"&&l.value&&l.value.keyFilePath&&!e.keyFilePath&&(e.keyFilePath=l.value.keyFilePath);if(delete e.keyFileList,Array.isArray(e.ipWhitelist)&&(e.ipWhitelist=e.ipWhitelist.length>0?JSON.stringify(e.ipWhitelist):""),Array.isArray(e.ipBlacklist)&&(e.ipBlacklist=e.ipBlacklist.length>0?JSON.stringify(e.ipBlacklist):""),u.value==="create")await s.addInstance(e)&&N();else if(u.value==="edit"){if(!l.value)return;await s.editInstance({...e,instanceName:l.value.instanceName,environment:l.value.environment})&&N()}}finally{k.value=!1}}},h=async(a,e)=>{switch(a){case"add":I();break;case"edit":{if(!(d!=null&&d.value)){o.warning("Grid 引用未设置");return}const t=d.value.getCurrentRecord();if(!t){o.warning("请先点击选择要编辑的实例");return}await v(t);break}case"delete":{if(!(d!=null&&d.value)){o.warning("Grid 引用未设置");return}const t=d.value.getCurrentRecord();if(!t){o.warning("请先点击选择要删除的实例");return}await s.deleteInstance(t);break}case"search":{await s.handleSearch(e);break}}},n=async a=>{await r.warning({title:"确认启动",subtitle:"启动后将开始处理请求",content:`确定要启动实例"${a.instanceName}" (${a.environment}) 吗？`,icon:V,headerStyle:"gradient",positiveText:"确定启动",negativeText:"取消",width:500})&&s.startInstance(a)},L=async a=>{await r.warning({title:"确认停止",subtitle:"停止后将无法处理请求",content:`确定要停止实例"${a.instanceName}" (${a.environment}) 吗？`,icon:O,headerStyle:"gradient",positiveText:"确定停止",negativeText:"取消",width:500})&&s.stopInstance(a)},w=async a=>{await r.warning({title:"确认重载配置",subtitle:"重载将重新加载配置",content:`确定要对实例"${a.instanceName}" (${a.environment}) 执行配置重载操作吗？`,icon:Y,headerStyle:"gradient",positiveText:"确定重载",negativeText:"取消",width:500})&&s.reloadInstance(a)};return{service:s,formDialogVisible:f,formDialogMode:u,currentEditInstance:l,submitting:k,openAddDialog:I,openEditDialog:v,openViewDialog:P,handleFormSubmit:p,handleToolbarClick:h,handleMenuClick:async({code:a,row:e})=>{if(e)switch(a){case"view":await P(e);break;case"edit":await v(e);break;case"delete":await s.deleteInstance(e);break;case"start":n(e);break;case"stop":L(e);break;case"reload":w(e);break}},handleSearch:_,handleStartInstance:n,handleStopInstance:L,handleReloadInstance:w}}const Q=["id"],X=W({name:"ServiceCenterInstanceManager",__name:"ServiceCenterInstanceManager",setup(d){const b=y(),o=y(),{service:r,formDialogVisible:s,formDialogMode:f,currentEditInstance:u,submitting:l,handleFormSubmit:k,handleToolbarClick:I,handleMenuClick:v,handleSearch:N}=q(o,b);function P(p){return{RUNNING:"success",STOPPED:"default",STARTING:"info",STOPPING:"warning",ERROR:"error"}[p]||"default"}function _(p){return{RUNNING:"运行中",STOPPED:"停止",STARTING:"启动中",STOPPING:"停止中",ERROR:"异常"}[p]||p}return(p,h)=>(g(),x("div",{class:"service-center-instance-manager",id:i(r).model.moduleId},[m(i(D),{direction:"vertical","default-size":"80px"},{1:c(()=>[m(B,G({ref_key:"searchFormRef",ref:b,"module-id":i(r).model.moduleId},i(r).model.searchFormConfig,{onSearch:i(N),onToolbarClick:i(I)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:c(()=>[m(i(A),G({ref_key:"gridRef",ref:o,"module-id":i(r).model.moduleId,data:i(r).model.instanceList,loading:i(r).model.loading},i(r).model.gridConfig,{onPageChange:i(r).handlePageChange,onMenuClick:i(v)}),{instanceStatus:c(({row:n})=>[m(i(S),{type:P(n.instanceStatus),size:"small"},{icon:c(()=>[m(i($),null,{default:c(()=>[n.instanceStatus==="RUNNING"?(g(),T(i(H),{key:0})):n.instanceStatus==="ERROR"?(g(),T(i(K),{key:1})):n.instanceStatus==="STARTING"||n.instanceStatus==="STOPPING"?(g(),T(i(j),{key:2})):(g(),T(i(O),{key:3}))]),_:2},1024)]),default:c(()=>[F(" "+C(_(n.instanceStatus)),1)]),_:2},1032,["type"])]),isRunning:c(({row:n})=>[m(i(S),{type:n.instanceStatus==="RUNNING"?"success":"default",size:"small"},{default:c(()=>[F(C(n.instanceStatus==="RUNNING"?"运行中":"已停止"),1)]),_:2},1032,["type"])]),enableTLS:c(({row:n})=>[m(i(S),{type:n.enableTLS==="Y"?"success":"default",size:"small"},{default:c(()=>[F(C(n.enableTLS==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),enableAuth:c(({row:n})=>[m(i(S),{type:n.enableAuth==="Y"?"warning":"default",size:"small"},{default:c(()=>[F(C(n.enableAuth==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),activeFlag:c(({row:n})=>[m(i(S),{type:n.activeFlag==="Y"?"success":"default",size:"small"},{default:c(()=>[F(C(n.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),m(R,{visible:i(s),"onUpdate:visible":h[0]||(h[0]=n=>E(s)?s.value=n:null),mode:i(f),title:i(f)==="create"?"新增实例":i(f)==="edit"?"编辑实例":"查看实例详情",to:`#${i(r).model.moduleId}`,"form-fields":i(r).model.instanceFormConfig.fields,"form-tabs":i(r).model.instanceFormConfig.tabs,"initial-data":i(u)||void 0,"auto-close-on-confirm":!1,"confirm-loading":i(l),onSubmit:i(k)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,Q))}}),we=z(X,[["__scopeId","data-v-0bc1b6d9"]]);export{we as default};

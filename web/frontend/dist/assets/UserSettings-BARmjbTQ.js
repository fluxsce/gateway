import{p as q,m as de,bT as he,x as J,y as b,j as k,r as I,z as Q,B as Z,A as Ne,d as Pe,q as Ie,c as ie,b as l,w as s,e,I as Fe,o as K,a9 as ye,C as Ue,D as Ce,E as Ae,f as R,F as Se,bU as Te,J as Re,K as m,t as u,G as ke,bV as De,bW as ze,bX as Le,aQ as xe,bY as Be,g as Ee,aO as qe,_ as Ge}from"./index-DVVs4J_g.js";import{N as Oe}from"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-rwsE82tp.js";import{c as Ve,e as Me,g as Ye}from"./index-DkC_KOv2.js";import{N as je}from"./Upload-KD8QX-hv.js";import{a as He,N as We}from"./RadioGroup-BJQR2soo.js";import{N as $e}from"./Alert-Dd2hqmvx.js";import{N as Je}from"./Select-DNy4pOft.js";import"./download-C2161hUv.js";function Qe(){const{t:d}=q("hub0002");q("common");const a=de(),y=he(),U=I(null),P=I(null),g=I(!1),C=I(!1),A=I(!1),o=I(null),p=J({userId:"",userName:"",realName:"",email:"",mobile:"",gender:0,avatar:"",deptName:"",tenantId:""}),D=async()=>{try{if(g.value=!0,!b.user.isAuthenticated){a.error(d("profile.fetchFailed"));return}const i=await Ye(b.user.userId,b.user.tenantId);if(Q(i)){const r=Ne(i);o.value=r,Object.assign(p,{userId:r.userId,userName:r.userName,realName:r.realName,email:r.email||"",mobile:r.mobile||"",gender:r.gender||0,avatar:r.avatar||"",deptName:r.deptName||"",tenantId:r.tenantId})}else a.error(Z(i,d("profile.fetchFailed")))}catch(i){console.error("Fetch user info error:",i),a.error(d("profile.fetchFailed"))}finally{g.value=!1}},G=()=>{o.value&&Object.assign(p,{userId:o.value.userId,userName:o.value.userName,realName:o.value.realName,email:o.value.email||"",mobile:o.value.mobile||"",gender:o.value.gender||0,avatar:o.value.avatar||"",deptName:o.value.deptName||"",tenantId:o.value.tenantId})},w={realName:[{required:!0,message:()=>d("profile.realNameRequired"),trigger:["blur","input"]},{min:2,max:50,message:()=>d("profile.realNameLength"),trigger:["blur","input"]}],email:[{type:"email",message:()=>d("profile.emailInvalid"),trigger:["blur","input"]}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:()=>d("profile.mobileInvalid"),trigger:["blur","input"]}]},_=J({oldPassword:"",newPassword:"",confirmPassword:""}),O={oldPassword:[{required:!0,message:()=>d("password.oldPasswordRequired"),trigger:["blur","input"]}],newPassword:[{required:!0,message:()=>d("password.newPasswordRequired"),trigger:["blur","input"]},{min:8,max:20,message:()=>d("password.passwordLength"),trigger:["blur","input"]},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,message:()=>d("password.passwordPattern"),trigger:["blur","input"]}],confirmPassword:[{required:!0,message:()=>d("password.confirmPasswordRequired"),trigger:["blur","input"]},{validator:(i,r)=>r!==_.newPassword?new Error(d("password.passwordMismatch")):!0,trigger:["blur","input"]}]},S=J({theme:b.user.theme,language:b.user.language,showGuide:!1,notificationEnabled:!0}),v=k(()=>[{label:d("settings.lightTheme"),value:"light"},{label:d("settings.darkTheme"),value:"dark"},{label:d("settings.autoTheme"),value:"auto"}]),V=k(()=>[{label:"简体中文",value:"zh-CN"},{label:"English",value:"en"}]),M=async()=>{var i;try{if(await((i=U.value)==null?void 0:i.validate()),C.value=!0,!o.value){a.error(d("profile.saveFailed"));return}const r=await Me({userId:p.userId,tenantId:p.tenantId,userName:p.userName,realName:p.realName,deptId:o.value.deptId||"",email:p.email,mobile:p.mobile,gender:p.gender,avatar:p.avatar,statusFlag:o.value.statusFlag||"Y",deptAdminFlag:o.value.deptAdminFlag||"N",tenantAdminFlag:o.value.tenantAdminFlag||"N",userExpireDate:o.value.userExpireDate||"",addTime:o.value.addTime||new Date().toISOString(),addWho:o.value.addWho||o.value.userId,editTime:new Date().toISOString(),editWho:o.value.userId,oprSeqFlag:o.value.oprSeqFlag||"",currentVersion:o.value.currentVersion||1,activeFlag:o.value.activeFlag||"Y"});Q(r)?(a.success(d("profile.saveSuccess")),await D(),b.user.update({realName:p.realName,email:p.email,mobile:p.mobile,avatar:p.avatar})):a.error(Z(r,d("profile.saveFailed")))}catch(r){r!=null&&r.errorFields?a.error(d("profile.validationFailed")):(console.error("Save profile error:",r),a.error(d("profile.saveFailed")))}finally{C.value=!1}},Y=()=>{var i;G(),(i=U.value)==null||i.restoreValidation()},j=async()=>{var i;try{await((i=P.value)==null?void 0:i.validate()),A.value=!0;const r=await Ve({userId:b.user.userId,tenantId:b.user.tenantId,oldPassword:_.oldPassword,newPassword:_.newPassword});Q(r)?(a.success(d("password.changeSuccess")),z(),setTimeout(()=>{b.user.clearUserInfo(),window.location.href="/"},2e3)):a.error(Z(r,d("password.changeFailed")))}catch(r){r!=null&&r.errorFields?a.error(d("password.validationFailed")):(console.error("Change password error:",r),a.error(d("password.changeFailed")))}finally{A.value=!1}},z=()=>{var i;_.oldPassword="",_.newPassword="",_.confirmPassword="",(i=P.value)==null||i.restoreValidation()};return{userInfo:o,loading:g,fetchUserInfo:D,profileForm:p,profileFormRef:U,profileRules:w,savingProfile:C,handleSaveProfile:M,handleResetProfile:Y,passwordForm:_,passwordFormRef:P,passwordRules:O,changingPassword:A,handleChangePassword:j,handleResetPassword:z,settingsForm:S,themeOptions:v,languageOptions:V,handleThemeChange:i=>{b.user.updateSettings({theme:i}),a.success(d("settings.themeChanged"))},handleLanguageChange:i=>{b.user.updateSettings({language:i}),y.locale.value=i,a.success(d("settings.languageChanged"))},handleNotificationChange:i=>{S.notificationEnabled=i,a.success(d(i?"settings.notificationEnabled":"settings.notificationDisabled"))},handleGuideChange:i=>{S.showGuide=i},convertFileToBase64:i=>new Promise((r,L)=>{const F=new FileReader;F.readAsDataURL(i),F.onload=()=>r(F.result),F.onerror=H=>L(H)})}}const Ze="/gatewayweb/assets/logo-CQ1xvCtI.png",Ke={class:"user-settings-container"},Xe={class:"avatar-section"},ea={class:"avatar-upload"},aa=["innerHTML"],la={class:"setting-desc"},sa={class:"setting-desc"},ta=Pe({__name:"UserSettings",setup(d){const{t:a}=q("hub0002");q("common");const y=de(),U=I("profile"),P=I(""),{userInfo:g,loading:C,fetchUserInfo:A,profileForm:o,profileFormRef:p,profileRules:D,savingProfile:G,passwordForm:w,passwordFormRef:_,passwordRules:O,changingPassword:S,settingsForm:v,themeOptions:V,languageOptions:M,handleSaveProfile:Y,handleResetProfile:j,handleChangePassword:z,handleResetPassword:X,handleThemeChange:ee,handleLanguageChange:ae,handleNotificationChange:le,handleGuideChange:se,convertFileToBase64:i}=Qe(),r=k(()=>{var f;return((f=g.value)==null?void 0:f.tenantAdminFlag)==="Y"}),L=k(()=>{var f;return((f=g.value)==null?void 0:f.deptAdminFlag)==="Y"}),F=k(()=>{var f;return(f=g.value)==null?void 0:f.statusFlag}),H=async f=>{const n=f.file.file;return n.size>500*1024?(y.error(a("profile.avatarSizeLimitBase64")),!1):["image/jpeg","image/png","image/gif"].includes(n.type)?!0:(y.error(a("profile.avatarTypeInvalid")),!1)},ue=async({file:f})=>{try{if(!f.file)return;const n=await i(f.file);if(n.length>500*1024){y.error(a("profile.avatarSizeLimitBase64"));return}P.value=n,o.avatar=n}catch(n){console.error("Avatar upload error:",n),y.error(a("profile.avatarUploadFailed"))}},pe=async()=>{await Y(),P.value=""},ce=()=>{j(),P.value=""};return Ie(async()=>{await A()}),(f,n)=>{const te=Te,T=Re,me=je,c=Se,h=ke,W=We,x=De,fe=He,$=Ae,B=Ce,ge=$e,oe=Je,ne=Oe,N=Le,E=qe,ve=ze,be=Ue,we=ye,_e=Fe;return K(),ie("div",Ke,[l(_e,{show:e(C)},{default:s(()=>[l(we,{title:e(a)("title"),bordered:!1},{default:s(()=>[l(be,{value:U.value,"onUpdate:value":n[14]||(n[14]=t=>U.value=t),type:"line",animated:""},{default:s(()=>[l(B,{name:"profile",tab:e(a)("tabs.profile")},{default:s(()=>[l($,{ref_key:"profileFormRef",ref:p,model:e(o),rules:e(D),"label-placement":"left","label-width":"120",size:"medium",class:"profile-form"},{default:s(()=>[R("div",Xe,[l(c,{label:e(a)("profile.avatar")},{default:s(()=>[R("div",ea,[l(te,{size:80,src:P.value||e(o).avatar||e(Ze),class:"user-avatar"},null,8,["src"]),l(me,{"show-file-list":!1,"custom-request":ue,accept:"image/*",onBeforeUpload:H},{default:s(()=>[l(T,{size:"small",class:"upload-btn"},{default:s(()=>[m(u(e(a)("profile.changeAvatar")),1)]),_:1})]),_:1})])]),_:1},8,["label"])]),l(c,{label:e(a)("profile.userId"),path:"userId"},{default:s(()=>[l(h,{value:e(o).userId,"onUpdate:value":n[0]||(n[0]=t=>e(o).userId=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(c,{label:e(a)("profile.userName"),path:"userName"},{default:s(()=>[l(h,{value:e(o).userName,"onUpdate:value":n[1]||(n[1]=t=>e(o).userName=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(c,{label:e(a)("profile.realName"),path:"realName"},{default:s(()=>[l(h,{value:e(o).realName,"onUpdate:value":n[2]||(n[2]=t=>e(o).realName=t),placeholder:e(a)("profile.realNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(c,{label:e(a)("profile.email"),path:"email"},{default:s(()=>[l(h,{value:e(o).email,"onUpdate:value":n[3]||(n[3]=t=>e(o).email=t),placeholder:e(a)("profile.emailPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(c,{label:e(a)("profile.mobile"),path:"mobile"},{default:s(()=>[l(h,{value:e(o).mobile,"onUpdate:value":n[4]||(n[4]=t=>e(o).mobile=t),placeholder:e(a)("profile.mobilePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(c,{label:e(a)("profile.gender"),path:"gender"},{default:s(()=>[l(fe,{value:e(o).gender,"onUpdate:value":n[5]||(n[5]=t=>e(o).gender=t)},{default:s(()=>[l(x,null,{default:s(()=>[l(W,{value:1},{default:s(()=>[m(u(e(a)("profile.male")),1)]),_:1}),l(W,{value:2},{default:s(()=>[m(u(e(a)("profile.female")),1)]),_:1}),l(W,{value:0},{default:s(()=>[m(u(e(a)("profile.unknown")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),l(c,{label:e(a)("profile.deptName")},{default:s(()=>[l(h,{value:e(o).deptName,"onUpdate:value":n[6]||(n[6]=t=>e(o).deptName=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(c,null,{default:s(()=>[l(x,null,{default:s(()=>[l(T,{type:"primary",loading:e(G),onClick:pe},{default:s(()=>[m(u(e(a)("common.save")),1)]),_:1},8,["loading"]),l(T,{onClick:ce},{default:s(()=>[m(u(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),l(B,{name:"password",tab:e(a)("tabs.password")},{default:s(()=>[l($,{ref_key:"passwordFormRef",ref:_,model:e(w),rules:e(O),"label-placement":"left","label-width":"120",size:"medium",class:"password-form"},{default:s(()=>[l(c,{label:e(a)("password.oldPassword"),path:"oldPassword"},{default:s(()=>[l(h,{value:e(w).oldPassword,"onUpdate:value":n[7]||(n[7]=t=>e(w).oldPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(c,{label:e(a)("password.newPassword"),path:"newPassword"},{default:s(()=>[l(h,{value:e(w).newPassword,"onUpdate:value":n[8]||(n[8]=t=>e(w).newPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.newPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(c,{label:e(a)("password.confirmPassword"),path:"confirmPassword"},{default:s(()=>[l(h,{value:e(w).confirmPassword,"onUpdate:value":n[9]||(n[9]=t=>e(w).confirmPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(ge,{type:"info","show-icon":!1,class:"password-tips"},{default:s(()=>[R("div",{innerHTML:e(a)("password.tips")},null,8,aa)]),_:1}),l(c,null,{default:s(()=>[l(x,null,{default:s(()=>[l(T,{type:"primary",loading:e(S),onClick:e(z)},{default:s(()=>[m(u(e(a)("password.changeButton")),1)]),_:1},8,["loading","onClick"]),l(T,{onClick:e(X)},{default:s(()=>[m(u(e(a)("common.reset")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),l(B,{name:"settings",tab:e(a)("tabs.settings")},{default:s(()=>[l($,{model:e(v),"label-placement":"left","label-width":"120",size:"medium",class:"settings-form"},{default:s(()=>[l(c,{label:e(a)("settings.theme")},{default:s(()=>[l(oe,{value:e(v).theme,"onUpdate:value":[n[10]||(n[10]=t=>e(v).theme=t),e(ee)],options:e(V)},null,8,["value","options","onUpdate:value"])]),_:1},8,["label"]),l(c,{label:e(a)("settings.language")},{default:s(()=>[l(oe,{value:e(v).language,"onUpdate:value":[n[11]||(n[11]=t=>e(v).language=t),e(ae)],options:e(M)},null,8,["value","options","onUpdate:value"])]),_:1},8,["label"]),l(c,{label:e(a)("settings.notification")},{default:s(()=>[l(ne,{value:e(v).notificationEnabled,"onUpdate:value":[n[12]||(n[12]=t=>e(v).notificationEnabled=t),e(le)]},null,8,["value","onUpdate:value"]),R("span",la,u(e(a)("settings.notificationDesc")),1)]),_:1},8,["label"]),l(c,{label:e(a)("settings.showGuide")},{default:s(()=>[l(ne,{value:e(v).showGuide,"onUpdate:value":[n[13]||(n[13]=t=>e(v).showGuide=t),e(se)]},null,8,["value","onUpdate:value"]),R("span",sa,u(e(a)("settings.showGuideDesc")),1)]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["tab"]),l(B,{name:"account",tab:e(a)("tabs.account")},{default:s(()=>[l(ve,{column:1,"label-placement":"left","label-style":"width: 120px; font-weight: 500;",bordered:"",class:"account-info"},{default:s(()=>[l(N,{label:e(a)("account.userId")},{default:s(()=>{var t;return[m(u((t=e(g))==null?void 0:t.userId),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.tenantId")},{default:s(()=>{var t;return[m(u((t=e(g))==null?void 0:t.tenantId),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.roles")},{default:s(()=>[l(x,null,{default:s(()=>{var t;return[(K(!0),ie(xe,null,Be(((t=e(g))==null?void 0:t.roles)||[],re=>(K(),Ee(E,{key:re,type:"info",size:"small"},{default:s(()=>[m(u(re),1)]),_:2},1024))),128))]}),_:1})]),_:1},8,["label"]),l(N,{label:e(a)("account.tenantAdmin")},{default:s(()=>[l(E,{type:r.value?"success":"default",size:"small"},{default:s(()=>[m(u(r.value?e(a)("common.yes"):e(a)("common.no")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.deptAdmin")},{default:s(()=>[l(E,{type:L.value?"success":"default",size:"small"},{default:s(()=>[m(u(L.value?e(a)("common.yes"):e(a)("common.no")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.status")},{default:s(()=>[l(E,{type:F.value==="Y"?"success":"error",size:"small"},{default:s(()=>[m(u(F.value==="Y"?e(a)("account.enabled"):e(a)("account.disabled")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.lastLoginTime")},{default:s(()=>{var t;return[m(u(((t=e(g))==null?void 0:t.lastLoginTime)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.lastLoginIp")},{default:s(()=>{var t;return[m(u(((t=e(g))==null?void 0:t.lastLoginIp)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.userExpireDate")},{default:s(()=>{var t;return[m(u(((t=e(g))==null?void 0:t.userExpireDate)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"])]),_:1},8,["value"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),ma=Ge(ta,[["__scopeId","data-v-f27886f2"]]);export{ma as default};

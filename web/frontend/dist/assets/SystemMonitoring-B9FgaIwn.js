import{d as ve,p as Oe,a7 as ue,q as pe,r as C,a8 as ye,g as we,w,e as t,a9 as he,aa as E,o as O,f as y,c as j,h as te,b as f,I as be,ab as fe,j as q,K as oe,t as ee,i as ne,J as Me,_ as De,ac as We,ad as Ye,x as Ke,ae as Ge,af as je,m as Qe,z as ie,A as le,B as ce,ag as Se,ah as Je}from"./index-B5iwLEhr.js";import{N as _e}from"./DatePicker-BYwGRPWG.js";import{R as Te,D as Xe,A as Be,a as Fe,C as Ze,G as et,W as tt,b as at}from"./WindowsOutlined-iNfqx6I5.js";import{u as $e,i as xe,a as Ce,b as Ie,c as Le,d as Pe,e as Re,f as Ae,g as Ne,L as Ve}from"./installCanvasRenderer-Bdf8yIjj.js";import{_ as rt}from"./DataTable-BP0rWkt1.js";import{u as st}from"./usePagination-DXNuPgmN.js";import{_ as ot}from"./Select-DZOKbeI6.js";import"./Checkbox-CEPM1LtD.js";import"./Radio-j9RXIevN.js";import"./RadioGroup-CXVTQ2cd.js";import"./prop-NnGblK-3.js";import"./download-C2161hUv.js";import"./index-DR_R-bYe.js";const nt={class:"card-extra"},it={class:"chart-container"},lt={key:0,class:"chart-loading"},ct={key:1,class:"chart-empty"},ut=ve({__name:"CpuMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},cpuDetailData:{type:Array,default:()=>[]},userColor:{type:String,default:"#1890ff"},systemColor:{type:String,default:"#52c41a"},idleColor:{type:String,default:"#d9d9d9"}},emits:["refresh","time-range-change"],setup(a,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=C(null);let d=null;const D=a,S=x,_=Date.now(),z=_-3600*1e3,I=C([z,_]),A=q(()=>({[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const r=Date.now();return[r-3600*1e3,r]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const r=Date.now();return[r-6*3600*1e3,r]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const r=Date.now();return[r-12*3600*1e3,r]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const r=Date.now();return[r-24*3600*1e3,r]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const r=Date.now();return[r-168*3600*1e3,r]}})),B=()=>{M.value&&(d=xe(M.value),window.addEventListener("resize",Y),H())},H=()=>{if(!d)return;if(!D.data||!Array.isArray(D.data)||D.data.length===0){d.clear();return}const r=D.data.map(c=>c.collectTime).sort(),n=new Map;D.data.forEach(c=>{n.set(c.collectTime,c)});const s=[{name:e("hub0000.cpu.usage"),type:"line",data:r.map(c=>{const o=n.get(c);return{value:o?o.usagePercent:0,detail:o}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:D.userColor}},{name:e("hub0000.cpu.userUsage"),type:"line",data:r.map(c=>{const o=n.get(c);return{value:o?o.userPercent:0,detail:o}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:D.systemColor}},{name:e("hub0000.cpu.systemUsage"),type:"line",data:r.map(c=>{const o=n.get(c);return{value:o?o.systemPercent:0,detail:o}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:D.idleColor}}],i={tooltip:{trigger:"axis",formatter:c=>{const o=c[0].data.detail;let g="";return o&&(g+=`${e("hub0000.cpu.detailTitle")}:<br/>`,g+=`${e("hub0000.cpu.serverId")}: ${o.metricServerId}<br/>`,g+=`${e("hub0000.cpu.coreCount")}: ${o.coreCount}<br/>`,g+=`${e("hub0000.cpu.logicalCount")}: ${o.logicalCount}<br/>`,g+=`${e("hub0000.cpu.loadAvg1")}: ${o.loadAvg1.toFixed(2)}<br/>`,g+=`${e("hub0000.cpu.loadAvg5")}: ${o.loadAvg5.toFixed(2)}<br/>`,g+=`${e("hub0000.cpu.loadAvg15")}: ${o.loadAvg15.toFixed(2)}<br/>`,g+=`${e("hub0000.cpu.ioWaitUsage")}: ${o.ioWaitPercent.toFixed(2)}%<br/>`,g+=`${e("hub0000.cpu.irqUsage")}: ${o.irqPercent.toFixed(2)}%<br/>`,g+=`${e("hub0000.cpu.softIrqUsage")}: ${o.softIrqPercent.toFixed(2)}%<br/>`,g+="<br/>"),c.forEach(v=>{const T=v.marker,u=v.seriesName,p=`${v.value.toFixed(2)}%`;g+=`${T} ${u}: ${p}<br/>`}),g},axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:[e("hub0000.cpu.usage"),e("hub0000.cpu.userUsage"),e("hub0000.cpu.systemUsage")],type:"scroll",bottom:0},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:r.map(c=>E(c,"HH:mm:ss")),axisLabel:{interval:Math.floor(r.length/10)}},yAxis:{type:"value",axisLabel:{formatter:c=>c.toFixed(2)+"%"},max:100,min:0},series:s};d.setOption(i,!0)},Y=()=>{d==null||d.resize()},ae=()=>{S("refresh")},m=r=>{S("time-range-change",r)};return ue(()=>D.data,()=>{H()},{deep:!0}),pe(()=>{B(),S("time-range-change",I.value)}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",Y)}),(r,n)=>(O(),we(t(he),{title:t(e)("hub0000.cpu.title"),bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",nt,[f(t(_e),{value:I.value,"onUpdate:value":[n[0]||(n[0]=s=>I.value=s),m],type:"datetimerange",shortcuts:A.value,placeholder:t(e)("hub0000.common.selectTimeRange"),size:"small"},null,8,["value","shortcuts","placeholder"]),f(t(Me),{size:"small",onClick:ae,loading:a.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("hub0000.common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",it,[y("div",{ref_key:"chartRef",ref:M,class:"chart-element"},null,512),a.loading?(O(),j("div",lt,[f(t(be),{size:"large"})])):te("",!0),!a.loading&&(!a.data||!Array.isArray(a.data)||a.data.length===0)?(O(),j("div",ct,[f(t(fe),{description:t(e)("hub0000.common.noData")},null,8,["description"])])):te("",!0)])]),_:1},8,["title"]))}}),dt=De(ut,[["__scopeId","data-v-7ffafae8"]]),mt={class:"card-extra"},ht={class:"chart-container"},ft={key:0,class:"chart-loading"},gt={key:1,class:"chart-empty"},vt=ve({__name:"MemoryMonitor",props:{title:{type:String,default:"内存使用率"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},warningThreshold:{type:Number,default:80},dangerThreshold:{type:Number,default:90},memoryDetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(a,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=a,d=q(()=>M.title||e("hub0000.memory.title")),D=q(()=>M.warningThreshold),S=q(()=>M.dangerThreshold),_=x,z=C(null);let I=null;const A=Date.now(),B=A-3600*1e3,H=C([B,A]),Y=q(()=>({[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const o=Date.now();return[o-3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const o=Date.now();return[o-6*3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const o=Date.now();return[o-12*3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const o=Date.now();return[o-24*3600*1e3,o]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const o=Date.now();return[o-168*3600*1e3,o]}})),ae=q(()=>{if(!M.data||M.data.length===0)return[];const o=new Map;return M.data.forEach(v=>{const T=v.collectTime;o.has(T)||o.set(T,[]),o.get(T).push(v.usagePercent)}),Array.from(o.entries()).map(([v,T])=>{const u=M.data.find(p=>p.collectTime===v);return{time:v,value:Math.round(T.reduce((p,$)=>p+$,0)/T.length*100)/100,detail:u?{totalMemory:u.totalMemory,usedMemory:u.usedMemory,availableMemory:u.availableMemory,freeMemory:u.freeMemory,cachedMemory:u.cachedMemory,buffersMemory:u.buffersMemory,swapTotal:u.swapTotal,swapUsed:u.swapUsed,swapFree:u.swapFree,swapUsagePercent:u.swapUsagePercent}:null}}).sort((v,T)=>new Date(v.time).getTime()-new Date(T.time).getTime())}),m=o=>{if(o===0)return"0 B";const g=["B","KB","MB","GB","TB","PB"],v=Math.floor(Math.log(o)/Math.log(1024));return`${(o/Math.pow(1024,v)).toFixed(2)} ${g[v]}`},r=()=>{_("refresh")},n=o=>{_("time-range-change",o)},s=()=>{z.value&&(I=xe(z.value),window.addEventListener("resize",c),i())},i=()=>{if(!I)return;const o=ae.value;if(o.length===0){I.clear();return}const g={title:{show:!1},tooltip:{trigger:"axis",formatter:function(v){const T=v[0],u=T.data.detail;if(!u)return`${T.marker}${T.seriesName}: ${T.data.value}%`;let p="";return p+=`${T.marker}${e("hub0000.memory.usage")}: <b>${T.data.value}%</b><br/>`,p+=`<br/>${e("hub0000.memory.details")}:<br/>`,p+=`${e("hub0000.memory.total")}: ${m(u.totalMemory)}<br/>`,p+=`${e("hub0000.memory.used")}: ${m(u.usedMemory)}<br/>`,p+=`${e("hub0000.memory.available")}: ${m(u.availableMemory)}<br/>`,p+=`${e("hub0000.memory.free")}: ${m(u.freeMemory)}<br/>`,p+=`${e("hub0000.memory.cached")}: ${m(u.cachedMemory)}<br/>`,p+=`${e("hub0000.memory.buffers")}: ${m(u.buffersMemory)}<br/>`,p+=`<br/>${e("hub0000.memory.swap")}:<br/>`,p+=`${e("hub0000.memory.swapTotal")}: ${m(u.swapTotal)}<br/>`,p+=`${e("hub0000.memory.swapUsed")}: ${m(u.swapUsed)}<br/>`,p+=`${e("hub0000.memory.swapFree")}: ${m(u.swapFree)}<br/>`,p+=`${e("hub0000.memory.swapUsage")}: ${u.swapUsagePercent.toFixed(1)}%`,p}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o.map(v=>E(new Date(v.time),"HH:mm:ss")),axisLabel:{rotate:45}},yAxis:{type:"value",min:0,max:100,splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:"{value}%"}},series:[{name:e("hub0000.memory.usage"),type:"line",data:o.map(v=>({value:v.value,detail:v.detail})),smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:2,color:"#52c41a"},itemStyle:{color:function(v){const T=v.data.value;return T>=S.value?"#ff4d4f":T>=D.value?"#faad14":"#52c41a"}},areaStyle:{color:new Ve(0,0,0,1,[{offset:0,color:"rgba(82, 196, 26, 0.3)"},{offset:1,color:"rgba(82, 196, 26, 0.1)"}])},markLine:{silent:!0,lineStyle:{color:"#faad14"},data:[{yAxis:D.value,label:{formatter:`${e("hub0000.memory.warning")} ${D.value}%`,position:"start"}},{yAxis:S.value,lineStyle:{color:"#ff4d4f"},label:{formatter:`${e("hub0000.memory.danger")} ${S.value}%`,position:"start"}}]}}]};I.setOption(g)},c=()=>{I==null||I.resize()};return ue(()=>M.data,()=>{i()},{deep:!0}),pe(()=>{s(),_("time-range-change",H.value)}),ye(()=>{I&&(I.dispose(),I=null),window.removeEventListener("resize",c)}),(o,g)=>(O(),we(t(he),{title:d.value,bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",mt,[f(t(_e),{value:H.value,"onUpdate:value":[g[0]||(g[0]=v=>H.value=v),n],type:"datetimerange",shortcuts:Y.value,placeholder:t(e)("common.selectTimeRange"),size:"small"},null,8,["value","shortcuts","placeholder"]),f(t(Me),{size:"small",onClick:r,loading:a.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",ht,[y("div",{ref_key:"chartRef",ref:z,class:"chart-element"},null,512),a.loading?(O(),j("div",ft,[f(t(be),{size:"large"})])):te("",!0),!a.loading&&!ae.value.length?(O(),j("div",gt,[f(t(fe),{description:t(e)("common.noData")},null,8,["description"])])):te("",!0)])]),_:1},8,["title"]))}}),pt=De(vt,[["__scopeId","data-v-284035ac"]]),yt={class:"card-extra"},wt={class:"chart-container"},bt={key:0,class:"chart-loading"},Mt={key:1,class:"chart-empty"},Dt=ve({__name:"DiskMonitor",props:{title:{type:String,default:"磁盘使用率"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},warningThreshold:{type:Number,default:80},dangerThreshold:{type:Number,default:90},diskDetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(a,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=a,d=q(()=>M.title||e("hub0000.disk.title")),D=x,S=C(null);let _=null;const z=Date.now(),I=z-3600*1e3,A=C([I,z]),B=q(()=>({[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const i=Date.now();return[i-3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const i=Date.now();return[i-6*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const i=Date.now();return[i-12*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const i=Date.now();return[i-24*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const i=Date.now();return[i-168*3600*1e3,i]}})),H=q(()=>{if(!M.data||M.data.length===0)return[];const i=new Map;return M.data.forEach(c=>{const o=c.collectTime;i.has(o)||i.set(o,{values:[],partitions:[]});const g=i.get(o);g.values.push(c.usagePercent),g.partitions.push(c)}),Array.from(i.entries()).map(([c,o])=>({time:c,value:Math.round(o.values.reduce((g,v)=>g+v,0)/o.values.length*100)/100,detail:{partitions:o.partitions,partitionCount:o.partitions.length,totalSpace:o.partitions.reduce((g,v)=>g+v.totalSpace,0),usedSpace:o.partitions.reduce((g,v)=>g+v.usedSpace,0),freeSpace:o.partitions.reduce((g,v)=>g+v.freeSpace,0),avgUsagePercent:Math.round(o.values.reduce((g,v)=>g+v,0)/o.values.length*100)/100}}))}),Y=i=>{if(i===0)return"0 B";const c=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(i)/Math.log(1024));return`${(i/Math.pow(1024,o)).toFixed(2)} ${c[o]}`},ae=()=>{D("refresh")},m=i=>{D("time-range-change",i)},r=()=>{S.value&&(_=xe(S.value),window.addEventListener("resize",s),n())},n=()=>{if(!_)return;const i=H.value;if(i.length===0){_.clear();return}const c=q(()=>M.warningThreshold??80),o=q(()=>M.dangerThreshold??90),g={title:{show:!1},tooltip:{trigger:"axis",formatter:function(v){const T=v[0],u=T.data.detail;let p="";return p+=`${T.marker}${e("hub0000.disk.usage")}: <b>${T.data.value}%</b><br/>`,p+=`<br/>${e("hub0000.disk.details")}:<br/>`,p+=`${e("hub0000.disk.partitionCount")}: ${u.partitionCount}<br/>`,p+=`${e("hub0000.disk.totalSpace")}: ${Y(u.totalSpace)}<br/>`,p+=`${e("hub0000.disk.usedSpace")}: ${Y(u.usedSpace)}<br/>`,p+=`${e("hub0000.disk.freeSpace")}: ${Y(u.freeSpace)}<br/>`,u.partitions.length>0&&(p+=`<br/>${e("hub0000.disk.partitionDetails")}:<br/>`,u.partitions.slice(0,3).forEach(L=>{p+=`${L.mountPoint}: ${L.usagePercent.toFixed(1)}% (${Y(L.usedSpace)}/${Y(L.totalSpace)})<br/>`}),u.partitions.length>3&&(p+=`... ${e("hub0000.disk.morePartitions",{count:u.partitions.length-3})}`)),p}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:i.map(v=>E(new Date(v.time),"HH:mm:ss")),axisLabel:{rotate:45}},yAxis:{type:"value",min:0,max:100,splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:"{value}%"}},series:[{name:e("hub0000.disk.usage"),type:"line",data:i.map(v=>({value:v.value,detail:v.detail})),smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:2,color:"#faad14"},itemStyle:{color:function(v){const T=v.data.value;return T>=o.value?"#ff4d4f":(T>=c.value,"#faad14")}},areaStyle:{color:new Ve(0,0,0,1,[{offset:0,color:"rgba(250, 173, 20, 0.3)"},{offset:1,color:"rgba(250, 173, 20, 0.1)"}])},markLine:{silent:!0,lineStyle:{color:"#faad14"},data:[{yAxis:c.value,label:{formatter:`${e("hub0000.disk.warning")} ${c.value}%`,position:"start"}},{yAxis:o.value,lineStyle:{color:"#ff4d4f"},label:{formatter:`${e("hub0000.disk.danger")} ${o.value}%`,position:"start"}}]}}]};_.setOption(g)},s=()=>{_==null||_.resize()};return ue(()=>M.data,()=>{n()},{deep:!0}),pe(()=>{r(),D("time-range-change",A.value)}),ye(()=>{_&&(_.dispose(),_=null),window.removeEventListener("resize",s)}),(i,c)=>(O(),we(t(he),{title:d.value,bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",yt,[f(t(_e),{value:A.value,"onUpdate:value":[c[0]||(c[0]=o=>A.value=o),m],type:"datetimerange",shortcuts:B.value,placeholder:t(e)("hub0000.common.selectTimeRange"),size:"small"},null,8,["value","shortcuts","placeholder"]),f(t(Me),{size:"small",onClick:ae,loading:a.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("hub0000.common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",wt,[y("div",{ref_key:"chartRef",ref:S,class:"chart-element"},null,512),a.loading?(O(),j("div",bt,[f(t(be),{size:"large"})])):te("",!0),!a.loading&&!H.value.length?(O(),j("div",Mt,[f(t(fe),{description:t(e)("hub0000.common.noData")},null,8,["description"])])):te("",!0)])]),_:1},8,["title"]))}}),Tt=De(Dt,[["__scopeId","data-v-d7f5b2b1"]]),St={class:"card-extra"},kt={class:"chart-container"},_t={key:0,class:"chart-loading"},$t={key:1,class:"chart-empty"},xt={key:0,class:"detail-section"},Ct=ve({__name:"DiskIOMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},diskIODetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(a,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=C(null);let d=null;const D=a,S=x,_=Date.now(),z=_-3600*1e3,I=C([z,_]),A={[e("hub0000.timeRangeShortcuts.lastHour")]:()=>{const i=Date.now();return[i-3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last6Hours")]:()=>{const i=Date.now();return[i-6*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last12Hours")]:()=>{const i=Date.now();return[i-12*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last24Hours")]:()=>{const i=Date.now();return[i-24*3600*1e3,i]},[e("hub0000.timeRangeShortcuts.last7Days")]:()=>{const i=Date.now();return[i-168*3600*1e3,i]}},B={pageSize:5,page:1},H=q(()=>[{title:e("hub0000.diskIO.deviceName"),key:"deviceName"},{title:e("hub0000.diskIO.readBytesRate"),key:"readRate",render:i=>Ye(i.readRate)+"/s"},{title:e("hub0000.diskIO.writeBytesRate"),key:"writeRate",render:i=>Ye(i.writeRate)+"/s"},{title:e("hub0000.diskIO.readCount"),key:"readCount"},{title:e("hub0000.diskIO.writeCount"),key:"writeCount"},{title:e("hub0000.diskIO.collectTime"),key:"collectTime",render:i=>E(i.collectTime)}]),Y=q(()=>{if(!D.diskIODetailData)return[];const i=new Map;return D.diskIODetailData.forEach(c=>{const o=i.get(c.deviceName);(!o||new Date(c.collectTime)>new Date(o.collectTime))&&i.set(c.deviceName,c)}),Array.from(i.values())}),ae=()=>{M.value&&(d=xe(M.value),window.addEventListener("resize",r),m())},m=()=>{if(!d)return;if(!D.data||!Array.isArray(D.data)||D.data.length===0){d.clear();return}const i=new Map;D.data.forEach(u=>{var p;i.has(u.collectTime)||i.set(u.collectTime,new Map),(p=i.get(u.collectTime))==null||p.set(u.deviceName,u)});const c=Array.from(i.keys()).sort(),o=new Set;D.data.forEach(u=>o.add(u.deviceName));const g=[{read:"#1890ff",write:"#36cfc9"},{read:"#722ed1",write:"#eb2f96"},{read:"#fa8c16",write:"#faad14"},{read:"#52c41a",write:"#a0d911"},{read:"#f5222d",write:"#ff7a45"}],v=[];Array.from(o).forEach((u,p)=>{const $=p%g.length,L=g[$],J=[],Q=[];c.forEach(F=>{var re;const U=(re=i.get(F))==null?void 0:re.get(u);J.push(U?U.readRate:0),Q.push(U?U.writeRate:0)}),v.push({name:`${u} ${e("hub0000.diskIO.read")}`,type:"line",data:J,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"solid"},itemStyle:{color:L.read}}),v.push({name:`${u} ${e("hub0000.diskIO.write")}`,type:"line",data:Q,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"dashed"},itemStyle:{color:L.write}})});const T={title:{show:!1},tooltip:{trigger:"axis",formatter:u=>{const p=Array.isArray(u)?u[0]:u,$=c[p.dataIndex];let L=E($,"YYYY-MM-DD HH:mm:ss")+"<br/>";const J=new Map;return u.forEach(Q=>{var re;const U=Q.seriesName.split(" ")[0];J.has(U)||J.set(U,[]),(re=J.get(U))==null||re.push(Q)}),J.forEach((Q,F)=>{L+=`<div style="margin-top: 3px;"><b>${F}</b></div>`,Q.forEach(U=>{const re=U.color,V=U.seriesName.includes(e("hub0000.diskIO.read")),W=e(V?"hub0000.diskIO.read":"hub0000.diskIO.write"),h=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${re};border:1px solid ${re}"></span>`;L+=`<div style="padding-left: 12px;line-height:18px">${h}${W}: ${Ye(Number(U.value))}/s</div>`})}),L}},legend:{type:"scroll",bottom:0,padding:[10,20],selected:v.reduce((u,p)=>(u[p.name]=!0,u),{}),formatter:u=>{const p=u.split(" ")[0],$=u.includes(e("hub0000.diskIO.read"))?e("hub0000.diskIO.read"):e("hub0000.diskIO.write");return`${p} ${$}`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:c.map(u=>E(u,"HH:mm:ss")),axisLabel:{interval:Math.floor(c.length/10)}},yAxis:{type:"value",axisLabel:{formatter:u=>Ye(u)+"/s"}},series:v};d.setOption(T,!0)},r=()=>{d==null||d.resize()},n=()=>{S("refresh")},s=i=>{S("time-range-change",i)};return ue(()=>D.data,()=>{m()},{deep:!0}),pe(()=>{ae(),S("time-range-change",I.value)}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",r)}),(i,c)=>(O(),we(t(he),{title:t(e)("hub0000.diskIO.title"),bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",St,[f(t(_e),{value:I.value,"onUpdate:value":[c[0]||(c[0]=o=>I.value=o),s],type:"datetimerange",shortcuts:A,placeholder:t(e)("common.selectTimeRange"),size:"small"},null,8,["value","placeholder"]),f(t(Me),{size:"small",onClick:n,loading:a.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>[y("div",kt,[y("div",{ref_key:"chartRef",ref:M,class:"chart-element"},null,512),a.loading?(O(),j("div",_t,[f(t(be),{size:"large"})])):te("",!0),!a.loading&&(!a.data||!Array.isArray(a.data)||a.data.length===0)?(O(),j("div",$t,[f(t(fe),{description:t(e)("common.noData")},null,8,["description"])])):te("",!0)]),a.diskIODetailData&&a.diskIODetailData.length>0?(O(),j("div",xt,[f(t(We),null,{default:w(()=>[oe(ee(t(e)("hub0000.diskIO.detailTitle")),1)]),_:1}),f(t(rt),{columns:H.value,data:Y.value,pagination:B,bordered:!1,size:"small"},null,8,["columns","data"])])):te("",!0)]),_:1},8,["title"]))}}),It=De(Ct,[["__scopeId","data-v-c9355b22"]]),Lt={class:"card-extra"},Pt={class:"chart-container"},Rt={key:0,class:"chart-loading"},At={key:1,class:"chart-empty"},Nt=ve({__name:"NetworkMonitor",props:{title:{},data:{},loading:{type:Boolean},uploadColor:{},downloadColor:{}},emits:["refresh","time-range-change"],setup(a,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const e=a,M={title:"网络流量"},d=x,D=C(null);let S=null;const _=Date.now(),z=_-3600*1e3,I=C([z,_]),A={最近1小时:()=>{const s=Date.now();return[s-3600*1e3,s]},最近6小时:()=>{const s=Date.now();return[s-6*3600*1e3,s]},最近12小时:()=>{const s=Date.now();return[s-12*3600*1e3,s]},最近24小时:()=>{const s=Date.now();return[s-24*3600*1e3,s]},最近7天:()=>{const s=Date.now();return[s-168*3600*1e3,s]}},B=q(()=>{if(!e.data||e.data.length===0)return[];const s=new Map;return e.data.forEach(i=>{const c=i.collectTime;s.has(c)||s.set(c,{interfaces:[]}),s.get(c).interfaces.push(i)}),Array.from(s.entries()).sort((i,c)=>new Date(i[0]).getTime()-new Date(c[0]).getTime()).map(([i,c])=>({time:i,detail:{interfaces:c.interfaces,interfaceCount:c.interfaces.length}}))}),H=s=>s===0?"0 B/s":s<1024?`${s.toFixed(2)} B/s`:s<1024*1024?`${(s/1024).toFixed(2)} KB/s`:s<1024*1024*1024?`${(s/(1024*1024)).toFixed(2)} MB/s`:`${(s/(1024*1024*1024)).toFixed(2)} GB/s`,Y=()=>{d("refresh")},ae=s=>{d("time-range-change",s)},m=()=>{D.value&&(S=xe(D.value),window.addEventListener("resize",n),r())},r=()=>{if(!S)return;const s=B.value;if(s.length===0){S.clear();return}const i=s.map($=>E(new Date($.time),"HH:mm:ss")),c=new Set,o=[],g=[];s.forEach($=>{$.detail.interfaces.forEach(L=>{c.has(L.interfaceName)||(L.ipAddresses&&L.ipAddresses.includes(".")&&!L.ipAddresses.includes(":")||L.interfaceName.match(/eth\d+|en\d+|bond\d+|wlan\d+|ens\d+|enp\d+|lo\b|vlan\d+/i)?o.push(L.interfaceName):g.push(L.interfaceName),c.add(L.interfaceName))})});const v=[...o,...g],T=[{send:"#fa541c",receive:"#73d13d"},{send:"#722ed1",receive:"#13c2c2"},{send:"#f5222d",receive:"#52c41a"},{send:"#fa8c16",receive:"#1890ff"},{send:"#eb2f96",receive:"#fadb14"}],u=[];v.forEach(($,L)=>{const J=L%T.length,Q=T[J],F=s.map(V=>{const W=V.detail.interfaces.find(h=>h.interfaceName===$);return W?Math.round(W.sendRate/(1024*1024)*100)/100:0}),U=s.map(V=>{const W=V.detail.interfaces.find(h=>h.interfaceName===$);return W?Math.round(W.receiveRate/(1024*1024)*100)/100:0}),re=o.includes($)?2:1;u.push({name:`${$} 上传`,type:"line",data:F,smooth:!0,showSymbol:!1,lineStyle:{width:re,type:"solid"},itemStyle:{color:Q.send},emphasis:{focus:"series"},tooltip:{valueFormatter:V=>`${V} MB/s`}}),u.push({name:`${$} 下载`,type:"line",data:U,smooth:!0,showSymbol:!1,lineStyle:{width:re,type:"dashed"},itemStyle:{color:Q.receive},emphasis:{focus:"series"},tooltip:{valueFormatter:V=>`${V} MB/s`}})});const p={title:{show:!1},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function($){var re;const L=$[0].axisValue,J=i.indexOf(L),Q=(re=s[J])==null?void 0:re.detail;let F=`${L}<br/>`;const U=new Map;if($.forEach(V=>{const h=V.seriesName.split(" ")[0];U.has(h)||U.set(h,[]),U.get(h).push(V)}),Q){const V=new Set;U.forEach((R,G)=>{V.add(G)}),Q.interfaces.forEach(R=>{V.add(R.interfaceName)}),F+=`接口总数: ${Q.interfaceCount}<br/>`;const W=[],h=[];Array.from(V).forEach(R=>{const G=Q.interfaces.find(He=>He.interfaceName===R);if(!G)return;G.ipAddresses&&G.ipAddresses.includes(".")&&!G.ipAddresses.includes(":")||G.interfaceName.match(/eth\d+|en\d+|bond\d+|wlan\d+|ens\d+|enp\d+|lo\b|vlan\d+/i)?W.push(R):h.push(R)});const b=[...W,...h];b.length>0&&(F+="<br/>接口详情:<br/>",b.forEach(R=>{const G=Q.interfaces.find(He=>He.interfaceName===R);if(!G)return;F+='<div style="padding:3px 0;border-bottom:1px solid #eee;">',F+=`<b>${R}</b>: `,W.includes(R)&&(F+='<span style="color:#1890ff;">[IPv4]</span> '),F+=`<br/><span style="padding-left:10px;color:#ff4d4f;">↑${H(G.sendRate)}</span> `,F+=`<span style="padding-left:5px;color:#52c41a;">↓${H(G.receiveRate)}</span>`,(G.errorsReceived>0||G.errorsSent>0)&&(F+=` <span style="color:#ff7875;">(错误: ${G.errorsReceived+G.errorsSent})</span>`),G.ipAddresses&&(F+=`<br/><span style="padding-left:10px;color:#999;font-size:12px;">IP: ${G.ipAddresses}</span>`),F+="</div>"}))}return F}},legend:{type:"scroll",data:u.map($=>$.name),bottom:0,padding:[5,10],selected:u.reduce(($,L)=>{const J=L.name.split(" ")[0];return $[L.name]=o.includes(J),$},{})},grid:{left:"3%",right:"4%",bottom:"40px",top:"10px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:i,axisLabel:{rotate:45}},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:$=>$.toFixed(2)+" MB/s"}},series:u};S.setOption(p)},n=()=>{S==null||S.resize()};return ue(()=>e.data,()=>{r()},{deep:!0}),pe(()=>{m(),d("time-range-change",I.value)}),ye(()=>{S&&(S.dispose(),S=null),window.removeEventListener("resize",n)}),(s,i)=>(O(),we(t(he),{title:a.title||M.title,bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",Lt,[f(t(_e),{value:I.value,"onUpdate:value":[i[0]||(i[0]=c=>I.value=c),ae],type:"datetimerange",shortcuts:A,placeholder:"选择时间范围",size:"small"},null,8,["value"]),f(t(Me),{size:"small",onClick:Y,loading:a.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[i[1]||(i[1]=oe(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:w(()=>[y("div",Pt,[y("div",{ref_key:"chartRef",ref:D,class:"chart-element"},null,512),a.loading?(O(),j("div",Rt,[f(t(be),{size:"large"})])):te("",!0),!a.loading&&!B.value.length?(O(),j("div",At,[f(t(fe),{description:"暂无数据"})])):te("",!0)])]),_:1},8,["title"]))}}),Ot=De(Nt,[["__scopeId","data-v-ad4fba78"]]),Ht={class:"card-extra"},Yt={class:"chart-container"},zt={key:0,class:"chart-loading"},Et={key:1,class:"chart-empty"},Ut=ve({__name:"ProcessMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},processDetailData:{type:Array,default:()=>[]},cpuColor:{type:String,default:"#1890ff"},memoryColor:{type:String,default:"#52c41a"}},emits:["refresh","time-range-change"],setup(a,{emit:x}){$e([Ce,Ie,Le,Pe,Re,Ae,Ne]);const{t:e}=Oe("hub0000"),M=C(null);let d=null;const D=a,S=x,_=Date.now(),z=_-3600*1e3,I=C([z,_]),A={最近1小时:()=>{const r=Date.now();return[r-3600*1e3,r]},最近6小时:()=>{const r=Date.now();return[r-6*3600*1e3,r]},最近12小时:()=>{const r=Date.now();return[r-12*3600*1e3,r]},最近24小时:()=>{const r=Date.now();return[r-24*3600*1e3,r]},最近7天:()=>{const r=Date.now();return[r-168*3600*1e3,r]}},B=()=>{M.value&&(d=xe(M.value),window.addEventListener("resize",Y),H())},H=()=>{if(!d)return;if(!D.data||D.data.length===0){d.clear();return}const r=new Map;D.data.forEach(o=>{var g;r.has(o.collectTime)||r.set(o.collectTime,[]),(g=r.get(o.collectTime))==null||g.push(o)});const n=Array.from(r.keys()).sort(),s=[],i=[];n.forEach(o=>{const g=r.get(o)||[];if(g.length>0){const v=g.reduce((u,p)=>u+p.cpuPercent,0)/g.length,T=g.reduce((u,p)=>u+p.memoryPercent,0)/g.length;s.push(Number(v.toFixed(2))),i.push(Number(T.toFixed(2)))}else s.push(0),i.push(0)});const c={tooltip:{trigger:"axis",formatter:o=>{const g=o[0].dataIndex,v=r.get(n[g])||[];let T=E(n[g],"YYYY-MM-DD HH:mm:ss")+"<br/>";return o.forEach(u=>{const $=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${u.color};"></span>`;T+=$+u.seriesName+": "+u.value+"%<br/>"}),v.length>0&&(T+=`<span style="color:#666;">进程数量: ${v.length}</span><br/>`),v.length>0&&(T+="<br/><b>"+e("hub0000.process.detailTitle")+"</b><br/>",[...v].sort((p,$)=>$.cpuPercent-p.cpuPercent).slice(0,5).forEach((p,$)=>{T+='<div style="padding-left:10px;margin:2px 0;">',T+=`<b>${$+1}. ${p.processName}</b> <span style="color:#666;">(PID: ${p.processId})</span><br/>`,T+=`<span style="padding-left:15px;">CPU: ${p.cpuPercent.toFixed(2)}%, `,T+=`内存: ${p.memoryPercent.toFixed(2)}%, `,T+=`线程: ${p.threadCount}</span>`,T+="</div>"}),v.length>5&&(T+=`<div style="padding-left:10px;color:#999;">... 以及 ${v.length-5} 个其他进程</div>`)),T}},legend:{data:[e("hub0000.process.avgCpu"),e("hub0000.process.avgMemory")],bottom:0,padding:[10,20]},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:n.map(o=>E(o,"HH:mm:ss")),axisLabel:{interval:Math.floor(n.length/10)}},yAxis:{type:"value",min:0,max:100,position:"left",axisLabel:{formatter:"{value}%"}},series:[{name:e("hub0000.process.avgCpu"),type:"line",data:s,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"solid"},itemStyle:{color:D.cpuColor}},{name:e("hub0000.process.avgMemory"),type:"line",data:i,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"dashed"},itemStyle:{color:D.memoryColor}}]};d.setOption(c)},Y=()=>{d==null||d.resize()},ae=()=>{S("refresh")},m=r=>{S("time-range-change",r)};return ue(()=>D.data,()=>{H()},{deep:!0}),pe(()=>{B(),S("time-range-change",I.value)}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",Y)}),(r,n)=>(O(),we(t(he),{title:t(e)("hub0000.process.title"),bordered:!1,class:"monitor-card"},{"header-extra":w(()=>[y("div",Ht,[f(t(_e),{value:I.value,"onUpdate:value":[n[0]||(n[0]=s=>I.value=s),m],type:"datetimerange",shortcuts:A,placeholder:t(e)("common.selectTimeRange"),size:"small"},null,8,["value","placeholder"]),f(t(Me),{size:"small",onClick:ae,loading:a.loading},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[oe(" "+ee(t(e)("common.refresh")),1)]),_:1},8,["loading"])])]),default:w(()=>{var s;return[y("div",Yt,[y("div",{ref_key:"chartRef",ref:M,class:"chart-element"},null,512),a.loading?(O(),j("div",zt,[f(t(be),{size:"large"})])):te("",!0),!a.loading&&!((s=a.data)!=null&&s.length)?(O(),j("div",Et,[f(t(fe),{description:t(e)("common.noData")},null,8,["description"])])):te("",!0)])]}),_:1},8,["title"]))}}),qt=De(Ut,[["__scopeId","data-v-e0bbaa0b"]]);var ke=(a=>(a.ONLINE="online",a.OFFLINE="offline",a.WARNING="warning",a.CRITICAL="critical",a))(ke||{});const Z=Ge("SystemMonitorModel"),Bt=()=>{const a=C([]),x=C([]),e=C(!1),M=C(null),d=C([]),D=C([]),S=C(!1),_=C([]),z=C([]),I=C(!1),A=C([]),B=C([]),H=C(!1),Y=C([]),ae=C(!1),m=C([]),r=C([]),n=C(!1),s=C([]),i=C(!1),c=C([]),o=C(!1),g=Ke({pageNum:1,pageSize:200,activeFlag:"Y"}),v=st(),T=q(()=>{const l=new Date,K=300*1e3;return a.value.filter(P=>{const N=d.value.filter(se=>se.metricServerId===P.metricServerId).sort((se,me)=>new Date(me.collectTime).getTime()-new Date(se.collectTime).getTime())[0];if(!N)return!1;const X=new Date(N.collectTime);return l.getTime()-X.getTime()<=K}).length}),u=q(()=>a.value.length-T.value),p=q(()=>{if(d.value.length===0)return 0;const l=new Map;d.value.forEach(P=>{const N=l.get(P.metricServerId);(!N||new Date(P.collectTime)>new Date(N.collectTime))&&l.set(P.metricServerId,P)});const K=Array.from(l.values()).reduce((P,N)=>P+N.usagePercent,0);return Math.round(K/l.size*100)/100}),$=q(()=>{if(_.value.length===0)return 0;const l=new Map;_.value.forEach(P=>{const N=l.get(P.metricServerId);(!N||new Date(P.collectTime)>new Date(N.collectTime))&&l.set(P.metricServerId,P)});const K=Array.from(l.values()).reduce((P,N)=>P+N.usagePercent,0);return Math.round(K/l.size*100)/100}),L=q(()=>{if(A.value.length===0)return 0;const l=new Map;A.value.forEach(P=>{const N=l.get(P.metricServerId);(!N||new Date(P.collectTime)>new Date(N.collectTime))&&l.set(P.metricServerId,P)});const K=Array.from(l.values()).reduce((P,N)=>P+N.usagePercent,0);return Math.round(K/l.size*100)/100}),J=q(()=>{const l={online:0,offline:0,warning:0,critical:0},K=new Date,P=300*1e3,N=600*1e3;return a.value.forEach(X=>{const se=d.value.filter(ge=>ge.metricServerId===X.metricServerId).sort((ge,Ee)=>new Date(Ee.collectTime).getTime()-new Date(ge.collectTime).getTime())[0],me=_.value.filter(ge=>ge.metricServerId===X.metricServerId).sort((ge,Ee)=>new Date(Ee.collectTime).getTime()-new Date(ge.collectTime).getTime())[0];if(!se||!me){l.offline++;return}const ze=new Date(se.collectTime),qe=K.getTime()-ze.getTime();qe>N?l.offline++:qe>P?l.warning++:se.usagePercent>90||me.usagePercent>90?l.critical++:l.online++}),l});return{serverList:a,selectedServerIds:x,serverListLoading:e,currentServer:M,cpuMetrics:d,cpuTrendData:D,cpuLoading:S,memoryMetrics:_,memoryTrendData:z,memoryLoading:I,diskMetrics:A,diskTrendData:B,diskLoading:H,diskIOMetrics:Y,diskIOLoading:ae,networkMetrics:m,networkTrendData:r,networkLoading:n,processMetrics:s,processLoading:i,temperatureMetrics:c,temperatureLoading:o,queryParams:g,pagination:v,onlineServerCount:T,offlineServerCount:u,currentCpuUsage:p,currentMemoryUsage:$,currentDiskUsage:L,serverStatusDistribution:J,setServerList:l=>{a.value=l,Z.info("设置服务器列表数据",{count:l.length})},setCurrentServer:l=>{M.value=l,Z.info("设置当前服务器",{serverId:l==null?void 0:l.metricServerId})},upsertServerData:l=>{const K=a.value.findIndex(P=>P.metricServerId===l.metricServerId);K>=0?a.value[K]=l:a.value.push(l),Z.info("更新服务器数据",{serverId:l.metricServerId})},removeServerData:l=>{const K=a.value.findIndex(P=>P.metricServerId===l);K>=0&&a.value.splice(K,1),Z.info("删除服务器数据",{serverId:l})},setCpuMetrics:l=>{d.value=l,Z.info("设置CPU监控数据",{count:l.length})},setCpuTrendData:l=>{D.value=l,Z.info("设置CPU趋势数据",{count:l.length})},setMemoryMetrics:l=>{_.value=l,Z.info("设置内存监控数据",{count:l.length})},setMemoryTrendData:l=>{z.value=l,Z.info("设置内存趋势数据",{count:l.length})},setDiskMetrics:l=>{A.value=l,Z.info("设置磁盘监控数据",{count:l.length})},setDiskTrendData:l=>{B.value=l,Z.info("设置磁盘趋势数据",{count:l.length})},setDiskIOMetrics:l=>{Y.value=l,Z.info("设置磁盘IO指标数据",{count:l.length})},setNetworkMetrics:l=>{m.value=l,Z.info("设置网络监控数据",{count:l.length})},setNetworkTrendData:l=>{r.value=l,Z.info("设置网络趋势数据",{count:l.length})},setProcessMetrics:l=>{s.value=l,Z.info("设置进程监控数据",{count:l.length})},setTemperatureMetrics:l=>{c.value=l,Z.info("设置温度监控数据",{count:l.length})},clearAllMetrics:()=>{d.value=[],D.value=[],_.value=[],z.value=[],A.value=[],B.value=[],Y.value=[],m.value=[],r.value=[],s.value=[],c.value=[],Z.info("已清空所有监控数据")},updateQueryParams:l=>{Object.assign(g,l),Z.info("更新查询参数",l)},resetQueryParams:()=>{Object.assign(g,{pageNum:1,pageSize:20,activeFlag:"Y"}),Z.info("重置查询参数")},getServerStatus:l=>{const K=new Date,P=300*1e3,N=d.value.filter(me=>me.metricServerId===l).sort((me,ze)=>new Date(ze.collectTime).getTime()-new Date(me.collectTime).getTime())[0];if(!N)return ke.OFFLINE;const X=new Date(N.collectTime);return K.getTime()-X.getTime()>P?ke.OFFLINE:N.usagePercent>90?ke.CRITICAL:N.usagePercent>80?ke.WARNING:ke.ONLINE},getServerLatestMetrics:l=>{const K=d.value.filter(X=>X.metricServerId===l).sort((X,se)=>new Date(se.collectTime).getTime()-new Date(X.collectTime).getTime())[0],P=_.value.filter(X=>X.metricServerId===l).sort((X,se)=>new Date(se.collectTime).getTime()-new Date(X.collectTime).getTime())[0],N=A.value.filter(X=>X.metricServerId===l).sort((X,se)=>new Date(se.collectTime).getTime()-new Date(X.collectTime).getTime())[0];return{cpu:K,memory:P,disk:N}}}},de=je("/gateway/hub0000"),Ft=a=>de.post("/server/query",a),Gt=a=>de.post("/server/detail",a),Qt=a=>de.post("/cpu/query",a),Vt=a=>de.post("/memory/query",a),Wt=a=>de.post("/disk/partition/query",a),Kt=a=>de.post("/disk/io/query",a),jt=a=>de.post("/network/query",a),Jt=a=>de.post("/process/query",a),Xt=a=>de.post("/temperature/query",a),Zt=a=>de.post("/export",a),k=Ge("SystemMonitorManagement"),ea=a=>{const x=Qe(),e=C(!1),M=async m=>{try{a.serverListLoading.value=!0;const r={...a.queryParams,...m};k.info("开始加载服务器列表",r);const n=await Ft(r);if(ie(n)){const s=le(n,[]);return a.setServerList(s),x.success("服务器列表加载成功"),k.info("服务器列表加载成功",{count:s.length}),s}else{const s=ce(n,"加载服务器列表失败");return x.error(s),k.error("加载服务器列表失败",{error:s}),[]}}catch(r){const n="加载服务器列表异常";return x.error(n),k.error(n,r),[]}finally{a.serverListLoading.value=!1}},d=async m=>{try{e.value=!0,k.info("开始获取服务器详情",{serverId:m});const r=await Gt({metricServerId:m});if(ie(r)){const n=le(r);return k.info("获取服务器详情成功",{serverId:m}),n}else{const n=ce(r,"获取服务器详情失败");return x.error(n),k.error("获取服务器详情失败",{serverId:m,error:n}),null}}catch(r){const n="获取服务器详情异常";return x.error(n),k.error(n,{serverId:m,error:r}),null}finally{e.value=!1}},D=()=>a.serverList.value.length>0?a.serverList.value[0].metricServerId:"",S=async m=>{try{a.cpuLoading.value=!0,k.info("开始加载CPU监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await Qt(r);if(ie(n)){const s=le(n,[]);a.setCpuMetrics(s),k.info("CPU监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载CPU监控数据失败");k.error("加载CPU监控数据失败",{error:s})}}catch(r){k.error("加载CPU监控数据异常",r)}finally{a.cpuLoading.value=!1}},_=async m=>{try{a.memoryLoading.value=!0,k.info("开始加载内存监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await Vt(r);if(ie(n)){const s=le(n,[]);a.setMemoryMetrics(s),k.info("内存监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载内存监控数据失败");k.error("加载内存监控数据失败",{error:s})}}catch(r){k.error("加载内存监控数据异常",r)}finally{a.memoryLoading.value=!1}},z=async m=>{try{a.diskLoading.value=!0,k.info("开始加载磁盘监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await Wt(r);if(ie(n)){const s=le(n,[]);a.setDiskMetrics(s),k.info("磁盘监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载磁盘监控数据失败");k.error("加载磁盘监控数据失败",{error:s})}}catch(r){k.error("加载磁盘监控数据异常",r)}finally{a.diskLoading.value=!1}},I=async m=>{try{a.networkLoading.value=!0,k.info("开始加载网络监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await jt(r);if(ie(n)){const s=le(n,[]);a.setNetworkMetrics(s),k.info("网络监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载网络监控数据失败");k.error("加载网络监控数据失败",{error:s})}}catch(r){k.error("加载网络监控数据异常",r)}finally{a.networkLoading.value=!1}},A=async m=>{try{a.processLoading.value=!0,k.info("开始加载进程监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await Jt(r);if(ie(n)){const s=le(n,[]);a.setProcessMetrics(s),k.info("进程监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载进程监控数据失败");k.error("加载进程监控数据失败",{error:s})}}catch(r){k.error("加载进程监控数据异常",r)}finally{a.processLoading.value=!1}},B=async m=>{try{a.temperatureLoading.value=!0,k.info("开始加载温度监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await Xt(r);if(ie(n)){const s=le(n,[]);a.setTemperatureMetrics(s),k.info("温度监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载温度监控数据失败");k.error("加载温度监控数据失败",{error:s})}}catch(r){k.error("加载温度监控数据异常",r)}finally{a.temperatureLoading.value=!1}},H=async m=>{try{a.diskIOLoading.value=!0,k.info("开始加载磁盘IO监控数据",{serverId:m});const r={...m?{metricServerId:m}:{},...a.queryParams},n=await Kt(r);if(ie(n)){const s=le(n,[]);a.setDiskIOMetrics(s),k.info("磁盘IO监控数据加载成功",{count:s.length})}else{const s=ce(n,"加载磁盘IO监控数据失败");k.error("加载磁盘IO监控数据失败",{error:s})}}catch(r){k.error("加载磁盘IO监控数据异常",r)}finally{a.diskIOLoading.value=!1}};return{operationLoading:e,loadServerList:M,getServerInfo:d,getDefaultServerId:D,loadCPUMetrics:S,loadMemoryMetrics:_,loadDiskMetrics:z,loadDiskIOMetrics:H,loadNetworkMetrics:I,loadProcessMetrics:A,loadTemperatureMetrics:B,loadAllMetrics:async m=>{if(!m){k.warn("未提供服务器ID，无法加载监控数据");return}try{e.value=!0,k.info("开始加载所有监控数据",{serverId:m}),await Promise.all([S(m),_(m),z(m),H(m),I(m),A(m),B(m)]),k.info("所有监控数据加载成功")}catch(r){throw k.error("加载所有监控数据异常",r),r}finally{e.value=!1}},exportData:async m=>{try{e.value=!0,k.info("开始导出监控数据",m);const r=await Zt(m);if(ie(r)){const n=le(r);return x.success("数据导出成功"),k.info("数据导出成功",{downloadUrl:n}),n}else{const n=ce(r,"导出监控数据失败");return x.error(n),k.error("导出监控数据失败",{error:n}),null}}catch(r){const n="导出监控数据异常";return x.error(n),k.error(n,r),null}finally{e.value=!1}}}},ta={class:"system-monitoring"},aa={class:"server-selector"},ra={class:"selector-content"},sa={key:0,class:"overview-cards"},oa={class:"overview-grid"},na={class:"overview-item"},ia={class:"overview-icon hostname"},la={class:"overview-content"},ca={class:"overview-value text-truncate"},ua={class:"overview-item"},da={class:"overview-icon os"},ma={class:"overview-content"},ha={class:"overview-value text-truncate"},fa={class:"overview-item"},ga={class:"overview-icon version"},va={class:"overview-content"},pa={class:"overview-value text-truncate"},ya={class:"overview-item"},wa={class:"overview-icon architecture"},ba={class:"overview-content"},Ma={class:"overview-value text-truncate"},Da={class:"overview-item"},Ta={class:"overview-icon server-type"},Sa={class:"overview-content"},ka={class:"overview-value text-truncate"},_a={class:"overview-item"},$a={class:"overview-icon ip"},xa={class:"overview-content"},Ca={class:"overview-value text-truncate"},Ia={key:1,class:"loading-container"},La={key:2,class:"charts-container"},Pa={class:"chart-row"},Ra={class:"chart-item"},Aa={class:"chart-item"},Na={class:"chart-row"},Oa={class:"chart-item"},Ha={class:"chart-item"},Ya={class:"chart-row"},za={class:"chart-item"},Ea={class:"chart-item"},Ua={key:3,class:"no-data-container"},qa={key:4,class:"no-data-container"},Ba=ve({__name:"SystemMonitoring",setup(a){const x=Qe(),e=Bt(),M=ea(e),d=C(""),D=C(!0),S=q(()=>d.value&&e.serverList.value.find(h=>h.metricServerId===d.value)||null),_=h=>({physical:"物理机",virtual:"虚拟机",unknown:"未知"})[h||"unknown"]||"未知",z=h=>{const b=h.toLowerCase();return b.includes("windows")?tt:b.includes("linux")?Be:b.includes("mac")||b.includes("darwin")?at:Fe},I=h=>{if(!h)return"N/A";if(h.toLowerCase().includes("windows")){const b=h.match(/Windows (\d+(?:\.\d+)?)/i);if(b){const R=b[1],G=h.match(/Windows \d+(?:\.\d+)?\s+(\w+)/i);return G?`Windows ${R} ${G[1]}`:`Windows ${R}`}}return h.length>20?h.substring(0,17)+"...":h},A=q(()=>[...[{label:"全部服务器",value:""}],...e.serverList.value.map(b=>({label:`${b.hostname} (${b.ipAddress||"N/A"})`,value:b.metricServerId}))]),B=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadCPUMetrics(d.value)}},H=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadMemoryMetrics(d.value)}},Y=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadDiskMetrics(d.value)}},ae=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadNetworkMetrics(d.value)}},m=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadDiskIOMetrics(d.value)}},r=async h=>{if(h){const[b,R]=h;e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(R,"YYYY-MM-DD HH:mm:ss")}),await M.loadProcessMetrics(d.value)}};ue(()=>e.pagination.pagination.page,h=>{e.queryParams.pageNum=h,n()}),ue(()=>e.pagination.pagination.pageSize,h=>{e.queryParams.pageSize=h,n()}),ue(()=>({tenantId:e.queryParams.tenantId,hostname:e.queryParams.hostname,osType:e.queryParams.osType,serverType:e.queryParams.serverType,activeFlag:e.queryParams.activeFlag}),()=>{D.value||n()},{deep:!0});const n=async()=>{try{const h=await M.loadServerList();!d.value&&h.length>0&&(d.value=h[0].metricServerId,await s(h[0].metricServerId))}catch(h){console.error("加载服务器列表失败",h),x.error("加载服务器列表失败")}},s=async h=>{try{e.updateQueryParams({metricServerId:h,startTime:e.queryParams.startTime,endTime:e.queryParams.endTime}),await M.loadAllMetrics(h)}catch(b){console.error("加载服务器监控数据失败",b),x.error("加载服务器监控数据失败")}},i=async()=>{try{D.value=!0;const h=new Date,b=new Date(h.getTime()-3600*1e3);e.updateQueryParams({startTime:E(b,"YYYY-MM-DD HH:mm:ss"),endTime:E(h,"YYYY-MM-DD HH:mm:ss")}),await n()}catch(h){console.error("初始化数据失败",h),x.error("加载监控数据失败，请刷新页面重试")}finally{D.value=!1}},c=async h=>{if(h)try{W.value=!0,e.clearAllMetrics(),await s(h),x.success("服务器监控数据加载成功")}catch(b){console.error("加载服务器监控数据失败",b),x.error("加载服务器监控数据失败")}finally{W.value=!1}},o=async()=>{if(!d.value){x.warning("请先选择一个服务器");return}try{W.value=!0,await s(d.value),x.success("所有监控数据刷新成功")}catch(h){console.error("刷新监控数据失败",h),x.error("刷新监控数据失败")}finally{W.value=!1}},g=async()=>{await M.loadCPUMetrics(d.value),x.success("CPU数据刷新成功")},v=async()=>{await M.loadMemoryMetrics(d.value),x.success("内存数据刷新成功")},T=async()=>{await M.loadDiskMetrics(d.value),x.success("磁盘数据刷新成功")},u=async()=>{await M.loadNetworkMetrics(d.value),x.success("网络数据刷新成功")},p=async()=>{await M.loadDiskIOMetrics(d.value),x.success("磁盘IO数据刷新成功")},$=async()=>{await M.loadProcessMetrics(d.value),x.success("进程数据刷新成功")};ue(()=>e.serverList.value,h=>{h.length>0&&!d.value&&(d.value=h[0].metricServerId)}),pe(()=>{i()}),ye(()=>{console.log("SystemMonitoring组件已卸载")});const{serverListLoading:L,cpuLoading:J,memoryLoading:Q,diskLoading:F,diskIOLoading:U,networkLoading:re,processLoading:V}=e,{operationLoading:W}=M;return(h,b)=>(O(),j("div",ta,[y("div",aa,[f(t(he),{title:"服务器选择",embedded:""},{default:w(()=>[y("div",ra,[f(t(ot),{value:d.value,"onUpdate:value":[b[0]||(b[0]=R=>d.value=R),c],options:A.value,placeholder:"选择服务器",loading:t(L),clearable:""},null,8,["value","options","loading"]),f(t(Me),{onClick:o,loading:t(W)},{icon:w(()=>[f(t(ne),null,{default:w(()=>[f(t(Te))]),_:1})]),default:w(()=>[b[1]||(b[1]=oe(" 刷新数据 ",-1))]),_:1},8,["loading"])])]),_:1})]),S.value?(O(),j("div",sa,[f(t(he),{title:"服务器信息",embedded:""},{default:w(()=>[y("div",oa,[y("div",na,[y("div",ia,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Xe))]),_:1})]),y("div",la,[b[2]||(b[2]=y("div",{class:"overview-label"},"主机名",-1)),f(t(Se),{"show-arrow":!1},{trigger:w(()=>[y("div",ca,ee(S.value.hostname),1)]),default:w(()=>[oe(" "+ee(S.value.hostname),1)]),_:1})])]),y("div",ua,[y("div",da,[f(t(ne),{size:"24"},{default:w(()=>[(O(),we(Je(z(S.value.osType))))]),_:1})]),y("div",ma,[b[3]||(b[3]=y("div",{class:"overview-label"},"操作系统",-1)),f(t(Se),{"show-arrow":!1},{trigger:w(()=>[y("div",ha,ee(S.value.osType),1)]),default:w(()=>[oe(" "+ee(S.value.osType),1)]),_:1})])]),y("div",fa,[y("div",ga,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Be))]),_:1})]),y("div",va,[b[4]||(b[4]=y("div",{class:"overview-label"},"系统版本",-1)),f(t(Se),{"show-arrow":!1},{trigger:w(()=>[y("div",pa,ee(I(S.value.osVersion)),1)]),default:w(()=>[oe(" "+ee(S.value.osVersion),1)]),_:1})])]),y("div",ya,[y("div",wa,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Fe))]),_:1})]),y("div",ba,[b[5]||(b[5]=y("div",{class:"overview-label"},"系统架构",-1)),f(t(Se),{"show-arrow":!1},{trigger:w(()=>[y("div",Ma,ee(S.value.architecture),1)]),default:w(()=>[oe(" "+ee(S.value.architecture),1)]),_:1})])]),y("div",Da,[y("div",Ta,[f(t(ne),{size:"24"},{default:w(()=>[f(t(Ze))]),_:1})]),y("div",Sa,[b[6]||(b[6]=y("div",{class:"overview-label"},"服务器类型",-1)),f(t(Se),{"show-arrow":!1},{trigger:w(()=>[y("div",ka,ee(_(S.value.serverType)),1)]),default:w(()=>[oe(" "+ee(_(S.value.serverType)),1)]),_:1})])]),y("div",_a,[y("div",$a,[f(t(ne),{size:"24"},{default:w(()=>[f(t(et))]),_:1})]),y("div",xa,[b[7]||(b[7]=y("div",{class:"overview-label"},"IP地址",-1)),f(t(Se),{"show-arrow":!1},{trigger:w(()=>[y("div",Ca,ee(S.value.ipAddress||"N/A"),1)]),default:w(()=>[oe(" "+ee(S.value.ipAddress||"N/A"),1)]),_:1})])])])]),_:1})])):te("",!0),D.value?(O(),j("div",Ia,[f(t(be),{size:"large"}),b[8]||(b[8]=y("p",null,"正在加载服务器监控数据，请稍候...",-1))])):te("",!0),!D.value&&d.value?(O(),j("div",La,[y("div",Pa,[y("div",Ra,[f(t(dt),{data:t(e).cpuMetrics.value,loading:t(J),"warning-threshold":80,"danger-threshold":90,"cpu-detail-data":t(e).cpuMetrics.value,onRefresh:g,onTimeRangeChange:B},null,8,["data","loading","cpu-detail-data"])]),y("div",Aa,[f(t(pt),{data:t(e).memoryMetrics.value,loading:t(Q),"warning-threshold":80,"danger-threshold":90,"memory-detail-data":t(e).memoryMetrics.value,onRefresh:v,onTimeRangeChange:H},null,8,["data","loading","memory-detail-data"])])]),y("div",Na,[y("div",Oa,[f(t(Tt),{data:t(e).diskMetrics.value,loading:t(F),"warning-threshold":80,"danger-threshold":90,"disk-detail-data":t(e).diskMetrics.value,onRefresh:T,onTimeRangeChange:Y},null,8,["data","loading","disk-detail-data"])]),y("div",Ha,[f(t(It),{data:t(e).diskIOMetrics.value,loading:t(U),"disk-io-detail-data":t(e).diskIOMetrics.value,onRefresh:p,onTimeRangeChange:m},null,8,["data","loading","disk-io-detail-data"])])]),y("div",Ya,[y("div",za,[f(t(Ot),{data:t(e).networkMetrics.value,loading:t(re),"network-detail-data":t(e).networkMetrics.value,"upload-color":"#ff4d4f","download-color":"#52c41a",onRefresh:u,onTimeRangeChange:ae},null,8,["data","loading","network-detail-data"])]),y("div",Ea,[f(t(qt),{data:t(e).processMetrics.value,loading:t(V),"process-detail-data":t(e).processMetrics.value,onRefresh:$,onTimeRangeChange:r},null,8,["data","loading","process-detail-data"])])])])):te("",!0),!D.value&&!d.value&&t(e).serverList.value.length>0?(O(),j("div",Ua,[f(t(fe),{description:"请选择一个服务器查看监控数据"})])):te("",!0),!D.value&&t(e).serverList.value.length===0?(O(),j("div",qa,[f(t(fe),{description:"暂无可用的服务器"})])):te("",!0)]))}}),dr=De(Ba,[["__scopeId","data-v-733bd8b9"]]);export{dr as default};

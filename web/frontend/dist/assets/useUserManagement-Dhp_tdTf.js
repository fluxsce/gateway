import{$ as k,r as D,f as I,b as v,Z as A}from"./index-Bm8WTrgo.js";const y=k("/gateway/hub0002");async function U(t){return y.post("/queryUsers",t)}async function F(t,d){return y.post("/deleteUser",{userId:t,tenantId:d})}async function M(t){return y.post("/editUser",t)}async function S(t){return y.post("/addUser",t)}async function O(t,d){return y.post("/getUser",{userId:t,tenantId:d})}async function B(t){return y.post("/changePassword",t)}var p=(t=>(t.ENABLED="Y",t.DISABLED="N",t))(p||{}),c=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.MALE=1]="MALE",t[t.FEMALE=2]="FEMALE",t))(c||{}),i=(t=>(t.YES="Y",t.NO="N",t))(i||{});function x(){const t=D(),d={searchForm:{fields:[{field:"userName",label:"用户名",type:"input",span:4},{field:"realName",label:"姓名",type:"input",span:4},{field:"mobile",label:"手机号",type:"input",span:4},{field:"email",label:"邮箱",type:"input",span:4},{field:"statusFlag",label:"状态",type:"select",options:[{label:"启用",value:p.ENABLED},{label:"禁用",value:p.DISABLED}]}],submitButtonText:"查询"},editForm:{fields:[{field:"userId",label:"用户ID",type:"input",primaryKey:!0,props:{}},{field:"tenantId",label:"租户ID",type:"input",primaryKey:!0,props:{}},{field:"userName",label:"用户名",type:"input",rules:[{required:!0,message:"请输入用户名"}]},{field:"password",label:"密码",type:"input",placeholder:"不修改请留空",props:{type:"password"}},{field:"realName",label:"姓名",type:"input",rules:[{required:!0,message:"请输入姓名"}]},{field:"deptId",label:"部门ID",type:"input",rules:[{required:!0,message:"请输入部门ID"}]},{field:"email",label:"邮箱",type:"input",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入正确的邮箱格式"}]},{field:"mobile",label:"手机号",type:"input",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码"}]},{field:"avatar",label:"头像",type:"input",placeholder:"请输入头像URL"},{field:"gender",label:"性别",type:"select",options:[{label:"男",value:c.MALE},{label:"女",value:c.FEMALE},{label:"未知",value:c.UNKNOWN}]},{field:"statusFlag",label:"状态",type:"select",rules:[{required:!0,message:"请选择状态"}],options:[{label:"启用",value:p.ENABLED},{label:"禁用",value:p.DISABLED}]},{field:"userExpireDate",label:"过期时间",type:"datetime",rules:[{required:!0,message:"请选择用户过期时间"}],props:{format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss"}},{field:"deptAdminFlag",label:"部门管理员",type:"select",rules:[{required:!0,message:"请选择是否为部门管理员"}],options:[{label:"是",value:i.YES},{label:"否",value:i.NO}]},{field:"tenantAdminFlag",label:"租户管理员",type:"select",rules:[{required:!0,message:"请选择是否为租户管理员"}],options:[{label:"是",value:i.YES},{label:"否",value:i.NO}]},{field:"activeFlag",label:"活动状态",type:"select",rules:[{required:!0,message:"请选择活动状态"}],options:[{label:"活动",value:i.YES},{label:"非活动",value:i.NO}]},{field:"noteText",label:"备注",type:"textarea",span:24}],labelWidth:100,labelPlacement:"left",showResetButton:!0,resetButtonText:"重置"},grid:{columns:[{key:"userId",title:"用户ID",width:100},{key:"tenantId",title:"租户ID",width:100},{key:"userName",title:"用户名"},{key:"realName",title:"姓名"},{key:"deptId",title:"部门ID",width:100},{key:"mobile",title:"手机号"},{key:"email",title:"邮箱"},{key:"avatar",title:"头像",width:80,render:e=>e.avatar?"有":"无"},{key:"gender",title:"性别",width:80,render:e=>{switch(e.gender){case c.MALE:return"男";case c.FEMALE:return"女";default:return"未知"}}},{key:"statusFlag",title:"状态",width:80,render:e=>e.statusFlag===p.ENABLED?"启用":"禁用"},{key:"userExpireDate",title:"过期时间",width:150,render:e=>e.userExpireDate?new Date(e.userExpireDate).toLocaleString():"永不过期"},{key:"deptAdminFlag",title:"部门管理员",width:100,render:e=>e.deptAdminFlag===i.YES?"是":"否"},{key:"tenantAdminFlag",title:"租户管理员",width:100,render:e=>e.tenantAdminFlag===i.YES?"是":"否"},{key:"lastLoginTime",title:"最后登录时间",width:150,render:e=>e.lastLoginTime?new Date(e.lastLoginTime).toLocaleString():"未登录"},{key:"lastLoginIp",title:"最后登录IP",width:120},{key:"addTime",title:"创建时间",width:150,render:e=>e.addTime?new Date(e.addTime).toLocaleString():""},{key:"addWho",title:"创建人",width:100},{key:"editTime",title:"修改时间",width:150,render:e=>e.editTime?new Date(e.editTime).toLocaleString():""},{key:"editWho",title:"修改人",width:100},{key:"oprSeqFlag",title:"操作序列",width:100},{key:"currentVersion",title:"版本号",width:80},{key:"activeFlag",title:"活动状态",width:80,render:e=>e.activeFlag===i.YES?"活动":"非活动"},{key:"noteText",title:"备注",width:150}],action:{show:!0,width:200,title:"操作",buttons:[{id:"edit",text:"编辑",type:"primary"},{id:"delete",text:"删除",type:"error"},{id:"view",text:"查看",type:"primary"}]}},toolbar:{show:!0,buttons:[{id:"add",text:"新增",type:"primary"}]}},u=I({pageIndex:1,pageSize:5,totalCount:0,baseData:"",curPageCount:0,dbsId:"",mainKey:"",orderByList:"",otherData:"",paramObjectsJson:"",timeTypeFieldNames:"",totalPageIndex:0}),o=I([]),g=D(0);return{gridFormRef:t,formConfig:d,pagination:u,userList:o,totalCount:g}}const n=A("UserManagement");function K(t){const d=t||x(),{userList:u,pagination:o,totalCount:g}=d,e=v(),m=a=>{if(a.bizData)try{return JSON.parse(a.bizData)}catch(r){throw n.error("解析JsonDataObj失败",r),e.error("解析数据失败"),new Error("解析数据失败")}return{}},N=a=>{if(a.pageQueryData)try{return JSON.parse(a.pageQueryData)}catch(r){throw n.error("解析分页信息失败",r),e.error("解析分页信息失败"),new Error("解析分页信息失败")}return{}},b=async a=>{try{const r=await U(a),s=m(r),l=N(r);u.length=0,s&&Array.isArray(s)&&u.push(...s),l&&(Object.assign(o,l),l.totalCount&&(g.value=l.totalCount))}catch(r){n.error("加载用户数据失败",r),e.error("加载用户数据失败")}},f=async(a={})=>{await b({...a,pageIndex:o.pageIndex,pageSize:o.pageSize})},L=async a=>{Object.assign(o,a),await f()},h=async(a,r)=>{try{const s=await M(a);if(s.oK&&s.state){const l=m(s);return r!==-1&&l&&(u[r]=l),e.success(s.popMsg||"编辑用户成功"),l}else return e.error(s.popMsg||"编辑用户失败"),null}catch(s){return n.error("编辑用户出错",s),e.error("编辑用户请求失败"),null}},w=async(a,r,s)=>{try{const l=await F(a,r);return l.oK&&l.state?(u.splice(s,1),e.success(l.popMsg||"删除用户成功"),!0):(e.error(l.popMsg||"删除用户失败"),!1)}catch(l){return n.error("删除用户出错",l),e.error("删除用户请求失败"),!1}},E=async a=>{try{const r=await S(a);if(r.oK&&r.state){const s=m(r);return u.push(s),e.success(r.popMsg||"添加用户成功"),s}else return e.error(r.popMsg||"添加用户失败"),null}catch(r){return n.error("添加用户出错",r),e.error("添加用户请求失败"),null}};return{loadUserData:b,handleSearch:f,handlePaginationChange:L,handleAction:async(a,r,s)=>{try{switch(a){case"edit":await h(r,s);break;case"delete":r.userId&&r.tenantId&&await w(r.userId,r.tenantId,s);break;case"add":await E(r);break;case"view":e.info(`查看用户: ${r.realName||r.userName}`);break;default:n.warn(`Unhandled action: ${a}`);return}}catch(l){n.error(`Failed to ${a} user:`,l),e.error(`执行 ${a} 操作失败`)}},editUser:h,deleteUser:w,addUser:E}}export{K as a,B as c,M as e,O as g,x as u};

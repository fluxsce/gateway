import{d as de,c as fe,o as ne,a as f,g as j,W as Qe,a8 as S,aM as De,v as G,I as K,cQ as We,a3 as re,bR as me,d1 as Xe,m as e,w as t,cz as ze,J as r,x as Q,n as p,_ as ke,b as Ie,r as A,R as Te,q as Ze,V as Be,cB as et,B as tt,M as Me,A as Pe,aX as ae,Y as xe,C as at,E as lt,aY as le,K as Fe,t as nt,cO as Se,cr as Ye,co as Ee,$ as ot,f as st,h as it,a1 as rt,Z as ut,a0 as ce,a2 as J,cT as dt}from"./index-DfObWGJe.js";import{C as Re}from"./CheckmarkCircleOutline-CHhNyO7H.js";import{A as Oe}from"./AlertCircleOutline-ChDoPmCt.js";import{S as ft}from"./StopOutline-nDGtBXyl.js";import{P as gt}from"./PlayOutline-CDsHdqsS.js";import{T as ct}from"./TrashOutline-CJ0rgFEJ.js";import{S as mt}from"./SyncOutline-BLIzlI_k.js";import{R as pt}from"./RefreshOutline-CnnajpOk.js";import{_ as vt}from"./DataTable-ByRKZq4L.js";import{_ as ht,a as yt}from"./Upload-B8nPXHjG.js";import{C as He}from"./Close-WLeH7cCT.js";import{_ as Ue,a as Le}from"./Grid-BVaxD0uP.js";import{N as bt}from"./InputNumber-Be_gf9_Z.js";import{N as Ct}from"./Switch-DXoA58mW.js";import{_ as _t}from"./RadioGroup-Ck9rpfWR.js";import{_ as $e}from"./Alert-SoozFcx5.js";import{_ as St}from"./DynamicTags-C6ewTd_n.js";import{S as kt,C as wt,A as Dt,R as Tt}from"./RateLimitConfigForm-C17-x8fQ.js";import{A as Ft}from"./AddOutline-GcBA4_bX.js";import"./Progress-Bq_9Wb-K.js";import"./InformationCircleOutline-jjfb8-JN.js";import"./FormItemGridItem-B285cuRf.js";import"./CreateOutline-C49Ddl3A.js";const At={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=de({name:"DocumentOutline",render:function(y,v){return ne(),fe("svg",At,v[0]||(v[0]=[f("path",{d:"M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{d:"M256 56v120a32 32 0 0 0 32 32h120",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Nt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ne=de({name:"DocumentsOutline",render:function(y,v){return ne(),fe("svg",Nt,v[0]||(v[0]=[f("path",{d:"M336 264.13V436c0 24.3-19.05 44-42.95 44H107c-23.95 0-43-19.7-43-44V172a44.26 44.26 0 0 1 44-44h94.12a24.55 24.55 0 0 1 17.49 7.36l109.15 111a25.4 25.4 0 0 1 7.24 17.77z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{d:"M200 128v108a28.34 28.34 0 0 0 28 28h108",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{d:"M176 128V76a44.26 44.26 0 0 1 44-44h94a24.83 24.83 0 0 1 17.61 7.36l109.15 111A25.09 25.09 0 0 1 448 168v172c0 24.3-19.05 44-42.95 44H344",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{d:"M312 32v108a28.34 28.34 0 0 0 28 28h108",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}});function zt(u,y){const v=j(()=>{var i;return((i=u.value)==null?void 0:i.filter(w=>w.healthStatus==="Y"))||[]}),D=i=>i.tlsEnabled==="Y"&&i.httpsPort?`${i.bindAddress}:${i.httpsPort}`:`${i.bindAddress}${i.httpPort?`:${i.httpPort}`:""}`;return{onlineInstances:v,tableColumns:[{title:"实例名称",key:"instanceName",width:160,ellipsis:{tooltip:!0},fixed:"left"},{title:"描述",key:"instanceDesc",width:180,ellipsis:{tooltip:!0},render:i=>i.instanceDesc||"-"},{title:"服务地址",key:"bindAddress",width:160,render:D},{title:"TLS",key:"tlsEnabled",width:70,render:i=>S(De,{type:i.tlsEnabled==="Y"?"success":"default",size:"small"},()=>i.tlsEnabled==="Y"?"启用":"禁用")},{title:"状态",key:"healthStatus",width:90,render:i=>S(De,{type:i.healthStatus==="Y"?"success":"error",size:"small"},{default:()=>i.healthStatus==="Y"?"在线":"离线",icon:()=>S(G,null,()=>S(i.healthStatus==="Y"?Re:Oe))})},{title:"最大连接数",key:"maxConnections",width:110,render:i=>i.maxConnections.toLocaleString()},{title:"最后心跳",key:"lastHeartbeatTime",width:170,render:i=>{if(!i.lastHeartbeatTime)return"-";try{return Qe(i.lastHeartbeatTime,"YYYY-MM-DD HH:mm:ss")}catch(w){return console.warn("格式化心跳时间失败:",w),i.lastHeartbeatTime}}},{title:"操作",key:"actions",width:260,fixed:"right",render:i=>{const w=S(re,{trigger:"hover"},{trigger:()=>S(K,{size:"small",type:"primary",secondary:!0,onClick:()=>y("config",i)},{icon:()=>S(G,null,()=>S(We))}),default:()=>"配置管理"}),M=S(re,{trigger:"hover"},{trigger:()=>S(K,{size:"small",type:i.healthStatus==="Y"?"warning":"success",secondary:!0,onClick:()=>i.healthStatus==="Y"?y("stop",i):y("start",i)},{icon:()=>S(G,null,()=>S(i.healthStatus==="Y"?ft:gt))}),default:()=>i.healthStatus==="Y"?"停止实例":"启动实例"}),Y=S(re,{trigger:"hover"},{trigger:()=>S(K,{size:"small",onClick:()=>y("edit",i)},()=>"编辑"),default:()=>"编辑实例"}),E=S(re,{trigger:"hover"},{trigger:()=>S(K,{size:"small",type:"error",secondary:!0,onClick:()=>y("delete",i)},{icon:()=>S(G,null,()=>S(ct))}),default:()=>"删除实例"}),P=S(re,{trigger:"hover"},{trigger:()=>S(K,{size:"small",type:"primary",secondary:!0,onClick:()=>y("reload",i)},{icon:()=>S(G,null,()=>S(mt))}),default:()=>"网关重载"});return S(me,{size:"small"},()=>[w,M,Y,E,P])}}],formatServiceAddress:D}}const It={class:"gateway-instance-table"},Bt={class:"table-header"},Mt={class:"header-left"},Pt={class:"header-actions"},xt=de({__name:"GatewayInstanceTable",props:{instances:{},loading:{type:Boolean}},emits:["create","edit","delete","start","stop","config","refresh","reload"],setup(u,{emit:y}){const v=u,D=y,{instances:_}=Xe(v),{onlineInstances:C,tableColumns:k}=zt(_,D);return(z,i)=>{const w=ze,M=G,Y=K,E=me,P=vt;return ne(),fe("div",It,[f("div",Bt,[e(E,{justify:"space-between"},{default:t(()=>[f("div",Mt,[i[1]||(i[1]=f("h3",null,"网关实例列表",-1)),e(w,{depth:"3"},{default:t(()=>[r("共 "+Q(p(_).length)+" 个实例，"+Q(p(C).length)+" 个在线",1)]),_:1})]),f("div",Pt,[e(Y,{onClick:i[0]||(i[0]=V=>z.$emit("refresh"))},{icon:t(()=>[e(M,null,{default:t(()=>[e(p(pt))]),_:1})]),default:t(()=>[i[2]||(i[2]=r(" 刷新 "))]),_:1})])]),_:1})]),e(P,{columns:p(k),data:p(_),loading:z.loading,bordered:!1,size:"medium","scroll-x":1200,"flex-height":"",style:{height:"600px"}},null,8,["columns","data","loading"])])}}}),Yt=ke(xt,[["__scopeId","data-v-c1f9a594"]]);function Et(){const u=Ie(),y=A(null),v=A(!1),D=A(!1),_=A([]),C=A([]),k=A([]),z={instanceName:{required:!0,message:"请输入实例名称",trigger:["input","blur"]},bindAddress:{required:!0,message:"请输入绑定地址",trigger:["input","blur"]},httpPort:{required:!1,type:"number",message:"请输入有效的HTTP端口号",trigger:["input","blur"]},httpsPort:{required:!1,type:"number",message:"请输入有效的HTTPS端口号",trigger:["input","blur"]}},i=b=>new Promise((F,s)=>{const n=new FileReader;n.onload=m=>{var g;return F((g=m.target)==null?void 0:g.result)},n.onerror=s,n.readAsText(b)});return{formRef:y,visible:v,showCertContent:D,certFileList:_,keyFileList:C,certChainFileList:k,formRules:z,handleCertFileChange:async(b,F)=>{const{file:s}=b;if(s.file)try{if(s.file.size>10*1024*1024){u.error("证书文件不能超过10MB");return}const n=await i(s.file);F.certContent=n,_.value=[s],u.success("证书文件上传成功")}catch(n){u.error("证书文件读取失败"),console.error("Error reading cert file:",n)}},handleCertFileRemove:b=>{_.value=[],b.certContent="",u.info("已移除证书文件")},handleKeyFileChange:async(b,F)=>{const{file:s}=b;if(s.file)try{if(s.file.size>10*1024*1024){u.error("私钥文件不能超过10MB");return}const n=await i(s.file);F.keyContent=n,C.value=[s],u.success("私钥文件上传成功")}catch(n){u.error("私钥文件读取失败"),console.error("Error reading key file:",n)}},handleKeyFileRemove:b=>{C.value=[],b.keyContent="",u.info("已移除私钥文件")},handleCertChainFileChange:async(b,F)=>{const{file:s}=b;if(s.file)try{if(s.file.size>10*1024*1024){u.error("证书链文件不能超过10MB");return}const n=await i(s.file);F.certChainContent=n,k.value=[s],u.success("证书链文件上传成功")}catch(n){u.error("证书链文件读取失败"),console.error("Error reading cert chain file:",n)}},handleCertChainFileRemove:b=>{k.value=[],b.certChainContent="",u.info("已移除证书链文件")},resetFileUploadState:()=>{_.value=[],C.value=[],k.value=[],D.value=!1},syncEditFileState:b=>{b.certContent?_.value=[{id:"existing-cert",name:"已上传的证书文件",status:"finished",type:"application/x-pem-file"}]:_.value=[],b.keyContent?C.value=[{id:"existing-key",name:"已上传的私钥文件",status:"finished",type:"application/x-pem-file"}]:C.value=[],b.certChainContent?k.value=[{id:"existing-chain",name:"已上传的证书链文件",status:"finished",type:"application/x-pem-file"}]:k.value=[]},validateForm:async()=>{var b;try{return await((b=y.value)==null?void 0:b.validate()),!0}catch{return u.error("请检查表单输入"),!1}}}}const Rt={class:"modal-header"},Ot={class:"header-content"},Ht={class:"modal-title"},Ut={class:"modal-content"},Lt={class:"cert-upload-section"},$t={class:"upload-content"},Jt={class:"upload-content"},Gt={class:"upload-content"},Kt={class:"cert-content-section"},Vt={key:0,class:"log-output-config"},qt={class:"modal-footer"},jt=de({__name:"GatewayInstanceDialog",props:{show:{type:Boolean},isEditing:{type:Boolean},formData:{},submitting:{type:Boolean}},emits:["update:show","submit"],setup(u,{emit:y}){const v=u,D=y,{formRef:_,visible:C,certFileList:k,keyFileList:z,certChainFileList:i,formRules:w,handleCertFileChange:M,handleCertFileRemove:Y,handleKeyFileChange:E,handleKeyFileRemove:P,handleCertChainFileChange:V,handleCertChainFileRemove:O,resetFileUploadState:H,syncEditFileState:R,validateForm:b}=Et(),F=[{label:"TLS 1.0",value:"1.0"},{label:"TLS 1.1",value:"1.1"},{label:"TLS 1.2",value:"1.2"},{label:"TLS 1.3",value:"1.3"}],s=[{label:"文件存储",value:"FILE"},{label:"数据库存储",value:"DATABASE"}],n=[{label:"JSON格式",value:"JSON"},{label:"文本格式",value:"TEXT"},{label:"CSV格式",value:"CSV"}],m=[{label:"文件输出",value:"FILE"},{label:"数据库输出",value:"DATABASE"},{label:"MongoDB输出",value:"MONGODB"},{label:"Elasticsearch输出",value:"ELASTICSEARCH"},{label:"ClickHouse输出",value:"CLICKHOUSE"}],g=[{label:"替换为*",value:"****"},{label:"替换为[MASKED]",value:"[MASKED]"},{label:"保留前后字符",value:"KEEP_EDGE"},{label:"自定义规则",value:"CUSTOM"}],h=j(()=>v.formData.tlsEnabled==="Y"),U=j(()=>v.formData.tlsEnabled==="Y"&&v.formData.certStorageType==="FILE"),ge=j(()=>v.formData.tlsEnabled==="Y"&&v.formData.certStorageType==="DATABASE"),q=j(()=>{var l,a;return((a=(l=v.formData.logConfig)==null?void 0:l.outputTargets)==null?void 0:a.includes("FILE"))||!1});Te(()=>v.show,l=>{C.value=l,l&&v.isEditing?R(v.formData):l||H()}),Te(C,l=>{D("update:show",l)});const W=()=>{C.value=!1},pe=async()=>{await b()&&D("submit",v.formData)},ve=l=>M(l,v.formData),X=()=>Y(v.formData),Z=l=>E(l,v.formData),ee=()=>P(v.formData),he=l=>V(l,v.formData),ye=()=>O(v.formData);return(l,a)=>{const $=G,be=K,T=ze,L=xe,I=lt,c=at,d=Le,N=bt,x=Ct,B=Ue,se=_t,te=me,Ce=yt,_e=ht,ie=Be,we=Pe,Je=$e,Ge=St,Ke=Me,Ve=tt,qe=et,je=Ee;return ne(),Ze(je,{show:p(C),"onUpdate:show":a[44]||(a[44]=o=>Ye(C)?C.value=o:null),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:t(()=>[e(ie,{style:{width:"1000px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true",class:"instance-modal"},{header:t(()=>[f("div",Rt,[e($,{size:"24",class:"modal-icon"},{default:t(()=>[e(p(Se))]),_:1}),f("div",Ot,[f("h3",Ht,Q(l.isEditing?"编辑网关实例":"新建网关实例"),1),a[45]||(a[45]=f("p",{class:"modal-subtitle"},"配置网关实例的基本信息、TLS证书、性能参数等",-1))])])]),"header-extra":t(()=>[e(be,{quaternary:"",circle:"",onClick:W,class:"close-btn"},{icon:t(()=>[e($,{size:"18"},{default:t(()=>[e(p(He))]),_:1})]),_:1})]),footer:t(()=>[f("div",qt,[e(te,{justify:"end"},{default:t(()=>[e(be,{onClick:W,size:"medium"},{default:t(()=>a[89]||(a[89]=[r("取消")])),_:1}),e(be,{type:"primary",loading:l.submitting,onClick:pe,size:"medium"},{default:t(()=>[r(Q(l.isEditing?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})])]),default:t(()=>[e(qe,{style:{"max-height":"70vh"},trigger:"hover","x-scrollable":!1},{default:t(()=>[f("div",Ut,[e(Ve,{ref_key:"formRef",ref:_,model:l.formData,rules:p(w),"label-placement":"left","label-width":"160px","require-mark-placement":"right-hanging",class:"instance-form"},{default:t(()=>[e(Ke,{type:"line",animated:""},{default:t(()=>[e(we,{name:"instance",tab:"实例配置"},{default:t(()=>[e(L,{"title-placement":"left"},{default:t(()=>[e(T,{class:"section-title"},{default:t(()=>a[46]||(a[46]=[r("基本信息")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"实例名称",path:"instanceName"},{default:t(()=>[e(I,{value:l.formData.instanceName,"onUpdate:value":a[0]||(a[0]=o=>l.formData.instanceName=o),placeholder:"请输入实例名称"},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"绑定地址",path:"bindAddress"},{default:t(()=>[e(I,{value:l.formData.bindAddress,"onUpdate:value":a[1]||(a[1]=o=>l.formData.bindAddress=o),placeholder:"如: 0.0.0.0"},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"HTTP端口",path:"httpPort"},{default:t(()=>[e(N,{value:l.formData.httpPort,"onUpdate:value":a[2]||(a[2]=o=>l.formData.httpPort=o),min:1,max:65535,placeholder:"如: 8080",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"HTTPS端口",path:"httpsPort"},{default:t(()=>[e(N,{value:l.formData.httpsPort,"onUpdate:value":a[3]||(a[3]=o=>l.formData.httpsPort=o),min:1,max:65535,placeholder:"如: 8443",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"自动启动",path:"activeFlag"},{default:t(()=>[e(x,{value:l.formData.activeFlag,"onUpdate:value":a[4]||(a[4]=o=>l.formData.activeFlag=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[47]||(a[47]=[r("启用")])),unchecked:t(()=>a[48]||(a[48]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,{span:2},{default:t(()=>[e(c,{label:"实例描述",path:"instanceDesc"},{default:t(()=>[e(I,{value:l.formData.instanceDesc,"onUpdate:value":a[5]||(a[5]=o=>l.formData.instanceDesc=o),type:"textarea",placeholder:"请输入实例描述",rows:3},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(L,{"title-placement":"left"},{default:t(()=>[e(T,{class:"section-title"},{default:t(()=>a[49]||(a[49]=[r("TLS安全配置")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"启用TLS",path:"tlsEnabled"},{default:t(()=>[e(x,{value:l.formData.tlsEnabled,"onUpdate:value":a[6]||(a[6]=o=>l.formData.tlsEnabled=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[50]||(a[50]=[r("启用")])),unchecked:t(()=>a[51]||(a[51]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),ae(e(d,null,{default:t(()=>[e(c,{label:"证书存储类型",path:"certStorageType"},{default:t(()=>[e(se,{value:l.formData.certStorageType,"onUpdate:value":a[7]||(a[7]=o=>l.formData.certStorageType=o),options:s,placeholder:"选择证书存储方式"},null,8,["value"])]),_:1})]),_:1},512),[[le,h.value]]),ae(e(d,null,{default:t(()=>[e(c,{label:"证书文件路径",path:"certFilePath"},{default:t(()=>[e(I,{value:l.formData.certFilePath,"onUpdate:value":a[8]||(a[8]=o=>l.formData.certFilePath=o),placeholder:"/path/to/cert.pem"},null,8,["value"])]),_:1})]),_:1},512),[[le,U.value]]),ae(e(d,null,{default:t(()=>[e(c,{label:"私钥文件路径",path:"keyFilePath"},{default:t(()=>[e(I,{value:l.formData.keyFilePath,"onUpdate:value":a[9]||(a[9]=o=>l.formData.keyFilePath=o),placeholder:"/path/to/key.pem"},null,8,["value"])]),_:1})]),_:1},512),[[le,U.value]])]),_:1}),ae(f("div",Lt,[e(B,{cols:3,"x-gap":16,"y-gap":16},{default:t(()=>[e(d,null,{default:t(()=>[e(ie,{size:"small",class:"upload-card"},{header:t(()=>[e(te,{align:"center"},{default:t(()=>[e($,{size:"16",color:"#18a058"},{default:t(()=>[e(p(Ae))]),_:1}),a[52]||(a[52]=f("span",null,"证书文件",-1))]),_:1})]),default:t(()=>[e(_e,{"file-list":p(k),max:1,"on-change":ve,"on-remove":X,accept:".crt,.pem,.cer","show-file-list":!0,"custom-request":()=>{},class:"cert-upload"},{default:t(()=>[e(Ce,null,{default:t(()=>[f("div",$t,[e($,{size:"32",depth:"3"},{default:t(()=>[e(p(Ae))]),_:1}),e(T,{depth:"3"},{default:t(()=>a[53]||(a[53]=[r("点击或拖拽上传证书")])),_:1}),e(T,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[54]||(a[54]=[r("支持 .crt, .pem, .cer")])),_:1})])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(ie,{size:"small",class:"upload-card"},{header:t(()=>[e(te,{align:"center"},{default:t(()=>[e($,{size:"16",color:"#f0a020"},{default:t(()=>[e(p(Fe))]),_:1}),a[55]||(a[55]=f("span",null,"私钥文件",-1))]),_:1})]),default:t(()=>[e(_e,{"file-list":p(z),max:1,"on-change":Z,"on-remove":ee,accept:".key,.pem","show-file-list":!0,"custom-request":()=>{},class:"cert-upload"},{default:t(()=>[e(Ce,null,{default:t(()=>[f("div",Jt,[e($,{size:"32",depth:"3"},{default:t(()=>[e(p(Fe))]),_:1}),e(T,{depth:"3"},{default:t(()=>a[56]||(a[56]=[r("点击或拖拽上传私钥")])),_:1}),e(T,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[57]||(a[57]=[r("支持 .key, .pem")])),_:1})])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(ie,{size:"small",class:"upload-card"},{header:t(()=>[e(te,{align:"center"},{default:t(()=>[e($,{size:"16",color:"#2080f0"},{default:t(()=>[e(p(Ne))]),_:1}),a[58]||(a[58]=f("span",null,"证书链(可选)",-1))]),_:1})]),default:t(()=>[e(_e,{"file-list":p(i),max:1,"on-change":he,"on-remove":ye,accept:".crt,.pem,.cer","show-file-list":!0,"custom-request":()=>{},class:"cert-upload"},{default:t(()=>[e(Ce,null,{default:t(()=>[f("div",Gt,[e($,{size:"32",depth:"3"},{default:t(()=>[e(p(Ne))]),_:1}),e(T,{depth:"3"},{default:t(()=>a[59]||(a[59]=[r("点击或拖拽上传证书链")])),_:1}),e(T,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[60]||(a[60]=[r("支持 .crt, .pem, .cer")])),_:1})])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1}),ae(f("div",Kt,[e(B,{cols:1,"y-gap":16,style:{"margin-top":"16px"}},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"证书内容(PEM格式)",path:"certContent"},{default:t(()=>[e(I,{value:l.formData.certContent,"onUpdate:value":a[10]||(a[10]=o=>l.formData.certContent=o),type:"textarea",placeholder:"通过上传文件自动填充",rows:4},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"私钥内容(PEM格式)",path:"keyContent"},{default:t(()=>[e(I,{value:l.formData.keyContent,"onUpdate:value":a[11]||(a[11]=o=>l.formData.keyContent=o),type:"textarea",placeholder:"通过上传文件自动填充",rows:4},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"证书链内容(PEM格式，可选)",path:"certChainContent"},{default:t(()=>[e(I,{value:l.formData.certChainContent,"onUpdate:value":a[12]||(a[12]=o=>l.formData.certChainContent=o),type:"textarea",placeholder:"通过上传文件自动填充",rows:3},null,8,["value"])]),_:1})]),_:1})]),_:1})],512),[[le,!1]])],512),[[le,ge.value]]),ae(f("div",null,[e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"TLS版本",path:"tlsVersion"},{default:t(()=>[e(se,{value:l.formData.tlsVersion,"onUpdate:value":a[13]||(a[13]=o=>l.formData.tlsVersion=o),multiple:"",options:F,placeholder:"选择支持的TLS版本","max-tag-count":2},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"启用HTTP/2",path:"enableHttp2"},{default:t(()=>[e(x,{value:l.formData.enableHttp2,"onUpdate:value":a[14]||(a[14]=o=>l.formData.enableHttp2=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[61]||(a[61]=[r("启用")])),unchecked:t(()=>a[62]||(a[62]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,{span:2},{default:t(()=>[e(c,{label:"TLS密码套件",path:"tlsCipherSuites"},{default:t(()=>[e(I,{value:l.formData.tlsCipherSuites,"onUpdate:value":a[15]||(a[15]=o=>l.formData.tlsCipherSuites=o),placeholder:"多个密码套件用逗号分隔，如: TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256，留空使用默认配置",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1})],512),[[le,h.value]]),e(L,{"title-placement":"left"},{default:t(()=>[e(T,{class:"section-title"},{default:t(()=>a[63]||(a[63]=[r("性能配置")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"最大连接数",path:"maxConnections"},{default:t(()=>[e(N,{value:l.formData.maxConnections,"onUpdate:value":a[16]||(a[16]=o=>l.formData.maxConnections=o),min:100,max:1e5,placeholder:"10000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"最大工作协程数",path:"maxWorkers"},{default:t(()=>[e(N,{value:l.formData.maxWorkers,"onUpdate:value":a[17]||(a[17]=o=>l.formData.maxWorkers=o),min:100,max:1e4,placeholder:"1000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"读取超时(ms)",path:"readTimeoutMs"},{default:t(()=>[e(N,{value:l.formData.readTimeoutMs,"onUpdate:value":a[18]||(a[18]=o=>l.formData.readTimeoutMs=o),min:1e3,max:3e5,placeholder:"30000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"写入超时(ms)",path:"writeTimeoutMs"},{default:t(()=>[e(N,{value:l.formData.writeTimeoutMs,"onUpdate:value":a[19]||(a[19]=o=>l.formData.writeTimeoutMs=o),min:1e3,max:3e5,placeholder:"30000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"空闲超时(ms)",path:"idleTimeoutMs"},{default:t(()=>[e(N,{value:l.formData.idleTimeoutMs,"onUpdate:value":a[20]||(a[20]=o=>l.formData.idleTimeoutMs=o),min:1e3,max:6e5,placeholder:"60000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"最大请求头大小(字节)",path:"maxHeaderBytes"},{default:t(()=>[e(N,{value:l.formData.maxHeaderBytes,"onUpdate:value":a[21]||(a[21]=o=>l.formData.maxHeaderBytes=o),min:1024,max:10485760,placeholder:"1048576",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(L,{"title-placement":"left"},{default:t(()=>[e(T,{class:"section-title"},{default:t(()=>a[64]||(a[64]=[r("Keep-Alive配置")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"HTTP Keep-Alive",path:"keepAliveEnabled"},{default:t(()=>[e(te,{vertical:""},{default:t(()=>[e(x,{value:l.formData.keepAliveEnabled,"onUpdate:value":a[22]||(a[22]=o=>l.formData.keepAliveEnabled=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[65]||(a[65]=[r("启用")])),unchecked:t(()=>a[66]||(a[66]=[r("禁用")])),_:1},8,["value"]),e(T,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[67]||(a[67]=[r(" HTTP层复用连接，减少建立连接开销 ")])),_:1})]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"TCP Keep-Alive",path:"tcpKeepAliveEnabled"},{default:t(()=>[e(te,{vertical:""},{default:t(()=>[e(x,{value:l.formData.tcpKeepAliveEnabled,"onUpdate:value":a[23]||(a[23]=o=>l.formData.tcpKeepAliveEnabled=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[68]||(a[68]=[r("启用")])),unchecked:t(()=>a[69]||(a[69]=[r("禁用")])),_:1},8,["value"]),e(T,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[70]||(a[70]=[r(" TCP层检测死连接，及时清理资源 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{"title-placement":"left"},{default:t(()=>[e(T,{class:"section-title"},{default:t(()=>a[71]||(a[71]=[r("备注信息")])),_:1})]),_:1}),e(c,{label:"备注",path:"noteText"},{default:t(()=>[e(I,{value:l.formData.noteText,"onUpdate:value":a[24]||(a[24]=o=>l.formData.noteText=o),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1}),e(we,{name:"log",tab:"日志配置"},{default:t(()=>[e(Je,{type:"info",style:{"margin-bottom":"20px"}},{default:t(()=>a[72]||(a[72]=[r(" 配置网关实例的日志记录策略，包括日志格式、输出目标、轮转策略等。 ")])),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"日志配置名称",path:"logConfig.configName"},{default:t(()=>[e(I,{value:l.formData.logConfig.configName,"onUpdate:value":a[25]||(a[25]=o=>l.formData.logConfig.configName=o),placeholder:"请输入日志配置名称"},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"日志格式",path:"logConfig.logFormat"},{default:t(()=>[e(se,{value:l.formData.logConfig.logFormat,"onUpdate:value":a[26]||(a[26]=o=>l.formData.logConfig.logFormat=o),options:n,placeholder:"选择日志格式"},null,8,["value"])]),_:1})]),_:1}),e(d,{span:2},{default:t(()=>[e(c,{label:"日志配置描述",path:"logConfig.configDesc"},{default:t(()=>[e(I,{value:l.formData.logConfig.configDesc,"onUpdate:value":a[27]||(a[27]=o=>l.formData.logConfig.configDesc=o),type:"textarea",placeholder:"请输入日志配置描述",rows:2},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(L,{"title-placement":"left",style:{margin:"24px 0"}},{default:t(()=>[e(T,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[73]||(a[73]=[r("日志内容控制")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"记录请求体",path:"logConfig.recordRequestBody"},{default:t(()=>[e(x,{value:l.formData.logConfig.recordRequestBody,"onUpdate:value":a[28]||(a[28]=o=>l.formData.logConfig.recordRequestBody=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[74]||(a[74]=[r("启用")])),unchecked:t(()=>a[75]||(a[75]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"记录响应体",path:"logConfig.recordResponseBody"},{default:t(()=>[e(x,{value:l.formData.logConfig.recordResponseBody,"onUpdate:value":a[29]||(a[29]=o=>l.formData.logConfig.recordResponseBody=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[76]||(a[76]=[r("启用")])),unchecked:t(()=>a[77]||(a[77]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"记录请求头",path:"logConfig.recordHeaders"},{default:t(()=>[e(x,{value:l.formData.logConfig.recordHeaders,"onUpdate:value":a[30]||(a[30]=o=>l.formData.logConfig.recordHeaders=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[78]||(a[78]=[r("启用")])),unchecked:t(()=>a[79]||(a[79]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"最大报文大小(字节)",path:"logConfig.maxBodySizeBytes"},{default:t(()=>[e(N,{value:l.formData.logConfig.maxBodySizeBytes,"onUpdate:value":a[31]||(a[31]=o=>l.formData.logConfig.maxBodySizeBytes=o),min:0,placeholder:"1048576",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(L,{"title-placement":"left",style:{margin:"24px 0"}},{default:t(()=>[e(T,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[80]||(a[80]=[r("日志输出目标")])),_:1})]),_:1}),e(B,{cols:1,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"输出目标",path:"logConfig.outputTargets"},{default:t(()=>[e(se,{value:l.formData.logConfig.outputTargets,"onUpdate:value":a[32]||(a[32]=o=>l.formData.logConfig.outputTargets=o),options:m,placeholder:"选择日志输出目标"},null,8,["value"])]),_:1})]),_:1})]),_:1}),q.value?(ne(),fe("div",Vt,[e(ie,{title:"文件输出配置",size:"small",style:{margin:"16px 0"}},{default:t(()=>[e(B,{cols:2,"x-gap":16,"y-gap":16},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"文件路径"},{default:t(()=>[e(I,{value:l.formData.logConfig.fileConfig.filePath,"onUpdate:value":a[33]||(a[33]=o=>l.formData.logConfig.fileConfig.filePath=o),placeholder:"./logs/gateway.log"},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"文件保留天数"},{default:t(()=>[e(N,{value:l.formData.logConfig.logRetentionDays,"onUpdate:value":a[34]||(a[34]=o=>l.formData.logConfig.logRetentionDays=o),min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})])):nt("",!0),e(L,{"title-placement":"left",style:{margin:"24px 0"}},{default:t(()=>[e(T,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[81]||(a[81]=[r("异步和批量处理")])),_:1})]),_:1}),e(B,{cols:3,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"启用异步日志",path:"logConfig.enableAsyncLogging"},{default:t(()=>[e(x,{value:l.formData.logConfig.enableAsyncLogging,"onUpdate:value":a[35]||(a[35]=o=>l.formData.logConfig.enableAsyncLogging=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[82]||(a[82]=[r("启用")])),unchecked:t(()=>a[83]||(a[83]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"异步队列大小",path:"logConfig.asyncQueueSize"},{default:t(()=>[e(N,{value:l.formData.logConfig.asyncQueueSize,"onUpdate:value":a[36]||(a[36]=o=>l.formData.logConfig.asyncQueueSize=o),min:1,placeholder:"10000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"批处理大小",path:"logConfig.batchSize"},{default:t(()=>[e(N,{value:l.formData.logConfig.batchSize,"onUpdate:value":a[37]||(a[37]=o=>l.formData.logConfig.batchSize=o),min:1,placeholder:"100",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"异步刷新间隔(ms)",path:"logConfig.asyncFlushIntervalMs"},{default:t(()=>[e(N,{value:l.formData.logConfig.asyncFlushIntervalMs,"onUpdate:value":a[38]||(a[38]=o=>l.formData.logConfig.asyncFlushIntervalMs=o),min:100,max:6e4,placeholder:"5000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"启用批量处理",path:"logConfig.enableBatchProcessing"},{default:t(()=>[e(x,{value:l.formData.logConfig.enableBatchProcessing,"onUpdate:value":a[39]||(a[39]=o=>l.formData.logConfig.enableBatchProcessing=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[84]||(a[84]=[r("启用")])),unchecked:t(()=>a[85]||(a[85]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"批处理超时(ms)",path:"logConfig.batchTimeoutMs"},{default:t(()=>[e(N,{value:l.formData.logConfig.batchTimeoutMs,"onUpdate:value":a[40]||(a[40]=o=>l.formData.logConfig.batchTimeoutMs=o),min:1e3,max:3e5,placeholder:"30000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(L,{"title-placement":"left",style:{margin:"24px 0"}},{default:t(()=>[e(T,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[86]||(a[86]=[r("敏感数据处理")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":20},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{label:"启用敏感数据脱敏",path:"logConfig.enableSensitiveDataMasking"},{default:t(()=>[e(x,{value:l.formData.logConfig.enableSensitiveDataMasking,"onUpdate:value":a[41]||(a[41]=o=>l.formData.logConfig.enableSensitiveDataMasking=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[87]||(a[87]=[r("启用")])),unchecked:t(()=>a[88]||(a[88]=[r("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{label:"脱敏模式",path:"logConfig.maskingPattern"},{default:t(()=>[e(se,{value:l.formData.logConfig.maskingPattern,"onUpdate:value":a[42]||(a[42]=o=>l.formData.logConfig.maskingPattern=o),options:g,placeholder:"选择脱敏模式"},null,8,["value"])]),_:1})]),_:1}),e(d,{span:2},{default:t(()=>[e(c,{label:"敏感字段",path:"logConfig.sensitiveFields"},{default:t(()=>[e(Ge,{value:l.formData.logConfig.sensitiveFields,"onUpdate:value":a[43]||(a[43]=o=>l.formData.logConfig.sensitiveFields=o),placeholder:"添加敏感字段"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Qt=ke(jt,[["__scopeId","data-v-2c2ed8fe"]]),oe=ot("/gateway/hub0020");async function Wt(u){return oe.post("/queryGatewayInstances",u)}async function Xt(u){return oe.post("/addGatewayInstance",u)}async function Zt(u){return oe.post("/editGatewayInstance",u)}async function ea(u,y){return oe.post("/deleteGatewayInstance",{gatewayInstanceId:u,tenantId:y})}async function ta(u,y,v){return oe.post("/updateHealthStatus",{gatewayInstanceId:u,tenantId:y,healthStatus:v})}async function aa(u,y){return oe.post("/reloadGatewayInstance",{gatewayInstanceId:u,tenantId:y})}const ue=ut("GatewayInstance");function la(){const u=Ie(),y=A([]),v=A(!1),D=A({totalInstances:0,onlineInstances:0,offlineInstances:0,totalConfigs:0,activeConfigs:0}),_=st({instanceName:"",instanceDesc:"",bindAddress:"0.0.0.0",httpPort:8080,httpsPort:8443,tlsEnabled:"N",certStorageType:"DATABASE",certFilePath:"",keyFilePath:"",certContent:"",keyContent:"",certChainContent:"",certPassword:"",maxConnections:1e4,readTimeoutMs:3e4,writeTimeoutMs:3e4,idleTimeoutMs:6e4,maxHeaderBytes:1048576,maxWorkers:1e3,keepAliveEnabled:"Y",tcpKeepAliveEnabled:"Y",gracefulShutdownTimeoutMs:3e4,enableHttp2:"Y",tlsVersion:["1.2"],tlsCipherSuites:"",disableGeneralOptionsHandler:"N",logConfigId:"",healthStatus:"Y",noteText:"",activeFlag:"Y",logConfig:{configName:"网关日志",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"Y",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e3,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"N",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}),C=A(!1),k=A(!1),z=A(""),i=A(!1),w=async(s="TENANT_001")=>{try{v.value=!0;const n=await Wt({tenantId:s}),m=rt(n,[]);y.value=Array.isArray(m)?m:[],M()}catch(n){ue.error("获取网关实例列表失败",n),u.error("获取网关实例列表失败")}finally{v.value=!1}},M=()=>{const s=y.value||[],n=s.length,m=s.filter(h=>h.healthStatus==="Y").length,g=n-m;D.value={totalInstances:n,onlineInstances:m,offlineInstances:g,totalConfigs:0,activeConfigs:0}},Y=j(()=>y.value.filter(s=>s.healthStatus==="Y")),E=j(()=>y.value.filter(s=>s.healthStatus==="N")),P=()=>{F(),k.value=!1,C.value=!0},V=s=>{Object.assign(_,{instanceName:s.instanceName||"",instanceDesc:s.instanceDesc||"",bindAddress:s.bindAddress||"0.0.0.0",httpPort:s.httpPort??8080,httpsPort:s.httpsPort??8443,tlsEnabled:s.tlsEnabled||"N",certStorageType:s.certStorageType||"DATABASE",certFilePath:s.certFilePath||"",keyFilePath:s.keyFilePath||"",certContent:s.certContent||"",keyContent:s.keyContent||"",certChainContent:s.certChainContent||"",certPassword:s.certPassword||"",maxConnections:s.maxConnections??1e4,readTimeoutMs:s.readTimeoutMs??3e4,writeTimeoutMs:s.writeTimeoutMs??3e4,idleTimeoutMs:s.idleTimeoutMs??6e4,maxHeaderBytes:s.maxHeaderBytes??1048576,maxWorkers:s.maxWorkers??1e3,keepAliveEnabled:s.keepAliveEnabled||"Y",tcpKeepAliveEnabled:s.tcpKeepAliveEnabled||"Y",gracefulShutdownTimeoutMs:s.gracefulShutdownTimeoutMs??3e4,enableHttp2:s.enableHttp2||"Y",tlsVersion:s.tlsVersion?s.tlsVersion.split(",").filter(n=>n.trim()):["1.2"],tlsCipherSuites:s.tlsCipherSuites||"",disableGeneralOptionsHandler:s.disableGeneralOptionsHandler||"N",logConfigId:s.logConfigId||"",healthStatus:s.healthStatus||"Y",noteText:s.noteText||"",activeFlag:s.activeFlag||"Y",logConfig:s.logConfig?(()=>{try{const n=typeof s.logConfig=="string"?JSON.parse(s.logConfig):s.logConfig;return{configName:n.configName||"网关日志",configDesc:n.configDesc||"",logFormat:n.logFormat||"JSON",recordRequestBody:n.recordRequestBody||"N",recordResponseBody:n.recordResponseBody||"N",recordHeaders:n.recordHeaders||"Y",maxBodySizeBytes:n.maxBodySizeBytes??1048576,outputTargets:n.outputTargets||"DATABASE",fileConfig:n.fileConfig?(()=>{try{return typeof n.fileConfig=="string"?JSON.parse(n.fileConfig):n.fileConfig}catch(m){return console.warn("Failed to parse fileConfig JSON:",m),{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30}}})():{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:n.databaseConfig?(()=>{try{return typeof n.databaseConfig=="string"?JSON.parse(n.databaseConfig):n.databaseConfig}catch(m){return console.warn("Failed to parse databaseConfig JSON:",m),{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100}}})():{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:n.mongoConfig?(()=>{try{return typeof n.mongoConfig=="string"?JSON.parse(n.mongoConfig):n.mongoConfig}catch(m){return console.warn("Failed to parse mongoConfig JSON:",m),{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100}}})():{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:n.elasticsearchConfig?(()=>{try{return typeof n.elasticsearchConfig=="string"?JSON.parse(n.elasticsearchConfig):n.elasticsearchConfig}catch(m){return console.warn("Failed to parse elasticsearchConfig JSON:",m),{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100}}})():{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:n.clickhouseConfig?(()=>{try{return typeof n.clickhouseConfig=="string"?JSON.parse(n.clickhouseConfig):n.clickhouseConfig}catch(m){return console.warn("Failed to parse clickhouseConfig JSON:",m),{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100}}})():{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:n.enableAsyncLogging||"Y",asyncQueueSize:n.asyncQueueSize??1e3,asyncFlushIntervalMs:n.asyncFlushIntervalMs??5e3,enableBatchProcessing:n.enableBatchProcessing||"Y",batchSize:n.batchSize??100,batchTimeoutMs:n.batchTimeoutMs??1e3,logRetentionDays:n.logRetentionDays??30,enableFileRotation:n.enableFileRotation||"Y",maxFileSizeMB:n.maxFileSizeMB??100,maxFileCount:n.maxFileCount??10,rotationPattern:n.rotationPattern||"DAILY",enableSensitiveDataMasking:n.enableSensitiveDataMasking||"N",sensitiveFields:n.sensitiveFields?typeof n.sensitiveFields=="string"?n.sensitiveFields.split(","):n.sensitiveFields:["password","token","key","secret"],maskingPattern:n.maskingPattern||"****",bufferSize:n.bufferSize??65536,flushThreshold:n.flushThreshold??1e3,configPriority:n.configPriority??0,activeFlag:n.activeFlag||"Y",noteText:n.noteText||""}}catch(n){return console.warn("Failed to parse logConfig JSON:",n),{configName:"网关日志",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"Y",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e3,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"N",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}})():{configName:"",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"N",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e4,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"Y",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}),z.value=s.gatewayInstanceId,k.value=!0,C.value=!0},O=async()=>{try{i.value=!0;const s="TENANT_001",n={..._,tlsVersion:Array.isArray(_.tlsVersion)?_.tlsVersion.join(","):_.tlsVersion};if(n.logConfig){const g={...n.logConfig};Array.isArray(g.sensitiveFields)&&(g.sensitiveFields=g.sensitiveFields.join(",")),g.fileConfig=JSON.stringify(g.fileConfig),g.databaseConfig=JSON.stringify(g.databaseConfig),g.mongoConfig=JSON.stringify(g.mongoConfig),g.elasticsearchConfig=JSON.stringify(g.elasticsearchConfig),g.clickhouseConfig=JSON.stringify(g.clickhouseConfig),n.logConfig=JSON.stringify(g)}let m;if(k.value?m=await Zt({...n,tenantId:s,gatewayInstanceId:z.value}):m=await Xt({...n,tenantId:s}),ce(m)){const g=J(m,k.value?"网关实例更新成功":"网关实例创建成功");u.success(g),C.value=!1,await w(s),M()}else{const g=J(m,k.value?"更新失败":"创建失败");u.error(g)}}catch(s){ue.error(k.value?"更新网关实例失败":"创建网关实例失败",s),u.error(k.value?"更新失败":"创建失败")}finally{i.value=!1}},H=async s=>{try{const n=await ea(s.gatewayInstanceId,s.tenantId);if(ce(n)){const m=J(n,"网关实例删除成功");u.success(m),await w(s.tenantId)}else{const m=J(n,"删除失败");u.error(m)}}catch(n){ue.error("删除网关实例失败",n),u.error("删除失败")}},R=async(s,n)=>{try{const m=n==="start"?"Y":"N",g=await ta(s.gatewayInstanceId,s.tenantId,m);if(ce(g)){const h=J(g,`实例${n==="start"?"启动":"停止"}成功`);u.success(h),await w(s.tenantId)}else{const h=J(g,`${n==="start"?"启动":"停止"}失败`);u.error(h)}}catch(m){ue.error(`${n==="start"?"启动":"停止"}实例失败`,m),u.error(`${n==="start"?"启动":"停止"}失败`)}},b=async s=>{try{const n=await aa(s.gatewayInstanceId,s.tenantId);if(ce(n)){const m=J(n,"网关重载成功");u.success(m),await w(s.tenantId)}else{const m=J(n,"网关重载失败");u.error(m)}}catch(n){ue.error("网关重载失败",n),u.error("网关重载失败")}},F=()=>{Object.assign(_,{instanceName:"",instanceDesc:"",bindAddress:"0.0.0.0",httpPort:8080,httpsPort:8443,tlsEnabled:"N",certStorageType:"DATABASE",certFilePath:"",keyFilePath:"",certContent:"",keyContent:"",certChainContent:"",certPassword:"",maxConnections:1e4,readTimeoutMs:3e4,writeTimeoutMs:3e4,idleTimeoutMs:6e4,maxHeaderBytes:1048576,maxWorkers:1e3,keepAliveEnabled:"Y",tcpKeepAliveEnabled:"Y",gracefulShutdownTimeoutMs:3e4,enableHttp2:"Y",tlsVersion:["1.2"],tlsCipherSuites:"",disableGeneralOptionsHandler:"N",logConfigId:"",healthStatus:"Y",noteText:"",activeFlag:"Y",logConfig:{configName:"网关日志",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"Y",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e3,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"N",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}),z.value=""};return it(()=>{w()}),{instances:y,loading:v,statistics:D,onlineInstances:Y,offlineInstances:E,instanceForm:_,showInstanceModal:C,isEditing:k,submitting:i,fetchInstances:w,showCreateModal:P,showEditModal:V,submitForm:O,deleteInstance:H,toggleInstanceStatus:R,reloadInstance:b,resetForm:F}}const na={class:"gateway-instance-manager"},oa={class:"page-header"},sa={class:"title"},ia={class:"actions"},ra={class:"stat-content"},ua={class:"stat-number"},da={class:"stat-icon"},fa={class:"stat-content"},ga={class:"stat-number"},ca={class:"stat-icon"},ma={class:"stat-content"},pa={class:"stat-number"},va={class:"stat-icon"},ha={style:{padding:"16px"}},ya={style:{padding:"16px"}},ba={style:{padding:"16px"}},Ca={style:{padding:"16px"}},_a=de({__name:"GatewayInstanceManager",setup(u){const{instances:y,loading:v,statistics:D,instanceForm:_,showInstanceModal:C,isEditing:k,submitting:z,fetchInstances:i,showCreateModal:w,showEditModal:M,submitForm:Y,deleteInstance:E,toggleInstanceStatus:P,reloadInstance:V}=la(),O=dt(),H=A(!1),R=A(""),b=g=>{O.warning({title:"确认删除",content:`确定要删除实例"${g.instanceName}"吗？此操作不可恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{E(g)}})},F=g=>{O.info({title:"确认启动",content:`确定要启动实例"${g.instanceName}"吗？`,positiveText:"确定启动",negativeText:"取消",onPositiveClick:()=>{P(g,"start")}})},s=g=>{O.warning({title:"确认停止",content:`确定要停止实例"${g.instanceName}"吗？停止后将无法处理请求。`,positiveText:"确定停止",negativeText:"取消",onPositiveClick:()=>{P(g,"stop")}})},n=g=>{R.value=g.gatewayInstanceId,H.value=!0},m=g=>{O.info({title:"确认网关重载",content:`确定要对实例"${g.instanceName}"执行网关重载操作吗？`,positiveText:"确定重载",negativeText:"取消",onPositiveClick:()=>{V(g)}})};return(g,h)=>{const U=G,ge=K,q=Be,W=Le,pe=Ue,ve=xe,X=$e,Z=me,ee=Pe,he=Me,ye=Ee;return ne(),fe("div",na,[e(q,null,{header:t(()=>[f("div",oa,[f("div",sa,[e(U,{size:"24",class:"icon"},{default:t(()=>[e(p(Se))]),_:1}),h[3]||(h[3]=f("h2",{class:"header-title"},"网关实例配置中心",-1))]),f("div",ia,[e(ge,{type:"primary",onClick:p(w)},{icon:t(()=>[e(U,null,{default:t(()=>[e(p(Ft))]),_:1})]),default:t(()=>[h[4]||(h[4]=r(" 新建实例 "))]),_:1},8,["onClick"])])])]),default:t(()=>[e(pe,{cols:3,"x-gap":16,"y-gap":16,class:"stats-grid"},{default:t(()=>[e(W,null,{default:t(()=>[e(q,{class:"stat-card"},{default:t(()=>[f("div",ra,[f("div",ua,Q(p(D).totalInstances),1),h[5]||(h[5]=f("div",{class:"stat-label"},"总实例数",-1))]),f("div",da,[e(U,{size:"32",color:"#18a058"},{default:t(()=>[e(p(Se))]),_:1})])]),_:1})]),_:1}),e(W,null,{default:t(()=>[e(q,{class:"stat-card"},{default:t(()=>[f("div",fa,[f("div",ga,Q(p(D).onlineInstances),1),h[6]||(h[6]=f("div",{class:"stat-label"},"在线实例",-1))]),f("div",ca,[e(U,{size:"32",color:"#2080f0"},{default:t(()=>[e(p(Re))]),_:1})])]),_:1})]),_:1}),e(W,null,{default:t(()=>[e(q,{class:"stat-card"},{default:t(()=>[f("div",ma,[f("div",pa,Q(p(D).offlineInstances),1),h[7]||(h[7]=f("div",{class:"stat-label"},"离线实例",-1))]),f("div",va,[e(U,{size:"32",color:"#d03050"},{default:t(()=>[e(p(Oe))]),_:1})])]),_:1})]),_:1})]),_:1}),e(ve),e(Yt,{instances:p(y),loading:p(v),onCreate:p(w),onEdit:p(M),onDelete:b,onStart:F,onStop:s,onConfig:n,onReload:m,onRefresh:p(i)},null,8,["instances","loading","onCreate","onEdit","onRefresh"]),e(Qt,{show:p(C),"onUpdate:show":h[0]||(h[0]=l=>Ye(C)?C.value=l:null),"is-editing":p(k),"form-data":p(_),submitting:p(z),onSubmit:p(Y)},null,8,["show","is-editing","form-data","submitting","onSubmit"]),e(ye,{show:H.value,"onUpdate:show":h[2]||(h[2]=l=>H.value=l),"mask-closable":!1},{default:t(()=>[e(q,{style:{width:"1400px"},title:"实例配置管理",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":t(()=>[e(ge,{quaternary:"",circle:"",onClick:h[1]||(h[1]=l=>H.value=!1)},{icon:t(()=>[e(U,null,{default:t(()=>[e(p(He))]),_:1})]),_:1})]),default:t(()=>[e(he,{type:"line",animated:""},{default:t(()=>[e(ee,{name:"security",tab:"安全配置"},{default:t(()=>[f("div",ha,[e(Z,{vertical:"",size:"large"},{default:t(()=>[e(X,{type:"info"},{default:t(()=>h[8]||(h[8]=[r(" 配置实例级的安全策略，包括IP访问控制、User-Agent过滤、API访问控制等。 ")])),_:1}),e(p(kt),{"gateway-instance-id":R.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1}),e(ee,{name:"cors",tab:"跨域配置"},{default:t(()=>[f("div",ya,[e(Z,{vertical:"",size:"large"},{default:t(()=>[e(X,{type:"info"},{default:t(()=>h[9]||(h[9]=[r(" 配置跨域资源共享(CORS)策略，允许的源、方法、头信息等。 ")])),_:1}),e(wt,{"gateway-instance-id":R.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1}),e(ee,{name:"auth",tab:"认证配置"},{default:t(()=>[f("div",ba,[e(Z,{vertical:"",size:"large"},{default:t(()=>[e(X,{type:"info"},{default:t(()=>h[10]||(h[10]=[r(" 配置认证策略，支持JWT、API Key、OAuth2.0、Basic Auth等认证方式。 ")])),_:1}),e(Dt,{"gateway-instance-id":R.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1}),e(ee,{name:"rateLimit",tab:"限流配置"},{default:t(()=>[f("div",Ca,[e(Z,{vertical:"",size:"large"},{default:t(()=>[e(X,{type:"info"},{default:t(()=>h[11]||(h[11]=[r(" 配置流量控制策略，包括全局限流、IP限流、用户限流等。 ")])),_:1}),e(Tt,{"gateway-instance-id":R.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}}),Ga=ke(_a,[["__scopeId","data-v-0a528be8"]]);export{Ga as default};

import{q as Se,t as ke,r as xe,s as Pe,a as Ce,d as we,b as Ne,u as Ie,c as ze,g as $e,e as Ae}from"./index-Bkn5030q.js";import{aq as A,at as U,ar as j,d as W,a8 as v,aA as Me,bG as Ue,g as V,c as Z,m as t,n as e,w as s,o as G,V as O,a as u,v as _,cO as ce,x as F,P as He,_ as ee,W as ae,aM as te,S as Ee,a3 as K,I as C,bR as re,b as se,cT as pe,r as w,f as Fe,a0 as E,a1 as X,dj as Re,a2 as N,R as ve,h as me,E as H,cU as le,J as $,cr as Le,q as oe,M as Oe,A as Q,C as S,t as ne,aO as Ye,B as qe,co as Be}from"./index-Bm8WTrgo.js";import{P as he}from"./PlayOutline-DQAafj5I.js";import{S as ge}from"./StopCircleOutline-C19N79Wg.js";import{A as Ke}from"./AlertCircleOutline-MDG2uuCN.js";import{N as ie}from"./Progress-0ypb-jzo.js";import{L as De}from"./LinkOutline-B3obbmwD.js";import{a as D,_ as ue}from"./Grid-BszSwIPR.js";import{R as Ge}from"./ReloadOutline-DTl_1ay-.js";import{G as Ve}from"./GlobeOutline-BnvFpr4C.js";import{P as Je}from"./PencilOutline-YR5OkOEB.js";import{T as fe}from"./TrashOutline-lFSebtJX.js";import{N as We}from"./Popconfirm-Doj4hVEv.js";import{u as je}from"./usePagination-CRp--1tI.js";import{R as be}from"./RefreshOutline-BMOJJPWL.js";import{A as Qe}from"./AddOutline-Crq49hC7.js";import{_ as ye}from"./RadioGroup-DeGnoaYt.js";import{N as R}from"./InputNumber-Da0ADIUs.js";import{_ as Xe}from"./DataTable-C88L71Mp.js";import{N as de}from"./Switch-Bksdye9l.js";import"./index-C9U1NGvg.js";const Ze=A("input-group",`
 display: inline-flex;
 width: 100%;
 flex-wrap: nowrap;
 vertical-align: bottom;
`,[U(">",[A("input",[U("&:not(:last-child)",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),U("&:not(:first-child)",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 margin-left: -1px!important;
 `)]),A("button",[U("&:not(:last-child)",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `,[j("state-border, border",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `)]),U("&:not(:first-child)",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `,[j("state-border, border",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `)])]),U("*",[U("&:not(:last-child)",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `,[U(">",[A("input",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),A("base-selection",[A("base-selection-label",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),A("base-selection-tags",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `),j("box-shadow, border, state-border",`
 border-top-right-radius: 0!important;
 border-bottom-right-radius: 0!important;
 `)])])]),U("&:not(:first-child)",`
 margin-left: -1px!important;
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `,[U(">",[A("input",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `),A("base-selection",[A("base-selection-label",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `),A("base-selection-tags",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `),j("box-shadow, border, state-border",`
 border-top-left-radius: 0!important;
 border-bottom-left-radius: 0!important;
 `)])])])])])]),et={},tt=W({name:"InputGroup",props:et,setup(k){const{mergedClsPrefixRef:o}=Me(k);return Ue("-input-group",Ze,o),{mergedClsPrefix:o}},render(){const{mergedClsPrefix:k}=this;return v("div",{class:`${k}-input-group`},this.$slots)}}),rt={class:"tunnel-server-stats"},st={class:"stat-content"},at={class:"stat-icon total"},lt={class:"stat-info"},ot={class:"stat-value"},nt={class:"stat-content"},it={class:"stat-icon running"},ut={class:"stat-info"},dt={class:"stat-value"},ct={class:"stat-content"},pt={class:"stat-icon stopped"},vt={class:"stat-info"},mt={class:"stat-value"},ht={class:"stat-content"},gt={class:"stat-icon error"},ft={class:"stat-info"},bt={class:"stat-value"},yt={class:"card-header"},_t={class:"detail-content"},Tt={class:"detail-item"},St={class:"detail-value primary"},kt={class:"detail-progress"},xt={class:"progress-text"},Pt={class:"card-header"},Ct={class:"detail-content"},wt={class:"detail-item"},Nt={class:"detail-value success"},It={class:"detail-progress"},zt={class:"progress-text"},$t=W({__name:"TunnelServerStats",props:{statistics:{}},setup(k){const o=k,d=V(()=>{const c=o.statistics.totalClients||0;return Math.min(Math.round(c/1e3*100),100)}),b=V(()=>{const c=o.statistics.totalConnections||0;return Math.min(Math.round(c/5e3*100),100)}),y=p=>p<50?"#52c41a":p<80?"#faad14":"#ff4d4f";return(p,c)=>(G(),Z("div",rt,[t(e(ue),{cols:4,"x-gap":12,"y-gap":12,responsive:"screen"},{default:s(()=>[t(e(D),null,{default:s(()=>[t(e(O),{class:"stat-card",hoverable:""},{default:s(()=>[u("div",st,[u("div",at,[t(e(_),{size:"24",component:e(ce)},null,8,["component"])]),u("div",lt,[u("div",ot,F(p.statistics.totalServers||1),1),c[0]||(c[0]=u("div",{class:"stat-label"},"总服务器数",-1))])])]),_:1})]),_:1}),t(e(D),null,{default:s(()=>[t(e(O),{class:"stat-card",hoverable:""},{default:s(()=>[u("div",nt,[u("div",it,[t(e(_),{size:"24",component:e(he)},null,8,["component"])]),u("div",ut,[u("div",dt,F(p.statistics.runningServers||0),1),c[1]||(c[1]=u("div",{class:"stat-label"},"运行中",-1))])])]),_:1})]),_:1}),t(e(D),null,{default:s(()=>[t(e(O),{class:"stat-card",hoverable:""},{default:s(()=>[u("div",ct,[u("div",pt,[t(e(_),{size:"24",component:e(ge)},null,8,["component"])]),u("div",vt,[u("div",mt,F(p.statistics.stoppedServers||0),1),c[2]||(c[2]=u("div",{class:"stat-label"},"已停止",-1))])])]),_:1})]),_:1}),t(e(D),null,{default:s(()=>[t(e(O),{class:"stat-card",hoverable:""},{default:s(()=>[u("div",ht,[u("div",gt,[t(e(_),{size:"24",component:e(Ke)},null,8,["component"])]),u("div",ft,[u("div",bt,F(p.statistics.errorServers||0),1),c[3]||(c[3]=u("div",{class:"stat-label"},"错误状态",-1))])])]),_:1})]),_:1})]),_:1}),t(e(ue),{cols:2,"x-gap":12,"y-gap":12,style:{"margin-top":"12px"},responsive:"screen"},{default:s(()=>[t(e(D),null,{default:s(()=>[t(e(O),{class:"detail-card",hoverable:""},{header:s(()=>[u("div",yt,[t(e(_),{size:"20",component:e(He)},null,8,["component"]),c[4]||(c[4]=u("span",null,"客户端统计",-1))])]),default:s(()=>[u("div",_t,[u("div",Tt,[c[5]||(c[5]=u("div",{class:"detail-label"},"总客户端数",-1)),u("div",St,F(p.statistics.totalClients||0),1)]),u("div",kt,[t(e(ie),{type:"line",percentage:d.value,"show-indicator":!1,height:8,color:y(d.value)},null,8,["percentage","color"]),u("div",xt,F(d.value)+"% 使用率 ",1)])])]),_:1})]),_:1}),t(e(D),null,{default:s(()=>[t(e(O),{class:"detail-card",hoverable:""},{header:s(()=>[u("div",Pt,[t(e(_),{size:"20",component:e(De)},null,8,["component"]),c[6]||(c[6]=u("span",null,"连接统计",-1))])]),default:s(()=>[u("div",Ct,[u("div",wt,[c[7]||(c[7]=u("div",{class:"detail-label"},"总连接数",-1)),u("div",Nt,F(p.statistics.totalConnections||0),1)]),u("div",It,[t(e(ie),{type:"line",percentage:b.value,"show-indicator":!1,height:8,color:y(b.value)},null,8,["percentage","color"]),u("div",zt,F(b.value)+"% 负载 ",1)])])]),_:1})]),_:1})]),_:1})]))}}),At=ee($t,[["__scopeId","data-v-8eb158f0"]]),Mt=k=>[{type:"selection",width:50,fixed:"left"},{title:"服务器名称",key:"serverName",width:180,fixed:"left",ellipsis:{tooltip:!0},render:o=>v("span",{class:o.serverStatus==="running"?"text-success font-bold":"text-default"},o.serverName)},{title:"控制地址",key:"controlAddress",width:140,render:o=>`${o.controlAddress}:${o.controlPort}`},{title:"管理端口",key:"dashboardPort",width:90,render:o=>o.dashboardPort||"-"},{title:"状态",key:"serverStatus",width:90,render:o=>{const b={running:{type:"success",text:"运行中"},stopped:{type:"warning",text:"已停止"},error:{type:"error",text:"错误"}}[o.serverStatus]||{type:"default",text:"未知"};return v(te,{type:b.type,size:"small"},{default:()=>b.text})}},{title:"HTTP端口",key:"vhostHttpPort",width:90,render:o=>o.vhostHttpPort||"-"},{title:"HTTPS端口",key:"vhostHttpsPort",width:100,render:o=>o.vhostHttpsPort||"-"},{title:"最大客户端",key:"maxClients",width:100,render:o=>v("span",{class:"text-primary font-bold"},`${o.maxClients}`)},{title:"Token认证",key:"tokenAuth",width:90,render:o=>v(te,{type:o.tokenAuth==="Y"?"success":"default",size:"small"},{default:()=>o.tokenAuth==="Y"?"启用":"禁用",icon:()=>v(_,{component:Ee,size:12})})},{title:"TLS",key:"tlsEnable",width:70,render:o=>v(te,{type:o.tlsEnable==="Y"?"success":"default",size:"small"},{default:()=>o.tlsEnable==="Y"?"启用":"禁用"})},{title:"心跳间隔(秒)",key:"heartbeatInterval",width:110,render:o=>`${o.heartbeatInterval}s`},{title:"心跳超时(秒)",key:"heartbeatTimeout",width:110,render:o=>`${o.heartbeatTimeout}s`},{title:"启动时间",key:"startTime",width:140,render:o=>o.startTime?ae(o.startTime,"YYYY-MM-DD HH:mm"):v("span",{class:"text-placeholder"},"-")},{title:"创建时间",key:"addTime",width:140,render:o=>ae(o.addTime,"YYYY-MM-DD HH:mm")},{title:"操作",key:"actions",width:260,fixed:"right",render:o=>v(re,{size:"small"},()=>[o.serverStatus==="running"?v(K,{trigger:"hover"},{trigger:()=>v(C,{size:"small",type:"warning",secondary:!0,onClick:()=>k("stop",o)},{icon:()=>v(_,{component:ge})}),default:()=>"停止服务器"}):v(K,{trigger:"hover"},{trigger:()=>v(C,{size:"small",type:"success",secondary:!0,onClick:()=>k("start",o)},{icon:()=>v(_,{component:he})}),default:()=>"启动服务器"}),v(K,{trigger:"hover"},{trigger:()=>v(C,{size:"small",type:"info",secondary:!0,onClick:()=>k("restart",o)},{icon:()=>v(_,{component:Ge})}),default:()=>"重启服务器"}),v(K,{trigger:"hover"},{trigger:()=>v(C,{size:"small",type:"primary",secondary:!0,onClick:()=>k("test",o)},{icon:()=>v(_,{component:Ve})}),default:()=>"测试连接"}),v(K,{trigger:"hover"},{trigger:()=>v(C,{size:"small",type:"primary",secondary:!0,onClick:()=>k("edit",o)},{icon:()=>v(_,{component:Je})}),default:()=>"编辑"}),v(We,{onPositiveClick:()=>k("delete",o)},{trigger:()=>v(K,{trigger:"hover"},{trigger:()=>v(C,{size:"small",type:"error",secondary:!0},{icon:()=>v(_,{component:fe})}),default:()=>"删除"}),default:()=>"确认删除这个隧道服务器吗？"})])}],Ut=(k,o)=>{const d=se();pe();const b=w(!1),y=w([]),p=w(0),c=w([]),T=Fe({tenantId:"default-tenant-001",serverName:"",serverStatus:void 0,controlAddress:"",controlPort:void 0,activeFlag:"Y",pageIndex:1,pageSize:20}),I=[{label:"运行中",value:"running"},{label:"已停止",value:"stopped"},{label:"错误",value:"error"}],x=V(()=>c.value.length>0),{naiveConfig:z,setTotal:a}=je({initialPage:1,initialPageSize:20,pageSizes:[10,20,50,100],showSizePicker:!0,showQuickJumper:!0,onPageChange:(m,i)=>{T.pageIndex=m,T.pageSize=i,g()},onPageSizeChange:(m,i)=>{T.pageIndex=m,T.pageSize=i,g()}}),g=async()=>{try{b.value=!0;const m=await Se(T);if(E(m))try{const i=X(m,[]);if(Array.isArray(i)){y.value=i;const h=Re(m);p.value=h.itemCount,a(p.value)}else console.error("服务器返回的数据不是数组格式:",i),d.error("数据格式错误，请联系管理员"),y.value=[]}catch(i){console.error("解析服务器数据失败:",i),d.error("解析数据失败，请联系管理员"),y.value=[]}else{const i=N(m,"获取隧道服务器列表失败");d.error(i)}}catch(m){console.error("获取隧道服务器列表失败:",m),d.error("获取隧道服务器列表失败"),y.value=[]}finally{b.value=!1}},f=async m=>{try{const i=await we(m);if(E(i)){const h=N(i,"隧道服务器删除成功");return d.success(h),await g(),!0}else{const h=N(i,"删除隧道服务器失败");return d.error(h),!1}}catch(i){return console.error("删除隧道服务器失败:",i),d.error("删除隧道服务器失败"),!1}},P=async()=>{if(c.value.length===0)return d.warning("请选择要删除的隧道服务器"),!1;try{return(await Ne(c.value)).every(h=>E(h))?(d.success(`成功删除 ${c.value.length} 个隧道服务器`),c.value=[],await g(),!0):(d.error("部分删除操作失败"),!1)}catch(m){return console.error("批量删除失败:",m),d.error("批量删除失败"),!1}},M=async m=>{try{const i=await Ce(m);if(E(i)){const h=N(i,"启动隧道服务器成功");return d.success(h),await g(),!0}else{const h=N(i,"启动隧道服务器失败");return d.error(h),!1}}catch(i){return console.error("启动隧道服务器失败:",i),d.error("启动隧道服务器失败"),!1}},L=async m=>{try{const i=await Pe(m);if(E(i)){const h=N(i,"停止隧道服务器成功");return d.success(h),await g(),!0}else{const h=N(i,"停止隧道服务器失败");return d.error(h),!1}}catch(i){return console.error("停止隧道服务器失败:",i),d.error("停止隧道服务器失败"),!1}},Y=async m=>{try{const i=await xe(m);if(E(i)){const h=N(i,"重启隧道服务器成功");return d.success(h),await g(),!0}else{const h=N(i,"重启隧道服务器失败");return d.error(h),!1}}catch(i){return console.error("重启隧道服务器失败:",i),d.error("重启隧道服务器失败"),!1}},q=async m=>{try{const i=await ke(m);if(E(i)){const h=X(i,{}),_e=h.latency?` (延迟: ${h.latency}ms)`:"",Te=N(i,"连接测试成功");return d.success(Te+_e),!0}else{const h=N(i,"连接测试失败");return d.error(h),!1}}catch(i){return console.error("连接测试失败:",i),d.error("连接测试失败"),!1}},J=(m,i)=>{switch(m){case"start":M(i.tunnelServerId);break;case"stop":L(i.tunnelServerId);break;case"restart":Y(i.tunnelServerId);break;case"test":q(i.tunnelServerId);break;case"edit":k(i);break;case"delete":f(i.tunnelServerId);break}},B=V(()=>Mt(J));return{loading:b,tunnelServers:y,total:p,selectedServerIds:c,queryParams:T,statusOptions:I,hasSelection:x,columns:B,tableConfig:{bordered:!1,striped:!0,size:"medium",scrollX:1200,rowKey:m=>m.tunnelServerId},naiveConfig:z,handleSearch:()=>{T.pageIndex=1,g()},handleReset:()=>{T.serverName="",T.serverStatus=void 0,T.controlAddress="",T.controlPort=void 0,T.pageIndex=1,T.pageSize=20,g()},handleCreate:()=>{o()},handleBatchDelete:P,initialize:()=>{g()},updateTotal:()=>{a(p.value)},getTunnelServers:g,deleteTunnelServer:f,startTunnelServer:M,stopTunnelServer:L,restartTunnelServer:Y,testConnection:q,setTotal:a}},Ht={class:"tunnel-server-table"},Et={class:"table-header"},Ft={class:"search-section"},Rt={class:"action-section"},Lt=W({__name:"TunnelServerTable",emits:["edit","create"],setup(k,{expose:o,emit:d}){const b=d,y=pe(),{loading:p,tunnelServers:c,total:T,selectedServerIds:I,queryParams:x,statusOptions:z,hasSelection:a,columns:g,naiveConfig:f,handleSearch:P,handleReset:M,initialize:L,updateTotal:Y,handleBatchDelete:q}=Ut(n=>b("edit",n),()=>b("create"));ve(T,()=>{Y()});const J=()=>{b("create")},B=()=>{y.warning({title:"确认批量删除",content:`确认删除选中的 ${I.value.length} 个隧道服务器吗？`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:async()=>{await q()}})};return me(()=>{L()}),o({initialize:L,handleSearch:P,handleReset:M}),(n,r)=>(G(),Z("div",Ht,[u("div",Et,[u("div",Ft,[t(e(re),{size:16},{default:s(()=>[t(e(H),{value:e(x).serverName,"onUpdate:value":r[0]||(r[0]=l=>e(x).serverName=l),placeholder:"搜索服务器名称",clearable:"",style:{width:"200px"}},{prefix:s(()=>[t(e(_),{component:e(le)},null,8,["component"])]),_:1},8,["value"]),t(e(ye),{value:e(x).serverStatus,"onUpdate:value":r[1]||(r[1]=l=>e(x).serverStatus=l),placeholder:"服务器状态",clearable:"",style:{width:"150px"},options:e(z)},null,8,["value","options"]),t(e(H),{value:e(x).controlAddress,"onUpdate:value":r[2]||(r[2]=l=>e(x).controlAddress=l),placeholder:"控制地址",clearable:"",style:{width:"150px"}},null,8,["value"]),t(e(R),{value:e(x).controlPort,"onUpdate:value":r[3]||(r[3]=l=>e(x).controlPort=l),placeholder:"控制端口",clearable:"",style:{width:"120px"},min:1,max:65535},null,8,["value"])]),_:1})]),u("div",Rt,[t(e(re),{size:12},{default:s(()=>[t(e(C),{onClick:e(P),type:"primary"},{icon:s(()=>[t(e(_),{component:e(le)},null,8,["component"])]),default:s(()=>[r[5]||(r[5]=$(" 搜索 "))]),_:1},8,["onClick"]),t(e(C),{onClick:e(M)},{icon:s(()=>[t(e(_),{component:e(be)},null,8,["component"])]),default:s(()=>[r[6]||(r[6]=$(" 重置 "))]),_:1},8,["onClick"]),t(e(C),{onClick:J,type:"primary"},{icon:s(()=>[t(e(_),{component:e(Qe)},null,8,["component"])]),default:s(()=>[r[7]||(r[7]=$(" 新增服务器 "))]),_:1}),t(e(C),{onClick:B,disabled:!e(a),type:"error",secondary:""},{icon:s(()=>[t(e(_),{component:e(fe)},null,8,["component"])]),default:s(()=>[r[8]||(r[8]=$(" 批量删除 "))]),_:1},8,["disabled"])]),_:1})])]),t(e(Xe),{columns:e(g),data:e(c),loading:e(p),pagination:e(f),"row-key":l=>l.tunnelServerId,"checked-row-keys":e(I),"onUpdate:checkedRowKeys":r[4]||(r[4]=l=>Le(I)?I.value=l:null),"scroll-x":1800,striped:"","max-height":600},null,8,["columns","data","loading","pagination","row-key","checked-row-keys"])]))}}),Ot=ee(Lt,[["__scopeId","data-v-e8dc9503"]]),Yt={class:"dialog-content"},qt={class:"form-section"},Bt={class:"form-section"},Kt={class:"form-section"},Dt={class:"form-section"},Gt={class:"dialog-actions"},Vt=W({__name:"TunnelServerDialog",props:{show:{type:Boolean,default:!1},editData:{default:null}},emits:["update:show","success"],setup(k,{emit:o}){const d=k,b=o,y=se(),p=w(!1),c=[{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warning",value:"warn"},{label:"Error",value:"error"}],T=async()=>{try{const n=await $e();if(E(n)){const r=X(n,{authToken:""});return y.success("认证令牌生成成功"),r.authToken}else{const r=N(n,"生成认证令牌失败");return y.error(r),null}}catch(n){return console.error("生成认证令牌失败:",n),y.error("生成认证令牌失败"),null}},I=w(),x=V({get:()=>d.show,set:n=>b("update:show",n)}),z=V(()=>!!d.editData),a=w({serverName:"",serverDescription:"",controlAddress:"0.0.0.0",controlPort:7e3,dashboardPort:7500,vhostHttpPort:80,vhostHttpsPort:443,maxClients:1e3,tokenAuth:"Y",authToken:"",tlsEnable:"N",tlsCertFile:"",tlsKeyFile:"",heartbeatInterval:30,heartbeatTimeout:90,logLevel:"info",maxPortsPerClient:10,allowPorts:"",noteText:""}),g=w(!0),f=w(!1),P={serverName:[{required:!0,message:"请输入服务器名称",trigger:"blur"},{min:2,max:100,message:"服务器名称长度应在2-100字符之间",trigger:"blur"}],controlAddress:[{required:!0,message:"请输入控制地址",trigger:"blur"}],controlPort:[{required:!0,type:"number",message:"请输入控制端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围应在1-65535之间",trigger:"blur"}],maxClients:[{required:!0,type:"number",message:"请输入最大客户端数",trigger:"blur"},{type:"number",min:1,max:1e4,message:"最大客户端数应在1-10000之间",trigger:"blur"}],heartbeatInterval:[{required:!0,type:"number",message:"请输入心跳间隔",trigger:"blur"},{type:"number",min:10,max:300,message:"心跳间隔应在10-300秒之间",trigger:"blur"}],heartbeatTimeout:[{required:!0,type:"number",message:"请输入心跳超时",trigger:"blur"},{type:"number",min:30,max:600,message:"心跳超时应在30-600秒之间",trigger:"blur"}],authToken:[{required:!0,message:"启用Token认证时必须提供认证Token",trigger:"blur",validator:(n,r)=>g.value&&!r?new Error("启用Token认证时必须提供认证Token"):!0}],tlsCertFile:[{required:!0,message:"启用TLS时必须提供证书文件路径",trigger:"blur",validator:(n,r)=>f.value&&!r?new Error("启用TLS时必须提供证书文件路径"):!0}],tlsKeyFile:[{required:!0,message:"启用TLS时必须提供私钥文件路径",trigger:"blur",validator:(n,r)=>f.value&&!r?new Error("启用TLS时必须提供私钥文件路径"):!0}]},M=()=>{a.value={serverName:"",serverDescription:"",controlAddress:"0.0.0.0",controlPort:7e3,dashboardPort:7500,vhostHttpPort:80,vhostHttpsPort:443,maxClients:1e3,tokenAuth:"Y",authToken:"",tlsEnable:"N",tlsCertFile:"",tlsKeyFile:"",heartbeatInterval:30,heartbeatTimeout:90,logLevel:"info",maxPortsPerClient:10,allowPorts:"",noteText:""},g.value=!0,f.value=!1};ve(()=>d.editData,n=>{try{n?(a.value={serverName:n.serverName||"",serverDescription:n.serverDescription||"",controlAddress:n.controlAddress||"",controlPort:n.controlPort||7e3,dashboardPort:n.dashboardPort||7500,vhostHttpPort:n.vhostHttpPort||80,vhostHttpsPort:n.vhostHttpsPort||443,maxClients:n.maxClients||100,tokenAuth:n.tokenAuth||"N",authToken:n.authToken||"",tlsEnable:n.tlsEnable||"N",tlsCertFile:n.tlsCertFile||"",tlsKeyFile:n.tlsKeyFile||"",heartbeatInterval:n.heartbeatInterval||30,heartbeatTimeout:n.heartbeatTimeout||90,logLevel:n.logLevel||"info",maxPortsPerClient:n.maxPortsPerClient||0,allowPorts:n.allowPorts||"",noteText:n.noteText||""},g.value=n.tokenAuth==="Y",f.value=n.tlsEnable==="Y"):M()}catch(r){console.error("处理编辑数据时出错:",r),y.error("处理编辑数据时出错，请重试"),M()}},{immediate:!0});const L=n=>{a.value.tokenAuth=n?"Y":"N",n||(a.value.authToken="")},Y=n=>{a.value.tlsEnable=n?"Y":"N",n||(a.value.tlsCertFile="",a.value.tlsKeyFile="")},q=async()=>{const n=await T();n&&(a.value.authToken=n)},J=async()=>{var n;try{await((n=I.value)==null?void 0:n.validate()),p.value=!0;let r;if(z.value&&d.editData?r=await Ie({...a.value,tunnelServerId:d.editData.tunnelServerId}):r=await ze(a.value),r&&E(r))y.success(z.value?"更新成功":"创建成功"),b("success"),B();else{const l=N(r,z.value?"更新失败":"创建失败");y.error(l)}}catch(r){console.error("表单提交失败:",r),y.error(z.value?"更新失败":"创建失败")}finally{p.value=!1}},B=()=>{var n;x.value=!1,(n=I.value)==null||n.restoreValidation()};return(n,r)=>(G(),oe(e(Be),{show:x.value,"onUpdate:show":r[19]||(r[19]=l=>x.value=l),"mask-closable":!1,preset:"dialog",title:z.value?"编辑隧道服务器":"创建隧道服务器",style:{width:"800px"}},{icon:s(()=>[t(e(_),{size:"20",color:"#2080f0"},{default:s(()=>[t(e(ce))]),_:1})]),action:s(()=>[u("div",Gt,[t(e(C),{onClick:B},{default:s(()=>r[25]||(r[25]=[$("取消")])),_:1}),t(e(C),{type:"primary",loading:p.value,onClick:J},{default:s(()=>[$(F(z.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:s(()=>[u("div",Yt,[t(e(qe),{ref_key:"formRef",ref:I,model:a.value,rules:P,"label-placement":"left","label-width":"120px","require-mark-placement":"right-hanging"},{default:s(()=>[t(e(Oe),{type:"line",animated:""},{default:s(()=>[t(e(Q),{name:"basic",tab:"基础配置"},{default:s(()=>[u("div",qt,[t(e(S),{label:"服务器名称",path:"serverName"},{default:s(()=>[t(e(H),{value:a.value.serverName,"onUpdate:value":r[0]||(r[0]=l=>a.value.serverName=l),placeholder:"请输入服务器名称",maxlength:"100","show-count":""},null,8,["value"])]),_:1}),t(e(S),{label:"服务器描述",path:"serverDescription"},{default:s(()=>[t(e(H),{value:a.value.serverDescription,"onUpdate:value":r[1]||(r[1]=l=>a.value.serverDescription=l),type:"textarea",placeholder:"请输入服务器描述",maxlength:"500","show-count":"",autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1}),t(e(S),{label:"控制地址",path:"controlAddress"},{default:s(()=>[t(e(H),{value:a.value.controlAddress,"onUpdate:value":r[2]||(r[2]=l=>a.value.controlAddress=l),placeholder:"请输入控制地址，如: 0.0.0.0"},null,8,["value"])]),_:1}),t(e(S),{label:"控制端口",path:"controlPort"},{default:s(()=>[t(e(R),{value:a.value.controlPort,"onUpdate:value":r[3]||(r[3]=l=>a.value.controlPort=l),placeholder:"请输入控制端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"管理面板端口",path:"dashboardPort"},{default:s(()=>[t(e(R),{value:a.value.dashboardPort,"onUpdate:value":r[4]||(r[4]=l=>a.value.dashboardPort=l),placeholder:"请输入管理面板端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1})])]),_:1}),t(e(Q),{name:"network",tab:"网络配置"},{default:s(()=>[u("div",Bt,[t(e(S),{label:"HTTP端口",path:"vhostHttpPort"},{default:s(()=>[t(e(R),{value:a.value.vhostHttpPort,"onUpdate:value":r[5]||(r[5]=l=>a.value.vhostHttpPort=l),placeholder:"虚拟主机HTTP端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"HTTPS端口",path:"vhostHttpsPort"},{default:s(()=>[t(e(R),{value:a.value.vhostHttpsPort,"onUpdate:value":r[6]||(r[6]=l=>a.value.vhostHttpsPort=l),placeholder:"虚拟主机HTTPS端口",min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"最大客户端数",path:"maxClients"},{default:s(()=>[t(e(R),{value:a.value.maxClients,"onUpdate:value":r[7]||(r[7]=l=>a.value.maxClients=l),placeholder:"最大客户端连接数",min:1,max:1e4,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"每客户端最大端口",path:"maxPortsPerClient"},{default:s(()=>[t(e(R),{value:a.value.maxPortsPerClient,"onUpdate:value":r[8]||(r[8]=l=>a.value.maxPortsPerClient=l),placeholder:"每个客户端最大端口数",min:1,max:100,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"允许的端口范围",path:"allowPorts"},{default:s(()=>[t(e(H),{value:a.value.allowPorts,"onUpdate:value":r[9]||(r[9]=l=>a.value.allowPorts=l),placeholder:"如: 10000-20000,30000-40000"},null,8,["value"])]),_:1})])]),_:1}),t(e(Q),{name:"auth",tab:"认证配置"},{default:s(()=>[u("div",Kt,[t(e(S),{label:"启用Token认证",path:"tokenAuth"},{default:s(()=>[t(e(de),{value:g.value,"onUpdate:value":[r[10]||(r[10]=l=>g.value=l),L]},{checked:s(()=>r[20]||(r[20]=[$("启用")])),unchecked:s(()=>r[21]||(r[21]=[$("禁用")])),_:1},8,["value"])]),_:1}),g.value?(G(),oe(e(S),{key:0,label:"认证Token",path:"authToken"},{default:s(()=>[t(e(tt),null,{default:s(()=>[t(e(H),{value:a.value.authToken,"onUpdate:value":r[11]||(r[11]=l=>a.value.authToken=l),placeholder:"请输入或生成认证Token",style:{flex:"1"}},null,8,["value"]),t(e(C),{type:"primary",ghost:"",onClick:q},{default:s(()=>r[22]||(r[22]=[$(" 生成Token ")])),_:1})]),_:1})]),_:1})):ne("",!0),t(e(S),{label:"启用TLS",path:"tlsEnable"},{default:s(()=>[t(e(de),{value:f.value,"onUpdate:value":[r[12]||(r[12]=l=>f.value=l),Y]},{checked:s(()=>r[23]||(r[23]=[$("启用")])),unchecked:s(()=>r[24]||(r[24]=[$("禁用")])),_:1},8,["value"])]),_:1}),f.value?(G(),Z(Ye,{key:1},[t(e(S),{label:"TLS证书文件",path:"tlsCertFile"},{default:s(()=>[t(e(H),{value:a.value.tlsCertFile,"onUpdate:value":r[13]||(r[13]=l=>a.value.tlsCertFile=l),placeholder:"请输入TLS证书文件路径"},null,8,["value"])]),_:1}),t(e(S),{label:"TLS私钥文件",path:"tlsKeyFile"},{default:s(()=>[t(e(H),{value:a.value.tlsKeyFile,"onUpdate:value":r[14]||(r[14]=l=>a.value.tlsKeyFile=l),placeholder:"请输入TLS私钥文件路径"},null,8,["value"])]),_:1})],64)):ne("",!0)])]),_:1}),t(e(Q),{name:"advanced",tab:"高级配置"},{default:s(()=>[u("div",Dt,[t(e(S),{label:"心跳间隔(秒)",path:"heartbeatInterval"},{default:s(()=>[t(e(R),{value:a.value.heartbeatInterval,"onUpdate:value":r[15]||(r[15]=l=>a.value.heartbeatInterval=l),placeholder:"心跳间隔时间",min:10,max:300,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"心跳超时(秒)",path:"heartbeatTimeout"},{default:s(()=>[t(e(R),{value:a.value.heartbeatTimeout,"onUpdate:value":r[16]||(r[16]=l=>a.value.heartbeatTimeout=l),placeholder:"心跳超时时间",min:30,max:600,style:{width:"100%"}},null,8,["value"])]),_:1}),t(e(S),{label:"日志级别",path:"logLevel"},{default:s(()=>[t(e(ye),{value:a.value.logLevel,"onUpdate:value":r[17]||(r[17]=l=>a.value.logLevel=l),placeholder:"请选择日志级别",options:c},null,8,["value"])]),_:1}),t(e(S),{label:"备注信息",path:"noteText"},{default:s(()=>[t(e(H),{value:a.value.noteText,"onUpdate:value":r[18]||(r[18]=l=>a.value.noteText=l),type:"textarea",placeholder:"请输入备注信息",maxlength:"500","show-count":"",autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["show","title"]))}}),Jt=ee(Vt,[["__scopeId","data-v-f5ab194c"]]),Wt={class:"tunnel-server-management"},jt={class:"stats-section"},Qt={class:"main-content"},Xt={class:"table-header"},Zt=W({__name:"TunnelServerManagement",setup(k){const o=se(),d=w(null),b=w(!1),y=w({totalServers:0,runningServers:0,stoppedServers:0,errorServers:0,totalClients:0,totalConnections:0}),p=w(!1),c=w(null),T=async()=>{try{const f=await Ae();if(E(f)){const P=X(f,{totalServers:0,runningServers:0,stoppedServers:0,errorServers:0,totalClients:0,totalConnections:0});y.value=P}}catch(f){console.error("获取统计信息失败:",f)}},I=()=>{c.value=null,p.value=!0},x=f=>{c.value=f,p.value=!0},z=()=>{c.value=null,p.value=!1,g()},a=async()=>{var f;b.value=!0;try{await Promise.all([T(),(f=d.value)==null?void 0:f.initialize()]),o.success("数据刷新成功")}catch(P){console.error("刷新数据失败:",P),o.error("刷新数据失败")}finally{b.value=!1}},g=async()=>{await a()};return me(()=>{g()}),(f,P)=>(G(),Z("div",Wt,[u("div",jt,[t(At,{statistics:y.value},null,8,["statistics"])]),u("div",Qt,[t(e(O),{bordered:!1,class:"content-card"},{default:s(()=>[u("div",Xt,[t(e(C),{onClick:a,loading:b.value},{icon:s(()=>[t(e(_),{component:e(be)},null,8,["component"])]),default:s(()=>[P[1]||(P[1]=$(" 刷新 "))]),_:1},8,["loading"])]),t(Ot,{ref_key:"tableRef",ref:d,onCreate:I,onEdit:x},null,512)]),_:1})]),t(Jt,{show:p.value,"onUpdate:show":P[0]||(P[0]=M=>p.value=M),"edit-data":c.value,onSuccess:z},null,8,["show","edit-data"])]))}}),xr=ee(Zt,[["__scopeId","data-v-6690b1d1"]]);export{xr as default};

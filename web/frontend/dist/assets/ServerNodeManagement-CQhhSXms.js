import{c as Re,G as Ae,S as ze}from"./SearchForm-YJ2LWOI7.js";import{G as Z}from"./GCard-Df0ydLzO.js";import{G as ke}from"./GPane-MizfBz4X.js";import{d as ee,a7 as ie,q as le,r as T,a8 as de,g as j,o as A,w as p,f as h,c as H,h as U,b as d,e as a,I as ce,ab as re,J as ue,K as G,i as V,aa as L,_ as te,j as q,ac as Le,ad as Se,ag as ne,t as K,ah as Ye,a9 as Oe,af as Pe,m as He,am as Ie}from"./index-talhFt-3.js";import{R as fe,D as Be,A as Te,a as _e,C as Ee,G as Ue,W as Fe,b as Ge}from"./WindowsOutlined-DOZI7f-d.js";import{u as me,a as ve,b as he,c as pe,d as ge,e as ye,f as we,g as be,i as Me,L as Ce}from"./installCanvasRenderer-Bdf8yIjj.js";import{N as De}from"./index-Do6tdfLc.js";import{N as We}from"./DataTable-4Eom1Te_.js";import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Ds-H5BDS.js";import"./RefreshOutline-CA3DFaJQ.js";import"./Select-B2cdGhy0.js";import"./Checkbox-kG9momXt.js";import"./RadioGroup-Dny1k1zE.js";import"./prop-NnGblK-3.js";import"./download-C2161hUv.js";const Ke={class:"card-extra"},Ve={class:"chart-container"},qe={key:0,class:"chart-loading"},Je={key:1,class:"chart-empty"},Xe=ee({__name:"CpuMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},cpuDetailData:{type:Array,default:()=>[]},userColor:{type:String,default:"#1890ff"},systemColor:{type:String,default:"#52c41a"},idleColor:{type:String,default:"#d9d9d9"}},emits:["refresh","time-range-change"],setup(s,{emit:_}){me([ve,he,pe,ge,ye,we,be]);const g=T(null);let v=null;const u=s,f=_,b=Date.now(),C=b-3600*1e3,r=T([C,b]),k={最近1小时:()=>{const c=Date.now();return[c-3600*1e3,c]},最近6小时:()=>{const c=Date.now();return[c-6*3600*1e3,c]},最近12小时:()=>{const c=Date.now();return[c-12*3600*1e3,c]},最近24小时:()=>{const c=Date.now();return[c-24*3600*1e3,c]},最近7天:()=>{const c=Date.now();return[c-168*3600*1e3,c]}},Y=()=>{g.value&&(v=Me(g.value),window.addEventListener("resize",$),z())},z=()=>{if(!v)return;if(!u.data||!Array.isArray(u.data)||u.data.length===0){v.clear();return}const c=u.data.map(n=>n.collectTime).sort(),y=new Map;u.data.forEach(n=>{y.set(n.collectTime,n)});const w=[{name:"CPU使用率",type:"line",data:c.map(n=>{const e=y.get(n);return{value:e?e.usagePercent:0,detail:e}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:u.userColor}},{name:"用户态使用率",type:"line",data:c.map(n=>{const e=y.get(n);return{value:e?e.userPercent:0,detail:e}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:u.systemColor}},{name:"系统态使用率",type:"line",data:c.map(n=>{const e=y.get(n);return{value:e?e.systemPercent:0,detail:e}}),smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:u.idleColor}}],t={tooltip:{trigger:"axis",confine:!1,appendToBody:!0,formatter:n=>{const e=n[0].data.detail;let l="";return e&&(l+="CPU详细信息:<br/>",l+=`物理核心数: ${e.coreCount}<br/>`,l+=`逻辑核心数: ${e.logicalCount}<br/>`,l+=`1分钟负载: ${e.loadAvg1.toFixed(2)}<br/>`,l+=`5分钟负载: ${e.loadAvg5.toFixed(2)}<br/>`,l+=`15分钟负载: ${e.loadAvg15.toFixed(2)}<br/>`,l+=`IO等待率: ${e.ioWaitPercent.toFixed(2)}%<br/>`,l+=`硬中断率: ${e.irqPercent.toFixed(2)}%<br/>`,l+=`软中断率: ${e.softIrqPercent.toFixed(2)}%<br/>`,l+="<br/>"),n.forEach(m=>{const D=m.marker,o=m.seriesName,i=`${m.value.toFixed(2)}%`;l+=`${D} ${o}: ${i}<br/>`}),l},axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["CPU使用率","用户态使用率","系统态使用率"],type:"scroll",bottom:0},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:c.map(n=>L(n,"HH:mm:ss")),axisLabel:{interval:Math.floor(c.length/10)}},yAxis:{type:"value",axisLabel:{formatter:n=>n.toFixed(2)+"%"},max:100,min:0},series:w};v.setOption(t,!0)},$=()=>{v==null||v.resize()},I=()=>{f("refresh")},N=c=>{f("time-range-change",c)};return ie(()=>u.data,()=>{z()},{deep:!0}),le(()=>{Y(),f("time-range-change",r.value)}),de(()=>{v&&(v.dispose(),v=null),window.removeEventListener("resize",$)}),(c,y)=>(A(),j(a(Z),{title:"CPU使用率","show-title":!0},{"header-extra":p(()=>[h("div",Ke,[d(a(De),{value:r.value,"onUpdate:value":[y[0]||(y[0]=w=>r.value=w),N],type:"datetimerange",shortcuts:k,placeholder:"选择时间范围",size:"small"},null,8,["value"]),d(a(ue),{size:"small",onClick:I,loading:s.loading},{icon:p(()=>[d(a(V),null,{default:p(()=>[d(a(fe))]),_:1})]),default:p(()=>[y[1]||(y[1]=G(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:p(()=>[h("div",Ve,[h("div",{ref_key:"chartRef",ref:g,class:"chart-element"},null,512),s.loading?(A(),H("div",qe,[d(a(ce),{size:"large"})])):U("",!0),!s.loading&&(!s.data||!Array.isArray(s.data)||s.data.length===0)?(A(),H("div",Je,[d(a(re),{description:"暂无数据"})])):U("",!0)])]),_:1}))}}),je=te(Xe,[["__scopeId","data-v-1ffd38f9"]]),Qe={class:"card-extra"},Ze={class:"chart-container"},et={key:0,class:"chart-loading"},tt={key:1,class:"chart-empty"},at=ee({__name:"MemoryMonitor",props:{title:{type:String,default:"内存使用率"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},warningThreshold:{type:Number,default:80},dangerThreshold:{type:Number,default:90},memoryDetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(s,{emit:_}){me([ve,he,pe,ge,ye,we,be]);const g=s,v=q(()=>g.title||"内存使用率"),u=q(()=>g.warningThreshold),f=q(()=>g.dangerThreshold),b=_,C=T(null);let r=null;const k=Date.now(),Y=k-3600*1e3,z=T([Y,k]),$={最近1小时:()=>{const e=Date.now();return[e-3600*1e3,e]},最近6小时:()=>{const e=Date.now();return[e-6*3600*1e3,e]},最近12小时:()=>{const e=Date.now();return[e-12*3600*1e3,e]},最近24小时:()=>{const e=Date.now();return[e-24*3600*1e3,e]},最近7天:()=>{const e=Date.now();return[e-168*3600*1e3,e]}},I=q(()=>{if(!g.data||g.data.length===0)return[];const e=new Map;return g.data.forEach(m=>{const D=m.collectTime;e.has(D)||e.set(D,[]),e.get(D).push(m.usagePercent)}),Array.from(e.entries()).map(([m,D])=>{const o=g.data.find(i=>i.collectTime===m);return{time:m,value:Math.round(D.reduce((i,x)=>i+x,0)/D.length*100)/100,detail:o?{totalMemory:o.totalMemory,usedMemory:o.usedMemory,availableMemory:o.availableMemory,freeMemory:o.freeMemory,cachedMemory:o.cachedMemory,buffersMemory:o.buffersMemory,swapTotal:o.swapTotal,swapUsed:o.swapUsed,swapFree:o.swapFree,swapUsagePercent:o.swapUsagePercent}:null}}).sort((m,D)=>new Date(m.time).getTime()-new Date(D.time).getTime())}),N=e=>{if(e===0)return"0 B";const l=["B","KB","MB","GB","TB","PB"],m=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,m)).toFixed(2)} ${l[m]}`},c=()=>{b("refresh")},y=e=>{b("time-range-change",e)},w=()=>{C.value&&(r=Me(C.value),window.addEventListener("resize",n),t())},t=()=>{if(!r)return;const e=I.value;if(e.length===0){r.clear();return}const l={title:{show:!1},tooltip:{trigger:"axis",confine:!1,appendToBody:!0,formatter:function(m){const D=m[0],o=D.data.detail;if(!o)return`${D.marker}${D.seriesName}: ${D.data.value}%`;let i="";return i+=`${D.marker}内存使用率: <b>${D.data.value}%</b><br/>`,i+="<br/>详细信息:<br/>",i+=`总内存: ${N(o.totalMemory)}<br/>`,i+=`已用内存: ${N(o.usedMemory)}<br/>`,i+=`可用内存: ${N(o.availableMemory)}<br/>`,i+=`空闲内存: ${N(o.freeMemory)}<br/>`,i+=`缓存内存: ${N(o.cachedMemory)}<br/>`,i+=`缓冲区内存: ${N(o.buffersMemory)}<br/>`,i+="<br/>交换分区:<br/>",i+=`总交换空间: ${N(o.swapTotal)}<br/>`,i+=`已用交换空间: ${N(o.swapUsed)}<br/>`,i+=`空闲交换空间: ${N(o.swapFree)}<br/>`,i+=`交换使用率: ${o.swapUsagePercent.toFixed(1)}%`,i}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(m=>L(new Date(m.time),"HH:mm:ss")),axisLabel:{rotate:45}},yAxis:{type:"value",min:0,max:100,splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:"{value}%"}},series:[{name:"内存使用率",type:"line",data:e.map(m=>({value:m.value,detail:m.detail})),smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:2,color:"#52c41a"},itemStyle:{color:function(m){const D=m.data.value;return D>=f.value?"#ff4d4f":D>=u.value?"#faad14":"#52c41a"}},areaStyle:{color:new Ce(0,0,0,1,[{offset:0,color:"rgba(82, 196, 26, 0.3)"},{offset:1,color:"rgba(82, 196, 26, 0.1)"}])},markLine:{silent:!0,lineStyle:{color:"#faad14"},data:[{yAxis:u.value,label:{formatter:`警告 ${u.value}%`,position:"start"}},{yAxis:f.value,lineStyle:{color:"#ff4d4f"},label:{formatter:`危险 ${f.value}%`,position:"start"}}]}}]};r.setOption(l)},n=()=>{r==null||r.resize()};return ie(()=>g.data,()=>{t()},{deep:!0}),le(()=>{w(),b("time-range-change",z.value)}),de(()=>{r&&(r.dispose(),r=null),window.removeEventListener("resize",n)}),(e,l)=>(A(),j(a(Z),{title:v.value,"show-title":!0},{"header-extra":p(()=>[h("div",Qe,[d(a(De),{value:z.value,"onUpdate:value":[l[0]||(l[0]=m=>z.value=m),y],type:"datetimerange",shortcuts:$,placeholder:"选择时间范围",size:"small"},null,8,["value"]),d(a(ue),{size:"small",onClick:c,loading:s.loading},{icon:p(()=>[d(a(V),null,{default:p(()=>[d(a(fe))]),_:1})]),default:p(()=>[l[1]||(l[1]=G(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:p(()=>[h("div",Ze,[h("div",{ref_key:"chartRef",ref:C,class:"chart-element"},null,512),s.loading?(A(),H("div",et,[d(a(ce),{size:"large"})])):U("",!0),!s.loading&&!I.value.length?(A(),H("div",tt,[d(a(re),{description:"暂无数据"})])):U("",!0)])]),_:1},8,["title"]))}}),rt=te(at,[["__scopeId","data-v-058d593d"]]),st={class:"card-extra"},nt={class:"chart-container"},ot={key:0,class:"chart-loading"},it={key:1,class:"chart-empty"},lt=ee({__name:"DiskMonitor",props:{title:{type:String,default:"磁盘使用率"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},warningThreshold:{type:Number,default:80},dangerThreshold:{type:Number,default:90},diskDetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(s,{emit:_}){me([ve,he,pe,ge,ye,we,be]);const g=s,v=q(()=>g.title||"磁盘使用率"),u=_,f=T(null);let b=null;const C=Date.now(),r=C-3600*1e3,k=T([r,C]),Y={最近1小时:()=>{const t=Date.now();return[t-3600*1e3,t]},最近6小时:()=>{const t=Date.now();return[t-6*3600*1e3,t]},最近12小时:()=>{const t=Date.now();return[t-12*3600*1e3,t]},最近24小时:()=>{const t=Date.now();return[t-24*3600*1e3,t]},最近7天:()=>{const t=Date.now();return[t-168*3600*1e3,t]}},z=q(()=>{if(!g.data||g.data.length===0)return[];const t=new Map;return g.data.forEach(n=>{const e=n.collectTime;t.has(e)||t.set(e,{values:[],partitions:[]});const l=t.get(e);l.values.push(n.usagePercent),l.partitions.push(n)}),Array.from(t.entries()).map(([n,e])=>({time:n,value:Math.round(e.values.reduce((l,m)=>l+m,0)/e.values.length*100)/100,detail:{partitions:e.partitions,partitionCount:e.partitions.length,totalSpace:e.partitions.reduce((l,m)=>l+m.totalSpace,0),usedSpace:e.partitions.reduce((l,m)=>l+m.usedSpace,0),freeSpace:e.partitions.reduce((l,m)=>l+m.freeSpace,0),avgUsagePercent:Math.round(e.values.reduce((l,m)=>l+m,0)/e.values.length*100)/100}}))}),$=t=>{if(t===0)return"0 B";const n=["B","KB","MB","GB","TB","PB"],e=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,e)).toFixed(2)} ${n[e]}`},I=()=>{u("refresh")},N=t=>{u("time-range-change",t)},c=()=>{f.value&&(b=Me(f.value),window.addEventListener("resize",w),y())},y=()=>{if(!b)return;const t=z.value;if(t.length===0){b.clear();return}const n=q(()=>g.warningThreshold??80),e=q(()=>g.dangerThreshold??90),l={title:{show:!1},tooltip:{trigger:"axis",confine:!1,appendToBody:!0,formatter:function(m){const D=m[0],o=D.data.detail;let i="";return i+=`${D.marker}磁盘使用率: <b>${D.data.value}%</b><br/>`,i+="<br/>详细信息:<br/>",i+=`分区数量: ${o.partitionCount}<br/>`,i+=`总空间: ${$(o.totalSpace)}<br/>`,i+=`已用空间: ${$(o.usedSpace)}<br/>`,i+=`空闲空间: ${$(o.freeSpace)}<br/>`,o.partitions.length>0&&(i+="<br/>分区详情:<br/>",o.partitions.slice(0,3).forEach(S=>{i+=`${S.mountPoint}: ${S.usagePercent.toFixed(1)}% (${$(S.usedSpace)}/${$(S.totalSpace)})<br/>`}),o.partitions.length>3&&(i+=`... 还有 ${o.partitions.length-3} 个分区`)),i}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:t.map(m=>L(new Date(m.time),"HH:mm:ss")),axisLabel:{rotate:45}},yAxis:{type:"value",min:0,max:100,splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:"{value}%"}},series:[{name:"磁盘使用率",type:"line",data:t.map(m=>({value:m.value,detail:m.detail})),smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:2,color:"#faad14"},itemStyle:{color:function(m){const D=m.data.value;return D>=e.value?"#ff4d4f":(D>=n.value,"#faad14")}},areaStyle:{color:new Ce(0,0,0,1,[{offset:0,color:"rgba(250, 173, 20, 0.3)"},{offset:1,color:"rgba(250, 173, 20, 0.1)"}])},markLine:{silent:!0,lineStyle:{color:"#faad14"},data:[{yAxis:n.value,label:{formatter:`警告 ${n.value}%`,position:"start"}},{yAxis:e.value,lineStyle:{color:"#ff4d4f"},label:{formatter:`危险 ${e.value}%`,position:"start"}}]}}]};b.setOption(l)},w=()=>{b==null||b.resize()};return ie(()=>g.data,()=>{y()},{deep:!0}),le(()=>{c(),u("time-range-change",k.value)}),de(()=>{b&&(b.dispose(),b=null),window.removeEventListener("resize",w)}),(t,n)=>(A(),j(a(Z),{title:v.value,"show-title":!0},{"header-extra":p(()=>[h("div",st,[d(a(De),{value:k.value,"onUpdate:value":[n[0]||(n[0]=e=>k.value=e),N],type:"datetimerange",shortcuts:Y,placeholder:"选择时间范围",size:"small"},null,8,["value"]),d(a(ue),{size:"small",onClick:I,loading:s.loading},{icon:p(()=>[d(a(V),null,{default:p(()=>[d(a(fe))]),_:1})]),default:p(()=>[n[1]||(n[1]=G(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:p(()=>[h("div",nt,[h("div",{ref_key:"chartRef",ref:f,class:"chart-element"},null,512),s.loading?(A(),H("div",ot,[d(a(ce),{size:"large"})])):U("",!0),!s.loading&&!z.value.length?(A(),H("div",it,[d(a(re),{description:"暂无数据"})])):U("",!0)])]),_:1},8,["title"]))}}),dt=te(lt,[["__scopeId","data-v-172ca3f4"]]),ct={class:"card-extra"},ut={class:"chart-container"},ft={key:0,class:"chart-loading"},mt={key:1,class:"chart-empty"},vt={key:0,class:"detail-section"},ht=ee({__name:"DiskIOMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},diskIODetailData:{type:Array,default:()=>[]}},emits:["refresh","time-range-change"],setup(s,{emit:_}){me([ve,he,pe,ge,ye,we,be]);const g=T(null);let v=null;const u=s,f=_,b=Date.now(),C=b-3600*1e3,r=T([C,b]),k={最近1小时:()=>{const t=Date.now();return[t-3600*1e3,t]},最近6小时:()=>{const t=Date.now();return[t-6*3600*1e3,t]},最近12小时:()=>{const t=Date.now();return[t-12*3600*1e3,t]},最近24小时:()=>{const t=Date.now();return[t-24*3600*1e3,t]},最近7天:()=>{const t=Date.now();return[t-168*3600*1e3,t]}},Y={pageSize:5,page:1},z=q(()=>[{title:"设备名称",key:"deviceName"},{title:"读取速率",key:"readRate",render:t=>Se(t.readRate)+"/s"},{title:"写入速率",key:"writeRate",render:t=>Se(t.writeRate)+"/s"},{title:"读取次数",key:"readCount"},{title:"写入次数",key:"writeCount"},{title:"采集时间",key:"collectTime",render:t=>L(t.collectTime)}]),$=q(()=>{if(!u.diskIODetailData)return[];const t=new Map;return u.diskIODetailData.forEach(n=>{const e=t.get(n.deviceName);(!e||new Date(n.collectTime)>new Date(e.collectTime))&&t.set(n.deviceName,n)}),Array.from(t.values())}),I=()=>{g.value&&(v=Me(g.value),window.addEventListener("resize",c),N())},N=()=>{if(!v)return;if(!u.data||!Array.isArray(u.data)||u.data.length===0){v.clear();return}const t=new Map;u.data.forEach(o=>{var i;t.has(o.collectTime)||t.set(o.collectTime,new Map),(i=t.get(o.collectTime))==null||i.set(o.deviceName,o)});const n=Array.from(t.keys()).sort(),e=new Set;u.data.forEach(o=>e.add(o.deviceName));const l=[{read:"#1890ff",write:"#36cfc9"},{read:"#722ed1",write:"#eb2f96"},{read:"#fa8c16",write:"#faad14"},{read:"#52c41a",write:"#a0d911"},{read:"#f5222d",write:"#ff7a45"}],m=[];Array.from(e).forEach((o,i)=>{const x=i%l.length,S=l[x],M=[],E=[];n.forEach(F=>{var B;const R=(B=t.get(F))==null?void 0:B.get(o);M.push(R?R.readRate:0),E.push(R?R.writeRate:0)}),m.push({name:`${o} 读取`,type:"line",data:M,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"solid"},itemStyle:{color:S.read}}),m.push({name:`${o} 写入`,type:"line",data:E,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"dashed"},itemStyle:{color:S.write}})});const D={title:{show:!1},tooltip:{trigger:"axis",confine:!1,appendToBody:!0,formatter:o=>{const i=Array.isArray(o)?o[0]:o,x=n[i.dataIndex];let S=L(x,"YYYY-MM-DD HH:mm:ss")+"<br/>";const M=new Map;return o.forEach(E=>{var B;const R=E.seriesName.split(" ")[0];M.has(R)||M.set(R,[]),(B=M.get(R))==null||B.push(E)}),M.forEach((E,F)=>{S+=`<div style="margin-top: 3px;"><b>${F}</b></div>`,E.forEach(R=>{const B=R.color,P=R.seriesName.includes("读取")?"读取":"写入",W=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${B};border:1px solid ${B}"></span>`;S+=`<div style="padding-left: 12px;line-height:18px">${W}${P}: ${Se(Number(R.value))}/s</div>`})}),S}},legend:{type:"scroll",bottom:0,padding:[10,20],selected:m.reduce((o,i)=>(o[i.name]=!0,o),{}),formatter:o=>{const i=o.split(" ")[0],x=o.includes("读取")?"读取":"写入";return`${i} ${x}`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:n.map(o=>L(o,"HH:mm:ss")),axisLabel:{interval:Math.floor(n.length/10)}},yAxis:{type:"value",axisLabel:{formatter:o=>Se(o)+"/s"}},series:m};v.setOption(D,!0)},c=()=>{v==null||v.resize()},y=()=>{f("refresh")},w=t=>{f("time-range-change",t)};return ie(()=>u.data,()=>{N()},{deep:!0}),le(()=>{I(),f("time-range-change",r.value)}),de(()=>{v&&(v.dispose(),v=null),window.removeEventListener("resize",c)}),(t,n)=>(A(),j(a(Z),{title:"磁盘IO监控","show-title":!0},{"header-extra":p(()=>[h("div",ct,[d(a(De),{value:r.value,"onUpdate:value":[n[0]||(n[0]=e=>r.value=e),w],type:"datetimerange",shortcuts:k,placeholder:"选择时间范围",size:"small"},null,8,["value"]),d(a(ue),{size:"small",onClick:y,loading:s.loading},{icon:p(()=>[d(a(V),null,{default:p(()=>[d(a(fe))]),_:1})]),default:p(()=>[n[1]||(n[1]=G(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:p(()=>[h("div",ut,[h("div",{ref_key:"chartRef",ref:g,class:"chart-element"},null,512),s.loading?(A(),H("div",ft,[d(a(ce),{size:"large"})])):U("",!0),!s.loading&&(!s.data||!Array.isArray(s.data)||s.data.length===0)?(A(),H("div",mt,[d(a(re),{description:"暂无数据"})])):U("",!0)]),s.diskIODetailData&&s.diskIODetailData.length>0?(A(),H("div",vt,[d(a(Le),null,{default:p(()=>[...n[2]||(n[2]=[G("磁盘IO详情",-1)])]),_:1}),d(a(We),{columns:z.value,data:$.value,pagination:Y,bordered:!1,size:"small"},null,8,["columns","data"])])):U("",!0)]),_:1}))}}),pt=te(ht,[["__scopeId","data-v-09f602e3"]]),gt={class:"card-extra"},yt={class:"chart-container"},wt={key:0,class:"chart-loading"},bt={key:1,class:"chart-empty"},Mt=ee({__name:"NetworkMonitor",props:{title:{},data:{},loading:{type:Boolean},uploadColor:{},downloadColor:{}},emits:["refresh","time-range-change"],setup(s,{emit:_}){me([ve,he,pe,ge,ye,we,be]);const g=s,v={title:"网络流量"},u=_,f=T(null);let b=null;const C=Date.now(),r=C-3600*1e3,k=T([r,C]),Y={最近1小时:()=>{const t=Date.now();return[t-3600*1e3,t]},最近6小时:()=>{const t=Date.now();return[t-6*3600*1e3,t]},最近12小时:()=>{const t=Date.now();return[t-12*3600*1e3,t]},最近24小时:()=>{const t=Date.now();return[t-24*3600*1e3,t]},最近7天:()=>{const t=Date.now();return[t-168*3600*1e3,t]}},z=q(()=>{if(!g.data||g.data.length===0)return[];const t=new Map;return g.data.forEach(n=>{const e=n.collectTime;t.has(e)||t.set(e,{interfaces:[]}),t.get(e).interfaces.push(n)}),Array.from(t.entries()).sort((n,e)=>new Date(n[0]).getTime()-new Date(e[0]).getTime()).map(([n,e])=>({time:n,detail:{interfaces:e.interfaces,interfaceCount:e.interfaces.length}}))}),$=t=>t===0?"0 B/s":t<1024?`${t.toFixed(2)} B/s`:t<1024*1024?`${(t/1024).toFixed(2)} KB/s`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(2)} MB/s`:`${(t/(1024*1024*1024)).toFixed(2)} GB/s`,I=()=>{u("refresh")},N=t=>{u("time-range-change",t)},c=()=>{f.value&&(b=Me(f.value),window.addEventListener("resize",w),y())},y=()=>{if(!b)return;const t=z.value;if(t.length===0){b.clear();return}const n=t.map(S=>L(new Date(S.time),"HH:mm:ss")),e=new Set,l=[],m=[];t.forEach(S=>{S.detail.interfaces.forEach(M=>{e.has(M.interfaceName)||(M.ipAddresses&&M.ipAddresses.includes(".")&&!M.ipAddresses.includes(":")||M.interfaceName.match(/eth\d+|en\d+|bond\d+|wlan\d+|ens\d+|enp\d+|lo\b|vlan\d+/i)?l.push(M.interfaceName):m.push(M.interfaceName),e.add(M.interfaceName))})});const D=[...l,...m],o=[{send:"#fa541c",receive:"#73d13d"},{send:"#722ed1",receive:"#13c2c2"},{send:"#f5222d",receive:"#52c41a"},{send:"#fa8c16",receive:"#1890ff"},{send:"#eb2f96",receive:"#fadb14"}],i=[];D.forEach((S,M)=>{const E=M%o.length,F=o[E],R=t.map(P=>{const W=P.detail.interfaces.find(J=>J.interfaceName===S);return W?Math.round(W.sendRate/(1024*1024)*100)/100:0}),B=t.map(P=>{const W=P.detail.interfaces.find(J=>J.interfaceName===S);return W?Math.round(W.receiveRate/(1024*1024)*100)/100:0}),se=l.includes(S)?2:1;i.push({name:`${S} 上传`,type:"line",data:R,smooth:!0,showSymbol:!1,lineStyle:{width:se,type:"solid"},itemStyle:{color:F.send},emphasis:{focus:"series"},tooltip:{valueFormatter:P=>`${P} MB/s`}}),i.push({name:`${S} 下载`,type:"line",data:B,smooth:!0,showSymbol:!1,lineStyle:{width:se,type:"dashed"},itemStyle:{color:F.receive},emphasis:{focus:"series"},tooltip:{valueFormatter:P=>`${P} MB/s`}})});const x={title:{show:!1},tooltip:{trigger:"axis",confine:!1,appendToBody:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(S){var se;const M=S[0].axisValue,E=n.indexOf(M),F=(se=t[E])==null?void 0:se.detail;let R=`${M}<br/>`;const B=new Map;if(S.forEach(P=>{const J=P.seriesName.split(" ")[0];B.has(J)||B.set(J,[]),B.get(J).push(P)}),F){const P=new Set;B.forEach((X,O)=>{P.add(O)}),F.interfaces.forEach(X=>{P.add(X.interfaceName)}),R+=`接口总数: ${F.interfaceCount}<br/>`;const W=[],J=[];Array.from(P).forEach(X=>{const O=F.interfaces.find(xe=>xe.interfaceName===X);if(!O)return;O.ipAddresses&&O.ipAddresses.includes(".")&&!O.ipAddresses.includes(":")||O.interfaceName.match(/eth\d+|en\d+|bond\d+|wlan\d+|ens\d+|enp\d+|lo\b|vlan\d+/i)?W.push(X):J.push(X)});const $e=[...W,...J];$e.length>0&&(R+="<br/>接口详情:<br/>",$e.forEach(X=>{const O=F.interfaces.find(xe=>xe.interfaceName===X);if(!O)return;R+='<div style="padding:3px 0;border-bottom:1px solid #eee;">',R+=`<b>${X}</b>: `,W.includes(X)&&(R+='<span style="color:#1890ff;">[IPv4]</span> '),R+=`<br/><span style="padding-left:10px;color:#ff4d4f;">↑${$(O.sendRate)}</span> `,R+=`<span style="padding-left:5px;color:#52c41a;">↓${$(O.receiveRate)}</span>`,(O.errorsReceived>0||O.errorsSent>0)&&(R+=` <span style="color:#ff7875;">(错误: ${O.errorsReceived+O.errorsSent})</span>`),O.ipAddresses&&(R+=`<br/><span style="padding-left:10px;color:#999;font-size:12px;">IP: ${O.ipAddresses}</span>`),R+="</div>"}))}return R}},legend:{type:"scroll",data:i.map(S=>S.name),bottom:0,padding:[5,10],selected:i.reduce((S,M)=>{const E=M.name.split(" ")[0];return S[M.name]=l.includes(E),S},{})},grid:{left:"3%",right:"4%",bottom:"40px",top:"10px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:n,axisLabel:{rotate:45}},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{formatter:S=>S.toFixed(2)+" MB/s"}},series:i};b.setOption(x)},w=()=>{b==null||b.resize()};return ie(()=>g.data,()=>{y()},{deep:!0}),le(()=>{c(),u("time-range-change",k.value)}),de(()=>{b&&(b.dispose(),b=null),window.removeEventListener("resize",w)}),(t,n)=>(A(),j(a(Z),{title:s.title||v.title,"show-title":!0},{"header-extra":p(()=>[h("div",gt,[d(a(De),{value:k.value,"onUpdate:value":[n[0]||(n[0]=e=>k.value=e),N],type:"datetimerange",shortcuts:Y,placeholder:"选择时间范围",size:"small"},null,8,["value"]),d(a(ue),{size:"small",onClick:I,loading:s.loading},{icon:p(()=>[d(a(V),null,{default:p(()=>[d(a(fe))]),_:1})]),default:p(()=>[n[1]||(n[1]=G(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:p(()=>[h("div",yt,[h("div",{ref_key:"chartRef",ref:f,class:"chart-element"},null,512),s.loading?(A(),H("div",wt,[d(a(ce),{size:"large"})])):U("",!0),!s.loading&&!z.value.length?(A(),H("div",bt,[d(a(re),{description:"暂无数据"})])):U("",!0)])]),_:1},8,["title"]))}}),Dt=te(Mt,[["__scopeId","data-v-c822fd97"]]),St={class:"card-extra"},xt={class:"chart-container"},$t={key:0,class:"chart-loading"},kt={key:1,class:"chart-empty"},It=ee({__name:"ProcessMonitor",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},processDetailData:{type:Array,default:()=>[]},cpuColor:{type:String,default:"#1890ff"},memoryColor:{type:String,default:"#52c41a"}},emits:["refresh","time-range-change"],setup(s,{emit:_}){me([ve,he,pe,ge,ye,we,be]);const g=T(null);let v=null;const u=s,f=_,b=Date.now(),C=b-3600*1e3,r=T([C,b]),k={最近1小时:()=>{const c=Date.now();return[c-3600*1e3,c]},最近6小时:()=>{const c=Date.now();return[c-6*3600*1e3,c]},最近12小时:()=>{const c=Date.now();return[c-12*3600*1e3,c]},最近24小时:()=>{const c=Date.now();return[c-24*3600*1e3,c]},最近7天:()=>{const c=Date.now();return[c-168*3600*1e3,c]}},Y=()=>{g.value&&(v=Me(g.value),window.addEventListener("resize",$),z())},z=()=>{if(!v)return;if(!u.data||u.data.length===0){v.clear();return}const c=new Map;u.data.forEach(e=>{var l;c.has(e.collectTime)||c.set(e.collectTime,[]),(l=c.get(e.collectTime))==null||l.push(e)});const y=Array.from(c.keys()).sort(),w=[],t=[];y.forEach(e=>{const l=c.get(e)||[];if(l.length>0){const m=l.reduce((o,i)=>o+i.cpuPercent,0)/l.length,D=l.reduce((o,i)=>o+i.memoryPercent,0)/l.length;w.push(Number(m.toFixed(2))),t.push(Number(D.toFixed(2)))}else w.push(0),t.push(0)});const n={tooltip:{trigger:"axis",confine:!1,appendToBody:!0,formatter:e=>{const l=e[0].dataIndex,m=c.get(y[l])||[];let D=L(y[l],"YYYY-MM-DD HH:mm:ss")+"<br/>";return e.forEach(o=>{const x=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${o.color};"></span>`;D+=x+o.seriesName+": "+o.value+"%<br/>"}),m.length>0&&(D+=`<span style="color:#666;">进程数量: ${m.length}</span><br/>`),m.length>0&&(D+="<br/><b>进程详情</b><br/>",[...m].sort((i,x)=>x.cpuPercent-i.cpuPercent).slice(0,5).forEach((i,x)=>{D+='<div style="padding-left:10px;margin:2px 0;">',D+=`<b>${x+1}. ${i.processName}</b> <span style="color:#666;">(PID: ${i.processId})</span><br/>`,D+=`<span style="padding-left:15px;">CPU: ${i.cpuPercent.toFixed(2)}%, `,D+=`内存: ${i.memoryPercent.toFixed(2)}%, `,D+=`线程: ${i.threadCount}</span>`,D+="</div>"}),m.length>5&&(D+=`<div style="padding-left:10px;color:#999;">... 以及 ${m.length-5} 个其他进程</div>`)),D}},legend:{data:["平均CPU使用率","平均内存使用率"],bottom:0,padding:[10,20]},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:y.map(e=>L(e,"HH:mm:ss")),axisLabel:{interval:Math.floor(y.length/10)}},yAxis:{type:"value",min:0,max:100,position:"left",axisLabel:{formatter:"{value}%"}},series:[{name:"平均CPU使用率",type:"line",data:w,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"solid"},itemStyle:{color:u.cpuColor}},{name:"平均内存使用率",type:"line",data:t,smooth:!0,showSymbol:!1,lineStyle:{width:2,type:"dashed"},itemStyle:{color:u.memoryColor}}]};v.setOption(n)},$=()=>{v==null||v.resize()},I=()=>{f("refresh")},N=c=>{f("time-range-change",c)};return ie(()=>u.data,()=>{z()},{deep:!0}),le(()=>{Y(),f("time-range-change",r.value)}),de(()=>{v&&(v.dispose(),v=null),window.removeEventListener("resize",$)}),(c,y)=>(A(),j(a(Z),{title:"进程监控","show-title":!0},{"header-extra":p(()=>[h("div",St,[d(a(De),{value:r.value,"onUpdate:value":[y[0]||(y[0]=w=>r.value=w),N],type:"datetimerange",shortcuts:k,placeholder:"选择时间范围",size:"small"},null,8,["value"]),d(a(ue),{size:"small",onClick:I,loading:s.loading},{icon:p(()=>[d(a(V),null,{default:p(()=>[d(a(fe))]),_:1})]),default:p(()=>[y[1]||(y[1]=G(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:p(()=>{var w;return[h("div",xt,[h("div",{ref_key:"chartRef",ref:g,class:"chart-element"},null,512),s.loading?(A(),H("div",$t,[d(a(ce),{size:"large"})])):U("",!0),!s.loading&&!((w=s.data)!=null&&w.length)?(A(),H("div",kt,[d(a(re),{description:"暂无数据"})])):U("",!0)])]}),_:1}))}}),Tt=te(It,[["__scopeId","data-v-5dd68d93"]]),_t={class:"overview-grid"},Ct={class:"overview-item"},Nt={class:"overview-icon hostname"},Rt={class:"overview-content"},At={class:"overview-value text-truncate"},zt={class:"overview-item"},Lt={class:"overview-icon os"},Yt={class:"overview-content"},Ot={class:"overview-value text-truncate"},Pt={class:"overview-item"},Ht={class:"overview-icon version"},Bt={class:"overview-content"},Et={class:"overview-value text-truncate"},Ut={class:"overview-item"},Ft={class:"overview-icon architecture"},Gt={class:"overview-content"},Wt={class:"overview-value text-truncate"},Kt={class:"overview-item"},Vt={class:"overview-icon server-type"},qt={class:"overview-content"},Jt={class:"overview-value text-truncate"},Xt={class:"overview-item"},jt={class:"overview-icon ip"},Qt={class:"overview-content"},Zt={class:"overview-value text-truncate"},ea=ee({name:"ServerInfoCard",__name:"ServerInfoCard",props:{serverInfo:{}},setup(s){const _=u=>({physical:"物理机",virtual:"虚拟机",unknown:"未知"})[u||"unknown"]||"未知",g=u=>{const f=u.toLowerCase();return f.includes("windows")?Fe:f.includes("linux")?Te:f.includes("mac")||f.includes("darwin")?Ge:_e},v=u=>{if(!u)return"N/A";if(u.toLowerCase().includes("windows")){const f=u.match(/Windows (\d+(?:\.\d+)?)/i);if(f){const b=f[1],C=u.match(/Windows \d+(?:\.\d+)?\s+(\w+)/i);return C?`Windows ${b} ${C[1]}`:`Windows ${b}`}}return u.length>20?u.substring(0,17)+"...":u};return(u,f)=>(A(),j(a(Oe),{title:"服务器信息",embedded:"",class:"server-info-card"},{default:p(()=>[h("div",_t,[h("div",Ct,[h("div",Nt,[d(a(V),{size:"24"},{default:p(()=>[d(a(Be))]),_:1})]),h("div",Rt,[f[0]||(f[0]=h("div",{class:"overview-label"},"主机名",-1)),d(a(ne),{"show-arrow":!1},{trigger:p(()=>[h("div",At,K(s.serverInfo.hostname),1)]),default:p(()=>[G(" "+K(s.serverInfo.hostname),1)]),_:1})])]),h("div",zt,[h("div",Lt,[d(a(V),{size:"24"},{default:p(()=>[(A(),j(Ye(g(s.serverInfo.osType))))]),_:1})]),h("div",Yt,[f[1]||(f[1]=h("div",{class:"overview-label"},"操作系统",-1)),d(a(ne),{"show-arrow":!1},{trigger:p(()=>[h("div",Ot,K(s.serverInfo.osType),1)]),default:p(()=>[G(" "+K(s.serverInfo.osType),1)]),_:1})])]),h("div",Pt,[h("div",Ht,[d(a(V),{size:"24"},{default:p(()=>[d(a(Te))]),_:1})]),h("div",Bt,[f[2]||(f[2]=h("div",{class:"overview-label"},"系统版本",-1)),d(a(ne),{"show-arrow":!1},{trigger:p(()=>[h("div",Et,K(v(s.serverInfo.osVersion)),1)]),default:p(()=>[G(" "+K(s.serverInfo.osVersion),1)]),_:1})])]),h("div",Ut,[h("div",Ft,[d(a(V),{size:"24"},{default:p(()=>[d(a(_e))]),_:1})]),h("div",Gt,[f[3]||(f[3]=h("div",{class:"overview-label"},"系统架构",-1)),d(a(ne),{"show-arrow":!1},{trigger:p(()=>[h("div",Wt,K(s.serverInfo.architecture),1)]),default:p(()=>[G(" "+K(s.serverInfo.architecture),1)]),_:1})])]),h("div",Kt,[h("div",Vt,[d(a(V),{size:"24"},{default:p(()=>[d(a(Ee))]),_:1})]),h("div",qt,[f[4]||(f[4]=h("div",{class:"overview-label"},"服务器类型",-1)),d(a(ne),{"show-arrow":!1},{trigger:p(()=>[h("div",Jt,K(_(s.serverInfo.serverType)),1)]),default:p(()=>[G(" "+K(_(s.serverInfo.serverType)),1)]),_:1})])]),h("div",Xt,[h("div",jt,[d(a(V),{size:"24"},{default:p(()=>[d(a(Ue))]),_:1})]),h("div",Qt,[f[5]||(f[5]=h("div",{class:"overview-label"},"IP地址",-1)),d(a(ne),{"show-arrow":!1},{trigger:p(()=>[h("div",Zt,K(s.serverInfo.ipAddress||"N/A"),1)]),default:p(()=>[G(" "+K(s.serverInfo.ipAddress||"N/A"),1)]),_:1})])])])]),_:1}))}}),ta=te(ea,[["__scopeId","data-v-f17d303f"]]);var Q=(s=>(s.PHYSICAL="physical",s.VIRTUAL="virtual",s.UNKNOWN="unknown",s))(Q||{}),oe=(s=>(s.LINUX="Linux",s.WINDOWS="Windows",s.MACOS="MacOS",s.UNIX="Unix",s.OTHER="Other",s))(oe||{});function aa(){const s="hub0007",_=T(!1),g=T([]),v=T(),u={fields:[{field:"hostname",label:"主机名",type:"input",placeholder:"请输入主机名",span:6,clearable:!0},{field:"ipAddress",label:"IP地址",type:"input",placeholder:"请输入IP地址",span:6,clearable:!0},{field:"osType",label:"操作系统",type:"select",placeholder:"请选择操作系统",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"Linux",value:oe.LINUX},{label:"Windows",value:oe.WINDOWS},{label:"MacOS",value:oe.MACOS},{label:"Unix",value:oe.UNIX},{label:"其他",value:oe.OTHER}]},{field:"serverType",label:"服务器类型",type:"select",placeholder:"请选择服务器类型",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"物理服务器",value:Q.PHYSICAL},{label:"虚拟服务器",value:Q.VIRTUAL},{label:"未知",value:Q.UNKNOWN}]}],moreFields:[{field:"serverLocation",label:"服务器位置",type:"input",placeholder:"请输入服务器位置",span:6,clearable:!0}],toolbarButtons:[]};return{moduleId:s,loading:_,serverList:g,pageInfo:v,searchFormConfig:u,gridConfig:{columns:[{field:"metricServerId",title:"节点ID",showOverflow:!0,width:200},{field:"hostname",title:"主机名",showOverflow:!0},{field:"ipAddress",title:"IP地址",showOverflow:!0},{field:"osType",title:"操作系统",showOverflow:!0,cellRender:{name:"VxeTag",props:({row:r})=>({type:"info",content:r.osType})}},{field:"osVersion",title:"系统版本",showOverflow:!0},{field:"architecture",title:"架构",showOverflow:!0},{field:"serverType",title:"服务器类型",cellRender:{name:"VxeTag",props:({row:r})=>{const k={[Q.PHYSICAL]:{type:"success",text:"物理服务器"},[Q.VIRTUAL]:{type:"warning",text:"虚拟服务器"},[Q.UNKNOWN]:{type:"default",text:"未知"}},Y=k[r.serverType]||k[Q.UNKNOWN];return{type:Y.type,content:Y.text}}}},{field:"serverLocation",title:"服务器位置",showOverflow:!0},{field:"lastUpdateTime",title:"最后更新",sortable:!0,showOverflow:!0,formatter:({cellValue:r})=>r?L(r,"YYYY-MM-DD HH:mm:ss"):""},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:r})=>r?L(r,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:r})=>r?L(r,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],menuConfig:{enabled:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"}]},paginationConfig:{show:!0}},setServerList:r=>{g.value=r},updatePagination:r=>{v.value=r}}}const ae=Pe("/gateway/hub0007");async function ra(s){return ae.post("/queryServerInfos",s)}async function sa(s){return ae.post("/getServerInfo",{metricServerId:s})}async function na(s){return ae.post("/metrics/cpu",s)}async function oa(s){return ae.post("/metrics/memory",s)}async function ia(s){return ae.post("/metrics/disk",s)}async function la(s){return ae.post("/metrics/diskio",s)}async function da(s){return ae.post("/metrics/network",s)}async function ca(s){return ae.post("/metrics/process",s)}function ua(){const s=T(""),_=T(!1),g=T(!1),v=T(!1),u=T(!1),f=T(!1),b=T(!1),C=T([]),r=T([]),k=T([]),Y=T([]),z=T([]),$=T([]),I=T([Date.now()-3600*1e3,Date.now()]),N=async o=>{const i=o||s.value;if(i){_.value=!0;try{const[x,S]=I.value,M=await na({metricServerId:i,startTime:L(x,"YYYY-MM-DD HH:mm:ss"),endTime:L(S,"YYYY-MM-DD HH:mm:ss")});M.oK&&M.bizData&&(C.value=JSON.parse(M.bizData))}catch(x){console.error("加载CPU监控数据失败:",x)}finally{_.value=!1}}},c=async o=>{const i=o||s.value;if(i){g.value=!0;try{const[x,S]=I.value,M=await oa({metricServerId:i,startTime:L(x,"YYYY-MM-DD HH:mm:ss"),endTime:L(S,"YYYY-MM-DD HH:mm:ss")});M.oK&&M.bizData&&(r.value=JSON.parse(M.bizData))}catch(x){console.error("加载内存监控数据失败:",x)}finally{g.value=!1}}},y=async o=>{const i=o||s.value;if(i){v.value=!0;try{const[x,S]=I.value,M=await ia({metricServerId:i,startTime:L(x,"YYYY-MM-DD HH:mm:ss"),endTime:L(S,"YYYY-MM-DD HH:mm:ss")});M.oK&&M.bizData&&(k.value=JSON.parse(M.bizData))}catch(x){console.error("加载磁盘监控数据失败:",x)}finally{v.value=!1}}},w=async o=>{const i=o||s.value;if(i){u.value=!0;try{const[x,S]=I.value,M=await la({metricServerId:i,startTime:L(x,"YYYY-MM-DD HH:mm:ss"),endTime:L(S,"YYYY-MM-DD HH:mm:ss")});M.oK&&M.bizData&&(Y.value=JSON.parse(M.bizData))}catch(x){console.error("加载磁盘IO监控数据失败:",x)}finally{u.value=!1}}},t=async o=>{const i=o||s.value;if(i){f.value=!0;try{const[x,S]=I.value,M=await da({metricServerId:i,startTime:L(x,"YYYY-MM-DD HH:mm:ss"),endTime:L(S,"YYYY-MM-DD HH:mm:ss")});M.oK&&M.bizData&&(z.value=JSON.parse(M.bizData))}catch(x){console.error("加载网络监控数据失败:",x)}finally{f.value=!1}}},n=async o=>{const i=o||s.value;if(i){b.value=!0;try{const[x,S]=I.value,M=await ca({metricServerId:i,startTime:L(x,"YYYY-MM-DD HH:mm:ss"),endTime:L(S,"YYYY-MM-DD HH:mm:ss")});M.oK&&M.bizData&&($.value=JSON.parse(M.bizData))}catch(x){console.error("加载进程监控数据失败:",x)}finally{b.value=!1}}},e=async o=>{const i=o||s.value;i&&await Promise.all([N(i),c(i),y(i),w(i),t(i),n(i)])},l=()=>{C.value=[],r.value=[],k.value=[],Y.value=[],z.value=[],$.value=[]};return{selectedServerId:s,cpuLoading:_,memoryLoading:g,diskLoading:v,diskIOLoading:u,networkLoading:f,processLoading:b,cpuMetrics:C,memoryMetrics:r,diskMetrics:k,diskIOMetrics:Y,networkMetrics:z,processMetrics:$,timeRange:I,loadCPUMetrics:N,loadMemoryMetrics:c,loadDiskMetrics:y,loadDiskIOMetrics:w,loadNetworkMetrics:t,loadProcessMetrics:n,loadAllMetrics:e,clearAllMetrics:l,setSelectedServer:async o=>{s.value!==o&&(s.value=o,l(),o&&await e(o))},updateTimeRange:o=>{I.value=o}}}function fa(s){const _=He(),g=aa(),{loading:v,serverList:u,pageInfo:f,setServerList:b,updatePagination:C}=g,r=async $=>{var I,N,c;v.value=!0;try{let y=$;!y&&((I=s==null?void 0:s.value)!=null&&I.getFormData)&&(y=s.value.getFormData()||{});const t={...y?Object.fromEntries(Object.entries(y).filter(([,e])=>e!==""&&e!==null&&e!==void 0)):{},activeFlag:"Y",...Re((N=f.value)==null?void 0:N.pageIndex,(c=f.value)==null?void 0:c.pageSize)},n=await ra(t);if(n.oK){if(n.bizData){const e=JSON.parse(n.bizData),l=Array.isArray(e)?e:[];b(l)}if(n.pageQueryData){const e=JSON.parse(n.pageQueryData);C(e)}}else _.error(n.errMsg||"查询系统节点列表失败")}catch(y){console.error("加载系统节点列表失败:",y),_.error("加载系统节点列表失败")}finally{v.value=!1}};return{model:g,loading:v,serverList:u,pageInfo:f,loadServerNodes:r,handleSearch:async $=>{f.value&&(f.value.pageIndex=1),await r($)},handlePageChange:async $=>{f.value&&($.pageIndex!==void 0&&(f.value.pageIndex=$.pageIndex),$.pageSize!==void 0&&(f.value.pageSize=$.pageSize)),await r()},getServerDetail:async $=>{try{const I=await sa($);return I.oK&&I.bizData?JSON.parse(I.bizData):(_.error(I.errMsg||"获取节点详情失败"),null)}catch(I){return console.error("获取节点详情失败:",I),_.error("获取节点详情失败"),null}}}}function ma(s,_){const g=fa(_),{model:v}=g,u=async r=>{await g.handleSearch(r)},f=r=>{console.log("Toolbar button clicked:",r)},b=async({code:r,row:k})=>{if(k)switch(r){case"view":await C(k);break;default:console.log("Unknown menu key:",r)}},C=async r=>{console.log("查看节点详情:",r);const k=await g.getServerDetail(r.metricServerId);k&&console.log("节点详情:",k)};return{model:v,service:g,handleToolbarClick:f,handleMenuClick:b,handleSearch:u}}const va=["id"],ha={key:0,class:"monitor-empty"},pa={key:1,class:"monitor-container"},ga={class:"chart-row"},ya={class:"chart-item"},wa={class:"chart-item"},ba={class:"chart-row"},Ma={class:"chart-item"},Da={class:"chart-item"},Sa={class:"chart-row"},xa={class:"chart-item"},$a={class:"chart-item"},ka=ee({name:"ServerNodeManagement",__name:"ServerNodeManagement",setup(s){const _=T(),g=T(),{model:v,service:u,handleToolbarClick:f,handleMenuClick:b,handleSearch:C}=ma(g,_),r=ua(),k=q(()=>r.selectedServerId.value&&v.serverList.value.find(w=>w.metricServerId===r.selectedServerId.value)||null),Y=async({row:w})=>{w&&w.metricServerId&&await r.setSelectedServer(w.metricServerId)},z=async w=>{w&&(r.updateTimeRange(w),await r.loadCPUMetrics())},$=async w=>{w&&(r.updateTimeRange(w),await r.loadMemoryMetrics())},I=async w=>{w&&(r.updateTimeRange(w),await r.loadDiskMetrics())},N=async w=>{w&&(r.updateTimeRange(w),await r.loadDiskIOMetrics())},c=async w=>{w&&(r.updateTimeRange(w),await r.loadNetworkMetrics())},y=async w=>{w&&(r.updateTimeRange(w),await r.loadProcessMetrics())};return(w,t)=>(A(),H("div",{class:"server-node-management",id:a(u).model.moduleId},[d(a(ke),{direction:"vertical","default-size":"300px"},{1:p(()=>[d(a(Z),null,{default:p(()=>[d(a(ke),{direction:"vertical","default-size":"80px"},{1:p(()=>[d(ze,Ie({ref_key:"searchFormRef",ref:_,"module-id":a(v).moduleId},a(v).searchFormConfig,{onSearch:a(C),onToolbarClick:a(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:p(()=>[d(a(Ae),Ie({ref_key:"gridRef",ref:g,"module-id":a(v).moduleId,data:a(v).serverList,loading:a(v).loading},a(v).gridConfig,{onPageChange:a(u).handlePageChange,onMenuClick:a(b),onRowClick:Y}),null,16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1})]),_:1})]),2:p(()=>[d(a(Z),null,{default:p(()=>[a(r).selectedServerId.value?(A(),H("div",pa,[k.value?(A(),j(a(ta),{key:0,"server-info":k.value},null,8,["server-info"])):U("",!0),h("div",ga,[h("div",ya,[d(a(je),{data:a(r).cpuMetrics.value,loading:a(r).cpuLoading.value,"warning-threshold":80,"danger-threshold":90,"cpu-detail-data":a(r).cpuMetrics.value,onRefresh:a(r).loadCPUMetrics,onTimeRangeChange:z},null,8,["data","loading","cpu-detail-data","onRefresh"])]),h("div",wa,[d(a(rt),{data:a(r).memoryMetrics.value,loading:a(r).memoryLoading.value,"warning-threshold":80,"danger-threshold":90,"memory-detail-data":a(r).memoryMetrics.value,onRefresh:a(r).loadMemoryMetrics,onTimeRangeChange:$},null,8,["data","loading","memory-detail-data","onRefresh"])])]),h("div",ba,[h("div",Ma,[d(a(dt),{data:a(r).diskMetrics.value,loading:a(r).diskLoading.value,"warning-threshold":80,"danger-threshold":90,"disk-detail-data":a(r).diskMetrics.value,onRefresh:a(r).loadDiskMetrics,onTimeRangeChange:I},null,8,["data","loading","disk-detail-data","onRefresh"])]),h("div",Da,[d(a(pt),{data:a(r).diskIOMetrics.value,loading:a(r).diskIOLoading.value,"disk-io-detail-data":a(r).diskIOMetrics.value,onRefresh:a(r).loadDiskIOMetrics,onTimeRangeChange:N},null,8,["data","loading","disk-io-detail-data","onRefresh"])])]),h("div",Sa,[h("div",xa,[d(a(Dt),{data:a(r).networkMetrics.value,loading:a(r).networkLoading.value,"network-detail-data":a(r).networkMetrics.value,"upload-color":"#ff4d4f","download-color":"#52c41a",onRefresh:a(r).loadNetworkMetrics,onTimeRangeChange:c},null,8,["data","loading","network-detail-data","onRefresh"])]),h("div",$a,[d(a(Tt),{data:a(r).processMetrics.value,loading:a(r).processLoading.value,"process-detail-data":a(r).processMetrics.value,onRefresh:a(r).loadProcessMetrics,onTimeRangeChange:y},null,8,["data","loading","process-detail-data","onRefresh"])])])])):(A(),H("div",ha,[d(a(re),{description:"请在上方列表中选择一个节点查看监控数据"})]))]),_:1})]),_:1})],8,va))}}),Ua=te(ka,[["__scopeId","data-v-0c083a3a"]]);export{Ua as default};

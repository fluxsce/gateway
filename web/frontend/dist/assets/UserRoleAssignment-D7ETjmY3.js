import{n as ve,o as Ge,q as We,Y as Ze,p as et}from"./index-CpJN9nzJ.js";import{d as D,ag as c,bo as tt,aI as $,aK as X,aJ as F,aL as me,aM as rt,E as J,aG as lt,ar as re,bi as at,I as B,b4 as st,cj as ot,ap as nt,U as ue,aQ as oe,r as _,bf as it,ay as ee,g as R,aS as ut,aU as ye,c_ as dt,bj as ct,aX as K,az as ft,aq as vt,bk as mt,bn as se,c as Y,o as L,a as de,b as ce,f as ht,R as ne,h as Ce,q,w as a,n as e,m as s,v as M,cU as ie,V as E,B as Re,C as H,cz as pt,J as A,a7 as te,ab as _e,ac as ze,t as ke,x as G,aa as we,al as gt,a0 as he,a2 as pe,a1 as bt,_ as Te,ai as xt,c$ as St,cH as yt,cI as Ct,p as Rt,a6 as _t,ao as zt}from"./index-CzIbiPcR.js";import{b as kt,_ as wt}from"./DataTable-CMD0QL_W.js";import{V as Tt,_ as Ne}from"./RadioGroup-BBKwhzSS.js";import{N as Nt}from"./DatePicker-B9xNNxDH.js";import{R as It}from"./RefreshOutline-CA3Zk8OZ.js";import{R as Ut}from"./ReloadOutline-Btqzp1-L.js";import{A as Ft}from"./AddOutline-DReI0b2u.js";import{N as Ot}from"./Thing-CRmuKLFe.js";import"./Popconfirm-Jlwr2tlU.js";const At=D({name:"Search",render(){return c("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",style:"enable-background: new 0 0 512 512"},c("path",{d:`M443.5,420.2L336.7,312.4c20.9-26.2,33.5-59.4,33.5-95.5c0-84.5-68.5-153-153.1-153S64,132.5,64,217s68.5,153,153.1,153
  c36.6,0,70.1-12.8,96.5-34.2l106.1,107.1c3.2,3.4,7.6,5.1,11.9,5.1c4.1,0,8.2-1.5,11.3-4.5C449.5,437.2,449.7,426.8,443.5,420.2z
   M217.1,337.1c-32.1,0-62.3-12.5-85-35.2c-22.7-22.7-35.2-52.9-35.2-84.9c0-32.1,12.5-62.3,35.2-84.9c22.7-22.7,52.9-35.2,85-35.2
  c32.1,0,62.3,12.5,85,35.2c22.7,22.7,35.2,52.9,35.2,84.9c0,32.1-12.5,62.3-35.2,84.9C279.4,324.6,249.2,337.1,217.1,337.1z`}))}}),W=tt("n-transfer"),Lt=$("transfer",`
 width: 100%;
 font-size: var(--n-font-size);
 height: 300px;
 display: flex;
 flex-wrap: nowrap;
 word-break: break-word;
`,[X("disabled",[$("transfer-list",[$("transfer-list-header",[F("title",`
 color: var(--n-header-text-color-disabled);
 `),F("extra",`
 color: var(--n-header-extra-text-color-disabled);
 `)])])]),$("transfer-list",`
 flex: 1;
 min-width: 0;
 height: inherit;
 display: flex;
 flex-direction: column;
 background-clip: padding-box;
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-list-color);
 `,[X("source",`
 border-top-left-radius: var(--n-border-radius);
 border-bottom-left-radius: var(--n-border-radius);
 `,[F("border","border-right: 1px solid var(--n-divider-color);")]),X("target",`
 border-top-right-radius: var(--n-border-radius);
 border-bottom-right-radius: var(--n-border-radius);
 `,[F("border","border-left: none;")]),F("border",`
 padding: 0 12px;
 border: 1px solid var(--n-border-color);
 transition: border-color .3s var(--n-bezier);
 pointer-events: none;
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 `),$("transfer-list-header",`
 min-height: var(--n-header-height);
 box-sizing: border-box;
 display: flex;
 padding: 12px 12px 10px 12px;
 align-items: center;
 background-clip: padding-box;
 border-radius: inherit;
 border-bottom-left-radius: 0;
 border-bottom-right-radius: 0;
 line-height: 1.5;
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[me("> *:not(:first-child)",`
 margin-left: 8px;
 `),F("title",`
 flex: 1;
 min-width: 0;
 line-height: 1.5;
 font-size: var(--n-header-font-size);
 font-weight: var(--n-header-font-weight);
 transition: color .3s var(--n-bezier);
 color: var(--n-header-text-color);
 `),F("button",`
 position: relative;
 `),F("extra",`
 transition: color .3s var(--n-bezier);
 font-size: var(--n-extra-font-size);
 margin-right: 0;
 white-space: nowrap;
 color: var(--n-header-extra-text-color);
 `)]),$("transfer-list-body",`
 flex-basis: 0;
 flex-grow: 1;
 box-sizing: border-box;
 position: relative;
 display: flex;
 flex-direction: column;
 border-radius: inherit;
 border-top-left-radius: 0;
 border-top-right-radius: 0;
 `,[$("transfer-filter",`
 padding: 4px 12px 8px 12px;
 box-sizing: border-box;
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),$("transfer-list-flex-container",`
 flex: 1;
 position: relative;
 `,[$("scrollbar",`
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 height: unset;
 `),$("empty",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateY(-50%) translateX(-50%);
 `),$("transfer-list-content",`
 padding: 0;
 margin: 0;
 position: relative;
 `,[$("transfer-list-item",`
 padding: 0 12px;
 min-height: var(--n-item-height);
 display: flex;
 align-items: center;
 color: var(--n-item-text-color);
 position: relative;
 transition: color .3s var(--n-bezier);
 `,[F("background",`
 position: absolute;
 left: 4px;
 right: 4px;
 top: 0;
 bottom: 0;
 border-radius: var(--n-border-radius);
 transition: background-color .3s var(--n-bezier);
 `),F("checkbox",`
 position: relative;
 margin-right: 8px;
 `),F("close",`
 opacity: 0;
 pointer-events: none;
 position: relative;
 transition:
 opacity .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 `),F("label",`
 position: relative;
 min-width: 0;
 flex-grow: 1;
 `),X("source","cursor: pointer;"),X("disabled",`
 cursor: not-allowed;
 color: var(--n-item-text-color-disabled);
 `),rt("disabled",[me("&:hover",[F("background","background-color: var(--n-item-color-pending);"),F("close",`
 opacity: 1;
 pointer-events: all;
 `)])])])])])])])]),ge=D({name:"TransferFilter",props:{value:String,placeholder:String,disabled:Boolean,onUpdateValue:{type:Function,required:!0}},setup(){const{mergedThemeRef:r,mergedClsPrefixRef:d}=re(W);return{mergedClsPrefix:d,mergedTheme:r}},render(){const{mergedTheme:r,mergedClsPrefix:d}=this;return c("div",{class:`${d}-transfer-filter`},c(J,{value:this.value,onUpdateValue:this.onUpdateValue,disabled:this.disabled,placeholder:this.placeholder,theme:r.peers.Input,themeOverrides:r.peerOverrides.Input,clearable:!0,size:"small"},{"clear-icon-placeholder":()=>c(lt,{clsPrefix:d},{default:()=>c(At,null)})}))}}),be=D({name:"TransferHeader",props:{size:{type:String,required:!0},selectAllText:String,clearText:String,source:Boolean,onCheckedAll:Function,onClearAll:Function,title:[String,Function]},setup(r){const{targetOptionsRef:d,canNotSelectAnythingRef:n,canBeClearedRef:i,allCheckedRef:f,mergedThemeRef:h,disabledRef:b,mergedClsPrefixRef:u,srcOptionsLengthRef:S}=re(W),{localeRef:y}=at("Transfer");return()=>{const{source:g,onClearAll:p,onCheckedAll:w,selectAllText:T,clearText:O}=r,{value:k}=h,{value:z}=u,{value:U}=y,v=r.size==="large"?"small":"tiny",{title:x}=r;return c("div",{class:`${z}-transfer-list-header`},x&&c("div",{class:`${z}-transfer-list-header__title`},typeof x=="function"?x():x),g&&c(B,{class:`${z}-transfer-list-header__button`,theme:k.peers.Button,themeOverrides:k.peerOverrides.Button,size:v,tertiary:!0,onClick:f.value?p:w,disabled:n.value||b.value},{default:()=>f.value?O||U.unselectAll:T||U.selectAll}),!g&&i.value&&c(B,{class:`${z}-transfer-list-header__button`,theme:k.peers.Button,themeOverrides:k.peerOverrides.Button,size:v,tertiary:!0,onClick:p,disabled:b.value},{default:()=>U.clearAll}),c("div",{class:`${z}-transfer-list-header__extra`},g?U.total(S.value):U.selected(d.value.length)))}}}),xe=D({name:"NTransferListItem",props:{source:Boolean,label:{type:String,required:!0},value:{type:[String,Number],required:!0},disabled:Boolean,option:{type:Object,required:!0}},setup(r){const{targetValueSetRef:d,mergedClsPrefixRef:n,mergedThemeRef:i,handleItemCheck:f,renderSourceLabelRef:h,renderTargetLabelRef:b,showSelectedRef:u}=re(W),S=nt(()=>d.value.has(r.value));function y(){r.disabled||f(!S.value,r.value)}return{mergedClsPrefix:n,mergedTheme:i,checked:S,showSelected:u,renderSourceLabel:h,renderTargetLabel:b,handleClick:y}},render(){const{disabled:r,mergedTheme:d,mergedClsPrefix:n,label:i,checked:f,source:h,renderSourceLabel:b,renderTargetLabel:u}=this;return c("div",{class:[`${n}-transfer-list-item`,r&&`${n}-transfer-list-item--disabled`,h?`${n}-transfer-list-item--source`:`${n}-transfer-list-item--target`],onClick:h?this.handleClick:void 0},c("div",{class:`${n}-transfer-list-item__background`}),h&&this.showSelected&&c("div",{class:`${n}-transfer-list-item__checkbox`},c(kt,{theme:d.peers.Checkbox,themeOverrides:d.peerOverrides.Checkbox,disabled:r,checked:f})),c("div",{class:`${n}-transfer-list-item__label`,title:st(i)},h?b?b({option:this.option}):i:u?u({option:this.option}):i),!h&&!r&&c(ot,{focusable:!1,class:`${n}-transfer-list-item__close`,clsPrefix:n,onClick:this.handleClick}))}}),Se=D({name:"TransferList",props:{virtualScroll:{type:Boolean,required:!0},itemSize:{type:Number,required:!0},options:{type:Array,required:!0},disabled:{type:Boolean,required:!0},source:Boolean},setup(){const{mergedThemeRef:r,mergedClsPrefixRef:d}=re(W),n=_(null),i=_(null);function f(){var u;(u=n.value)===null||u===void 0||u.sync()}function h(){const{value:u}=i;if(!u)return null;const{listElRef:S}=u;return S}function b(){const{value:u}=i;if(!u)return null;const{itemsElRef:S}=u;return S}return{mergedTheme:r,mergedClsPrefix:d,scrollerInstRef:n,vlInstRef:i,syncVLScroller:f,scrollContainer:h,scrollContent:b}},render(){const{mergedTheme:r,options:d}=this;if(d.length===0)return c(ue,{theme:r.peers.Empty,themeOverrides:r.peerOverrides.Empty});const{mergedClsPrefix:n,virtualScroll:i,source:f,disabled:h,syncVLScroller:b}=this;return c(oe,{ref:"scrollerInstRef",theme:r.peers.Scrollbar,themeOverrides:r.peerOverrides.Scrollbar,container:i?this.scrollContainer:void 0,content:i?this.scrollContent:void 0},{default:()=>i?c(Tt,{ref:"vlInstRef",style:{height:"100%"},class:`${n}-transfer-list-content`,items:this.options,itemSize:this.itemSize,showScrollbar:!1,onResize:b,onScroll:b,keyField:"value"},{default:({item:u})=>{const{source:S,disabled:y}=this;return c(xe,{source:S,key:u.value,value:u.value,disabled:u.disabled||y,label:u.label,option:u})}}):c("div",{class:`${n}-transfer-list-content`},d.map(u=>c(xe,{source:f,key:u.value,value:u.value,disabled:u.disabled||h,label:u.label,option:u})))})}});function $t(r){const d=_(r.defaultValue),n=it(ee(r,"value"),d),i=R(()=>{const o=new Map;return(r.options||[]).forEach(m=>o.set(m.value,m)),o}),f=R(()=>new Set(n.value||[])),h=R(()=>{const o=i.value,m=[];return(n.value||[]).forEach(P=>{const t=o.get(P);t&&m.push(t)}),m}),b=_(""),u=_(""),S=R(()=>r.sourceFilterable||!!r.filterable),y=R(()=>{const{showSelected:o,options:m,filter:P}=r;return S.value?m.filter(t=>P(b.value,t,"source")&&(o||!f.value.has(t.value))):o?m:m.filter(t=>!f.value.has(t.value))}),g=R(()=>{if(!r.targetFilterable)return h.value;const{filter:o}=r;return h.value.filter(m=>o(u.value,m,"target"))}),p=R(()=>{const{value:o}=n;return o===null?new Set:new Set(o)}),w=R(()=>{const o=new Set(p.value);return y.value.forEach(m=>{!m.disabled&&!o.has(m.value)&&o.add(m.value)}),o}),T=R(()=>{const o=new Set(p.value);return y.value.forEach(m=>{!m.disabled&&o.has(m.value)&&o.delete(m.value)}),o}),O=R(()=>{const o=new Set(p.value);return g.value.forEach(m=>{m.disabled||o.delete(m.value)}),o}),k=R(()=>y.value.every(o=>o.disabled)),z=R(()=>{if(!y.value.length)return!1;const o=p.value;return y.value.every(m=>m.disabled||o.has(m.value))}),U=R(()=>g.value.some(o=>!o.disabled));function v(o){b.value=o??""}function x(o){u.value=o??""}return{uncontrolledValueRef:d,mergedValueRef:n,targetValueSetRef:f,valueSetForCheckAllRef:w,valueSetForUncheckAllRef:T,valueSetForClearRef:O,filteredTgtOptionsRef:g,filteredSrcOptionsRef:y,targetOptionsRef:h,canNotSelectAnythingRef:k,canBeClearedRef:U,allCheckedRef:z,srcPatternRef:b,tgtPatternRef:u,mergedSrcFilterableRef:S,handleSrcFilterUpdateValue:v,handleTgtFilterUpdateValue:x}}const Pt=Object.assign(Object.assign({},ye.props),{value:Array,defaultValue:{type:Array,default:null},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:void 0},virtualScroll:Boolean,sourceTitle:[String,Function],selectAllText:String,clearText:String,targetTitle:[String,Function],filterable:{type:Boolean,default:void 0},sourceFilterable:Boolean,targetFilterable:Boolean,showSelected:{type:Boolean,default:!0},sourceFilterPlaceholder:String,targetFilterPlaceholder:String,filter:{type:Function,default:(r,d)=>r?~`${d.label}`.toLowerCase().indexOf(`${r}`.toLowerCase()):!0},size:String,renderSourceLabel:Function,renderTargetLabel:Function,renderSourceList:Function,renderTargetList:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),Vt=D({name:"Transfer",props:Pt,setup(r){const{mergedClsPrefixRef:d}=ut(r),n=ye("Transfer","-transfer",Lt,dt,r,d),i=ct(r),{mergedSizeRef:f,mergedDisabledRef:h}=i,b=R(()=>{const{value:I}=f,{self:{[K("itemHeight",I)]:V}}=n.value;return ft(V)}),{uncontrolledValueRef:u,mergedValueRef:S,targetValueSetRef:y,valueSetForCheckAllRef:g,valueSetForUncheckAllRef:p,valueSetForClearRef:w,filteredTgtOptionsRef:T,filteredSrcOptionsRef:O,targetOptionsRef:k,canNotSelectAnythingRef:z,canBeClearedRef:U,allCheckedRef:v,srcPatternRef:x,tgtPatternRef:o,mergedSrcFilterableRef:m,handleSrcFilterUpdateValue:P,handleTgtFilterUpdateValue:t}=$t(r);function l(I){const{onUpdateValue:V,"onUpdate:value":j,onChange:Z}=r,{nTriggerFormInput:le,nTriggerFormChange:ae}=i;V&&se(V,I),j&&se(j,I),Z&&se(Z,I),u.value=I,le(),ae()}function N(){l([...g.value])}function C(){l([...p.value])}function Q(){l([...w.value])}function fe(I,V){l(I?(S.value||[]).concat(V):(S.value||[]).filter(j=>j!==V))}function Ie(I){l(I)}return vt(W,{targetValueSetRef:y,mergedClsPrefixRef:d,disabledRef:h,mergedThemeRef:n,targetOptionsRef:k,canNotSelectAnythingRef:z,canBeClearedRef:U,allCheckedRef:v,srcOptionsLengthRef:R(()=>r.options.length),handleItemCheck:fe,renderSourceLabelRef:ee(r,"renderSourceLabel"),renderTargetLabelRef:ee(r,"renderTargetLabel"),showSelectedRef:ee(r,"showSelected")}),{mergedClsPrefix:d,mergedDisabled:h,itemSize:b,isMounted:mt(),mergedTheme:n,filteredSrcOpts:O,filteredTgtOpts:T,srcPattern:x,tgtPattern:o,mergedSize:f,mergedSrcFilterable:m,handleSrcFilterUpdateValue:P,handleTgtFilterUpdateValue:t,handleSourceCheckAll:N,handleSourceUncheckAll:C,handleTargetClearAll:Q,handleItemCheck:fe,handleChecked:Ie,cssVars:R(()=>{const{value:I}=f,{common:{cubicBezierEaseInOut:V},self:{borderRadius:j,borderColor:Z,listColor:le,titleTextColor:ae,titleTextColorDisabled:Ue,extraTextColor:Fe,itemTextColor:Oe,itemColorPending:Ae,itemTextColorDisabled:Le,titleFontWeight:$e,closeColorHover:Pe,closeColorPressed:Ve,closeIconColor:Be,closeIconColorHover:De,closeIconColorPressed:Me,closeIconSize:qe,closeSize:Ee,dividerColor:He,extraTextColorDisabled:je,[K("extraFontSize",I)]:Ke,[K("fontSize",I)]:Ye,[K("titleFontSize",I)]:Je,[K("itemHeight",I)]:Qe,[K("headerHeight",I)]:Xe}}=n.value;return{"--n-bezier":V,"--n-border-color":Z,"--n-border-radius":j,"--n-extra-font-size":Ke,"--n-font-size":Ye,"--n-header-font-size":Je,"--n-header-extra-text-color":Fe,"--n-header-extra-text-color-disabled":je,"--n-header-font-weight":$e,"--n-header-text-color":ae,"--n-header-text-color-disabled":Ue,"--n-item-color-pending":Ae,"--n-item-height":Qe,"--n-item-text-color":Oe,"--n-item-text-color-disabled":Le,"--n-list-color":le,"--n-header-height":Xe,"--n-close-size":Ee,"--n-close-icon-size":qe,"--n-close-color-hover":Pe,"--n-close-color-pressed":Ve,"--n-close-icon-color":Be,"--n-close-icon-color-hover":De,"--n-close-icon-color-pressed":Me,"--n-divider-color":He}})}},render(){const{mergedClsPrefix:r,renderSourceList:d,renderTargetList:n,mergedTheme:i,mergedSrcFilterable:f,targetFilterable:h}=this;return c("div",{class:[`${r}-transfer`,this.mergedDisabled&&`${r}-transfer--disabled`],style:this.cssVars},c("div",{class:`${r}-transfer-list ${r}-transfer-list--source`},c(be,{source:!0,selectAllText:this.selectAllText,clearText:this.clearText,title:this.sourceTitle,onCheckedAll:this.handleSourceCheckAll,onClearAll:this.handleSourceUncheckAll,size:this.mergedSize}),c("div",{class:`${r}-transfer-list-body`},f?c(ge,{onUpdateValue:this.handleSrcFilterUpdateValue,value:this.srcPattern,disabled:this.mergedDisabled,placeholder:this.sourceFilterPlaceholder}):null,c("div",{class:`${r}-transfer-list-flex-container`},d?c(oe,{theme:i.peers.Scrollbar,themeOverrides:i.peerOverrides.Scrollbar},{default:()=>d({onCheck:this.handleChecked,checkedOptions:this.filteredTgtOpts,pattern:this.srcPattern})}):c(Se,{source:!0,options:this.filteredSrcOpts,disabled:this.mergedDisabled,virtualScroll:this.virtualScroll,itemSize:this.itemSize}))),c("div",{class:`${r}-transfer-list__border`})),c("div",{class:`${r}-transfer-list ${r}-transfer-list--target`},c(be,{onClearAll:this.handleTargetClearAll,size:this.mergedSize,title:this.targetTitle}),c("div",{class:`${r}-transfer-list-body`},h?c(ge,{onUpdateValue:this.handleTgtFilterUpdateValue,value:this.tgtPattern,disabled:this.mergedDisabled,placeholder:this.sourceFilterPlaceholder}):null,c("div",{class:`${r}-transfer-list-flex-container`},n?c(oe,{theme:i.peers.Scrollbar,themeOverrides:i.peerOverrides.Scrollbar},{default:()=>n({onCheck:this.handleChecked,checkedOptions:this.filteredTgtOpts,pattern:this.tgtPattern})}):c(Se,{options:this.filteredTgtOpts,disabled:this.mergedDisabled,virtualScroll:this.virtualScroll,itemSize:this.itemSize}))),c("div",{class:`${r}-transfer-list__border`})))}}),Bt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Dt=D({name:"StarOutline",render:function(d,n){return L(),Y("svg",Bt,n[0]||(n[0]=[de("path",{d:"M480 208H308L256 48l-52 160H32l140 96l-54 160l138-100l138 100l-54-160z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}});function Mt(){const r=ce(),d=ht({userName:"",roleName:"",primaryRoleFlag:void 0}),n=_([]),i=_(""),f=_(void 0),h=_([]),b=_(!1),u=_({}),S=R(()=>i.value?n.value.filter(v=>{var x,o;return v.userName.toLowerCase().includes(i.value.toLowerCase())||((x=v.realName)==null?void 0:x.toLowerCase().includes(i.value.toLowerCase()))||((o=v.email)==null?void 0:o.toLowerCase().includes(i.value.toLowerCase()))}):n.value),y=R(()=>h.value.map(v=>v.roleId)),g=v=>u.value[v]||0,p=async()=>{try{n.value=[{userId:"user1",userName:"admin",realName:"系统管理员",email:"admin@example.com",status:"Y"},{userId:"user2",userName:"zhangsan",realName:"张三",email:"zhangsan@example.com",status:"Y"},{userId:"user3",userName:"lisi",realName:"李四",email:"lisi@example.com",status:"Y"},{userId:"user4",userName:"wangwu",realName:"王五",email:"wangwu@example.com",status:"Y"}],await w()}catch(v){console.error("加载用户列表失败:",v),r.error("获取用户列表失败")}},w=async()=>{try{const v={};for(const x of n.value)try{const o=await ve(x.userId);if(o.oK&&o.bizData){const m=Array.isArray(o.bizData)?o.bizData:JSON.parse(o.bizData);v[x.userId]=m.length}}catch{v[x.userId]=0}u.value=v}catch(v){console.error("加载用户角色数量失败:",v)}},T=async v=>{try{b.value=!0;const x=await ve(v);if(x.oK&&x.bizData){const o=Array.isArray(x.bizData)?x.bizData:JSON.parse(x.bizData);h.value=o}else r.error(x.errMsg||"获取用户角色失败"),h.value=[]}catch(x){console.error("加载用户角色失败:",x),r.error("获取用户角色失败"),h.value=[]}finally{b.value=!1}},O=()=>{},k=()=>{Object.assign(d,{userName:"",roleName:"",primaryRoleFlag:void 0}),i.value=""},z=()=>{p(),f.value&&T(f.value.userId)},U=v=>{f.value=v,T(v.userId)};return ne(()=>f.value,v=>{v?T(v.userId):h.value=[]}),{queryParams:d,userList:n,userSearchKeyword:i,selectedUser:f,selectedUserRoles:h,userRolesLoading:b,userRoleCountMap:u,filteredUserList:S,assignedRoleIds:y,getUserRoleCount:g,loadUserList:p,loadUserRoleCount:w,loadSelectedUserRoles:T,handleSearch:O,resetQuery:k,handleRefresh:z,handleSelectUser:U}}const qt={class:"assign-content"},Et=D({__name:"UserRoleAssignDialog",props:{visible:{type:Boolean,default:!1},userInfo:{default:()=>({userId:"",userName:""})},assignedRoleIds:{default:()=>[]}},emits:["update:visible","success"],setup(r,{emit:d}){const n=r,i=d,f=ce(),h=_(),b=_(!1),u=_(!1),S=_([]),y=_(""),g=_([]),p=_(""),w=_(null),T=_(""),O=R({get:()=>n.visible,set:t=>i("update:visible",t)}),k=R(()=>S.value.filter(t=>y.value?t.roleName.toLowerCase().includes(y.value.toLowerCase())||t.roleCode.toLowerCase().includes(y.value.toLowerCase()):!0).map(t=>({label:`${t.roleName} (${t.roleCode})`,value:t.roleId,disabled:t.roleStatus==="N"}))),z=R(()=>g.value.map(t=>{const l=S.value.find(N=>N.roleId===t);return{label:l?`${l.roleName} (${l.roleCode})`:t,value:t}})),U=t=>{const l=S.value.find(N=>N.roleId===t);return l?`${l.roleName} (${l.roleCode})`:t},v=async()=>{try{u.value=!0;const t=await We({roleStatus:"Y",pageSize:1e3});if(he(t)){const l=bt(t,[]);S.value=l.filter(N=>N.roleStatus==="Y")}else f.error(pe(t,"获取角色列表失败"))}catch(t){console.error("加载角色列表失败:",t),f.error("获取角色列表失败")}finally{u.value=!1}},x=t=>{const l=g.value.indexOf(t);l>-1&&g.value.splice(l,1),p.value===t&&(p.value="")},o=()=>{m(),O.value=!1},m=()=>{g.value=[],p.value="",w.value=null,T.value="",y.value=""},P=async()=>{var t;if(!((t=n.userInfo)!=null&&t.userId)){f.error("用户信息不完整");return}if(g.value.length===0){f.warning("请选择要分配的角色");return}try{b.value=!0;const l={userId:n.userInfo.userId,roleIds:g.value,primaryRoleId:p.value||void 0,expireTime:w.value?new Date(w.value).toISOString():void 0},N=await Ge(n.userInfo.userId,g.value,p.value||void 0);he(N)?(f.success("角色分配成功"),i("success")):f.error(pe(N,"角色分配失败"))}catch(l){console.error("角色分配失败:",l),f.error("角色分配失败")}finally{b.value=!1}};return ne(()=>n.visible,async t=>{t?(await v(),g.value=[...n.assignedRoleIds||[]],g.value.length===1&&(p.value=g.value[0])):m()}),ne(()=>g.value,t=>{p.value&&!t.includes(p.value)&&(p.value=""),t.length===1&&!p.value&&(p.value=t[0])}),Ce(()=>{}),(t,l)=>{var N;return L(),q(e(gt),{show:O.value,"onUpdate:show":l[5]||(l[5]=C=>O.value=C),"mask-closable":!1,preset:"dialog",title:`分配角色 - ${(N=t.userInfo)==null?void 0:N.userName}`,class:"user-role-assign-dialog",style:{width:"700px"}},{action:a(()=>[s(e(te),null,{default:a(()=>[s(e(B),{onClick:o},{default:a(()=>l[7]||(l[7]=[A("取消")])),_:1}),s(e(B),{type:"primary",loading:b.value,onClick:P},{default:a(()=>l[8]||(l[8]=[A(" 确认分配 ")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[de("div",qt,[s(e(E),{size:"small",title:"选择角色",class:"role-select-card"},{"header-extra":a(()=>[s(e(J),{value:y.value,"onUpdate:value":l[0]||(l[0]=C=>y.value=C),placeholder:"搜索角色",size:"small",style:{width:"200px"},clearable:""},{prefix:a(()=>[s(e(M),null,{default:a(()=>[s(e(ie))]),_:1})]),_:1},8,["value"])]),default:a(()=>[s(e(Vt),{ref_key:"transferRef",ref:h,value:g.value,"onUpdate:value":l[1]||(l[1]=C=>g.value=C),options:k.value,"source-title":"可选角色","target-title":"已选角色","source-filterable":!0,"target-filterable":!0,style:{height:"350px"}},null,8,["value","options"])]),_:1}),s(e(E),{size:"small",title:"角色设置",class:"role-settings-card"},{default:a(()=>[s(e(Re),{"label-placement":"left","label-width":"120px"},{default:a(()=>[s(e(H),{label:"主要角色"},{feedback:a(()=>[s(e(pt),{depth:"3",style:{"font-size":"12px"}},{default:a(()=>l[6]||(l[6]=[A(" 主要角色用于确定用户的默认权限和数据范围 ")])),_:1})]),default:a(()=>[s(e(Ne),{value:p.value,"onUpdate:value":l[2]||(l[2]=C=>p.value=C),placeholder:"请选择主要角色",options:z.value,clearable:""},null,8,["value","options"])]),_:1}),s(e(H),{label:"过期时间"},{default:a(()=>[s(e(Nt),{value:w.value,"onUpdate:value":l[3]||(l[3]=C=>w.value=C),type:"datetime",placeholder:"选择过期时间，不选择表示永不过期",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),s(e(H),{label:"备注信息"},{default:a(()=>[s(e(J),{value:T.value,"onUpdate:value":l[4]||(l[4]=C=>T.value=C),type:"textarea",placeholder:"请输入备注信息",rows:3,maxlength:"500","show-count":""},null,8,["value"])]),_:1})]),_:1})]),_:1}),s(e(E),{size:"small",title:"角色预览",class:"role-preview-card"},{default:a(()=>[g.value.length>0?(L(),q(e(te),{key:0,size:"small"},{default:a(()=>[(L(!0),Y(we,null,_e(g.value,C=>(L(),q(e(ze),{key:C,type:C===p.value?"success":"default",closable:"",onClose:Q=>x(C)},{default:a(()=>[A(G(U(C))+" ",1),C===p.value?(L(),q(e(M),{key:0,style:{"margin-left":"4px"}},{default:a(()=>[s(e(Dt))]),_:1})):ke("",!0)]),_:2},1032,["type","onClose"]))),128))]),_:1})):(L(),q(e(ue),{key:1,description:"暂未选择任何角色",size:"small"}))]),_:1})])]),_:1},8,["show","title"])}}}),Ht=Te(Et,[["__scopeId","data-v-7101e8ea"]]),jt={class:"user-role-assignment-container"},Kt={class:"content-layout"},Yt={key:0,class:"empty-state"},Jt={key:1},Qt=D({__name:"UserRoleAssignment",setup(r){const{queryParams:d,userSearchKeyword:n,selectedUser:i,selectedUserRoles:f,userRolesLoading:h,filteredUserList:b,assignedRoleIds:u,getUserRoleCount:S,loadUserList:y,loadUserRoleCount:g,handleSearch:p,resetQuery:w,handleRefresh:T,handleSelectUser:O}=Mt(),k=ce(),z=_(!1),U=et(o),v=()=>{if(!i.value){k.warning("请先选择用户");return}z.value=!0},x=()=>{if(!i.value){k.warning("请先选择用户");return}z.value=!0};function o(P){k.info("撤销角色功能待实现")}const m=()=>{z.value=!1,i.value&&g(),k.success("角色分配成功")};return Ce(()=>{y()}),(P,t)=>(L(),Y("div",jt,[s(e(E),{size:"small",class:"search-card"},{default:a(()=>[s(e(Re),{inline:"",model:e(d),"label-placement":"left"},{default:a(()=>[s(e(H),{label:"用户名"},{default:a(()=>[s(e(J),{value:e(d).userName,"onUpdate:value":t[0]||(t[0]=l=>e(d).userName=l),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),s(e(H),{label:"角色名称"},{default:a(()=>[s(e(J),{value:e(d).roleName,"onUpdate:value":t[1]||(t[1]=l=>e(d).roleName=l),placeholder:"请输入角色名称",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),s(e(H),{label:"主要角色"},{default:a(()=>[s(e(Ne),{value:e(d).primaryRoleFlag,"onUpdate:value":t[2]||(t[2]=l=>e(d).primaryRoleFlag=l),placeholder:"请选择",clearable:"",style:{width:"120px"},options:e(Ze)},null,8,["value","options"])]),_:1}),s(e(H),null,{default:a(()=>[s(e(B),{type:"primary",onClick:e(p)},{icon:a(()=>[s(e(M),null,{default:a(()=>[s(e(ie))]),_:1})]),default:a(()=>[t[5]||(t[5]=A(" 搜索 "))]),_:1},8,["onClick"]),s(e(B),{onClick:e(w),style:{"margin-left":"8px"}},{icon:a(()=>[s(e(M),null,{default:a(()=>[s(e(It))]),_:1})]),default:a(()=>[t[6]||(t[6]=A(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),s(e(E),{size:"small",class:"action-card"},{default:a(()=>[s(e(te),null,{default:a(()=>[s(e(B),{type:"primary",onClick:v},{icon:a(()=>[s(e(M),null,{default:a(()=>[s(e(St))]),_:1})]),default:a(()=>[t[7]||(t[7]=A(" 分配角色 "))]),_:1}),s(e(B),{onClick:e(T)},{icon:a(()=>[s(e(M),null,{default:a(()=>[s(e(Ut))]),_:1})]),default:a(()=>[t[8]||(t[8]=A(" 刷新 "))]),_:1},8,["onClick"])]),_:1})]),_:1}),de("div",Kt,[s(e(E),{size:"small",class:"user-list-card",title:"用户列表"},{"header-extra":a(()=>[s(e(J),{value:e(n),"onUpdate:value":t[3]||(t[3]=l=>zt(n)?n.value=l:null),placeholder:"搜索用户",size:"small",style:{width:"200px"},clearable:""},{prefix:a(()=>[s(e(M),null,{default:a(()=>[s(e(ie))]),_:1})]),_:1},8,["value"])]),default:a(()=>[s(e(yt),{hoverable:"",clickable:"",style:{height:"400px","overflow-y":"auto"}},{default:a(()=>[(L(!0),Y(we,null,_e(e(b),l=>{var N;return L(),q(e(Ct),{key:l.userId,class:Rt({"selected-user":((N=e(i))==null?void 0:N.userId)===l.userId}),onClick:C=>e(O)(l)},{prefix:a(()=>[s(e(_t),{size:"small",src:l.avatar},{default:a(()=>{var C,Q;return[A(G((Q=(C=l.userName)==null?void 0:C.charAt(0))==null?void 0:Q.toUpperCase()),1)]}),_:2},1032,["src"])]),suffix:a(()=>[e(S)(l.userId)>0?(L(),q(e(ze),{key:0,size:"small",type:"info"},{default:a(()=>[A(G(e(S)(l.userId))+" 个角色 ",1)]),_:2},1024)):ke("",!0)]),default:a(()=>[s(e(Ot),null,{header:a(()=>[A(G(l.userName),1)]),description:a(()=>[A(G(l.realName||l.email),1)]),_:2},1024)]),_:2},1032,["class","onClick"])}),128))]),_:1})]),_:1}),s(e(E),{size:"small",class:"user-roles-card",title:e(i)?`${e(i).userName} 的角色`:"请选择用户"},xt({default:a(()=>[e(i)?(L(),Y("div",Jt,[s(e(wt),{columns:e(U),data:e(f),loading:e(h),pagination:!1,"row-key":l=>l.userRoleId,size:"small",style:{height:"350px"}},null,8,["columns","data","loading","row-key"])])):(L(),Y("div",Yt,[s(e(ue),{description:"请从左侧选择用户查看其角色信息"})]))]),_:2},[e(i)?{name:"header-extra",fn:a(()=>[s(e(te),null,{default:a(()=>[s(e(B),{size:"small",type:"primary",onClick:x},{icon:a(()=>[s(e(M),null,{default:a(()=>[s(e(Ft))]),_:1})]),default:a(()=>[t[9]||(t[9]=A(" 分配角色 "))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["title"])]),s(Ht,{visible:z.value,"onUpdate:visible":t[4]||(t[4]=l=>z.value=l),"user-info":e(i),"assigned-role-ids":e(u),onSuccess:m},null,8,["visible","user-info","assigned-role-ids"])]))}}),or=Te(Qt,[["__scopeId","data-v-029e6694"]]);export{or as default};

import{c as he,G as ve,S as we}from"./SearchForm-DOzvGtXJ.js";import{G as be}from"./GPane-DHnn83Ms.js";import{d as z,T as D,P as A,Q as P,S as q,R as x,aA as ye,cf as xe,V as re,r as E,Y as Le,W as ne,aF as oe,Z as Ce,j as M,dC as De,bm as Se,aj as Te,a1 as G,cg as Ie,aY as Ne,dD as _e,a3 as se,aZ as Ae,bp as X,dE as Ee,bN as Re,ai as Pe,bq as Oe,ak as Me,aH as ee,ay as ke,bF as ze,af as Fe,m as Q,a7 as te,g as R,w as f,e as a,o as N,b as h,c as ie,h as k,a9 as V,bW as $e,bX as I,K as S,t as L,aO as U,aa as O,f as ae,ab as Be,I as Ge,z as F,A as H,B as $,_ as de,d4 as Ve,cr as We,am as le}from"./index-C7VF8QMM.js";import{G as je}from"./GModal-4zQmqt5p.js";import{G as W}from"./GTextShow-C5URiO0a.js";import{c as Ue}from"./index-SEUNGW2H.js";import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-D5LxWsgC.js";import{u as Je}from"./useGDialog-C5wX4kUM.js";import{T as Ye}from"./TrashOutline-CTPgiVU8.js";import"./RefreshOutline-CT5KkffG.js";import"./Select-DHkKeUGd.js";import"./ContractOutline-BylC79iI.js";import"./CloseOutline-BGym3E2W.js";import"./CopyOutline-sNsm9t-M.js";import"./CodeOutline-DwxJ-jKw.js";import"./GDialog-C6larSix.js";const qe=z({name:"ChevronLeft",render(){return D("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},D("path",{d:"M10.3536 3.14645C10.5488 3.34171 10.5488 3.65829 10.3536 3.85355L6.20711 8L10.3536 12.1464C10.5488 12.3417 10.5488 12.6583 10.3536 12.8536C10.1583 13.0488 9.84171 13.0488 9.64645 12.8536L5.14645 8.35355C4.95118 8.15829 4.95118 7.84171 5.14645 7.64645L9.64645 3.14645C9.84171 2.95118 10.1583 2.95118 10.3536 3.14645Z",fill:"currentColor"}))}}),He=A("collapse","width: 100%;",[A("collapse-item",`
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition:
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 margin: var(--n-item-margin);
 `,[P("disabled",[x("header","cursor: not-allowed;",[x("header-main",`
 color: var(--n-title-text-color-disabled);
 `),A("collapse-item-arrow",`
 color: var(--n-arrow-color-disabled);
 `)])]),A("collapse-item","margin-left: 32px;"),q("&:first-child","margin-top: 0;"),q("&:first-child >",[x("header","padding-top: 0;")]),P("left-arrow-placement",[x("header",[A("collapse-item-arrow","margin-right: 4px;")])]),P("right-arrow-placement",[x("header",[A("collapse-item-arrow","margin-left: 4px;")])]),x("content-wrapper",[x("content-inner","padding-top: 16px;"),xe({duration:"0.15s"})]),P("active",[x("header",[P("active",[A("collapse-item-arrow","transform: rotate(90deg);")])])]),q("&:not(:first-child)","border-top: 1px solid var(--n-divider-color);"),ye("disabled",[P("trigger-area-main",[x("header",[x("header-main","cursor: pointer;"),A("collapse-item-arrow","cursor: default;")])]),P("trigger-area-arrow",[x("header",[A("collapse-item-arrow","cursor: pointer;")])]),P("trigger-area-extra",[x("header",[x("header-extra","cursor: pointer;")])])]),x("header",`
 font-size: var(--n-title-font-size);
 display: flex;
 flex-wrap: nowrap;
 align-items: center;
 transition: color .3s var(--n-bezier);
 position: relative;
 padding: var(--n-title-padding);
 color: var(--n-title-text-color);
 `,[x("header-main",`
 display: flex;
 flex-wrap: nowrap;
 align-items: center;
 font-weight: var(--n-title-font-weight);
 transition: color .3s var(--n-bezier);
 flex: 1;
 color: var(--n-title-text-color);
 `),x("header-extra",`
 display: flex;
 align-items: center;
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 `),A("collapse-item-arrow",`
 display: flex;
 transition:
 transform .15s var(--n-bezier),
 color .3s var(--n-bezier);
 font-size: 18px;
 color: var(--n-arrow-color);
 `)])])]),Ke=Object.assign(Object.assign({},ne.props),{defaultExpandedNames:{type:[Array,String],default:null},expandedNames:[Array,String],arrowPlacement:{type:String,default:"left"},accordion:{type:Boolean,default:!1},displayDirective:{type:String,default:"if"},triggerAreas:{type:Array,default:()=>["main","extra","arrow"]},onItemHeaderClick:[Function,Array],"onUpdate:expandedNames":[Function,Array],onUpdateExpandedNames:[Function,Array],onExpandedNamesChange:{type:[Function,Array],validator:()=>!0,default:void 0}}),ce=Se("n-collapse"),Ze=z({name:"Collapse",props:Ke,slots:Object,setup(n,{slots:g}){const{mergedClsPrefixRef:r,inlineThemeDisabled:s,mergedRtlRef:v}=re(n),p=E(n.defaultExpandedNames),l=M(()=>n.expandedNames),w=Le(l,p),i=ne("Collapse","-collapse",He,De,n,r);function b(c){const{"onUpdate:expandedNames":e,onUpdateExpandedNames:t,onExpandedNamesChange:u}=n;t&&G(t,c),e&&G(e,c),u&&G(u,c),p.value=c}function y(c){const{onItemHeaderClick:e}=n;e&&G(e,c)}function o(c,e,t){const{accordion:u}=n,{value:T}=w;if(u)c?(b([e]),y({name:e,expanded:!0,event:t})):(b([]),y({name:e,expanded:!1,event:t}));else if(!Array.isArray(T))b([e]),y({name:e,expanded:!0,event:t});else{const _=T.slice(),B=_.findIndex(Y=>e===Y);~B?(_.splice(B,1),b(_),y({name:e,expanded:!1,event:t})):(_.push(e),b(_),y({name:e,expanded:!0,event:t}))}}Te(ce,{props:n,mergedClsPrefixRef:r,expandedNamesRef:w,slots:g,toggleItem:o});const m=oe("Collapse",v,r),C=M(()=>{const{common:{cubicBezierEaseInOut:c},self:{titleFontWeight:e,dividerColor:t,titlePadding:u,titleTextColor:T,titleTextColorDisabled:_,textColor:B,arrowColor:Y,fontSize:ge,titleFontSize:fe,arrowColorDisabled:pe,itemMargin:me}}=i.value;return{"--n-font-size":ge,"--n-bezier":c,"--n-text-color":B,"--n-divider-color":t,"--n-title-padding":u,"--n-title-font-size":fe,"--n-title-text-color":T,"--n-title-text-color-disabled":_,"--n-title-font-weight":e,"--n-arrow-color":Y,"--n-arrow-color-disabled":pe,"--n-item-margin":me}}),d=s?Ce("collapse",void 0,C,n):void 0;return{rtlEnabled:m,mergedTheme:i,mergedClsPrefix:r,cssVars:s?void 0:C,themeClass:d==null?void 0:d.themeClass,onRender:d==null?void 0:d.onRender}},render(){var n;return(n=this.onRender)===null||n===void 0||n.call(this),D("div",{class:[`${this.mergedClsPrefix}-collapse`,this.rtlEnabled&&`${this.mergedClsPrefix}-collapse--rtl`,this.themeClass],style:this.cssVars},this.$slots)}}),Qe=z({name:"CollapseItemContent",props:{displayDirective:{type:String,required:!0},show:Boolean,clsPrefix:{type:String,required:!0}},setup(n){return{onceTrue:_e(se(n,"show"))}},render(){return D(Ie,null,{default:()=>{const{show:n,displayDirective:g,onceTrue:r,clsPrefix:s}=this,v=g==="show"&&r,p=D("div",{class:`${s}-collapse-item__content-wrapper`},D("div",{class:`${s}-collapse-item__content-inner`},this.$slots));return v?Ne(p,[[Ae,n]]):n?p:null}})}}),Xe={title:String,name:[String,Number],disabled:Boolean,displayDirective:String},j=z({name:"CollapseItem",props:Xe,setup(n){const{mergedRtlRef:g}=re(n),r=Re(),s=Pe(()=>{var o;return(o=n.name)!==null&&o!==void 0?o:r}),v=Me(ce);v||Oe("collapse-item","`n-collapse-item` must be placed inside `n-collapse`.");const{expandedNamesRef:p,props:l,mergedClsPrefixRef:w,slots:i}=v,b=M(()=>{const{value:o}=p;if(Array.isArray(o)){const{value:m}=s;return!~o.findIndex(C=>C===m)}else if(o){const{value:m}=s;return m!==o}return!0});return{rtlEnabled:oe("Collapse",g,w),collapseSlots:i,randomName:r,mergedClsPrefix:w,collapsed:b,triggerAreas:se(l,"triggerAreas"),mergedDisplayDirective:M(()=>{const{displayDirective:o}=n;return o||l.displayDirective}),arrowPlacement:M(()=>l.arrowPlacement),handleClick(o){let m="main";ee(o,"arrow")&&(m="arrow"),ee(o,"extra")&&(m="extra"),l.triggerAreas.includes(m)&&v&&!n.disabled&&v.toggleItem(b.value,s.value,o)}}},render(){const{collapseSlots:n,$slots:g,arrowPlacement:r,collapsed:s,mergedDisplayDirective:v,mergedClsPrefix:p,disabled:l,triggerAreas:w}=this,i=X(g.header,{collapsed:s},()=>[this.title]),b=g["header-extra"]||n["header-extra"],y=g.arrow||n.arrow;return D("div",{class:[`${p}-collapse-item`,`${p}-collapse-item--${r}-arrow-placement`,l&&`${p}-collapse-item--disabled`,!s&&`${p}-collapse-item--active`,w.map(o=>`${p}-collapse-item--trigger-area-${o}`)]},D("div",{class:[`${p}-collapse-item__header`,!s&&`${p}-collapse-item__header--active`]},D("div",{class:`${p}-collapse-item__header-main`,onClick:this.handleClick},r==="right"&&i,D("div",{class:`${p}-collapse-item-arrow`,key:this.rtlEnabled?0:1,"data-arrow":!0},X(y,{collapsed:s},()=>[D(ke,{clsPrefix:p},{default:()=>this.rtlEnabled?D(qe,null):D(ze,null)})])),r==="left"&&i),Ee(b,{collapsed:s},o=>D("div",{class:`${p}-collapse-item__header-extra`,onClick:this.handleClick,"data-extra":!0},o))),D(Qe,{clsPrefix:p,displayDirective:v,show:!s},g))}}),J=Fe("/gateway/hub0082"),et=async n=>J.post("/queryAlertLogs",n),ue=async n=>J.post("/getAlertLog",{alertLogId:n}),tt=async n=>J.post("/deleteAlertLog",{alertLogId:n}),at=async n=>J.post("/batchDeleteAlertLogs",{alertLogIds:n}),K=[{label:"信息",value:"INFO"},{label:"警告",value:"WARN"},{label:"错误",value:"ERROR"},{label:"严重",value:"CRITICAL"}],Z=[{label:"待发送",value:"PENDING"},{label:"发送中",value:"SENDING"},{label:"成功",value:"SUCCESS"},{label:"失败",value:"FAILED"}],lt={key:0,class:"alert-log-detail-container"},rt={class:"content-text"},nt={class:"content-text"},ot=z({__name:"AlertLogDetailDialog",props:{visible:{type:Boolean,default:!1},alertLogId:{default:""}},emits:["update:visible"],setup(n,{emit:g}){const r=n,s=g,v=Q(),p=E(!1),l=E(null),w=M(()=>r.alertLogId?`预警日志详情 - ${r.alertLogId}`:"预警日志详情"),i=M({get(){return r.visible},set(t){s("update:visible",t)}}),b=M(()=>{var t,u,T,_;return!!((t=l.value)!=null&&t.alertTags||(u=l.value)!=null&&u.alertExtra||(T=l.value)!=null&&T.tableData||(_=l.value)!=null&&_.sendResult)});te(()=>r.visible,t=>{t&&r.alertLogId?y():t||(l.value=null)},{immediate:!0}),te(()=>r.alertLogId,t=>{t&&r.visible&&y()});const y=async()=>{if(r.alertLogId)try{p.value=!0;const t=await ue(r.alertLogId);F(t)?l.value=H(t):(v.error($(t,"获取预警日志详情失败")),l.value=null)}catch(t){console.error("加载预警日志详情失败:",t),v.error(t.message||"加载预警日志详情失败"),l.value=null}finally{p.value=!1}},o=()=>{l.value=null},m=t=>{if(!t)return"";const u=K.find(T=>T.value===t);return(u==null?void 0:u.label)||String(t)},C=t=>t&&{INFO:"info",WARN:"warning",ERROR:"error",CRITICAL:"error"}[t]||"default",d=t=>{if(!t)return"";const u=Z.find(T=>T.value===t);return(u==null?void 0:u.label)||String(t)},c=t=>t&&{PENDING:"default",SENDING:"info",SUCCESS:"success",FAILED:"error"}[t]||"default",e=t=>{if(!t)return"";try{const u=JSON.parse(t);return JSON.stringify(u,null,2)}catch{return t}};return(t,u)=>(N(),R(a(je),{visible:i.value,"onUpdate:visible":u[0]||(u[0]=T=>i.value=T),title:w.value,width:"90%",style:{maxWidth:"1200px"},preset:"dialog","mask-closable":!1,closable:!0,draggable:!0,"show-footer":!1,onAfterLeave:o},{default:f(()=>[h(a(Ge),{show:p.value},{default:f(()=>[l.value?(N(),ie("div",lt,[h(a(V),{title:"基本信息",size:"small",class:"detail-card"},{default:f(()=>[h(a($e),{column:3,size:"small",bordered:""},{default:f(()=>[h(a(I),{label:"日志ID"},{default:f(()=>[h(a(Ue),{tooltip:!1},{default:f(()=>[S(L(l.value.alertLogId),1)]),_:1})]),_:1}),h(a(I),{label:"告警级别"},{default:f(()=>[h(a(U),{type:C(l.value.alertLevel),size:"small"},{default:f(()=>[S(L(m(l.value.alertLevel)),1)]),_:1},8,["type"])]),_:1}),h(a(I),{label:"告警类型"},{default:f(()=>[S(L(l.value.alertType||"-"),1)]),_:1}),h(a(I),{label:"渠道名称"},{default:f(()=>[S(L(l.value.channelName||"-"),1)]),_:1}),h(a(I),{label:"告警时间"},{default:f(()=>[S(L(a(O)(l.value.alertTimestamp||"")),1)]),_:1}),h(a(I),{label:"发送状态"},{default:f(()=>[h(a(U),{type:c(l.value.sendStatus),size:"small"},{default:f(()=>[S(L(d(l.value.sendStatus)),1)]),_:1},8,["type"])]),_:1}),h(a(I),{label:"发送时间"},{default:f(()=>[S(L(l.value.sendTime?a(O)(l.value.sendTime):"-"),1)]),_:1}),h(a(I),{label:"创建时间"},{default:f(()=>[S(L(a(O)(l.value.addTime)),1)]),_:1}),h(a(I),{label:"创建人"},{default:f(()=>[S(L(l.value.addWho),1)]),_:1}),h(a(I),{label:"修改时间"},{default:f(()=>[S(L(a(O)(l.value.editTime||"")),1)]),_:1}),h(a(I),{label:"修改人"},{default:f(()=>[S(L(l.value.editWho),1)]),_:1}),h(a(I),{label:"错误信息",span:3},{default:f(()=>[S(L(l.value.sendErrorMessage||"-"),1)]),_:1})]),_:1})]),_:1}),l.value.alertTitle?(N(),R(a(V),{key:0,title:"告警标题",size:"small",class:"detail-card"},{default:f(()=>[ae("div",rt,L(l.value.alertTitle),1)]),_:1})):k("",!0),l.value.alertContent?(N(),R(a(V),{key:1,title:"告警内容",size:"small",class:"detail-card"},{default:f(()=>[ae("div",nt,L(l.value.alertContent),1)]),_:1})):k("",!0),b.value?(N(),R(a(V),{key:2,title:"扩展数据",size:"small",class:"detail-card"},{default:f(()=>[h(a(Ze),null,{default:f(()=>[l.value.alertTags?(N(),R(a(j),{key:0,title:"告警标签 (JSON)",name:"tags"},{default:f(()=>[h(a(W),{content:e(l.value.alertTags),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):k("",!0),l.value.alertExtra?(N(),R(a(j),{key:1,title:"额外数据 (JSON)",name:"extra"},{default:f(()=>[h(a(W),{content:e(l.value.alertExtra),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):k("",!0),l.value.tableData?(N(),R(a(j),{key:2,title:"表格数据 (JSON)",name:"table"},{default:f(()=>[h(a(W),{content:e(l.value.tableData),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):k("",!0),l.value.sendResult?(N(),R(a(j),{key:3,title:"发送结果 (JSON)",name:"result"},{default:f(()=>[h(a(W),{content:e(l.value.sendResult),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):k("",!0)]),_:1})]),_:1})):k("",!0)])):(N(),R(a(Be),{key:1,description:"暂无日志数据"}))]),_:1},8,["show"])]),_:1},8,["visible","title"]))}}),st=de(ot,[["__scopeId","data-v-3d198b7c"]]);function it(){const n="hub0082:alert-log",g=E(!1),r=E([]),s=E(),l={fields:[{field:"timeRange",label:"时间范围",type:"datetimerange",placeholder:"请选择时间范围",span:8,clearable:!0,required:!0,rules:[{validator:(e,t)=>!t||!Array.isArray(t)||t.length!==2||!t[0]||!t[1]?new Error("请选择时间范围"):!0,trigger:["change","blur"]}],props:{shortcuts:{今天:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),u=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t.getTime(),u.getTime()]},昨天:()=>{const e=new Date;e.setDate(e.getDate()-1);const t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),u=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t.getTime(),u.getTime()]},最近1小时:()=>{const e=Date.now();return[e-36e5,e]},最近6小时:()=>{const e=Date.now();return[e-216e5,e]},最近24小时:()=>{const e=Date.now();return[e-864e5,e]},最近7天:()=>{const e=Date.now();return[e-6048e5,e]}},style:{width:"100%"}},defaultValue:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),u=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t.getTime(),u.getTime()]})()},{field:"alertLogId",label:"日志ID",type:"input",placeholder:"请输入日志ID",span:6,clearable:!0},{field:"alertLevel",label:"告警级别",type:"select",placeholder:"请选择告警级别",span:6,clearable:!0,options:[{label:"全部",value:""},...K.map(e=>({label:e.label,value:e.value}))]},{field:"alertType",label:"告警类型",type:"input",placeholder:"请输入告警类型",span:6,clearable:!0},{field:"alertTitle",label:"告警标题",type:"input",placeholder:"请输入告警标题",span:6,clearable:!0},{field:"channelName",label:"渠道名称",type:"input",placeholder:"请输入渠道名称",span:6,clearable:!0},{field:"sendStatus",label:"发送状态",type:"select",placeholder:"请选择发送状态",span:6,clearable:!0,options:[{label:"全部",value:""},...Z.map(e=>({label:e.label,value:e.value}))]}],toolbarButtons:[{key:"delete",label:"删除",icon:Ye,type:"error",tooltip:"批量删除选中的日志"}],showSearchButton:!0,showResetButton:!0},w=e=>{if(!e)return"";const t=K.find(u=>u.value===e);return(t==null?void 0:t.label)||String(e)},i=e=>e&&{INFO:"info",WARN:"warning",ERROR:"error",CRITICAL:"error"}[e]||"default",b=e=>{if(!e)return"";const t=Z.find(u=>u.value===e);return(t==null?void 0:t.label)||String(e)},y=e=>e&&{PENDING:"default",SENDING:"info",SUCCESS:"success",FAILED:"error"}[e]||"default",o={columns:[{field:"alertLogId",title:"日志ID",align:"center",showOverflow:"tooltip",width:200},{field:"alertLevel",title:"告警级别",align:"center",width:100,slots:{default:"alertLevel"}},{field:"alertType",title:"告警类型",align:"center",showOverflow:"tooltip",width:120},{field:"alertTitle",title:"告警标题",align:"center",showOverflow:"tooltip",width:200},{field:"alertContent",title:"告警内容",align:"center",showOverflow:"tooltip",width:300},{field:"channelName",title:"渠道名称",align:"center",showOverflow:"tooltip",width:150},{field:"sendStatus",title:"发送状态",align:"center",width:100,slots:{default:"sendStatus"}},{field:"alertTimestamp",title:"告警时间",align:"center",width:160,formatter:({row:e})=>O(e.alertTimestamp)},{field:"sendTime",title:"发送时间",align:"center",width:160,formatter:({row:e})=>O(e.sendTime)},{field:"sendErrorMessage",title:"错误信息",align:"center",showOverflow:"tooltip",width:200},{field:"addTime",title:"创建时间",align:"center",width:160,formatter:({row:e})=>O(e.addTime)},{field:"addWho",title:"创建人",align:"center",width:120,showOverflow:"tooltip"},{field:"editTime",title:"修改时间",align:"center",width:160,formatter:({row:e})=>O(e.editTime)},{field:"editWho",title:"修改人",align:"center",width:120,showOverflow:"tooltip"}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:s,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function m(e){r.value=e}function C(e){g.value=e}function d(){s.value=void 0}function c(e){s.value?Object.assign(s.value,e):s.value=e}return{moduleId:n,loading:g,logList:r,pageInfo:s,searchFormConfig:l,gridConfig:o,getAlertLevelLabel:w,getAlertLevelTagType:i,getSendStatusLabel:b,getSendStatusTagType:y,setLogList:m,setLoading:C,resetPagination:d,updatePagination:c}}function dt(n){const g=Q(),r=it(),s=async w=>{var i,b,y;try{r.setLoading(!0);let o=w;!o&&((i=n==null?void 0:n.value)!=null&&i.getFormData)&&(o=n.value.getFormData()||{});const m={};o&&Object.keys(o).forEach(c=>{c==="timeRange"&&Array.isArray(o[c])&&o[c].length===2?(m.startTime=new Date(o[c][0]).toISOString(),m.endTime=new Date(o[c][1]).toISOString()):o[c]!==""&&o[c]!==null&&o[c]!==void 0&&(m[c]=o[c])});const C={...m,...he((b=r.pageInfo.value)==null?void 0:b.pageIndex,(y=r.pageInfo.value)==null?void 0:y.pageSize)},d=await et(C);if(F(d)){const c=H(d,[])||[];r.setLogList(c);const e=Ve(d);e&&r.updatePagination(e)}else g.error($(d,"查询预警日志失败")),r.setLogList([])}catch(o){console.error("查询预警日志失败:",o),g.error(o.message||"查询预警日志失败"),r.setLogList([])}finally{r.setLoading(!1)}};return{model:r,loadLogList:s,getLogDetail:async w=>{try{r.setLoading(!0);const i=await ue(w);return F(i)?H(i):(g.error($(i,"获取预警日志详情失败")),null)}catch(i){return console.error("获取预警日志详情失败:",i),g.error(i.message||"获取预警日志详情失败"),null}finally{r.setLoading(!1)}},deleteLog:async w=>{try{r.setLoading(!0);const i=await tt(w);return F(i)?(g.success("删除预警日志成功"),await s(),!0):(g.error($(i,"删除预警日志失败")),!1)}catch(i){return console.error("删除预警日志失败:",i),g.error(i.message||"删除预警日志失败"),!1}finally{r.setLoading(!1)}},batchDeleteLogs:async w=>{if(w.length===0)return g.warning("请选择要删除的日志"),!1;try{r.setLoading(!0);const i=await at(w);return F(i)?(g.success(`成功删除 ${w.length} 条预警日志`),await s(),!0):(g.error($(i,"批量删除预警日志失败")),!1)}catch(i){return console.error("批量删除预警日志失败:",i),g.error(i.message||"批量删除预警日志失败"),!1}finally{r.setLoading(!1)}}}}function ct(n,g){const r=Q(),s=Je(),v=dt(g),p=E(!1),l=E(""),w=async d=>{v.model.resetPagination(),await v.loadLogList(d)},i=async({currentPage:d,pageSize:c})=>{v.model.updatePagination({pageIndex:d,pageSize:c}),await v.loadLogList()},b=async(d,c)=>{switch(d){case"delete":{if(!(n!=null&&n.value)){r.warning("Grid 引用未设置");return}const e=n.value.getCheckboxRecords()||[];if(e.length===0){r.warning("请先选择要删除的日志");return}const t=e.map(u=>u.alertLogId);await C(t);break}case"search":{await w(c);break}default:console.warn("未知的工具栏按钮:",d)}},y=async d=>{if(!d.alertLogId){r.warning("日志ID不能为空");return}l.value=d.alertLogId,p.value=!0},o=async({menu:d,row:c})=>{switch(d.code){case"view":await y(c);break;case"delete":await m(c);break;default:console.warn("未知的菜单项:",d.code)}},m=async d=>{if(!d.alertLogId){r.warning("日志ID不能为空");return}await s.warning({title:"确认删除",content:`确定要删除日志"${d.alertLogId}"吗？`,positiveText:"删除",negativeText:"取消"})&&await v.deleteLog(d.alertLogId)},C=async d=>{if(d.length===0){r.warning("请选择要删除的日志");return}await s.warning({title:"确认批量删除",content:`确定要删除选中的 ${d.length} 条日志吗？`,positiveText:"删除",negativeText:"取消"})&&await v.batchDeleteLogs(d)};return{service:v,viewDialogVisible:p,selectedAlertLogId:l,handleSearch:w,handlePageChange:i,handleToolbarClick:b,handleMenuClick:o,openViewDialog:y,handleDelete:m,handleBatchDelete:C}}const ut="hub0082-alert-log",gt=z({name:"AlertLogManagement",__name:"AlertLogManagement",setup(n){const g=E(),r=E(),{service:s,viewDialogVisible:v,selectedAlertLogId:p,handleToolbarClick:l,handleMenuClick:w,handleSearch:i,handlePageChange:b}=ct(r,g);return(y,o)=>(N(),ie("div",{class:"alert-log-management",id:ut},[h(a(be),{direction:"vertical","no-resize":!0},{1:f(()=>[h(we,le({ref_key:"searchFormRef",ref:g,"module-id":a(s).model.moduleId},a(s).model.searchFormConfig,{onSearch:a(i),onToolbarClick:a(l)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:f(()=>[h(a(ve),le({ref_key:"gridRef",ref:r,"module-id":a(s).model.moduleId,data:a(s).model.logList,loading:a(s).model.loading},a(s).model.gridConfig,{onPageChange:a(b),onMenuClick:o[0]||(o[0]=({code:m,row:C})=>a(w)({menu:{code:m},row:C}))}),{alertLevel:f(({row:m})=>[h(a(U),{type:a(s).model.getAlertLevelTagType(m.alertLevel),size:"small"},{default:f(()=>[S(L(a(s).model.getAlertLevelLabel(m.alertLevel)),1)]),_:2},1032,["type"])]),sendStatus:f(({row:m})=>[h(a(U),{type:a(s).model.getSendStatusTagType(m.sendStatus),size:"small"},{default:f(()=>[S(L(a(s).model.getSendStatusLabel(m.sendStatus)),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),h(a(st),{visible:a(v),"onUpdate:visible":o[1]||(o[1]=m=>We(v)?v.value=m:null),"alert-log-id":a(p)},null,8,["visible","alert-log-id"])]))}}),_t=de(gt,[["__scopeId","data-v-da416192"]]);export{_t as default};

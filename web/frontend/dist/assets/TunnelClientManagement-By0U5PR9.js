import{$ as K,d as Q,e as W,b as X,r as u,g as w,cO as Z,a8 as g,aM as ee,h as te,c as F,m as l,w as s,n as a,a0 as y,a1 as R,dj as ae,a2 as D,I as p,bR as _,o as M,aO as ne,bU as le,q as se,v as q,E as C,cU as oe,J as k,x as T,V as re,B as ue,C as S,co as ie,_ as ce}from"./index-Bm8WTrgo.js";import{C as de}from"./CheckmarkCircleOutline-zm_tlaJ3.js";import{C as me}from"./CloseCircleOutline-DFAgdDO-.js";import{A as ve}from"./AlertCircleOutline-MDG2uuCN.js";import{L as pe}from"./LinkOutline-B3obbmwD.js";import{A as fe}from"./AddOutline-Crq49hC7.js";import{N as be}from"./Popconfirm-Doj4hVEv.js";import{_ as he,a as ge}from"./Grid-BszSwIPR.js";import{_ as ye}from"./Statistic-BenMnYSL.js";import{_ as _e}from"./RadioGroup-DeGnoaYt.js";import{_ as Ce}from"./DataTable-C88L71Mp.js";import{N as ke}from"./InputNumber-Da0ADIUs.js";const f=K("/gateway/hub0062"),Te=async c=>f.post("/queryTunnelClients",c),Se=async c=>f.post("/createTunnelClient",c),Ne=async c=>f.post("/updateTunnelClient",c),xe=async c=>f.post("/deleteTunnelClient",{tunnelClientId:c}),Ae=async()=>f.post("/getClientStats",{}),Ie=async()=>f.post("/generateAuthToken",{}),Pe={class:"tunnel-client-management"},we=Q({__name:"TunnelClientManagement",setup(c){const{t}=W("hub0062"),i=X(),N=u(!1),O=u([]),x=u(""),A=u(null),m=u(!1),b=u(!1),I=u(!1),z=u(),d=u({totalClients:0,connectedClients:0,disconnectedClients:0,connectingClients:0,errorClients:0,totalServices:0}),r=u({clientName:"",serverAddress:"",serverPort:7e3,authToken:"",tlsEnable:"N",autoReconnect:"Y",maxRetries:5,retryInterval:20,heartbeatInterval:30,heartbeatTimeout:90}),v=u({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50,100]}),U=w(()=>[{key:"total",label:t("hub0062.stats.total"),value:d.value.totalClients,icon:Z},{key:"connected",label:t("hub0062.stats.connected"),value:d.value.connectedClients,icon:de},{key:"disconnected",label:t("hub0062.stats.disconnected"),value:d.value.disconnectedClients,icon:me},{key:"error",label:t("hub0062.stats.error"),value:d.value.errorClients,icon:ve},{key:"services",label:t("hub0062.stats.services"),value:d.value.totalServices,icon:pe}]),E=w(()=>[{label:t("hub0062.status.connected"),value:"connected"},{label:t("hub0062.status.disconnected"),value:"disconnected"},{label:t("hub0062.status.connecting"),value:"connecting"},{label:t("hub0062.status.error"),value:"error"}]),V=w(()=>[{title:t("hub0062.table.clientName"),key:"clientName",width:150,fixed:"left"},{title:t("hub0062.table.serverAddress"),key:"serverAddress",width:180},{title:t("hub0062.table.serverPort"),key:"serverPort",width:100},{title:t("hub0062.table.connectionStatus"),key:"connectionStatus",width:120,render:e=>g(ee,{type:{connected:"success",disconnected:"default",connecting:"warning",error:"error"}[e.connectionStatus]},{default:()=>t(`hub0062.status.${e.connectionStatus}`)})},{title:t("hub0062.table.serviceCount"),key:"serviceCount",width:100},{title:t("hub0062.table.lastHeartbeat"),key:"lastHeartbeat",width:180},{title:t("common.actions"),key:"actions",width:200,fixed:"right",render:e=>g(_,{size:"small"},{default:()=>[g(p,{size:"small",type:"primary",onClick:()=>J(e)},{default:()=>t("common.edit")}),g(be,{onPositiveClick:()=>L(e)},{default:()=>t("common.confirmDelete"),trigger:()=>g(p,{size:"small",type:"error"},{default:()=>t("common.delete")})})]})}]),B={clientName:[{required:!0,message:t("hub0062.form.clientNameRequired"),trigger:"blur"}],serverAddress:[{required:!0,message:t("hub0062.form.serverAddressRequired"),trigger:"blur"}],serverPort:[{required:!0,type:"number",message:t("hub0062.form.serverPortRequired"),trigger:"blur"}],authToken:[{required:!0,message:t("hub0062.form.authTokenRequired"),trigger:"blur"}]},h=async()=>{N.value=!0;try{const e=await Te({keyword:x.value||void 0,connectionStatus:A.value||void 0,pageIndex:v.value.page,pageSize:v.value.pageSize});if(y(e)){O.value=R(e,[]);const n=ae(e);v.value.itemCount=n.itemCount}else{const n=D(e,t("common.loadFailed"));i.error(n)}}catch(e){console.error("加载客户端列表失败:",e),i.error(t("common.loadFailed"))}finally{N.value=!1}},P=async()=>{try{const e=await Ae();y(e)&&(d.value=R(e,d.value))}catch(e){console.error("加载统计信息失败:",e)}},$=()=>{v.value.page=1,h()},G=()=>{v.value.page=1,h()},j=()=>{b.value=!1,r.value={clientName:"",serverAddress:"",serverPort:7e3,authToken:"",tlsEnable:"N",autoReconnect:"Y",maxRetries:5,retryInterval:20,heartbeatInterval:30,heartbeatTimeout:90},m.value=!0},J=e=>{if(b.value=!0,r.value={tunnelClientId:e.tunnelClientId,clientName:e.clientName,clientDescription:e.clientDescription,clientVersion:e.clientVersion,operatingSystem:e.operatingSystem,serverAddress:e.serverAddress,serverPort:e.serverPort,authToken:e.authToken,tlsEnable:e.tlsEnable,autoReconnect:e.autoReconnect,maxRetries:e.maxRetries,retryInterval:e.retryInterval,heartbeatInterval:e.heartbeatInterval,heartbeatTimeout:e.heartbeatTimeout,noteText:e.noteText},e.clientConfig)try{r.value.clientConfig=typeof e.clientConfig=="string"?JSON.parse(e.clientConfig):e.clientConfig}catch(n){console.error("解析客户端配置失败:",n)}m.value=!0},L=async e=>{try{const n=await xe(e.tunnelClientId);y(n)&&(i.success(t("common.deleteSuccess")),h(),P())}catch{i.error(t("common.deleteFailed"))}},H=async()=>{try{const e=await Ie();if(y(e)){const n=R(e,"");r.value.authToken=typeof n=="string"?n:n.authToken||"",i.success(t("hub0062.message.tokenGenerated"))}else{const n=D(e,t("hub0062.message.tokenGenerateFailed"));i.error(n)}}catch(e){console.error("生成令牌失败:",e),i.error(t("hub0062.message.tokenGenerateFailed"))}},Y=async()=>{var e;try{await((e=z.value)==null?void 0:e.validate()),I.value=!0;const n=b.value?await Ne(r.value):await Se(r.value);y(n)&&(i.success(t(b.value?"common.updateSuccess":"common.createSuccess")),m.value=!1,h(),P())}catch(n){n!=null&&n.errors||i.error(t("common.operationFailed"))}finally{I.value=!1}};return te(()=>{h(),P()}),(e,n)=>(M(),F("div",Pe,[l(a(re),{bordered:!1},{default:s(()=>[l(a(_),{vertical:"",size:16},{default:s(()=>[l(a(he),{cols:5,"x-gap":16},{default:s(()=>[(M(!0),F(ne,null,le(U.value,o=>(M(),se(a(ge),{key:o.key},{default:s(()=>[l(a(ye),{label:o.label,value:o.value},{prefix:s(()=>[l(a(q),{component:o.icon,size:24},null,8,["component"])]),_:2},1032,["label","value"])]),_:2},1024))),128))]),_:1}),l(a(_),{justify:"space-between"},{default:s(()=>[l(a(_),null,{default:s(()=>[l(a(C),{value:x.value,"onUpdate:value":[n[0]||(n[0]=o=>x.value=o),$],placeholder:a(t)("common.searchPlaceholder"),clearable:"",style:{width:"300px"}},{prefix:s(()=>[l(a(q),{component:a(oe)},null,8,["component"])]),_:1},8,["value","placeholder"]),l(a(_e),{value:A.value,"onUpdate:value":[n[1]||(n[1]=o=>A.value=o),G],placeholder:a(t)("hub0062.filter.status"),options:E.value,clearable:"",style:{width:"150px"}},null,8,["value","placeholder","options"])]),_:1}),l(a(p),{type:"primary",onClick:j},{icon:s(()=>[l(a(q),{component:a(fe)},null,8,["component"])]),default:s(()=>[k(" "+T(a(t)("common.create")),1)]),_:1})]),_:1}),l(a(Ce),{columns:V.value,data:O.value,loading:N.value,pagination:v.value,"row-key":o=>o.tunnelClientId},null,8,["columns","data","loading","pagination","row-key"])]),_:1})]),_:1}),l(a(ie),{show:m.value,"onUpdate:show":n[7]||(n[7]=o=>m.value=o),preset:"card",title:b.value?a(t)("hub0062.dialog.editTitle"):a(t)("hub0062.dialog.createTitle"),style:{width:"700px"}},{footer:s(()=>[l(a(_),{justify:"end"},{default:s(()=>[l(a(p),{onClick:n[6]||(n[6]=o=>m.value=!1)},{default:s(()=>[k(T(a(t)("common.cancel")),1)]),_:1}),l(a(p),{type:"primary",loading:I.value,onClick:Y},{default:s(()=>[k(T(a(t)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:s(()=>[l(a(ue),{ref_key:"formRef",ref:z,model:r.value,rules:B,"label-width":"120px"},{default:s(()=>[l(a(S),{label:a(t)("hub0062.form.clientName"),path:"clientName"},{default:s(()=>[l(a(C),{value:r.value.clientName,"onUpdate:value":n[2]||(n[2]=o=>r.value.clientName=o)},null,8,["value"])]),_:1},8,["label"]),l(a(S),{label:a(t)("hub0062.form.serverAddress"),path:"serverAddress"},{default:s(()=>[l(a(C),{value:r.value.serverAddress,"onUpdate:value":n[3]||(n[3]=o=>r.value.serverAddress=o)},null,8,["value"])]),_:1},8,["label"]),l(a(S),{label:a(t)("hub0062.form.serverPort"),path:"serverPort"},{default:s(()=>[l(a(ke),{value:r.value.serverPort,"onUpdate:value":n[4]||(n[4]=o=>r.value.serverPort=o),min:1,max:65535,style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),l(a(S),{label:a(t)("hub0062.form.authToken"),path:"authToken"},{default:s(()=>[l(a(C),{value:r.value.authToken,"onUpdate:value":n[5]||(n[5]=o=>r.value.authToken=o),type:"password","show-password-on":"click"},{suffix:s(()=>[l(a(p),{text:"",onClick:H},{default:s(()=>[k(T(a(t)("hub0062.form.generateToken")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","title"])]))}}),Ge=ce(we,[["__scopeId","data-v-7c0cead4"]]);export{Ge as default};

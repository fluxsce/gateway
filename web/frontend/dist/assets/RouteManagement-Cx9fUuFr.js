import{G as fe}from"./GPane-L7gHnozL.js";import{G as me}from"./GDataFormModal-BsI30IjJ.js";import{c as ve,G as ye,S as Ce,g as $e}from"./SearchForm-wLSWNkX3.js";import{G as Ue}from"./GTree-Do4PCmZK.js";import{G as Se}from"./GModal-DETqCgwG.js";import{T as X,r as N,aa as re,m as ee,z as U,B as G,A as te,d2 as Ae,d as le,a7 as ae,av as ce,g as ie,o as Y,w as S,f as E,b as A,e as t,am as oe,aO as $,K as H,t as K,cr as Q,_ as ne,j as de,cF as Ge,i as Z,q as Ye,c as j,h as Ne,J as pe,G as Be,cq as Je,I as We,ab as je,aQ as se,bY as ke,bV as Xe,n as Qe}from"./index-bKVtVsSX.js";import{N as Pe}from"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Cl3FsyCO.js";import{u as Oe}from"./useGDialog-CebP_ODM.js";import{d as _e,e as Ze,a as et,g as tt,q as at,b as it,c as ot,f as lt,h as nt,i as st,j as Fe,M as W,k as we,l as Me,m as rt,n as ct,o as Ve,p as Le,r as ut,s as dt,t as ft,u as pt}from"./types-BHFcVaoQ.js";import{A as xe}from"./AddOutline-e9mIKA9k.js";import{T as Re}from"./TrashOutline-fmGjC74g.js";import{F as gt,C as ht}from"./FunnelOutline-Dix0tAH9.js";import{S as be}from"./ServerOutline-CkCv8ERP.js";import{R as ze}from"./RefreshOutline-BOvBbY42.js";import{I as bt,U as mt,A as vt,D as yt,C as Ct,a as wt,R as Tt}from"./RateLimitConfigFormModal-BjebbpDe.js";import{C as It}from"./CloseOutline-5xoaS2lB.js";import{N as kt,a as St}from"./Checkbox-Dyr4pKoe.js";import{C as At}from"./CheckmarkCircleOutline-C9yk_iJ8.js";import{G as Nt}from"./GlobeOutline-C4RAKLWW.js";import{W as Ee}from"./WarningOutline-Bmg_55lx.js";import"./index-njfaNneo.js";import"./Select-nnqhVAAY.js";import"./DownloadOutline-D-MlMMLc.js";import"./Upload-BjXfHnLb.js";import"./download-C2161hUv.js";import"./DocumentOutline-CWqxFH5v.js";import"./CopyOutline-1zN_cm6d.js";import"./ContractOutline-bpt5MEb5.js";import"./GDialog-DsPicUom.js";import"./CreateOutline-LmOn9niU.js";import"./DynamicTags-CbtPqFfo.js";import"./prop-NnGblK-3.js";import"./Alert-DDyl-kEQ.js";const Te=[{label:"请求头处理",value:"header",description:"添加、修改或删除HTTP请求头/响应头"},{label:"查询参数处理",value:"query-param",description:"处理URL查询参数"},{label:"请求体处理",value:"body",description:"处理和验证请求体内容"},{label:"前缀剥离",value:"strip",description:"移除请求路径中的指定前缀"},{label:"路径重写",value:"rewrite",description:"重写或转换请求路径"},{label:"HTTP方法控制",value:"method",description:"控制允许的HTTP方法"},{label:"Cookie处理",value:"cookie",description:"处理HTTP Cookie"},{label:"响应处理",value:"response",description:"处理后端响应"}],ge=[{label:"前置处理",value:"pre-routing",description:"在路由匹配前执行"},{label:"后置处理",value:"post-routing",description:"在路由匹配后执行"},{label:"响应前处理",value:"pre-response",description:"在响应返回前执行"}];ge.filter(C=>C.value==="pre-routing");const Pt=[{label:"添加",value:"add",description:"添加新的请求头"},{label:"设置",value:"set",description:"设置请求头（替换现有值）"},{label:"移除",value:"remove",description:"移除指定请求头"},{label:"重命名",value:"rename",description:"重命名请求头"}],Ot=[{label:"添加",value:"add",description:"添加新的查询参数"},{label:"设置",value:"set",description:"设置查询参数（替换现有值）"},{label:"移除",value:"remove",description:"移除指定查询参数"},{label:"重命名",value:"rename",description:"重命名查询参数"}],xt=[{label:"转换",value:"transform",description:"转换请求体格式"},{label:"验证",value:"validate",description:"验证请求体内容"},{label:"修改",value:"modify",description:"修改请求体字段"},{label:"过滤",value:"filter",description:"过滤请求体字段"}],Rt=[{label:"添加",value:"add",description:"添加新的Cookie"},{label:"移除",value:"remove",description:"移除指定Cookie"},{label:"修改",value:"modify",description:"修改Cookie值"},{label:"验证",value:"validate",description:"验证Cookie格式"},{label:"过滤",value:"filter",description:"过滤Cookie内容"}],_t=[{label:"允许模式",value:"allow",description:"只允许指定的HTTP方法"},{label:"拒绝模式",value:"deny",description:"拒绝指定的HTTP方法"}],Ft=[{label:"简单替换",value:"simple",description:"直接替换路径中的特定部分"},{label:"正则替换",value:"regex",description:"使用正则表达式匹配和替换路径"}],Mt=[{label:"添加响应头",value:"add_headers",description:"添加HTTP响应头"},{label:"修改响应体",value:"modify_body",description:"修改响应体内容"},{label:"设置状态码",value:"set_status",description:"设置HTTP状态码"},{label:"过滤响应头",value:"filter_headers",description:"过滤响应头内容"},{label:"转换响应体",value:"transform_body",description:"转换响应体格式"},{label:"验证响应",value:"validate_response",description:"验证响应数据"}],qe=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"],Vt=["application/json","application/xml","text/plain","text/html","application/x-www-form-urlencoded","multipart/form-data"];function Lt(C){const w=N(!1),o=N([]),c=N(),f={fields:[{field:"filterName",label:"过滤器名称",type:"input",placeholder:"请输入过滤器名称",span:6,clearable:!0},{field:"filterType",label:"过滤器类型",type:"select",placeholder:"请选择过滤器类型",span:6,clearable:!0,options:[{label:"全部",value:""},...Te.map(e=>({label:e.label,value:e.value}))]},{field:"filterAction",label:"执行时机",type:"select",placeholder:"请选择执行时机",span:6,clearable:!0,options:[{label:"全部",value:""},...ge.map(e=>({label:e.label,value:e.value}))]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[{key:"add",label:"新增过滤器",icon:xe,type:"primary",tooltip:"新增过滤器配置"},{key:"delete",label:"删除",icon:Re,type:"error",tooltip:"批量删除选中的过滤器配置"}],showSearchButton:!0,showResetButton:!0},s=e=>{const d=Te.find(l=>l.value===e);return(d==null?void 0:d.label)||e},T=e=>({header:"primary","query-param":"info",body:"warning",strip:"success",rewrite:"success",method:"error",cookie:"default",response:"info"})[e]||"default",n=e=>{const d=ge.find(l=>l.value===e);return(d==null?void 0:d.label)||e},h=e=>({"pre-routing":"success","post-routing":"info","pre-response":"warning"})[e]||"default",O={columns:[{field:"filterConfigId",title:"过滤器配置ID",visible:!1,width:0},{field:"filterOrder",title:"执行顺序",align:"center",width:120,slots:{default:"filterOrder"}},{field:"filterName",title:"过滤器名称",align:"center",showOverflow:"tooltip",width:200},{field:"filterType",title:"类型",align:"center",width:140,slots:{default:"filterType"}},{field:"filterAction",title:"执行时机",align:"center",width:120,slots:{default:"filterAction"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"filterDesc",title:"描述",align:"center",showOverflow:"tooltip",width:200},{field:"addTime",title:"创建时间",align:"center",formatter:({row:e})=>re(e.addTime),width:180},{field:"addWho",title:"创建人",align:"center",showOverflow:"tooltip",width:120},{field:"editTime",title:"修改时间",align:"center",formatter:({row:e})=>re(e.editTime),width:180},{field:"editWho",title:"修改人",align:"center",showOverflow:"tooltip",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:c,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"toggle-status",name:"切换状态",prefixIcon:"vxe-icon-check"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function m(e){o.value=e}function _(e){w.value=e}function F(){c.value=void 0}function R(e){c.value?Object.assign(c.value,e):c.value=e}function x(e){o.value.push(e),o.value.sort((d,l)=>(d.filterOrder||0)-(l.filterOrder||0))}function v(e,d,l){const i=o.value.findIndex(u=>u.filterConfigId===e&&(!d||u.tenantId===d));i!==-1&&(Object.assign(o.value[i],l),o.value.sort((u,g)=>(u.filterOrder||0)-(g.filterOrder||0)))}function k(e){const d=o.value.findIndex(l=>l.filterConfigId===e);d>=0&&o.value.splice(d,1)}function M(e){o.value=o.value.filter(d=>!e.includes(d.filterConfigId))}const q=[{key:"basic",label:"基本信息"},{key:"other",label:"其他信息"}],r=[{field:"filterConfigId",label:"过滤器配置ID",type:"input",span:12,primary:!0,show:!1},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:12,show:!1},{field:"routeConfigId",label:"路由配置ID",type:"input",span:12,show:!1},{field:"filterName",label:"过滤器名称",type:"input",placeholder:"请输入过滤器名称",span:12,required:!0,rules:[{required:!0,message:"请输入过滤器名称",trigger:["blur","input"]},{max:100,message:"过滤器名称不能超过100个字符",trigger:["blur","input"]}]},{field:"filterType",label:"过滤器类型",type:"select",placeholder:"请选择过滤器类型",span:12,tabKey:"basic",required:!0,defaultValue:"header",options:Te.map(e=>({label:e.label,value:e.value})),rules:[{required:!0,message:"请选择过滤器类型",trigger:["blur","change"]}]},{field:"filterAction",label:"执行时机",type:"select",placeholder:"请选择执行时机",span:12,tabKey:"basic",required:!0,defaultValue:"pre-routing",show:!1,options:ge.map(e=>({label:e.label,value:e.value})),rules:[{required:!0,message:"请选择执行时机",trigger:["blur","change"]}]},{field:"filterOrder",label:"执行顺序",type:"number",placeholder:"数值越小优先级越高",span:12,tabKey:"basic",required:!0,defaultValue:1,props:{min:1,precision:0},rules:[{required:!0,type:"number",message:"请输入执行顺序",trigger:["blur","change"],validator:(e,d)=>{if(d==null||d==="")return new Error("请输入执行顺序");const l=typeof d=="number"?d:Number(d);return isNaN(l)?new Error("执行顺序必须是数字"):l<1?new Error("执行顺序必须大于等于1"):Number.isInteger(l)?!0:new Error("执行顺序必须是整数")}}]},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"filterDesc",label:"描述",type:"input",placeholder:"请输入过滤器描述",span:24,tabKey:"basic",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"filterConfigFieldset",label:"过滤器配置",type:"fieldset",span:24,tabKey:"basic",children:[{field:"config.headerConfig.modifierType",label:"修改类型",type:"select",placeholder:"请选择修改类型",span:12,show:e=>e.filterType==="header",options:Pt.map(e=>({label:e.label,value:e.value}))},{field:"config.headerConfig.isRequestHeader",label:"作用范围",type:"custom",span:12,show:e=>e.filterType==="header",defaultValue:!0,render:e=>X(Pe,{value:e["config.headerConfig.isRequestHeader"]??!0,checkedValue:!0,uncheckedValue:!1,"onUpdate:value":d=>{e["config.headerConfig.isRequestHeader"]=d}},{checked:()=>"请求头",unchecked:()=>"响应头"})},{field:"config.headerConfig.headerName",label:"Header名称",type:"input",placeholder:"请输入Header名称",span:12,show:e=>e.filterType==="header"},{field:"config.headerConfig.headerValue",label:"Header值",type:"input",placeholder:"请输入Header值",span:12,show:e=>e.filterType==="header"&&e["config.headerConfig.modifierType"]!=="remove"},{field:"config.headerConfig.targetHeaderName",label:"目标Header名称",type:"input",placeholder:"请输入重命名后的Header名称",span:12,show:e=>e.filterType==="header"&&e["config.headerConfig.modifierType"]==="rename"},{field:"config.queryParamConfig.modifierType",label:"修改类型",type:"select",placeholder:"请选择修改类型",span:12,show:e=>e.filterType==="query-param",options:Ot.map(e=>({label:e.label,value:e.value}))},{field:"config.queryParamConfig.paramName",label:"参数名称",type:"input",placeholder:"请输入参数名称",span:12,show:e=>e.filterType==="query-param"},{field:"config.queryParamConfig.paramValue",label:"参数值",type:"input",placeholder:"请输入参数值",span:12,show:e=>e.filterType==="query-param"&&e["config.queryParamConfig.modifierType"]!=="remove"},{field:"config.queryParamConfig.targetParamName",label:"目标参数名称",type:"input",placeholder:"请输入重命名后的参数名称",span:12,show:e=>e.filterType==="query-param"&&e["config.queryParamConfig.modifierType"]==="rename"},{field:"config.stripConfig.prefix",label:"要剥离的前缀",type:"input",placeholder:"请输入要剥离的路径前缀，如：/api/v1",span:24,show:e=>e.filterType==="strip"},{field:"config.rewriteConfig.mode",label:"重写模式",type:"select",placeholder:"请选择重写模式",span:12,show:e=>e.filterType==="rewrite",options:Ft.map(e=>({label:e.label,value:e.value}))},{field:"config.rewriteConfig.from",label:"查找内容",type:"input",placeholder:"请输入要替换的字符串或正则表达式",span:12,show:e=>e.filterType==="rewrite"},{field:"config.rewriteConfig.to",label:"替换内容",type:"input",placeholder:"请输入替换后的内容",span:12,show:e=>e.filterType==="rewrite"},{field:"config.methodConfig.mode",label:"过滤模式",type:"select",placeholder:"请选择过滤模式",span:12,show:e=>e.filterType==="method",options:_t.map(e=>({label:e.label,value:e.value}))},{field:"config.methodConfig.allowedMethods",label:"允许的方法",type:"select",placeholder:"请选择允许的HTTP方法",span:12,show:e=>e.filterType==="method"&&e["config.methodConfig.mode"]==="allow",props:{multiple:!0},options:qe.map(e=>({label:e,value:e}))},{field:"config.methodConfig.deniedMethods",label:"拒绝的方法",type:"select",placeholder:"请选择拒绝的HTTP方法",span:12,show:e=>e.filterType==="method"&&e["config.methodConfig.mode"]==="deny",props:{multiple:!0},options:qe.map(e=>({label:e,value:e}))},{field:"config.methodConfig.rejectStatusCode",label:"拒绝时状态码",type:"number",placeholder:"默认405",span:12,show:e=>e.filterType==="method",defaultValue:405,props:{min:400,max:599}},{field:"config.methodConfig.rejectMessage",label:"拒绝时消息",type:"input",placeholder:"请输入拒绝时的错误消息",span:12,show:e=>e.filterType==="method",defaultValue:"Method Not Allowed"},{field:"config.methodConfig.caseSensitive",label:"区分大小写",type:"switch",span:12,show:e=>e.filterType==="method",defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.bodyConfig.modifierType",label:"修改类型",type:"select",placeholder:"请选择修改类型",span:12,show:e=>e.filterType==="body",options:xt.map(e=>({label:e.label,value:e.value}))},{field:"config.bodyConfig.operation",label:"操作描述",type:"input",placeholder:"请输入操作描述",span:12,show:e=>e.filterType==="body"},{field:"config.bodyConfig.allowedContentTypes",label:"允许的内容类型",type:"select",placeholder:"请选择允许的内容类型",span:12,show:e=>e.filterType==="body",props:{multiple:!0},options:Vt.map(e=>({label:e,value:e}))},{field:"config.bodyConfig.maxBodySize",label:"最大请求体大小(字节)",type:"number",placeholder:"请输入最大请求体大小",span:12,show:e=>e.filterType==="body",props:{min:0}},{field:"config.bodyConfig.filterConfigJson",label:"过滤器配置(JSON)",type:"input",placeholder:"请输入JSON格式的过滤器配置",span:24,show:e=>e.filterType==="body",props:{type:"textarea",rows:4}},{field:"config.cookieConfig.operation",label:"操作类型",type:"select",placeholder:"请选择操作类型",span:12,show:e=>e.filterType==="cookie",options:Rt.map(e=>({label:e.label,value:e.value}))},{field:"config.cookieConfig.applyToResponse",label:"应用到响应",type:"switch",span:12,show:e=>e.filterType==="cookie",defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.cookieConfig.cookieName",label:"Cookie名称",type:"input",placeholder:"请输入Cookie名称",span:12,show:e=>e.filterType==="cookie"},{field:"config.cookieConfig.cookieValue",label:"Cookie值",type:"input",placeholder:"请输入Cookie值",span:12,show:e=>e.filterType==="cookie"&&e["config.cookieConfig.operation"]!=="remove"},{field:"config.cookieConfig.cookieAttributes.domain",label:"域名",type:"input",placeholder:"如：.example.com",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify")},{field:"config.cookieConfig.cookieAttributes.path",label:"路径",type:"input",placeholder:"如：/",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify")},{field:"config.cookieConfig.cookieAttributes.maxAge",label:"最大年龄(秒)",type:"number",placeholder:"如：3600",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),props:{min:0}},{field:"config.cookieConfig.cookieAttributes.secure",label:"安全传输",type:"switch",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.cookieConfig.cookieAttributes.httpOnly",label:"仅HTTP",type:"switch",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.cookieConfig.cookieAttributes.sameSite",label:"SameSite",type:"select",placeholder:"请选择SameSite属性",span:12,show:e=>e.filterType==="cookie"&&(e["config.cookieConfig.operation"]==="add"||e["config.cookieConfig.operation"]==="modify"),options:[{label:"Strict",value:"Strict"},{label:"Lax",value:"Lax"},{label:"None",value:"None"}]},{field:"config.responseConfig.operation",label:"操作类型",type:"select",placeholder:"请选择操作类型",span:12,show:e=>e.filterType==="response",options:Mt.map(e=>({label:e.label,value:e.value}))},{field:"config.responseConfig.setInRequestPhase",label:"请求阶段设置",type:"switch",span:12,show:e=>e.filterType==="response",defaultValue:!1,props:{checkedValue:!0,uncheckedValue:!1}},{field:"config.responseConfig.filterConfigJson",label:"过滤器配置(JSON)",type:"input",placeholder:"请输入JSON格式的过滤器配置",span:24,show:e=>e.filterType==="response",props:{type:"textarea",rows:4}},{field:"config.responseConfig.conditionsJson",label:"条件配置(JSON)",type:"input",placeholder:"请输入JSON格式的条件配置",span:24,show:e=>e.filterType==="response",props:{type:"textarea",rows:3}}]},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}];return{moduleId:C,loading:w,filterList:o,pageInfo:c,searchFormConfig:f,gridConfig:O,formFields:r,formTabs:q,getFilterTypeLabel:s,getFilterTypeTagType:T,getFilterActionLabel:n,getFilterActionTagType:h,setFilterList:m,setLoading:_,resetPagination:F,updatePagination:R,addFilterToList:x,updateFilterInList:v,removeFilterFromList:k,removeFiltersFromList:M}}function Et(C,w,o,c){const f=ee(),s=()=>typeof w=="string"?w:w==null?void 0:w.value,T=()=>typeof o=="string"?o:o==null?void 0:o.value,n=Lt(C),{addFilterToList:h,updateFilterInList:O,removeFilterFromList:m,removeFiltersFromList:_}=n,F=async r=>{var e,d,l;try{n.setLoading(!0);let i=r;!i&&((e=c==null?void 0:c.value)!=null&&e.getFormData)&&(i=c.value.getFormData()||{});const u=i?Object.fromEntries(Object.entries(i).filter(([,y])=>y!==""&&y!==null&&y!==void 0)):{},g=s(),a=T(),p={...u,...g?{gatewayInstanceId:g}:{},...a?{routeConfigId:a}:{},...ve((d=n.pageInfo.value)==null?void 0:d.pageIndex,(l=n.pageInfo.value)==null?void 0:l.pageSize)},b=await at(p);if(U(b)){const y=te(b,[])||[];Array.isArray(y)&&y.length>0&&y.sort((J,P)=>(J.filterOrder||0)-(P.filterOrder||0)),n.setFilterList(y);const B=Ae(b);B&&Object.keys(B).length>0?n.updatePagination(B):n.resetPagination()}else f.error(G(b,"加载过滤器列表失败")),n.setFilterList([]),n.resetPagination()}catch(i){console.error("加载过滤器列表失败:",i),f.error(i.message||"加载过滤器列表失败"),n.setFilterList([]),n.resetPagination()}finally{n.setLoading(!1)}},R=async r=>{try{const e=await tt(r);return U(e)?te(e):(f.error(G(e,"获取过滤器详情失败")),null)}catch(e){return console.error("获取过滤器详情失败:",e),f.error(e.message||"获取过滤器详情失败"),null}},x=async r=>{try{n.setLoading(!0);const e={...r,tenantId:"default",gatewayInstanceId:s(),routeConfigId:T()},d=await et(e);if(U(d)){f.success("新增过滤器成功");const l=te(d,null);return l?h(l):await F(),!0}else return f.error(G(d,"新增过滤器失败")),!1}catch(e){return console.error("新增过滤器失败:",e),f.error(e.message||"新增过滤器失败"),!1}finally{n.setLoading(!1)}},v=async(r,e)=>{try{n.setLoading(!0);const d={...e,filterConfigId:r,tenantId:"default"},l=await Ze(d);if(U(l)){f.success("编辑过滤器成功");const i=te(l,null);return i?O(i.filterConfigId,i.tenantId,i):await F(),!0}else return f.error(G(l,"编辑过滤器失败")),!1}catch(d){return console.error("编辑过滤器失败:",d),f.error(d.message||"编辑过滤器失败"),!1}finally{n.setLoading(!1)}};return{model:n,loadFilterList:F,getFilterDetail:R,addFilter:x,editFilter:v,deleteFilter:async r=>{try{n.setLoading(!0);const e=await _e(r);return U(e)?(f.success("删除过滤器成功"),m(r),n.filterList.value.length===0&&n.pageInfo.value&&n.pageInfo.value.pageIndex>1&&(n.updatePagination({pageIndex:n.pageInfo.value.pageIndex-1}),await F()),!0):(f.error(G(e,"删除过滤器失败")),!1)}catch(e){return console.error("删除过滤器失败:",e),f.error(e.message||"删除过滤器失败"),!1}finally{n.setLoading(!1)}},deleteFilters:async r=>{try{n.setLoading(!0);const d=(await Promise.all(r.map(l=>_e(l)))).filter(l=>U(l)).length;return d===r.length?(f.success(`成功删除 ${d} 个过滤器`),_(r),n.filterList.value.length===0&&n.pageInfo.value&&n.pageInfo.value.pageIndex>1&&(n.updatePagination({pageIndex:n.pageInfo.value.pageIndex-1}),await F()),!0):(f.warning(`部分删除成功：${d}/${r.length}`),await F(),!1)}catch(e){return console.error("批量删除过滤器失败:",e),f.error(e.message||"批量删除过滤器失败"),!1}finally{n.setLoading(!1)}},toggleFilterStatus:async r=>{const e=r.activeFlag==="Y"?"N":"Y";return await v(r.filterConfigId,{...r,activeFlag:e})}}}function qt(C,w,o,c,f){const s=ee(),T=Oe(),n=Et(C.value,o,c,f),h=N(!1),O=N("create"),m=N(null),_=(a=!0)=>{const p=typeof o=="string"?o:o==null?void 0:o.value,b=typeof c=="string"?c:c==null?void 0:c.value;return!p&&!b?(a&&s.warning("请先选择网关实例或路由"),!1):!0},F=async a=>{n.model.resetPagination(),await n.loadFilterList(a)},R=async({currentPage:a,pageSize:p})=>{n.model.updatePagination({pageIndex:a,pageSize:p}),await n.loadFilterList()},x=async a=>{switch(a){case"add":v();break;case"delete":await u();break;default:console.warn("未知的工具栏按钮:",a)}},v=()=>{_()&&(O.value="create",m.value=null,h.value=!0)},k=async a=>{if(!a.filterConfigId){s.warning("过滤器配置ID不能为空");return}try{const p=await n.getFilterDetail(a.filterConfigId);if(p){O.value="edit";const b=e(p.filterConfig,p.filterType);m.value={...p,...b},h.value=!0}else{O.value="edit";const b=e(a.filterConfig,a.filterType);m.value={...a,...b},h.value=!0}}catch{O.value="edit";const b=e(a.filterConfig,a.filterType);m.value={...a,...b},h.value=!0}},M=async a=>{if(!a.filterConfigId){s.warning("过滤器配置ID不能为空");return}try{const p=await n.getFilterDetail(a.filterConfigId);if(p){O.value="view";const b=e(p.filterConfig,p.filterType);m.value={...p,...b},h.value=!0}else{O.value="view";const b=e(a.filterConfig,a.filterType);m.value={...a,...b},h.value=!0}}catch{O.value="view";const b=e(a.filterConfig,a.filterType);m.value={...a,...b},h.value=!0}},q=()=>{h.value=!1,m.value=null},r=a=>{const p={};switch(a.filterType){case"header":p.headerConfig={modifierType:a["config.headerConfig.modifierType"],headerName:a["config.headerConfig.headerName"],headerValue:a["config.headerConfig.headerValue"],targetHeaderName:a["config.headerConfig.targetHeaderName"],isRequestHeader:a["config.headerConfig.isRequestHeader"]??!0};break;case"query-param":p.queryParamConfig={modifierType:a["config.queryParamConfig.modifierType"],paramName:a["config.queryParamConfig.paramName"],paramValue:a["config.queryParamConfig.paramValue"],targetParamName:a["config.queryParamConfig.targetParamName"]};break;case"strip":p.stripConfig={prefix:a["config.stripConfig.prefix"]};break;case"rewrite":p.rewriteConfig={mode:a["config.rewriteConfig.mode"],from:a["config.rewriteConfig.from"],to:a["config.rewriteConfig.to"]};break;case"method":p.methodConfig={mode:a["config.methodConfig.mode"],allowedMethods:a["config.methodConfig.allowedMethods"],deniedMethods:a["config.methodConfig.deniedMethods"],rejectStatusCode:a["config.methodConfig.rejectStatusCode"]??405,rejectMessage:a["config.methodConfig.rejectMessage"]??"Method Not Allowed",caseSensitive:a["config.methodConfig.caseSensitive"]??!1};break;case"body":p.bodyConfig={modifierType:a["config.bodyConfig.modifierType"],operation:a["config.bodyConfig.operation"],allowedContentTypes:a["config.bodyConfig.allowedContentTypes"],maxBodySize:a["config.bodyConfig.maxBodySize"],filterConfig:a["config.bodyConfig.filterConfigJson"]?JSON.parse(a["config.bodyConfig.filterConfigJson"]):{}};break;case"cookie":p.cookieConfig={operation:a["config.cookieConfig.operation"],cookieName:a["config.cookieConfig.cookieName"],cookieValue:a["config.cookieConfig.cookieValue"],applyToResponse:a["config.cookieConfig.applyToResponse"]??!1,cookieAttributes:{domain:a["config.cookieConfig.cookieAttributes.domain"],path:a["config.cookieConfig.cookieAttributes.path"],maxAge:a["config.cookieConfig.cookieAttributes.maxAge"],secure:a["config.cookieConfig.cookieAttributes.secure"]??!1,httpOnly:a["config.cookieConfig.cookieAttributes.httpOnly"]??!1,sameSite:a["config.cookieConfig.cookieAttributes.sameSite"]}};break;case"response":p.responseConfig={operation:a["config.responseConfig.operation"],setInRequestPhase:a["config.responseConfig.setInRequestPhase"]??!1,filterConfig:a["config.responseConfig.filterConfigJson"]?JSON.parse(a["config.responseConfig.filterConfigJson"]):{},conditions:a["config.responseConfig.conditionsJson"]?JSON.parse(a["config.responseConfig.conditionsJson"]):{}};break}return JSON.stringify(p)},e=(a,p)=>{const b={};if(!a)return b;try{const y=JSON.parse(a);switch(p){case"header":y.headerConfig&&(b["config.headerConfig.modifierType"]=y.headerConfig.modifierType,b["config.headerConfig.headerName"]=y.headerConfig.headerName,b["config.headerConfig.headerValue"]=y.headerConfig.headerValue,b["config.headerConfig.targetHeaderName"]=y.headerConfig.targetHeaderName,b["config.headerConfig.isRequestHeader"]=y.headerConfig.isRequestHeader??!0);break;case"query-param":y.queryParamConfig&&(b["config.queryParamConfig.modifierType"]=y.queryParamConfig.modifierType,b["config.queryParamConfig.paramName"]=y.queryParamConfig.paramName,b["config.queryParamConfig.paramValue"]=y.queryParamConfig.paramValue,b["config.queryParamConfig.targetParamName"]=y.queryParamConfig.targetParamName);break;case"strip":y.stripConfig&&(b["config.stripConfig.prefix"]=y.stripConfig.prefix);break;case"rewrite":y.rewriteConfig&&(b["config.rewriteConfig.mode"]=y.rewriteConfig.mode,b["config.rewriteConfig.from"]=y.rewriteConfig.from,b["config.rewriteConfig.to"]=y.rewriteConfig.to);break;case"method":y.methodConfig&&(b["config.methodConfig.mode"]=y.methodConfig.mode,b["config.methodConfig.allowedMethods"]=y.methodConfig.allowedMethods,b["config.methodConfig.deniedMethods"]=y.methodConfig.deniedMethods,b["config.methodConfig.rejectStatusCode"]=y.methodConfig.rejectStatusCode??405,b["config.methodConfig.rejectMessage"]=y.methodConfig.rejectMessage??"Method Not Allowed",b["config.methodConfig.caseSensitive"]=y.methodConfig.caseSensitive??!1);break;case"body":y.bodyConfig&&(b["config.bodyConfig.modifierType"]=y.bodyConfig.modifierType,b["config.bodyConfig.operation"]=y.bodyConfig.operation,b["config.bodyConfig.allowedContentTypes"]=y.bodyConfig.allowedContentTypes,b["config.bodyConfig.maxBodySize"]=y.bodyConfig.maxBodySize,b["config.bodyConfig.filterConfigJson"]=JSON.stringify(y.bodyConfig.filterConfig||{},null,2));break;case"cookie":y.cookieConfig&&(b["config.cookieConfig.operation"]=y.cookieConfig.operation,b["config.cookieConfig.cookieName"]=y.cookieConfig.cookieName,b["config.cookieConfig.cookieValue"]=y.cookieConfig.cookieValue,b["config.cookieConfig.applyToResponse"]=y.cookieConfig.applyToResponse??!1,y.cookieConfig.cookieAttributes&&(b["config.cookieConfig.cookieAttributes.domain"]=y.cookieConfig.cookieAttributes.domain,b["config.cookieConfig.cookieAttributes.path"]=y.cookieConfig.cookieAttributes.path,b["config.cookieConfig.cookieAttributes.maxAge"]=y.cookieConfig.cookieAttributes.maxAge,b["config.cookieConfig.cookieAttributes.secure"]=y.cookieConfig.cookieAttributes.secure??!1,b["config.cookieConfig.cookieAttributes.httpOnly"]=y.cookieConfig.cookieAttributes.httpOnly??!1,b["config.cookieConfig.cookieAttributes.sameSite"]=y.cookieConfig.cookieAttributes.sameSite));break;case"response":y.responseConfig&&(b["config.responseConfig.operation"]=y.responseConfig.operation,b["config.responseConfig.setInRequestPhase"]=y.responseConfig.setInRequestPhase??!1,b["config.responseConfig.filterConfigJson"]=JSON.stringify(y.responseConfig.filterConfig||{},null,2),b["config.responseConfig.conditionsJson"]=JSON.stringify(y.responseConfig.conditions||{},null,2));break}}catch(y){console.error("解析过滤器配置失败:",y)}return b},d=async a=>{if(a){if(O.value==="view"){q();return}if(!_())return!1;try{const p=r(a),b={filterConfigId:a.filterConfigId,gatewayInstanceId:a.gatewayInstanceId||(typeof o=="string"?o:o==null?void 0:o.value),routeConfigId:a.routeConfigId||(typeof c=="string"?c:c==null?void 0:c.value),filterName:a.filterName,filterType:a.filterType,filterAction:a.filterAction,filterOrder:a.filterOrder,filterDesc:a.filterDesc,activeFlag:a.activeFlag,noteText:a.noteText,filterConfig:p};let y=!1;O.value==="create"?y=await n.addFilter(b):O.value==="edit"&&m.value&&(y=await n.editFilter(m.value.filterConfigId,b)),y&&q()}catch(p){console.error("提交过滤器配置失败:",p),s.error(p.message||"提交失败，请重试")}}},l=async({menu:a,row:p})=>{switch(a.code){case"view":await M(p);break;case"edit":await k(p);break;case"toggle-status":await g(p);break;case"delete":await i(p);break;default:console.warn("未知的菜单项:",a.code)}},i=async a=>{await T.warning({title:"确认删除",content:`确定要删除过滤器"${a.filterName}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消"})&&await n.deleteFilter(a.filterConfigId)},u=async()=>{var y;if(!((y=w==null?void 0:w.value)!=null&&y.getCheckboxRecords)){s.warning("无法获取选中的记录");return}const a=w.value.getCheckboxRecords();if(!a||a.length===0){s.warning("请先选择要删除的过滤器");return}if(!await T.warning({title:"确认批量删除",content:`确定要删除选中的 ${a.length} 个过滤器吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消"}))return;const b=a.map(B=>B.filterConfigId);await n.deleteFilters(b)},g=async a=>{await n.toggleFilterStatus(a)};return{service:n,formDialogVisible:h,formDialogMode:O,currentEditFilter:m,handleSearch:F,handlePageChange:R,handleToolbarClick:x,handleMenuClick:l,openAddDialog:v,openEditDialog:k,openViewDialog:M,closeFormDialog:q,handleFormSubmit:d,handleDelete:i,handleBatchDelete:u,handleToggleStatus:g}}const Dt={class:"filter-config-list-modal",id:"filter-config-list-modal"},Kt={style:{"font-weight":"bold",color:"#0066cc"}},Yt=le({name:"FilterConfigListModal",__name:"FilterConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:""},width:{default:1200},to:{type:[String,Boolean],default:void 0},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0},filterScope:{default:"global"}},emits:["update:visible","close","refresh"],setup(C,{emit:w}){const o=C,c=w,f=N(),s=N(),T=N(o.moduleId),n=N(o.visible),h=ae(()=>o.visible,g=>{n.value=g}),O=N(o.gatewayInstanceId),m=N(o.routeConfigId),_=ae(()=>o.gatewayInstanceId,g=>{O.value=g}),F=ae(()=>o.routeConfigId,g=>{m.value=g});ce(()=>{h(),_(),F()});const{service:R,formDialogVisible:x,formDialogMode:v,currentEditFilter:k,handleFormSubmit:M,handleToolbarClick:q,handleMenuClick:r,handleSearch:e,handlePageChange:d,handleToggleStatus:l}=qt(T,s,O,m,f),i=g=>{n.value=g,c("update:visible",g),g?(c("refresh"),R.loadFilterList()):c("close")},u=()=>{n.value||(x.value=!1,v.value="create",k.value=null,R.model.filterList.value=[],R.model.resetPagination())};return(g,a)=>(Y(),ie(t(Se),{visible:n.value,title:o.title||(o.filterScope==="global"?"全局过滤器配置列表":"路由过滤器配置列表"),width:o.width||1200,to:o.to,"show-footer":!1,"onUpdate:visible":i,onAfterLeave:u},{default:S(()=>[E("div",Dt,[A(t(fe),{direction:"vertical","no-resize":!0},{1:S(()=>[A(Ce,oe({ref_key:"searchFormRef",ref:f,"module-id":t(R).model.moduleId},t(R).model.searchFormConfig,{onSearch:t(e),onToolbarClick:t(q)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:S(()=>[A(t(ye),oe({ref_key:"gridRef",ref:s,"module-id":t(R).model.moduleId,data:t(R).model.filterList,loading:t(R).model.loading},t(R).model.gridConfig,{onPageChange:t(d),onMenuClick:a[0]||(a[0]=({code:p,row:b})=>t(r)({menu:{code:p},row:b}))}),{filterOrder:S(({row:p})=>[E("span",Kt,K(p.filterOrder),1)]),filterType:S(({row:p})=>[A(t($),{type:t(R).model.getFilterTypeTagType(p.filterType),size:"small"},{default:S(()=>[H(K(t(R).model.getFilterTypeLabel(p.filterType)),1)]),_:2},1032,["type"])]),filterAction:S(({row:p})=>[A(t($),{type:t(R).model.getFilterActionTagType(p.filterAction),size:"small"},{default:S(()=>[H(K(t(R).model.getFilterActionLabel(p.filterAction)),1)]),_:2},1032,["type"])]),activeFlag:S(({row:p})=>[A(t(Pe),{value:p.activeFlag==="Y","onUpdate:value":()=>t(l)(p),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),A(me,{visible:t(x),"onUpdate:visible":a[1]||(a[1]=p=>Q(x)?x.value=p:null),mode:t(v),title:t(v)==="create"?"新增过滤器配置":t(v)==="edit"?"编辑过滤器配置":"查看过滤器配置详情",to:"#filter-config-list-modal","form-fields":t(R).model.formFields,"form-tabs":t(R).model.formTabs,"initial-data":t(k)||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(R).model.loading.value,onSubmit:t(M)},null,8,["visible","mode","title","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),He=ne(Yt,[["__scopeId","data-v-d7bc46d3"]]);var he=(C=>(C.SEQUENTIAL="SEQUENTIAL",C.PARALLEL="PARALLEL",C))(he||{});function zt(){const C="hub0021",w=N(!1),o=N([]),c=N(1),f=N(20),s=N(0),T=N(""),n=de(()=>o.value.map(r=>({key:r.gatewayInstanceId,label:h(r),instance:r})));function h(r){const e=r.tlsEnabled==="Y"?r.httpsPort:r.httpPort;return`${r.instanceName||"未命名"} (${r.bindAddress||"-"}:${e||"-"})`}function O(r){o.value=r}function m(r){w.value=r}function _(r){c.value=r}function F(r){f.value=r}function R(r){T.value=r}function x(r){s.value=r}function v(){c.value=1}function k(){T.value=""}const M={enabled:!0,showCopyNode:!0,customMenus:[{code:"routerConfig",name:"Router配置",prefixIcon:()=>X(Z,{size:14},{default:()=>X(Ge)})},{code:"globalFilterConfig",name:"全局过滤器配置",prefixIcon:()=>X(Z,{size:14},{default:()=>X(gt)})}]},q={tabs:[{key:"basic",label:"基本信息"},{key:"cache",label:"路由缓存配置"},{key:"filters",label:"全局过滤器配置"},{key:"performance",label:"性能优化配置"},{key:"error",label:"错误处理配置"},{key:"other",label:"其他配置"}],fields:[{field:"routerConfigId",label:"Router配置ID",type:"input",span:12,tabKey:"basic",primary:!0,show:!1},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:12,tabKey:"basic",show:!1},{field:"routerName",label:"Router名称",type:"input",placeholder:"请输入Router名称",span:12,tabKey:"basic",required:!0,tips:"Router配置的名称标识，用于区分不同的Router配置",rules:[{required:!0,message:"请输入Router名称",trigger:["blur","input"]},{max:50,message:"Router名称不能超过50个字符",trigger:["blur","input"]}]},{field:"defaultPriority",label:"默认优先级",type:"number",placeholder:"请输入默认优先级",span:12,tabKey:"basic",required:!0,defaultValue:100,tips:"默认路由优先级，数值越小优先级越高",props:{min:0,max:9999},rules:[{required:!0,type:"number",message:"请输入默认优先级",trigger:["blur","change"]}]},{field:"routerDesc",label:"Router描述",type:"textarea",placeholder:"请输入Router描述信息",span:24,tabKey:"basic",tips:"Router配置的描述说明，用于记录配置的用途、注意事项等信息",props:{rows:2}},{field:"enableRouteCache",label:"启用路由缓存",type:"switch",span:12,tabKey:"cache",defaultValue:"Y",tips:"是否启用路由缓存。启用后可以缓存路由匹配结果，提高路由匹配性能",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"routeCacheTtlSeconds",label:"缓存TTL(秒)",type:"number",placeholder:"请输入缓存TTL",span:12,tabKey:"cache",show:r=>r.enableRouteCache==="Y",required:!0,defaultValue:300,tips:"路由缓存的有效期，超过此时间的缓存将被清除",props:{min:1,max:86400},rules:[{required:!0,type:"number",message:"请输入缓存TTL",trigger:["blur","change"]}]},{field:"maxRoutes",label:"最大路由数",type:"number",placeholder:"请输入最大路由数",span:12,tabKey:"cache",show:r=>r.enableRouteCache==="Y",defaultValue:1e3,tips:"路由缓存中最多可以缓存的路由数量",props:{min:1,max:1e4}},{field:"routeMatchTimeout",label:"路由匹配超时(ms)",type:"number",placeholder:"请输入路由匹配超时时间",span:12,tabKey:"cache",show:r=>r.enableRouteCache==="Y",defaultValue:5e3,tips:"路由匹配的最大超时时间，超过此时间未匹配成功则返回未找到",props:{min:100,max:3e4}},{field:"enableGlobalFilters",label:"启用全局过滤器",type:"switch",span:12,tabKey:"filters",defaultValue:"Y",tips:"是否启用全局过滤器。全局过滤器作用于所有路由，在路由匹配前执行",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"filterExecutionMode",label:"过滤器执行模式",type:"select",placeholder:"请选择执行模式",span:12,tabKey:"filters",show:r=>r.enableGlobalFilters==="Y",defaultValue:he.SEQUENTIAL,tips:"过滤器的执行模式：顺序执行或并行执行",options:[{label:"顺序执行",value:he.SEQUENTIAL},{label:"并行执行",value:he.PARALLEL}]},{field:"maxFilterChainDepth",label:"最大过滤器链深度",type:"number",placeholder:"请输入最大过滤器链深度",span:12,tabKey:"filters",show:r=>r.enableGlobalFilters==="Y",defaultValue:10,tips:"过滤器链的最大深度，防止过滤器链过长导致性能问题",props:{min:1,max:100}},{field:"enableAsyncProcessing",label:"启用异步处理",type:"switch",span:12,tabKey:"filters",show:r=>r.enableGlobalFilters==="Y",defaultValue:"N",tips:"是否启用过滤器的异步处理模式",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableStrictMode",label:"启用严格模式",type:"switch",span:12,tabKey:"performance",defaultValue:"N",tips:"是否启用严格模式。严格模式下路由匹配更加严格，性能可能略有下降",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableRoutePooling",label:"启用路由池",type:"switch",span:12,tabKey:"performance",defaultValue:"N",tips:"是否启用路由对象池。启用后可以复用路由对象，减少内存分配",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"routePoolSize",label:"路由池大小",type:"number",placeholder:"请输入路由池大小",span:12,tabKey:"performance",show:r=>r.enableRoutePooling==="Y",defaultValue:100,tips:"路由对象池的大小，影响可以复用的路由对象数量",props:{min:10,max:1e3}},{field:"caseSensitive",label:"大小写敏感",type:"switch",span:12,tabKey:"performance",defaultValue:"N",tips:"路径匹配是否区分大小写",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"removeTrailingSlash",label:"移除尾部斜杠",type:"switch",span:12,tabKey:"performance",defaultValue:"Y",tips:"是否自动移除路径尾部的斜杠进行匹配",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableMetrics",label:"启用监控指标",type:"switch",span:12,tabKey:"performance",defaultValue:"Y",tips:"是否启用路由监控指标收集",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"enableFallback",label:"启用降级处理",type:"switch",span:12,tabKey:"error",defaultValue:"N",tips:"是否启用降级处理。启用后当路由匹配失败时，可以降级到指定的路由",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"fallbackRoute",label:"降级路由",type:"input",placeholder:"请输入降级路由路径",span:12,tabKey:"error",show:r=>r.enableFallback==="Y",tips:"降级路由的路径，当路由匹配失败时使用此路由"},{field:"notFoundStatusCode",label:"404状态码",type:"number",placeholder:"请输入404状态码",span:12,tabKey:"error",required:!0,defaultValue:404,tips:"路由未找到时返回的HTTP状态码",props:{min:400,max:599},rules:[{required:!0,type:"number",message:"请输入404状态码",trigger:["blur","change"]}]},{field:"notFoundMessage",label:"404消息",type:"input",placeholder:"请输入404消息",span:12,tabKey:"error",required:!0,defaultValue:"Route not found",tips:"路由未找到时返回的错误消息",rules:[{required:!0,message:"请输入404消息",trigger:["blur","input"]}]},{field:"enableTracing",label:"启用链路追踪",type:"switch",span:12,tabKey:"other",defaultValue:"N",tips:"是否启用链路追踪功能",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"activeFlag",label:"配置状态",type:"switch",span:12,tabKey:"other",defaultValue:"Y",tips:"Router配置的启用状态",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"noteText",label:"备注信息",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",tips:"Router配置的备注说明",props:{rows:3}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"Router配置的创建时间"},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"Router配置的创建人"},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"Router配置的最后修改时间"},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"Router配置的最后修改人"},{field:"currentVersion",label:"版本号",type:"number",span:12,tabKey:"other",disabled:!0,tips:"Router配置的当前版本号"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:12,tabKey:"other",disabled:!0,show:!1,tips:"Router配置的操作序列标识"}]};return{moduleId:C,loading:w,instanceList:o,currentPage:c,pageSize:f,totalCount:s,filterKeyword:T,treeData:n,treeMenuConfig:M,routerFormConfig:q,getInstanceLabel:h,setInstanceList:O,setLoading:m,setCurrentPage:_,setPageSize:F,setTotalCount:x,setFilterKeyword:R,resetPage:v,clearFilter:k}}function Ht(C){const w=ee(),{loading:o,currentPage:c,pageSize:f,filterKeyword:s,setInstanceList:T,setTotalCount:n,setLoading:h,resetPage:O}=C;async function m(){try{h(!0);const _=await it({instanceName:s.value.trim()||void 0,pageIndex:c.value,pageSize:f.value});if(U(_)){const F=te(_,[]);T(Array.isArray(F)?F:[]);try{const R=Ae(_);n(R.totalCount||0)}catch(R){console.warn("解析分页信息失败:",R),n(0)}}else w.error(_.errMsg||"获取网关实例列表失败"),T([]),n(0)}catch(_){console.error("加载网关实例失败:",_),w.error("加载网关实例失败"),T([]),n(0)}finally{h(!1)}}return{loadGatewayInstances:m}}function $t(){const C=ee(),w=zt(),o=Ht(w),c=N(!1),f=N("create"),s=N(null),T=N(!1),n=N(""),h=N(!1),O=ae(w.filterKeyword,()=>{w.resetPage(),o.loadGatewayInstances()});ce(()=>{O()});function m({option:i}){return i.instance?X(Z,{size:16,color:"var(--g-primary)",style:{marginRight:"6px",flexShrink:0}},{default:()=>X(be)}):null}function _({option:i}){return X("span",{class:"tree-node-label",style:{display:"inline-block",padding:"1px 4px",borderRadius:"4px",transition:"background-color 0.2s"}},i.label)}function F({option:i}){const u=i;return u.instance?X($,{type:u.instance.healthStatus==="Y"?"success":"warning",size:"small",style:{marginLeft:"8px",flexShrink:0}},{default:()=>u.instance.healthStatus==="Y"?"健康":"异常"}):null}function R(i,u,g){const a=u;a.instance&&g("select",a.instance.gatewayInstanceId,a.instance)}function x({currentPage:i,pageSize:u}){w.setCurrentPage(i),w.setPageSize(u),o.loadGatewayInstances()}function v(){o.loadGatewayInstances()}const k=async()=>{const i=n.value;if(i)try{const u=await nt(i);if(U(u)){const g=te(u,null);g?(s.value=g,f.value="edit"):(s.value=null,f.value="create")}else s.value=null,f.value="create"}catch{s.value=null,f.value="create"}},M=async i=>{n.value=i.gatewayInstanceId,await k(),c.value=!0},q=i=>{const u=g=>{if(typeof g=="string"&&g)try{return JSON.parse(g)}catch{return{}}return g||{}};return{...i,routerMetadata:u(i.routerMetadata),customConfig:u(i.customConfig)}},r=()=>{if(f.value==="create")return{gatewayInstanceId:n.value,routerName:"默认Router",routerDesc:"",defaultPriority:100,enableRouteCache:"Y",routeCacheTtlSeconds:300,maxRoutes:1e3,routeMatchTimeout:5e3,enableStrictMode:"N",enableMetrics:"Y",enableTracing:"N",caseSensitive:"N",removeTrailingSlash:"Y",enableGlobalFilters:"Y",filterExecutionMode:"SEQUENTIAL",maxFilterChainDepth:10,enableRoutePooling:"N",routePoolSize:100,enableAsyncProcessing:"N",enableFallback:"N",fallbackRoute:"",notFoundStatusCode:404,notFoundMessage:"Route not found",activeFlag:"Y",noteText:"",routerMetadata:{},customConfig:{}};if(s.value)return q(s.value)},e=async i=>{if(!i||f.value==="view")return!1;try{T.value=!0;const u={...i,gatewayInstanceId:n.value||i.gatewayInstanceId};i.routerMetadata?u.routerMetadata=typeof i.routerMetadata=="string"?i.routerMetadata:JSON.stringify(i.routerMetadata):u.routerMetadata="{}",i.customConfig?u.customConfig=typeof i.customConfig=="string"?i.customConfig:JSON.stringify(i.customConfig):u.customConfig="{}";let g=!1;if(f.value==="create"){const a=await ot(u);U(a)?(C.success(G(a,"创建Router配置成功")),g=!0):C.error(G(a,"创建Router配置失败"))}else if(f.value==="edit"&&s.value){const a=s.value.routerConfigId;if(!a)return C.error("Router配置ID不存在"),!1;const p=await lt({...u,routerConfigId:a});U(p)?(C.success(G(p,"更新Router配置成功")),g=!0):C.error(G(p,"更新Router配置失败"))}return g&&await k(),g}catch{return C.error("操作失败"),!1}finally{T.value=!1}};function d(i){n.value=i.gatewayInstanceId,h.value=!0}async function l({code:i,node:u}){if(!u)return;const g=u;if(!g.instance)return;const a=g.instance;switch(i){case"routerConfig":await M(a);break;case"globalFilterConfig":d(a);break}}return{model:w,service:o,routerFormDialogVisible:c,routerFormDialogMode:f,currentEditRouter:s,routerSubmitting:T,getRouterFormInitialData:r,currentGatewayInstanceId:n,globalFilterConfigDialogVisible:h,renderNodePrefix:m,renderNodeLabel:_,renderNodeSuffix:F,handleTreeSelect:R,handlePageChange:x,handleRefresh:v,handleMenuClick:l,handleRouterFormSubmit:e}}const Ut={class:"gateway-instance-tree"},Gt={class:"instance-tree-header"},Bt={class:"instance-header"},Jt={class:"instance-filter"},Wt={class:"instance-tree-container"},jt={key:0,class:"instance-pagination"},Xt=le({name:"GatewayInstanceTree",__name:"GatewayInstanceTree",props:{parentModuleId:{default:"route-management"}},emits:["select"],setup(C,{expose:w,emit:o}){const c=C,f=o,s=$t();return Ye(()=>{s.service.loadGatewayInstances()}),w({refresh:s.service.loadGatewayInstances,resetPage:s.model.resetPage,clearFilter:s.model.clearFilter}),(T,n)=>(Y(),j("div",Ut,[E("div",Gt,[E("div",Bt,[A(t(Z),{size:"20",color:"var(--g-primary)"},{default:S(()=>[A(t(be))]),_:1}),n[4]||(n[4]=E("span",null,"网关实例列表",-1)),n[5]||(n[5]=E("div",{class:"flex-spacer"},null,-1)),A(t(pe),{text:"",size:"small",onClick:t(s).handleRefresh,disabled:t(s).model.loading.value,loading:t(s).model.loading.value},{icon:S(()=>[A(t(Z),{component:t(ze)},null,8,["component"])]),_:1},8,["onClick","disabled","loading"])]),E("div",Jt,[A(t(Be),{value:t(s).model.filterKeyword.value,"onUpdate:value":n[0]||(n[0]=h=>t(s).model.filterKeyword.value=h),placeholder:"搜索实例名称、地址或端口",clearable:"",size:"small"},{prefix:S(()=>[A(t(Z),{component:t(Je)},null,8,["component"])]),_:1},8,["value"])])]),E("div",Wt,[A(t(We),{show:t(s).model.loading.value},{default:S(()=>[t(s).model.treeData.value.length>0?(Y(),ie(t(Ue),{key:0,data:t(s).model.treeData.value,"show-icon":!0,"block-line":!0,"node-height":32,"show-line":!0,ellipsis:!0,"ellipsis-line-clamp":1,"ellipsis-tooltip":!0,"module-id":t(s).model.moduleId,"menu-config":t(s).model.treeMenuConfig,"render-prefix":t(s).renderNodePrefix,"render-label":t(s).renderNodeLabel,"render-suffix":t(s).renderNodeSuffix,onSelect:n[1]||(n[1]=(h,O)=>t(s).handleTreeSelect(h,O,f)),onMenuClick:t(s).handleMenuClick},null,8,["data","module-id","menu-config","render-prefix","render-label","render-suffix","onMenuClick"])):(Y(),ie(t(je),{key:1,description:"暂无可用的网关实例",style:{padding:"40px 0"}},{icon:S(()=>[A(t(Z),{size:"40",color:"var(--g-primary)"},{default:S(()=>[A(t(be))]),_:1})]),_:1}))]),_:1},8,["show"])]),t(s).model.totalCount.value>0?(Y(),j("div",jt,[A(t($e),{"current-page":t(s).model.currentPage.value,"page-size":t(s).model.pageSize.value,total:t(s).model.totalCount.value,layouts:["PrevPage","NextPage"],align:"center",onPageChange:t(s).handlePageChange},null,8,["current-page","page-size","total","onPageChange"])])):Ne("",!0),A(me,{visible:t(s).routerFormDialogVisible.value,"onUpdate:visible":n[2]||(n[2]=h=>t(s).routerFormDialogVisible.value=h),mode:t(s).routerFormDialogMode.value,title:t(s).routerFormDialogMode.value==="create"?"新增Router配置":t(s).routerFormDialogMode.value==="edit"?"编辑Router配置":"查看Router配置详情",to:`#${c.parentModuleId}`,"form-fields":t(s).model.routerFormConfig.fields,"form-tabs":t(s).model.routerFormConfig.tabs,"initial-data":t(s).getRouterFormInitialData(),"auto-close-on-confirm":!1,"confirm-loading":t(s).routerSubmitting.value,onSubmit:t(s).handleRouterFormSubmit},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),A(He,{visible:t(s).globalFilterConfigDialogVisible.value,"onUpdate:visible":n[3]||(n[3]=h=>t(s).globalFilterConfigDialogVisible.value=h),"module-id":"hub0021:globalFilterConfig","gateway-instance-id":t(s).currentGatewayInstanceId.value,"filter-scope":"global",to:`#${c.parentModuleId}`},null,8,["visible","gateway-instance-id","to"])]))}}),Qt=ne(Xt,[["__scopeId","data-v-cf2ff505"]]);function Zt(){const C="hub0021-service-selector",w=N(!1),o=N([]),c=N(),f={fields:[{field:"serviceName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:8,clearable:!0},{field:"serviceDefinitionId",label:"服务ID",type:"input",placeholder:"请输入服务ID",span:8,clearable:!0},{field:"serviceType",label:"服务类型",type:"select",placeholder:"请选择服务类型",span:8,clearable:!0,options:[{label:"全部",value:""},{label:"服务发现",value:1},{label:"静态配置",value:0}]}],showSearchButton:!0,showResetButton:!0},s={paginationConfig:{show:!0,pageInfo:c},columns:[{field:"serviceDefinitionId",title:"服务ID",align:"center",showOverflow:"tooltip",width:200},{field:"serviceName",title:"服务名称",sortable:!0,align:"center",showOverflow:"tooltip",width:200},{field:"serviceDesc",title:"服务描述",align:"center",showOverflow:"tooltip",width:250},{field:"serviceType",title:"服务类型",align:"center",slots:{default:"serviceType"},width:120},{field:"loadBalanceStrategy",title:"负载均衡",align:"center",slots:{default:"loadBalanceStrategy"},width:150},{field:"healthCheckEnabled",title:"健康检查",align:"center",slots:{default:"healthCheckEnabled"},width:120},{field:"activeFlag",title:"状态",align:"center",slots:{default:"activeFlag"},width:100},{field:"editTime",title:"修改时间",sortable:!0,align:"center",showOverflow:"tooltip",formatter:({cellValue:m})=>m?re(m,"YYYY-MM-DD HH:mm:ss"):"",width:180},{field:"editWho",title:"修改人",align:"center",showOverflow:"tooltip",width:120}],showCheckbox:!0};function T(m){o.value=m}function n(m){w.value=m}function h(m){c.value?Object.assign(c.value,m):c.value=m}function O(){c.value=void 0}return{moduleId:C,loading:w,serviceList:o,pageInfo:c,searchFormConfig:f,gridConfig:s,setServiceList:T,setLoading:n,updatePagination:h,resetPagination:O}}function ea(C,w,o){const c=ee(),{loading:f,setServiceList:s,setLoading:T,updatePagination:n}=C;async function h(O={}){var m,_,F;if(!w){s([]);return}try{T(!0);let R=O;!R&&((m=o==null?void 0:o.value)!=null&&m.getFormData)&&(R=o.value.getFormData()||{});const x=Object.fromEntries(Object.entries(R).filter(([,M])=>M!==""&&M!==null&&M!==void 0)),v={gatewayInstanceId:w,...x,...ve((_=C.pageInfo.value)==null?void 0:_.pageIndex,(F=C.pageInfo.value)==null?void 0:F.pageSize)},k=await st(v);if(U(k)){const M=te(k,[]);s(Array.isArray(M)?M:[]),n(Ae(k))}else c.error(k.errMsg||"获取服务定义列表失败"),s([]),n({})}catch(R){console.error("加载服务定义列表失败:",R),c.error("加载服务定义列表失败: "+((R==null?void 0:R.message)||"未知错误")),s([]),n({})}finally{T(!1)}}return{loadServiceDefinitions:h}}function ta(C,w,o,c){const f=ee(),s=()=>typeof w=="string"?w:w==null?void 0:w.value,T=ea(C,s(),c),n=async _=>{if(!s()){f.warning("请先选择网关实例");return}C.resetPagination(),await T.loadServiceDefinitions(_)},h=async()=>{var _;(_=c==null?void 0:c.value)!=null&&_.resetFields&&c.value.resetFields(),C.resetPagination(),await n()};return{service:T,handleSearch:n,handleReset:h,handlePageChange:async({currentPage:_,pageSize:F})=>{C.updatePagination({pageIndex:_,pageSize:F}),await T.loadServiceDefinitions()},handleToolbarClick:async(_,F)=>{switch(_){case"search":await n(F);break;case"reset":await h();break}}}}const aa=["id"],ia=le({name:"ServiceDefinitionListModal",__name:"ServiceDefinitionListModal",props:{visible:{type:Boolean,default:!1},title:{default:"选择服务定义"},width:{default:1200},to:{type:[String,Boolean],default:void 0},gatewayInstanceId:{default:void 0}},emits:["update:visible","close","refresh","select"],setup(C,{emit:w}){const o=C,c=w,f=ee(),s=N(),T=N(),n=N([]),h=Zt(),O=N(o.gatewayInstanceId),m=ae(()=>o.gatewayInstanceId,d=>{O.value=d}),{handleSearch:_,handlePageChange:F,handleToolbarClick:R}=ta(h,O,T,s),x=N(o.visible),v=ae(()=>o.visible,d=>{x.value=d});ce(()=>{m(),v()});const k=d=>({"round-robin":"轮询",random:"随机","ip-hash":"IP哈希","least-conn":"最少连接","weighted-round-robin":"加权轮询","consistent-hash":"一致性哈希",ROUND_ROBIN:"轮询",RANDOM:"随机",IP_HASH:"IP哈希",LEAST_CONN:"最少连接",WEIGHTED_ROUND_ROBIN:"加权轮询",CONSISTENT_HASH:"一致性哈希"})[d]||d,M=d=>{n.value=d},q=d=>{x.value=d,c("update:visible",d),d?c("refresh"):(n.value=[],c("close"))},r=()=>{if(n.value.length===0){f.warning("请至少选择一个服务定义");return}c("select",n.value),x.value=!1,c("update:visible",!1),c("close")},e=()=>{x.value=!1,c("update:visible",!1),c("close")};return(d,l)=>(Y(),ie(t(Se),{visible:x.value,title:o.title||"选择服务定义",width:o.width||1200,to:o.to,"show-footer":!0,"show-confirm":!0,"show-cancel":!0,"confirm-text":"确认选择","cancel-text":"取消","header-icon":t(ht),"onUpdate:visible":q,onConfirm:r,onCancel:e},{default:S(()=>[E("div",{class:"service-definition-list-modal",id:t(h).moduleId},[A(t(fe),{direction:"vertical","no-resize":!0},{1:S(()=>[A(Ce,oe({ref_key:"searchFormRef",ref:s,"module-id":t(h).moduleId},t(h).searchFormConfig,{onSearch:t(_),onToolbarClick:t(R)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:S(()=>[A(t(ye),oe({ref_key:"gridRef",ref:T,"module-id":t(h).moduleId,data:t(h).serviceList,loading:t(h).loading},t(h).gridConfig,{onPageChange:t(F),onCheckboxChange:M}),{serviceType:S(({row:i})=>[A(t($),{type:i.serviceType===1?"success":"info",size:"small"},{default:S(()=>[H(K(i.serviceType===1?"服务发现":"静态配置"),1)]),_:2},1032,["type"])]),loadBalanceStrategy:S(({row:i})=>[A(t($),{type:"default",size:"small"},{default:S(()=>[H(K(k(i.loadBalanceStrategy)),1)]),_:2},1024)]),healthCheckEnabled:S(({row:i})=>[A(t($),{type:i.healthCheckEnabled==="Y"?"success":"default",size:"small"},{default:S(()=>[H(K(i.healthCheckEnabled==="Y"?"已启用":"未启用"),1)]),_:2},1032,["type"])]),activeFlag:S(({row:i})=>[A(t($),{type:i.activeFlag==="Y"?"success":"error",size:"small"},{default:S(()=>[H(K(i.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,aa)]),_:1},8,["visible","title","width","to","header-icon"]))}}),oa=ne(ia,[["__scopeId","data-v-0bc55b5e"]]),la={class:"service-definition-selector"},na={key:0,class:"selected-service-card"},sa={class:"service-info"},ra={key:0,class:"services-list"},ca={class:"service-header"},ua={class:"service-avatar"},da={class:"avatar-circle"},fa={class:"service-main-info"},pa={class:"service-name"},ga={class:"service-id"},ha={class:"service-status"},ba={class:"service-details"},ma={class:"detail-row"},va={class:"detail-item"},ya={class:"detail-item"},Ca={class:"detail-value"},wa={class:"detail-row"},Ta={class:"detail-item full-width"},Ia={key:1,class:"service-item"},ka={class:"service-header"},Sa={class:"service-avatar"},Aa={class:"avatar-circle"},Na={class:"service-main-info"},Pa={class:"service-name"},Oa={class:"service-id"},xa={class:"service-status"},Ra={class:"service-details"},_a={class:"detail-row"},Fa={class:"detail-item"},Ma={class:"detail-item"},Va={class:"detail-value"},La={class:"detail-row"},Ea={class:"detail-item full-width"},qa={class:"service-actions"},Da={key:1,class:"empty-selector"},Ka=le({__name:"ServiceDefinitionSelector",props:{modelValue:{},gatewayInstanceId:{}},emits:["update:modelValue","change"],setup(C,{emit:w}){const o=C,c=w,f=ee(),s=N(!1),T=N(!1),n=N(null),h=N([]),O=de(()=>o.modelValue?typeof o.modelValue=="string"&&o.modelValue.includes(",")?o.modelValue.split(",").map(l=>l.trim()).filter(l=>l):[o.modelValue]:[]),m=de(()=>{if(O.value.length>1)return null;if(O.value.length===1){const l=O.value[0];if(n.value&&n.value.serviceDefinitionId===l)return n.value}return null}),_=de(()=>O.value.length<=1?[]:h.value.filter(l=>O.value.includes(l.serviceDefinitionId))),F=async l=>{if(!l){n.value=null;return}try{T.value=!0;const i=await Fe(l);if(U(i)){const u=JSON.parse(i.bizData);n.value=u}else console.warn("获取服务定义失败:",G(i,"获取服务定义失败")),n.value=null}catch(i){console.error("加载服务定义失败:",i),n.value=null}finally{T.value=!1}},R=async l=>{if(!l||l.length===0){h.value=[];return}try{T.value=!0;const i=l.map(a=>Fe(a)),u=await Promise.all(i),g=[];u.forEach((a,p)=>{if(U(a))try{const b=JSON.parse(a.bizData);g.push(b)}catch(b){console.warn(`解析服务定义 ${l[p]} 失败:`,b)}else console.warn(`获取服务定义 ${l[p]} 失败:`,G(a,"获取服务定义失败"))}),h.value=g}catch(i){console.error("加载服务定义列表失败:",i),h.value=[]}finally{T.value=!1}},x=l=>({"round-robin":"轮询",random:"随机","ip-hash":"IP哈希","least-conn":"最少连接","weighted-round-robin":"加权轮询","consistent-hash":"一致性哈希",ROUND_ROBIN:"轮询",RANDOM:"随机",IP_HASH:"IP哈希",LEAST_CONN:"最少连接",WEIGHTED_ROUND_ROBIN:"加权轮询",CONSISTENT_HASH:"一致性哈希"})[l]||l,v=l=>{if(!l)return"?";const i=l.charAt(0).toUpperCase();return/^[A-Z]$/.test(i)?i:l.charAt(0)},k=()=>{s.value=!0},M=()=>{s.value=!1},q=()=>{n.value=null,h.value=[],c("update:modelValue",null),c("change",null),f.info("已清除服务定义选择")},r=l=>{if(l.length===0){n.value=null,h.value=[],c("update:modelValue",null),c("change",null),M();return}if(l.length===1){const i=l[0];n.value=i,h.value=[],c("update:modelValue",i.serviceDefinitionId),c("change",i),f.success(`已选择服务：${i.serviceName}`)}else{n.value=null,h.value=l;const i=l.map(u=>u.serviceDefinitionId).join(",");c("update:modelValue",i),c("change",l),f.success(`已选择 ${l.length} 个服务`)}M()},e=ae(()=>o.gatewayInstanceId,(l,i)=>{!l&&i&&(n.value=null)}),d=ae(()=>o.modelValue,(l,i)=>{if(!l){n.value=null,h.value=[];return}if(l!==i){const u=typeof l=="string"&&l.includes(",")?l.split(",").map(g=>g.trim()).filter(g=>g):[l];if(u.length===1){const g=u[0];(!n.value||n.value.serviceDefinitionId!==g)&&F(g),h.value=[]}else if(u.length>1){const g=h.value.map(p=>p.serviceDefinitionId).sort(),a=[...u].sort();JSON.stringify(g)!==JSON.stringify(a)&&R(u),n.value=null}}},{immediate:!0});return ce(()=>{e(),d()}),(l,i)=>(Y(),j("div",la,[C.modelValue&&(_.value.length>0||m.value)?(Y(),j("div",na,[E("div",sa,[_.value.length>0?(Y(),j("div",ra,[(Y(!0),j(se,null,ke(_.value,u=>(Y(),j("div",{key:u.serviceDefinitionId,class:"service-item"},[E("div",ca,[E("div",ua,[E("div",da,K(v(u.serviceName)),1)]),E("div",fa,[E("div",pa,K(u.serviceName),1),E("div",ga,K(u.serviceDefinitionId),1)]),E("div",ha,[A(t($),{type:u.activeFlag==="Y"?"success":"error",size:"small"},{default:S(()=>[H(K(u.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])])]),E("div",ba,[E("div",ma,[E("div",va,[i[1]||(i[1]=E("span",{class:"detail-label"},"服务类型",-1)),A(t($),{type:u.serviceType===1?"success":"info",size:"small"},{default:S(()=>[H(K(u.serviceType===1?"服务发现":"静态配置"),1)]),_:2},1032,["type"])]),E("div",ya,[i[2]||(i[2]=E("span",{class:"detail-label"},"负载均衡",-1)),E("span",Ca,K(x(u.loadBalanceStrategy)),1)])]),E("div",wa,[E("div",Ta,[i[3]||(i[3]=E("span",{class:"detail-label"},"健康检查",-1)),A(t($),{type:u.healthCheckEnabled==="Y"?"success":"default",size:"small"},{default:S(()=>[H(K(u.healthCheckEnabled==="Y"?"已启用":"已禁用"),1)]),_:2},1032,["type"])])])])]))),128))])):m.value?(Y(),j("div",Ia,[E("div",ka,[E("div",Sa,[E("div",Aa,K(v(m.value.serviceName)),1)]),E("div",Na,[E("div",Pa,K(m.value.serviceName),1),E("div",Oa,K(m.value.serviceDefinitionId),1)]),E("div",xa,[A(t($),{type:m.value.activeFlag==="Y"?"success":"error",size:"small"},{default:S(()=>[H(K(m.value.activeFlag==="Y"?"启用":"禁用"),1)]),_:1},8,["type"])])]),E("div",Ra,[E("div",_a,[E("div",Fa,[i[4]||(i[4]=E("span",{class:"detail-label"},"服务类型",-1)),A(t($),{type:m.value.serviceType===1?"success":"info",size:"small"},{default:S(()=>[H(K(m.value.serviceType===1?"服务发现":"静态配置"),1)]),_:1},8,["type"])]),E("div",Ma,[i[5]||(i[5]=E("span",{class:"detail-label"},"负载均衡",-1)),E("span",Va,K(x(m.value.loadBalanceStrategy)),1)])]),E("div",La,[E("div",Ea,[i[6]||(i[6]=E("span",{class:"detail-label"},"健康检查",-1)),A(t($),{type:m.value.healthCheckEnabled==="Y"?"success":"default",size:"small"},{default:S(()=>[H(K(m.value.healthCheckEnabled==="Y"?"已启用":"已禁用"),1)]),_:1},8,["type"])])])])])):Ne("",!0),E("div",qa,[A(t(pe),{onClick:k,size:"small",secondary:""},{icon:S(()=>[A(t(Z),null,{default:S(()=>[A(t(ze))]),_:1})]),default:S(()=>[i[7]||(i[7]=H(" 重新选择 ",-1))]),_:1}),A(t(pe),{onClick:q,size:"small",type:"error",secondary:""},{icon:S(()=>[A(t(Z),null,{default:S(()=>[A(t(It))]),_:1})]),default:S(()=>[i[8]||(i[8]=H(" 清除 ",-1))]),_:1})])])])):(Y(),j("div",Da,[A(t(pe),{onClick:k,dashed:"",block:"",size:"large",class:"select-btn"},{icon:S(()=>[A(t(Z),null,{default:S(()=>[A(t(be))]),_:1})]),default:S(()=>[i[9]||(i[9]=H(" 点击选择服务定义 ",-1))]),_:1})])),A(oa,{visible:s.value,"onUpdate:visible":i[0]||(i[0]=u=>s.value=u),title:"选择服务定义",width:1200,"gateway-instance-id":C.gatewayInstanceId,to:"#hub0021-route-config-list",onSelect:r,onClose:M},null,8,["visible","gateway-instance-id"])]))}}),Ya=ne(Ka,[["__scopeId","data-v-752281ea"]]);function za(){const C="hub0021",w=N(!1),o=N([]),c=N(),f={fields:[{field:"routeName",label:"路由名称",type:"input",placeholder:"请输入路由名称",span:6,clearable:!0},{field:"routePath",label:"路由路径",type:"input",placeholder:"请输入路由路径",span:6,clearable:!0},{field:"matchType",label:"匹配类型",type:"select",placeholder:"请选择匹配类型",span:6,clearable:!0,options:[{label:"精确匹配",value:W.EXACT},{label:"前缀匹配",value:W.PREFIX},{label:"正则匹配",value:W.REGEX}]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[{key:"add",label:"新增路由",icon:xe,type:"primary",tooltip:"新增路由配置"},{key:"delete",label:"删除",icon:Re,type:"error",tooltip:"批量删除选中的路由配置"}],showSearchButton:!0,showResetButton:!0},s={columns:[{field:"routeConfigId",title:"路由配置ID",visible:!1,width:0},{field:"routeName",title:"路由名称",sortable:!0,align:"center",showOverflow:"tooltip",slots:{default:"routeName"},width:200},{field:"routePath",title:"路由路径",align:"center",showOverflow:"tooltip",width:250},{field:"matchType",title:"匹配类型",align:"center",slots:{default:"matchType"},width:120},{field:"routePriority",title:"优先级",align:"center",sortable:!0,width:100},{field:"allowedMethods",title:"HTTP方法",align:"center",slots:{default:"allowedMethods"},width:150},{field:"serviceName",title:"关联服务",align:"center",showOverflow:"tooltip",width:180,slots:{default:"serviceName"}},{field:"timeoutMs",title:"超时时间(ms)",align:"center",visible:!1,width:0},{field:"retryCount",title:"重试次数",align:"center",visible:!1,width:0},{field:"enableWebsocket",title:"WebSocket",align:"center",visible:!1,width:0},{field:"routeMetadata",title:"路由元数据",align:"center",visible:!1,width:0},{field:"activeFlag",title:"状态",align:"center",slots:{default:"activeFlag"},width:100},{field:"addTime",title:"创建时间",align:"center",formatter:({row:v})=>re(v.addTime),width:180}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:c,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"routeConfig",name:"路由配置",prefixIcon:"vxe-icon-setting",children:[{code:"assertConfig",name:"路由断言配置",prefixIcon:()=>X(Z,{size:12},{default:()=>X(At)})},{code:"ipAccessControl",name:"IP访问控制",prefixIcon:"vxe-icon-lock"},{code:"userAgentAccessControl",name:"User-Agent访问控制",prefixIcon:"vxe-icon-user"},{code:"apiAccessControl",name:"API访问控制",prefixIcon:"vxe-icon-link"},{code:"domainAccessControl",name:"域名访问控制",prefixIcon:()=>X(Z,{size:12},{default:()=>X(Nt)})},{code:"corsConfig",name:"跨域配置",prefixIcon:"vxe-icon-link"},{code:"authConfig",name:"认证配置",prefixIcon:"vxe-icon-setting"},{code:"rateLimitConfig",name:"限流配置",prefixIcon:"vxe-icon-setting"},{code:"filters",name:"路由过滤器",prefixIcon:"vxe-icon-setting"}]},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function T(v){o.value=v}function n(v){w.value=v}function h(){c.value=void 0}function O(v){c.value?Object.assign(c.value,v):c.value=v}function m(v){o.value.unshift(v)}function _(v){const k=o.value.findIndex(M=>M.routeConfigId===v.routeConfigId);k>=0&&(o.value[k]=v)}function F(v){const k=o.value.findIndex(M=>M.routeConfigId===v);k>=0&&o.value.splice(k,1)}function R(v){o.value=o.value.filter(k=>!v.includes(k.routeConfigId))}const x={tabs:[{key:"basic",label:"基本信息"},{key:"metadata",label:"元数据配置"},{key:"other",label:"其他"}],fields:[{field:"routeConfigId",label:"路由配置ID",type:"input",span:12,tabKey:"basic",primary:!0,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:12,tabKey:"basic",show:!1},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:12,tabKey:"basic",show:!1},{field:"routeName",label:"路由名称",type:"input",placeholder:"请输入路由名称",span:12,tabKey:"basic",required:!0,tips:"路由的唯一标识名称，用于区分不同的路由规则",rules:[{required:!0,message:"请输入路由名称",trigger:["blur","input"]},{max:100,message:"路由名称不能超过100个字符",trigger:["blur","input"]}]},{field:"matchType",label:"匹配类型",type:"select",placeholder:"请选择匹配类型",span:12,tabKey:"basic",required:!0,defaultValue:W.PREFIX,tips:"精确匹配：路径必须完全一致；前缀匹配：路径以指定前缀开头；正则匹配：使用正则表达式匹配路径",options:[{label:"精确匹配",value:W.EXACT},{label:"前缀匹配",value:W.PREFIX},{label:"正则匹配",value:W.REGEX}],rules:[{required:!0,message:"请选择匹配类型",trigger:["blur","change"],validator:(v,k)=>k==null||k===""?new Error("请选择匹配类型"):[W.EXACT,W.PREFIX,W.REGEX].includes(Number(k))?!0:new Error("请选择有效的匹配类型")}]},{field:"routePath",label:"路由路径",type:"input",placeholder:"请输入路由路径",span:24,tabKey:"basic",required:!0,tips:v=>{switch(v.matchType){case W.EXACT:return`精确匹配：请求路径必须完全匹配配置的路径
示例: /api/users/123`;case W.PREFIX:return`前缀匹配：请求路径以配置的路径为前缀即可匹配
示例: /api/users (匹配 /api/users/*)`;case W.REGEX:return`正则匹配：使用正则表达式匹配请求路径
示例: ^/api/users/\\d+$`;default:return"精确匹配示例：/api/users；前缀匹配示例：/api/；正则匹配示例：^/api/(users|orders)/?$"}},props:{onUpdateValue:(v,k)=>{v&&!v.startsWith("/")?k.routePath="/"+v:k.routePath=v}},rules:[{required:!0,message:"请输入路由路径",trigger:["blur","input"]},{pattern:/^\/.*/,message:"路由路径必须以 / 开头",trigger:["blur","input"]},{validator:(v,k)=>k?k.startsWith("/")?!0:new Error("路由路径必须以 / 开头"):!0,trigger:["blur","input"]}]},{field:"allowedMethods",label:"HTTP方法",type:"custom",span:24,tabKey:"basic",tips:"选择允许的HTTP请求方法，未选择表示允许所有方法",render:v=>{const k=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"],M=Array.isArray(v.allowedMethods)?v.allowedMethods:typeof v.allowedMethods=="string"&&v.allowedMethods?(()=>{try{const q=JSON.parse(v.allowedMethods);return Array.isArray(q)?q:[]}catch{return v.allowedMethods.split(",").map(q=>q.trim()).filter(Boolean)}})():[];return X(St,{value:M,"onUpdate:value":q=>{v.allowedMethods=q.map(r=>String(r))}},{default:()=>X(Xe,{},{default:()=>k.map(q=>X(kt,{value:q,label:q},{default:()=>q}))})})}},{field:"allowedHosts",label:"允许的主机",type:"input",placeholder:"留空表示允许所有主机，多个主机用逗号分隔",span:12,tabKey:"basic",tips:"限制允许的主机名，多个主机用逗号分隔，如：api.example.com,www.example.com"},{field:"routePriority",label:"路由优先级",type:"number",placeholder:"数值越小优先级越高",span:12,tabKey:"basic",required:!0,defaultValue:100,tips:"路由匹配的优先级，数值越小优先级越高，建议范围：1-999",props:{min:1,max:999,style:{width:"100%"}},rules:[{required:!0,message:"请输入路由优先级",trigger:["blur","change","input"],validator:(v,k)=>{if(k==null||k==="")return new Error("请输入路由优先级");const M=typeof k=="number"?k:Number(k);return isNaN(M)?new Error("路由优先级必须是数字"):M<1||M>999?new Error("优先级必须在1-999之间"):!0}}]},{field:"serviceDefinitionId",label:"关联服务",type:"custom",span:24,tabKey:"basic",required:!0,tips:"选择要关联的后端服务定义，多个服务使用逗号分割，如果没有可用选项，请先在服务管理中创建服务定义",render:(v,k)=>{const M=(k==null?void 0:k.gatewayInstanceId)||"";return X(Ya,{modelValue:v.serviceDefinitionId,"onUpdate:modelValue":q=>{v.serviceDefinitionId=q||""},gatewayInstanceId:M})}},{field:"routeMetadata.responseMergeStrategy",label:"响应合并策略",type:"select",span:8,tabKey:"basic",show:v=>v.serviceDefinitionId&&v.serviceDefinitionId.includes(","),defaultValue:"first",tips:`first: 使用第一个成功的响应（默认）
first_error: 使用第一个失败的响应
all: 返回所有响应`,options:[{label:"第一个成功响应",value:"first"},{label:"第一个失败响应",value:"first_error"},{label:"所有响应",value:"all"}]},{field:"routeMetadata.maxConcurrentRequests",label:"最大并发请求数",type:"number",span:8,tabKey:"basic",show:v=>v.serviceDefinitionId&&v.serviceDefinitionId.includes(","),defaultValue:0,tips:"0表示不限制（使用所有服务），大于0时限制并发数",props:{min:0,precision:0}},{field:"routeMetadata.requireAllSuccess",label:"要求所有服务成功",type:"switch",span:8,tabKey:"basic",show:v=>v.serviceDefinitionId&&v.serviceDefinitionId.includes(","),defaultValue:!1,tips:"如果为true，任何一个服务失败都会返回错误；如果为false，使用第一个成功的响应",props:{checkedValue:!0,uncheckedValue:!1}},{field:"logConfigId",label:"日志配置ID",type:"input",placeholder:"请输入日志配置ID（可选）",span:12,tabKey:"basic",tips:"关联的日志配置ID，用于路由请求的日志记录"},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",tips:"控制路由是否启用，禁用的路由不会参与匹配",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"routeMetadata",label:"路由元数据",type:"input",placeholder:"请输入JSON格式的元数据（可选）",span:24,tabKey:"metadata",tips:'用于存储路由的自定义元数据信息，格式为JSON字符串，如：{"key1":"value1","key2":"value2"}',props:{type:"textarea",rows:4}},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"metadata",tips:"路由配置的备注说明信息",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"路由配置的创建时间"},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"路由配置的创建人"},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0,tips:"路由配置的最后修改时间"},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0,tips:"路由配置的最后修改人"},{field:"currentVersion",label:"版本号",type:"number",span:12,tabKey:"other",disabled:!0,tips:"路由配置的当前版本号"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:12,tabKey:"other",disabled:!0,show:!1,tips:"路由配置的操作序列标识"}]};return{moduleId:C,loading:w,routeList:o,pageInfo:c,searchFormConfig:f,gridConfig:s,routeFormConfig:x,setRouteList:T,setLoading:n,resetPagination:h,updatePagination:O,addRouteToList:m,updateRouteInList:_,removeRouteFromList:F,removeRoutesFromList:R}}function Ha(C,w){const o=ee(),c=Oe(),f=za(),{loading:s,routeList:T,pageInfo:n,setRouteList:h,updatePagination:O,addRouteToList:m,updateRouteInList:_,removeRouteFromList:F,removeRoutesFromList:R}=f,x=async u=>{var g,a,p;s.value=!0;try{let b=u;!b&&((g=w==null?void 0:w.value)!=null&&g.getFormData)&&(b=w.value.getFormData()||{});const y=b?Object.fromEntries(Object.entries(b).filter(([,P])=>P!==""&&P!==null&&P!==void 0)):{},B={...y,...y.gatewayInstanceId===void 0&&C?{gatewayInstanceId:C}:{},...ve((a=n.value)==null?void 0:a.pageIndex,(p=n.value)==null?void 0:p.pageSize)},J=await ct(B);if(J.oK){if(J.bizData){const P=JSON.parse(J.bizData),D=Array.isArray(P)?P:[];h(D)}if(J.pageQueryData){const P=JSON.parse(J.pageQueryData);O(P)}}else o.error(J.errMsg||"查询路由配置列表失败")}catch{o.error("加载路由配置列表失败")}finally{s.value=!1}};return{model:f,loadRouteList:x,handleSearch:async u=>{var g;O({pageIndex:1,pageSize:((g=n.value)==null?void 0:g.pageSize)||20}),await x(u)},handleReset:async()=>{var u;O({pageIndex:1,pageSize:((u=n.value)==null?void 0:u.pageSize)||20}),await x()},handlePageChange:async({currentPage:u,pageSize:g})=>{O({pageIndex:u,pageSize:g}),await x()},addRoute:async u=>{s.value=!0;try{const g=await rt(u);if(U(g)){const a=G(g,"路由配置创建成功");if(o.success(a),g.bizData){const p=JSON.parse(g.bizData);m(p)}else await x();return!0}else{const a=G(g,"新增路由配置失败");return o.error(a),!1}}catch{return o.error("新增路由配置失败"),!1}finally{s.value=!1}},editRoute:async(u,g)=>{s.value=!0;try{const a=await we({...g,routeConfigId:u});if(U(a)){const p=G(a,"路由配置更新成功");if(o.success(p),a.bizData){const b=JSON.parse(a.bizData);_(b)}else await x();return!0}else{const p=G(a,"更新路由配置失败");return o.error(p),!1}}catch{return o.error("更新路由配置失败"),!1}finally{s.value=!1}},deleteRoute:async u=>{const g=T.value.find(p=>p.routeConfigId===u);if(!g)return o.error("未找到要删除的路由配置"),!1;if(!await c.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除路由配置 "${g.routeName||g.routeConfigId}" 吗？`,icon:Ee,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;s.value=!0;try{const p=await Me(u);return p.oK?(o.success(G(p,"删除路由配置成功")),F(u),T.value.length===0&&n.value&&n.value.pageIndex>1?(O({pageIndex:n.value.pageIndex-1}),await x()):await x(),!0):(o.error(G(p,"删除路由配置失败")),!1)}catch{return o.error("删除路由配置失败"),!1}finally{s.value=!1}},batchDeleteRoutes:async u=>{if(await c.warning({title:"确认批量删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除选中的 ${u.length} 个路由配置吗？`,icon:Ee,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500})){s.value=!0;try{let a=0,p=0;for(const b of u)try{(await Me(b)).oK?a++:p++}catch{p++}a>0?(o.success(`成功删除 ${a} 个路由配置${p>0?`，失败 ${p} 个`:""}`),R(u.slice(0,a)),await x()):o.error(`删除失败，共 ${p} 个`)}catch{o.error("批量删除失败")}finally{s.value=!1}}},toggleRouteStatus:async u=>{const g=u.activeFlag==="Y"?"N":"Y",a=g==="Y"?"启用":"禁用";try{const p=await we({routeConfigId:u.routeConfigId,activeFlag:g});p.oK?(o.success(`${a}成功`),_({...u,activeFlag:g}),await x()):o.error(p.errMsg||`${a}失败`)}catch{o.error(`${a}失败`)}},batchToggleRouteStatus:async(u,g)=>{const a=g==="Y"?"启用":"禁用";try{const p=u.map(B=>T.value.find(P=>P.routeConfigId===B)?we({routeConfigId:B,activeFlag:g}):Promise.resolve({oK:!1})),y=(await Promise.all(p)).filter(B=>B.oK).length;y===u.length?o.success(`成功${a} ${y} 个路由配置`):o.warning(`${a}了 ${y}/${u.length} 个路由配置`),await x()}catch{o.error(`批量${a}失败`)}}}}function $a(C,w,o){const c=ee(),f=Ha(C,w),s=N(!1),T=N("create"),n=N(null),h=N(""),O=N(!1),m=N(!1),_=N(!1),F=N(!1),R=N(!1),x=N(!1),v=N(!1),k=N(!1),M=N(!1),q=(P=!0)=>C?!0:(P&&c.warning("请先选择网关实例"),!1),r=()=>{q()&&(T.value="create",s.value=!0,n.value=null)},e=async P=>{if(!q())return null;try{const D=await Ve(P.routeConfigId);if(U(D)){const L=JSON.parse(D.bizData);return T.value="edit",s.value=!0,n.value=L,L}else return c.error(G(D,"获取路由配置详情失败")),null}catch{return c.error("获取路由配置详情失败"),null}},d=async P=>{if(!q())return null;try{const D=await Ve(P.routeConfigId);if(U(D)){const L=JSON.parse(D.bizData);return T.value="view",s.value=!0,n.value=L,L}else return c.error(G(D,"获取路由配置详情失败")),null}catch{return c.error("获取路由配置详情失败"),null}},l=()=>{s.value=!1,n.value=null},i=()=>{if(!n.value)return;const P=n.value,D={...P};if(typeof P.allowedMethods=="string"&&P.allowedMethods)try{D.allowedMethods=JSON.parse(P.allowedMethods)}catch{D.allowedMethods=P.allowedMethods.split(",").map(z=>z.trim()).filter(Boolean)}else Array.isArray(P.allowedMethods)?D.allowedMethods=P.allowedMethods:D.allowedMethods=[];const I=(z=>{if(typeof z=="string"&&z)try{return JSON.parse(z)}catch{return z}return z})(P.routeMetadata);if(I&&typeof I=="object")try{D.routeMetadata=JSON.stringify(I,null,2)}catch{D.routeMetadata="{}"}else D.routeMetadata=P.routeMetadata||"{}";return["responseMergeStrategy","maxConcurrentRequests","requireAllSuccess"].forEach(z=>{I&&typeof I=="object"&&I[z]!==void 0&&(D[`routeMetadata.${z}`]=I[z])}),D},u=async P=>{if(P){if(T.value==="view"){l();return}if(!q())return!1;if(P.routePath){if(!P.routePath.startsWith("/"))return c.warning("路由路径必须以 / 开头"),!1;if(P.matchType===W.REGEX)try{new RegExp(P.routePath)}catch{return c.warning("请输入有效的正则表达式"),!1}}try{const D={...P,gatewayInstanceId:C||P.gatewayInstanceId};let L={};if(D.routeMetadata)if(typeof D.routeMetadata=="string")try{L=JSON.parse(D.routeMetadata)}catch{L={}}else typeof D.routeMetadata=="object"&&(L={...D.routeMetadata});Object.keys(P).forEach(z=>{if(z.startsWith("routeMetadata.")){const ue=z.replace("routeMetadata.","");L[ue]=P[z]}});const I={...D};Object.keys(I).forEach(z=>{z.startsWith("routeMetadata.")&&delete I[z]}),Array.isArray(I.allowedMethods)&&(I.allowedMethods=JSON.stringify(I.allowedMethods)),I.routeMetadata=JSON.stringify(L);let V=!1;return T.value==="create"?V=await f.addRoute(I):T.value==="edit"&&n.value&&(V=await f.editRoute(n.value.routeConfigId,I)),V&&(l(),f.loadRouteList()),V}catch{return c.error("操作失败"),!1}}},g=async P=>{q()&&await f.deleteRoute(P.routeConfigId)},a=async()=>{var L,I,V,z;if(!q())return;if(!(o!=null&&o.value)){c.warning("Grid 引用未设置");return}const P=((I=(L=o.value).getCheckboxRecords)==null?void 0:I.call(L))||((z=(V=o.value).getSelectRecords)==null?void 0:z.call(V))||[];if(P.length===0){c.warning("请选择要删除的路由配置");return}const D=P.map(ue=>ue.routeConfigId);await f.batchDeleteRoutes(D)},p=async P=>{if(!q())return;const D=P?{...P,...C?{gatewayInstanceId:C}:{}}:C?{gatewayInstanceId:C}:void 0;await f.handleSearch(D)},b=async(P,D)=>{switch(P){case"add":r();break;case"delete":await a();break;case"search":await p(D);break;case"reset":await f.handleReset();break}},y=async P=>{const{code:D,row:L}=P;if(!L)return;const I=L;switch(D){case"view":await d(I);break;case"edit":await e(I);break;case"assertConfig":h.value=I.routeConfigId,O.value=!0;break;case"filters":h.value=I.routeConfigId,M.value=!0;break;case"ipAccessControl":h.value=I.routeConfigId,m.value=!0;break;case"userAgentAccessControl":h.value=I.routeConfigId,_.value=!0;break;case"apiAccessControl":h.value=I.routeConfigId,F.value=!0;break;case"domainAccessControl":h.value=I.routeConfigId,R.value=!0;break;case"corsConfig":h.value=I.routeConfigId,x.value=!0;break;case"authConfig":h.value=I.routeConfigId,v.value=!0;break;case"rateLimitConfig":h.value=I.routeConfigId,k.value=!0;break;case"delete":await g(I);break}};Ye(()=>{C&&f.loadRouteList()});const B=f.model.routeFormConfig.fields.map(P=>{if(P.field==="serviceDefinitionId"&&P.render){const D=P.render;return{...P,render:L=>D(L,{gatewayInstanceId:C||""})}}return P}),J={...f.model.routeFormConfig,fields:B};return{service:f,formDialogVisible:s,formDialogMode:T,currentEditRoute:n,currentRouteConfigId:h,assertConfigDialogVisible:O,ipAccessControlDialogVisible:m,userAgentAccessControlDialogVisible:_,apiAccessControlDialogVisible:F,domainAccessControlDialogVisible:R,corsConfigDialogVisible:x,authConfigDialogVisible:v,rateLimitConfigDialogVisible:k,filterConfigDialogVisible:M,routeFormConfig:J,handleFormSubmit:u,getRouteFormInitialData:i,handleToolbarClick:b,handleMenuClick:y,handleSearch:p,openAddDialog:r,openEditDialog:e,openViewDialog:d,closeFormDialog:l}}const Ie=[{label:"路径",value:"PATH",description:"路径匹配断言，用于复杂路径匹配规则"},{label:"请求头",value:"HEADER",description:"请求头断言，检查特定请求头的值"},{label:"查询参数",value:"QUERY",description:"查询参数断言，检查URL查询参数"},{label:"Cookie",value:"COOKIE",description:"Cookie断言，检查特定Cookie的值"},{label:"IP地址",value:"IP",description:"IP地址断言，基于客户端IP进行匹配"},{label:"请求体内容",value:"BODY_CONTENT",description:"请求体内容断言，检查HTTP请求体的内容"}],De=[{label:"等于",value:"EQUAL",description:"值必须完全相等"},{label:"不等于",value:"NOT_EQUAL",description:"值必须不相等"},{label:"包含",value:"CONTAINS",description:"值必须包含指定字符串"},{label:"不包含",value:"NOT_CONTAINS",description:"值必须不包含指定字符串"},{label:"正则匹配",value:"MATCHES",description:"值必须匹配正则表达式"},{label:"正则不匹配",value:"NOT_MATCHES",description:"值必须不匹配正则表达式"},{label:"开头匹配",value:"STARTS_WITH",description:"值必须以指定字符串开头"},{label:"结尾匹配",value:"ENDS_WITH",description:"值必须以指定字符串结尾"},{label:"在列表中",value:"IN",description:"值必须在指定列表中"},{label:"不在列表中",value:"NOT_IN",description:"值必须不在指定列表中"}];function Ua(){const C="hub0021:assertConfig",w=N(!1),o=N([]),c=N(),f={fields:[{field:"assertionName",label:"断言名称",type:"input",placeholder:"请输入断言名称",span:6,clearable:!0},{field:"assertionType",label:"断言类型",type:"select",placeholder:"请选择断言类型",span:6,clearable:!0,options:[{label:"全部",value:""},...Ie.map(r=>({label:r.label,value:r.value}))]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[{key:"add",label:"新增断言",icon:xe,type:"primary",tooltip:"新增断言配置"},{key:"delete",label:"删除",icon:Re,type:"error",tooltip:"批量删除选中的断言配置"}],showSearchButton:!0,showResetButton:!0},s=r=>{const e=Ie.find(d=>d.value===r);return(e==null?void 0:e.label)||r},T=r=>({PATH:"primary",HEADER:"info",QUERY:"success",COOKIE:"warning",IP:"error",BODY_CONTENT:"success"})[r]||"default",n=r=>{const e=De.find(d=>d.value===r);return(e==null?void 0:e.label)||r},h={columns:[{field:"routeAssertionId",title:"断言ID",visible:!1,width:0},{field:"assertionOrder",title:"执行顺序",align:"center",width:120,slots:{default:"assertionOrder"}},{field:"assertionName",title:"断言名称",align:"center",showOverflow:"tooltip",width:200},{field:"assertionType",title:"断言类型",align:"center",width:120,slots:{default:"assertionType"}},{field:"assertionOperator",title:"操作符",align:"center",width:120,slots:{default:"assertionOperator"}},{field:"fieldName",title:"字段名称",align:"center",showOverflow:"tooltip",width:150},{field:"expectedValue",title:"期望值/模式",align:"center",showOverflow:"tooltip",width:200,formatter:({row:r})=>r.expectedValue||"-"},{field:"isRequired",title:"必须匹配",align:"center",width:100,slots:{default:"isRequired"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"assertionDesc",title:"描述",align:"center",showOverflow:"tooltip",width:200},{field:"addTime",title:"创建时间",align:"center",formatter:({row:r})=>re(r.addTime),width:180},{field:"addWho",title:"创建人",align:"center",showOverflow:"tooltip",width:120},{field:"editTime",title:"修改时间",align:"center",formatter:({row:r})=>re(r.editTime),width:180},{field:"editWho",title:"修改人",align:"center",showOverflow:"tooltip",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:c,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"toggle-status",name:"切换状态",prefixIcon:"vxe-icon-check"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function O(r){o.value=r}function m(r){w.value=r}function _(){c.value=void 0}function F(r){c.value?Object.assign(c.value,r):c.value=r}function R(r){o.value.push(r),o.value.sort((e,d)=>(e.assertionOrder||0)-(d.assertionOrder||0))}function x(r,e,d){const l=o.value.findIndex(i=>i.routeAssertionId===r&&(!e||i.tenantId===e));l!==-1&&(Object.assign(o.value[l],d),o.value.sort((i,u)=>(i.assertionOrder||0)-(u.assertionOrder||0)))}function v(r){const e=o.value.findIndex(d=>d.routeAssertionId===r);e>=0&&o.value.splice(e,1)}function k(r){o.value=o.value.filter(e=>!r.includes(e.routeAssertionId))}const M=[{key:"basic",label:"基本信息"},{key:"other",label:"其他信息"}],q=[{field:"routeAssertionId",label:"断言ID",type:"input",span:12,primary:!0,show:!1},{field:"routeConfigId",label:"路由配置ID",type:"input",span:12,show:!1},{field:"assertionName",label:"断言名称",type:"input",placeholder:"请输入断言名称",span:12,tabKey:"basic",required:!0,rules:[{required:!0,message:"请输入断言名称",trigger:["blur","input"]},{min:2,max:100,message:"断言名称长度应在2-100字符之间",trigger:["blur","input"]}]},{field:"assertionType",label:"断言类型",type:"select",placeholder:"请选择断言类型",span:12,tabKey:"basic",required:!0,defaultValue:"HEADER",options:Ie.map(r=>({label:r.label,value:r.value})),rules:[{required:!0,message:"请选择断言类型",trigger:["blur","change"]}]},{field:"assertionOperator",label:"操作符",type:"select",placeholder:"请选择操作符",span:12,tabKey:"basic",required:!0,defaultValue:"EQUAL",options:De.map(r=>({label:r.label,value:r.value})),rules:[{required:!0,message:"请选择操作符",trigger:["blur","change"]}]},{field:"assertionOrder",label:"执行顺序",type:"number",placeholder:"数值越小优先级越高",span:12,tabKey:"basic",required:!0,defaultValue:100,props:{min:0,max:9999,precision:0},rules:[{required:!0,type:"number",message:"请输入执行顺序",trigger:["blur","change"]}]},{field:"isRequired",label:"是否必须匹配",type:"select",span:12,tabKey:"basic",required:!0,defaultValue:"Y",options:[{label:"必须匹配",value:"Y"},{label:"可选匹配",value:"N"}],rules:[{required:!0,message:"请选择是否必须匹配",trigger:["change"]}]},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"assertionConfigFieldset",label:"断言配置",type:"fieldset",span:24,tabKey:"basic",children:[{field:"fieldName",label:"字段名称",type:"input",placeholder:"请输入字段名称（HEADER/QUERY/COOKIE类型必填）",span:12,show:r=>["HEADER","QUERY","COOKIE"].includes(r.assertionType),rules:[{validator:(r,e,d)=>["HEADER","QUERY","COOKIE"].includes(d.assertionType)&&(!e||!e.trim())?new Error("请输入字段名称"):!0,trigger:["blur","input"]}]},{field:"expectedValue",label:"期望值",type:"input",placeholder:"请输入期望值",span:24,show:r=>!["EXISTS","NOT_EXISTS"].includes(r.assertionOperator),props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"patternValue",label:"匹配模式",type:"select",placeholder:"请选择路径匹配模式（仅路径断言使用）",span:24,show:r=>r.assertionType==="PATH",options:[{label:"精确匹配（exact）",value:"exact"},{label:"前缀匹配（prefix）",value:"prefix"},{label:"正则匹配（regex）",value:"regex"},{label:"参数匹配（param）",value:"param"}],defaultValue:"exact"},{field:"caseSensitive",label:"区分大小写",type:"select",span:12,defaultValue:"Y",show:r=>r.assertionType!=="IP",options:[{label:"区分大小写",value:"Y"},{label:"不区分大小写",value:"N"}]},{field:"assertionDesc",label:"断言描述",type:"input",placeholder:"请输入断言描述（可选）",span:24,props:{type:"textarea",rows:3,maxlength:200,showCount:!0}}]},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}];return{moduleId:C,loading:w,assertList:o,pageInfo:c,searchFormConfig:f,gridConfig:h,formFields:q,formTabs:M,getAssertionTypeLabel:s,getAssertionTypeTagType:T,getOperatorLabel:n,setAssertList:O,setLoading:m,resetPagination:_,updatePagination:F,addAssertToList:R,updateAssertInList:x,removeAssertFromList:v,removeAssertsFromList:k}}function Ga(C,w){const o=ee(),c=()=>typeof C=="string"?C:C==null?void 0:C.value,f=Ua(),{pageInfo:s,addAssertToList:T,updateAssertInList:n,removeAssertFromList:h,removeAssertsFromList:O,updatePagination:m,resetPagination:_}=f,F=async l=>{var i,u,g;try{f.setLoading(!0);const a=c();if(!a){f.setAssertList([]),f.resetPagination();return}let p=l;!p&&((i=w==null?void 0:w.value)!=null&&i.getFormData)&&(p=w.value.getFormData()||{});const b=p?Object.fromEntries(Object.entries(p).filter(([,J])=>J!==""&&J!==null&&J!==void 0)):{},y={routeConfigId:a,...b,...ve((u=s.value)==null?void 0:u.pageIndex,(g=s.value)==null?void 0:g.pageSize)},B=await ft(y);if(U(B)){const J=te(B,[])||[];if(Array.isArray(J)&&J.length>0&&J.sort((P,D)=>(P.assertionOrder||0)-(D.assertionOrder||0)),f.setAssertList(J),B.pageQueryData)try{const P=JSON.parse(B.pageQueryData);m(P)}catch(P){console.error("解析分页信息失败:",P),f.resetPagination()}else f.resetPagination()}else o.error(G(B,"加载断言列表失败")),f.setAssertList([]),f.resetPagination()}catch(a){console.error("加载断言列表失败:",a),o.error("加载断言列表失败"),f.setAssertList([]),f.resetPagination()}finally{f.setLoading(!1)}},R=async l=>{try{f.setLoading(!0);const i=c();if(!i)return o.error("路由配置ID不能为空"),!1;const u={routeConfigId:i,assertionName:l.assertionName,assertionType:l.assertionType,assertionOperator:l.assertionOperator,fieldName:l.fieldName||"",expectedValue:l.expectedValue||"",patternValue:l.assertionType==="PATH"&&l.patternValue||"",caseSensitive:l.caseSensitive||"Y",assertionOrder:l.assertionOrder||100,isRequired:l.isRequired||"Y",assertionDesc:l.assertionDesc||"",activeFlag:l.activeFlag||"Y",noteText:l.noteText||""},g=await dt(u);if(U(g)){if(o.success("添加断言成功"),g.bizData)try{const a=te(g);if(a)return T(a),!0}catch(a){console.error("解析返回数据失败:",a)}return await F(),!0}else return o.error(G(g,"添加断言失败")),!1}catch(i){return console.error("添加断言失败:",i),o.error("添加断言失败"),!1}finally{f.setLoading(!1)}},x=async l=>{try{f.setLoading(!0);const i=c();if(!i)return o.error("路由配置ID不能为空"),!1;if(!l.routeAssertionId)return o.error("断言ID不能为空"),!1;const u={routeAssertionId:l.routeAssertionId,routeConfigId:i,assertionName:l.assertionName,assertionType:l.assertionType,assertionOperator:l.assertionOperator,fieldName:l.fieldName||"",expectedValue:l.expectedValue||"",patternValue:l.assertionType==="PATH"&&l.patternValue||"",caseSensitive:l.caseSensitive||"Y",assertionOrder:l.assertionOrder||100,isRequired:l.isRequired||"Y",assertionDesc:l.assertionDesc||"",activeFlag:l.activeFlag||"Y",noteText:l.noteText||""},g=await ut(u);if(U(g)){if(o.success("编辑断言成功"),g.bizData)try{const a=te(g);if(a)return n(a.routeAssertionId,a.tenantId,a),!0}catch(a){console.error("解析返回数据失败:",a)}return await F(),!0}else return o.error(G(g,"编辑断言失败")),!1}catch(i){return console.error("编辑断言失败:",i),o.error("编辑断言失败"),!1}finally{f.setLoading(!1)}};return{model:f,loadAssertList:F,addAssert:R,editAssert:x,deleteAssert:async l=>{try{f.setLoading(!0);const i=await Le(l);return U(i)?(o.success("删除断言成功"),h(l),!0):(o.error(G(i,"删除断言失败")),!1)}catch(i){return console.error("删除断言失败:",i),o.error("删除断言失败"),!1}finally{f.setLoading(!1)}},deleteAsserts:async l=>{if(!l||l.length===0)return o.warning("请选择要删除的断言"),!1;try{f.setLoading(!0);const i=await Promise.all(l.map(a=>Le(a))),u=i.filter(a=>U(a)).length,g=i.length-u;if(g===0)return o.success(`成功删除 ${u} 个断言`),O(l),!0;if(u>0){o.warning(`部分删除成功：成功 ${u} 个，失败 ${g} 个`);const a=l.filter((p,b)=>U(i[b]));return O(a),!0}else return o.error("批量删除失败"),!1}catch(i){return console.error("批量删除断言失败:",i),o.error("批量删除断言失败"),!1}finally{f.setLoading(!1)}},toggleAssertStatus:async l=>{try{const i=l.activeFlag==="Y"?"N":"Y",u={...l,activeFlag:i};return await x(u)}catch(i){return console.error("切换断言状态失败:",i),o.error("切换断言状态失败"),!1}},handleSearch:async l=>{f.resetPagination(),await F(l)},handleReset:async()=>{f.resetPagination(),await F()},handlePageChange:async({currentPage:l,pageSize:i})=>{m({pageIndex:l,pageSize:i}),await F()},handleRefresh:async()=>{await F()}}}function Ba(C,w,o){const c=Oe(),f=ee(),s=Ga(C,o),T=N(!1),n=N("create"),h=N(null),O=()=>{h.value={assertionOrder:100,assertionType:"HEADER",assertionOperator:"EQUAL",caseSensitive:"Y",isRequired:"Y",activeFlag:"Y"},n.value="create",T.value=!0},m=async e=>{try{const d=await pt(e.routeAssertionId);if(U(d)){const l=te(d);if(l){h.value={...l},n.value="edit",T.value=!0;return}}f.warning(G(d,"获取断言配置失败，使用缓存数据")),h.value={...e},n.value="edit",T.value=!0}catch(d){console.error("打开编辑对话框失败:",d),f.error("获取断言配置失败"),h.value={...e},n.value="edit",T.value=!0}},_=async e=>{try{h.value={...e},n.value="view",T.value=!0}catch(d){console.error("打开查看对话框失败:",d)}},F=()=>{T.value=!1,h.value=null,n.value="create"},R=async e=>{if(e)try{const d=n.value==="edit",l={...e,routeConfigId:typeof C=="string"?C:C==null?void 0:C.value};let i=!1;d?i=await s.editAssert(l):i=await s.addAssert(l),i&&F()}catch(d){console.error("提交表单失败:",d)}},x=async e=>{await s.handleSearch(e)},v=async(e,d)=>{switch(e){case"add":O();break;case"delete":await q();break;case"search":await x(d);break;case"reset":await s.handleReset();break}},k=async e=>{const{code:d,row:l}=e;if(!l)return;const i=l;switch(d){case"view":await _(i);break;case"edit":await m(i);break;case"toggle-status":await r(i);break;case"delete":await M(i);break}},M=async e=>{await c.warning({title:"确认删除",content:`确定要删除断言"${e.assertionName}"吗？`})&&await s.deleteAssert(e.routeAssertionId)},q=async()=>{if(!(w!=null&&w.value))return;const e=w.value.getSelectedRows();if(!e||e.length===0){c.warning({title:"提示",content:"请先选择要删除的断言"});return}if(await c.warning({title:"确认批量删除",content:`确定要删除选中的 ${e.length} 个断言吗？`})){const l=e.map(i=>i.routeAssertionId);await s.deleteAsserts(l)}},r=async e=>{await s.toggleAssertStatus(e)};return{service:s,formDialogVisible:T,formDialogMode:n,currentEditAssert:h,openAddDialog:O,openEditDialog:m,openViewDialog:_,closeFormDialog:F,handleFormSubmit:R,handleSearch:x,handleToolbarClick:v,handleMenuClick:k,handleDelete:M,handleBatchDelete:q,handleToggleStatus:r}}const Ja={class:"assert-config-list-modal",id:"assert-config-list-modal"},Wa={style:{"font-weight":"bold",color:"#0066cc"}},ja=le({name:"AssertConfigListModal",__name:"AssertConfigListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{type:[String,Boolean],default:void 0},routeConfigId:{default:""}},emits:["update:visible","close","refresh"],setup(C,{emit:w}){const o=C,c=w,f=N(),s=N(),T=N(o.visible),n=ae(()=>o.visible,d=>{T.value=d}),h=N(o.routeConfigId),O=ae(()=>o.routeConfigId,d=>{h.value=d});ce(()=>{n(),O()});const{service:m,formDialogVisible:_,formDialogMode:F,currentEditAssert:R,handleFormSubmit:x,handleToolbarClick:v,handleMenuClick:k,handleSearch:M,handleToggleStatus:q}=Ba(h,s,f),r=d=>{T.value=d,c("update:visible",d),d?(c("refresh"),m.loadAssertList()):c("close")},e=()=>{T.value||(_.value=!1,F.value="create",R.value=null,m.model.assertList.value=[],m.model.resetPagination())};return(d,l)=>(Y(),ie(t(Se),{visible:T.value,title:o.title||"路由断言配置列表",width:o.width||1200,to:o.to,"show-footer":!1,"onUpdate:visible":r,onAfterLeave:e},{default:S(()=>[E("div",Ja,[A(t(fe),{direction:"vertical","no-resize":!0},{1:S(()=>[A(Ce,oe({ref_key:"searchFormRef",ref:f,"module-id":t(m).model.moduleId},t(m).model.searchFormConfig,{onSearch:t(M),onToolbarClick:t(v)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:S(()=>[A(t(ye),oe({ref_key:"gridRef",ref:s,"module-id":t(m).model.moduleId,data:t(m).model.assertList,loading:t(m).model.loading},t(m).model.gridConfig,{onPageChange:t(m).handlePageChange,onMenuClick:l[0]||(l[0]=({code:i,row:u})=>t(k)({code:i,row:u}))}),{assertionOrder:S(({row:i})=>[E("span",Wa,K(i.assertionOrder),1)]),assertionType:S(({row:i})=>[A(t($),{type:t(m).model.getAssertionTypeTagType(i.assertionType),size:"small"},{default:S(()=>[H(K(t(m).model.getAssertionTypeLabel(i.assertionType)),1)]),_:2},1032,["type"])]),assertionOperator:S(({row:i})=>[A(t($),{type:"info",size:"small"},{default:S(()=>[H(K(t(m).model.getOperatorLabel(i.assertionOperator)),1)]),_:2},1024)]),isRequired:S(({row:i})=>[A(t($),{type:i.isRequired==="Y"?"error":"default",size:"small"},{default:S(()=>[H(K(i.isRequired==="Y"?"必须":"可选"),1)]),_:2},1032,["type"])]),activeFlag:S(({row:i})=>[A(t(Pe),{value:i.activeFlag==="Y","onUpdate:value":()=>t(q)(i),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),A(me,{visible:t(_),"onUpdate:visible":l[1]||(l[1]=i=>Q(_)?_.value=i:null),mode:t(F),title:t(F)==="create"?"新增断言配置":t(F)==="edit"?"编辑断言配置":"查看断言配置详情",to:"#assert-config-list-modal","form-fields":t(m).model.formFields,"form-tabs":t(m).model.formTabs,"initial-data":t(R)||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(m).model.loading.value,onSubmit:t(x)},null,8,["visible","mode","title","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),Xa=ne(ja,[["__scopeId","data-v-ebd2132f"]]),Qa={class:"route-config-list",id:"hub0021-route-config-list"},Za={class:"route-name-text"},ei={class:"http-methods-container"},ti={key:0,class:"http-method-more"},ai={key:1,class:"http-method-empty"},ii={class:"service-name-container"},oi=le({name:"RouteConfigList",__name:"RouteConfigList",props:{gatewayInstanceId:{default:void 0}},setup(C,{expose:w}){const o=C,c=N(),f=N(),{service:s,formDialogVisible:T,formDialogMode:n,routeFormConfig:h,handleFormSubmit:O,getRouteFormInitialData:m,handleToolbarClick:_,handleMenuClick:F,handleSearch:R,currentRouteConfigId:x,assertConfigDialogVisible:v,ipAccessControlDialogVisible:k,userAgentAccessControlDialogVisible:M,apiAccessControlDialogVisible:q,domainAccessControlDialogVisible:r,corsConfigDialogVisible:e,authConfigDialogVisible:d,rateLimitConfigDialogVisible:l,filterConfigDialogVisible:i}=$a(o.gatewayInstanceId,c,f),u=ae(()=>o.gatewayInstanceId,(L,I)=>{L&&L!==I?s.loadRouteList({gatewayInstanceId:L}):!L&&I&&(s.model.routeList.value=[])},{immediate:!1});ce(()=>{u()});function g(L){if(!o.gatewayInstanceId)return;const I=L?{...L,...o.gatewayInstanceId?{gatewayInstanceId:o.gatewayInstanceId}:{}}:o.gatewayInstanceId?{gatewayInstanceId:o.gatewayInstanceId}:void 0;R(I)}function a(L){return{[W.EXACT]:"success",[W.PREFIX]:"info",[W.REGEX]:"warning"}[L]||"default"}function p(L){return{[W.EXACT]:"精确匹配",[W.PREFIX]:"前缀匹配",[W.REGEX]:"正则匹配"}[L]||"未知"}function b(L){if(!L)return[];if(Array.isArray(L))return L;if(typeof L=="string")try{const I=JSON.parse(L);return Array.isArray(I)?I:[]}catch{return[]}return[]}function y(L){return b(L).slice(0,2)}function B(L){const I=b(L);return Math.max(0,I.length-2)}function J(L){return{GET:"method-get",POST:"method-post",PUT:"method-put",DELETE:"method-delete",PATCH:"method-patch",HEAD:"method-head",OPTIONS:"method-options"}[L.toUpperCase()]||"method-default"}function P(L){return L?L.includes(","):!1}function D(L){return L?L.split(",").map(I=>I.trim()).filter(I=>I):[]}return w({refresh:()=>{s.loadRouteList()}}),(L,I)=>(Y(),j("div",Qa,[A(t(fe),{direction:"vertical","default-size":"80px"},{1:S(()=>[A(Ce,oe({ref_key:"searchFormRef",ref:c,"module-id":t(s).model.moduleId},t(s).model.searchFormConfig,{onSearch:g,onToolbarClick:t(_)}),null,16,["module-id","onToolbarClick"])]),2:S(()=>[A(t(ye),oe({ref_key:"gridRef",ref:f,"module-id":t(s).model.moduleId,data:t(s).model.routeList,loading:t(s).model.loading},t(s).model.gridConfig,{onPageChange:t(s).handlePageChange,onMenuClick:t(F)}),{routeName:S(({row:V})=>[E("span",Za,K(V.routeName),1)]),matchType:S(({row:V})=>[A(t($),{type:a(V.matchType),size:"small"},{default:S(()=>[H(K(p(V.matchType)),1)]),_:2},1032,["type"])]),allowedMethods:S(({row:V})=>[E("div",ei,[b(V.allowedMethods).length>0?(Y(),j(se,{key:0},[(Y(!0),j(se,null,ke(y(V.allowedMethods),(z,ue)=>(Y(),j("span",{key:z,class:Qe(["http-method-tag",J(z)])},K(z),3))),128)),B(V.allowedMethods)>0?(Y(),j("span",ti," +"+K(B(V.allowedMethods)),1)):Ne("",!0)],64)):(Y(),j("span",ai,"全部"))])]),enableWebsocket:S(({row:V})=>[A(t($),{type:V.enableWebsocket==="Y"?"success":"default",size:"small"},{default:S(()=>[H(K(V.enableWebsocket==="Y"?"支持":"不支持"),1)]),_:2},1032,["type"])]),serviceName:S(({row:V})=>[E("div",ii,[V.serviceName?(Y(),ie(t($),{key:0,size:"small",type:"success"},{default:S(()=>[H(K(V.serviceName),1)]),_:2},1024)):V.serviceDefinitionId?(Y(),j(se,{key:1},[P(V.serviceDefinitionId)?(Y(),j(se,{key:0},[(Y(!0),j(se,null,ke(D(V.serviceDefinitionId),(z,ue)=>(Y(),ie(t($),{key:z,size:"small",type:"info",style:{"margin-right":"4px","margin-bottom":"2px"}},{default:S(()=>[H(K(z),1)]),_:2},1024))),128)),A(t($),{size:"small",type:"default",style:{"margin-left":"4px"}},{default:S(()=>[H(K(D(V.serviceDefinitionId).length)+"个服务 ",1)]),_:2},1024)],64)):(Y(),ie(t($),{key:1,size:"small",type:"info"},{default:S(()=>[H(K(V.serviceDefinitionId),1)]),_:2},1024))],64)):(Y(),ie(t($),{key:2,size:"small",type:"default"},{default:S(()=>[...I[10]||(I[10]=[H(" 未关联 ",-1)])]),_:1}))])]),activeFlag:S(({row:V})=>[A(t($),{type:V.activeFlag==="Y"?"success":"error",size:"small"},{default:S(()=>[H(K(V.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),A(me,{visible:t(T),"onUpdate:visible":I[0]||(I[0]=V=>Q(T)?T.value=V:null),mode:t(n),title:t(n)==="create"?"新增路由配置":t(n)==="edit"?"编辑路由配置":"查看路由配置详情",to:"#hub0021-route-config-list","form-fields":t(h).fields,"form-tabs":t(h).tabs,"initial-data":t(m)()||void 0,"auto-close-on-confirm":!1,"confirm-loading":t(s).model.loading.value,onSubmit:t(O)},null,8,["visible","mode","title","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),A(t(Xa),{visible:t(v),"onUpdate:visible":I[1]||(I[1]=V=>Q(v)?v.value=V:null),"route-config-id":t(x),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(bt,{visible:t(k),"onUpdate:visible":I[2]||(I[2]=V=>Q(k)?k.value=V:null),"module-id":"hub0021:ipAccessControl","security-config-id":t(x),title:"IP访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(mt,{visible:t(M),"onUpdate:visible":I[3]||(I[3]=V=>Q(M)?M.value=V:null),"module-id":"hub0021:userAgentAccessControl","security-config-id":t(x),title:"User-Agent访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(vt,{visible:t(q),"onUpdate:visible":I[4]||(I[4]=V=>Q(q)?q.value=V:null),"module-id":"hub0021:apiAccessControl","security-config-id":t(x),title:"API访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(yt,{visible:t(r),"onUpdate:visible":I[5]||(I[5]=V=>Q(r)?r.value=V:null),"module-id":"hub0021:domainAccessControl","security-config-id":t(x),title:"域名访问控制配置",width:1200,to:"#hub0021-route-config-list"},null,8,["visible","security-config-id"]),A(Ct,{visible:t(e),"onUpdate:visible":I[6]||(I[6]=V=>Q(e)?e.value=V:null),"module-id":"hub0021:corsConfig","route-config-id":t(x),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(wt,{visible:t(d),"onUpdate:visible":I[7]||(I[7]=V=>Q(d)?d.value=V:null),"module-id":"hub0021:authConfig","route-config-id":t(x),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(Tt,{visible:t(l),"onUpdate:visible":I[8]||(I[8]=V=>Q(l)?l.value=V:null),"module-id":"hub0021:rateLimitConfig","route-config-id":t(x),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"]),A(t(He),{visible:t(i),"onUpdate:visible":I[9]||(I[9]=V=>Q(i)?i.value=V:null),"module-id":"hub0021:filters","route-config-id":t(x),to:"#hub0021-route-config-list"},null,8,["visible","route-config-id"])]))}}),li=ne(oi,[["__scopeId","data-v-89a2c265"]]),ni={class:"left-panel"},Ke="route-management",si=le({name:"RouteManagement",__name:"RouteManagement",setup(C){const w=N(""),o=de(()=>w.value||"");function c(f,s){w.value=f}return(f,s)=>(Y(),j("div",{class:"route-management",id:Ke},[A(t(fe),{direction:"horizontal","default-size":.25,max:.4},{1:S(()=>[E("div",ni,[A(t(Qt),{"parent-module-id":Ke,onSelect:c})])]),2:S(()=>[(Y(),ie(t(li),{"gateway-instance-id":o.value,key:`routes-${o.value}`},null,8,["gateway-instance-id"]))]),_:1})]))}}),Yi=ne(si,[["__scopeId","data-v-db1572a6"]]);export{Yi as default};

import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-DHrAwNdU.js";import{u as W}from"./useGDialog-Drbk1sbt.js";import{d as B,r as w,a7 as V,av as J,g as _,o as P,w as v,f as j,e as t,b,am as A,aO as z,K as E,t as F,i as $,_ as q,c as Z,G as X,J as ee,aQ as ae,aa as K,T as U,af as te,m as se,z as k,B as C}from"./index-DFGZIhYV.js";import{G as le,S as ne,c as re}from"./SearchForm-DCaazdSn.js";import{G as ie}from"./GModal-BU-dfYjc.js";import{G as oe}from"./GPane-BTUOh7ra.js";import{u as ce}from"./useServiceCenterInstanceService-nOTsS2nY.js";import{C as ue}from"./CheckmarkCircleOutline-CyuISCiF.js";import{A as de}from"./AlertCircleOutline-Db7SqGAd.js";import{H as pe}from"./HourglassOutline-DucYdKJ2.js";import{S as me}from"./StopCircleOutline-BcZIFQQh.js";import{E as fe}from"./EllipsisHorizontalOutline-430BK1Xe.js";import{N as ve}from"./InputGroup-CeDzPNaS.js";import{A as be}from"./AddOutline-DgCmJB8N.js";import{C as ge}from"./CreateOutline-BRBQ9kgF.js";import{T as he}from"./TrashOutline-DQN-WA1t.js";import{W as Ne}from"./WarningOutline-CMATMreo.js";const ye=["id"],Ie=B({name:"ServiceCenterInstanceListModal",__name:"ServiceCenterInstanceListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{default:void 0},modelValue:{default:""}},emits:["update:visible","after-leave","select","update:modelValue"],setup(s,{emit:l}){const n=s,o=l,r=w(),g=w(),N=w(n.visible),O=V(()=>n.visible,e=>{N.value=e,e&&I()}),c=ce(r);c.loadInstances();const u=e=>{N.value=e,o("update:visible",e)},y=()=>{o("after-leave")},I=()=>{c.handleSearch()},L=({row:e})=>{e&&(o("update:modelValue",e.instanceName),o("select",e),u(!1))};function h(e){return{RUNNING:"success",STOPPED:"default",STARTING:"info",STOPPING:"warning",ERROR:"error"}[e]||"default"}function G(e){return{RUNNING:"运行中",STOPPED:"停止",STARTING:"启动中",STOPPING:"停止中",ERROR:"异常"}[e]||e}return J(()=>{O()}),(e,i)=>(P(),_(t(ie),{visible:N.value,title:n.title||"选择服务中心实例",width:n.width||1200,to:n.to,"show-footer":!1,"onUpdate:visible":u,onAfterLeave:y},{default:v(()=>[j("div",{class:"service-center-instance-list-modal",id:t(c).model.moduleId},[b(t(oe),{direction:"vertical","no-resize":!0},{1:v(()=>[b(ne,A({ref_key:"searchFormRef",ref:r,"module-id":t(c).model.moduleId},t(c).model.searchFormConfig,{onSearch:I}),null,16,["module-id"])]),2:v(()=>[b(t(le),A({ref_key:"gridRef",ref:g,"module-id":t(c).model.moduleId,data:t(c).model.instanceList,loading:t(c).model.loading},t(c).model.gridConfig,{onPageChange:t(c).handlePageChange,onRowClick:L}),{instanceStatus:v(({row:p})=>[b(t(z),{type:h(p.instanceStatus),size:"small"},{icon:v(()=>[b(t($),null,{default:v(()=>[p.instanceStatus==="RUNNING"?(P(),_(t(ue),{key:0})):p.instanceStatus==="ERROR"?(P(),_(t(de),{key:1})):p.instanceStatus==="STARTING"||p.instanceStatus==="STOPPING"?(P(),_(t(pe),{key:2})):(P(),_(t(me),{key:3}))]),_:2},1024)]),default:v(()=>[E(" "+F(G(p.instanceStatus)),1)]),_:2},1032,["type"])]),activeFlag:v(({row:p})=>[b(t(z),{type:p.activeFlag==="Y"?"success":"default",size:"small"},{default:v(()=>[E(F(p.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,ye)]),_:1},8,["visible","title","width","to"]))}}),Se=q(Ie,[["__scopeId","data-v-a93d689a"]]),we=B({name:"ServiceCenterInstanceNameSelector",__name:"ServiceCenterInstanceNameSelector",props:{modelValue:{default:""}},emits:["update:modelValue","select"],setup(s,{emit:l}){const n=s,o=l,r=w(!1),g=w(n.modelValue);V(()=>n.modelValue,u=>{g.value=u}),V(g,u=>{o("update:modelValue",u)});const N=u=>{g.value=u},O=()=>{r.value=!0},c=u=>{u&&(g.value=u.instanceName,o("select",u))};return(u,y)=>(P(),Z(ae,null,[b(t(ve),null,{default:v(()=>[b(t(X),{value:s.modelValue,placeholder:"请输入实例名称或点击选择",clearable:"",size:"small","onUpdate:value":N},null,8,["value"]),b(t(ee),{type:"primary",size:"small",onClick:O},{icon:v(()=>[b(t($),null,{default:v(()=>[b(t(fe))]),_:1})]),_:1})]),_:1}),b(Se,{visible:r.value,"onUpdate:visible":y[0]||(y[0]=I=>r.value=I),"model-value":g.value,"onUpdate:modelValue":y[1]||(y[1]=I=>g.value=I),title:"选择服务中心实例",width:1200,onSelect:c},null,8,["visible","model-value"])],64))}}),Y=q(we,[["__scopeId","data-v-4f712468"]]);function Oe(){const s="hub0041",l=w(!1),n=w([]),o=w(),r={fields:[{field:"namespaceName",label:"命名空间名称",type:"input",placeholder:"请输入命名空间名称",span:6,clearable:!0},{field:"instanceName",label:"服务中心实例",type:"custom",span:6,render:e=>U(Y,{modelValue:e.instanceName||"","onUpdate:modelValue":i=>{e.instanceName=i}})},{field:"environment",label:"部署环境",type:"select",placeholder:"请选择环境",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"开发环境",value:"DEVELOPMENT"},{label:"预发布环境",value:"STAGING"},{label:"生产环境",value:"PRODUCTION"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建命名空间",icon:be,type:"primary",tooltip:"新建命名空间"},{key:"edit",label:"编辑",icon:ge,tooltip:"编辑选中的命名空间"},{key:"delete",label:"删除",icon:he,type:"error",tooltip:"删除选中的命名空间"}],showSearchButton:!0,showResetButton:!0},g={tabs:[{key:"basic",label:"基本信息"},{key:"quota",label:"配额配置"},{key:"other",label:"其它"}],fields:[{field:"namespaceId",label:"命名空间ID",type:"input",placeholder:"自动生成或手动输入（32个字符：字母、数字、下划线）",span:12,tabKey:"basic",primary:!0,required:!0,tips:"命名空间唯一标识（主键），32个字符：字母、数字、下划线，如果不填写将自动生成",rules:[{pattern:/^[a-zA-Z0-9_]{1,32}$/,message:"命名空间ID只能包含字母、数字、下划线，且长度不超过32个字符",trigger:["change","blur"]}],props:{maxlength:32}},{field:"namespaceName",label:"命名空间名称",type:"input",placeholder:"请输入命名空间名称（32个字符：字母、数字、下划线）",span:12,tabKey:"basic",required:!0,rules:[{pattern:/^[a-zA-Z0-9_]{1,32}$/,message:"命名空间名称只能包含字母、数字、下划线，且长度不超过32个字符",trigger:["change","blur"]}],props:{maxlength:32}},{field:"instanceName",label:"服务中心实例",type:"custom",span:12,tabKey:"basic",required:!0,tips:"关联的服务中心实例名称",render:e=>U(Y,{modelValue:e.instanceName||"","onUpdate:modelValue":i=>{e.instanceName=i},onSelect:i=>{i&&i.environment&&(e.environment=i.environment)}})},{field:"environment",label:"部署环境",type:"select",placeholder:"请选择部署环境",span:12,tabKey:"basic",required:!0,disabled:!0,options:[{label:"开发环境",value:"DEVELOPMENT"},{label:"预发布环境",value:"STAGING"},{label:"生产环境",value:"PRODUCTION"}],tips:"部署环境由选择的服务中心实例自动确定"},{field:"namespaceDescription",label:"命名空间描述",type:"textarea",placeholder:"请输入命名空间描述",span:24,tabKey:"basic",props:{rows:3}},{field:"activeFlag",label:"活动状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"serviceQuotaLimit",label:"服务数量配额限制",type:"number",placeholder:"200",span:12,tabKey:"quota",defaultValue:200,tips:"该命名空间下允许的最大服务数量，0表示无限制",props:{min:0}},{field:"configQuotaLimit",label:"配置数量配额限制",type:"number",placeholder:"200",span:12,tabKey:"quota",defaultValue:200,tips:"该命名空间下允许的最大配置数量，0表示无限制",props:{min:0}},{field:"noteText",label:"备注",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{rows:3}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}]},N={columns:[{field:"namespaceId",title:"命名空间ID",sortable:!0,align:"center",showOverflow:!0},{field:"namespaceName",title:"命名空间名称",sortable:!0,align:"center",showOverflow:!0},{field:"instanceName",title:"服务中心实例",sortable:!0,align:"center",showOverflow:!0},{field:"environment",title:"部署环境",sortable:!0,align:"center",showOverflow:!0,formatter:({cellValue:e})=>({DEVELOPMENT:"开发环境",STAGING:"预发布环境",PRODUCTION:"生产环境"})[e]||e},{field:"namespaceDescription",title:"描述",align:"left",showOverflow:!0,width:200},{field:"serviceQuotaLimit",title:"服务配额",align:"center",formatter:({cellValue:e})=>e===0?"无限制":e},{field:"configQuotaLimit",title:"配置配额",align:"center",formatter:({cellValue:e})=>e===0?"无限制":e},{field:"activeFlag",title:"活动状态",align:"center",slots:{default:"activeFlag"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?K(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?K(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:o,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},O=()=>{o.value=void 0},c=e=>{o.value?Object.assign(o.value,e):o.value=e},u=e=>{n.value=e},y=()=>{n.value=[]},I=e=>{n.value.unshift(e)},L=(e,i,p)=>{const T=n.value.findIndex(R=>R.namespaceId===e&&R.tenantId===i);T!==-1&&Object.assign(n.value[T],p)},h=(e,i)=>{const p=n.value.findIndex(T=>T.namespaceId===e&&T.tenantId===i);p!==-1&&n.value.splice(p,1)};return{moduleId:s,loading:l,namespaceList:n,pageInfo:o,searchFormConfig:r,namespaceFormConfig:g,gridConfig:N,resetPagination:O,updatePagination:c,setNamespaceList:u,clearNamespaceList:y,addNamespaceToList:I,updateNamespaceInList:L,removeNamespaceFromList:h,removeNamespacesFromList:e=>{e.forEach(i=>{h(i.namespaceId,i.tenantId)})}}}const x=te("/gateway/hub0041");async function Ce(s){return x.post("/queryNamespaces",s)}async function Te(s){return x.post("/getNamespace",{namespaceId:s})}async function De(s){return x.post("/addNamespace",s)}async function Pe(s){return x.post("/editNamespace",s)}async function Me(s){return x.post("/deleteNamespace",{namespaceId:s})}function Je(s){const l=se(),n=W(),o=Oe(),{loading:r,namespaceList:g,pageInfo:N,setNamespaceList:O,updatePagination:c,addNamespaceToList:u,updateNamespaceInList:y,removeNamespaceFromList:I,removeNamespacesFromList:L}=o,h=async d=>{var a,m,f;r.value=!0;try{let M=d;!M&&((a=s==null?void 0:s.value)!=null&&a.getFormData)&&(M=s.value.getFormData()||{});const H={...M?Object.fromEntries(Object.entries(M).filter(([,S])=>S!==""&&S!==null&&S!==void 0)):{},...re((m=N.value)==null?void 0:m.pageIndex,(f=N.value)==null?void 0:f.pageSize)},D=await Ce(H);if(D.oK){if(D.bizData){const S=JSON.parse(D.bizData),Q=Array.isArray(S)?S:[];O(Q)}if(D.pageQueryData){const S=JSON.parse(D.pageQueryData);c(S)}}else l.error(D.errMsg||"查询命名空间列表失败")}catch{l.error("加载命名空间列表失败")}finally{r.value=!1}};return{model:o,loadNamespaces:h,handleSearch:async d=>{await h(d)},handleReset:async()=>{o.resetPagination(),await h()},handlePageChange:async({currentPage:d,pageSize:a})=>{c({pageIndex:d,pageSize:a}),await h()},handleRefresh:async()=>{await h()},addNamespace:async d=>{r.value=!0;try{const a=await De(d);if(k(a)){const m=C(a,"命名空间创建成功");if(l.success(m),a.bizData){const f=JSON.parse(a.bizData);u(f)}else await h();return!0}else{const m=C(a,"新增命名空间失败");return l.error(m),!1}}catch{return l.error("新增命名空间失败"),!1}finally{r.value=!1}},editNamespace:async d=>{r.value=!0;try{const a=await Pe(d);if(k(a)){const m=C(a,"命名空间更新成功");if(l.success(m),a.bizData){const f=JSON.parse(a.bizData);y(f.namespaceId,f.tenantId,f)}return!0}else{const m=C(a,"编辑命名空间失败");return l.error(m),!1}}catch{return l.error("编辑命名空间失败"),!1}finally{r.value=!1}},deleteNamespace:async d=>{if(!await n.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除命名空间 "${d.namespaceName}" (${d.namespaceId}) 吗？`,icon:Ne,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;r.value=!0;try{const m=await Me(d.namespaceId);if(k(m)){const f=C(m,"命名空间删除成功");return l.success(f),I(d.namespaceId,d.tenantId),!0}else{const f=C(m,"删除命名空间失败");return l.error(f),!1}}catch{return l.error("删除命名空间失败"),!1}finally{r.value=!1}},getNamespaceDetail:async d=>{r.value=!0;try{const a=await Te(d);return k(a)&&a.bizData?JSON.parse(a.bizData):(l.error(C(a,"获取命名空间详情失败")),null)}catch{return l.error("获取命名空间详情失败"),null}finally{r.value=!1}}}}export{Je as u};

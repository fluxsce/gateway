import{d as J,e as Y,g as z,cO as oe,c as H,m as a,n as e,w as s,o as A,aO as re,bU as ie,q as B,V as ae,a as F,p as ce,v as E,x,_ as j,W as ue,a8 as I,aM as de,I as R,bR as L,b as Z,r as C,h as le,E as O,cU as ve,ck as pe,J as P,a0 as U,a1 as ee,dj as me,a2 as T,R as fe,B as he,M as ge,A as Q,C as w,Y as be,t as te,H as _e,co as ye}from"./index-2fJuYE9W.js";import{q as Ce,d as ke,r as we,s as Te,a as xe,u as Se,c as Ie,g as Ne,b as Pe}from"./index-nBwvlTB2.js";import{C as Re}from"./CheckmarkCircleOutline-oCPbp87B.js";import{C as De}from"./CloseCircleOutline-BZvqUJeS.js";import{A as Me}from"./AlertCircleOutline-B4NPmBYq.js";import{L as ze}from"./LinkOutline-DsJyhcnJ.js";import{a as Fe,_ as Ue}from"./Grid-Bcw7BDe2.js";import{S as Ae}from"./StopOutline-Dko3V11s.js";import{P as Ee}from"./PlayOutline-C4RjDpVd.js";import{R as se}from"./RefreshOutline-YIyYHhq5.js";import{N as Ye}from"./Popconfirm-CNoy-XXi.js";import{A as Oe}from"./AddOutline-CkIJ1zcN.js";import{_ as $e}from"./RadioGroup-BZdw_79m.js";import{_ as qe}from"./DataTable-j6x_03X-.js";import{N as q}from"./InputNumber-CwEQyyC1.js";import{N as X}from"./Switch-Bco2TRoA.js";const Ve={class:"tunnel-client-stats"},Be={class:"stat-content"},He={class:"stat-info"},Le={class:"stat-value"},Je={class:"stat-label"},je=J({__name:"TunnelClientStats",props:{statistics:{}},setup(y){const p=y,{t:c}=Y("hub0062"),m=z(()=>[{key:"total",label:c("stats.total"),value:p.statistics.totalClients,icon:oe},{key:"connected",label:c("stats.connected"),value:p.statistics.connectedClients,icon:Re},{key:"disconnected",label:c("stats.disconnected"),value:p.statistics.disconnectedClients,icon:De},{key:"error",label:c("stats.error"),value:p.statistics.errorClients,icon:Me},{key:"services",label:c("stats.services"),value:p.statistics.totalServices,icon:ze}]);return(l,f)=>(A(),H("div",Ve,[a(e(Ue),{cols:5,"x-gap":12,"y-gap":12,responsive:"screen"},{default:s(()=>[(A(!0),H(re,null,ie(m.value,i=>(A(),B(e(Fe),{key:i.key},{default:s(()=>[a(e(ae),{class:"stat-card",hoverable:""},{default:s(()=>[F("div",Be,[F("div",{class:ce(["stat-icon",i.key])},[a(e(E),{size:"24",component:i.icon},null,8,["component"])],2),F("div",He,[F("div",Le,x(i.value),1),F("div",Je,x(i.label),1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))}}),Ke=j(je,[["__scopeId","data-v-760217e7"]]),We=y=>({connected:"success",disconnected:"default",connecting:"warning",error:"error"})[y]||"default",Ge=(y,p,c)=>[{title:p("table.clientName"),key:"clientName",width:150,fixed:"left",ellipsis:{tooltip:!0}},{title:p("table.serverAddress"),key:"serverAddress",width:180,ellipsis:{tooltip:!0}},{title:p("table.serverPort"),key:"serverPort",width:100,align:"right"},{title:p("table.connectionStatus"),key:"connectionStatus",width:120,render:m=>I(de,{type:We(m.connectionStatus),size:"small"},{default:()=>p(`status.${m.connectionStatus}`)})},{title:p("table.serviceCount"),key:"serviceCount",width:100,align:"right"},{title:p("table.lastHeartbeat"),key:"lastHeartbeat",width:180,render:m=>m.lastHeartbeat?ue(m.lastHeartbeat,"YYYY-MM-DD HH:mm:ss"):"-"},{title:c("actions"),key:"actions",width:280,fixed:"right",render:m=>I(L,{size:"small"},{default:()=>[m.connectionStatus==="connected"?I(R,{size:"small",type:"warning",onClick:()=>y("stop",m)},{default:()=>c("stop"),icon:()=>I(E,{component:Ae})}):I(R,{size:"small",type:"success",onClick:()=>y("start",m)},{default:()=>c("start"),icon:()=>I(E,{component:Ee})}),I(R,{size:"small",onClick:()=>y("restart",m)},{default:()=>c("restart"),icon:()=>I(E,{component:se})}),I(R,{size:"small",type:"primary",onClick:()=>y("edit",m)},{default:()=>c("edit")}),I(Ye,{onPositiveClick:()=>y("delete",m)},{default:()=>c("confirmDelete"),trigger:()=>I(R,{size:"small",type:"error"},{default:()=>c("delete")})})]})}],Qe={class:"tunnel-client-table"},Xe={class:"table-toolbar"},Ze=J({__name:"TunnelClientTable",props:{autoLoad:{type:Boolean,default:!0}},emits:["create","edit","refresh"],setup(y,{expose:p,emit:c}){const m=y,l=c,{t:f}=Y("hub0062"),{t:i}=Y("common"),v=Z(),S=C(!1),D=C([]),M=C(""),N=C(null),b=C({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50,100],prefix:d=>i("totalItems",{count:d.itemCount})}),o=z(()=>[{label:f("status.connected"),value:"connected"},{label:f("status.disconnected"),value:"disconnected"},{label:f("status.connecting"),value:"connecting"},{label:f("status.error"),value:"error"}]),g=async(d,n)=>{switch(d){case"start":await t(n);break;case"stop":await r(n);break;case"restart":await ne(n);break;case"edit":l("edit",n);break;case"delete":await u(n);break}},k=z(()=>Ge(g,f,i)),_=async()=>{S.value=!0;try{const d=await Ce({keyword:M.value||void 0,connectionStatus:N.value||void 0,pageIndex:b.value.page,pageSize:b.value.pageSize});if(U(d)){D.value=ee(d,[]);const n=me(d);b.value.itemCount=n.itemCount}else{const n=T(d,i("loadFailed"));v.error(n)}}catch(d){console.error("加载客户端列表失败:",d),v.error(i("loadFailed"))}finally{S.value=!1}},K=()=>{b.value.page=1,_()},V=()=>{b.value.page=1,_()},W=d=>{b.value.page=d,_()},$=d=>{b.value.pageSize=d,b.value.page=1,_()},G=()=>{l("create")},u=async d=>{try{const n=await ke(d.tunnelClientId);if(U(n)){const h=T(n,i("deleteSuccess"));v.success(h),await _(),l("refresh")}else{const h=T(n,i("deleteFailed"));v.error(h)}}catch(n){console.error("删除客户端失败:",n),v.error(i("deleteFailed"))}},t=async d=>{try{const n=await xe(d.tunnelClientId);if(U(n)){const h=T(n,"客户端启动成功");v.success(h),await _(),l("refresh")}else{const h=T(n,"客户端启动失败");v.error(h)}}catch(n){console.error("启动客户端失败:",n),v.error("启动客户端失败")}},r=async d=>{try{const n=await Te(d.tunnelClientId);if(U(n)){const h=T(n,"客户端停止成功");v.success(h),await _(),l("refresh")}else{const h=T(n,"客户端停止失败");v.error(h)}}catch(n){console.error("停止客户端失败:",n),v.error("停止客户端失败")}},ne=async d=>{try{const n=await we(d.tunnelClientId);if(U(n)){const h=T(n,"客户端重启成功");v.success(h),await _(),l("refresh")}else{const h=T(n,"客户端重启失败");v.error(h)}}catch(n){console.error("重启客户端失败:",n),v.error("重启客户端失败")}};return p({initialize:async()=>{await _()},loadData:_}),le(()=>{m.autoLoad&&_()}),(d,n)=>(A(),H("div",Qe,[F("div",Xe,[a(e(L),{size:16},{default:s(()=>[a(e(O),{value:M.value,"onUpdate:value":[n[0]||(n[0]=h=>M.value=h),K],placeholder:e(i)("searchPlaceholder"),clearable:"",style:{width:"300px"}},{prefix:s(()=>[a(e(E),{component:e(ve)},null,8,["component"])]),_:1},8,["value","placeholder"]),a(e($e),{value:N.value,"onUpdate:value":[n[1]||(n[1]=h=>N.value=h),V],placeholder:e(f)("filter.status"),options:o.value,clearable:"",style:{width:"150px"}},null,8,["value","placeholder","options"])]),_:1}),a(e(L),{size:16},{default:s(()=>[pe(d.$slots,"toolbar-actions",{},void 0,!0),a(e(R),{type:"primary",onClick:G},{icon:s(()=>[a(e(E),{component:e(Oe)},null,8,["component"])]),default:s(()=>[P(" "+x(e(i)("create")),1)]),_:1})]),_:3})]),a(e(qe),{columns:k.value,data:D.value,loading:S.value,pagination:b.value,"row-key":h=>h.tunnelClientId,"scroll-x":1200,"onUpdate:page":W,"onUpdate:pageSize":$},null,8,["columns","data","loading","pagination","row-key"])]))}}),et=j(Ze,[["__scopeId","data-v-5b303dcb"]]),tt=J({__name:"TunnelClientDialog",props:{show:{type:Boolean,default:!1},editData:{default:null}},emits:["update:show","success"],setup(y,{emit:p}){const c=y,m=p,{t:l}=Y("hub0062"),{t:f}=Y("common"),i=Z(),v=C(),S=C(!1),D=C(!1),M=z({get:()=>o.value.tlsEnable==="Y",set:u=>o.value.tlsEnable=u?"Y":"N"}),N=z({get:()=>o.value.autoReconnect==="Y",set:u=>o.value.autoReconnect=u?"Y":"N"}),b=z({get:()=>o.value.activeFlag==="Y",set:u=>o.value.activeFlag=u?"Y":"N"}),o=C({clientName:"",clientDescription:"",serverAddress:"",serverPort:7e3,authToken:"",tlsEnable:"N",autoReconnect:"Y",maxRetries:5,retryInterval:20,heartbeatInterval:30,heartbeatTimeout:90,activeFlag:"Y"}),g=z(()=>!!c.editData),k=z({get:()=>c.show,set:u=>m("update:show",u)}),_={clientName:[{required:!0,message:l("form.clientNameRequired"),trigger:"blur"}],serverAddress:[{required:!0,message:l("form.serverAddressRequired"),trigger:"blur"}],serverPort:[{required:!0,type:"number",message:l("form.serverPortRequired"),trigger:"blur"}],authToken:[{required:!0,message:l("form.authTokenRequired"),trigger:"blur"}]},K=async()=>{if(c.editData){S.value=!0;try{const u=await Ne(c.editData.tunnelClientId);if(U(u)){const t=ee(u,{});if(o.value={tunnelClientId:t.tunnelClientId,clientName:t.clientName,clientDescription:t.clientDescription,clientVersion:t.clientVersion,operatingSystem:t.operatingSystem,serverAddress:t.serverAddress,serverPort:t.serverPort,authToken:t.authToken,tlsEnable:t.tlsEnable,autoReconnect:t.autoReconnect,maxRetries:t.maxRetries,retryInterval:t.retryInterval,heartbeatInterval:t.heartbeatInterval,heartbeatTimeout:t.heartbeatTimeout,activeFlag:t.activeFlag,noteText:t.noteText},t.clientConfig)try{o.value.clientConfig=typeof t.clientConfig=="string"?JSON.parse(t.clientConfig):t.clientConfig}catch(r){console.error("解析客户端配置失败:",r)}}else{const t=T(u,"获取客户端详情失败");i.error(t),$()}}catch(u){console.error("获取客户端详情失败:",u),i.error("获取客户端详情失败"),$()}finally{S.value=!1}}},V=()=>{var u;o.value={clientName:"",clientDescription:"",serverAddress:"",serverPort:7e3,authToken:"",tlsEnable:"N",autoReconnect:"Y",maxRetries:5,retryInterval:20,heartbeatInterval:30,heartbeatTimeout:90,activeFlag:"Y"},(u=v.value)==null||u.restoreValidation()},W=async()=>{var u;try{await((u=v.value)==null?void 0:u.validate()),D.value=!0;const t=g.value?await Se(o.value):await Ie(o.value);if(U(t)){const r=T(t,f(g.value?"updateSuccess":"createSuccess"));i.success(r),k.value=!1,m("success")}else{const r=T(t,f("operationFailed"));i.error(r)}}catch(t){t!=null&&t.errors||(console.error("提交失败:",t),i.error(f("operationFailed")))}finally{D.value=!1}},$=()=>{k.value=!1},G=()=>{V()};return fe(()=>c.show,u=>{u&&(g.value?K():V())}),(u,t)=>(A(),B(e(ye),{show:k.value,"onUpdate:show":t[13]||(t[13]=r=>k.value=r),"mask-closable":!1,preset:"card",title:g.value?e(l)("dialog.editTitle"):e(l)("dialog.createTitle"),style:{width:"800px"},onAfterLeave:G},{footer:s(()=>[a(e(L),{justify:"end"},{default:s(()=>[a(e(R),{onClick:$},{default:s(()=>[P(x(e(f)("cancel")),1)]),_:1}),a(e(R),{type:"primary",loading:D.value,onClick:W},{default:s(()=>[P(x(e(f)("confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:s(()=>[a(e(_e),{show:S.value},{default:s(()=>[a(e(he),{ref_key:"formRef",ref:v,model:o.value,rules:_,"label-placement":"left","label-width":"140px","require-mark-placement":"right-hanging",disabled:S.value},{default:s(()=>[a(e(ge),{type:"line",animated:""},{default:s(()=>[a(e(Q),{name:"basic",tab:e(l)("dialog.tabs.basic")},{default:s(()=>[a(e(w),{label:e(l)("form.clientName"),path:"clientName"},{default:s(()=>[a(e(O),{value:o.value.clientName,"onUpdate:value":t[0]||(t[0]=r=>o.value.clientName=r),placeholder:e(l)("form.clientNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(w),{label:e(l)("form.clientDescription"),path:"clientDescription"},{default:s(()=>[a(e(O),{value:o.value.clientDescription,"onUpdate:value":t[1]||(t[1]=r=>o.value.clientDescription=r),placeholder:e(l)("form.clientDescriptionPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(be),null,{default:s(()=>[P(x(e(l)("form.serverConnectionInfo")),1)]),_:1}),a(e(w),{label:e(l)("form.serverAddress"),path:"serverAddress"},{default:s(()=>[a(e(O),{value:o.value.serverAddress,"onUpdate:value":t[2]||(t[2]=r=>o.value.serverAddress=r),placeholder:e(l)("form.serverAddressPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(w),{label:e(l)("form.serverPort"),path:"serverPort"},{default:s(()=>[a(e(q),{value:o.value.serverPort,"onUpdate:value":t[3]||(t[3]=r=>o.value.serverPort=r),placeholder:e(l)("form.serverPortPlaceholder"),min:1,max:65535,style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(w),{label:e(l)("form.authToken"),path:"authToken"},{default:s(()=>[a(e(O),{value:o.value.authToken,"onUpdate:value":t[4]||(t[4]=r=>o.value.authToken=r),type:"password","show-password-on":"click",placeholder:e(l)("form.authTokenPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["tab"]),a(e(Q),{name:"advanced",tab:e(l)("dialog.tabs.advanced")},{default:s(()=>[a(e(w),{label:e(l)("form.tlsEnable"),path:"tlsEnable"},{default:s(()=>[a(e(X),{value:M.value,"onUpdate:value":t[5]||(t[5]=r=>M.value=r)},null,8,["value"])]),_:1},8,["label"]),a(e(w),{label:e(l)("form.autoReconnect"),path:"autoReconnect"},{default:s(()=>[a(e(X),{value:N.value,"onUpdate:value":t[6]||(t[6]=r=>N.value=r)},null,8,["value"])]),_:1},8,["label"]),N.value?(A(),B(e(w),{key:0,label:e(l)("form.maxRetries"),path:"maxRetries"},{default:s(()=>[a(e(q),{value:o.value.maxRetries,"onUpdate:value":t[7]||(t[7]=r=>o.value.maxRetries=r),placeholder:e(l)("form.maxRetriesPlaceholder"),min:1,max:100,style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])):te("",!0),N.value?(A(),B(e(w),{key:1,label:e(l)("form.retryInterval"),path:"retryInterval"},{default:s(()=>[a(e(q),{value:o.value.retryInterval,"onUpdate:value":t[8]||(t[8]=r=>o.value.retryInterval=r),placeholder:e(l)("form.retryIntervalPlaceholder"),min:5,max:300,style:{width:"100%"}},{suffix:s(()=>[P(x(e(f)("seconds")),1)]),_:1},8,["value","placeholder"])]),_:1},8,["label"])):te("",!0),a(e(w),{label:e(l)("form.heartbeatInterval"),path:"heartbeatInterval"},{default:s(()=>[a(e(q),{value:o.value.heartbeatInterval,"onUpdate:value":t[9]||(t[9]=r=>o.value.heartbeatInterval=r),placeholder:e(l)("form.heartbeatIntervalPlaceholder"),min:10,max:300,style:{width:"100%"}},{suffix:s(()=>[P(x(e(f)("seconds")),1)]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(e(w),{label:e(l)("form.heartbeatTimeout"),path:"heartbeatTimeout"},{default:s(()=>[a(e(q),{value:o.value.heartbeatTimeout,"onUpdate:value":t[10]||(t[10]=r=>o.value.heartbeatTimeout=r),placeholder:e(l)("form.heartbeatTimeoutPlaceholder"),min:30,max:600,style:{width:"100%"}},{suffix:s(()=>[P(x(e(f)("seconds")),1)]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["tab"]),a(e(Q),{name:"note",tab:e(l)("dialog.tabs.note")},{default:s(()=>[a(e(w),{label:e(l)("form.activeFlag"),path:"activeFlag"},{default:s(()=>[a(e(X),{value:b.value,"onUpdate:value":t[11]||(t[11]=r=>b.value=r)},{checked:s(()=>[P(x(e(f)("active")),1)]),unchecked:s(()=>[P(x(e(f)("inactive")),1)]),_:1},8,["value"])]),_:1},8,["label"]),a(e(w),{label:e(l)("form.noteText"),path:"noteText"},{default:s(()=>[a(e(O),{value:o.value.noteText,"onUpdate:value":t[12]||(t[12]=r=>o.value.noteText=r),type:"textarea",placeholder:e(l)("form.noteTextPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["show"])]),_:1},8,["show","title"]))}}),at=j(tt,[["__scopeId","data-v-3a5e0d30"]]),lt={class:"tunnel-client-management"},st={class:"stats-section"},nt={class:"main-content"},ot=J({__name:"TunnelClientManagement",setup(y){Y("hub0062");const{t:p}=Y("common"),c=Z(),m=C(null),l=C(!1),f=C({totalClients:0,connectedClients:0,disconnectedClients:0,connectingClients:0,errorClients:0,totalServices:0}),i=C(!1),v=C(null),S=async()=>{try{const g=await Pe();if(U(g)){const k=ee(g,{totalClients:0,connectedClients:0,disconnectedClients:0,connectingClients:0,errorClients:0,totalServices:0});f.value=k}}catch(g){console.error("获取统计信息失败:",g)}},D=()=>{v.value=null,i.value=!0},M=g=>{v.value=g,i.value=!0},N=()=>{v.value=null,i.value=!1,o()},b=async()=>{var g;l.value=!0;try{await Promise.all([S(),(g=m.value)==null?void 0:g.initialize()]),c.success(p("refreshSuccess"))}catch(k){console.error("刷新数据失败:",k),c.error(p("refreshFailed"))}finally{l.value=!1}},o=async()=>{await b()};return le(()=>{o()}),(g,k)=>(A(),H("div",lt,[F("div",st,[a(Ke,{statistics:f.value},null,8,["statistics"])]),F("div",nt,[a(e(ae),{bordered:!1,class:"content-card"},{default:s(()=>[a(et,{ref_key:"tableRef",ref:m,"auto-load":!1,onCreate:D,onEdit:M,onRefresh:S},{"toolbar-actions":s(()=>[a(e(R),{onClick:b,loading:l.value},{icon:s(()=>[a(e(E),{component:e(se)},null,8,["component"])]),default:s(()=>[P(" "+x(e(p)("refresh")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),a(at,{show:i.value,"onUpdate:show":k[0]||(k[0]=_=>i.value=_),"edit-data":v.value,onSuccess:N},null,8,["show","edit-data"])]))}}),Tt=j(ot,[["__scopeId","data-v-4585b31d"]]);export{Tt as default};

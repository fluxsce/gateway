import{d as ee,c as B,o as M,a,s as de,u as we,b as be,e as ue,r as C,f as he,g as ne,h as ye,l,i as E,j as Ce,k as ge,m as s,n as e,N as ke,w as i,p as xe,q as se,t as re,v as D,x as f,y as Me,_ as me,z as Te,S as Ie,D as Le,P as Se,A as Pe,B as Re,C as Fe,E as De,F as Y,L as qe,G as ze,H as Ke,I as Ne,J as j,K as Ae,M as Be,O as Ue}from"./index-DfObWGJe.js";const $e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=ee({name:"PersonOutline",render:function(h,n){return M(),B("svg",$e,n[0]||(n[0]=[a("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ee=ee({name:"PhonePortraitOutline",render:function(h,n){return M(),B("svg",Ve,n[0]||(n[0]=[a("rect",{x:"128",y:"16",width:"256",height:"480",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M176 16h24a8 8 0 0 1 8 8h0a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16h0a8 8 0 0 1 8-8h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),pe={login(b){return de({url:"/gateway/user/login",method:"post",data:b})},getCaptcha(){return de({url:"/gateway/user/captcha",method:"post",params:{t:new Date().getTime()}})}};function fe(b){if(b.oK&&b.state&&b.bizData)try{return JSON.parse(b.bizData)}catch{return null}return null}function Ye(){const b=we(),h=be(),{t:n}=ue("hub0001"),{t:q}=ue("common"),I=C(null),L=C(null),y=C(!1),p=C(!1),k=C(""),G=C(""),X=C(0),U=C(""),S=C(!1),P=C(60),W=he({userId:"",password:"",captchaCode:"",rememberMe:!1}),x=he({phone:"",code:"",rememberMe:!1}),$=ne(()=>({userId:[{required:!0,message:n("validation.userIdRequired"),trigger:"blur"},{min:3,max:20,message:n("validation.userIdLength"),trigger:"blur"}],password:[{required:!0,message:n("validation.passwordRequired"),trigger:"blur"},{min:6,max:32,message:n("validation.passwordLength"),trigger:"blur"}],captchaCode:[{required:!0,message:n("validation.captchaRequired"),trigger:"blur"},{len:6,message:n("validation.captchaLength"),trigger:"blur"}]})),te=ne(()=>({phone:[{required:!0,message:n("validation.phoneRequired"),trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:n("validation.phoneFormat"),trigger:"blur"}],code:[{required:!0,message:n("validation.codeRequired"),trigger:"blur"},{len:6,message:n("validation.codeLength"),trigger:"blur"}]})),J=async c=>new Promise(g=>{requestAnimationFrame(()=>{try{const o=document.createElement("canvas"),t=o.getContext("2d");if(!t){g("");return}o.width=140,o.height=50;const O=t.createLinearGradient(0,0,o.width,o.height);O.addColorStop(0,"#f8f9fa"),O.addColorStop(.3,"#e9ecef"),O.addColorStop(.7,"#dee2e6"),O.addColorStop(1,"#ced4da"),t.fillStyle=O,t.fillRect(0,0,o.width,o.height);for(let u=0;u<100;u++)t.fillStyle=`rgba(${Math.random()*50+200}, ${Math.random()*50+200}, ${Math.random()*50+200}, 0.1)`,t.fillRect(Math.random()*o.width,Math.random()*o.height,2,2);t.strokeStyle="rgba(78, 67, 118, 0.4)",t.lineWidth=2;for(let u=0;u<5;u++){t.beginPath();const _=Math.random()*o.width,v=Math.random()*o.height,w=Math.random()*o.width,d=Math.random()*o.height,V=Math.random()*o.width,T=Math.random()*o.height,ae=Math.random()*o.width,ve=Math.random()*o.height;t.moveTo(_,v),t.bezierCurveTo(w,d,V,T,ae,ve),t.stroke()}t.strokeStyle="rgba(78, 67, 118, 0.3)",t.lineWidth=1.5;for(let u=0;u<3;u++){t.beginPath(),t.moveTo(0,o.height/2+Math.sin(u)*10);for(let _=0;_<=o.width;_+=5){const v=o.height/2+Math.sin((_+u*50)*.02)*15+Math.random()*10-5;t.lineTo(_,v)}t.stroke()}const le=["circle","rect","triangle","star"];for(let u=0;u<15;u++){const _=le[Math.floor(Math.random()*le.length)],v=Math.random()*o.width,w=Math.random()*o.height,d=Math.random()*8+2;switch(t.fillStyle=`rgba(78, 67, 118, ${Math.random()*.3+.1})`,t.beginPath(),_){case"circle":t.arc(v,w,d,0,2*Math.PI);break;case"rect":t.rect(v-d/2,w-d/2,d,d);break;case"triangle":t.moveTo(v,w-d),t.lineTo(v-d,w+d),t.lineTo(v+d,w+d),t.closePath();break;case"star":t.moveTo(v,w-d),t.lineTo(v+d/3,w+d/3),t.lineTo(v-d,w),t.lineTo(v+d,w),t.lineTo(v-d/3,w+d/3),t.closePath();break}t.fill()}const _e=c.split(""),Z=["#4e4376","#5a4e8c","#6b5b95","#7b68a2","#8b789f","#9b88b2"],ie=["bold 24px Georgia",'bold 22px "Times New Roman"',"bold 26px Arial","bold 23px Verdana"];_e.forEach((u,_)=>{const v=15+_*20,w=o.height/2+(Math.random()-.5)*8;t.font=ie[Math.floor(Math.random()*ie.length)],t.textAlign="center",t.textBaseline="middle";const d=(Math.random()-.5)*.6;t.save(),t.translate(v,w),t.rotate(d),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillText(u,2,2),t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=3,t.strokeText(u,0,0),t.fillStyle=Z[_%Z.length],t.fillText(u,0,0),t.shadowColor=Z[_%Z.length],t.shadowBlur=3,t.fillText(u,0,0),t.restore()});const ce=t.getImageData(0,0,o.width,o.height),A=ce.data;for(let u=0;u<o.height;u++)for(let _=0;_<o.width;_++){const v=Math.sin(_*.1)*2,w=Math.min(Math.max(u+v,0),o.height-1);if(w!==u){const d=(u*o.width+_)*4,V=(Math.floor(w)*o.width+_)*4;if(V<A.length&&d<A.length)for(let T=0;T<4;T++){const ae=A[d+T];A[d+T]=A[V+T],A[V+T]=ae}}}t.putImageData(ce,0,0),l.debug("复杂验证码Canvas生成完成"),g(o.toDataURL("image/png"))}catch(o){l.error("Canvas验证码生成失败:",o),g("")}})});let z=null;const r=async()=>{z&&clearTimeout(z),z=setTimeout(async()=>{try{l.info("开始刷新验证码");const c=await pe.getCaptcha();l.debug("验证码API响应:",c);const g=fe(c);if(g&&c.oK){if(G.value=g.code,k.value=g.captchaId,X.value=g.expireAt,l.info("验证码数据更新成功",{captchaId:g.captchaId,hasCode:!!g.code}),g.code){const o=async()=>{try{const t=await J(g.code);U.value=t,l.debug("验证码Canvas生成并更新完成")}catch(t){l.error("Canvas生成异常:",t),U.value=""}};"requestIdleCallback"in window?requestIdleCallback(o,{timeout:3e3}):setTimeout(o,500)}}else l.warn("验证码响应无效",c)}catch(c){l.error("刷新验证码失败:",c)}finally{z=null}},300)},K=async()=>{if(I.value)try{l.info("开始表单验证"),await I.value.validate(),l.info("表单验证通过"),await H(W)}catch(c){l.warn("表单验证失败:",c)}},H=async c=>{y.value=!0,l.info("开始执行登录",{userId:c.userId});try{const g={...c,captchaId:k.value},o=await pe.login(g),t=fe(o);return t&&o.oK?(console.log("登录返回的用户对象:",t),await E.user.setLoginState({user:t,remember:c.rememberMe}),console.log("设置后的store用户信息:",E.user.userInfo),console.log("登录状态:",E.user.isLoggedIn),h.success(o.popMsg||n("login.loginSuccess")),l.info("登录成功",{userId:t.userId}),E.global.setPageTitle("首页"),b.push({path:"/dashboard"}),!0):(h.error(o.errMsg||o.popMsg||n("login.loginFailed")),l.warn("登录失败",{errMsg:o.errMsg,popMsg:o.popMsg}),r(),!1)}catch(g){return l.error("登录请求异常:",g),h.error(g.message||n("login.networkError")),r(),!1}finally{y.value=!1}},m=async()=>{if(!x.phone){h.error(n("validation.phoneRequired"));return}if(!/^1[3-9]\d{9}$/.test(x.phone)){h.error(n("validation.phoneFormat"));return}S.value=!0,l.info("发送手机验证码",{phone:x.phone});try{await new Promise(g=>setTimeout(g,500)),h.success(n("login.codeSent")),l.info("验证码发送成功"),P.value=60;const c=setInterval(()=>{P.value--,P.value<=0&&(clearInterval(c),S.value=!1)},1e3)}catch(c){l.error("验证码发送失败:",c),h.error(n("login.codeSendFailed")),S.value=!1}},R=async()=>{if(L.value)try{l.info("开始手机登录表单验证"),await L.value.validate(),await F()}catch(c){l.warn("手机登录表单验证失败:",c)}},F=async()=>{p.value=!0,l.info("开始执行手机登录",{phone:x.phone});try{return!0}catch(c){return l.error("手机登录失败:",c),h.error(c.message||n("login.loginFailed")),!1}finally{p.value=!1}},oe=()=>{l.info("尝试微信登录"),h.info(n("login.wechatRedirect"))},N=()=>{l.info("跳转到忘记密码页面"),b.push({path:"/hub0001/forgot-password"})},Q=()=>{E.user.isLoggedIn&&(l.info("用户已登录，重定向到首页"),window.location.href="/dashboard")};return ye(()=>{l.info("LoginAuth组件挂载，开始初始化"),Q(),requestAnimationFrame(()=>{setTimeout(()=>{r()},200)})}),{formRef:I,phoneFormRef:L,formData:W,phoneFormData:x,rules:$,phoneRules:te,loading:y,phoneLoading:p,captchaCode:G,captchaUrl:U,captchaExpireAt:X,codeSending:S,countdown:P,handleLogin:K,handlePhoneLogin:R,sendVerificationCode:m,handleWechatLogin:oe,refreshCaptcha:r,goToForgotPassword:N,tCommon:q,t:n}}const Ge={class:"language-switcher"},Xe={class:"current-language"},We=ee({__name:"LanguageSwitcher",setup(b){const h=Ce(),n=C(!1),q=ne(()=>h.settings.language);function I(){const p=ge.find(k=>k.locale===q.value);return p?p.name:"Unknown"}const L=ge.map(p=>({key:p.locale,label:p.name}));async function y(p){if(p!==q.value){n.value=!0;try{await h.updateSettings({language:p}),await Me(p)}finally{n.value=!1}}}return(p,k)=>(M(),B("div",Ge,[s(e(ke),{trigger:"click",options:e(L),onSelect:y},{default:i(()=>[a("div",{class:xe(["language-selector",{"is-loading":n.value}])},[n.value?(M(),se(e(D),{key:0,size:"16",class:"loading-icon"},{default:i(()=>k[0]||(k[0]=[a("i",{class:"fas fa-circle-notch fa-spin"},null,-1)])),_:1})):re("",!0),a("span",Xe,f(I()),1),s(e(D),{size:"12"},{default:i(()=>k[1]||(k[1]=[a("i",{class:"fas fa-chevron-down"},null,-1)])),_:1})],2)]),_:1},8,["options"])]))}}),Je=me(We,[["__scopeId","data-v-ad607801"]]),He={class:"login-view"},Qe={class:"global-language-switch"},Ze={class:"welcome-area"},je={class:"welcome-content"},et={class:"title"},tt={class:"subtitle"},ot={class:"features"},at={class:"feature-item"},nt={class:"feature-icon"},st={class:"feature-text"},rt={class:"feature-item"},lt={class:"feature-icon"},it={class:"feature-text"},ct={class:"feature-item"},dt={class:"feature-icon"},ut={class:"feature-text"},ht={class:"form-area"},gt={class:"form-container"},pt={class:"form-header"},ft={class:"captcha-area"},mt=["src"],_t={key:1,class:"captcha-loading"},vt={class:"form-options"},wt={class:"verification-area"},bt={class:"form-footer"},yt={class:"copyright"},Ct=ee({__name:"LoginView",setup(b){const h=C("account");let n=null;const q=H=>{n&&clearTimeout(n),requestAnimationFrame(()=>{n=setTimeout(()=>{h.value=H,n=null,Ue(()=>{})},50)})},{formRef:I,phoneFormRef:L,formData:y,phoneFormData:p,rules:k,phoneRules:G,loading:X,phoneLoading:U,captchaUrl:S,codeSending:P,countdown:W,handleLogin:x,handlePhoneLogin:$,sendVerificationCode:te,refreshCaptcha:J,goToForgotPassword:z,t:r,tCommon:K}=Ye();return(H,m)=>{const R=De,F=Fe,oe=Ke,N=Ne,Q=Re,c=Pe,g=Be;return M(),B("div",He,[a("div",Qe,[s(Je)]),a("div",Ze,[m[7]||(m[7]=a("div",{class:"logo-area"},[a("img",{src:Te,alt:"Logo"}),a("h3",{class:"logo-text"},"FLUX Datahub Gateway")],-1)),a("div",je,[a("h1",et,f(e(r)("login.welcomeTitle")),1),a("p",tt,f(e(r)("login.welcomeSubtitle")),1),a("div",ot,[a("div",at,[a("div",nt,[s(e(Ie))]),a("div",st,[a("h3",null,f(e(r)("login.featureSecurityTitle")),1),a("p",null,f(e(r)("login.featureSecurityDesc")),1)])]),a("div",rt,[a("div",lt,[s(e(Le))]),a("div",it,[a("h3",null,f(e(r)("login.featureAnalyticsTitle")),1),a("p",null,f(e(r)("login.featureAnalyticsDesc")),1)])]),a("div",ct,[a("div",dt,[s(e(Se))]),a("div",ut,[a("h3",null,f(e(r)("login.featureCollaborationTitle")),1),a("p",null,f(e(r)("login.featureCollaborationDesc")),1)])])])])]),a("div",ht,[a("div",gt,[a("div",pt,[a("h2",null,f(e(r)("login.loginTitle")||e(r)("login.title")),1),a("p",null,f(e(r)("login.loginSubtitle")||e(r)("login.subtitle")),1)]),s(g,{value:h.value,"onUpdate:value":[m[6]||(m[6]=o=>h.value=o),q],animated:!1,"justify-content":"space-evenly",size:"small",class:"login-tabs",type:"line"},{default:i(()=>[s(c,{name:"account",tab:e(r)("login.accountLogin")},{default:i(()=>[h.value==="account"?(M(),se(Q,{key:0,ref_key:"formRef",ref:I,model:e(y),rules:e(k),size:"large",class:"login-form"},{default:i(()=>[s(F,{path:"userId"},{default:i(()=>[s(R,{value:e(y).userId,"onUpdate:value":m[0]||(m[0]=o=>e(y).userId=o),placeholder:e(r)("login.userId"),onKeyup:Y(e(x),["enter"])},{prefix:i(()=>[s(e(D),null,{default:i(()=>[s(e(Oe))]),_:1})]),_:1},8,["value","placeholder","onKeyup"])]),_:1}),s(F,{path:"password"},{default:i(()=>[s(R,{value:e(y).password,"onUpdate:value":m[1]||(m[1]=o=>e(y).password=o),type:"password","show-password-on":"mousedown",placeholder:e(r)("login.password"),onKeyup:Y(e(x),["enter"])},{prefix:i(()=>[s(e(D),null,{default:i(()=>[s(e(qe))]),_:1})]),_:1},8,["value","placeholder","onKeyup"])]),_:1}),s(F,{path:"captcha"},{default:i(()=>[a("div",ft,[s(R,{value:e(y).captchaCode,"onUpdate:value":m[2]||(m[2]=o=>e(y).captchaCode=o),placeholder:e(r)("login.captcha"),onKeyup:Y(e(x),["enter"])},{prefix:i(()=>[s(e(D),null,{default:i(()=>[s(e(ze))]),_:1})]),_:1},8,["value","placeholder","onKeyup"]),a("div",{class:"captcha-img",onClick:m[3]||(m[3]=(...o)=>e(J)&&e(J)(...o))},[e(S)?(M(),B("img",{key:0,src:e(S),alt:"Captcha"},null,8,mt)):(M(),B("div",_t,[s(oe,{size:"small"})]))])])]),_:1}),a("div",vt,[s(N,{text:"",onClick:e(z),class:"forgot-btn"},{default:i(()=>[j(f(e(r)("login.forgotPassword")),1)]),_:1},8,["onClick"])]),s(N,{type:"primary",size:"large",block:"",loading:e(X),onClick:e(x),class:"login-btn"},{default:i(()=>[j(f(e(r)("login.loginButton")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules"])):re("",!0)]),_:1},8,["tab"]),s(c,{name:"phone",tab:e(r)("login.phoneLogin")},{default:i(()=>[h.value==="phone"?(M(),se(Q,{key:0,ref_key:"phoneFormRef",ref:L,model:e(p),rules:e(G),size:"large",class:"login-form"},{default:i(()=>[s(F,{path:"phone"},{default:i(()=>[s(R,{value:e(p).phone,"onUpdate:value":m[4]||(m[4]=o=>e(p).phone=o),placeholder:e(r)("login.phoneNumber"),onKeyup:Y(e($),["enter"])},{prefix:i(()=>[s(e(D),null,{default:i(()=>[s(e(Ee))]),_:1})]),_:1},8,["value","placeholder","onKeyup"])]),_:1}),s(F,{path:"code"},{default:i(()=>[a("div",wt,[s(R,{value:e(p).code,"onUpdate:value":m[5]||(m[5]=o=>e(p).code=o),placeholder:e(r)("login.verificationCode"),onKeyup:Y(e($),["enter"])},{prefix:i(()=>[s(e(D),null,{default:i(()=>[s(e(Ae))]),_:1})]),_:1},8,["value","placeholder","onKeyup"]),s(N,{class:"verification-btn",disabled:e(P),onClick:e(te)},{default:i(()=>[j(f(e(P)?`${e(W)}s`:e(r)("login.sendCode")),1)]),_:1},8,["disabled","onClick"])])]),_:1}),s(N,{type:"primary",size:"large",block:"",loading:e(U),onClick:e($),class:"login-btn"},{default:i(()=>[j(f(e(r)("login.loginButton")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules"])):re("",!0)]),_:1},8,["tab"])]),_:1},8,["value"]),a("div",bt,[a("p",yt," © "+f(new Date().getFullYear())+" "+f(e(K)("common.companyName"))+". "+f(e(K)("common.copyright"))+" "+f(e(K)("common.version"))+": "+f(e(K)("common.versionNumber")),1)])])])])}}}),xt=me(Ct,[["__scopeId","data-v-96b5a6e2"]]);export{xt as default};

import{c as le,G as de,S as se}from"./SearchForm-QXeOPYmP.js";import{af as xe,m as ee,r as D,c as we,a7 as $,c$ as me,ab as A,z as Q,A as Z,B as K,d as V,h as E,o as L,w as t,e as a,f as e,I as Ce,b as Y,C as Le,D as pe,g as k,i as H,aa as q,bP as B,bQ as P,aO as x,K as S,t as _,aQ as ue,bR as ze,a9 as Me,_ as U,av as ce,am as X,j as oe,G as ve,J as ye,cX as he,T as ge,cj as Oe,a8 as ke,M as ie,q as Te,v as Ne,ad as Ee}from"./index-DjxxKbEp.js";import{G as ne}from"./GPane-CsXIYqCJ.js";import{G as fe}from"./GModal-Bj4TqfQo.js";import{c as j}from"./DatePicker-CHfUawd3.js";import{N as J}from"./Code-C1CrBybJ.js";/* empty css                                                                    */import{q as Ye}from"./index-DYcwauK8.js";import{C as Re}from"./CheckmarkCircleOutline-BGewP4aN.js";import{A as qe}from"./AlertCircleOutline-DrWbBgS5.js";import{E as _e,C as He}from"./EllipsisHorizontalOutline-WYufEB1f.js";import{N as be}from"./InputGroup-ByIgogDC.js";import{M as W,n as Ae,v as Ge}from"./types-Y-cJfJuv.js";import{S as Se,L as F}from"./types-BgPBDzuW.js";import{E as Fe}from"./EyeOutline-3Qoqf5bi.js";import{R as Pe}from"./RefreshOutline-RMMvHLjq.js";import{D as Be}from"./DownloadOutline-BfRf1_li.js";import{_ as $e}from"./index-DWp_fF6P.js";import{i as ae}from"./installCanvasRenderer-BddeS-3K.js";import{B as Ie,S as Ve,T as Ue,P as je,F as Je}from"./TrendingUpOutline-Dh0DvW5C.js";import{T as re}from"./TimeOutline-CPBFlZZt.js";import{_ as We,a as Xe}from"./Grid-DuzVlp9K.js";import"./index-DR_R-bYe.js";import"./OptionsOutline-CJ-6A-d8.js";import"./InformationCircleOutline-Co9yRxRj.js";import"./Select-DKaQ0jI7.js";import"./InputNumber-CTlCGkXq.js";import"./Switch-CTvADbq_.js";import"./CloseOutline-BhR4kvnt.js";const te=xe("/gateway/hub0023"),Qe=async f=>te.post("/gateway-log/query",f),Ke=async f=>te.post("/gateway-log/get",f),Ze=async f=>te.post("/gateway-log/reset",f),et=async f=>te.post("/gateway-log/export",f),tt=async f=>te.post("/gateway-log/monitoring/overview",f),at=async f=>te.post("/gateway-log/monitoring/chart-data",f);function lt(f,g){const d=ee(),u=D(!1),l=D(null),p=D([]),y=D("basic"),n=we(()=>f.traceId?`后端日志详情 - ${f.traceId}`:"后端日志详情"),r=we({get(){return f.visible},set(w){g("update:visible",w)}});$(()=>f.visible,w=>{w&&f.traceId&&b()},{immediate:!0});const b=async()=>{if(f.traceId)try{u.value=!0;const w=await Ke({traceId:f.traceId});if(Q(w)){const G=Z(w);l.value=G,p.value=G.backendTraces||[],y.value="basic"}else{const G=K(w,"获取后端日志失败");d.error(G),l.value=null,p.value=[]}}catch(w){console.error("获取后端日志失败:",w),d.error("获取后端日志失败"),p.value=[]}finally{u.value=!1}};return{loading:u,gatewayLogInfo:l,backendTraces:p,activeTab:y,showModal:r,dialogTitle:n,getServiceTabName:(w,G)=>w.serviceName?w.serviceName:`服务${G+1}`,formatJsonData:w=>{if(typeof w=="string")try{return JSON.stringify(JSON.parse(w),null,2)}catch{return w}return JSON.stringify(w,null,2)},getMethodColor:w=>({GET:"info",POST:"success",PUT:"warning",DELETE:"error",PATCH:"default",HEAD:"default",OPTIONS:"default"})[w||""]||"default",getStatusCodeType:w=>!w||w===0?"default":w>=200&&w<300?"success":w>=300&&w<400?"warning":w>=400?"error":"default",getResponseTimeType:w=>w===0?"default":w<100?"success":w<500?"warning":"error",getTraceStatusType:w=>({pending:"warning",success:"success",failed:"error",timeout:"error"})[w||""]||"default",getTraceStatusText:w=>({pending:"处理中",success:"成功",failed:"失败",timeout:"超时"})[w||""]||w||"未知",getLogLevelType:w=>({ERROR:"error",WARN:"warning",INFO:"info",DEBUG:"success"})[w]||"default",getLogLevelText:w=>({ERROR:"错误",WARN:"警告",INFO:"信息",DEBUG:"调试"})[w]||w,getLogTypeColor:w=>({ACCESS:"info",ERROR:"error",SYSTEM:"warning"})[w]||"default",getLogTypeText:w=>({ACCESS:"访问日志",ERROR:"错误日志",SYSTEM:"系统日志"})[w]||w,getProxyTypeColor:w=>({http:"info",websocket:"warning",tcp:"success",udp:"error"})[w||""]||"default",getProxyTypeText:w=>({http:"HTTP",websocket:"WebSocket",tcp:"TCP",udp:"UDP"})[w||""]||w||"未知",formatDate:A,formatFileSize:me,handleCancel:()=>{r.value=!1},handleAfterLeave:()=>{l.value=null,p.value=[],y.value="basic"}}}const st={key:0,class:"backend-logs-container"},ot={class:"trace-detail-container"},nt={class:"error-message"},rt={class:"trace-detail-container"},it={class:"error-message"},dt=V({__name:"BackendLogsDialog",props:{visible:{type:Boolean,default:!1},traceId:{default:""}},emits:["update:visible"],setup(f,{emit:g}){const l=lt(f,g);return(p,y)=>(L(),E(fe,{visible:e(l).showModal.value,"onUpdate:visible":y[1]||(y[1]=n=>e(l).showModal.value=n),title:e(l).dialogTitle.value,width:"90%",style:{maxWidth:"1200px"},preset:"dialog","mask-closable":!1,closable:!0,draggable:!0,showConfirm:!1,onAfterLeave:e(l).handleAfterLeave},{default:t(()=>[a(e(Ce),{show:e(l).loading.value},{default:t(()=>[e(l).gatewayLogInfo.value?(L(),Y("div",st,[a(e(Le),{value:e(l).activeTab.value,"onUpdate:value":y[0]||(y[0]=n=>e(l).activeTab.value=n),size:"small"},{default:t(()=>[a(e(pe),{name:"basic",tab:"基础信息"},{default:t(()=>[k("div",ot,[a(e(q),{title:"基本信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:3,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"链路追踪ID"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.traceId),1)]),_:1})]),_:1}),a(e(P),{label:"网关实例ID"},{default:t(()=>[a(e(x),{type:"success",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.gatewayInstanceId),1)]),_:1})]),_:1}),a(e(P),{label:"租户ID"},{default:t(()=>[a(e(x),{type:"warning",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.tenantId),1)]),_:1})]),_:1}),a(e(P),{label:"日志级别"},{default:t(()=>[a(e(x),{type:e(l).getLogLevelType(e(l).gatewayLogInfo.value.logLevel),size:"small"},{default:t(()=>[S(_(e(l).getLogLevelText(e(l).gatewayLogInfo.value.logLevel)),1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"日志类型"},{default:t(()=>[a(e(x),{type:e(l).getLogTypeColor(e(l).gatewayLogInfo.value.logType),size:"small"},{default:t(()=>[S(_(e(l).getLogTypeText(e(l).gatewayLogInfo.value.logType)),1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"记录时间"},{default:t(()=>[k("span",null,_(e(l).formatDate(e(l).gatewayLogInfo.value.addTime)),1)]),_:1})]),_:1})]),_:1}),a(e(q),{title:"请求信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:2,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"请求方法"},{default:t(()=>[a(e(x),{type:e(l).getMethodColor(e(l).gatewayLogInfo.value.requestMethod),size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.requestMethod),1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"请求路径"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.requestPath),1)]),_:1})]),_:1}),a(e(P),{label:"请求查询参数"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.requestQuery||"无"),1)]),_:1})]),_:1}),a(e(P),{label:"客户端IP"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.clientIpAddress),1)]),_:1})]),_:1}),a(e(P),{label:"请求大小"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).formatFileSize(e(l).gatewayLogInfo.value.requestSize||0)),1)]),_:1})]),_:1}),a(e(P),{label:"客户端端口"},{default:t(()=>[k("span",null,_(e(l).gatewayLogInfo.value.clientPort||"无"),1)]),_:1}),a(e(P),{label:"User-Agent"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.userAgent||"无"),1)]),_:1})]),_:1}),a(e(P),{label:"Referer"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.referer||"无"),1)]),_:1})]),_:1}),a(e(P),{label:"用户标识"},{default:t(()=>[k("span",null,_(e(l).gatewayLogInfo.value.userIdentifier||"无"),1)]),_:1}),a(e(P),{label:"父链路追踪ID"},{default:t(()=>[k("span",null,_(e(l).gatewayLogInfo.value.parentTraceId||"无"),1)]),_:1})]),_:1})]),_:1}),a(e(q),{title:"响应信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:3,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"网关状态码"},{default:t(()=>[a(e(x),{type:e(l).getStatusCodeType(e(l).gatewayLogInfo.value.gatewayStatusCode),size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.gatewayStatusCode),1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"总处理时间"},{default:t(()=>[a(e(x),{type:e(l).getResponseTimeType(e(l).gatewayLogInfo.value.totalProcessingTimeMs||0),size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.totalProcessingTimeMs||0)+"ms ",1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"网关处理时间"},{default:t(()=>[a(e(x),{type:e(l).getResponseTimeType(e(l).gatewayLogInfo.value.gatewayProcessingTimeMs||0),size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.gatewayProcessingTimeMs||0)+"ms ",1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"响应大小"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).formatFileSize(e(l).gatewayLogInfo.value.responseSize||0)),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(q),{title:"时间跟踪",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:2,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"网关开始处理"},{default:t(()=>[k("span",null,_(e(l).formatDate(e(l).gatewayLogInfo.value.gatewayStartProcessingTime,"YYYY-MM-DD HH:mm:ss.SSS")),1)]),_:1}),a(e(P),{label:"网关完成处理"},{default:t(()=>[k("span",null,_(e(l).gatewayLogInfo.value.gatewayFinishedProcessingTime?e(l).formatDate(e(l).gatewayLogInfo.value.gatewayFinishedProcessingTime,"YYYY-MM-DD HH:mm:ss.SSS"):"未完成"),1)]),_:1}),a(e(P),{label:"重试次数"},{default:t(()=>[a(e(x),{type:"warning",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.retryCount||0),1)]),_:1})]),_:1}),a(e(P),{label:"重置次数"},{default:t(()=>[a(e(x),{type:"error",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.resetCount||0),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(q),{title:"路由信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:2,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"代理类型"},{default:t(()=>[a(e(x),{type:e(l).getProxyTypeColor(e(l).gatewayLogInfo.value.proxyType),size:"small"},{default:t(()=>[S(_(e(l).getProxyTypeText(e(l).gatewayLogInfo.value.proxyType)),1)]),_:1},8,["type"])]),_:1}),a(e(P),{label:"匹配路由"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.matchedRoute||"无"),1)]),_:1})]),_:1}),a(e(P),{label:"路由名称"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.routeName||"无"),1)]),_:1})]),_:1}),a(e(P),{label:"网关节点IP"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.gatewayNodeIp||"无"),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(l).gatewayLogInfo.value.errorCode||e(l).gatewayLogInfo.value.errorMessage?(L(),E(e(q),{key:0,title:"错误信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:1,size:"small",bordered:""},{default:t(()=>[e(l).gatewayLogInfo.value.errorCode?(L(),E(e(P),{key:0,label:"错误码"},{default:t(()=>[a(e(x),{type:"error",size:"small"},{default:t(()=>[S(_(e(l).gatewayLogInfo.value.errorCode),1)]),_:1})]),_:1})):H("",!0),e(l).gatewayLogInfo.value.errorMessage?(L(),E(e(P),{key:1,label:"错误消息"},{default:t(()=>[k("div",nt,_(e(l).gatewayLogInfo.value.errorMessage),1)]),_:1})):H("",!0)]),_:1})]),_:1})):H("",!0),e(l).gatewayLogInfo.value.requestHeaders?(L(),E(e(q),{key:1,title:"请求头信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(e(l).gatewayLogInfo.value.requestHeaders),language:"json"},null,8,["code"])]),_:1})):H("",!0),e(l).gatewayLogInfo.value.requestBody?(L(),E(e(q),{key:2,title:"请求体",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(e(l).gatewayLogInfo.value.requestBody),language:"json"},null,8,["code"])]),_:1})):H("",!0),e(l).gatewayLogInfo.value.responseHeaders?(L(),E(e(q),{key:3,title:"响应头",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(e(l).gatewayLogInfo.value.responseHeaders),language:"json"},null,8,["code"])]),_:1})):H("",!0),e(l).gatewayLogInfo.value.responseBody?(L(),E(e(q),{key:4,title:"响应体",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(e(l).gatewayLogInfo.value.responseBody),language:"json"},null,8,["code"])]),_:1})):H("",!0)])]),_:1}),(L(!0),Y(ue,null,ze(e(l).backendTraces.value,(n,r)=>(L(),E(e(pe),{key:n.backendTraceId||r,name:`service-${r}`,tab:e(l).getServiceTabName(n,r)},{default:t(()=>[k("div",rt,[a(e(q),{title:"基本信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:3,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"后端追踪ID"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(n.backendTraceId),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"服务定义ID"},{default:t(()=>[a(e(x),{type:"success",size:"small"},{default:t(()=>[S(_(n.serviceDefinitionId||"无"),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"服务名称"},{default:t(()=>[a(e(x),{type:"warning",size:"small"},{default:t(()=>[S(_(n.serviceName||"无"),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"追踪状态"},{default:t(()=>[a(e(x),{type:e(l).getTraceStatusType(n.traceStatus),size:"small"},{default:t(()=>[S(_(e(l).getTraceStatusText(n.traceStatus)),1)]),_:2},1032,["type"])]),_:2},1024),a(e(P),{label:"成功标记"},{default:t(()=>[a(e(x),{type:n.successFlag==="Y"?"success":"error",size:"small"},{default:t(()=>[S(_(n.successFlag==="Y"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:2},1024),a(e(P),{label:"重试次数"},{default:t(()=>[a(e(x),{type:"warning",size:"small"},{default:t(()=>[S(_(n.retryCount||0),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(e(q),{title:"转发信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:2,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"转发地址"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(n.forwardAddress||"无"),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"转发方法"},{default:t(()=>[a(e(x),{type:e(l).getMethodColor(n.forwardMethod),size:"small"},{default:t(()=>[S(_(n.forwardMethod||"无"),1)]),_:2},1032,["type"])]),_:2},1024),a(e(P),{label:"转发路径"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(n.forwardPath||"无"),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"转发查询参数"},{default:t(()=>[a(e(j),{"line-clamp":2},{default:t(()=>[S(_(n.forwardQuery||"无"),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"请求大小"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).formatFileSize(n.requestSize||0)),1)]),_:2},1024)]),_:2},1024),a(e(P),{label:"负载均衡策略"},{default:t(()=>[k("span",null,_(n.loadBalancerStrategy||"无"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(e(q),{title:"时间信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:2,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"请求开始时间"},{default:t(()=>[k("span",null,_(n.requestStartTime?e(l).formatDate(n.requestStartTime,"YYYY-MM-DD HH:mm:ss.SSS"):"无"),1)]),_:2},1024),a(e(P),{label:"响应接收时间"},{default:t(()=>[k("span",null,_(n.responseReceivedTime?e(l).formatDate(n.responseReceivedTime,"YYYY-MM-DD HH:mm:ss.SSS"):"无"),1)]),_:2},1024),a(e(P),{label:"请求耗时"},{default:t(()=>[a(e(x),{type:e(l).getResponseTimeType(n.requestDurationMs||0),size:"small"},{default:t(()=>[S(_(n.requestDurationMs||0)+"ms ",1)]),_:2},1032,["type"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(e(q),{title:"响应信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:3,size:"small",bordered:""},{default:t(()=>[a(e(P),{label:"状态码"},{default:t(()=>[a(e(x),{type:e(l).getStatusCodeType(n.statusCode||0),size:"small"},{default:t(()=>[S(_(n.statusCode||"无"),1)]),_:2},1032,["type"])]),_:2},1024),a(e(P),{label:"响应大小"},{default:t(()=>[a(e(x),{type:"info",size:"small"},{default:t(()=>[S(_(e(l).formatFileSize(n.responseSize||0)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),n.errorCode||n.errorMessage?(L(),E(e(q),{key:0,title:"错误信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(B),{column:1,size:"small",bordered:""},{default:t(()=>[n.errorCode?(L(),E(e(P),{key:0,label:"错误码"},{default:t(()=>[a(e(x),{type:"error",size:"small"},{default:t(()=>[S(_(n.errorCode),1)]),_:2},1024)]),_:2},1024)):H("",!0),n.errorMessage?(L(),E(e(P),{key:1,label:"错误消息"},{default:t(()=>[k("div",it,_(n.errorMessage),1)]),_:2},1024)):H("",!0)]),_:2},1024)]),_:2},1024)):H("",!0),n.forwardHeaders?(L(),E(e(q),{key:1,title:"转发头信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(n.forwardHeaders),language:"json"},null,8,["code"])]),_:2},1024)):H("",!0),n.forwardBody?(L(),E(e(q),{key:2,title:"转发体",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(n.forwardBody),language:"json"},null,8,["code"])]),_:2},1024)):H("",!0),n.responseHeaders?(L(),E(e(q),{key:3,title:"响应头",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(n.responseHeaders),language:"json"},null,8,["code"])]),_:2},1024)):H("",!0),n.responseBody?(L(),E(e(q),{key:4,title:"响应体",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(n.responseBody),language:"json"},null,8,["code"])]),_:2},1024)):H("",!0),n.extProperty?(L(),E(e(q),{key:5,title:"扩展信息",size:"small",class:"detail-card"},{default:t(()=>[a(e(J),{code:e(l).formatJsonData(n.extProperty),language:"json"},null,8,["code"])]),_:2},1024)):H("",!0)])]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"])])):(L(),E(e(Me),{key:1,description:"暂无日志数据"}))]),_:1},8,["show"])]),_:1},8,["visible","title","onAfterLeave"]))}}),ut=U(dt,[["__scopeId","data-v-8ee6fdee"]]);function ct(){const f="hub0023-instance-list",g=D(!1),d=D([]),u=D();return{moduleId:f,loading:g,instanceList:d,pageInfo:u,searchFormConfig:{fields:[{field:"instanceName",label:"实例名称",type:"input",placeholder:"请输入实例名称",span:6,clearable:!0},{field:"healthStatus",label:"健康状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"健康",value:"Y"},{label:"不健康",value:"N"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[],showSearchButton:!0,showResetButton:!0},gridConfig:{columns:[{field:"gatewayInstanceId",title:"实例ID",sortable:!0,align:"center",showOverflow:!0},{field:"instanceName",title:"实例名称",sortable:!0,align:"center",showOverflow:!0},{field:"instanceDesc",title:"实例描述",align:"center",showOverflow:"tooltip"},{field:"bindAddress",title:"绑定地址",align:"center",showOverflow:!0},{field:"httpPort",title:"HTTP端口",align:"center"},{field:"httpsPort",title:"HTTPS端口",align:"center"},{field:"tlsEnabled",title:"TLS",align:"center",slots:{default:"tlsEnabled"}},{field:"maxConnections",title:"最大连接数",align:"center",formatter:({cellValue:I})=>I?I.toLocaleString():"0"},{field:"healthStatus",title:"健康状态",align:"center",slots:{default:"healthStatus"}},{field:"activeFlag",title:"活动状态",align:"center",slots:{default:"activeFlag"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:I})=>I?A(I,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:I})=>I?A(I,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!1,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!1},height:"100%"},resetPagination:()=>{u.value=void 0},updatePagination:I=>{u.value?Object.assign(u.value,I):u.value=I},setInstanceList:I=>{d.value=I},clearInstanceList:()=>{d.value=[]}}}function ft(f){const g=ee(),d=ct(),{loading:u,instanceList:l,pageInfo:p,setInstanceList:y,updatePagination:n,clearInstanceList:r}=d,b=async T=>{var m,h,R;u.value=!0;try{let v=T;!v&&((m=f==null?void 0:f.value)!=null&&m.getFormData)&&(v=f.value.getFormData()||{});const N={...v?Object.fromEntries(Object.entries(v).filter(([,s])=>s!==""&&s!==null&&s!==void 0)):{},...le((h=p.value)==null?void 0:h.pageIndex,(R=p.value)==null?void 0:R.pageSize)},M=await Ye(N);if(M.oK){if(M.bizData){const s=JSON.parse(M.bizData),c=Array.isArray(s)?s:[];y(c)}if(M.pageQueryData){const s=JSON.parse(M.pageQueryData);n(s)}else d.resetPagination();return{success:!0}}else{const s=M.errMsg||"查询网关实例列表失败";return g.error(s),r(),d.resetPagination(),{success:!1,error:s}}}catch(v){return console.error("查询网关实例列表失败:",v),g.error((v==null?void 0:v.message)||"查询网关实例列表失败"),r(),d.resetPagination(),{success:!1,error:v==null?void 0:v.message}}finally{u.value=!1}};return{model:d,loading:u,instanceList:l,pageInfo:p,loadInstances:b,handlePageChange:async({currentPage:T,pageSize:m})=>{n({pageIndex:T,pageSize:m}),await b()}}}function gt(f,g){const d=ft(g);return{service:d,handleSearch:async()=>{d.model.resetPagination(),await d.loadInstances()}}}const mt=["id"],pt=V({name:"GatewayInstanceListModal",__name:"GatewayInstanceListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{default:void 0},modelValue:{default:""}},emits:["update:visible","after-leave","select","update:modelValue"],setup(f,{emit:g}){const d=f,u=g,l=D(),p=D(),y=D(d.visible),n=$(()=>d.visible,h=>{y.value=h,h&&b()}),{service:r,handleSearch:b}=gt(p,l),I=h=>{y.value=h,u("update:visible",h)},T=()=>{u("after-leave")},m=({row:h})=>{if(h){const R=h.instanceName||h.gatewayInstanceId||"";u("update:modelValue",R),u("select",h),I(!1)}};return ce(()=>{n()}),(h,R)=>(L(),E(e(fe),{visible:y.value,title:d.title||"选择网关实例",width:d.width||1200,to:d.to,"show-footer":!1,"onUpdate:visible":I,onAfterLeave:T},{default:t(()=>[k("div",{class:"gateway-instance-list-modal",id:e(r).model.moduleId},[a(e(ne),{direction:"vertical","no-resize":!0},{1:t(()=>[a(se,X({ref_key:"searchFormRef",ref:l,"module-id":e(r).model.moduleId},e(r).model.searchFormConfig,{onSearch:e(b)}),null,16,["module-id","onSearch"])]),2:t(()=>[a(e(de),X({ref_key:"gridRef",ref:p,"module-id":e(r).model.moduleId,data:e(r).model.instanceList,loading:e(r).model.loading},e(r).model.gridConfig,{onPageChange:e(r).handlePageChange,onRowClick:m}),{tlsEnabled:t(({row:v})=>[a(e(x),{type:v.tlsEnabled==="Y"?"success":"default",size:"small"},{default:t(()=>[S(_(v.tlsEnabled==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),healthStatus:t(({row:v})=>[a(e(x),{type:v.healthStatus==="Y"?"success":"error",size:"small"},{icon:t(()=>[a(e(oe),null,{default:t(()=>[v.healthStatus==="Y"?(L(),E(e(Re),{key:0})):(L(),E(e(qe),{key:1}))]),_:2},1024)]),default:t(()=>[S(" "+_(v.healthStatus==="Y"?"在线":"离线"),1)]),_:2},1032,["type"])]),activeFlag:t(({row:v})=>[a(e(x),{type:v.activeFlag==="Y"?"success":"default",size:"small"},{default:t(()=>[S(_(v.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,mt)]),_:1},8,["visible","title","width","to"]))}}),vt=U(pt,[["__scopeId","data-v-f946cf67"]]),yt=V({name:"GatewayInstanceNameSelector",__name:"GatewayInstanceNameSelector",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(f,{emit:g}){const d=f,u=g,l=D(!1),p=D(d.modelValue);$(()=>d.modelValue,r=>{p.value=r}),$(p,r=>{u("update:modelValue",r)});const y=r=>{p.value=r},n=()=>{l.value=!0};return(r,b)=>(L(),Y(ue,null,[a(e(be),null,{default:t(()=>[a(e(ve),{value:r.modelValue,placeholder:"请输入实例名称或点击选择",clearable:"",size:"small","onUpdate:value":y},null,8,["value"]),a(e(ye),{type:"primary",size:"small",onClick:n},{icon:t(()=>[a(e(oe),null,{default:t(()=>[a(e(_e))]),_:1})]),_:1})]),_:1}),a(vt,{visible:l.value,"onUpdate:visible":b[0]||(b[0]=I=>l.value=I),"model-value":p.value,"onUpdate:modelValue":b[1]||(b[1]=I=>p.value=I),title:"选择网关实例",width:1200},null,8,["visible","model-value"])],64))}}),ht=U(yt,[["__scopeId","data-v-f1bd434a"]]);function _t(){const f="hub0023-route-list",g=D(!1),d=D([]),u=D(),l={fields:[{field:"routeName",label:"路由名称",type:"input",placeholder:"请输入路由名称",span:6,clearable:!0},{field:"routePath",label:"路由路径",type:"input",placeholder:"请输入路由路径",span:6,clearable:!0},{field:"matchType",label:"匹配类型",type:"select",placeholder:"请选择匹配类型",span:6,clearable:!0,options:[{label:"精确匹配",value:W.EXACT},{label:"前缀匹配",value:W.PREFIX},{label:"正则匹配",value:W.REGEX}]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[],showSearchButton:!0,showResetButton:!0};return{moduleId:f,loading:g,routeList:d,pageInfo:u,searchFormConfig:l,gridConfig:{columns:[{field:"routeConfigId",title:"路由配置ID",visible:!1,width:0},{field:"routeName",title:"路由名称",sortable:!0,align:"center",showOverflow:"tooltip",width:200},{field:"routePath",title:"路由路径",align:"center",showOverflow:"tooltip",width:250},{field:"matchType",title:"匹配类型",align:"center",slots:{default:"matchType"},width:120},{field:"routePriority",title:"优先级",align:"center",sortable:!0,width:100},{field:"serviceName",title:"关联服务",align:"center",showOverflow:"tooltip",width:180},{field:"activeFlag",title:"状态",align:"center",slots:{default:"activeFlag"},width:100},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:m})=>m?A(m,"YYYY-MM-DD HH:mm:ss"):"",width:180}],showCheckbox:!1,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!1},height:"100%"},resetPagination:()=>{u.value=void 0},updatePagination:m=>{u.value?Object.assign(u.value,m):u.value=m},setRouteList:m=>{d.value=m},clearRouteList:()=>{d.value=[]},getMatchTypeTagType:m=>({[W.EXACT]:"success",[W.PREFIX]:"info",[W.REGEX]:"warning"})[m]||"default",getMatchTypeLabel:m=>({[W.EXACT]:"精确匹配",[W.PREFIX]:"前缀匹配",[W.REGEX]:"正则匹配"})[m]||"未知"}}function bt(f,g){const d=ee(),u=_t(),{loading:l,routeList:p,pageInfo:y,setRouteList:n,updatePagination:r,clearRouteList:b,resetPagination:I}=u,T=async R=>{var v,C,N;l.value=!0;try{let M=R;!M&&((v=g==null?void 0:g.value)!=null&&v.getFormData)&&(M=g.value.getFormData()||{});const s=M?Object.fromEntries(Object.entries(M).filter(([,i])=>i!==""&&i!==null&&i!==void 0)):{},c={...s,...s.gatewayInstanceId===void 0&&f?{gatewayInstanceId:f}:{},...le((C=y.value)==null?void 0:C.pageIndex,(N=y.value)==null?void 0:N.pageSize)},o=await Ae(c);if(Q(o)){const i=Z(o,[]);n(i);const z=he(o);r(z)}else d.error(K(o,"查询路由列表失败"))}catch{d.error("加载路由列表失败")}finally{l.value=!1}};return{model:u,loadRoutes:T,handleSearch:async R=>{I(),await T(R)},handlePageChange:async({currentPage:R,pageSize:v})=>{r({pageIndex:R,pageSize:v}),await T()}}}function wt(f,g,d){const u=bt(f,d);return{service:u,handleSearch:async p=>{await u.handleSearch(p)}}}const Tt=["id"],St=V({name:"RouteListModal",__name:"RouteListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{default:void 0},modelValue:{default:""},gatewayInstanceId:{default:void 0}},emits:["update:visible","after-leave","select","update:modelValue"],setup(f,{emit:g}){const d=f,u=g,l=D(),p=D(),y=D(d.visible),n=$(()=>d.visible,h=>{y.value=h,h&&b()}),{service:r,handleSearch:b}=wt(d.gatewayInstanceId,p,l),I=h=>{y.value=h,u("update:visible",h)},T=()=>{u("after-leave")},m=({row:h})=>{if(h){const R=h.routeName||"";u("update:modelValue",R),u("select",h),I(!1)}};return ce(()=>{n()}),(h,R)=>(L(),E(e(fe),{visible:y.value,title:d.title||"选择路由",width:d.width||1200,to:d.to,"show-footer":!1,"onUpdate:visible":I,onAfterLeave:T},{default:t(()=>[k("div",{class:"route-list-modal",id:e(r).model.moduleId},[a(e(ne),{direction:"vertical","no-resize":!0},{1:t(()=>[a(se,X({ref_key:"searchFormRef",ref:l,"module-id":e(r).model.moduleId},e(r).model.searchFormConfig,{onSearch:e(b)}),null,16,["module-id","onSearch"])]),2:t(()=>[a(e(de),X({ref_key:"gridRef",ref:p,"module-id":e(r).model.moduleId,data:e(r).model.routeList,loading:e(r).model.loading},e(r).model.gridConfig,{onPageChange:e(r).handlePageChange,onRowClick:m}),{matchType:t(({row:v})=>[a(e(x),{type:e(r).model.getMatchTypeTagType(v.matchType),size:"small"},{default:t(()=>[S(_(e(r).model.getMatchTypeLabel(v.matchType)),1)]),_:2},1032,["type"])]),activeFlag:t(({row:v})=>[a(e(x),{type:v.activeFlag==="Y"?"success":"error",size:"small"},{default:t(()=>[S(_(v.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,Tt)]),_:1},8,["visible","title","width","to"]))}}),It=U(St,[["__scopeId","data-v-89fda1e3"]]),Ct=V({name:"RouteNameSelector",__name:"RouteNameSelector",props:{modelValue:{default:""},gatewayInstanceId:{default:void 0}},emits:["update:modelValue"],setup(f,{emit:g}){const d=f,u=g,l=D(!1),p=D(d.modelValue);$(()=>d.modelValue,r=>{p.value=r}),$(p,r=>{u("update:modelValue",r)});const y=r=>{p.value=r},n=()=>{l.value=!0};return(r,b)=>(L(),Y(ue,null,[a(e(be),null,{default:t(()=>[a(e(ve),{value:r.modelValue,placeholder:"请输入路由名称或点击选择",clearable:"",size:"small","onUpdate:value":y},null,8,["value"]),a(e(ye),{type:"primary",size:"small",onClick:n},{icon:t(()=>[a(e(oe),null,{default:t(()=>[a(e(_e))]),_:1})]),_:1})]),_:1}),a(It,{visible:l.value,"onUpdate:visible":b[0]||(b[0]=I=>l.value=I),"model-value":p.value,"onUpdate:modelValue":b[1]||(b[1]=I=>p.value=I),title:"选择路由",width:1200,"gateway-instance-id":r.gatewayInstanceId},null,8,["visible","model-value","gateway-instance-id"])],64))}}),Lt=U(Ct,[["__scopeId","data-v-02771f66"]]);function Mt(){const f="hub0023-service-list",g=D(!1),d=D([]),u=D(),l={fields:[{field:"serviceName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:6,clearable:!0},{field:"serviceType",label:"服务类型",type:"select",placeholder:"请选择服务类型",span:6,clearable:!0,options:[{label:"静态配置",value:Se.STATIC},{label:"服务发现",value:Se.DISCOVERY}]},{field:"loadBalanceStrategy",label:"负载均衡策略",type:"select",placeholder:"请选择负载均衡策略",span:6,clearable:!0,options:[{label:"轮询算法",value:F.ROUND_ROBIN},{label:"随机算法",value:F.RANDOM},{label:"IP哈希算法",value:F.IP_HASH},{label:"最少连接算法",value:F.LEAST_CONN},{label:"加权轮询算法",value:F.WEIGHTED_ROUND_ROBIN},{label:"一致性哈希算法",value:F.CONSISTENT_HASH}]},{field:"activeFlag",label:"状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"启用",value:"Y"},{label:"禁用",value:"N"}]}],toolbarButtons:[],showSearchButton:!0,showResetButton:!0};return{moduleId:f,loading:g,serviceList:d,pageInfo:u,searchFormConfig:l,gridConfig:{columns:[{field:"serviceDefinitionId",title:"服务定义ID",visible:!1,width:0},{field:"serviceName",title:"服务名称",sortable:!0,align:"center",showOverflow:"tooltip",width:200},{field:"serviceDesc",title:"服务描述",align:"center",showOverflow:"tooltip",width:200},{field:"serviceType",title:"服务类型",align:"center",slots:{default:"serviceType"},width:120},{field:"loadBalanceStrategy",title:"负载均衡策略",align:"center",slots:{default:"loadBalanceStrategy"},width:150},{field:"activeFlag",title:"状态",align:"center",slots:{default:"activeFlag"},width:100},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:T})=>T?A(T,"YYYY-MM-DD HH:mm:ss"):"",width:180}],showCheckbox:!1,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!1},height:"100%"},resetPagination:()=>{u.value=void 0},updatePagination:T=>{u.value?Object.assign(u.value,T):u.value=T},setServiceList:T=>{d.value=T},clearServiceList:()=>{d.value=[]},getLoadBalanceStrategyLabel:T=>({[F.ROUND_ROBIN]:"轮询",[F.RANDOM]:"随机",[F.IP_HASH]:"IP哈希",[F.LEAST_CONN]:"最少连接",[F.WEIGHTED_ROUND_ROBIN]:"加权轮询",[F.CONSISTENT_HASH]:"一致性哈希"})[T]||T}}function Rt(f,g){const d=ee(),u=Mt(),{loading:l,serviceList:p,pageInfo:y,setServiceList:n,updatePagination:r,clearServiceList:b,resetPagination:I}=u,T=async R=>{var v,C,N;l.value=!0;try{let M=R;!M&&((v=g==null?void 0:g.value)!=null&&v.getFormData)&&(M=g.value.getFormData()||{});const s=M?Object.fromEntries(Object.entries(M).filter(([,i])=>i!==""&&i!==null&&i!==void 0)):{},c={...Object.fromEntries(Object.entries(s).filter(([i])=>i!=="gatewayInstanceId"&&i!=="proxyConfigId")),...le((C=y.value)==null?void 0:C.pageIndex,(N=y.value)==null?void 0:N.pageSize)},o=await Ge(c);if(Q(o)){const i=Z(o,[]);n(i);const z=he(o);r(z)}else d.error(K(o,"查询服务列表失败"))}catch{d.error("加载服务列表失败")}finally{l.value=!1}};return{model:u,loadServices:T,handleSearch:async R=>{I(),await T(R)},handlePageChange:async({currentPage:R,pageSize:v})=>{r({pageIndex:R,pageSize:v}),await T()}}}function Pt(f,g,d){const u=Rt(f,d);return{service:u,handleSearch:async p=>{await u.handleSearch(p)}}}const Dt=["id"],xt=V({name:"ServiceListModal",__name:"ServiceListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1200},to:{default:void 0},modelValue:{default:""},gatewayInstanceId:{default:void 0}},emits:["update:visible","after-leave","select","update:modelValue"],setup(f,{emit:g}){const d=f,u=g,l=D(),p=D(),y=D(d.visible),n=$(()=>d.visible,h=>{y.value=h,h&&b()}),{service:r,handleSearch:b}=Pt(d.gatewayInstanceId,p,l),I=h=>{y.value=h,u("update:visible",h)},T=()=>{u("after-leave")},m=({row:h})=>{if(h){const R=h.serviceName||"";u("update:modelValue",R),u("select",h),I(!1)}};return ce(()=>{n()}),(h,R)=>(L(),E(e(fe),{visible:y.value,title:d.title||"选择服务",width:d.width||1200,to:d.to,"show-footer":!1,"onUpdate:visible":I,onAfterLeave:T},{default:t(()=>[k("div",{class:"service-list-modal",id:e(r).model.moduleId},[a(e(ne),{direction:"vertical","no-resize":!0},{1:t(()=>[a(se,X({ref_key:"searchFormRef",ref:l,"module-id":e(r).model.moduleId},e(r).model.searchFormConfig,{onSearch:e(b)}),null,16,["module-id","onSearch"])]),2:t(()=>[a(e(de),X({ref_key:"gridRef",ref:p,"module-id":e(r).model.moduleId,data:e(r).model.serviceList,loading:e(r).model.loading},e(r).model.gridConfig,{onPageChange:e(r).handlePageChange,onRowClick:m}),{serviceType:t(({row:v})=>[a(e(x),{type:v.serviceType===0?"info":"success",size:"small"},{default:t(()=>[S(_(v.serviceType===0?"静态配置":"服务发现"),1)]),_:2},1032,["type"])]),loadBalanceStrategy:t(({row:v})=>[a(e(x),{type:"default",size:"small"},{default:t(()=>[S(_(e(r).model.getLoadBalanceStrategyLabel(v.loadBalanceStrategy)),1)]),_:2},1024)]),activeFlag:t(({row:v})=>[a(e(x),{type:v.activeFlag==="Y"?"success":"error",size:"small"},{default:t(()=>[S(_(v.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1})],8,Dt)]),_:1},8,["visible","title","width","to"]))}}),zt=U(xt,[["__scopeId","data-v-467397d9"]]),Ot=V({name:"ServiceNameSelector",__name:"ServiceNameSelector",props:{modelValue:{default:""},gatewayInstanceId:{default:void 0}},emits:["update:modelValue"],setup(f,{emit:g}){const d=f,u=g,l=D(!1),p=D(d.modelValue);$(()=>d.modelValue,r=>{p.value=r}),$(p,r=>{u("update:modelValue",r)});const y=r=>{p.value=r},n=()=>{l.value=!0};return(r,b)=>(L(),Y(ue,null,[a(e(be),null,{default:t(()=>[a(e(ve),{value:r.modelValue,placeholder:"请输入服务名称或点击选择",clearable:"",size:"small","onUpdate:value":y},null,8,["value"]),a(e(ye),{type:"primary",size:"small",onClick:n},{icon:t(()=>[a(e(oe),null,{default:t(()=>[a(e(_e))]),_:1})]),_:1})]),_:1}),a(zt,{visible:l.value,"onUpdate:visible":b[0]||(b[0]=I=>l.value=I),"model-value":p.value,"onUpdate:modelValue":b[1]||(b[1]=I=>p.value=I),title:"选择服务",width:1200,"gateway-instance-id":r.gatewayInstanceId},null,8,["visible","model-value","gateway-instance-id"])],64))}}),kt=U(Ot,[["__scopeId","data-v-c26c64ab"]]);function De(){const f="hub0023",g=D(!1),d=D([]),u=D(),y={fields:[{field:"timeRange",label:"时间范围",type:"datetimerange",placeholder:"请选择时间范围",span:8,clearable:!0,required:!0,rules:[{validator:(s,c)=>!c||!Array.isArray(c)||c.length!==2||!c[0]||!c[1]?new Error("请选择时间范围"):!0,trigger:["change","blur"]}],props:{shortcuts:{今天:()=>{const s=new Date,c=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0),o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59);return[c.getTime(),o.getTime()]},昨天:()=>{const s=new Date;s.setDate(s.getDate()-1);const c=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0),o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59);return[c.getTime(),o.getTime()]},最近1小时:()=>{const s=Date.now();return[s-36e5,s]},最近6小时:()=>{const s=Date.now();return[s-216e5,s]},最近24小时:()=>{const s=Date.now();return[s-864e5,s]},最近7天:()=>{const s=Date.now();return[s-6048e5,s]}},style:{width:"100%"}},defaultValue:(()=>{const s=new Date,c=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0),o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59);return[c.getTime(),o.getTime()]})()},{field:"gatewayInstanceName",label:"实例名称",type:"custom",span:8,render:s=>ge(ht,{modelValue:s.gatewayInstanceName||"","onUpdate:modelValue":c=>{s.gatewayInstanceName=c}})},{field:"routeName",label:"路由名称",type:"custom",span:8,render:s=>ge(Lt,{modelValue:s.routeName||"","onUpdate:modelValue":c=>{s.routeName=c},gatewayInstanceId:(s.gatewayInstanceName,void 0)})},{field:"serviceName",label:"服务名称",type:"custom",span:8,render:s=>ge(kt,{modelValue:s.serviceName||"","onUpdate:modelValue":c=>{s.serviceName=c},gatewayInstanceId:(s.gatewayInstanceName,void 0)})},{field:"minProcessingTime",label:"网关耗时",type:"number",placeholder:"最小耗时(毫秒)",span:8,clearable:!0,props:{min:0,style:{width:"100%"}}}],moreFields:[{field:"traceId",label:"链路追踪ID",type:"input",placeholder:"请输入链路追踪ID",span:8,clearable:!0},{field:"requestPath",label:"请求路径",type:"input",placeholder:"请输入请求路径",span:8,clearable:!0},{field:"clientIpAddress",label:"客户端IP",type:"input",placeholder:"请输入客户端IP",span:8,clearable:!0},{field:"requestMethod",label:"请求方法",type:"select",placeholder:"请选择请求方法",span:8,clearable:!0,options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"HEAD",value:"HEAD"},{label:"OPTIONS",value:"OPTIONS"}]},{field:"proxyType",label:"代理类型",type:"select",placeholder:"请选择代理类型",span:8,clearable:!0,options:[{label:"HTTP",value:"http"},{label:"WebSocket",value:"websocket"},{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}]},{field:"gatewayStatusCode",label:"状态码",type:"number",placeholder:"请输入状态码",span:8,clearable:!0,props:{min:100,max:599,style:{width:"100%"}}},{field:"backendStatusCode",label:"后端状态码",type:"number",placeholder:"请输入后端状态码",span:8,clearable:!0,props:{min:100,max:599,style:{width:"100%"}}},{field:"resetFlag",label:"重置状态",type:"select",placeholder:"请选择重置状态",span:8,clearable:!0,options:[{label:"未重置",value:"N"},{label:"已重置",value:"Y"}]},{field:"userIdentifier",label:"用户标识",type:"input",placeholder:"请输入用户标识",span:8,clearable:!0},{field:"errorOnly",label:"只显示错误",type:"switch",span:8,defaultValue:!1}],toolbarButtons:[{key:"view",label:"查看详情",icon:Fe,type:"primary",tooltip:"查看选中日志的详情"},{key:"batchReset",label:"批量重发",type:"warning",icon:Pe,tooltip:"批量重发选中的日志"},{key:"export",label:"导出日志",type:"info",icon:Be,tooltip:"导出日志数据"}],showSearchButton:!0,showResetButton:!0};return{moduleId:f,loading:g,logList:d,pageInfo:u,searchFormConfig:y,gridConfig:{rowId:"traceId",columns:[{field:"traceId",title:"链路追踪ID",width:140,showOverflow:"tooltip"},{field:"gatewayInstanceName",title:"网关实例",width:120,showOverflow:"tooltip",formatter:({row:s})=>s.gatewayInstanceName||s.gatewayInstanceId||"-"},{field:"routeName",title:"路由名称",width:120,showOverflow:"tooltip",slots:{default:"routeName"}},{field:"requestPath",title:"请求路径",width:200,showOverflow:"tooltip"},{field:"requestMethod",title:"请求方法",width:80,align:"center",slots:{default:"requestMethod"}},{field:"gatewayStatusCode",title:"状态码",width:80,align:"center",sortable:!0,slots:{default:"gatewayStatusCode"}},{field:"processingStatus",title:"处理状态",width:100,align:"center",slots:{default:"processingStatus"}},{field:"totalProcessingTimeMs",title:"总处理时间",width:110,align:"center",sortable:!0,slots:{default:"totalProcessingTimeMs"}},{field:"gatewayStartProcessingTime",title:"开始时间",width:200,sortable:!0,formatter:({cellValue:s})=>A(s,"YYYY-MM-DD HH:mm:ss.SSS")},{field:"gatewayFinishedProcessingTime",title:"完成时间",width:200,sortable:!0,formatter:({cellValue:s})=>s?A(s,"YYYY-MM-DD HH:mm:ss.SSS"):"-"},{field:"clientIpAddress",title:"客户端IP",width:160},{field:"backendStatusCode",title:"后端状态码",width:100,align:"center",sortable:!0,slots:{default:"backendStatusCode"}},{field:"gatewayProcessingTimeMs",title:"网关耗时",width:100,align:"center",sortable:!0,slots:{default:"gatewayProcessingTimeMs"}},{field:"backendResponseTimeMs",title:"后端耗时",width:100,align:"center",sortable:!0,slots:{default:"backendResponseTimeMs"}},{field:"proxyType",title:"代理类型",width:100,align:"center",slots:{default:"proxyType"}},{field:"resetFlag",title:"重置状态",width:100,align:"center",slots:{default:"resetFlag"}},{field:"userIdentifier",title:"用户标识",width:120,showOverflow:"tooltip",formatter:({cellValue:s})=>s||"-"},{field:"requestSize",title:"请求大小",width:100,formatter:({cellValue:s})=>s!=null?me(s):"-"},{field:"responseSize",title:"响应大小",width:100,formatter:({cellValue:s})=>s!=null?me(s):"-"},{field:"resetCount",title:"重置次数",width:100,formatter:({cellValue:s})=>s??"-"},{field:"errorMessage",title:"错误信息",width:150,showOverflow:"tooltip",formatter:({cellValue:s})=>s||"-"},{field:"logLevel",title:"日志级别",width:100,align:"center",slots:{default:"logLevel"}}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:u,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"reset",name:"重发",prefixIcon:"vxe-icon-refresh"}]},height:"100%"},resetPagination:()=>{u.value=void 0},updatePagination:s=>{u.value?Object.assign(u.value,s):u.value=s},setLogList:s=>{d.value=s},clearLogList:()=>{d.value=[]},getMethodTagType:s=>({GET:"success",POST:"info",PUT:"warning",DELETE:"error",PATCH:"default",HEAD:"default",OPTIONS:"default"})[s||""]||"default",getStatusCodeTagType:s=>s?s>=200&&s<300?"success":s>=300&&s<400?"warning":s>=400?"error":"default":"default",getTimeTagType:(s,c,o)=>s>c?"error":s>o?"warning":"success",getProcessingStatusTagType:s=>{const c=!!s.gatewayFinishedProcessingTime;return s.errorMessage?"error":c?"success":"warning"},getProcessingStatusText:s=>{const c=!!s.gatewayFinishedProcessingTime;return s.errorMessage?"异常":c?"已完成":"处理中"},getProxyTypeTagType:s=>({http:"info",websocket:"warning",tcp:"success",udp:"error"})[s||""]||"default",getLogLevelTagType:s=>({DEBUG:"default",INFO:"info",WARN:"warning",ERROR:"error"})[s||""]||"default"}}function Nt(f){const g=ee(),d=De(),{loading:u,logList:l,pageInfo:p,setLogList:y,updatePagination:n,resetPagination:r}=d,b=async C=>{var N,M,s;u.value=!0;try{let c=C;!c&&((N=f==null?void 0:f.value)!=null&&N.getFormData)&&(c=f.value.getFormData()||{});const o={};c&&Object.keys(c).forEach(O=>{O==="timeRange"&&Array.isArray(c[O])&&c[O].length===2?(o.startTime=A(c[O][0],"YYYY-MM-DDTHH:mm:ss"),o.endTime=A(c[O][1],"YYYY-MM-DDTHH:mm:ss")):c[O]!==""&&c[O]!==null&&c[O]!==void 0&&(o[O]=c[O])});const i={...o,...le((M=p.value)==null?void 0:M.pageIndex,(s=p.value)==null?void 0:s.pageSize),sortField:"gatewayStartProcessingTime",sortOrder:"DESC"},z=await Qe(i);if(Q(z)){const O=Z(z,[]);y(O);try{const w=he(z);w&&Object.keys(w).length>0&&n(w)}catch(w){console.warn("分页信息解析失败:",w)}}else{const O=K(z,"查询网关日志列表失败");g.error(O),y([])}}catch(c){console.error("加载网关日志列表失败:",c),g.error("加载网关日志列表失败"),y([])}finally{u.value=!1}};return{model:d,loadGatewayLogs:b,handleSearch:async C=>{r(),await b(C)},handleReset:async()=>{r(),await b()},handlePageChange:async({currentPage:C,pageSize:N})=>{n({pageIndex:C,pageSize:N}),await b()},handleRefresh:async()=>{await b()},resetGatewayLogs:async(C,N="手动重置",M="current_user")=>{try{if(C.length===0)return g.warning("请选择要重置的日志"),!1;const s=C.filter(i=>i.resetFlag==="N");if(s.length===0)return g.warning("所选日志都已重置，无需再次重置"),!1;const c={traceIds:s.map(i=>i.traceId),resetReason:N,operatorId:M},o=await Ze(c);if(Q(o)){const i=s.length;return g.success(`成功重置 ${i} 条网关日志`),await b(),!0}else{const i=K(o,"重置网关日志失败");return g.error(i),!1}}catch(s){return console.error("重置网关日志失败:",s),g.error("重置网关日志失败"),!1}},exportGatewayLogs:async C=>{var N;try{let M=C;!M&&((N=f==null?void 0:f.value)!=null&&N.getFormData)&&(M=f.value.getFormData()||{});const s={};M&&Object.keys(M).forEach(i=>{i==="timeRange"&&Array.isArray(M[i])&&M[i].length===2?(s.startTime=A(M[i][0],"YYYY-MM-DDTHH:mm:ss"),s.endTime=A(M[i][1],"YYYY-MM-DDTHH:mm:ss")):M[i]!==""&&M[i]!==null&&M[i]!==void 0&&(s[i]=M[i])});const c={...s,...le(1,1e4),sortField:"gatewayStartProcessingTime",sortOrder:"DESC"},o=await et(c);if(Q(o)){const i=Z(o),z=document.createElement("a");z.href=i,z.download=`网关日志_${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.xlsx`,document.body.appendChild(z),z.click(),document.body.removeChild(z),g.success("网关日志导出成功")}else{const i=K(o,"导出网关日志失败");g.error(i)}}catch(M){console.error("导出网关日志失败:",M),g.error("导出网关日志失败")}}}}function Et(f,g){const d=ee(),u=Nt(g),l=D(!1),p=D(""),y=T=>{p.value=T.traceId,l.value=!0};return{service:u,detailDialogVisible:l,selectedTraceId:p,openViewDialog:y,closeDetailDialog:()=>{l.value=!1,p.value=""},handleToolbarClick:async(T,m)=>{switch(T){case"view":{if(!(f!=null&&f.value)){d.warning("Grid 引用未设置");return}const h=f.value.getCurrentRecord();if(!h){d.warning("请先点击选择要查看的日志");return}y(h);break}case"batchReset":{if(!(f!=null&&f.value)){d.warning("Grid 引用未设置");return}const h=f.value.getCheckboxRecords();if(h.length===0){d.warning("请选择要重置的日志");return}await u.resetGatewayLogs(h,"批量重置","current_user");break}case"export":{await u.exportGatewayLogs(m);break}}},handleMenuClick:async({code:T,row:m})=>{if(m)switch(T){case"view":y(m);break;case"reset":await u.resetGatewayLogs([m],"手动重置","current_user");break}},handleSearch:async T=>{await u.handleSearch(T)}}}const Yt={class:"gateway-log-query"},qt={class:"route-name-text"},Ht={key:1},At={key:1},Gt={key:1},Ft={key:1},Bt={key:1},$t={key:1},Vt=V({name:"GatewayLogQuery",__name:"GatewayLogQuery",setup(f,{expose:g}){const d=D(),u=D(),{service:l,detailDialogVisible:p,selectedTraceId:y,handleToolbarClick:n,handleMenuClick:r,handleSearch:b}=Et(u,d);return g({searchFormRef:d,gridRef:u,service:l}),(I,T)=>(L(),Y("div",Yt,[a(e(ne),{direction:"vertical","no-resize":!0},{1:t(()=>[a(se,X({ref_key:"searchFormRef",ref:d,"module-id":e(l).model.moduleId},e(l).model.searchFormConfig,{onSearch:e(b),onToolbarClick:e(n)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:t(()=>[a(e(de),X({ref_key:"gridRef",ref:u,"module-id":e(l).model.moduleId,data:e(l).model.logList,loading:e(l).model.loading},e(l).model.gridConfig,{onPageChange:e(l).handlePageChange,onMenuClick:e(r)}),{routeName:t(({row:m})=>[k("span",qt,_(m.routeName||"-"),1)]),requestMethod:t(({row:m})=>[a(e(x),{type:e(l).model.getMethodTagType(m.requestMethod),size:"small"},{default:t(()=>[S(_(m.requestMethod),1)]),_:2},1032,["type"])]),gatewayStatusCode:t(({row:m})=>[a(e(x),{type:e(l).model.getStatusCodeTagType(m.gatewayStatusCode),size:"small"},{default:t(()=>[S(_(m.gatewayStatusCode),1)]),_:2},1032,["type"])]),backendStatusCode:t(({row:m})=>[m.backendStatusCode!=null?(L(),E(e(x),{key:0,type:e(l).model.getStatusCodeTagType(m.backendStatusCode),size:"small"},{default:t(()=>[S(_(m.backendStatusCode),1)]),_:2},1032,["type"])):(L(),Y("span",Ht,"-"))]),totalProcessingTimeMs:t(({row:m})=>[m.totalProcessingTimeMs!=null?(L(),E(e(x),{key:0,type:e(l).model.getTimeTagType(m.totalProcessingTimeMs,5e3,1e3),size:"small"},{default:t(()=>[S(_(m.totalProcessingTimeMs)+"ms ",1)]),_:2},1032,["type"])):(L(),Y("span",At,"-"))]),gatewayProcessingTimeMs:t(({row:m})=>[m.gatewayProcessingTimeMs!=null?(L(),E(e(x),{key:0,type:e(l).model.getTimeTagType(m.gatewayProcessingTimeMs,2e3,500),size:"small"},{default:t(()=>[S(_(m.gatewayProcessingTimeMs)+"ms ",1)]),_:2},1032,["type"])):(L(),Y("span",Gt,"-"))]),backendResponseTimeMs:t(({row:m})=>[m.backendResponseTimeMs!=null?(L(),E(e(x),{key:0,type:e(l).model.getTimeTagType(m.backendResponseTimeMs,3e3,1e3),size:"small"},{default:t(()=>[S(_(m.backendResponseTimeMs)+"ms ",1)]),_:2},1032,["type"])):(L(),Y("span",Ft,"-"))]),processingStatus:t(({row:m})=>[a(e(x),{type:e(l).model.getProcessingStatusTagType(m),size:"small"},{default:t(()=>[S(_(e(l).model.getProcessingStatusText(m)),1)]),_:2},1032,["type"])]),proxyType:t(({row:m})=>[m.proxyType?(L(),E(e(x),{key:0,type:e(l).model.getProxyTypeTagType(m.proxyType),size:"small"},{default:t(()=>[S(_(m.proxyType.toUpperCase()),1)]),_:2},1032,["type"])):(L(),Y("span",Bt,"-"))]),resetFlag:t(({row:m})=>[a(e(x),{type:m.resetFlag==="Y"?"warning":"default",size:"small"},{default:t(()=>[S(_(m.resetFlag==="Y"?"已重置":"未重置"),1)]),_:2},1032,["type"])]),logLevel:t(({row:m})=>[m.logLevel?(L(),E(e(x),{key:0,type:e(l).model.getLogLevelTagType(m.logLevel),size:"small"},{default:t(()=>[S(_(m.logLevel),1)]),_:2},1032,["type"])):(L(),Y("span",$t,"-"))]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),a(ut,{visible:e(p),"onUpdate:visible":T[0]||(T[0]=m=>Oe(p)?p.value=m:null),"trace-id":e(y)},null,8,["visible","trace-id"])]))}}),Ut=U(Vt,[["__scopeId","data-v-8b5be917"]]);function jt(){const f=D(),g=D(),d=D(),u=D(),l=D();let p=null,y=null,n=null,r=null,b=null;const I=c=>{const o={success:["#52c41a","#73d13d","#95de64","#b7eb8f","#d9f7be","#389e0d","#237804"],redirect:["#fa8c16","#ffa940","#ffc069","#ffd591","#ffe7ba","#d46b08","#ad4e00"],clientError:["#faad14","#ffc53d","#ffd666","#ffe58f","#fff1b8","#d48806","#ad6800"],serverError:["#ff4d4f","#ff7875","#ffa39e","#ffccc7","#ffe1e1","#f5222d","#cf1322"],other:["#d9d9d9","#bfbfbf","#8c8c8c","#595959","#434343","#262626","#1f1f1f"]},i={200:o.success[0],201:o.success[1],202:o.success[2],204:o.success[3],206:o.success[4],301:o.redirect[0],302:o.redirect[1],304:o.redirect[2],307:o.redirect[3],308:o.redirect[4],400:o.clientError[0],401:o.clientError[1],403:o.clientError[2],404:o.clientError[3],405:o.clientError[4],409:o.clientError[5],429:o.clientError[6],500:o.serverError[0],501:o.serverError[1],502:o.serverError[2],503:o.serverError[3],504:o.serverError[4],505:o.serverError[5]};if(i[c])return i[c];const z=parseInt(c);let O,w=0;return z>=200&&z<300?(O=o.success,w=(z-200)%O.length):z>=300&&z<400?(O=o.redirect,w=(z-300)%O.length):z>=400&&z<500?(O=o.clientError,w=(z-400)%O.length):z>=500&&z<600?(O=o.serverError,w=(z-500)%O.length):(O=o.other,w=z%O.length),O[w]},T=c=>c<=1?"#52c41a":c<=5?"#faad14":c<=10?"#fa8c16":"#ff4d4f",m=c=>{f.value&&!p&&(p=ae(f.value)),p&&p.setOption({tooltip:{trigger:"axis"},xAxis:{type:"time",axisLabel:{formatter:function(o){return A(o,"HH:mm")}}},yAxis:{type:"value",name:"请求数"},grid:{top:40,bottom:60,left:80,right:40},series:[{name:"总请求数",type:"line",data:c.requestTrend.length>0?c.requestTrend.map(o=>[o.timestamp,o.totalRequests]):[],smooth:!0,areaStyle:{opacity:.3},itemStyle:{color:"#18a058"}}]},!0)},h=c=>{g.value&&!y&&(y=ae(g.value)),y&&y.setOption({tooltip:{trigger:"axis",formatter:function(o){let i=`<div style="padding: 8px;"><strong>${A(o[0].axisValue,"MM-DD HH:mm")}</strong><br/>`;const z=c.responseTimeTrend.find(O=>O.timestamp===o[0].axisValue);return z&&(i+=`请求数量: ${z.requestCount}<br/>`),o.forEach(O=>{i+=`${O.seriesName}: ${O.value[1]}ms<br/>`}),i+="</div>",i}},xAxis:{type:"time",axisLabel:{formatter:function(o){return A(o,"HH:mm")}}},yAxis:{type:"value",name:"毫秒"},legend:{top:0,type:"scroll",orient:"horizontal",itemGap:20},grid:{top:60,bottom:60,left:80,right:40},series:[{name:"平均响应时间",type:"line",data:c.responseTimeTrend.map(o=>[o.timestamp,o.avgResponseTimeMs]),smooth:!0,itemStyle:{color:"#5470c6"}},{name:"P50响应时间",type:"line",data:c.responseTimeTrend.map(o=>[o.timestamp,o.p50ResponseTimeMs]),smooth:!0,itemStyle:{color:"#91cc75"}},{name:"P90响应时间",type:"line",data:c.responseTimeTrend.map(o=>[o.timestamp,o.p90ResponseTimeMs]),smooth:!0,itemStyle:{color:"#fac858"}},{name:"P99响应时间",type:"line",data:c.responseTimeTrend.map(o=>[o.timestamp,o.p99ResponseTimeMs]),smooth:!0,itemStyle:{color:"#ee6666"}},{name:"最大响应时间",type:"line",data:c.responseTimeTrend.map(o=>[o.timestamp,o.maxResponseTimeMs]),smooth:!0,itemStyle:{color:"#73c0de"},lineStyle:{type:"dashed"}}]},!0)},R=c=>{d.value&&!n&&(n=ae(d.value)),n&&n.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",top:"center"},series:[{name:"请求指标",type:"pie",data:[{name:"成功请求",value:c.successRequests,itemStyle:{color:"#52c41a"}},{name:"失败请求",value:c.failedRequests,itemStyle:{color:"#ff4d4f"}}],radius:["40%","70%"],center:["65%","50%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!0,formatter:"{b}: {d}%"}}]},!0)},v=c=>{u.value&&!r&&(r=ae(u.value)),r&&r.setOption({tooltip:{trigger:"item",formatter:function(o){const i=c.statusCodeDistribution.find(z=>z.statusCode===o.name);return i?`
                                <div style="padding: 8px;">
                                    <div><strong>${i.statusCode}</strong></div>
                                    <div>分类: ${i.category||"未分类"}</div>
                                    <div>描述: ${i.description||"无描述"}</div>
                                    <div>数量: ${i.count}</div>
                                    <div>百分比: ${i.percentage.toFixed(2)}%</div>
                                </div>
                            `:`${o.name}: ${o.value} (${o.percent}%)`}},legend:{orient:"vertical",left:"left",top:"center"},series:[{name:"状态码",type:"pie",data:c.statusCodeDistribution.map(o=>({name:o.statusCode,value:o.count,itemStyle:{color:I(o.statusCode)}})),radius:["40%","70%"],center:["65%","50%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!0,formatter:"{b}: {d}%"}}]},!0)},C=c=>{l.value&&!b&&(b=ae(l.value)),b&&b.setOption({tooltip:{trigger:"axis",confine:!1,formatter:function(o){const i=c.hotRoutes.find(z=>z.routePath===o[0].name);return i?`
                                <div style="padding: 8px;">
                                    <div><strong>${i.routePath}</strong></div>
                                    <div>请求数量: ${i.requestCount}</div>
                                    <div>最大响应时间: ${i.maxResponseTimeMs||"N/A"}ms</div>
                                    <div>最小响应时间: ${i.minResponseTimeMs||"N/A"}ms</div>
                                    <div>错误率: ${i.errorRate}%</div>
                                    <div>QPS: ${i.qps}</div>
                                    <div>服务名称: ${i.serviceName||"N/A"}</div>
                                </div>
                            `:""}},xAxis:{type:"value",name:"请求数"},yAxis:{type:"category",data:c.hotRoutes.map(o=>o.routePath),axisLabel:{formatter:function(o){return o.length>20?o.substring(0,20)+"...":o}}},grid:{top:40,bottom:60,left:140,right:80},series:[{name:"请求量",type:"bar",data:c.hotRoutes.map(o=>o.requestCount),itemStyle:{color:"#5470c6"},barMaxWidth:40}]},!0)},N=async(c,o)=>{await ie(),f.value&&!p&&m(o),g.value&&!y&&h(o),d.value&&!n&&R(c),u.value&&!r&&v(o),l.value&&!b&&C(o)},M=(c,o)=>{o.requestTrend.length>0?p?p.setOption({xAxis:{type:"time",axisLabel:{formatter:function(i){return A(i,"HH:mm")}}},series:[{data:o.requestTrend.map(i=>[i.timestamp,i.totalRequests]),itemStyle:{color:"#18a058"}}]}):m(o):p&&(p.dispose(),p=null),o.responseTimeTrend.length>0?y?y.setOption({xAxis:{type:"time",axisLabel:{formatter:function(i){return A(i,"HH:mm")}}},legend:{top:0,type:"scroll",orient:"horizontal",itemGap:20},series:[{data:o.responseTimeTrend.map(i=>[i.timestamp,i.avgResponseTimeMs])},{data:o.responseTimeTrend.map(i=>[i.timestamp,i.p50ResponseTimeMs])},{data:o.responseTimeTrend.map(i=>[i.timestamp,i.p90ResponseTimeMs])},{data:o.responseTimeTrend.map(i=>[i.timestamp,i.p99ResponseTimeMs])},{data:o.responseTimeTrend.map(i=>[i.timestamp,i.maxResponseTimeMs])}]}):h(o):y&&(y.dispose(),y=null),c.totalRequests>0?n?n.setOption({legend:{orient:"vertical",left:"left",top:"center"},series:[{data:[{name:"成功请求",value:c.successRequests,itemStyle:{color:"#52c41a"}},{name:"失败请求",value:c.failedRequests,itemStyle:{color:"#ff4d4f"}}],center:["65%","50%"]}]}):R(c):n&&(n.dispose(),n=null),o.statusCodeDistribution.length>0?r?r.setOption({legend:{orient:"vertical",left:"left",top:"center"},series:[{data:o.statusCodeDistribution.map(i=>({name:i.statusCode,value:i.count,itemStyle:{color:I(i.statusCode)}})),center:["65%","50%"]}]}):v(o):r&&(r.dispose(),r=null),o.hotRoutes.length>0?b?b.setOption({yAxis:{data:o.hotRoutes.map(i=>i.routePath),axisLabel:{formatter:function(i){return i.length>20?i.substring(0,20)+"...":i}}},series:[{data:o.hotRoutes.map(i=>({value:i.requestCount,itemStyle:{color:T(i.errorRate)}}))}]}):C(o):b&&(b.dispose(),b=null)},s=()=>{p&&(p.dispose(),p=null),y&&(y.dispose(),y=null),n&&(n.dispose(),n=null),r&&(r.dispose(),r=null),b&&(b.dispose(),b=null)};return ke(()=>{s()}),{requestTrendChartRef:f,responseTimeChartRef:g,requestMetricsChartRef:d,statusCodeChartRef:u,hotRoutesChartRef:l,initCharts:N,updateCharts:M,destroyCharts:s}}function Jt(){const f="hub0023-monitor",g=D(!1),d=Te({totalRequests:0,successRequests:0,failedRequests:0,requestsPerSecond:0,avgResponseTimeMs:0,minResponseTimeMs:0,maxResponseTimeMs:0}),u=Te({requestTrend:[],responseTimeTrend:[],statusCodeDistribution:[],hotRoutes:[]}),l=D(null),p=D("MINUTE"),y=()=>{const h=Date.now();return[h-36e5,h]},n={最近1小时:()=>{const h=Date.now();return[h-36e5,h]},最近6小时:()=>{const h=Date.now();return[h-216e5,h]},最近12小时:()=>{const h=Date.now();return[h-432e5,h]},最近24小时:()=>{const h=Date.now();return[h-864e5,h]}},r=[{label:"按分钟",value:"MINUTE"},{label:"按小时",value:"HOUR"},{label:"按天",value:"DAY"}],b={fields:[{field:"timeRange",label:"时间范围",type:"datetimerange",placeholder:"请选择时间范围（必填，不超过24小时）",span:8,clearable:!0,required:!0,rules:[{validator:(h,R)=>{if(!R||!Array.isArray(R)||R.length!==2||!R[0]||!R[1])return new Error("请选择时间范围");const v=R[0],N=R[1]-v,M=24*60*60*1e3;return N>M?new Error("时间范围不能超过24小时"):N<=0?new Error("结束时间必须大于开始时间"):!0},trigger:["change","blur"]}],props:{shortcuts:n,style:{width:"100%"}},defaultValue:y()},{field:"timeGranularity",label:"时间粒度",type:"select",placeholder:"请选择时间粒度",span:8,clearable:!1,options:r,defaultValue:"MINUTE"},{field:"routeName",label:"路由名称",type:"input",placeholder:"请输入路由名称（可选）",span:8,clearable:!0},{field:"requestPath",label:"请求路径",type:"input",placeholder:"请输入请求路径（可选）",span:8,clearable:!0}],toolbarButtons:[{key:"refresh",label:"刷新数据",icon:Pe,type:"primary",tooltip:"刷新监控数据"}],showSearchButton:!0,showResetButton:!0};return{moduleId:f,loading:g,overviewData:d,chartData:u,timeRange:l,timeGranularity:p,searchFormConfig:b,timeRangeShortcuts:n,timeGranularityOptions:r,initTimeRange:y,getTimeGranularityLabel:()=>{switch(p.value){case"MINUTE":return"按分钟";case"HOUR":return"按小时";case"DAY":return"按天";default:return"按分钟"}},resetOverviewData:()=>{Object.assign(d,{totalRequests:0,successRequests:0,failedRequests:0,requestsPerSecond:0,avgResponseTimeMs:0,minResponseTimeMs:0,maxResponseTimeMs:0})},resetChartData:()=>{Object.assign(u,{requestTrend:[],responseTimeTrend:[],statusCodeDistribution:[],hotRoutes:[]})}}}function Wt(f){const g=ee(),d=Jt(),{loading:u,overviewData:l,chartData:p,timeRange:y,timeGranularity:n,resetOverviewData:r,resetChartData:b}=d,I=v=>{if(!v||v.length!==2)return g.error("请选择时间范围"),!1;const C=v[0],M=v[1]-C,s=24*60*60*1e3;return M>s?(g.error("时间范围不能超过24小时，请重新选择"),!1):M<=0?(g.error("结束时间必须大于开始时间"),!1):!0},T=async v=>{var M;let C=v;!C&&((M=f==null?void 0:f.value)!=null&&M.getFormData)&&(C=f.value.getFormData()||{});const N=(C==null?void 0:C.timeRange)||y.value;if(I(N)){u.value=!0;try{const[s,c]=N,o={startTime:A(s,"YYYY-MM-DDTHH:mm:ss"),endTime:A(c,"YYYY-MM-DDTHH:mm:ss"),timeGranularity:(C==null?void 0:C.timeGranularity)||n.value,...(C==null?void 0:C.routeName)&&{routeName:C.routeName},...(C==null?void 0:C.requestPath)&&{requestPath:C.requestPath}},[i,z]=await Promise.all([tt(o),at(o)]);if(Q(i)&&i.bizData){const O=Z(i);Object.assign(l,O)}else{const O=K(i,"获取概览数据失败");g.warning(O),r()}if(Q(z)&&z.bizData){const O=Z(z);Object.assign(p,O)}else{const O=K(z,"获取图表数据失败");g.warning(O),b()}g.success("监控数据加载成功")}catch(s){console.error("加载监控数据失败:",s),g.error("加载监控数据失败，请检查网络连接或联系管理员"),r(),b()}finally{u.value=!1}}};return{model:d,validateTimeRange:I,loadMonitoringData:T,handleSearch:async v=>{v!=null&&v.timeRange&&(y.value=v.timeRange),v!=null&&v.timeGranularity&&(n.value=v.timeGranularity),await T(v)},handleReset:async()=>{y.value=d.initTimeRange(),n.value="MINUTE",r(),b(),await T({timeRange:y.value,timeGranularity:n.value})},refreshMonitoringData:async()=>{await T()}}}function Xt(f){const g=Wt(f),d=jt(),u=async r=>{await g.handleSearch(r)},l=async()=>{await g.handleReset()},p=async r=>{switch(r){case"refresh":await g.refreshMonitoringData();break;default:console.warn(`未知的工具栏按钮: ${r}`)}},y=async()=>{g.model.timeRange.value=g.model.initTimeRange(),await ie(),await d.initCharts(g.model.overviewData,g.model.chartData),await g.loadMonitoringData()},n=$([()=>g.model.overviewData,()=>g.model.chartData],()=>{d.updateCharts(g.model.overviewData,g.model.chartData)},{deep:!0});return ce(()=>{n()}),{service:g,charts:d,handleSearch:u,handleReset:l,handleToolbarClick:p,initPageData:y}}const Qt={class:"monitoring-panel"},Kt={class:"monitoring-content"},Zt={class:"overview-header"},ea={class:"overview-content"},ta={class:"chart-header"},aa={key:0,class:"chart-loading"},la={key:1,class:"chart-empty"},sa={class:"chart-header"},oa={key:0,class:"chart-loading"},na={key:1,class:"chart-empty"},ra={class:"chart-header"},ia={key:0,class:"chart-loading"},da={key:1,class:"chart-empty"},ua={class:"chart-header"},ca={key:0,class:"chart-loading"},fa={key:1,class:"chart-empty"},ga={class:"chart-header"},ma={key:0,class:"chart-loading"},pa={key:1,class:"chart-empty"},va=V({__name:"MonitoringPanel",setup(f){const g=D(),d=D(),u=D(),l=D(),p=D(),y=D(),n=Xt(g);Ne(async()=>{await ie(),await ie(),d.value&&(n.charts.requestTrendChartRef.value=d.value),u.value&&(n.charts.responseTimeChartRef.value=u.value),l.value&&(n.charts.requestMetricsChartRef.value=l.value),p.value&&(n.charts.statusCodeChartRef.value=p.value),y.value&&(n.charts.hotRoutesChartRef.value=y.value),await n.initPageData()});const r=async T=>{await n.handleSearch(T)},b=async()=>{await n.handleReset()},I=async T=>{await n.handleToolbarClick(T)};return(T,m)=>{const h=se,R=oe,v=$e,C=Xe,N=We,M=Ee,s=q,c=Ce,o=Me;return L(),Y("div",Qt,[a(e(ne),{direction:"vertical","no-resize":!0},{1:t(()=>[a(h,X({ref_key:"searchFormRef",ref:g,"module-id":e(n).service.model.moduleId},e(n).service.model.searchFormConfig,{onSearch:r,onReset:b,onToolbarClick:I}),null,16,["module-id"])]),2:t(()=>[k("div",Kt,[a(s,{class:"overview-card",size:"small"},{header:t(()=>[k("div",Zt,[a(R,{size:"18",color:"#18a058"},{default:t(()=>[a(e(Ve))]),_:1}),m[0]||(m[0]=k("span",null,"监控概览",-1))])]),default:t(()=>[k("div",ea,[a(N,{cols:3,"x-gap":24,"y-gap":16},{default:t(()=>[a(C,null,{default:t(()=>[a(v,{label:"总请求数",value:e(n).service.model.overviewData.totalRequests},{prefix:t(()=>[a(R,{color:"#18a058"},{default:t(()=>[a(e(Ie))]),_:1})]),_:1},8,["value"])]),_:1}),a(C,null,{default:t(()=>[a(v,{label:"成功请求数",value:e(n).service.model.overviewData.successRequests},{prefix:t(()=>[a(R,{color:"#18a058"},{default:t(()=>[a(e(Re))]),_:1})]),_:1},8,["value"])]),_:1}),a(C,null,{default:t(()=>[a(v,{label:"失败请求数",value:e(n).service.model.overviewData.failedRequests},{prefix:t(()=>[a(R,{color:"#d03050"},{default:t(()=>[a(e(He))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(M,{style:{margin:"20px 0"}}),a(N,{cols:3,"x-gap":24},{default:t(()=>[a(C,null,{default:t(()=>[a(v,{label:"平均响应时间",value:e(n).service.model.overviewData.avgResponseTimeMs,suffix:"ms"},{prefix:t(()=>[a(R,{color:"#2080f0"},{default:t(()=>[a(e(re))]),_:1})]),_:1},8,["value"])]),_:1}),a(C,null,{default:t(()=>[a(v,{label:"最小响应时间",value:e(n).service.model.overviewData.minResponseTimeMs,suffix:"ms"},{prefix:t(()=>[a(R,{color:"#52c41a"},{default:t(()=>[a(e(re))]),_:1})]),_:1},8,["value"])]),_:1}),a(C,null,{default:t(()=>[a(v,{label:"最大响应时间",value:e(n).service.model.overviewData.maxResponseTimeMs,suffix:"ms"},{prefix:t(()=>[a(R,{color:"#ff4d4f"},{default:t(()=>[a(e(re))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])]),_:1}),a(N,{cols:2,"x-gap":20,"y-gap":20},{default:t(()=>[a(C,null,{default:t(()=>[a(s,{class:"chart-card",size:"small"},{header:t(()=>[k("div",ta,[a(R,{size:"18",color:"#18a058"},{default:t(()=>[a(e(Ue))]),_:1}),k("span",null,"请求量趋势("+_(e(n).service.model.getTimeGranularityLabel())+")",1)])]),default:t(()=>[k("div",{class:"chart-container",ref_key:"requestTrendChartRef",ref:d},[e(n).service.model.loading.value?(L(),Y("div",aa,[a(c,{size:"large"})])):e(n).service.model.chartData.requestTrend.length?H("",!0):(L(),Y("div",la,[a(o,{description:"暂无数据"})]))],512)]),_:1})]),_:1}),a(C,null,{default:t(()=>[a(s,{class:"chart-card",size:"small"},{header:t(()=>[k("div",sa,[a(R,{size:"18",color:"#2080f0"},{default:t(()=>[a(e(re))]),_:1}),k("span",null,"响应时间趋势("+_(e(n).service.model.getTimeGranularityLabel())+")",1)])]),default:t(()=>[k("div",{class:"chart-container",ref_key:"responseTimeChartRef",ref:u},[e(n).service.model.loading.value?(L(),Y("div",oa,[a(c,{size:"large"})])):e(n).service.model.chartData.responseTimeTrend.length?H("",!0):(L(),Y("div",na,[a(o,{description:"暂无数据"})]))],512)]),_:1})]),_:1}),a(C,null,{default:t(()=>[a(s,{class:"chart-card",size:"small"},{header:t(()=>[k("div",ra,[a(R,{size:"18",color:"#f0a020"},{default:t(()=>[a(e(je))]),_:1}),m[1]||(m[1]=k("span",null,"请求指标分布",-1))])]),default:t(()=>[k("div",{class:"chart-container",ref_key:"requestMetricsChartRef",ref:l},[e(n).service.model.loading.value?(L(),Y("div",ia,[a(c,{size:"large"})])):e(n).service.model.overviewData.totalRequests===0?(L(),Y("div",da,[a(o,{description:"暂无数据"})])):H("",!0)],512)]),_:1})]),_:1}),a(C,null,{default:t(()=>[a(s,{class:"chart-card",size:"small"},{header:t(()=>[k("div",ua,[a(R,{size:"18",color:"#8a2be2"},{default:t(()=>[a(e(Ie))]),_:1}),m[2]||(m[2]=k("span",null,"状态码分布",-1))])]),default:t(()=>[k("div",{class:"chart-container",ref_key:"statusCodeChartRef",ref:p},[e(n).service.model.loading.value?(L(),Y("div",ca,[a(c,{size:"large"})])):e(n).service.model.chartData.statusCodeDistribution.length?H("",!0):(L(),Y("div",fa,[a(o,{description:"暂无数据"})]))],512)]),_:1})]),_:1}),a(C,null,{default:t(()=>[a(s,{class:"chart-card",size:"small"},{header:t(()=>[k("div",ga,[a(R,{size:"18",color:"#d03050"},{default:t(()=>[a(e(Je))]),_:1}),m[3]||(m[3]=k("span",null,"热点路由TOP10",-1))])]),default:t(()=>[k("div",{class:"chart-container",ref_key:"hotRoutesChartRef",ref:y},[e(n).service.model.loading.value?(L(),Y("div",ma,[a(c,{size:"large"})])):e(n).service.model.chartData.hotRoutes.length?H("",!0):(L(),Y("div",pa,[a(o,{description:"暂无数据"})]))],512)]),_:1})]),_:1})]),_:1})])]),_:1})])}}}),ya=U(va,[["__scopeId","data-v-80c7750c"]]),ha=["id"],_a=V({name:"GatewayLogManagement",__name:"GatewayLogManagement",setup(f){const d={model:De()};return(u,l)=>{const p=pe;return L(),Y("div",{class:"gateway-log-management",id:d.model.moduleId},[a(e(Le),{type:"line",placement:"left",class:"management-tabs"},{default:t(()=>[a(p,{name:"logs",tab:"日志查询"},{default:t(()=>[a(e(Ut))]),_:1}),a(p,{name:"monitor",tab:"监控图表"},{default:t(()=>[a(e(ya))]),_:1})]),_:1})],8,ha)}}}),Wa=U(_a,[["__scopeId","data-v-2441ad4e"]]);export{Wa as default};

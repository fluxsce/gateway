import{G as tt,N as Ge}from"./GlobeOutline-D7xlEQYD.js";import{d as Z,a9 as h,ax as Pe,bb as Oe,az as lt,ay as pe,aM as Lt,be as Vt,aA as Ct,r as H,g as q,bs as jt,aB as _t,bw as Jt,aD as Tt,aE as qt,aJ as Wt,b0 as Kt,bt as Je,bh as Xt,aP as Gt,aS as Qt,bx as Zt,aT as wt,by as yt,aN as el,bz as tl,bA as ll,a$ as al,bm as nl,aX as ol,bg as sl,bB as mt,c as X,o as E,a,a3 as rl,bC as kt,m as t,x as z,n as e,aj as G,w as l,I as _,au as il,H as Y,v as O,_ as xe,W as me,t as de,b as Ce,f as ve,O as te,a5 as je,a6 as at,q as Q,Y as St,ae as Qe,T as fe,ar as dl,B as Ye,E as ue,C as B,a7 as Ne,av as Ae,h as Ze,R as it,G as ul,J as dt,A as Te,aw as It,L as Ee,a1 as be,b4 as cl,F as pl,bD as Nt,ah as Xe,bE as fl,ao as gl,ap as Me,a2 as vl}from"./index-BWGkTP3E.js";import{E as et,T as Fe,C as yl,a as ut,A as Pt,P as zt}from"./TrashOutline-m_TMMv8r.js";import{S as Le,_ as Dt,C as ct,a as ml}from"./StopCircleOutline-CS3UACGS.js";import{C as Ie,R as Be,I as nt}from"./RefreshOutline-Cc9mnX-A.js";import{g as hl,a as ge,_ as pt}from"./DataTable-Wmy4yEx3.js";import{_ as we}from"./Table-Ct2LBLzu.js";import{_ as De,b as ke,c as Ue,a as K}from"./Switch-DV7n8EG8.js";import{_ as xl}from"./FormItemGridItem-B0Vyz3vV.js";import{_ as bl}from"./DynamicTags-BRHRNNvN.js";import{C as We,T as Cl}from"./TimeOutline-x-4wXaEw.js";import{_ as qe,C as _l,a as Tl}from"./ChevronUpOutline-JM9cAj1K.js";import{_ as Ve}from"./Alert-BCjH2kFw.js";const wl=Z({name:"ChevronLeft",render(){return h("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h("path",{d:"M10.3536 3.14645C10.5488 3.34171 10.5488 3.65829 10.3536 3.85355L6.20711 8L10.3536 12.1464C10.5488 12.3417 10.5488 12.6583 10.3536 12.8536C10.1583 13.0488 9.84171 13.0488 9.64645 12.8536L5.14645 8.35355C4.95118 8.15829 4.95118 7.84171 5.14645 7.64645L9.64645 3.14645C9.84171 2.95118 10.1583 2.95118 10.3536 3.14645Z",fill:"currentColor"}))}}),kl=Pe("collapse","width: 100%;",[Pe("collapse-item",`
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition:
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 margin: var(--n-item-margin);
 `,[Oe("disabled",[pe("header","cursor: not-allowed;",[pe("header-main",`
 color: var(--n-title-text-color-disabled);
 `),Pe("collapse-item-arrow",`
 color: var(--n-arrow-color-disabled);
 `)])]),Pe("collapse-item","margin-left: 32px;"),lt("&:first-child","margin-top: 0;"),lt("&:first-child >",[pe("header","padding-top: 0;")]),Oe("left-arrow-placement",[pe("header",[Pe("collapse-item-arrow","margin-right: 4px;")])]),Oe("right-arrow-placement",[pe("header",[Pe("collapse-item-arrow","margin-left: 4px;")])]),pe("content-wrapper",[pe("content-inner","padding-top: 16px;"),Vt({duration:"0.15s"})]),Oe("active",[pe("header",[Oe("active",[Pe("collapse-item-arrow","transform: rotate(90deg);")])])]),lt("&:not(:first-child)","border-top: 1px solid var(--n-divider-color);"),Lt("disabled",[Oe("trigger-area-main",[pe("header",[pe("header-main","cursor: pointer;"),Pe("collapse-item-arrow","cursor: default;")])]),Oe("trigger-area-arrow",[pe("header",[Pe("collapse-item-arrow","cursor: pointer;")])]),Oe("trigger-area-extra",[pe("header",[pe("header-extra","cursor: pointer;")])])]),pe("header",`
 font-size: var(--n-title-font-size);
 display: flex;
 flex-wrap: nowrap;
 align-items: center;
 transition: color .3s var(--n-bezier);
 position: relative;
 padding: var(--n-title-padding);
 color: var(--n-title-text-color);
 `,[pe("header-main",`
 display: flex;
 flex-wrap: nowrap;
 align-items: center;
 font-weight: var(--n-title-font-weight);
 transition: color .3s var(--n-bezier);
 flex: 1;
 color: var(--n-title-text-color);
 `),pe("header-extra",`
 display: flex;
 align-items: center;
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 `),Pe("collapse-item-arrow",`
 display: flex;
 transition:
 transform .15s var(--n-bezier),
 color .3s var(--n-bezier);
 font-size: 18px;
 color: var(--n-arrow-color);
 `)])])]),Sl=Object.assign(Object.assign({},_t.props),{defaultExpandedNames:{type:[Array,String],default:null},expandedNames:[Array,String],arrowPlacement:{type:String,default:"left"},accordion:{type:Boolean,default:!1},displayDirective:{type:String,default:"if"},triggerAreas:{type:Array,default:()=>["main","extra","arrow"]},onItemHeaderClick:[Function,Array],"onUpdate:expandedNames":[Function,Array],onUpdateExpandedNames:[Function,Array],onExpandedNamesChange:{type:[Function,Array],validator:()=>!0,default:void 0}}),Ot=Wt("n-collapse"),Il=Z({name:"Collapse",props:Sl,slots:Object,setup(u,{slots:g}){const{mergedClsPrefixRef:i,inlineThemeDisabled:r,mergedRtlRef:x}=Ct(u),v=H(u.defaultExpandedNames),p=q(()=>u.expandedNames),o=jt(p,v),c=_t("Collapse","-collapse",kl,Jt,u,i);function C(F){const{"onUpdate:expandedNames":D,onUpdateExpandedNames:R,onExpandedNamesChange:L}=u;R&&Je(R,F),D&&Je(D,F),L&&Je(L,F),v.value=F}function $(F){const{onItemHeaderClick:D}=u;D&&Je(D,F)}function b(F,D,R){const{accordion:L}=u,{value:k}=o;if(L)F?(C([D]),$({name:D,expanded:!0,event:R})):(C([]),$({name:D,expanded:!1,event:R}));else if(!Array.isArray(k))C([D]),$({name:D,expanded:!0,event:R});else{const y=k.slice(),U=y.findIndex(ee=>D===ee);~U?(y.splice(U,1),C(y),$({name:D,expanded:!1,event:R})):(y.push(D),C(y),$({name:D,expanded:!0,event:R}))}}Kt(Ot,{props:u,mergedClsPrefixRef:i,expandedNamesRef:o,slots:g,toggleItem:b});const T=Tt("Collapse",x,i),V=q(()=>{const{common:{cubicBezierEaseInOut:F},self:{titleFontWeight:D,dividerColor:R,titlePadding:L,titleTextColor:k,titleTextColorDisabled:y,textColor:U,arrowColor:ee,fontSize:M,titleFontSize:m,arrowColorDisabled:N,itemMargin:oe}}=c.value;return{"--n-font-size":M,"--n-bezier":F,"--n-text-color":U,"--n-divider-color":R,"--n-title-padding":L,"--n-title-font-size":m,"--n-title-text-color":k,"--n-title-text-color-disabled":y,"--n-title-font-weight":D,"--n-arrow-color":ee,"--n-arrow-color-disabled":N,"--n-item-margin":oe}}),A=r?qt("collapse",void 0,V,u):void 0;return{rtlEnabled:T,mergedTheme:c,mergedClsPrefix:i,cssVars:r?void 0:V,themeClass:A==null?void 0:A.themeClass,onRender:A==null?void 0:A.onRender}},render(){var u;return(u=this.onRender)===null||u===void 0||u.call(this),h("div",{class:[`${this.mergedClsPrefix}-collapse`,this.rtlEnabled&&`${this.mergedClsPrefix}-collapse--rtl`,this.themeClass],style:this.cssVars},this.$slots)}}),Nl=Z({name:"CollapseItemContent",props:{displayDirective:{type:String,required:!0},show:Boolean,clsPrefix:{type:String,required:!0}},setup(u){return{onceTrue:Zt(wt(u,"show"))}},render(){return h(Xt,null,{default:()=>{const{show:u,displayDirective:g,onceTrue:i,clsPrefix:r}=this,x=g==="show"&&i,v=h("div",{class:`${r}-collapse-item__content-wrapper`},h("div",{class:`${r}-collapse-item__content-inner`},this.$slots));return x?Gt(v,[[Qt,u]]):u?v:null}})}}),Pl={title:String,name:[String,Number],disabled:Boolean,displayDirective:String},zl=Z({name:"CollapseItem",props:Pl,setup(u){const{mergedRtlRef:g}=Ct(u),i=al(),r=nl(()=>{var b;return(b=u.name)!==null&&b!==void 0?b:i}),x=ol(Ot);x||sl("collapse-item","`n-collapse-item` must be placed inside `n-collapse`.");const{expandedNamesRef:v,props:p,mergedClsPrefixRef:o,slots:c}=x,C=q(()=>{const{value:b}=v;if(Array.isArray(b)){const{value:T}=r;return!~b.findIndex(V=>V===T)}else if(b){const{value:T}=r;return T!==b}return!0});return{rtlEnabled:Tt("Collapse",g,o),collapseSlots:c,randomName:i,mergedClsPrefix:o,collapsed:C,triggerAreas:wt(p,"triggerAreas"),mergedDisplayDirective:q(()=>{const{displayDirective:b}=u;return b||p.displayDirective}),arrowPlacement:q(()=>p.arrowPlacement),handleClick(b){let T="main";mt(b,"arrow")&&(T="arrow"),mt(b,"extra")&&(T="extra"),p.triggerAreas.includes(T)&&x&&!u.disabled&&x.toggleItem(C.value,r.value,b)}}},render(){const{collapseSlots:u,$slots:g,arrowPlacement:i,collapsed:r,mergedDisplayDirective:x,mergedClsPrefix:v,disabled:p,triggerAreas:o}=this,c=yt(g.header,{collapsed:r},()=>[this.title]),C=g["header-extra"]||u["header-extra"],$=g.arrow||u.arrow;return h("div",{class:[`${v}-collapse-item`,`${v}-collapse-item--${i}-arrow-placement`,p&&`${v}-collapse-item--disabled`,!r&&`${v}-collapse-item--active`,o.map(b=>`${v}-collapse-item--trigger-area-${b}`)]},h("div",{class:[`${v}-collapse-item__header`,!r&&`${v}-collapse-item__header--active`]},h("div",{class:`${v}-collapse-item__header-main`,onClick:this.handleClick},i==="right"&&c,h("div",{class:`${v}-collapse-item-arrow`,key:this.rtlEnabled?0:1,"data-arrow":!0},yt($,{collapsed:r},()=>[h(el,{clsPrefix:v},{default:()=>this.rtlEnabled?h(wl,null):h(tl,null)})])),i==="left"&&c),ll(C,{collapsed:r},b=>h("div",{class:`${v}-collapse-item__header-extra`,onClick:this.handleClick,"data-extra":!0},b))),h(Nl,{clsPrefix:v,displayDirective:x,show:!r},g))}}),Dl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ol=Z({name:"CheckmarkOutline",render:function(g,i){return E(),X("svg",Dl,i[0]||(i[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M416 128L192 384l-96-96"},null,-1)]))}}),Ul={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},El=Z({name:"CodeOutline",render:function(g,i){return E(),X("svg",Ul,i[0]||(i[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M160 368L32 256l128-112"},null,-1),a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M352 368l128-112l-128-112"},null,-1)]))}}),$l={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ut=Z({name:"CopyOutline",render:function(g,i){return E(),X("svg",$l,i[0]||(i[0]=[a("rect",{x:"128",y:"128",width:"336",height:"336",rx:"57",ry:"57",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M383.5 128l.5-24a56.16 56.16 0 0 0-56-56H112a64.19 64.19 0 0 0-64 64v216a56.16 56.16 0 0 0 56 56h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Rl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Hl=Z({name:"EllipseOutline",render:function(g,i){return E(),X("svg",Rl,i[0]||(i[0]=[a("circle",{cx:"256",cy:"256",r:"192",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Fl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ml=Z({name:"HeartOutline",render:function(g,i){return E(),X("svg",Fl,i[0]||(i[0]=[a("path",{d:"M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81c-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0 0 18 0c96.26-65.34 184.09-143.09 183-252.42c-.54-52.67-42.32-96.81-95.08-96.81z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Al={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ot=Z({name:"LayersOutline",render:function(g,i){return E(),X("svg",Al,i[0]||(i[0]=[a("path",{d:"M434.8 137.65l-149.36-68.1c-16.19-7.4-42.69-7.4-58.88 0L77.3 137.65c-17.6 8-17.6 21.09 0 29.09l148 67.5c16.89 7.7 44.69 7.7 61.58 0l148-67.5c17.52-8 17.52-21.1-.08-29.09z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M160 308.52l-82.7 37.11c-17.6 8-17.6 21.1 0 29.1l148 67.5c16.89 7.69 44.69 7.69 61.58 0l148-67.5c17.6-8 17.6-21.1 0-29.1l-79.94-38.47",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M160 204.48l-82.8 37.16c-17.6 8-17.6 21.1 0 29.1l148 67.49c16.89 7.7 44.69 7.7 61.58 0l148-67.49c17.7-8 17.7-21.1.1-29.1L352 204.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Bl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Et=Z({name:"LinkOutline",render:function(g,i){return E(),X("svg",Bl,i[0]||(i[0]=[a("path",{d:"M208 352h-64a96 96 0 0 1 0-192h64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),a("path",{d:"M304 160h64a96 96 0 0 1 0 192h-64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36",d:"M163.29 256h187.42"},null,-1)]))}}),Yl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ht=Z({name:"SpeedometerOutline",render:function(g,i){return E(),X("svg",Yl,i[0]||(i[0]=[rl('<path d="M326.1 231.9l-47.5 75.5a31 31 0 0 1-7 7a30.11 30.11 0 0 1-35-49l75.5-47.5a10.23 10.23 0 0 1 11.7 0a10.06 10.06 0 0 1 2.3 14z" fill="currentColor"></path><path d="M256 64C132.3 64 32 164.2 32 287.9a223.18 223.18 0 0 0 56.3 148.5c1.1 1.2 2.1 2.4 3.2 3.5a25.19 25.19 0 0 0 37.1-.1a173.13 173.13 0 0 1 254.8 0a25.19 25.19 0 0 0 37.1.1l3.2-3.5A223.18 223.18 0 0 0 480 287.9C480 164.2 379.7 64 256 64z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 128v32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M416 288h-32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M128 288H96"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M165.49 197.49l-22.63-22.63"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M346.51 197.49l22.63-22.63"></path>',7)]))}}),Ll={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},xt=Z({name:"WarningOutline",render:function(g,i){return E(),X("svg",Ll,i[0]||(i[0]=[a("path",{d:"M85.57 446.25h340.86a32 32 0 0 0 28.17-47.17L284.18 82.58c-12.09-22.44-44.27-22.44-56.36 0L57.4 399.08a32 32 0 0 0 28.17 47.17z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M250.26 195.39l5.74 122l5.73-121.95a5.74 5.74 0 0 0-5.79-6h0a5.74 5.74 0 0 0-5.68 5.95z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M256 397.25a20 20 0 1 1 20-20a20 20 0 0 1-20 20z",fill:"currentColor"},null,-1)]))}});var ce=(u=>(u.HTTP="http",u.WEBSOCKET="websocket",u.TCP="tcp",u.UDP="udp",u))(ce||{}),Se=(u=>(u[u.STATIC=0]="STATIC",u[u.DISCOVERY=1]="DISCOVERY",u))(Se||{}),ae=(u=>(u.ROUND_ROBIN="round-robin",u.RANDOM="random",u.IP_HASH="ip-hash",u.LEAST_CONN="least-conn",u.WEIGHTED_ROUND_ROBIN="weighted-round-robin",u.CONSISTENT_HASH="consistent-hash",u))(ae||{}),Ke=(u=>(u.CONSUL="CONSUL",u.EUREKA="EUREKA",u.NACOS="NACOS",u))(Ke||{}),he=(u=>(u[u.OFFLINE=0]="OFFLINE",u[u.ONLINE=1]="ONLINE",u[u.MAINTENANCE=2]="MAINTENANCE",u))(he||{});function $t(){function u(x){return x&&{[ce.HTTP]:"HTTP",[ce.WEBSOCKET]:"WebSocket",[ce.TCP]:"TCP",[ce.UDP]:"UDP"}[x]||"未知"}function g(x){return x?{[ce.HTTP]:tt,[ce.WEBSOCKET]:kt,[ce.TCP]:ot,[ce.UDP]:ot}[x]||tt:tt}function i(x){return x&&{[ce.HTTP]:"#2080f0",[ce.WEBSOCKET]:"#f0a020",[ce.TCP]:"#8a2be2",[ce.UDP]:"#d03050"}[x]||"#d0d0d0"}function r(x){return x&&{[ce.HTTP]:"info",[ce.WEBSOCKET]:"warning",[ce.TCP]:"success",[ce.UDP]:"error"}[x]||"default"}return{getProxyTypeName:u,getProxyTypeIcon:g,getProxyTypeIconColor:i,getProxyTypeTagType:r}}const Vl={class:"proxy-header"},jl={class:"proxy-title"},Jl={class:"proxy-title-content"},ql={class:"proxy-name-container"},Wl={class:"proxy-name"},Kl={class:"proxy-actions"},Xl=Z({__name:"ProxyDetailHeader",props:{proxyConfig:{}},emits:["edit","delete","toggleStatus"],setup(u,{emit:g}){const i=u,r=g,{getProxyTypeName:x,getProxyTypeTagType:v}=$t();function p(){r("edit",i.proxyConfig)}function o(){r("delete",i.proxyConfig.proxyConfigId)}function c(){r("toggleStatus",i.proxyConfig)}return(C,$)=>(E(),X("div",Vl,[a("div",jl,[a("div",Jl,[a("div",ql,[a("span",Wl,z(C.proxyConfig.proxyName),1),t(e(G),{type:e(v)(C.proxyConfig.proxyType),size:"small"},{default:l(()=>[_(z(e(x)(C.proxyConfig.proxyType)),1)]),_:1},8,["type"]),t(e(G),{type:C.proxyConfig.activeFlag==="Y"?"success":"error",size:"small"},{default:l(()=>[_(z(C.proxyConfig.activeFlag==="Y"?"已启用":"已禁用"),1)]),_:1},8,["type"])])])]),a("div",Kl,[t(e(il),null,{default:l(()=>[t(e(Y),{onClick:p,secondary:""},{icon:l(()=>[t(e(O),{component:e(et)},null,8,["component"])]),default:l(()=>[$[0]||($[0]=_(" 编辑 "))]),_:1}),t(e(Y),{onClick:c,type:C.proxyConfig.activeFlag==="Y"?"warning":"success"},{icon:l(()=>[t(e(O),{component:C.proxyConfig.activeFlag==="Y"?e(Le):e(Ie)},null,8,["component"])]),default:l(()=>[_(" "+z(C.proxyConfig.activeFlag==="Y"?"禁用":"启用"),1)]),_:1},8,["type"]),t(e(Ge),{onPositiveClick:o},{trigger:l(()=>[t(e(Y),{type:"error"},{icon:l(()=>[t(e(O),{component:e(Fe)},null,8,["component"])]),default:l(()=>[$[1]||($[1]=_(" 删除 "))]),_:1})]),default:l(()=>[$[2]||($[2]=_(" 确定要删除此代理配置吗？ "))]),_:1})]),_:1})])]))}}),Gl=xe(Xl,[["__scopeId","data-v-4e679762"]]),Ql={class:"proxy-basic-info"},Zl={key:0},ea={colspan:"3",class:"note-cell"},ta=Z({__name:"ProxyBasicInfo",props:{proxyConfig:{}},setup(u){return(g,i)=>(E(),X("div",Ql,[t(e(me),{"title-placement":"left"},{default:l(()=>i[0]||(i[0]=[_("基本信息")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[i[1]||(i[1]=a("td",{class:"table-label"},"代理ID",-1)),a("td",null,[t(e(hl),null,{default:l(()=>[_(z(g.proxyConfig.proxyConfigId),1)]),_:1})]),i[2]||(i[2]=a("td",{class:"table-label"},"优先级",-1)),a("td",null,z(g.proxyConfig.configPriority||0),1)]),a("tr",null,[i[3]||(i[3]=a("td",{class:"table-label"},"创建时间",-1)),a("td",null,z(g.proxyConfig.addTime?new Date(g.proxyConfig.addTime).toLocaleString():"-"),1),i[4]||(i[4]=a("td",{class:"table-label"},"最后修改",-1)),a("td",null,z(g.proxyConfig.editTime?new Date(g.proxyConfig.editTime).toLocaleString():"-"),1)]),g.proxyConfig.noteText?(E(),X("tr",Zl,[i[5]||(i[5]=a("td",{class:"table-label"},"备注",-1)),a("td",ea,z(g.proxyConfig.noteText),1)])):de("",!0)])]),_:1})]))}}),la=xe(ta,[["__scopeId","data-v-9e91ac86"]]),aa={class:"http-proxy-config"},na={class:"config-section"},oa={class:"config-section"},sa={class:"config-section"},ra={class:"config-section"},ia={key:0,class:"config-section"},da={key:0},ua={colspan:"3"},ca={class:"header-list"},pa={key:1},fa={colspan:"3"},ga={class:"header-list"},va={key:2},ya={colspan:"3"},ma={class:"header-list"},ha={class:"config-section"},xa={key:1,class:"config-section"},ba=Z({__name:"HttpProxyConfig",props:{proxyConfig:{}},setup(u){const g=u,i=Ce(),r=ve({timeout:30,followRedirects:!0,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3"}),x=q(()=>r.setHeaders&&Object.keys(r.setHeaders).length>0||r.passHeaders&&r.passHeaders.length>0||r.hideHeaders&&r.hideHeaders.length>0),v=q(()=>r.tlsInsecureSkipVerify!==void 0||r.tlsServerName||r.tlsMinVersion||r.tlsMaxVersion);function p(o){try{const c=typeof o=="string"?JSON.parse(o):o;Object.assign(r,{timeout:30,followRedirects:!0,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3"}),c&&Object.assign(r,c)}catch(c){i.error("解析HTTP代理配置失败"),console.error("解析HTTP代理配置失败:",c)}}return te(()=>g.proxyConfig,o=>{o&&p(o)},{immediate:!0}),(o,c)=>(E(),X("div",aa,[t(e(me),{"title-placement":"left"},{default:l(()=>c[0]||(c[0]=[_("HTTP代理配置")])),_:1}),a("div",na,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[1]||(c[1]=[_("超时配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[c[2]||(c[2]=a("td",{class:"table-label"},"超时时间",-1)),a("td",null,z(r.timeout||"-")+"秒",1),c[3]||(c[3]=a("td",{class:"table-label"},"发送超时",-1)),a("td",null,z(r.sendTimeout||"-")+"秒",1)]),a("tr",null,[c[4]||(c[4]=a("td",{class:"table-label"},"读取超时",-1)),a("td",null,z(r.readTimeout||"-")+"秒",1),c[5]||(c[5]=a("td",{class:"table-label"},"连接超时",-1)),a("td",null,z(r.connectTimeout||"-")+"秒",1)]),a("tr",null,[c[6]||(c[6]=a("td",{class:"table-label"},"空闲连接超时",-1)),a("td",null,z(r.idleConnTimeout||"-")+"秒",1),c[7]||(c[7]=a("td",{class:"table-label"},"重试超时",-1)),a("td",null,z(r.retryTimeout||"-")+"秒",1)])])]),_:1})]),a("div",oa,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[8]||(c[8]=[_("连接配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[c[9]||(c[9]=a("td",{class:"table-label"},"最大空闲连接数",-1)),a("td",null,z(r.maxIdleConns!==void 0?r.maxIdleConns:"-"),1),c[10]||(c[10]=a("td",{class:"table-label"},"HTTP版本",-1)),a("td",null,z(r.httpVersion||"-"),1)]),a("tr",null,[c[11]||(c[11]=a("td",{class:"table-label"},"跟随重定向",-1)),a("td",null,[t(e(G),{type:r.followRedirects?"success":"default",size:"small"},{default:l(()=>[_(z(r.followRedirects?"是":"否"),1)]),_:1},8,["type"])]),c[12]||(c[12]=a("td",{class:"table-label"},"保持连接",-1)),a("td",null,[t(e(G),{type:r.keepAlive?"success":"default",size:"small"},{default:l(()=>[_(z(r.keepAlive?"是":"否"),1)]),_:1},8,["type"])])])])]),_:1})]),a("div",sa,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[13]||(c[13]=[_("响应处理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[c[14]||(c[14]=a("td",{class:"table-label"},"缓冲区大小",-1)),a("td",null,z(r.bufferSize||"-")+"字节",1),c[15]||(c[15]=a("td",{class:"table-label"},"最大缓冲区大小",-1)),a("td",null,z(r.maxBufferSize||"-")+"字节",1)]),a("tr",null,[c[16]||(c[16]=a("td",{class:"table-label"},"复制响应体",-1)),a("td",null,[t(e(G),{type:r.copyResponseBody?"success":"default",size:"small"},{default:l(()=>[_(z(r.copyResponseBody?"是":"否"),1)]),_:1},8,["type"])]),c[17]||(c[17]=a("td",{class:"table-label"},"代理缓冲",-1)),a("td",null,[t(e(G),{type:r.proxyBuffering?"success":"default",size:"small"},{default:l(()=>[_(z(r.proxyBuffering?"是":"否"),1)]),_:1},8,["type"])])])])]),_:1})]),a("div",ra,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[18]||(c[18]=[_("重试配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[c[19]||(c[19]=a("td",{class:"table-label"},"重试次数",-1)),a("td",null,z(r.retryCount!==void 0?r.retryCount:"-"),1),c[20]||(c[20]=a("td",{class:"table-label"},null,-1)),c[21]||(c[21]=a("td",null,null,-1))])])]),_:1})]),x.value?(E(),X("div",ia,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[22]||(c[22]=[_("头部配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[r.setHeaders&&Object.keys(r.setHeaders).length>0?(E(),X("tr",da,[c[23]||(c[23]=a("td",{class:"table-label"},"设置头部",-1)),a("td",ua,[a("div",ca,[(E(!0),X(je,null,at(r.setHeaders,(C,$)=>(E(),Q(e(G),{key:$,size:"small",class:"header-tag"},{default:l(()=>[_(z($)+": "+z(C),1)]),_:2},1024))),128))])])])):de("",!0),r.passHeaders&&r.passHeaders.length>0?(E(),X("tr",pa,[c[24]||(c[24]=a("td",{class:"table-label"},"允许传递的头部",-1)),a("td",fa,[a("div",ga,[(E(!0),X(je,null,at(r.passHeaders,C=>(E(),Q(e(G),{key:C,size:"small",type:"info",class:"header-tag"},{default:l(()=>[_(z(C),1)]),_:2},1024))),128))])])])):de("",!0),r.hideHeaders&&r.hideHeaders.length>0?(E(),X("tr",va,[c[25]||(c[25]=a("td",{class:"table-label"},"隐藏的头部",-1)),a("td",ya,[a("div",ma,[(E(!0),X(je,null,at(r.hideHeaders,C=>(E(),Q(e(G),{key:C,size:"small",type:"warning",class:"header-tag"},{default:l(()=>[_(z(C),1)]),_:2},1024))),128))])])])):de("",!0)])]),_:1})])):de("",!0),a("div",ha,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[26]||(c[26]=[_("高级选项")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[c[27]||(c[27]=a("td",{class:"table-label"},"保留原始Host头部",-1)),a("td",null,[t(e(G),{type:r.preserveHost?"success":"default",size:"small"},{default:l(()=>[_(z(r.preserveHost?"是":"否"),1)]),_:1},8,["type"])]),c[28]||(c[28]=a("td",{class:"table-label"},"添加X-Forwarded-For",-1)),a("td",null,[t(e(G),{type:r.addXForwardedFor?"success":"default",size:"small"},{default:l(()=>[_(z(r.addXForwardedFor?"是":"否"),1)]),_:1},8,["type"])])]),a("tr",null,[c[29]||(c[29]=a("td",{class:"table-label"},"添加X-Real-IP",-1)),a("td",null,[t(e(G),{type:r.addXRealIP?"success":"default",size:"small"},{default:l(()=>[_(z(r.addXRealIP?"是":"否"),1)]),_:1},8,["type"])]),c[30]||(c[30]=a("td",{class:"table-label"},"添加X-Forwarded-Proto",-1)),a("td",null,[t(e(G),{type:r.addXForwardedProto?"success":"default",size:"small"},{default:l(()=>[_(z(r.addXForwardedProto?"是":"否"),1)]),_:1},8,["type"])])])])]),_:1})]),v.value?(E(),X("div",xa,[t(e(me),{"title-placement":"left",class:"section-title"},{default:l(()=>c[31]||(c[31]=[_("TLS配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[c[32]||(c[32]=a("td",{class:"table-label"},"跳过TLS证书验证",-1)),a("td",null,[t(e(G),{type:r.tlsInsecureSkipVerify?"warning":"success",size:"small"},{default:l(()=>[_(z(r.tlsInsecureSkipVerify?"是":"否"),1)]),_:1},8,["type"])]),c[33]||(c[33]=a("td",{class:"table-label"},"TLS服务器名称",-1)),a("td",null,z(r.tlsServerName||"-"),1)]),a("tr",null,[c[34]||(c[34]=a("td",{class:"table-label"},"最小TLS版本",-1)),a("td",null,z(r.tlsMinVersion||"-"),1),c[35]||(c[35]=a("td",{class:"table-label"},"最大TLS版本",-1)),a("td",null,z(r.tlsMaxVersion||"-"),1)])])]),_:1})])):de("",!0)]))}}),Ca=xe(ba,[["__scopeId","data-v-d2351c34"]]),_a={class:"websocket-proxy-config"},Ta=Z({__name:"WebSocketProxyConfig",props:{proxyConfig:{}},setup(u){const g=u,i=Ce(),r=ve({pingInterval:30,pongTimeout:10,maxMessageSize:32768,enableCompression:!1});function x(v){try{const p=typeof v=="string"?JSON.parse(v):v;Object.assign(r,p)}catch{i.error("解析WebSocket代理配置失败")}}return te(()=>g.proxyConfig,v=>{v&&x(v)},{immediate:!0}),(v,p)=>(E(),X("div",_a,[t(e(me),{"title-placement":"left"},{default:l(()=>p[0]||(p[0]=[_("WebSocket代理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[p[1]||(p[1]=a("td",{class:"table-label"},"Ping间隔",-1)),a("td",null,z(r.pingInterval||"-")+"秒",1),p[2]||(p[2]=a("td",{class:"table-label"},"Pong超时",-1)),a("td",null,z(r.pongTimeout||"-")+"秒",1)]),a("tr",null,[p[3]||(p[3]=a("td",{class:"table-label"},"最大消息大小",-1)),a("td",null,z(r.maxMessageSize!==void 0?r.maxMessageSize:"-")+"字节",1),p[4]||(p[4]=a("td",{class:"table-label"},"启用压缩",-1)),a("td",null,[t(e(G),{type:r.enableCompression?"success":"default",size:"small"},{default:l(()=>[_(z(r.enableCompression?"是":"否"),1)]),_:1},8,["type"])])]),a("tr",null,[p[5]||(p[5]=a("td",{class:"table-label"},"心跳检测",-1)),a("td",null,[t(e(G),{type:r.pingInterval>0?"success":"default",size:"small"},{default:l(()=>[_(z(r.pingInterval>0?"启用":"禁用"),1)]),_:1},8,["type"])]),p[6]||(p[6]=a("td",{class:"table-label"},"-",-1)),p[7]||(p[7]=a("td",null,"-",-1))])])]),_:1})]))}}),wa=xe(Ta,[["__scopeId","data-v-9af94ff4"]]),ka={class:"tcp-proxy-config"},Sa=Z({__name:"TcpProxyConfig",props:{proxyConfig:{}},setup(u){const g=u,i=Ce(),r=ve({connectTimeout:5,keepAlive:!0});function x(v){try{const p=typeof v=="string"?JSON.parse(v):v;Object.assign(r,p)}catch{i.error("解析TCP代理配置失败")}}return te(()=>g.proxyConfig,v=>{v&&x(v)},{immediate:!0}),(v,p)=>(E(),X("div",ka,[t(e(me),{"title-placement":"left"},{default:l(()=>p[0]||(p[0]=[_("TCP代理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[p[1]||(p[1]=a("td",{class:"table-label"},"连接超时",-1)),a("td",null,z(r.connectTimeout||"-")+"秒",1),p[2]||(p[2]=a("td",{class:"table-label"},"保持连接",-1)),a("td",null,[t(e(G),{type:r.keepAlive?"success":"default",size:"small"},{default:l(()=>[_(z(r.keepAlive?"是":"否"),1)]),_:1},8,["type"])])]),a("tr",null,[p[3]||(p[3]=a("td",{class:"table-label"},"连接状态",-1)),a("td",null,[t(e(G),{type:r.connectTimeout>0?"success":"warning",size:"small"},{default:l(()=>[_(z(r.connectTimeout>0?"正常":"异常"),1)]),_:1},8,["type"])]),p[4]||(p[4]=a("td",{class:"table-label"},"-",-1)),p[5]||(p[5]=a("td",null,"-",-1))])])]),_:1})]))}}),Ia=xe(Sa,[["__scopeId","data-v-4e77dd2b"]]),Na={class:"udp-proxy-config"},Pa=Z({__name:"UdpProxyConfig",props:{proxyConfig:{}},setup(u){const g=u,i=Ce(),r=ve({bufferSize:4096});function x(v){try{const p=typeof v=="string"?JSON.parse(v):v;Object.assign(r,p)}catch{i.error("解析UDP代理配置失败")}}return te(()=>g.proxyConfig,v=>{v&&x(v)},{immediate:!0}),(v,p)=>(E(),X("div",Na,[t(e(me),{"title-placement":"left"},{default:l(()=>p[0]||(p[0]=[_("UDP代理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[p[1]||(p[1]=a("td",{class:"table-label"},"缓冲区大小",-1)),a("td",null,z(r.bufferSize!==void 0?r.bufferSize:"-")+"字节",1),p[2]||(p[2]=a("td",{class:"table-label"},"缓冲区状态",-1)),a("td",null,[t(e(G),{type:r.bufferSize>0?"success":"warning",size:"small"},{default:l(()=>[_(z(r.bufferSize>0?"正常":"异常"),1)]),_:1},8,["type"])])]),a("tr",null,[p[4]||(p[4]=a("td",{class:"table-label"},"数据包处理",-1)),a("td",null,[t(e(G),{type:"info",size:"small"},{default:l(()=>p[3]||(p[3]=[_(" 无连接协议 ")])),_:1})]),p[5]||(p[5]=a("td",{class:"table-label"},"-",-1)),p[6]||(p[6]=a("td",null,"-",-1))])])]),_:1})]))}}),za=xe(Pa,[["__scopeId","data-v-b048e1c2"]]),ye=St("/gateway/hub0022"),Da=St("/gateway/hub0020");async function Oa(u){return Da.post("/queryGatewayInstances",u)}async function Rt(u){return ye.post("/getProxyConfigsByInstance",u)}async function Ua(u){return ye.post("/addProxyConfig",u)}async function Ht(u){return ye.post("/editProxyConfig",u)}async function Ea(u,g){return ye.post("/deleteProxyConfig",{proxyConfigId:u,tenantId:g})}async function $a(u){return ye.post("/testProxyConnection",u)}async function Ra(u){return ye.post("/queryServiceDefinitions",u)}async function Ha(u){return ye.post("/addServiceDefinition",u)}async function st(u){return ye.post("/editServiceDefinition",u)}async function bt(u,g){return ye.post("/deleteServiceDefinition",{serviceDefinitionId:u,tenantId:g})}async function Fa(u){return ye.post("/queryServiceNodes",u)}async function Ma(u){return ye.post("/addServiceNode",u)}async function rt(u){return ye.post("/editServiceNode",u)}async function Aa(u,g){return ye.post("/deleteServiceNode",{serviceNodeId:u,tenantId:g})}async function Ba(u){const g=u.tenantId||"default";return ye.post("/updateServiceNodeStatus",{...u,tenantId:g})}async function Ya(u){return ye.post("/batchDeleteServiceNodes",{serviceNodeIds:u,tenantId:"default"})}const La={class:"modal-header"},Va={class:"header-content"},ja={class:"modal-title"},Ja={class:"modal-content"},qa={class:"form-section"},Wa={class:"form-section"},Ka={class:"config-group"},Xa={class:"config-group"},Ga={class:"config-group"},Qa={class:"config-group"},Za={class:"config-group"},en={style:{display:"flex","align-items":"center",width:"100%",gap:"16px"}},tn={class:"config-group"},ln={class:"config-group"},an={key:1,class:"config-group"},nn={key:2,class:"config-group"},on={key:3,class:"config-group"},sn={class:"form-section"},rn={class:"modal-footer"},dn=Z({__name:"ProxyConfigDialog",props:{show:{type:Boolean,default:!1},formData:{default:()=>({})},mode:{default:"add"}},emits:["update:show","refresh"],setup(u,{emit:g}){const i=u,r=g,x=Ce(),v=H(null),p=H(i.show),o=H(!1),c=[{label:"HTTP",value:"http"},{label:"WebSocket",value:"websocket"},{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],C=[{label:"HTTP/1.0",value:"1.0"},{label:"HTTP/1.1",value:"1.1"}],$=[{label:"TLS 1.0",value:"1.0"},{label:"TLS 1.1",value:"1.1"},{label:"TLS 1.2",value:"1.2"},{label:"TLS 1.3",value:"1.3"}],b=ve({gatewayInstanceId:"",proxyName:"",proxyType:"http",configPriority:0,proxyConfig:{},activeFlag:"Y",noteText:""}),T=ve({timeout:30,followRedirects:!1,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3",setHeaders:{},passHeaders:[],hideHeaders:[]}),V=H([]);te(V,d=>{const n={};d.forEach(j=>{j.key&&j.value&&(n[j.key]=j.value)}),T.setHeaders=n},{deep:!0});function A(d){d&&typeof d=="object"?V.value=Object.entries(d).map(([n,j])=>({key:n,value:j})):V.value=[]}const F=ve({pingInterval:30,pongTimeout:10,maxMessageSize:32768,enableCompression:!1}),D=ve({connectTimeout:5,keepAlive:!0}),R=ve({bufferSize:4096}),L=q({get:()=>b.activeFlag==="Y",set:d=>{b.activeFlag=d?"Y":"N"}}),k=H("{}");te(k,d=>{try{b.customConfig=JSON.parse(d)}catch(n){console.warn("JSON解析错误:",n)}});function y(d){if(d&&typeof d=="object")try{k.value=JSON.stringify(d,null,2)}catch(n){console.warn("JSON序列化错误:",n),k.value="{}"}else k.value="{}"}const U={proxyName:[{required:!0,message:"请输入代理名称",trigger:["blur","input"]},{max:50,message:"代理名称不能超过50个字符",trigger:["blur","input"]}],proxyType:[{required:!0,message:"请选择代理类型",trigger:["blur","change"]}],configPriority:[{required:!0,message:"请输入优先级",trigger:["blur","change"],validator:(d,n)=>{if(n==null||n==="")return new Error("请输入优先级");const j=Number(n);return isNaN(j)?new Error("优先级必须是数字"):j<0||j>999?new Error("优先级必须是0-999之间的数字"):!0}}],"proxyConfig.timeout":[{required:!0,message:"请输入超时时间",trigger:["blur","change"],type:"number",validator:(d,n)=>n==null?new Error("请输入超时时间"):n<1?new Error("超时时间必须大于0秒"):n>3600?new Error("超时时间不能超过3600秒"):!0}],"proxyConfig.idleConnTimeout":[{required:!0,message:"请输入空闲连接超时时间",trigger:["blur","change"],type:"number",validator:(d,n)=>n==null?new Error("请输入空闲连接超时时间"):n<1?new Error("空闲连接超时时间必须大于0秒"):n>7200?new Error("空闲连接超时时间不能超过7200秒"):!0}],"proxyConfig.retryTimeout":[{required:!0,message:"请输入重试超时时间",trigger:["blur","change"],type:"number",validator:(d,n)=>n==null?new Error("请输入重试超时时间"):n<1?new Error("重试超时时间必须大于0秒"):n>300?new Error("重试超时时间不能超过300秒"):!0}]};te(()=>i.show,d=>{var n,j,ne,se,ze,W,$e,re,ie;p.value=d,d&&(Object.assign(b,{gatewayInstanceId:((n=i.formData)==null?void 0:n.gatewayInstanceId)||"",proxyName:((j=i.formData)==null?void 0:j.proxyName)||"",proxyType:((ne=i.formData)==null?void 0:ne.proxyType)||"http",configPriority:((se=i.formData)==null?void 0:se.configPriority)!==void 0?Number(i.formData.configPriority):0,activeFlag:((ze=i.formData)==null?void 0:ze.activeFlag)||"Y",noteText:((W=i.formData)==null?void 0:W.noteText)||"",proxyConfigId:($e=i.formData)==null?void 0:$e.proxyConfigId,customConfig:N((re=i.formData)==null?void 0:re.customConfig)}),y(b.customConfig),A(),(ie=i.formData)!=null&&ie.proxyConfig&&m(i.formData.proxyConfig))}),te(p,d=>{r("update:show",d)}),te(()=>b.proxyType,()=>{b.proxyConfig=le()},{immediate:!0}),te([T,F,D,R],()=>{b.proxyConfig=le()},{deep:!0});function ee(d){if(typeof d=="number")return d;if(typeof d=="string"){const n=d.replace(/[smhd]$/,""),j=parseFloat(n);return isNaN(j)?void 0:j}}function M(d){const n={...d};return["timeout","sendTimeout","readTimeout","connectTimeout","idleConnTimeout","retryTimeout"].forEach(ne=>{if(n[ne]!==void 0){const se=ee(n[ne]);se!==void 0&&(n[ne]=se)}}),n}function m(d){try{const n=typeof d=="string"?JSON.parse(d):d;switch(b.proxyType){case"http":const j=M(n);Object.assign(T,{timeout:30,followRedirects:!1,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3",setHeaders:{},passHeaders:[],hideHeaders:[]},j),A(j.setHeaders);break;case"websocket":Object.assign(F,n);break;case"tcp":const ne={...n};if(ne.connectTimeout!==void 0){const se=ee(ne.connectTimeout);se!==void 0&&(ne.connectTimeout=se)}Object.assign(D,ne);break;case"udp":Object.assign(R,n);break}}catch(n){x.error("解析代理配置失败"),console.error("配置解析错误:",n)}}function N(d){if(!d)return{};try{return typeof d=="string"?JSON.parse(d):d}catch{return{}}}function oe(d){b.proxyType=d}function le(){switch(b.proxyType){case"http":return T;case"websocket":return F;case"tcp":return D;case"udp":return R;default:return{}}}function J(){return{key:"",value:""}}function S(d,n,j){V.value[d]&&(V.value[d][n]=j)}function I(){p.value=!1}async function s(){var d;try{try{await((d=v.value)==null?void 0:d.validate())}catch{return}o.value=!0;const n={...b,proxyConfig:JSON.stringify(le()),customConfig:b.customConfig?JSON.stringify(b.customConfig):"{}",tenantId:"default"};i.mode==="add"?(await Ua(n),x.success("创建代理配置成功")):(await Ht({...n,proxyConfigId:i.formData.proxyConfigId||""}),x.success("更新代理配置成功")),I(),r("refresh")}catch(n){x.error(n.message||"操作失败")}finally{o.value=!1}}function f(){try{JSON.parse(k.value),x.success("JSON格式有效")}catch(d){console.error("JSON验证错误:",d),x.error(`JSON格式无效: ${d.message}`)}}function P(){try{const d=JSON.parse(k.value);k.value=JSON.stringify(d,null,2),x.success("JSON格式化成功")}catch(d){console.error("JSON解析错误:",d),x.error("JSON格式错误，无法格式化")}}return(d,n)=>{const j=O,ne=Y,se=me,ze=ue,W=xl,$e=ge,re=De,ie=ke,_e=Ue,Re=B,Ft=Dt,ft=bl,gt=Ne,Mt=Ye,At=dl,Bt=fe,Yt=Qe;return E(),Q(Yt,{show:p.value,"onUpdate:show":n[39]||(n[39]=w=>p.value=w),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(Bt,{style:{width:"1000px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true",class:"proxy-modal"},{header:l(()=>[a("div",La,[t(j,{size:"24",class:"modal-icon"},{default:l(()=>[t(e(Ae))]),_:1}),a("div",Va,[a("h3",ja,z(d.mode==="add"?"新建代理配置":"编辑代理配置"),1),n[40]||(n[40]=a("p",{class:"modal-subtitle"},"配置代理服务的基本信息、类型和参数",-1))])])]),"header-extra":l(()=>[t(ne,{quaternary:"",circle:"",onClick:I,class:"close-btn"},{icon:l(()=>[t(j,{size:"18"},{default:l(()=>[t(e(yl))]),_:1})]),_:1})]),footer:l(()=>[a("div",rn,[t(gt,{justify:"end"},{default:l(()=>[t(ne,{onClick:I,size:"medium"},{default:l(()=>n[56]||(n[56]=[_("取消")])),_:1}),t(ne,{type:"primary",loading:o.value,onClick:s,size:"medium"},{default:l(()=>[_(z(d.mode==="add"?"创建":"更新"),1)]),_:1},8,["loading"])]),_:1})])]),default:l(()=>[t(At,{style:{"max-height":"75vh"},trigger:"hover","x-scrollable":!1},{default:l(()=>[a("div",Ja,[t(Mt,{ref_key:"formRef",ref:v,model:b,rules:U,"label-placement":"left","label-width":"150px","require-mark-placement":"right-hanging",class:"proxy-form"},{default:l(()=>[a("div",qa,[t(se,{"title-placement":"left",class:"section-divider"},{default:l(()=>n[41]||(n[41]=[_("基本信息")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"代理名称",path:"proxyName"},{default:l(()=>[t(ze,{value:b.proxyName,"onUpdate:value":n[0]||(n[0]=w=>b.proxyName=w),placeholder:"请输入代理名称",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"代理类型",path:"proxyType"},{default:l(()=>[t($e,{value:b.proxyType,"onUpdate:value":[n[1]||(n[1]=w=>b.proxyType=w),oe],options:c,placeholder:"请选择代理类型"},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"优先级",path:"configPriority"},{default:l(()=>[t(ie,{value:b.configPriority,"onUpdate:value":n[2]||(n[2]=w=>b.configPriority=w),placeholder:"请输入优先级",min:0,max:999,precision:0,clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"状态",path:"activeFlag"},{default:l(()=>[t(_e,{value:L.value,"onUpdate:value":n[3]||(n[3]=w=>L.value=w),"checked-value":!0,"unchecked-value":!1},{checked:l(()=>n[42]||(n[42]=[_("启用")])),unchecked:l(()=>n[43]||(n[43]=[_("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),t(Re,{label:"备注",path:"noteText",style:{"margin-top":"16px"}},{default:l(()=>[t(ze,{value:b.noteText,"onUpdate:value":n[4]||(n[4]=w=>b.noteText=w),type:"textarea",placeholder:"请输入备注信息",autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1})]),a("div",Wa,[t(se,{"title-placement":"left",class:"section-divider"},{default:l(()=>n[44]||(n[44]=[_("代理配置")])),_:1}),b.proxyType==="http"?(E(),X(je,{key:0},[a("div",Ka,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[45]||(n[45]=[_("基本配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"HTTP版本",path:"proxyConfig.httpVersion"},{default:l(()=>[t($e,{value:T.httpVersion,"onUpdate:value":n[5]||(n[5]=w=>T.httpVersion=w),options:C,placeholder:"请选择HTTP版本",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"重试次数",path:"proxyConfig.retryCount"},{default:l(()=>[t(ie,{value:T.retryCount,"onUpdate:value":n[6]||(n[6]=w=>T.retryCount=w),placeholder:"请输入重试次数",min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(Re,{label:"最大空闲连接数",path:"proxyConfig.maxIdleConns",style:{"margin-top":"16px"}},{default:l(()=>[t(ie,{value:T.maxIdleConns,"onUpdate:value":n[7]||(n[7]=w=>T.maxIdleConns=w),placeholder:"请输入最大空闲连接数",min:0,style:{width:"300px"}},null,8,["value"])]),_:1})]),a("div",Xa,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[46]||(n[46]=[_("超时配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"超时时间（秒）",path:"proxyConfig.timeout"},{default:l(()=>[t(ie,{value:T.timeout,"onUpdate:value":n[8]||(n[8]=w=>T.timeout=w),placeholder:"请输入超时时间",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"发送超时（秒）",path:"proxyConfig.sendTimeout"},{default:l(()=>[t(ie,{value:T.sendTimeout,"onUpdate:value":n[9]||(n[9]=w=>T.sendTimeout=w),placeholder:"请输入发送超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"读取超时（秒）",path:"proxyConfig.readTimeout"},{default:l(()=>[t(ie,{value:T.readTimeout,"onUpdate:value":n[10]||(n[10]=w=>T.readTimeout=w),placeholder:"请输入读取超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"连接超时（秒）",path:"proxyConfig.connectTimeout"},{default:l(()=>[t(ie,{value:T.connectTimeout,"onUpdate:value":n[11]||(n[11]=w=>T.connectTimeout=w),placeholder:"请输入连接超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"空闲连接超时（秒）",path:"proxyConfig.idleConnTimeout"},{default:l(()=>[t(ie,{value:T.idleConnTimeout,"onUpdate:value":n[12]||(n[12]=w=>T.idleConnTimeout=w),placeholder:"请输入空闲连接超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"重试超时（秒）",path:"proxyConfig.retryTimeout"},{default:l(()=>[t(ie,{value:T.retryTimeout,"onUpdate:value":n[13]||(n[13]=w=>T.retryTimeout=w),placeholder:"请输入重试超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),a("div",Ga,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[47]||(n[47]=[_("连接配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"跟随重定向",path:"proxyConfig.followRedirects"},{default:l(()=>[t(_e,{value:T.followRedirects,"onUpdate:value":n[14]||(n[14]=w=>T.followRedirects=w)},null,8,["value"])]),_:1}),t(W,{label:"保持连接",path:"proxyConfig.keepAlive"},{default:l(()=>[t(_e,{value:T.keepAlive,"onUpdate:value":n[15]||(n[15]=w=>T.keepAlive=w)},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"复制响应体",path:"proxyConfig.copyResponseBody"},{default:l(()=>[t(_e,{value:T.copyResponseBody,"onUpdate:value":n[16]||(n[16]=w=>T.copyResponseBody=w)},null,8,["value"])]),_:1}),t(W,{label:"代理缓冲",path:"proxyConfig.proxyBuffering"},{default:l(()=>[t(_e,{value:T.proxyBuffering,"onUpdate:value":n[17]||(n[17]=w=>T.proxyBuffering=w)},null,8,["value"])]),_:1})]),_:1})]),a("div",Qa,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[48]||(n[48]=[_("响应处理配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"缓冲区大小（字节）",path:"proxyConfig.bufferSize"},{default:l(()=>[t(ie,{value:T.bufferSize,"onUpdate:value":n[18]||(n[18]=w=>T.bufferSize=w),placeholder:"请输入缓冲区大小",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"最大缓冲区大小（字节）",path:"proxyConfig.maxBufferSize"},{default:l(()=>[t(ie,{value:T.maxBufferSize,"onUpdate:value":n[19]||(n[19]=w=>T.maxBufferSize=w),placeholder:"请输入最大缓冲区大小",min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),a("div",Za,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[49]||(n[49]=[_("头部配置")])),_:1}),t(Re,{label:"设置头部",path:"proxyConfig.setHeaders"},{default:l(()=>[t(Ft,{value:V.value,"onUpdate:value":n[20]||(n[20]=w=>V.value=w),"on-create":J},{"create-button-default":l(()=>n[50]||(n[50]=[_(" 添加头部 ")])),default:l(({value:w,index:vt})=>[a("div",en,[t(ze,{value:w.key,"onUpdate:value":[He=>w.key=He,He=>S(vt,"key",He)],type:"text",placeholder:"头部名称",style:{flex:"1"}},null,8,["value","onUpdate:value"]),t(ze,{value:w.value,"onUpdate:value":[He=>w.value=He,He=>S(vt,"value",He)],type:"text",placeholder:"头部值",style:{flex:"1"}},null,8,["value","onUpdate:value"])])]),_:1},8,["value"])]),_:1}),t(Re,{label:"允许传递的头部",path:"proxyConfig.passHeaders",style:{"margin-top":"20px"}},{default:l(()=>[t(ft,{value:T.passHeaders,"onUpdate:value":n[21]||(n[21]=w=>T.passHeaders=w)},null,8,["value"])]),_:1}),t(Re,{label:"隐藏的头部",path:"proxyConfig.hideHeaders",style:{"margin-top":"20px"}},{default:l(()=>[t(ft,{value:T.hideHeaders,"onUpdate:value":n[22]||(n[22]=w=>T.hideHeaders=w)},null,8,["value"])]),_:1})]),a("div",tn,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[51]||(n[51]=[_("高级选项")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"保留原始Host",path:"proxyConfig.preserveHost"},{default:l(()=>[t(_e,{value:T.preserveHost,"onUpdate:value":n[23]||(n[23]=w=>T.preserveHost=w)},null,8,["value"])]),_:1}),t(W,{label:"添加X-Forwarded-For",path:"proxyConfig.addXForwardedFor"},{default:l(()=>[t(_e,{value:T.addXForwardedFor,"onUpdate:value":n[24]||(n[24]=w=>T.addXForwardedFor=w)},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"添加X-Real-IP",path:"proxyConfig.addXRealIP"},{default:l(()=>[t(_e,{value:T.addXRealIP,"onUpdate:value":n[25]||(n[25]=w=>T.addXRealIP=w)},null,8,["value"])]),_:1}),t(W,{label:"添加X-Forwarded-Proto",path:"proxyConfig.addXForwardedProto"},{default:l(()=>[t(_e,{value:T.addXForwardedProto,"onUpdate:value":n[26]||(n[26]=w=>T.addXForwardedProto=w)},null,8,["value"])]),_:1})]),_:1})]),a("div",ln,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[52]||(n[52]=[_("TLS配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"最小TLS版本",path:"proxyConfig.tlsMinVersion"},{default:l(()=>[t($e,{value:T.tlsMinVersion,"onUpdate:value":n[27]||(n[27]=w=>T.tlsMinVersion=w),options:$,placeholder:"请选择最小TLS版本",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"最大TLS版本",path:"proxyConfig.tlsMaxVersion"},{default:l(()=>[t($e,{value:T.tlsMaxVersion,"onUpdate:value":n[28]||(n[28]=w=>T.tlsMaxVersion=w),options:$,placeholder:"请选择最大TLS版本",clearable:""},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"TLS服务器名称",path:"proxyConfig.tlsServerName"},{default:l(()=>[t(ze,{value:T.tlsServerName,"onUpdate:value":n[29]||(n[29]=w=>T.tlsServerName=w),placeholder:"请输入TLS服务器名称（可选）",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"跳过TLS证书验证",path:"proxyConfig.tlsInsecureSkipVerify"},{default:l(()=>[t(_e,{value:T.tlsInsecureSkipVerify,"onUpdate:value":n[30]||(n[30]=w=>T.tlsInsecureSkipVerify=w)},null,8,["value"])]),_:1})]),_:1})])],64)):de("",!0),b.proxyType==="websocket"?(E(),X("div",an,[t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"Ping间隔（秒）",path:"proxyConfig.pingInterval"},{default:l(()=>[t(ie,{value:F.pingInterval,"onUpdate:value":n[31]||(n[31]=w=>F.pingInterval=w),placeholder:"请输入Ping间隔",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"Pong超时（秒）",path:"proxyConfig.pongTimeout"},{default:l(()=>[t(ie,{value:F.pongTimeout,"onUpdate:value":n[32]||(n[32]=w=>F.pongTimeout=w),placeholder:"请输入Pong超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"最大消息大小（字节）",path:"proxyConfig.maxMessageSize"},{default:l(()=>[t(ie,{value:F.maxMessageSize,"onUpdate:value":n[33]||(n[33]=w=>F.maxMessageSize=w),placeholder:"请输入最大消息大小",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"启用压缩",path:"proxyConfig.enableCompression"},{default:l(()=>[t(_e,{value:F.enableCompression,"onUpdate:value":n[34]||(n[34]=w=>F.enableCompression=w)},null,8,["value"])]),_:1})]),_:1})])):de("",!0),b.proxyType==="tcp"?(E(),X("div",nn,[t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"连接超时（秒）",path:"proxyConfig.connectTimeout"},{default:l(()=>[t(ie,{value:D.connectTimeout,"onUpdate:value":n[35]||(n[35]=w=>D.connectTimeout=w),placeholder:"请输入连接超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"保持连接",path:"proxyConfig.keepAlive"},{default:l(()=>[t(_e,{value:D.keepAlive,"onUpdate:value":n[36]||(n[36]=w=>D.keepAlive=w)},null,8,["value"])]),_:1})]),_:1})])):de("",!0),b.proxyType==="udp"?(E(),X("div",on,[t(Re,{label:"缓冲区大小（字节）",path:"proxyConfig.bufferSize"},{default:l(()=>[t(ie,{value:R.bufferSize,"onUpdate:value":n[37]||(n[37]=w=>R.bufferSize=w),placeholder:"请输入缓冲区大小",min:1,style:{width:"300px"}},null,8,["value"])]),_:1})])):de("",!0)]),a("div",sn,[t(se,{"title-placement":"left",class:"section-divider"},{default:l(()=>n[53]||(n[53]=[_("自定义配置")])),_:1}),t(Re,{label:"自定义配置",path:"customConfig"},{default:l(()=>[t(ze,{value:k.value,"onUpdate:value":n[38]||(n[38]=w=>k.value=w),type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"{}"},null,8,["value"]),t(gt,{style:{"margin-top":"12px"}},{default:l(()=>[t(ne,{text:"",onClick:P},{icon:l(()=>[t(j,null,{default:l(()=>[t(e(El))]),_:1})]),default:l(()=>[n[54]||(n[54]=_(" 格式化JSON "))]),_:1}),t(ne,{text:"",onClick:f},{icon:l(()=>[t(j,null,{default:l(()=>[t(e(Ol))]),_:1})]),default:l(()=>[n[55]||(n[55]=_(" 验证JSON "))]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1},8,["show"])}}}),un=xe(dn,[["__scopeId","data-v-fd24c4d5"]]),cn={class:"single-proxy-config"},pn={class:"proxy-content"},fn={key:4,class:"proxy-custom-config"},gn=Z({__name:"SingleProxyConfig",props:{gatewayInstanceId:{}},emits:["refresh","proxyTypeChanged","proxyConfigChanged"],setup(u,{emit:g}){const i=u,r=g,x=Ce(),v=H(!1),p=H(null),o=H(!1),c=H("add"),C=H({});function $(D){if(!D)return"{}";try{const R=typeof D=="string"?JSON.parse(D):D;return JSON.stringify(R,null,2)}catch{return typeof D=="string"?D:"{}"}}async function b(){var D;if(i.gatewayInstanceId)try{v.value=!0;const R=await Rt({gatewayInstanceId:i.gatewayInstanceId,pageIndex:1,pageSize:1});if(R.oK&&R.state)try{const L=JSON.parse(R.bizData||"[]");p.value=L.length>0?L[0]:null,r("proxyTypeChanged",((D=p.value)==null?void 0:D.proxyType)||null),r("proxyConfigChanged",p.value)}catch{x.error("解析代理配置数据失败"),p.value=null,r("proxyTypeChanged",null),r("proxyConfigChanged",null)}else p.value=null,r("proxyTypeChanged",null),r("proxyConfigChanged",null),x.warning("未找到代理配置")}catch{x.error("加载代理配置失败"),p.value=null,r("proxyTypeChanged",null),r("proxyConfigChanged",null)}finally{v.value=!1}}function T(){c.value="add",C.value={gatewayInstanceId:i.gatewayInstanceId,proxyName:"",proxyType:"http",configPriority:0,proxyConfig:{},activeFlag:"Y"},o.value=!0}function V(D){c.value="edit",C.value={...D},o.value=!0}async function A(D){try{v.value=!0;const R=await Ea(D,"default");R.oK&&R.state?(x.success("删除成功"),p.value=null,r("proxyConfigChanged",null),r("refresh")):x.error(R.errMsg||"删除失败")}catch{x.error("删除失败")}finally{v.value=!1}}async function F(D){try{v.value=!0;const R=D.activeFlag==="Y"?"N":"Y",L=await Ht({tenantId:"default",proxyConfigId:D.proxyConfigId,gatewayInstanceId:i.gatewayInstanceId,activeFlag:R});L.oK&&L.state?(x.success(`${R==="Y"?"启用":"禁用"}成功`),await b(),r("refresh")):x.error(L.errMsg||"操作失败")}catch{x.error("状态切换失败")}finally{v.value=!1}}return Ze(()=>{b()}),(D,R)=>(E(),X("div",cn,[t(e(ul),{show:v.value},{default:l(()=>[p.value?(E(),Q(e(fe),{key:1,class:"proxy-detail-card"},{header:l(()=>[t(Gl,{"proxy-config":p.value,onEdit:V,onDelete:A,onToggleStatus:F},null,8,["proxy-config"])]),default:l(()=>[a("div",pn,[t(la,{"proxy-config":p.value},null,8,["proxy-config"]),p.value.proxyType==="http"?(E(),Q(Ca,{key:0,"proxy-config":p.value.proxyConfig},null,8,["proxy-config"])):p.value.proxyType==="websocket"?(E(),Q(wa,{key:1,"proxy-config":p.value.proxyConfig},null,8,["proxy-config"])):p.value.proxyType==="tcp"?(E(),Q(Ia,{key:2,"proxy-config":p.value.proxyConfig},null,8,["proxy-config"])):p.value.proxyType==="udp"?(E(),Q(za,{key:3,"proxy-config":p.value.proxyConfig},null,8,["proxy-config"])):de("",!0),p.value.customConfig?(E(),X("div",fn,[t(e(me),{"title-placement":"left"},{default:l(()=>R[2]||(R[2]=[_("自定义配置")])),_:1}),t(e(Il),null,{default:l(()=>[t(e(zl),{title:"查看自定义配置",name:"1"},{default:l(()=>[t(e(ue),{type:"textarea",value:$(p.value.customConfig),autosize:{minRows:3,maxRows:10},readonly:"",class:"code-input"},null,8,["value"])]),_:1})]),_:1})])):de("",!0)])]),_:1})):(E(),Q(e(fe),{key:0,class:"empty-proxy-card"},{default:l(()=>[t(e(it),{description:"当前网关实例尚未配置代理"},{icon:l(()=>[t(e(O),{size:"60",color:"#d0d0d0"},{default:l(()=>[t(e(Et))]),_:1})]),extra:l(()=>[t(e(Y),{type:"primary",onClick:T},{icon:l(()=>[t(e(O),{component:e(ut)},null,8,["component"])]),default:l(()=>[R[1]||(R[1]=_(" 创建代理配置 "))]),_:1})]),_:1})]),_:1}))]),_:1},8,["show"]),t(un,{show:o.value,"onUpdate:show":R[0]||(R[0]=L=>o.value=L),"form-data":C.value,mode:c.value,onRefresh:b},null,8,["show","form-data","mode"])]))}}),vn=xe(gn,[["__scopeId","data-v-a42740b5"]]),yn={class:"modal-header"},mn={class:"header-content"},hn={class:"modal-title"},xn={class:"ml-2"},bn=Z({__name:"ServiceDefinitionDialog",props:{show:{type:Boolean},formData:{},mode:{},proxyConfigId:{}},emits:["update:show","refresh"],setup(u,{emit:g}){const i=u,r=g,x=Ce(),v=H(null),p=H(!1),o=ve({proxyConfigId:i.proxyConfigId,serviceName:"",serviceDesc:"",serviceType:Se.STATIC,loadBalanceStrategy:ae.ROUND_ROBIN,sessionAffinity:"N",stickySession:"N",maxRetries:3,retryTimeoutMs:5e3,enableCircuitBreaker:"N",healthCheckEnabled:"Y",healthCheckPath:"/health",healthCheckMethod:"GET",healthCheckIntervalSeconds:30,healthCheckTimeoutMs:5e3,healthyThreshold:2,unhealthyThreshold:3,expectedStatusCodes:"200",activeFlag:"Y",noteText:""}),c=q({get:()=>i.show,set:M=>r("update:show",M)}),C=q({get:()=>o.sessionAffinity==="Y",set:M=>{o.sessionAffinity=M?"Y":"N"}}),$=q({get:()=>o.stickySession==="Y",set:M=>{o.stickySession=M?"Y":"N"}}),b=q({get:()=>o.enableCircuitBreaker==="Y",set:M=>{o.enableCircuitBreaker=M?"Y":"N"}}),T=q({get:()=>o.healthCheckEnabled==="Y",set:M=>{o.healthCheckEnabled=M?"Y":"N"}}),V=q({get:()=>o.activeFlag==="Y",set:M=>{o.activeFlag=M?"Y":"N"}}),A=q({get:()=>o.discoveryConfig&&typeof o.discoveryConfig=="object"?JSON.stringify(o.discoveryConfig,null,2):o.discoveryConfig||"",set:M=>{try{o.discoveryConfig=M?JSON.parse(M):void 0}catch{o.discoveryConfig=M}}}),F=[{label:"静态配置",value:Se.STATIC},{label:"服务发现",value:Se.DISCOVERY}],D=[{label:"轮询算法",value:ae.ROUND_ROBIN},{label:"随机算法",value:ae.RANDOM},{label:"IP哈希算法",value:ae.IP_HASH},{label:"最少连接算法",value:ae.LEAST_CONN},{label:"加权轮询算法",value:ae.WEIGHTED_ROUND_ROBIN},{label:"一致性哈希算法",value:ae.CONSISTENT_HASH}],R=[{label:"Consul",value:Ke.CONSUL},{label:"Eureka",value:Ke.EUREKA},{label:"Nacos",value:Ke.NACOS}],L=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"HEAD",value:"HEAD"}],k={serviceName:[{required:!0,message:"请输入服务名称",trigger:["blur","input"]},{min:2,max:50,message:"服务名称长度在2-50个字符",trigger:["blur","input"]}],serviceType:[{required:!0,message:"请选择服务类型",trigger:["blur","change"],validator:(M,m)=>m==null||m===""?new Error("请选择服务类型"):typeof m=="number"&&(m===0||m===1)?!0:new Error("请选择有效的服务类型")}],loadBalanceStrategy:[{required:!0,message:"请选择负载均衡策略",trigger:["blur","change"],validator:(M,m)=>m==null||m===""?new Error("请选择负载均衡策略"):!0}],maxRetries:[{required:!0,message:"请输入最大重试次数",trigger:["blur","change"],validator:(M,m)=>{if(m==null||m==="")return new Error("请输入最大重试次数");const N=Number(m);return isNaN(N)?new Error("重试次数必须是数字"):N<0||N>10?new Error("重试次数必须在0-10之间"):!0}}],retryTimeoutMs:[{required:!0,message:"请输入重试超时时间",trigger:["blur","change"],validator:(M,m)=>{if(m==null||m==="")return new Error("请输入重试超时时间");const N=Number(m);return isNaN(N)?new Error("超时时间必须是数字"):N<100||N>6e4?new Error("超时时间必须在100-60000毫秒之间"):!0}}]};te(()=>i.formData,M=>{M?Object.assign(o,M):i.mode==="add"&&y()},{immediate:!0,deep:!0}),te(()=>i.show,M=>{M&&i.mode==="add"&&!i.formData&&y()}),te(()=>i.proxyConfigId,M=>{M&&(o.proxyConfigId=M)});function y(){Object.assign(o,{proxyConfigId:i.proxyConfigId,serviceName:"",serviceDesc:"",serviceType:Se.STATIC,loadBalanceStrategy:ae.ROUND_ROBIN,sessionAffinity:"N",stickySession:"N",maxRetries:3,retryTimeoutMs:5e3,enableCircuitBreaker:"N",healthCheckEnabled:"Y",healthCheckPath:"/health",healthCheckMethod:"GET",healthCheckIntervalSeconds:30,healthCheckTimeoutMs:5e3,healthyThreshold:2,unhealthyThreshold:3,expectedStatusCodes:"200",activeFlag:"Y",noteText:""})}function U(){r("update:show",!1)}async function ee(){var M;try{await((M=v.value)==null?void 0:M.validate()),p.value=!0;const m="default",N=i.mode==="add"?await Ha({...o,tenantId:m}):await st({...o,tenantId:m,serviceDefinitionId:o.serviceDefinitionId});N.oK?(x.success(i.mode==="add"?"创建成功":"保存成功"),r("refresh"),U()):x.error(N.messageId||"操作失败")}catch(m){m&&typeof m=="object"&&Array.isArray(m)?x.error("请检查表单填写是否正确"):x.error("操作失败: "+((m==null?void 0:m.message)||"未知错误"))}finally{p.value=!1}}return(M,m)=>(E(),Q(e(Qe),{show:c.value,"onUpdate:show":m[21]||(m[21]=N=>c.value=N),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(e(fe),{style:{width:"1000px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",yn,[t(e(O),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(It))]),_:1}),a("div",mn,[a("h3",hn,z(M.mode==="add"?"新建服务定义":"编辑服务定义"),1),m[22]||(m[22]=a("p",{class:"modal-subtitle"},"配置后端服务的负载均衡、健康检查等参数",-1))])])]),"header-extra":l(()=>[t(e(Y),{quaternary:"",circle:"",onClick:U,class:"close-btn"},{icon:l(()=>[t(e(O),{size:"18"},{default:l(()=>[t(e(ct))]),_:1})]),_:1})]),action:l(()=>[t(e(Ne),null,{default:l(()=>[t(e(Y),{onClick:U},{default:l(()=>m[23]||(m[23]=[_("取消")])),_:1}),t(e(Y),{type:"primary",loading:p.value,onClick:ee},{default:l(()=>[_(z(M.mode==="add"?"创建":"保存"),1)]),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(e(Ye),{ref_key:"formRef",ref:v,model:o,rules:k,"label-placement":"left","label-width":"140px"},{default:l(()=>[t(e(dt),{type:"line",animated:""},{default:l(()=>[t(e(Te),{name:"basic",tab:"基本信息"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"服务名称",path:"serviceName"},{default:l(()=>[t(e(ue),{value:o.serviceName,"onUpdate:value":m[0]||(m[0]=N=>o.serviceName=N),placeholder:"请输入服务名称"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"服务类型",path:"serviceType"},{default:l(()=>[t(e(ge),{value:o.serviceType,"onUpdate:value":m[1]||(m[1]=N=>o.serviceType=N),options:F,placeholder:"请选择服务类型"},null,8,["value"])]),_:1})]),_:1}),t(e(K),{span:2},{default:l(()=>[t(e(B),{label:"服务描述",path:"serviceDesc"},{default:l(()=>[t(e(ue),{value:o.serviceDesc,"onUpdate:value":m[2]||(m[2]=N=>o.serviceDesc=N),type:"textarea",rows:3,placeholder:"请输入服务描述"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Te),{name:"loadbalance",tab:"负载均衡"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"负载均衡策略",path:"loadBalanceStrategy"},{default:l(()=>[t(e(ge),{value:o.loadBalanceStrategy,"onUpdate:value":m[3]||(m[3]=N=>o.loadBalanceStrategy=N),options:D,placeholder:"请选择负载均衡策略"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"会话亲和性"},{default:l(()=>[t(e(Ue),{value:C.value,"onUpdate:value":m[4]||(m[4]=N=>C.value=N)},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"粘性会话"},{default:l(()=>[t(e(Ue),{value:$.value,"onUpdate:value":m[5]||(m[5]=N=>$.value=N)},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"最大重试次数",path:"maxRetries"},{default:l(()=>[t(e(ke),{value:o.maxRetries,"onUpdate:value":m[6]||(m[6]=N=>o.maxRetries=N),min:0,max:10},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"重试超时时间(ms)",path:"retryTimeoutMs"},{default:l(()=>[t(e(ke),{value:o.retryTimeoutMs,"onUpdate:value":m[7]||(m[7]=N=>o.retryTimeoutMs=N),min:100,max:6e4},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"启用熔断器"},{default:l(()=>[t(e(Ue),{value:b.value,"onUpdate:value":m[8]||(m[8]=N=>b.value=N)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Te),{name:"health",tab:"健康检查"},{default:l(()=>[t(e(B),{label:"启用健康检查"},{default:l(()=>[t(e(Ue),{value:T.value,"onUpdate:value":m[9]||(m[9]=N=>T.value=N)},null,8,["value"])]),_:1}),T.value?(E(),Q(e(De),{key:0,cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"检查路径",path:"healthCheckPath"},{default:l(()=>[t(e(ue),{value:o.healthCheckPath,"onUpdate:value":m[10]||(m[10]=N=>o.healthCheckPath=N),placeholder:"/health"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"检查方法",path:"healthCheckMethod"},{default:l(()=>[t(e(ge),{value:o.healthCheckMethod,"onUpdate:value":m[11]||(m[11]=N=>o.healthCheckMethod=N),options:L},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"检查间隔(秒)",path:"healthCheckIntervalSeconds"},{default:l(()=>[t(e(ke),{value:o.healthCheckIntervalSeconds,"onUpdate:value":m[12]||(m[12]=N=>o.healthCheckIntervalSeconds=N),min:1,max:300},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"检查超时(ms)",path:"healthCheckTimeoutMs"},{default:l(()=>[t(e(ke),{value:o.healthCheckTimeoutMs,"onUpdate:value":m[13]||(m[13]=N=>o.healthCheckTimeoutMs=N),min:100,max:3e4},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"健康阈值",path:"healthyThreshold"},{default:l(()=>[t(e(ke),{value:o.healthyThreshold,"onUpdate:value":m[14]||(m[14]=N=>o.healthyThreshold=N),min:1,max:10},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"不健康阈值",path:"unhealthyThreshold"},{default:l(()=>[t(e(ke),{value:o.unhealthyThreshold,"onUpdate:value":m[15]||(m[15]=N=>o.unhealthyThreshold=N),min:1,max:10},null,8,["value"])]),_:1})]),_:1}),t(e(K),{span:2},{default:l(()=>[t(e(B),{label:"期望状态码",path:"expectedStatusCodes"},{default:l(()=>[t(e(ue),{value:o.expectedStatusCodes,"onUpdate:value":m[16]||(m[16]=N=>o.expectedStatusCodes=N),placeholder:"200,201,204"},null,8,["value"])]),_:1})]),_:1})]),_:1})):de("",!0)]),_:1}),o.serviceType===e(Se).DISCOVERY?(E(),Q(e(Te),{key:0,name:"discovery",tab:"服务发现"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"发现类型",path:"discoveryType"},{default:l(()=>[t(e(ge),{value:o.discoveryType,"onUpdate:value":m[17]||(m[17]=N=>o.discoveryType=N),options:R},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(B),{label:"发现配置"},{default:l(()=>[t(e(ue),{value:A.value,"onUpdate:value":m[18]||(m[18]=N=>A.value=N),type:"textarea",rows:6,placeholder:"JSON格式的服务发现配置"},null,8,["value"])]),_:1})]),_:1})):de("",!0),t(e(Te),{name:"other",tab:"其他配置"},{default:l(()=>[t(e(B),{label:"状态"},{default:l(()=>[t(e(Ue),{value:V.value,"onUpdate:value":m[19]||(m[19]=N=>V.value=N)},null,8,["value"]),a("span",xn,z(V.value?"启用":"禁用"),1)]),_:1}),t(e(B),{label:"备注信息",path:"noteText"},{default:l(()=>[t(e(ue),{value:o.noteText,"onUpdate:value":m[20]||(m[20]=N=>o.noteText=N),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]))}}),Cn=xe(bn,[["__scopeId","data-v-8147df47"]]),_n={class:"modal-header"},Tn={class:"header-content"},wn={class:"modal-title"},kn={class:"ml-2"},Sn={class:"ml-2"},In=Z({__name:"ServiceNodeFormDialog",props:{show:{type:Boolean},formData:{},mode:{},serviceDefinitionId:{}},emits:["update:show","refresh","close"],setup(u,{emit:g}){const i=u,r=g,x=Ce(),v=H(null),p=H(!1),o=ve({serviceDefinitionId:"",nodeUrl:"http://192.168.1.0:8080",nodeHost:"192.168.1.0",nodePort:8080,nodeProtocol:"HTTP",nodeWeight:100,healthStatus:"Y",nodeEnabled:"Y",nodeStatus:he.ONLINE,activeFlag:"Y",noteText:""}),c=q({get:()=>i.show,set:k=>r("update:show",k)}),C=q({get:()=>o.healthStatus==="Y",set:k=>{o.healthStatus=k?"Y":"N"}}),$=q({get:()=>o.activeFlag==="Y",set:k=>{o.activeFlag=k?"Y":"N"}}),b=q({get:()=>o.nodeMetadata&&typeof o.nodeMetadata=="object"?JSON.stringify(o.nodeMetadata,null,2):o.nodeMetadata||"",set:k=>{try{o.nodeMetadata=k?JSON.parse(k):void 0}catch{o.nodeMetadata=k}}}),T=[{label:"HTTP",value:"HTTP"},{label:"HTTPS",value:"HTTPS"}],V=[{label:"在线",value:he.ONLINE},{label:"下线",value:he.OFFLINE},{label:"维护",value:he.MAINTENANCE}],A={nodeHost:[{required:!0,message:"请输入节点主机地址",trigger:["blur","input"]},{pattern:/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/,message:"请输入有效的IP地址或域名",trigger:["blur","input"]}],nodePort:[{required:!0,type:"number",message:"请输入节点端口",trigger:["blur","change"]}],nodeUrl:[{required:!0,message:"请输入节点URL",trigger:["blur","input"]},{validator:(k,y)=>{if(y&&(y.startsWith("http://")||y.startsWith("https://")))try{return new URL(y),!0}catch{return new Error("请输入有效的URL格式")}return!0},trigger:["blur","input"]}],nodeWeight:[{required:!0,type:"number",message:"请输入节点权重",trigger:["blur","change"]}],nodeProtocol:[{required:!0,message:"请选择节点协议",trigger:["blur","change"]}],nodeStatus:[{required:!0,type:"number",message:"请选择运行状态",trigger:["blur","change"]}]};te(()=>i.formData,k=>{if(i.mode==="edit"&&k){const y={...k,nodePort:k.nodePort?Number(k.nodePort):8080,nodeWeight:k.nodeWeight?Number(k.nodeWeight):100,nodeStatus:k.nodeStatus!==void 0?Number(k.nodeStatus):he.ONLINE};Object.assign(o,y)}else i.mode==="add"&&F()},{immediate:!0,deep:!0}),te(()=>i.mode,k=>{k==="add"&&F()},{immediate:!0}),te(()=>i.show,k=>{k&&(i.mode==="add"&&F(),Ee(()=>{var y;(y=v.value)==null||y.restoreValidation()}))}),te(()=>i.serviceDefinitionId,k=>{k&&i.mode==="add"&&(o.serviceDefinitionId=k)},{immediate:!0});function F(){const k=o.serviceDefinitionId||i.serviceDefinitionId||"";Object.assign(o,{serviceDefinitionId:k,nodeUrl:"http://192.168.1.0:8080",nodeHost:"192.168.1.0",nodePort:8080,nodeProtocol:"HTTP",nodeWeight:100,healthStatus:"Y",nodeEnabled:"Y",nodeStatus:he.ONLINE,activeFlag:"Y",noteText:""})}function D(){if(o.nodeHost&&o.nodePort!==void 0&&o.nodeProtocol){const k=o.nodeProtocol.toLowerCase();o.nodeUrl=`${k}://${o.nodeHost}:${o.nodePort}`}}function R(){r("update:show",!1),r("close")}async function L(){var k;try{await((k=v.value)==null?void 0:k.validate()),p.value=!0,!o.serviceDefinitionId&&i.serviceDefinitionId&&(o.serviceDefinitionId=i.serviceDefinitionId);const y={...o,serviceDefinitionId:o.serviceDefinitionId||i.serviceDefinitionId||"",nodePort:Number(o.nodePort),nodeWeight:Number(o.nodeWeight),nodeStatus:Number(o.nodeStatus),nodeUrl:o.nodeUrl,nodeHost:o.nodeHost,nodeProtocol:o.nodeProtocol,healthStatus:o.healthStatus||"Y",nodeEnabled:o.nodeEnabled||"Y",activeFlag:o.activeFlag||"Y",noteText:o.noteText||"",nodeMetadata:o.nodeMetadata};if(!y.serviceDefinitionId){x.error("服务定义ID不能为空");return}if(!y.nodeUrl||!y.nodeHost||!y.nodeProtocol){x.error("节点URL、主机地址和协议不能为空");return}const U=i.mode==="add"?await Ma(y):await rt({...y,serviceNodeId:o.serviceNodeId,nodeUrl:y.nodeUrl,nodeHost:y.nodeHost,nodePort:y.nodePort,nodeProtocol:y.nodeProtocol,nodeWeight:y.nodeWeight,healthStatus:y.healthStatus,nodeEnabled:y.nodeEnabled,nodeStatus:y.nodeStatus,activeFlag:y.activeFlag,noteText:y.noteText,nodeMetadata:y.nodeMetadata});U.oK?(x.success(i.mode==="add"?"创建成功":"保存成功"),r("refresh"),R()):x.error(U.messageId||"操作失败")}catch(y){y&&typeof y=="object"&&Array.isArray(y)?x.error("请检查表单填写是否正确"):(x.error("操作失败: "+(y.message||"未知错误")),console.error("提交失败",y))}finally{p.value=!1}}return te(()=>o.nodeProtocol,D),te(()=>o.nodeUrl,k=>{if(k&&(k.startsWith("http://")||k.startsWith("https://")))try{const y=new URL(k);o.nodeProtocol=y.protocol==="https:"?"HTTPS":"HTTP",o.nodeHost=y.hostname,y.port?o.nodePort=parseInt(y.port,10):o.nodePort=y.protocol==="https:"?443:80}catch(y){console.warn("URL解析失败:",y)}}),(k,y)=>(E(),Q(e(Qe),{show:c.value,"onUpdate:show":y[11]||(y[11]=U=>c.value=U),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(e(fe),{style:{width:"800px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",_n,[t(e(O),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(Ae))]),_:1}),a("div",Tn,[a("h3",wn,z(k.mode==="add"?"新建服务节点":"编辑服务节点"),1),y[12]||(y[12]=a("p",{class:"modal-subtitle"},"配置后端服务的具体节点实例",-1))])])]),"header-extra":l(()=>[t(e(Y),{quaternary:"",circle:"",onClick:R,class:"close-btn"},{icon:l(()=>[t(e(O),{size:"18"},{default:l(()=>[t(e(ct))]),_:1})]),_:1})]),action:l(()=>[t(e(Ne),null,{default:l(()=>[t(e(Y),{onClick:R},{default:l(()=>y[14]||(y[14]=[_("取消")])),_:1}),t(e(Y),{type:"primary",loading:p.value,onClick:L},{default:l(()=>[_(z(k.mode==="add"?"创建":"保存"),1)]),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(e(Ye),{ref_key:"formRef",ref:v,model:o,rules:A,"label-placement":"left","label-width":"120px"},{default:l(()=>[t(e(dt),{type:"line",animated:""},{default:l(()=>[t(e(Te),{name:"basic",tab:"基本信息"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"节点协议",path:"nodeProtocol"},{default:l(()=>[t(e(ge),{value:o.nodeProtocol,"onUpdate:value":y[0]||(y[0]=U=>o.nodeProtocol=U),options:T,placeholder:"请选择协议"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"节点主机",path:"nodeHost"},{default:l(()=>[t(e(ue),{value:o.nodeHost,"onUpdate:value":[y[1]||(y[1]=U=>o.nodeHost=U),D],placeholder:"请输入主机地址"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"节点端口",path:"nodePort"},{default:l(()=>[t(e(ke),{value:o.nodePort,"onUpdate:value":[y[2]||(y[2]=U=>o.nodePort=U),D],min:1,max:65535,placeholder:"请输入端口"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"节点权重",path:"nodeWeight"},{default:l(()=>[t(e(ke),{value:o.nodeWeight,"onUpdate:value":y[3]||(y[3]=U=>o.nodeWeight=U),min:1,max:1e3,placeholder:"权重值"},null,8,["value"])]),_:1})]),_:1}),t(e(K),{span:2},{default:l(()=>[t(e(B),{label:"节点URL",path:"nodeUrl"},{feedback:l(()=>y[13]||(y[13]=[a("span",{class:"helper-text"},"支持直接输入完整URL(如 https://www.example.com)，将自动解析为协议、主机和端口",-1)])),default:l(()=>[t(e(ue),{value:o.nodeUrl,"onUpdate:value":y[4]||(y[4]=U=>o.nodeUrl=U),placeholder:"输入完整URL或由上方字段自动生成"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"运行状态",path:"nodeStatus"},{default:l(()=>[t(e(ge),{value:o.nodeStatus,"onUpdate:value":y[5]||(y[5]=U=>o.nodeStatus=U),options:V,placeholder:"请选择运行状态"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Te),{name:"status",tab:"状态配置"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"健康状态"},{default:l(()=>[t(e(Ue),{value:C.value,"onUpdate:value":y[6]||(y[6]=U=>C.value=U)},null,8,["value"]),a("span",kn,z(C.value?"健康":"不健康"),1)]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"启用状态"},{default:l(()=>[t(e(Ue),{value:$.value,"onUpdate:value":y[7]||(y[7]=U=>$.value=U)},null,8,["value"]),a("span",Sn,z($.value?"启用":"禁用"),1)]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"运行状态",path:"nodeStatus"},{default:l(()=>[t(e(ge),{value:o.nodeStatus,"onUpdate:value":y[8]||(y[8]=U=>o.nodeStatus=U),options:V,placeholder:"请选择运行状态"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Te),{name:"metadata",tab:"元数据配置"},{default:l(()=>[t(e(B),{label:"节点元数据"},{default:l(()=>[t(e(ue),{value:b.value,"onUpdate:value":y[9]||(y[9]=U=>b.value=U),type:"textarea",rows:8,placeholder:"JSON格式的节点元数据配置"},null,8,["value"])]),_:1})]),_:1}),t(e(Te),{name:"other",tab:"其他配置"},{default:l(()=>[t(e(B),{label:"备注信息",path:"noteText"},{default:l(()=>[t(e(ue),{value:o.noteText,"onUpdate:value":y[10]||(y[10]=U=>o.noteText=U),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]))}}),Nn=xe(In,[["__scopeId","data-v-56953fa5"]]);function Pn(u){const g=Ce(),i=H(!1),r=H([]),x=H(0),v=H([]),p=H(1),o=H(10),c=H(!1),C=H("add"),$=H(null),b=ve({serviceDefinitionId:u,nodeHost:"",healthStatus:void 0,activeFlag:void 0,nodeStatus:void 0,page:1,size:10}),T=[{label:"HTTP",value:"HTTP"},{label:"HTTPS",value:"HTTPS"}],V=[{label:"全部",value:void 0},{label:"健康",value:"Y"},{label:"不健康",value:"N"}],A=[{label:"全部",value:void 0},{label:"启用",value:"Y"},{label:"禁用",value:"N"}],F=[{label:"全部",value:void 0},{label:"在线",value:he.ONLINE},{label:"下线",value:he.OFFLINE},{label:"维护",value:he.MAINTENANCE}],D=q(()=>v.value.length>0),R=q(()=>({page:p.value,pageSize:o.value,itemCount:x.value,onChange:f=>{p.value=f,b.page=f,k()},onUpdatePageSize:f=>{o.value=f,b.size=f,k()},showSizePicker:!0,pageSizes:[10,20,30,50],showQuickJumper:!0,prefix:f=>`共 ${f.itemCount||0} 条`})),L=[{type:"selection",fixed:"left"},{title:"节点ID",key:"nodeId",width:150,ellipsis:{tooltip:!0}},{title:"节点地址",key:"nodeUrl",width:200,ellipsis:{tooltip:!0},render:f=>`${f.nodeHost}:${f.nodePort}`},{title:"协议",key:"nodeProtocol",width:80,align:"center",render:f=>h(G,{type:f.nodeProtocol==="HTTPS"?"success":"info",size:"small"},()=>f.nodeProtocol)},{title:"权重",key:"nodeWeight",width:80,align:"center"},{title:"健康状态",key:"healthStatus",width:100,align:"center",render:f=>{const P=f.healthStatus==="Y";return h("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:P?"#18a058":"#d03050"}},[h(O,{size:18},()=>h(P?Ie:We)),h("span",{style:{marginLeft:"4px"}},P?"健康":"不健康")])}},{title:"运行状态",key:"nodeStatus",width:100,align:"center",render:f=>{let P=Hl,d="#d9d9d9",n="未知";switch(f.nodeStatus){case he.ONLINE:P=Ie,d="#18a058",n="在线";break;case he.OFFLINE:P=We,d="#d03050",n="下线";break;case he.MAINTENANCE:P=Pt,d="#f0a020",n="维护";break}return h("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:d}},[h(O,{size:18},()=>h(P)),h("span",{style:{marginLeft:"4px"}},n)])}},{title:"启用状态",key:"activeFlag",width:100,align:"center",render:f=>{const P=f.activeFlag==="Y";return h("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:P?"#18a058":"#d03050"}},[h(O,{size:18},()=>h(P?Ie:We)),h("span",{style:{marginLeft:"4px"}},P?"启用":"禁用")])}},{title:"最后检查时间",key:"lastHealthCheckTime",width:180,align:"center",render:f=>f.lastHealthCheckTime?new Date(f.lastHealthCheckTime).toLocaleString():"-"},{title:"操作",key:"actions",width:240,align:"center",fixed:"right",render:f=>h(Ne,{size:"small"},()=>[h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"primary",secondary:!0,onClick:()=>U(f)},{icon:()=>h(O,()=>h(et))}),default:()=>"编辑"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"info",secondary:!0,onClick:()=>le(f)},{icon:()=>h(O,()=>h(Ml))}),default:()=>"健康检查"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:f.activeFlag==="Y"?"warning":"success",secondary:!0,onClick:()=>N(f.serviceNodeId,f.activeFlag==="Y"?"N":"Y")},{icon:()=>h(O,()=>h(f.activeFlag==="Y"?Le:Ie))}),default:()=>f.activeFlag==="Y"?"禁用":"启用"}),h(Ge,{onPositiveClick:()=>M(f.serviceNodeId,"default")},{trigger:()=>h(Y,{size:"small",type:"error",secondary:!0},{icon:()=>h(O,()=>h(Fe))}),default:()=>"确认删除该节点吗？"})])}];async function k(){try{i.value=!0;const f=await Fa(b);if(f.oK){if(f.bizData)try{const P=JSON.parse(f.bizData);if(Array.isArray(P)){if(r.value=P,f.pageQueryData){const d=JSON.parse(f.pageQueryData);x.value=d.totalCount||0}}else P&&P.records?(r.value=P.records,x.value=P.total||0):(r.value=[],x.value=0)}catch(P){r.value=[],x.value=0,console.error("解析数据失败",P)}}else g.error(f.messageId||"加载服务节点列表失败")}catch(f){g.error("加载服务节点列表失败: "+(f.message||"未知错误")),console.error("加载服务节点列表失败",f)}finally{i.value=!1}}function y(){C.value="add",$.value=null,Ee(()=>{$.value={serviceDefinitionId:u,nodeUrl:"http://192.168.1.0:8080",nodeHost:"192.168.1.0",nodePort:8080,nodeProtocol:"HTTP",nodeWeight:100,healthStatus:"Y",nodeEnabled:"Y",nodeStatus:he.ONLINE,activeFlag:"Y",noteText:""},console.log("添加节点，设置serviceDefinitionId:",u),c.value=!0})}function U(f){C.value="edit",$.value=null,Ee(()=>{$.value={...f},c.value=!0})}function ee(){$.value=null,c.value=!1}async function M(f,P){try{i.value=!0;const d=await Aa(f,P);d.oK?(g.success("删除成功"),await k()):g.error(d.messageId||"删除失败")}catch(d){g.error("删除失败: "+(d.message||"未知错误")),console.error("删除失败",d)}finally{i.value=!1}}async function m(){if(v.value.length===0){g.warning("请选择要删除的服务节点");return}try{i.value=!0;const f=await Ya(v.value);f.oK?(g.success("批量删除成功"),v.value=[],await k()):g.error(f.messageId||"批量删除失败")}catch(f){g.error("批量删除失败: "+(f.message||"未知错误")),console.error("批量删除失败",f)}finally{i.value=!1}}async function N(f,P){const d=P==="Y"?"启用":"禁用";if(!b.serviceDefinitionId){g.error("服务定义ID不能为空");return}try{i.value=!0;const n=await rt({serviceNodeId:f,serviceDefinitionId:b.serviceDefinitionId,activeFlag:P});n.oK?(g.success(`${d}成功`),await k()):g.error(n.messageId||`${d}失败`)}catch(n){g.error(`${d}失败: `+(n.message||"未知错误")),console.error(`${d}失败`,n)}finally{i.value=!1}}async function oe(f){if(v.value.length===0){g.warning("请选择要操作的服务节点");return}if(!b.serviceDefinitionId){g.error("服务定义ID不能为空");return}const P=f==="Y"?"启用":"禁用";try{i.value=!0;const d=v.value.map(ne=>rt({serviceNodeId:ne,serviceDefinitionId:b.serviceDefinitionId,activeFlag:f})),n=await Promise.all(d),j=n.filter(ne=>!ne.oK).length;j===0?g.success(`成功${P} ${n.length} 个服务节点`):g.warning(`部分操作失败，${n.length-j}/${n.length} 成功`),v.value=[],await k()}catch(d){g.error(`批量${P}失败: `+(d.message||"未知错误")),console.error(`批量${P}失败`,d)}finally{i.value=!1}}async function le(f){try{const P=await Ba({serviceNodeId:f.serviceNodeId,healthStatus:"Y"});P.oK?(g.success("健康检查完成"),await k()):g.error(P.messageId||"健康检查失败")}catch(P){g.error("健康检查失败: "+(P.message||"未知错误")),console.error("健康检查失败",P)}}function J(f){v.value=f.map(P=>String(P))}function S(){b.page=1,k()}function I(){Object.assign(b,{serviceDefinitionId:u,nodeHost:"",healthStatus:void 0,activeFlag:void 0,nodeStatus:void 0,page:1,size:10}),p.value=1,k()}function s(){k()}return{loading:i,nodeList:r,total:x,selectedRowKeys:v,queryParams:b,showDialog:c,dialogMode:C,currentFormData:$,protocolOptions:T,statusOptions:V,enabledOptions:A,nodeStatusOptions:F,hasSelection:D,paginationProps:R,columns:L,loadNodeList:k,handleAdd:y,handleEdit:U,handleDelete:M,handleBatchDelete:m,handleToggleEnabled:N,handleBatchToggleEnabled:oe,handleHealthCheck:le,handleDialogClose:ee,handleSelectionChange:J,search:S,resetQuery:I,refresh:s}}const zn={class:"modal-header"},Dn={class:"service-node-content"},On={class:"query-section"},Un={class:"toolbar-section"},En={class:"table-section"},$n=Z({__name:"ServiceNodeDialog",props:{show:{type:Boolean},serviceDefinitionId:{}},emits:["update:show","refresh"],setup(u,{emit:g}){const i=u,r=g,{loading:x,nodeList:v,selectedRowKeys:p,queryParams:o,showDialog:c,dialogMode:C,currentFormData:$,statusOptions:b,nodeStatusOptions:T,hasSelection:V,paginationProps:A,columns:F,loadNodeList:D,handleAdd:R,handleBatchDelete:L,handleBatchToggleEnabled:k,handleDialogClose:y,handleSelectionChange:U,search:ee,resetQuery:M,refresh:m}=Pn(i.serviceDefinitionId),N=q({get:()=>i.show,set:I=>r("update:show",I)});function oe(){y(),p.value=[],o.page=1,o.nodeHost="",o.healthStatus=void 0,o.nodeStatus=void 0,r("update:show",!1)}function le(){D(),r("refresh")}function J(){R()}const S=q(()=>i.show&&i.serviceDefinitionId);return cl(()=>{S.value&&(o.serviceDefinitionId=i.serviceDefinitionId,o.page=1,p.value=[],D())}),te(()=>i.show,I=>{I||y()}),te(c,I=>{I||y()}),(I,s)=>(E(),X(je,null,[t(e(Qe),{show:N.value,"onUpdate:show":s[5]||(s[5]=f=>N.value=f),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(e(fe),{style:{width:"1200px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",zn,[t(e(O),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(Ae))]),_:1}),s[7]||(s[7]=a("div",{class:"header-content"},[a("h3",{class:"modal-title"},"服务节点管理"),a("p",{class:"modal-subtitle"},"管理服务的后端节点实例")],-1))])]),"header-extra":l(()=>[t(e(Y),{quaternary:"",circle:"",onClick:oe,class:"close-btn"},{icon:l(()=>[t(e(O),{size:"18"},{default:l(()=>[t(e(ct))]),_:1})]),_:1})]),action:l(()=>[t(e(Ne),null,{default:l(()=>[t(e(Y),{onClick:oe},{default:l(()=>s[15]||(s[15]=[_("关闭")])),_:1})]),_:1})]),default:l(()=>[a("div",Dn,[a("div",On,[t(e(Ye),{inline:"","label-width":80,size:"small"},{default:l(()=>[t(e(B),{label:"节点主机"},{default:l(()=>[t(e(ue),{value:e(o).nodeHost,"onUpdate:value":s[0]||(s[0]=f=>e(o).nodeHost=f),placeholder:"请输入主机地址",style:{width:"180px"},onKeydown:pl(e(ee),["enter"])},null,8,["value","onKeydown"])]),_:1}),t(e(B),{label:"健康状态"},{default:l(()=>[t(e(ge),{value:e(o).healthStatus,"onUpdate:value":s[1]||(s[1]=f=>e(o).healthStatus=f),options:e(b),placeholder:"请选择",style:{width:"120px"}},null,8,["value","options"])]),_:1}),t(e(B),{label:"运行状态"},{default:l(()=>[t(e(ge),{value:e(o).nodeStatus,"onUpdate:value":s[2]||(s[2]=f=>e(o).nodeStatus=f),options:e(T),placeholder:"请选择",style:{width:"120px"}},null,8,["value","options"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(Ne),null,{default:l(()=>[t(e(Y),{type:"primary",onClick:e(ee),loading:e(x),size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Nt))]),_:1})]),default:l(()=>[s[8]||(s[8]=_(" 查询 "))]),_:1},8,["onClick","loading"]),t(e(Y),{onClick:e(M),size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Be))]),_:1})]),default:l(()=>[s[9]||(s[9]=_(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),a("div",Un,[t(e(Ne),null,{default:l(()=>[t(e(Y),{type:"primary",onClick:J,size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(ut))]),_:1})]),default:l(()=>[s[10]||(s[10]=_(" 新建节点 "))]),_:1}),t(e(Y),{type:"error",disabled:!e(V),onClick:e(L),size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Fe))]),_:1})]),default:l(()=>[s[11]||(s[11]=_(" 批量删除 "))]),_:1},8,["disabled","onClick"]),t(e(Y),{type:"success",disabled:!e(V),onClick:s[3]||(s[3]=()=>e(k)("Y")),size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Ie))]),_:1})]),default:l(()=>[s[12]||(s[12]=_(" 批量启用 "))]),_:1},8,["disabled"]),t(e(Y),{type:"warning",disabled:!e(V),onClick:s[4]||(s[4]=()=>e(k)("N")),size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Le))]),_:1})]),default:l(()=>[s[13]||(s[13]=_(" 批量禁用 "))]),_:1},8,["disabled"]),t(e(Y),{onClick:e(m),size:"small"},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Be))]),_:1})]),default:l(()=>[s[14]||(s[14]=_(" 刷新 "))]),_:1},8,["onClick"])]),_:1})]),a("div",En,[t(e(pt),{columns:e(F),data:e(v),loading:e(x),"row-key":f=>f.serviceNodeId,"checked-row-keys":e(p),"onUpdate:checkedRowKeys":e(U),pagination:e(A),"scroll-x":1400,size:"small",striped:"",class:"custom-table"},null,8,["columns","data","loading","row-key","checked-row-keys","onUpdate:checkedRowKeys","pagination"])])])]),_:1})]),_:1},8,["show"]),t(Nn,{show:e(c),"onUpdate:show":s[6]||(s[6]=f=>Xe(c)?c.value=f:null),"form-data":e($),mode:e(C),"service-definition-id":I.serviceDefinitionId,onRefresh:le,onClose:e(y)},null,8,["show","form-data","mode","service-definition-id","onClose"])],64))}}),Rn=xe($n,[["__scopeId","data-v-b68e03fb"]]);function Hn(u){const g=Ce(),i=H(!1),r=H([]),x=H(0),v=H([]),p=H(!1),o=H(!1),c=H("add"),C=H(null),$=H(""),b=ve({serviceName:"",serviceType:void 0,loadBalanceStrategy:void 0,activeFlag:void 0,proxyConfigId:u,pageIndex:1,pageSize:10}),T=[{label:"静态配置",value:Se.STATIC},{label:"服务发现",value:Se.DISCOVERY}],V=[{label:"轮询算法",value:ae.ROUND_ROBIN},{label:"随机算法",value:ae.RANDOM},{label:"IP哈希算法",value:ae.IP_HASH},{label:"最少连接算法",value:ae.LEAST_CONN},{label:"加权轮询算法",value:ae.WEIGHTED_ROUND_ROBIN},{label:"一致性哈希算法",value:ae.CONSISTENT_HASH}],A=[{label:"全部",value:void 0},{label:"启用",value:"Y"},{label:"禁用",value:"N"}],F=q(()=>v.value.length>0),D=q(()=>({page:b.pageIndex,pageSize:b.pageSize,itemCount:x.value,showSizePicker:!0,pageSizes:[10,20,50,100],showQuickJumper:!0,prefix:s=>`共 ${s.itemCount||0} 条`,onUpdatePage:s=>{b.pageIndex=s,L()},onUpdatePageSize:s=>{b.pageSize=s,b.pageIndex=1,L()}})),R=[{type:"selection",fixed:"left"},{title:"服务名称",key:"serviceName",width:200,ellipsis:{tooltip:!0}},{title:"服务类型",key:"serviceType",width:120,align:"center",render:s=>h(G,{type:s.serviceType===Se.STATIC?"info":"success",size:"small"},()=>s.serviceType===Se.STATIC?"静态配置":"服务发现")},{title:"负载均衡策略",key:"loadBalanceStrategy",width:150,align:"center",render:s=>{const f={[ae.ROUND_ROBIN]:"轮询",[ae.RANDOM]:"随机",[ae.IP_HASH]:"IP哈希",[ae.LEAST_CONN]:"最少连接",[ae.WEIGHTED_ROUND_ROBIN]:"加权轮询",[ae.CONSISTENT_HASH]:"一致性哈希"};return h(G,{type:"default",size:"small"},()=>f[s.loadBalanceStrategy]||s.loadBalanceStrategy)}},{title:"服务节点",key:"nodeCount",width:100,align:"center",render:()=>0},{title:"健康检查",key:"healthCheckEnabled",width:120,align:"center",render:s=>h(G,{type:s.healthCheckEnabled==="Y"?"success":"default",size:"small"},()=>s.healthCheckEnabled==="Y"?"已启用":"未启用")},{title:"状态",key:"activeFlag",width:100,align:"center",render:s=>h(G,{type:s.activeFlag==="Y"?"success":"error",size:"small"},()=>s.activeFlag==="Y"?"启用":"禁用")},{title:"创建时间",key:"createTime",width:180,align:"center"},{title:"操作",key:"actions",width:280,align:"center",fixed:"right",render:s=>h(Ne,{size:"small"},()=>[h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"primary",secondary:!0,onClick:()=>y(s)},()=>h(O,{size:14},()=>h(et))),default:()=>"编辑"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"info",secondary:!0,onClick:()=>oe(s)},()=>h(O,{size:14},()=>h(It))),default:()=>"节点管理"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:s.activeFlag==="Y"?"warning":"success",secondary:!0,onClick:()=>M(s)},()=>h(O,{size:14},()=>h(s.activeFlag==="Y"?Le:Ie))),default:()=>s.activeFlag==="Y"?"禁用":"启用"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"info",secondary:!0,onClick:()=>N(s)},()=>h(O,{size:14},()=>h(Ut))),default:()=>"复制"}),h(Ge,{onPositiveClick:()=>U(s),negativeText:"取消",positiveText:"确认"},{trigger:()=>h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"error",secondary:!0},()=>h(O,{size:14},()=>h(Fe))),default:()=>"删除"}),default:()=>"确认删除该服务定义吗？"})])}];async function L(){try{i.value=!0;const s=await Ra(b);if(s.oK){const f=JSON.parse(s.bizData);if(Array.isArray(f)){if(r.value=f,s.pageQueryData){const P=JSON.parse(s.pageQueryData);x.value=P.totalCount||0}}else r.value=f.records||[],x.value=f.total||0}}catch(s){g.error("加载服务定义列表失败: "+(s.message||"未知错误"))}finally{i.value=!1}}function k(){c.value="add",C.value={proxyConfigId:u,serviceName:"",serviceDesc:"",serviceType:Se.STATIC,loadBalanceStrategy:ae.ROUND_ROBIN,sessionAffinity:"N",stickySession:"N",maxRetries:3,retryTimeoutMs:5e3,enableCircuitBreaker:"N",healthCheckEnabled:"Y",healthCheckPath:"/health",healthCheckMethod:"GET",healthCheckIntervalSeconds:30,healthCheckTimeoutMs:5e3,healthyThreshold:2,unhealthyThreshold:3,expectedStatusCodes:"200",activeFlag:"Y",noteText:""},p.value=!0}function y(s){c.value="edit",C.value={serviceDefinitionId:s.serviceDefinitionId,proxyConfigId:u,serviceName:s.serviceName,serviceDesc:s.serviceDesc,serviceType:s.serviceType,loadBalanceStrategy:s.loadBalanceStrategy,sessionAffinity:s.sessionAffinity||"N",stickySession:s.stickySession||"N",maxRetries:s.maxRetries||3,retryTimeoutMs:s.retryTimeoutMs||5e3,enableCircuitBreaker:s.enableCircuitBreaker||"N",healthCheckEnabled:s.healthCheckEnabled||"Y",healthCheckPath:s.healthCheckPath||"/health",healthCheckMethod:s.healthCheckMethod||"GET",healthCheckIntervalSeconds:s.healthCheckIntervalSeconds||30,healthCheckTimeoutMs:s.healthCheckTimeoutMs||5e3,healthyThreshold:s.healthyThreshold||2,unhealthyThreshold:s.unhealthyThreshold||3,expectedStatusCodes:s.expectedStatusCodes||"200",discoveryType:s.discoveryType,discoveryConfig:s.discoveryConfig,activeFlag:s.activeFlag,noteText:s.noteText},p.value=!0}async function U(s){try{const f=await bt(s.serviceDefinitionId,"default");f.oK?(g.success("删除成功"),await L()):g.error(f.messageId||"删除失败")}catch(f){g.error("删除失败: "+(f.message||"未知错误"))}}async function ee(){if(v.value.length===0){g.warning("请选择要删除的服务定义");return}try{const s=v.value.map(d=>bt(d,"default")),P=(await Promise.all(s)).filter(d=>d.oK).length;P===v.value.length?g.success(`成功删除 ${P} 个服务定义`):g.warning(`删除了 ${P}/${v.value.length} 个服务定义`),v.value=[],await L()}catch(s){g.error("批量删除失败: "+(s.message||"未知错误"))}}async function M(s){const f=s.activeFlag==="Y"?"N":"Y",P=f==="Y"?"启用":"禁用";try{const d=await st({serviceDefinitionId:s.serviceDefinitionId,tenantId:"default",activeFlag:f});d.oK?(g.success(`${P}成功`),await L()):g.error(d.messageId||`${P}失败`)}catch(d){g.error(`${P}失败: `+(d.message||"未知错误"))}}async function m(s){if(v.value.length===0){g.warning("请选择要操作的服务定义");return}const f=s==="Y"?"启用":"禁用";try{const P=v.value.map(j=>st({serviceDefinitionId:j,tenantId:"default",activeFlag:s})),n=(await Promise.all(P)).filter(j=>j.oK).length;n===v.value.length?g.success(`成功${f} ${n} 个服务定义`):g.warning(`${f}了 ${n}/${v.value.length} 个服务定义`),v.value=[],await L()}catch(P){g.error(`批量${f}失败: `+(P.message||"未知错误"))}}function N(s){c.value="add",C.value={proxyConfigId:u,serviceName:`${s.serviceName}_copy`,serviceDesc:s.serviceDesc,serviceType:s.serviceType,loadBalanceStrategy:s.loadBalanceStrategy,sessionAffinity:s.sessionAffinity||"N",stickySession:s.stickySession||"N",maxRetries:s.maxRetries||3,retryTimeoutMs:s.retryTimeoutMs||5e3,enableCircuitBreaker:s.enableCircuitBreaker||"N",healthCheckEnabled:s.healthCheckEnabled||"Y",healthCheckPath:s.healthCheckPath||"/health",healthCheckMethod:s.healthCheckMethod||"GET",healthCheckIntervalSeconds:s.healthCheckIntervalSeconds||30,healthCheckTimeoutMs:s.healthCheckTimeoutMs||5e3,healthyThreshold:s.healthyThreshold||2,unhealthyThreshold:s.unhealthyThreshold||3,expectedStatusCodes:s.expectedStatusCodes||"200",discoveryType:s.discoveryType,discoveryConfig:s.discoveryConfig,activeFlag:"Y",noteText:s.noteText},p.value=!0}function oe(s){o.value=!1,Ee(()=>{$.value=s.serviceDefinitionId,o.value=!0})}function le(s){v.value=s.map(f=>String(f))}function J(){b.pageIndex=1,L()}function S(){Object.assign(b,{serviceName:"",serviceType:void 0,loadBalanceStrategy:void 0,activeFlag:void 0,pageIndex:1,pageSize:10}),L()}function I(){L()}return{loading:i,serviceList:r,totalCount:x,selectedRowKeys:v,queryParams:b,showDialog:p,showNodeDialog:o,dialogMode:c,currentFormData:C,currentServiceId:$,serviceTypeOptions:T,loadBalanceStrategyOptions:V,statusOptions:A,hasSelection:F,paginationProps:D,columns:R,loadServiceList:L,handleAdd:k,handleEdit:y,handleDelete:U,handleBatchDelete:ee,handleToggleStatus:M,handleBatchToggle:m,handleCopy:N,handleManageNodes:oe,handleSelectionChange:le,search:J,resetQuery:S,refresh:I}}const Fn={class:"service-definition-manager"},Mn=Z({__name:"ServiceDefinitionManager",props:{proxyConfigId:{}},emits:["refresh"],setup(u,{emit:g}){const i=u,r=g,{loading:x,serviceList:v,selectedRowKeys:p,queryParams:o,showDialog:c,showNodeDialog:C,dialogMode:$,currentFormData:b,currentServiceId:T,serviceTypeOptions:V,loadBalanceStrategyOptions:A,statusOptions:F,hasSelection:D,paginationProps:R,columns:L,loadServiceList:k,handleAdd:y,handleBatchDelete:U,handleBatchToggle:ee,handleSelectionChange:M,search:m,resetQuery:N,refresh:oe}=Hn(i.proxyConfigId);function le(){oe(),r("refresh")}return Ze(()=>{k()}),(J,S)=>(E(),X("div",Fn,[t(e(fe),{size:"small",class:"search-card"},{default:l(()=>[t(e(Ye),{inline:"",model:e(o),"label-placement":"left"},{default:l(()=>[t(e(B),{label:"服务名称"},{default:l(()=>[t(e(ue),{value:e(o).serviceName,"onUpdate:value":S[0]||(S[0]=I=>e(o).serviceName=I),placeholder:"请输入服务名称",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),t(e(B),{label:"服务类型"},{default:l(()=>[t(e(ge),{value:e(o).serviceType,"onUpdate:value":S[1]||(S[1]=I=>e(o).serviceType=I),placeholder:"请选择服务类型",clearable:"",style:{width:"150px"},options:e(V)},null,8,["value","options"])]),_:1}),t(e(B),{label:"负载均衡策略"},{default:l(()=>[t(e(ge),{value:e(o).loadBalanceStrategy,"onUpdate:value":S[2]||(S[2]=I=>e(o).loadBalanceStrategy=I),placeholder:"请选择负载均衡策略",clearable:"",style:{width:"180px"},options:e(A)},null,8,["value","options"])]),_:1}),t(e(B),{label:"状态"},{default:l(()=>[t(e(ge),{value:e(o).activeFlag,"onUpdate:value":S[3]||(S[3]=I=>e(o).activeFlag=I),placeholder:"请选择状态",style:{width:"120px"},options:e(F)},null,8,["value","options"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(Y),{type:"primary",onClick:e(m)},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Nt))]),_:1})]),default:l(()=>[S[8]||(S[8]=_(" 搜索 "))]),_:1},8,["onClick"]),t(e(Y),{onClick:e(N),style:{"margin-left":"8px"}},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Be))]),_:1})]),default:l(()=>[S[9]||(S[9]=_(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),t(e(fe),{size:"small",class:"action-card"},{default:l(()=>[t(e(Ne),null,{default:l(()=>[t(e(Y),{type:"primary",onClick:e(y)},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(ut))]),_:1})]),default:l(()=>[S[10]||(S[10]=_(" 新增服务 "))]),_:1},8,["onClick"]),t(e(Y),{type:"error",disabled:!e(D),onClick:e(U)},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Fe))]),_:1})]),default:l(()=>[S[11]||(S[11]=_(" 批量删除 "))]),_:1},8,["disabled","onClick"]),t(e(Y),{type:"success",disabled:!e(D),onClick:S[4]||(S[4]=()=>e(ee)("Y"))},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Ie))]),_:1})]),default:l(()=>[S[12]||(S[12]=_(" 批量启用 "))]),_:1},8,["disabled"]),t(e(Y),{type:"warning",disabled:!e(D),onClick:S[5]||(S[5]=()=>e(ee)("N"))},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Le))]),_:1})]),default:l(()=>[S[13]||(S[13]=_(" 批量禁用 "))]),_:1},8,["disabled"]),t(e(Y),{onClick:le},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Be))]),_:1})]),default:l(()=>[S[14]||(S[14]=_(" 刷新 "))]),_:1})]),_:1})]),_:1}),t(e(fe),null,{default:l(()=>[t(e(pt),{ref:"dataTableRef",columns:e(L),data:e(v),loading:e(x),pagination:e(R),"row-key":I=>I.serviceDefinitionId,"checked-row-keys":e(p),"onUpdate:checkedRowKeys":e(M),size:"small",striped:"",remote:""},null,8,["columns","data","loading","pagination","row-key","checked-row-keys","onUpdate:checkedRowKeys"])]),_:1}),t(Cn,{show:e(c),"onUpdate:show":S[6]||(S[6]=I=>Xe(c)?c.value=I:null),"form-data":e(b),mode:e($),"proxy-config-id":i.proxyConfigId,onRefresh:le},null,8,["show","form-data","mode","proxy-config-id"]),t(Rn,{show:e(C),"onUpdate:show":S[7]||(S[7]=I=>Xe(C)?C.value=I:null),"service-definition-id":e(T),onRefresh:le},null,8,["show","service-definition-id"])]))}}),An=xe(Mn,[["__scopeId","data-v-67ea6104"]]),Bn={class:"proxy-test-panel"},Yn={class:"card-header"},Ln={style:{display:"flex","align-items":"center",width:"100%"}},Vn={class:"card-header"},jn={key:0,class:"test-statistics"},Jn={class:"test-results-list"},qn=Z({__name:"ProxyTestPanel",props:{gatewayInstanceId:{}},setup(u){const g=u,i=Ce(),r=H(null),x=H(!1),v=H(!1),p=H(!1),o=H([]),c=H([]),C=ve({proxyConfigId:"",testUrl:"http://httpbin.org/get",method:"GET",headers:{},timeout:5e3,concurrency:1}),$=H([]),b=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"HEAD",value:"HEAD"},{label:"OPTIONS",value:"OPTIONS"}],T=q(()=>["POST","PUT","PATCH"].includes(C.method)),V=q(()=>{if(c.value.length===0)return 0;const J=c.value.filter(S=>S.success).length;return Math.round(J/c.value.length*100)}),A=q(()=>{if(c.value.length===0)return 0;const J=c.value.reduce((S,I)=>S+I.responseTime,0);return Math.round(J/c.value.length)}),F=q(()=>c.value.length===0?0:Math.min(...c.value.map(J=>J.responseTime))),D=q(()=>c.value.length===0?0:Math.max(...c.value.map(J=>J.responseTime))),R={proxyConfigId:[{required:!0,message:"请选择代理配置",trigger:["blur","change"]}],testUrl:[{required:!0,message:"请输入测试URL",trigger:["blur","input"]},{type:"url",message:"请输入有效的URL",trigger:["blur","input"]}],method:[{required:!0,message:"请选择请求方法",trigger:["blur","change"]}],timeout:[{required:!0,message:"请输入超时时间",trigger:["blur","change"]},{type:"number",min:100,max:6e4,message:"超时时间必须在100-60000毫秒之间",trigger:["blur","change"]}]},L=[{title:"序号",key:"testIndex",width:80,align:"center"},{title:"状态",key:"success",width:100,align:"center",render:J=>h(O,{size:20,color:J.success?"#18a058":"#d03050"},()=>h(J.success?Ie:We))},{title:"状态码",key:"statusCode",width:100,align:"center"},{title:"响应时间(ms)",key:"responseTime",width:120,align:"center"},{title:"错误信息",key:"errorMessage",ellipsis:{tooltip:!0}},{title:"测试时间",key:"testTime",width:180,align:"center"}];function k(){return{key:"",value:""}}async function y(){if(g.gatewayInstanceId)try{p.value=!0;const J=await Rt({gatewayInstanceId:g.gatewayInstanceId,activeFlag:"Y",pageIndex:1,pageSize:100});if(J.oK){const S=JSON.parse(J.bizData);o.value=(S.records||[]).map(I=>({label:`${I.proxyName} (${I.proxyType})`,value:I.proxyConfigId}))}}catch(J){console.error("加载代理配置失败:",J),i.error("加载代理配置失败")}finally{p.value=!1}}function U(){}async function ee(){var S;await((S=r.value)==null?void 0:S.validate())&&await m(1)}async function M(){var S;await((S=r.value)==null?void 0:S.validate())&&await m(C.concurrency)}async function m(J){const I=J>1?v:x;try{I.value=!0;const s={proxyConfigId:C.proxyConfigId,testUrl:C.testUrl,method:C.method,headers:$.value.reduce((P,d)=>(d.key.trim()&&(P[d.key.trim()]=d.value),P),{}),body:T.value?C.body:void 0,timeout:C.timeout,tenantId:"default"},f=Array.from({length:J},(P,d)=>N(s,d+1));await Promise.all(f),i.success(`测试完成，共执行 ${J} 次`)}catch(s){i.error("测试执行失败: "+(s.message||"未知错误"))}finally{I.value=!1}}async function N(J,S){try{const I=Date.now(),s=await $a(J);let f;s.oK?f=JSON.parse(s.bizData):f={success:!1,responseTime:Date.now()-I,errorMessage:s.messageId||"测试失败"},c.value.push({...f,testTime:new Date().toLocaleString(),testIndex:c.value.length+1})}catch(I){c.value.push({success:!1,responseTime:0,errorMessage:I.message||"网络错误",testTime:new Date().toLocaleString(),testIndex:c.value.length+1})}}function oe(){Object.assign(C,{proxyConfigId:"",testUrl:"http://httpbin.org/get",method:"GET",body:"",timeout:5e3,concurrency:1}),$.value=[]}function le(){c.value=[]}return Ze(()=>{g.gatewayInstanceId&&y()}),(J,S)=>(E(),X("div",Bn,[t(e(fe),{size:"small",class:"test-config-card"},{header:l(()=>[a("div",Yn,[t(e(O),{size:"20"},{default:l(()=>[t(e(kt))]),_:1}),S[7]||(S[7]=a("span",null,"代理测试配置",-1))])]),default:l(()=>[t(e(Ye),{ref_key:"formRef",ref:r,model:C,rules:R,"label-placement":"left","label-width":"120px"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(B),{label:"代理配置",path:"proxyConfigId"},{default:l(()=>[t(e(ge),{value:C.proxyConfigId,"onUpdate:value":[S[0]||(S[0]=I=>C.proxyConfigId=I),U],placeholder:"请选择代理配置",options:o.value,loading:p.value},null,8,["value","options","loading"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"请求方法",path:"method"},{default:l(()=>[t(e(ge),{value:C.method,"onUpdate:value":S[1]||(S[1]=I=>C.method=I),options:b},null,8,["value"])]),_:1})]),_:1}),t(e(K),{span:2},{default:l(()=>[t(e(B),{label:"测试URL",path:"testUrl"},{default:l(()=>[t(e(ue),{value:C.testUrl,"onUpdate:value":S[2]||(S[2]=I=>C.testUrl=I),placeholder:"请输入测试URL，如: http://example.com/api/test"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"超时时间(ms)",path:"timeout"},{default:l(()=>[t(e(ke),{value:C.timeout,"onUpdate:value":S[3]||(S[3]=I=>C.timeout=I),min:100,max:6e4,placeholder:"请输入超时时间"},null,8,["value"])]),_:1})]),_:1}),t(e(K),null,{default:l(()=>[t(e(B),{label:"并发数量",path:"concurrency"},{default:l(()=>[t(e(ke),{value:C.concurrency,"onUpdate:value":S[4]||(S[4]=I=>C.concurrency=I),min:1,max:100,placeholder:"请输入并发数量"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(B),{label:"请求头"},{default:l(()=>[t(e(Dt),{value:$.value,"onUpdate:value":S[5]||(S[5]=I=>$.value=I),"on-create":k},{default:l(({index:I,value:s})=>[a("div",Ln,[t(e(ue),{value:s.key,"onUpdate:value":f=>s.key=f,placeholder:"Header名称",style:{"margin-right":"12px"}},null,8,["value","onUpdate:value"]),t(e(ue),{value:s.value,"onUpdate:value":f=>s.value=f,placeholder:"Header值"},null,8,["value","onUpdate:value"])])]),_:1},8,["value"])]),_:1}),T.value?(E(),Q(e(B),{key:0,label:"请求体"},{default:l(()=>[t(e(ue),{value:C.body,"onUpdate:value":S[6]||(S[6]=I=>C.body=I),type:"textarea",placeholder:"请输入请求体内容（JSON格式）",rows:4},null,8,["value"])]),_:1})):de("",!0),t(e(B),null,{default:l(()=>[t(e(Ne),null,{default:l(()=>[t(e(Y),{type:"primary",loading:x.value,onClick:ee,disabled:!C.proxyConfigId},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(zt))]),_:1})]),default:l(()=>[_(" "+z(x.value?"测试中...":"开始测试"),1)]),_:1},8,["loading","disabled"]),t(e(Y),{type:"info",loading:v.value,onClick:M,disabled:!C.proxyConfigId||C.concurrency<=1},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(ot))]),_:1})]),default:l(()=>[_(" "+z(v.value?"批量测试中...":"批量测试"),1)]),_:1},8,["loading","disabled"]),t(e(Y),{onClick:oe},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Be))]),_:1})]),default:l(()=>[S[8]||(S[8]=_(" 重置 "))]),_:1}),t(e(Y),{onClick:le},{icon:l(()=>[t(e(O),null,{default:l(()=>[t(e(Fe))]),_:1})]),default:l(()=>[S[9]||(S[9]=_(" 清除结果 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(e(fe),{class:"test-results-card"},{header:l(()=>[a("div",Vn,[t(e(O),{size:"20"},{default:l(()=>[t(e(fl))]),_:1}),S[10]||(S[10]=a("span",null,"测试结果",-1)),c.value.length>0?(E(),Q(e(G),{key:0,type:"info",size:"small"},{default:l(()=>[_(" 共 "+z(c.value.length)+" 次测试 ",1)]),_:1})):de("",!0)])]),default:l(()=>[c.value.length>0?(E(),X("div",jn,[t(e(De),{cols:4,"x-gap":16},{default:l(()=>[t(e(K),null,{default:l(()=>[t(e(qe),{label:"成功率",value:V.value,suffix:"%"},{prefix:l(()=>[t(e(O),{color:"#18a058"},{default:l(()=>[t(e(Ie))]),_:1})]),_:1},8,["value"])]),_:1}),t(e(K),null,{default:l(()=>[t(e(qe),{label:"平均响应时间",value:A.value,suffix:"ms"},{prefix:l(()=>[t(e(O),{color:"#2080f0"},{default:l(()=>[t(e(Cl))]),_:1})]),_:1},8,["value"])]),_:1}),t(e(K),null,{default:l(()=>[t(e(qe),{label:"最快响应",value:F.value,suffix:"ms"},{prefix:l(()=>[t(e(O),{color:"#36ad6a"},{default:l(()=>[t(e(ht))]),_:1})]),_:1},8,["value"])]),_:1}),t(e(K),null,{default:l(()=>[t(e(qe),{label:"最慢响应",value:D.value,suffix:"ms"},{prefix:l(()=>[t(e(O),{color:"#d03050"},{default:l(()=>[t(e(ht))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])):de("",!0),a("div",Jn,[c.value.length>0?(E(),Q(e(pt),{key:0,columns:L,data:c.value,pagination:!1,size:"small","max-height":"400px","virtual-scroll":""},null,8,["data"])):(E(),Q(e(it),{key:1,description:"暂无测试结果，请点击 开始测试 按钮进行测试"}))])]),_:1})]))}}),Wn=xe(qn,[["__scopeId","data-v-ec8be743"]]);function Kn(u){const g=Ce(),i=H(!1),r=H([]),x=H(0),v=H([]),p=q(()=>{const d=r.value;return{total:d.length,active:d.filter(n=>n.activeFlag==="Y").length,inactive:d.filter(n=>n.activeFlag==="N").length,httpCount:d.filter(n=>n.proxyType==="http").length,websocketCount:d.filter(n=>n.proxyType==="websocket").length,tcpCount:d.filter(n=>n.proxyType==="tcp").length,udpCount:d.filter(n=>n.proxyType==="udp").length}}),o=ve({gatewayInstanceId:e(u),proxyName:"",proxyType:void 0,activeFlag:"Y",pageIndex:1,pageSize:10});te(()=>e(u),d=>{d?o.gatewayInstanceId!==d&&(o.gatewayInstanceId=d,o.proxyName="",o.proxyType=void 0,o.activeFlag="Y",o.pageIndex=1,v.value=[]):(r.value=[],x.value=0,v.value=[])},{immediate:!0});const c=H(!1),C=H(!1),$=H("add"),b=H({}),T=H(""),V=[{label:"HTTP",value:"http"},{label:"WebSocket",value:"websocket"},{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],A=[{label:"全部",value:void 0},{label:"已启用",value:"Y"},{label:"已禁用",value:"N"}],F=q(()=>v.value.length>0),D=q(()=>({page:o.pageIndex,pageSize:o.pageSize,itemCount:x.value,showSizePicker:!0,pageSizes:[10,20,50,100],onUpdatePage:d=>{o.pageIndex=d,U()},onUpdatePageSize:d=>{o.pageSize=d,o.pageIndex=1,U()}}));function R(d){const j={http:{color:"info",label:"HTTP"},websocket:{color:"warning",label:"WebSocket"},tcp:{color:"success",label:"TCP"},udp:{color:"error",label:"UDP"}}[d]||{color:"default",label:d};return h(G,{type:j.color,size:"small"},()=>j.label)}function L(d){return h(G,{type:d==="Y"?"success":"error",size:"small"},()=>d==="Y"?"已启用":"已禁用")}function k(d){return h(Ne,{size:"small"},()=>[h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"primary",quaternary:!0,onClick:()=>M(d)},{default:()=>h(O,null,()=>h(et))}),default:()=>"编辑"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"info",quaternary:!0,onClick:()=>m(d.proxyConfigId)},{default:()=>h(O,null,()=>h(zt))}),default:()=>"测试"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:d.activeFlag==="Y"?"warning":"success",quaternary:!0,onClick:()=>le(d)},{default:()=>h(O,null,()=>h(d.activeFlag==="Y"?Le:Ie))}),default:()=>d.activeFlag==="Y"?"禁用":"启用"}),h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"info",quaternary:!0,onClick:()=>S(d.proxyConfigId)},{default:()=>h(O,null,()=>h(Ut))}),default:()=>"复制"}),h(Ge,{onPositiveClick:()=>N(d.proxyConfigId)},{trigger:()=>h(be,{trigger:"hover"},{trigger:()=>h(Y,{size:"small",type:"error",quaternary:!0},{default:()=>h(O,null,()=>h(Fe))}),default:()=>"删除"}),default:()=>"确认删除这个代理配置吗？"})])}const y=[{type:"selection"},{title:"代理名称",key:"proxyName",width:180,ellipsis:{tooltip:!0}},{title:"代理类型",key:"proxyType",width:120,render:d=>R(d.proxyType)},{title:"优先级",key:"configPriority",width:100,align:"center"},{title:"状态",key:"activeFlag",width:100,align:"center",render:d=>L(d.activeFlag)},{title:"备注",key:"noteText",width:200,ellipsis:{tooltip:!0}},{title:"更新时间",key:"editTime",width:180,render:d=>new Date(d.editTime).toLocaleString()},{title:"操作",key:"actions",width:200,align:"center",render:d=>k(d)}];async function U(){if(!o.gatewayInstanceId){console.warn("gatewayInstanceId 为空，跳过加载");return}console.log("TODO: 实现代理配置加载API，实例ID:",o.gatewayInstanceId),r.value=[],x.value=0}function ee(){$.value="add",b.value={gatewayInstanceId:e(u),proxyName:"",proxyType:"http",configPriority:0,proxyConfig:{},activeFlag:"Y"},c.value=!0}function M(d){$.value="edit",b.value={...d},c.value=!0}function m(d){T.value=d,C.value=!0}async function N(d){try{g.success("删除成功"),await U()}catch(n){console.error("删除代理配置失败:",n),g.error("删除失败")}}async function oe(){if(v.value.length!==0)try{g.success(`成功删除 ${v.value.length} 个代理配置`),v.value=[],await U()}catch(d){console.error("批量删除失败:",d),g.error("批量删除失败")}}async function le(d){try{const n=d.activeFlag==="Y"?"N":"Y";g.success(`${n==="Y"?"启用":"禁用"}成功`),await U()}catch(n){console.error("状态切换失败:",n),g.error("状态切换失败")}}async function J(d){if(v.value.length!==0)try{const n=d==="Y"?"启用":"禁用";g.success(`批量${n}成功`),v.value=[],await U()}catch(n){console.error("批量操作失败:",n),g.error("批量操作失败")}}async function S(d){try{g.success("复制成功"),await U()}catch(n){console.error("复制失败:",n),g.error("复制失败")}}function I(d){v.value=d}function s(){o.pageIndex=1,U()}function f(){Object.assign(o,{gatewayInstanceId:e(u),proxyName:"",proxyType:void 0,activeFlag:"Y",pageIndex:1,pageSize:20}),U()}function P(){U()}return{loading:i,proxyList:r,totalCount:x,selectedRowKeys:v,queryParams:o,showDialog:c,showTestDialog:C,dialogMode:$,currentFormData:b,testProxyId:T,proxyTypeOptions:V,statusOptions:A,hasSelection:F,paginationProps:D,columns:y,statistics:p,loadProxyList:U,handleAdd:ee,handleEdit:M,handleTest:m,handleDelete:N,handleBatchDelete:oe,handleToggleStatus:le,handleBatchToggle:J,handleCopy:S,handleSelectionChange:I,search:s,resetQuery:f,refresh:P}}function Xn(){const u=Ce(),g=H(!1),i=H([]),r=H(""),x=H(null),v=H(!1),p=H(null),o=q(()=>r.value||""),c=q(()=>!!r.value),C=q(()=>i.value.map(A=>{const F=A.tlsEnabled==="Y"?A.httpsPort:A.httpPort;return{label:`${A.instanceName||"未命名"} (${A.bindAddress||"-"}:${F||"-"})`,value:A.gatewayInstanceId,disabled:A.activeFlag!=="Y"}}));function $(){v.value=!v.value}async function b(){try{g.value=!0;const A=await Oa({page:1,size:100,activeFlag:"Y"});if(A.oK===!0&&A.state===!0)try{const F=JSON.parse(A.bizData||"[]");i.value=F||[],i.value.length>0&&T(i.value[0].gatewayInstanceId)}catch(F){console.error("解析网关实例数据失败:",F),u.error("解析网关实例数据失败")}else u.error(A.errMsg||"获取网关实例列表失败")}catch(A){console.error("加载网关实例失败:",A),u.error("加载网关实例失败")}finally{g.value=!1}}function T(A){r.value=A,x.value=i.value.find(F=>F.gatewayInstanceId===A)||null}function V(A){p.value=A}return{loadingInstances:g,instanceList:i,selectedInstanceId:r,selectedInstance:x,instanceDetailsVisible:v,instanceProxyType:p,gatewayInstanceId:o,hasSelectedInstance:c,instanceOptions:C,toggleInstanceDetails:$,loadGatewayInstances:b,handleInstanceChange:T,setInstanceProxyType:V}}const Gn={class:"proxy-management"},Qn={class:"instance-header"},Zn={class:"instance-selector"},eo={class:"select-empty"},to={class:"instance-content"},lo={class:"instance-details"},ao={class:"tab-content"},no={class:"tab-description"},oo={class:"info-content"},so={class:"tab-content"},ro={class:"tab-description"},io={class:"info-content"},uo={class:"proxy-selector-header"},co={class:"proxy-selector-content"},po={class:"proxy-info"},fo={class:"warning-content"},go={class:"warning-content"},vo={class:"tab-content"},yo={class:"tab-description"},mo={class:"info-content"},ho=Z({__name:"ProxyManagement",setup(u){const g=H("proxy"),i=H(null),r=H(null),{loadingInstances:x,selectedInstanceId:v,selectedInstance:p,instanceDetailsVisible:o,instanceProxyType:c,gatewayInstanceId:C,hasSelectedInstance:$,instanceOptions:b,toggleInstanceDetails:T,loadGatewayInstances:V,handleInstanceChange:A,setInstanceProxyType:F}=Xn(),{getProxyTypeName:D}=$t(),R=Kn(C),L=()=>p.value?p.value.instanceName||"未命名":"";te(C,(I,s)=>{I!==s&&(k(),I&&Ee(()=>{y()}))},{immediate:!1});function k(){i.value=null,r.value=null,F(null),g.value="proxy"}async function y(){if($.value)try{await R.loadProxyList(),Ee(()=>{M()})}catch(I){console.error("加载代理数据失败:",I)}}function U(I){A(I),g.value="proxy",Ee(()=>{ee()})}async function ee(){if($.value){await Ee();try{g.value==="proxy"&&await y()}catch(I){console.error("刷新组件时发生错误:",I)}}}function M(){r.value?(F(r.value.proxyType),i.value=r.value):(F(null),i.value=null)}function m(I){F(I)}function N(I){r.value=I,I?(F(I.proxyType),i.value=I):(F(null),i.value=null)}function oe(I){g.value=I,setTimeout(()=>{ee()},200)}function le(){g.value==="proxy"?y():ee()}function J(I){i.value=I}function S(){i.value=null,r.value=null,g.value="proxy"}return Ze(()=>{V()}),(I,s)=>(E(),X("div",Gn,[t(e(fe),{class:"instance-selector-card",size:"small"},{header:l(()=>[a("div",Qn,[t(e(O),{size:"20",color:"#18a058"},{default:l(()=>[t(e(Ae))]),_:1}),s[5]||(s[5]=a("span",null,"网关实例选择",-1))])]),default:l(()=>[a("div",Zn,[t(e(ge),{value:e(v),"onUpdate:value":[s[0]||(s[0]=f=>Xe(v)?v.value=f:null),U],placeholder:"请选择网关实例",options:e(b),loading:e(x),filterable:"",clearable:""},{empty:l(()=>[a("div",eo,[t(e(O),{size:"16",color:"#d03050"},{default:l(()=>[t(e(Pt))]),_:1}),s[6]||(s[6]=a("span",null,"暂无可用的网关实例",-1))])]),_:1},8,["value","options","loading"]),t(e(Y),{onClick:e(V),disabled:e(x)},{icon:l(()=>[t(e(O),{component:e(Be)},null,8,["component"])]),default:l(()=>[s[7]||(s[7]=_(" 刷新列表 "))]),_:1},8,["onClick","disabled"])])]),_:1}),e($)?(E(),Q(e(fe),{key:0,class:"instance-info-card",size:"small"},{header:l(()=>[a("div",{class:"instance-header",onClick:s[1]||(s[1]=(...f)=>e(T)&&e(T)(...f)),style:{cursor:"pointer"}},[t(e(O),{size:"20",color:"#18a058"},{default:l(()=>[t(e(Ae))]),_:1}),s[8]||(s[8]=a("span",null,"网关实例信息",-1)),s[9]||(s[9]=a("div",{class:"flex-spacer"},null,-1)),t(e(O),{size:"16",color:e(o)?"#18a058":"#999"},{default:l(()=>[(E(),Q(vl(e(o)?e(_l):e(Tl))))]),_:1},8,["color"])])]),default:l(()=>[t(e(ml),{show:e(o)},{default:l(()=>[a("div",to,[a("div",lo,[t(e(gl),{column:3,size:"small",bordered:""},{default:l(()=>[t(e(Me),{label:"实例ID"},{default:l(()=>[t(e(G),{type:"info",size:"small"},{default:l(()=>[_(z(e(v)),1)]),_:1})]),_:1}),t(e(Me),{label:"实例名称"},{default:l(()=>[t(e(G),{type:"success",size:"small"},{default:l(()=>[_(z(L()),1)]),_:1})]),_:1}),t(e(Me),{label:"状态"},{default:l(()=>{var f;return[t(e(G),{type:((f=e(p))==null?void 0:f.activeFlag)==="Y"?"success":"error",size:"small"},{default:l(()=>{var P;return[_(z(((P=e(p))==null?void 0:P.activeFlag)==="Y"?"运行中":"已停用"),1)]}),_:1},8,["type"])]}),_:1}),t(e(Me),{label:"绑定地址"},{default:l(()=>{var f;return[_(z(((f=e(p))==null?void 0:f.bindAddress)||"-"),1)]}),_:1}),t(e(Me),{label:"监听端口"},{default:l(()=>{var f,P,d;return[_(z(((f=e(p))==null?void 0:f.tlsEnabled)==="Y"?((P=e(p))==null?void 0:P.httpsPort)||"-":((d=e(p))==null?void 0:d.httpPort)||"-"),1)]}),_:1}),t(e(Me),{label:"健康状态"},{default:l(()=>{var f;return[t(e(G),{type:((f=e(p))==null?void 0:f.healthStatus)==="Y"?"success":"warning",size:"small"},{default:l(()=>{var P;return[_(z(((P=e(p))==null?void 0:P.healthStatus)==="Y"?"健康":"异常"),1)]}),_:1},8,["type"])]}),_:1})]),_:1})])])]),_:1},8,["show"])]),_:1})):de("",!0),e($)?(E(),Q(e(fe),{key:1,class:"main-content"},{default:l(()=>[t(e(dt),{value:g.value,"onUpdate:value":[s[4]||(s[4]=f=>g.value=f),oe],type:"segment",size:"large"},{default:l(()=>[t(e(Te),{name:"proxy",tab:"代理配置管理"},{default:l(()=>[a("div",ao,[a("div",no,[t(e(Ve),{type:"info","show-icon":!1},{default:l(()=>[a("div",oo,[t(e(O),{size:"16",color:"#2080f0"},{default:l(()=>[t(e(nt))]),_:1}),a("span",null,"当前网关实例仅支持"+z(e(D)(e(c))||"单一")+"类型的代理配置",1)])]),_:1})]),(E(),Q(vn,{"gateway-instance-id":e(C),key:`proxy-${e(C)}`,onRefresh:le,onProxySelected:J,onProxyTypeChanged:m,onProxyConfigChanged:N},null,8,["gateway-instance-id"]))])]),_:1}),t(e(Te),{name:"service",tab:"服务定义管理"},{default:l(()=>[a("div",so,[a("div",ro,[t(e(Ve),{type:"info","show-icon":!1},{default:l(()=>[a("div",io,[t(e(O),{size:"16",color:"#2080f0"},{default:l(()=>[t(e(nt))]),_:1}),s[10]||(s[10]=a("span",null,"服务定义管理后端服务配置，包括负载均衡策略、健康检查等，必须关联到已配置的代理",-1))])]),_:1})]),r.value?(E(),Q(e(fe),{key:0,size:"small",class:"proxy-selector-card"},{header:l(()=>[a("div",uo,[t(e(O),{size:"16",color:"#18a058"},{default:l(()=>[t(e(Et))]),_:1}),s[11]||(s[11]=a("span",null,"关联的代理配置",-1))])]),default:l(()=>[a("div",co,[a("div",po,[t(e(G),{type:"success",size:"medium"},{default:l(()=>{var f;return[_(z(r.value.proxyName)+" ("+z((f=r.value.proxyType)==null?void 0:f.toUpperCase())+") ",1)]}),_:1}),t(e(G),{type:r.value.activeFlag==="Y"?"success":"error",size:"small"},{default:l(()=>[_(z(r.value.activeFlag==="Y"?"已启用":"已禁用"),1)]),_:1},8,["type"])]),t(e(Y),{text:"",onClick:S},{default:l(()=>s[12]||(s[12]=[_(" 重新配置代理 ")])),_:1})])]),_:1})):(E(),Q(e(Ve),{key:1,type:"warning","show-icon":!1,class:"no-proxy-alert"},{default:l(()=>[a("div",fo,[t(e(O),{size:"16",color:"#f0a020"},{default:l(()=>[t(e(xt))]),_:1}),s[14]||(s[14]=a("span",null,'请先在"代理配置管理"中创建代理配置，服务定义必须关联到代理配置',-1)),t(e(Y),{size:"small",onClick:s[2]||(s[2]=f=>g.value="proxy")},{default:l(()=>s[13]||(s[13]=[_(" 去配置代理 ")])),_:1})])]),_:1})),r.value&&r.value.activeFlag==="Y"?(E(),Q(An,{"proxy-config-id":r.value.proxyConfigId,key:`service-${e(C)}-${r.value.proxyConfigId}`,onRefresh:le},null,8,["proxy-config-id"])):r.value&&r.value.activeFlag==="N"?(E(),Q(e(Ve),{key:3,type:"warning","show-icon":!1,class:"disabled-proxy-alert"},{default:l(()=>[a("div",go,[t(e(O),{size:"16",color:"#f0a020"},{default:l(()=>[t(e(xt))]),_:1}),s[16]||(s[16]=a("span",null,"当前代理配置已被禁用，请先启用代理配置后再管理服务定义",-1)),t(e(Y),{size:"small",onClick:s[3]||(s[3]=f=>g.value="proxy")},{default:l(()=>s[15]||(s[15]=[_(" 去启用代理 ")])),_:1})])]),_:1})):de("",!0)])]),_:1}),t(e(Te),{name:"test",tab:"代理测试"},{default:l(()=>[a("div",vo,[a("div",yo,[t(e(Ve),{type:"info","show-icon":!1},{default:l(()=>[a("div",mo,[t(e(O),{size:"16",color:"#2080f0"},{default:l(()=>[t(e(nt))]),_:1}),a("span",null,"代理测试工具可以验证代理配置是否正常工作，支持"+z(e(D)(e(c))||"各种协议")+"的请求测试",1)])]),_:1})]),(E(),Q(Wn,{"gateway-instance-id":e(C),key:`test-${e(C)}`},null,8,["gateway-instance-id"]))])]),_:1})]),_:1},8,["value"])]),_:1})):(E(),Q(e(fe),{key:2,class:"empty-state-card"},{default:l(()=>[t(e(it),{description:"请先选择网关实例以开始管理代理配置"},{icon:l(()=>[t(e(O),{size:"60",color:"#d0d0d0"},{default:l(()=>[t(e(Ae))]),_:1})]),extra:l(()=>[t(e(Y),{onClick:e(V),loading:e(x)},{default:l(()=>s[17]||(s[17]=[_(" 重新加载网关实例 ")])),_:1},8,["onClick","loading"])]),_:1})]),_:1}))]))}}),Oo=xe(ho,[["__scopeId","data-v-c4a68567"]]);export{Oo as default};

import{e as B,b as de,bP as he,r as y,f as J,i as _,g as k,a0 as Q,a2 as Z,a1 as Pe,d as Ie,h as Ne,c as ie,m as l,w as s,n as e,H as Fe,o as K,V as ye,M as Ue,A as Ce,B as Se,a as R,C as Ae,bQ as Te,I as Re,J as f,x as p,E as ke,bR as De,bS as ze,bT as Le,aO as xe,bU as Ee,q as Be,aM as qe,_ as Ge}from"./index-DfObWGJe.js";import{c as Me,e as Oe,g as Ve}from"./useUserManagement-DHoQ8wyX.js";import{_ as Ye}from"./Upload-B8nPXHjG.js";import{b as $e,a as He,_ as je}from"./RadioGroup-Ck9rpfWR.js";import{_ as We}from"./Alert-SoozFcx5.js";import{N as Je}from"./Switch-DXoA58mW.js";import"./Progress-Bq_9Wb-K.js";function Qe(){const{t:i}=B("hub0002");B("common");const a=de(),U=he(),C=y(null),F=y(null),b=y(!1),S=y(!1),A=y(!1),o=y(null),c=J({userId:"",userName:"",realName:"",email:"",mobile:"",gender:0,avatar:"",deptName:"",tenantId:""}),D=async()=>{try{b.value=!0;const r=_.user.userInfo;if(!r){a.error(i("profile.fetchFailed"));return}const d=await Ve(r.userId,r.tenantId);if(Q(d)){const u=Pe(d);o.value=u,Object.assign(c,{userId:u.userId,userName:u.userName,realName:u.realName,email:u.email||"",mobile:u.mobile||"",gender:u.gender||0,avatar:u.avatar||"",deptName:u.deptName||"",tenantId:u.tenantId})}else a.error(Z(d,i("profile.fetchFailed")))}catch(r){console.error("Fetch user info error:",r),a.error(i("profile.fetchFailed"))}finally{b.value=!1}},q=()=>{o.value&&Object.assign(c,{userId:o.value.userId,userName:o.value.userName,realName:o.value.realName,email:o.value.email||"",mobile:o.value.mobile||"",gender:o.value.gender||0,avatar:o.value.avatar||"",deptName:o.value.deptName||"",tenantId:o.value.tenantId})},h={realName:[{required:!0,message:()=>i("profile.realNameRequired"),trigger:["blur","input"]},{min:2,max:50,message:()=>i("profile.realNameLength"),trigger:["blur","input"]}],email:[{type:"email",message:()=>i("profile.emailInvalid"),trigger:["blur","input"]}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:()=>i("profile.mobileInvalid"),trigger:["blur","input"]}]},P=J({oldPassword:"",newPassword:"",confirmPassword:""}),G={oldPassword:[{required:!0,message:()=>i("password.oldPasswordRequired"),trigger:["blur","input"]}],newPassword:[{required:!0,message:()=>i("password.newPasswordRequired"),trigger:["blur","input"]},{min:8,max:20,message:()=>i("password.passwordLength"),trigger:["blur","input"]},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,message:()=>i("password.passwordPattern"),trigger:["blur","input"]}],confirmPassword:[{required:!0,message:()=>i("password.confirmPasswordRequired"),trigger:["blur","input"]},{validator:(r,d)=>d!==P.newPassword?new Error(i("password.passwordMismatch")):!0,trigger:["blur","input"]}]},M=J({theme:_.user.settings.theme,language:_.user.settings.language,showGuide:_.user.settings.showGuide,notificationEnabled:_.user.settings.notificationEnabled}),w=k(()=>[{label:i("settings.lightTheme"),value:"light"},{label:i("settings.darkTheme"),value:"dark"},{label:i("settings.autoTheme"),value:"auto"}]),O=k(()=>[{label:"简体中文",value:"zh-CN"},{label:"English",value:"en"}]),V=async()=>{var r;try{if(await((r=C.value)==null?void 0:r.validate()),S.value=!0,!o.value){a.error(i("profile.saveFailed"));return}const d=await Oe({userId:c.userId,tenantId:c.tenantId,userName:c.userName,realName:c.realName,deptId:o.value.deptId||"",email:c.email,mobile:c.mobile,gender:c.gender,avatar:c.avatar,statusFlag:o.value.statusFlag||"Y",deptAdminFlag:o.value.deptAdminFlag||"N",tenantAdminFlag:o.value.tenantAdminFlag||"N",userExpireDate:o.value.userExpireDate||"",addTime:o.value.addTime||new Date().toISOString(),addWho:o.value.addWho||o.value.userId,editTime:new Date().toISOString(),editWho:o.value.userId,oprSeqFlag:o.value.oprSeqFlag||"",currentVersion:o.value.currentVersion||1,activeFlag:o.value.activeFlag||"Y"});if(Q(d)){a.success(i("profile.saveSuccess")),await D();const u=_.user.userInfo;u&&_.user.setUserInfo({...u,realName:c.realName,email:c.email,mobile:c.mobile,gender:c.gender,avatar:c.avatar})}else a.error(Z(d,i("profile.saveFailed")))}catch(d){d!=null&&d.errorFields?a.error(i("profile.validationFailed")):(console.error("Save profile error:",d),a.error(i("profile.saveFailed")))}finally{S.value=!1}},Y=()=>{var r;q(),(r=C.value)==null||r.restoreValidation()},$=async()=>{var r,d,u;try{await((r=F.value)==null?void 0:r.validate()),A.value=!0;const g=await Me({userId:(d=_.user.userInfo)==null?void 0:d.userId,tenantId:(u=_.user.userInfo)==null?void 0:u.tenantId,oldPassword:P.oldPassword,newPassword:P.newPassword});Q(g)?(a.success(i("password.changeSuccess")),z(),setTimeout(()=>{_.user.clearUserInfo(),window.location.href="/login"},2e3)):a.error(Z(g,i("password.changeFailed")))}catch(g){g!=null&&g.errorFields?a.error(i("password.validationFailed")):(console.error("Change password error:",g),a.error(i("password.changeFailed")))}finally{A.value=!1}},z=()=>{var r;P.oldPassword="",P.newPassword="",P.confirmPassword="",(r=F.value)==null||r.restoreValidation()};return{userInfo:o,loading:b,fetchUserInfo:D,profileForm:c,profileFormRef:C,profileRules:h,savingProfile:S,handleSaveProfile:V,handleResetProfile:Y,passwordForm:P,passwordFormRef:F,passwordRules:G,changingPassword:A,handleChangePassword:$,handleResetPassword:z,settingsForm:M,themeOptions:w,languageOptions:O,handleThemeChange:r=>{_.user.updateSettings({theme:r}),a.success(i("settings.themeChanged"))},handleLanguageChange:r=>{_.user.updateSettings({language:r}),U.locale.value=r,a.success(i("settings.languageChanged"))},handleNotificationChange:r=>{_.user.updateSettings({notificationEnabled:r}),a.success(i(r?"settings.notificationEnabled":"settings.notificationDisabled"))},handleGuideChange:r=>{_.user.updateSettings({showGuide:r})},convertFileToBase64:r=>new Promise((d,u)=>{const g=new FileReader;g.readAsDataURL(r),g.onload=()=>d(g.result),g.onerror=H=>u(H)})}}const Ze="/gatewayweb/assets/logo-CQ1xvCtI.png",Ke={class:"user-settings-container"},Xe={class:"avatar-section"},ea={class:"avatar-upload"},aa=["innerHTML"],la={class:"setting-desc"},sa={class:"setting-desc"},ta=Ie({__name:"UserSettings",setup(i){const{t:a}=B("hub0002");B("common");const U=de(),C=y("profile"),F=y(""),{userInfo:b,loading:S,fetchUserInfo:A,profileForm:o,profileFormRef:c,profileRules:D,savingProfile:q,passwordForm:h,passwordFormRef:P,passwordRules:G,changingPassword:M,settingsForm:w,themeOptions:O,languageOptions:V,handleSaveProfile:Y,handleResetProfile:$,handleChangePassword:z,handleResetPassword:X,handleThemeChange:ee,handleLanguageChange:ae,handleNotificationChange:le,handleGuideChange:se,convertFileToBase64:r}=Qe(),d=k(()=>{var v;return((v=b.value)==null?void 0:v.tenantAdminFlag)==="Y"}),u=k(()=>{var v;return((v=b.value)==null?void 0:v.deptAdminFlag)==="Y"}),g=k(()=>{var v;return(v=b.value)==null?void 0:v.statusFlag}),H=async v=>{const n=v.file.file;return n.size>500*1024?(U.error(a("profile.avatarSizeLimitBase64")),!1):["image/jpeg","image/png","image/gif"].includes(n.type)?!0:(U.error(a("profile.avatarTypeInvalid")),!1)},ue=async({file:v})=>{try{if(!v.file)return;const n=await r(v.file);if(n.length>500*1024){U.error(a("profile.avatarSizeLimitBase64"));return}F.value=n,o.avatar=n}catch(n){console.error("Avatar upload error:",n),U.error(a("profile.avatarUploadFailed"))}},pe=async()=>{await Y(),F.value=""},ce=()=>{$(),F.value=""};return Ne(async()=>{await A()}),(v,n)=>{const te=Te,T=Re,me=Ye,m=Ae,I=ke,j=He,L=De,fe=$e,W=Se,x=Ce,ge=We,oe=je,ne=Je,N=Le,E=qe,ve=ze,_e=Ue,be=ye,we=Fe;return K(),ie("div",Ke,[l(we,{show:e(S)},{default:s(()=>[l(be,{title:e(a)("title"),bordered:!1},{default:s(()=>[l(_e,{value:C.value,"onUpdate:value":n[14]||(n[14]=t=>C.value=t),type:"line",animated:""},{default:s(()=>[l(x,{name:"profile",tab:e(a)("tabs.profile")},{default:s(()=>[l(W,{ref_key:"profileFormRef",ref:c,model:e(o),rules:e(D),"label-placement":"left","label-width":"120",size:"medium",class:"profile-form"},{default:s(()=>[R("div",Xe,[l(m,{label:e(a)("profile.avatar")},{default:s(()=>[R("div",ea,[l(te,{size:80,src:F.value||e(o).avatar||e(Ze),class:"user-avatar"},null,8,["src"]),l(me,{"show-file-list":!1,"custom-request":ue,accept:"image/*",onBeforeUpload:H},{default:s(()=>[l(T,{size:"small",class:"upload-btn"},{default:s(()=>[f(p(e(a)("profile.changeAvatar")),1)]),_:1})]),_:1})])]),_:1},8,["label"])]),l(m,{label:e(a)("profile.userId"),path:"userId"},{default:s(()=>[l(I,{value:e(o).userId,"onUpdate:value":n[0]||(n[0]=t=>e(o).userId=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.userName"),path:"userName"},{default:s(()=>[l(I,{value:e(o).userName,"onUpdate:value":n[1]||(n[1]=t=>e(o).userName=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.realName"),path:"realName"},{default:s(()=>[l(I,{value:e(o).realName,"onUpdate:value":n[2]||(n[2]=t=>e(o).realName=t),placeholder:e(a)("profile.realNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.email"),path:"email"},{default:s(()=>[l(I,{value:e(o).email,"onUpdate:value":n[3]||(n[3]=t=>e(o).email=t),placeholder:e(a)("profile.emailPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.mobile"),path:"mobile"},{default:s(()=>[l(I,{value:e(o).mobile,"onUpdate:value":n[4]||(n[4]=t=>e(o).mobile=t),placeholder:e(a)("profile.mobilePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.gender"),path:"gender"},{default:s(()=>[l(fe,{value:e(o).gender,"onUpdate:value":n[5]||(n[5]=t=>e(o).gender=t)},{default:s(()=>[l(L,null,{default:s(()=>[l(j,{value:1},{default:s(()=>[f(p(e(a)("profile.male")),1)]),_:1}),l(j,{value:2},{default:s(()=>[f(p(e(a)("profile.female")),1)]),_:1}),l(j,{value:0},{default:s(()=>[f(p(e(a)("profile.unknown")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),l(m,{label:e(a)("profile.deptName")},{default:s(()=>[l(I,{value:e(o).deptName,"onUpdate:value":n[6]||(n[6]=t=>e(o).deptName=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(m,null,{default:s(()=>[l(L,null,{default:s(()=>[l(T,{type:"primary",loading:e(q),onClick:pe},{default:s(()=>[f(p(e(a)("common.save")),1)]),_:1},8,["loading"]),l(T,{onClick:ce},{default:s(()=>[f(p(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),l(x,{name:"password",tab:e(a)("tabs.password")},{default:s(()=>[l(W,{ref_key:"passwordFormRef",ref:P,model:e(h),rules:e(G),"label-placement":"left","label-width":"120",size:"medium",class:"password-form"},{default:s(()=>[l(m,{label:e(a)("password.oldPassword"),path:"oldPassword"},{default:s(()=>[l(I,{value:e(h).oldPassword,"onUpdate:value":n[7]||(n[7]=t=>e(h).oldPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("password.newPassword"),path:"newPassword"},{default:s(()=>[l(I,{value:e(h).newPassword,"onUpdate:value":n[8]||(n[8]=t=>e(h).newPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.newPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{label:e(a)("password.confirmPassword"),path:"confirmPassword"},{default:s(()=>[l(I,{value:e(h).confirmPassword,"onUpdate:value":n[9]||(n[9]=t=>e(h).confirmPassword=t),type:"password","show-password-on":"click",placeholder:e(a)("password.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(ge,{type:"info","show-icon":!1,class:"password-tips"},{default:s(()=>[R("div",{innerHTML:e(a)("password.tips")},null,8,aa)]),_:1}),l(m,null,{default:s(()=>[l(L,null,{default:s(()=>[l(T,{type:"primary",loading:e(M),onClick:e(z)},{default:s(()=>[f(p(e(a)("password.changeButton")),1)]),_:1},8,["loading","onClick"]),l(T,{onClick:e(X)},{default:s(()=>[f(p(e(a)("common.reset")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),l(x,{name:"settings",tab:e(a)("tabs.settings")},{default:s(()=>[l(W,{model:e(w),"label-placement":"left","label-width":"120",size:"medium",class:"settings-form"},{default:s(()=>[l(m,{label:e(a)("settings.theme")},{default:s(()=>[l(oe,{value:e(w).theme,"onUpdate:value":[n[10]||(n[10]=t=>e(w).theme=t),e(ee)],options:e(O)},null,8,["value","options","onUpdate:value"])]),_:1},8,["label"]),l(m,{label:e(a)("settings.language")},{default:s(()=>[l(oe,{value:e(w).language,"onUpdate:value":[n[11]||(n[11]=t=>e(w).language=t),e(ae)],options:e(V)},null,8,["value","options","onUpdate:value"])]),_:1},8,["label"]),l(m,{label:e(a)("settings.notification")},{default:s(()=>[l(ne,{value:e(w).notificationEnabled,"onUpdate:value":[n[12]||(n[12]=t=>e(w).notificationEnabled=t),e(le)]},null,8,["value","onUpdate:value"]),R("span",la,p(e(a)("settings.notificationDesc")),1)]),_:1},8,["label"]),l(m,{label:e(a)("settings.showGuide")},{default:s(()=>[l(ne,{value:e(w).showGuide,"onUpdate:value":[n[13]||(n[13]=t=>e(w).showGuide=t),e(se)]},null,8,["value","onUpdate:value"]),R("span",sa,p(e(a)("settings.showGuideDesc")),1)]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["tab"]),l(x,{name:"account",tab:e(a)("tabs.account")},{default:s(()=>[l(ve,{column:1,"label-placement":"left","label-style":"width: 120px; font-weight: 500;",bordered:"",class:"account-info"},{default:s(()=>[l(N,{label:e(a)("account.userId")},{default:s(()=>{var t;return[f(p((t=e(b))==null?void 0:t.userId),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.tenantId")},{default:s(()=>{var t;return[f(p((t=e(b))==null?void 0:t.tenantId),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.roles")},{default:s(()=>[l(L,null,{default:s(()=>{var t;return[(K(!0),ie(xe,null,Ee(((t=e(b))==null?void 0:t.roles)||[],re=>(K(),Be(E,{key:re,type:"info",size:"small"},{default:s(()=>[f(p(re),1)]),_:2},1024))),128))]}),_:1})]),_:1},8,["label"]),l(N,{label:e(a)("account.tenantAdmin")},{default:s(()=>[l(E,{type:d.value?"success":"default",size:"small"},{default:s(()=>[f(p(d.value?e(a)("common.yes"):e(a)("common.no")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.deptAdmin")},{default:s(()=>[l(E,{type:u.value?"success":"default",size:"small"},{default:s(()=>[f(p(u.value?e(a)("common.yes"):e(a)("common.no")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.status")},{default:s(()=>[l(E,{type:g.value==="Y"?"success":"error",size:"small"},{default:s(()=>[f(p(g.value==="Y"?e(a)("account.enabled"):e(a)("account.disabled")),1)]),_:1},8,["type"])]),_:1},8,["label"]),l(N,{label:e(a)("account.lastLoginTime")},{default:s(()=>{var t;return[f(p(((t=e(b))==null?void 0:t.lastLoginTime)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.lastLoginIp")},{default:s(()=>{var t;return[f(p(((t=e(b))==null?void 0:t.lastLoginIp)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"]),l(N,{label:e(a)("account.userExpireDate")},{default:s(()=>{var t;return[f(p(((t=e(b))==null?void 0:t.userExpireDate)||e(a)("common.notAvailable")),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"])]),_:1},8,["value"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),ca=Ge(ta,[["__scopeId","data-v-f27886f2"]]);export{ca as default};

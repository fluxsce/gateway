import{d as fe,c as ce,o as P,a as v,g as se,W as qe,a8 as k,aM as _e,v as V,I as j,cQ as Ve,a3 as oe,bR as ge,d1 as je,m as e,w as t,cz as Fe,J as f,x as ee,n as y,_ as ve,b as Ne,r as I,R as Se,q as K,V as ze,cB as Qe,B as We,M as Ae,A as Ie,Y as Pe,C as Xe,E as Ze,t as G,aX as et,K as ke,cO as ye,cr as Be,co as Me,aY as tt,$ as at,f as nt,h as lt,a1 as we,Z as ot,a0 as de,a2 as q,cT as st}from"./index-2fJuYE9W.js";import{C as xe}from"./CheckmarkCircleOutline-oCPbp87B.js";import{A as Ye}from"./AlertCircleOutline-B4NPmBYq.js";import{S as it}from"./StopOutline-Dko3V11s.js";import{P as rt}from"./PlayOutline-C4RjDpVd.js";import{T as ut}from"./TrashOutline-CvI0Y2Yt.js";import{S as dt}from"./SyncOutline-BZWAcxWA.js";import{R as ft}from"./RefreshOutline-YIyYHhq5.js";import{_ as ct}from"./DataTable-j6x_03X-.js";import{_ as gt,a as mt}from"./Upload-Bxym6L4r.js";import{D as De}from"./DownloadOutline-DC4emmTb.js";import{C as Ee}from"./Close-BmMm22qk.js";import{_ as Re,a as Oe}from"./Grid-Bcw7BDe2.js";import{N as pt}from"./InputNumber-CwEQyyC1.js";import{N as yt}from"./Switch-Bco2TRoA.js";import{_ as vt}from"./RadioGroup-BZdw_79m.js";import{_ as Ue}from"./Alert-Ch45DU2r.js";import{_ as bt}from"./DynamicTags-CZKOsHF-.js";import{S as ht,C as Ct,A as _t,R as St}from"./RateLimitConfigForm-BPPsB95G.js";import{A as kt}from"./AddOutline-CkIJ1zcN.js";import"./Progress-CO6O2oHJ.js";import"./InformationCircleOutline-BgP3FWH7.js";import"./FormItemGridItem-BtWqDS1_.js";import"./CreateOutline-D-eAVQ2P.js";const wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Te=fe({name:"DocumentOutline",render:function(h,b){return P(),ce("svg",wt,b[0]||(b[0]=[v("path",{d:"M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),v("path",{d:"M256 56v120a32 32 0 0 0 32 32h120",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}});function Dt(d,h){const b=se(()=>{var r;return((r=d.value)==null?void 0:r.filter(D=>D.healthStatus==="Y"))||[]}),F=r=>r.tlsEnabled==="Y"&&r.httpsPort?`${r.bindAddress}:${r.httpsPort}`:`${r.bindAddress}${r.httpPort?`:${r.httpPort}`:""}`;return{onlineInstances:b,tableColumns:[{title:"实例名称",key:"instanceName",width:160,ellipsis:{tooltip:!0},fixed:"left"},{title:"描述",key:"instanceDesc",width:180,ellipsis:{tooltip:!0},render:r=>r.instanceDesc||"-"},{title:"服务地址",key:"bindAddress",width:160,render:F},{title:"TLS",key:"tlsEnabled",width:70,render:r=>k(_e,{type:r.tlsEnabled==="Y"?"success":"default",size:"small"},()=>r.tlsEnabled==="Y"?"启用":"禁用")},{title:"状态",key:"healthStatus",width:90,render:r=>k(_e,{type:r.healthStatus==="Y"?"success":"error",size:"small"},{default:()=>r.healthStatus==="Y"?"在线":"离线",icon:()=>k(V,null,()=>k(r.healthStatus==="Y"?xe:Ye))})},{title:"最大连接数",key:"maxConnections",width:110,render:r=>r.maxConnections.toLocaleString()},{title:"最后心跳",key:"lastHeartbeatTime",width:170,render:r=>{if(!r.lastHeartbeatTime)return"-";try{return qe(r.lastHeartbeatTime,"YYYY-MM-DD HH:mm:ss")}catch(D){return console.warn("格式化心跳时间失败:",D),r.lastHeartbeatTime}}},{title:"操作",key:"actions",width:260,fixed:"right",render:r=>{const D=k(oe,{trigger:"hover"},{trigger:()=>k(j,{size:"small",type:"primary",secondary:!0,onClick:()=>h("config",r)},{icon:()=>k(V,null,()=>k(Ve))}),default:()=>"配置管理"}),M=k(oe,{trigger:"hover"},{trigger:()=>k(j,{size:"small",type:r.healthStatus==="Y"?"warning":"success",secondary:!0,onClick:()=>r.healthStatus==="Y"?h("stop",r):h("start",r)},{icon:()=>k(V,null,()=>k(r.healthStatus==="Y"?it:rt))}),default:()=>r.healthStatus==="Y"?"停止实例":"启动实例"}),R=k(oe,{trigger:"hover"},{trigger:()=>k(j,{size:"small",onClick:()=>h("edit",r)},()=>"编辑"),default:()=>"编辑实例"}),O=k(oe,{trigger:"hover"},{trigger:()=>k(j,{size:"small",type:"error",secondary:!0,onClick:()=>h("delete",r)},{icon:()=>k(V,null,()=>k(ut))}),default:()=>"删除实例"}),x=k(oe,{trigger:"hover"},{trigger:()=>k(j,{size:"small",type:"primary",secondary:!0,onClick:()=>h("reload",r)},{icon:()=>k(V,null,()=>k(dt))}),default:()=>"网关重载"});return k(ge,{size:"small"},()=>[D,M,R,O,x])}}],formatServiceAddress:F}}const Tt={class:"gateway-instance-table"},Ft={class:"table-header"},Nt={class:"header-left"},zt={class:"header-actions"},At=fe({__name:"GatewayInstanceTable",props:{instances:{},loading:{type:Boolean}},emits:["create","edit","delete","start","stop","config","refresh","reload"],setup(d,{emit:h}){const b=d,F=h,{instances:S}=je(b),{onlineInstances:C,tableColumns:N}=Dt(S,F);return(z,r)=>{const D=Fe,M=V,R=j,O=ge,x=ct;return P(),ce("div",Tt,[v("div",Ft,[e(O,{justify:"space-between"},{default:t(()=>[v("div",Nt,[r[1]||(r[1]=v("h3",null,"网关实例列表",-1)),e(D,{depth:"3"},{default:t(()=>[f("共 "+ee(y(S).length)+" 个实例，"+ee(y(C).length)+" 个在线",1)]),_:1})]),v("div",zt,[e(R,{onClick:r[0]||(r[0]=Q=>z.$emit("refresh"))},{icon:t(()=>[e(M,null,{default:t(()=>[e(y(ft))]),_:1})]),default:t(()=>[r[2]||(r[2]=f(" 刷新 "))]),_:1})])]),_:1})]),e(x,{columns:y(N),data:y(S),loading:z.loading,bordered:!1,size:"medium","scroll-x":1200,"flex-height":"",style:{height:"600px"}},null,8,["columns","data","loading"])])}}}),It=ve(At,[["__scopeId","data-v-c1f9a594"]]);function Pt(){const d=Ne(),h=I(null),b=I(!1),F=I(!1),S=I([]),C=I([]),N={instanceName:{required:!0,message:"请输入实例名称",trigger:["input","blur"]},bindAddress:{required:!0,message:"请输入绑定地址",trigger:["input","blur"]},httpPort:{required:!1,type:"number",message:"请输入有效的HTTP端口号",trigger:["input","blur"]},httpsPort:{required:!1,type:"number",message:"请输入有效的HTTPS端口号",trigger:["input","blur"]}},z=p=>new Promise((T,_)=>{const i=new FileReader;i.onload=u=>{var s;return T((s=u.target)==null?void 0:s.result)},i.onerror=_,i.readAsText(p)});return{formRef:h,visible:b,showCertContent:F,certFileList:S,keyFileList:C,formRules:N,handleCertFileChange:async(p,T)=>{const{file:_}=p;if(_.file)try{if(_.file.size>10*1024*1024){d.error("证书文件不能超过10MB");return}const i=await z(_.file);T.certContent=i,T.certFilePath=_.file.name,S.value=[_],d.success("证书文件上传成功")}catch(i){d.error("证书文件读取失败"),console.error("Error reading cert file:",i)}},handleCertFileRemove:p=>{S.value=[],p.certContent="",p.certFilePath="",d.info("已移除证书文件")},handleKeyFileChange:async(p,T)=>{const{file:_}=p;if(_.file)try{if(_.file.size>10*1024*1024){d.error("私钥文件不能超过10MB");return}const i=await z(_.file);T.keyContent=i,T.keyFilePath=_.file.name,C.value=[_],d.success("私钥文件上传成功")}catch(i){d.error("私钥文件读取失败"),console.error("Error reading key file:",i)}},handleKeyFileRemove:p=>{C.value=[],p.keyContent="",p.keyFilePath="",d.info("已移除私钥文件")},resetFileUploadState:()=>{S.value=[],C.value=[],F.value=!1},syncEditFileState:p=>{p.certContent&&p.certFilePath?S.value=[{id:"existing-cert",name:p.certFilePath,status:"finished",type:"application/x-pem-file"}]:S.value=[],p.keyContent&&p.keyFilePath?C.value=[{id:"existing-key",name:p.keyFilePath,status:"finished",type:"application/x-pem-file"}]:C.value=[]},validateForm:async()=>{var p;try{return await((p=h.value)==null?void 0:p.validate()),!0}catch{return d.error("请检查表单输入"),!1}},downloadCertFile:p=>{if(!p.certContent){d.warning("没有可下载的证书文件");return}const T=p.certFilePath||"certificate.pem",_=new Blob([p.certContent],{type:"application/x-pem-file"}),i=URL.createObjectURL(_),u=document.createElement("a");u.href=i,u.download=T,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i),d.success("证书文件下载成功")},downloadKeyFile:p=>{if(!p.keyContent){d.warning("没有可下载的私钥文件");return}const T=p.keyFilePath||"private-key.pem",_=new Blob([p.keyContent],{type:"application/x-pem-file"}),i=URL.createObjectURL(_),u=document.createElement("a");u.href=i,u.download=T,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i),d.success("私钥文件下载成功")}}}const Bt={class:"modal-header"},Mt={class:"header-content"},xt={class:"modal-title"},Yt={class:"modal-content"},Et={class:"cert-upload-wrapper"},Rt={class:"upload-content"},Ot={class:"upload-content"},Ut={class:"cert-content-section"},Ht={key:0,class:"log-output-config"},Lt={class:"modal-footer"},$t=fe({__name:"GatewayInstanceDialog",props:{show:{type:Boolean},isEditing:{type:Boolean},formData:{},submitting:{type:Boolean}},emits:["update:show","submit"],setup(d,{emit:h}){const b=d,F=h,{formRef:S,visible:C,certFileList:N,keyFileList:z,formRules:r,handleCertFileChange:D,handleCertFileRemove:M,handleKeyFileChange:R,handleKeyFileRemove:O,resetFileUploadState:x,syncEditFileState:Q,validateForm:L,downloadCertFile:$,downloadKeyFile:p}=Pt(),T=[{label:"TLS 1.0",value:"1.0"},{label:"TLS 1.1",value:"1.1"},{label:"TLS 1.2",value:"1.2"},{label:"TLS 1.3",value:"1.3"}],_=[{label:"JSON格式",value:"JSON"},{label:"文本格式",value:"TEXT"},{label:"CSV格式",value:"CSV"}],i=[{label:"文件输出",value:"FILE"},{label:"数据库输出",value:"DATABASE"},{label:"MongoDB输出",value:"MONGODB"},{label:"Elasticsearch输出",value:"ELASTICSEARCH"},{label:"ClickHouse输出",value:"CLICKHOUSE"}],u=[{label:"替换为*",value:"****"},{label:"替换为[MASKED]",value:"[MASKED]"},{label:"保留前后字符",value:"KEEP_EDGE"},{label:"自定义规则",value:"CUSTOM"}],s=se(()=>b.formData.tlsEnabled==="Y"),l=se(()=>{var n,a;return((a=(n=b.formData.logConfig)==null?void 0:n.outputTargets)==null?void 0:a.includes("FILE"))||!1});Se(()=>b.show,n=>{C.value=n,n&&b.isEditing?Q(b.formData):n||x()}),Se(C,n=>{F("update:show",n)});const g=()=>{C.value=!1},J=async()=>{await L()&&F("submit",b.formData)},ie=n=>D(n,b.formData),W=()=>M(b.formData),le=n=>R(n,b.formData),me=()=>O(b.formData),pe=()=>$(b.formData),ae=()=>p(b.formData);return(n,a)=>{const U=V,X=j,w=Fe,H=Pe,Y=Ze,m=Xe,c=Oe,A=pt,E=yt,B=Re,Z=ge,be=mt,he=gt,re=ze,ue=vt,Ce=Ie,He=Ue,Le=bt,$e=Ae,Ke=We,Ge=Qe,Je=Me;return P(),K(Je,{show:y(C),"onUpdate:show":a[41]||(a[41]=o=>Be(C)?C.value=o:null),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:t(()=>[e(re,{style:{width:"1000px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true",class:"instance-modal"},{header:t(()=>[v("div",Bt,[e(U,{size:"24",class:"modal-icon"},{default:t(()=>[e(y(ye))]),_:1}),v("div",Mt,[v("h3",xt,ee(n.isEditing?"编辑网关实例":"新建网关实例"),1),a[42]||(a[42]=v("p",{class:"modal-subtitle"},"配置网关实例的基本信息、TLS证书、性能参数等",-1))])])]),"header-extra":t(()=>[e(X,{quaternary:"",circle:"",onClick:g,class:"close-btn"},{icon:t(()=>[e(U,{size:"18"},{default:t(()=>[e(y(Ee))]),_:1})]),_:1})]),footer:t(()=>[v("div",Lt,[e(Z,{justify:"end"},{default:t(()=>[e(X,{onClick:g,size:"medium"},{default:t(()=>a[84]||(a[84]=[f("取消")])),_:1}),e(X,{type:"primary",loading:n.submitting,onClick:J,size:"medium"},{default:t(()=>[f(ee(n.isEditing?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})])]),default:t(()=>[e(Ge,{style:{"max-height":"70vh"},trigger:"hover","x-scrollable":!1},{default:t(()=>[v("div",Yt,[e(Ke,{ref_key:"formRef",ref:S,model:n.formData,rules:y(r),"label-placement":"left","label-width":"160px","require-mark-placement":"right-hanging",class:"instance-form"},{default:t(()=>[e($e,{type:"line",animated:""},{default:t(()=>[e(Ce,{name:"instance",tab:"实例配置"},{default:t(()=>[e(H,{"title-placement":"left"},{default:t(()=>[e(w,{class:"section-title"},{default:t(()=>a[43]||(a[43]=[f("基本信息")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"实例名称",path:"instanceName"},{default:t(()=>[e(Y,{value:n.formData.instanceName,"onUpdate:value":a[0]||(a[0]=o=>n.formData.instanceName=o),placeholder:"请输入实例名称"},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"绑定地址",path:"bindAddress"},{default:t(()=>[e(Y,{value:n.formData.bindAddress,"onUpdate:value":a[1]||(a[1]=o=>n.formData.bindAddress=o),placeholder:"如: 0.0.0.0"},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"HTTP端口",path:"httpPort"},{default:t(()=>[e(A,{value:n.formData.httpPort,"onUpdate:value":a[2]||(a[2]=o=>n.formData.httpPort=o),min:1,max:65535,placeholder:"如: 8080",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"HTTPS端口",path:"httpsPort"},{default:t(()=>[e(A,{value:n.formData.httpsPort,"onUpdate:value":a[3]||(a[3]=o=>n.formData.httpsPort=o),min:1,max:65535,placeholder:"如: 8443",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"自动启动",path:"activeFlag"},{default:t(()=>[e(E,{value:n.formData.activeFlag,"onUpdate:value":a[4]||(a[4]=o=>n.formData.activeFlag=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[44]||(a[44]=[f("启用")])),unchecked:t(()=>a[45]||(a[45]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,{span:2},{default:t(()=>[e(m,{label:"实例描述",path:"instanceDesc"},{default:t(()=>[e(Y,{value:n.formData.instanceDesc,"onUpdate:value":a[5]||(a[5]=o=>n.formData.instanceDesc=o),type:"textarea",placeholder:"请输入实例描述",rows:3},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(H,{"title-placement":"left"},{default:t(()=>[e(w,{class:"section-title"},{default:t(()=>a[46]||(a[46]=[f("TLS安全配置")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"启用TLS",path:"tlsEnabled"},{default:t(()=>[e(E,{value:n.formData.tlsEnabled,"onUpdate:value":a[6]||(a[6]=o=>n.formData.tlsEnabled=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[47]||(a[47]=[f("启用")])),unchecked:t(()=>a[48]||(a[48]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),s.value?(P(),K(c,{key:0},{default:t(()=>[e(m,{label:"证书密码",path:"certPassword"},{default:t(()=>[e(Y,{value:n.formData.certPassword,"onUpdate:value":a[7]||(a[7]=o=>n.formData.certPassword=o),type:"password",placeholder:"请输入证书密码(可选)","show-password-on":"click"},null,8,["value"])]),_:1})]),_:1})):G("",!0),s.value?(P(),K(c,{key:1,span:2},{default:t(()=>[v("div",Et,[e(B,{cols:2,"x-gap":16,"y-gap":12},{default:t(()=>[e(c,null,{default:t(()=>[e(re,{size:"small",class:"upload-card"},{header:t(()=>[e(Z,{align:"center",justify:"space-between"},{default:t(()=>[e(Z,{align:"center"},{default:t(()=>[e(U,{size:"16",color:"#18a058"},{default:t(()=>[e(y(Te))]),_:1}),a[49]||(a[49]=v("span",null,"证书文件",-1))]),_:1}),n.formData.certContent?(P(),K(X,{key:0,text:"",size:"small",onClick:pe,title:"下载证书文件"},{icon:t(()=>[e(U,{size:"16"},{default:t(()=>[e(y(De))]),_:1})]),_:1})):G("",!0)]),_:1})]),default:t(()=>[e(he,{"file-list":y(N),max:1,"on-change":ie,"on-remove":W,accept:".crt,.pem,.cer","show-file-list":!0,"custom-request":()=>{},class:"cert-upload"},{default:t(()=>[e(be,null,{default:t(()=>[v("div",Rt,[e(U,{size:"32",depth:"3"},{default:t(()=>[e(y(Te))]),_:1}),e(w,{depth:"3"},{default:t(()=>a[50]||(a[50]=[f("点击或拖拽上传证书")])),_:1}),e(w,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[51]||(a[51]=[f("支持 .crt, .pem, .cer")])),_:1})])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(re,{size:"small",class:"upload-card"},{header:t(()=>[e(Z,{align:"center",justify:"space-between"},{default:t(()=>[e(Z,{align:"center"},{default:t(()=>[e(U,{size:"16",color:"#f0a020"},{default:t(()=>[e(y(ke))]),_:1}),a[52]||(a[52]=v("span",null,"私钥文件",-1))]),_:1}),n.formData.keyContent?(P(),K(X,{key:0,text:"",size:"small",onClick:ae,title:"下载私钥文件"},{icon:t(()=>[e(U,{size:"16"},{default:t(()=>[e(y(De))]),_:1})]),_:1})):G("",!0)]),_:1})]),default:t(()=>[e(he,{"file-list":y(z),max:1,"on-change":le,"on-remove":me,accept:".key,.pem","show-file-list":!0,"custom-request":()=>{},class:"cert-upload"},{default:t(()=>[e(be,null,{default:t(()=>[v("div",Ot,[e(U,{size:"32",depth:"3"},{default:t(()=>[e(y(ke))]),_:1}),e(w,{depth:"3"},{default:t(()=>a[53]||(a[53]=[f("点击或拖拽上传私钥")])),_:1}),e(w,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[54]||(a[54]=[f("支持 .key, .pem")])),_:1})])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1})])]),_:1})):G("",!0),et(e(c,{span:2},{default:t(()=>[v("div",Ut,[e(B,{cols:1,"y-gap":16,style:{"margin-top":"16px"}},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"证书内容(PEM格式)",path:"certContent"},{default:t(()=>[e(Y,{value:n.formData.certContent,"onUpdate:value":a[8]||(a[8]=o=>n.formData.certContent=o),type:"textarea",placeholder:"通过上传文件自动填充",rows:4},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"私钥内容(PEM格式)",path:"keyContent"},{default:t(()=>[e(Y,{value:n.formData.keyContent,"onUpdate:value":a[9]||(a[9]=o=>n.formData.keyContent=o),type:"textarea",placeholder:"通过上传文件自动填充",rows:4},null,8,["value"])]),_:1})]),_:1})]),_:1})])]),_:1},512),[[tt,!1]]),s.value?(P(),K(c,{key:2,span:2},{default:t(()=>[e(H,{"title-placement":"left",style:{margin:"8px 0 16px 0"}},{default:t(()=>[e(w,{style:{"font-size":"13px",color:"#888"}},{default:t(()=>a[55]||(a[55]=[f("TLS高级选项")])),_:1})]),_:1})]),_:1})):G("",!0),s.value?(P(),K(c,{key:3},{default:t(()=>[e(m,{label:"TLS版本",path:"tlsVersion"},{default:t(()=>[e(ue,{value:n.formData.tlsVersion,"onUpdate:value":a[10]||(a[10]=o=>n.formData.tlsVersion=o),multiple:"",options:T,placeholder:"选择支持的TLS版本","max-tag-count":2},null,8,["value"])]),_:1})]),_:1})):G("",!0),s.value?(P(),K(c,{key:4},{default:t(()=>[e(m,{label:"启用HTTP/2",path:"enableHttp2"},{default:t(()=>[e(E,{value:n.formData.enableHttp2,"onUpdate:value":a[11]||(a[11]=o=>n.formData.enableHttp2=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[56]||(a[56]=[f("启用")])),unchecked:t(()=>a[57]||(a[57]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1})):G("",!0),s.value?(P(),K(c,{key:5,span:2},{default:t(()=>[e(m,{label:"TLS密码套件",path:"tlsCipherSuites"},{default:t(()=>[e(Y,{value:n.formData.tlsCipherSuites,"onUpdate:value":a[12]||(a[12]=o=>n.formData.tlsCipherSuites=o),placeholder:"多个密码套件用逗号分隔，如: TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256，留空使用默认配置",clearable:""},null,8,["value"])]),_:1})]),_:1})):G("",!0)]),_:1}),e(H,{"title-placement":"left"},{default:t(()=>[e(w,{class:"section-title"},{default:t(()=>a[58]||(a[58]=[f("性能配置")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"最大连接数",path:"maxConnections"},{default:t(()=>[e(A,{value:n.formData.maxConnections,"onUpdate:value":a[13]||(a[13]=o=>n.formData.maxConnections=o),min:100,max:1e5,placeholder:"10000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"最大工作协程数",path:"maxWorkers"},{default:t(()=>[e(A,{value:n.formData.maxWorkers,"onUpdate:value":a[14]||(a[14]=o=>n.formData.maxWorkers=o),min:100,max:1e4,placeholder:"1000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"读取超时(ms)",path:"readTimeoutMs"},{default:t(()=>[e(A,{value:n.formData.readTimeoutMs,"onUpdate:value":a[15]||(a[15]=o=>n.formData.readTimeoutMs=o),min:1e3,max:3e5,placeholder:"30000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"写入超时(ms)",path:"writeTimeoutMs"},{default:t(()=>[e(A,{value:n.formData.writeTimeoutMs,"onUpdate:value":a[16]||(a[16]=o=>n.formData.writeTimeoutMs=o),min:1e3,max:3e5,placeholder:"30000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"空闲超时(ms)",path:"idleTimeoutMs"},{default:t(()=>[e(A,{value:n.formData.idleTimeoutMs,"onUpdate:value":a[17]||(a[17]=o=>n.formData.idleTimeoutMs=o),min:1e3,max:6e5,placeholder:"60000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"最大请求头大小(字节)",path:"maxHeaderBytes"},{default:t(()=>[e(A,{value:n.formData.maxHeaderBytes,"onUpdate:value":a[18]||(a[18]=o=>n.formData.maxHeaderBytes=o),min:1024,max:10485760,placeholder:"1048576",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(H,{"title-placement":"left"},{default:t(()=>[e(w,{class:"section-title"},{default:t(()=>a[59]||(a[59]=[f("Keep-Alive配置")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"HTTP Keep-Alive",path:"keepAliveEnabled"},{default:t(()=>[e(Z,{vertical:""},{default:t(()=>[e(E,{value:n.formData.keepAliveEnabled,"onUpdate:value":a[19]||(a[19]=o=>n.formData.keepAliveEnabled=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[60]||(a[60]=[f("启用")])),unchecked:t(()=>a[61]||(a[61]=[f("禁用")])),_:1},8,["value"]),e(w,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[62]||(a[62]=[f(" HTTP层复用连接，减少建立连接开销 ")])),_:1})]),_:1})]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"TCP Keep-Alive",path:"tcpKeepAliveEnabled"},{default:t(()=>[e(Z,{vertical:""},{default:t(()=>[e(E,{value:n.formData.tcpKeepAliveEnabled,"onUpdate:value":a[20]||(a[20]=o=>n.formData.tcpKeepAliveEnabled=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[63]||(a[63]=[f("启用")])),unchecked:t(()=>a[64]||(a[64]=[f("禁用")])),_:1},8,["value"]),e(w,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>a[65]||(a[65]=[f(" TCP层检测死连接，及时清理资源 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(H,{"title-placement":"left"},{default:t(()=>[e(w,{class:"section-title"},{default:t(()=>a[66]||(a[66]=[f("备注信息")])),_:1})]),_:1}),e(m,{label:"备注",path:"noteText"},{default:t(()=>[e(Y,{value:n.formData.noteText,"onUpdate:value":a[21]||(a[21]=o=>n.formData.noteText=o),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1}),e(Ce,{name:"log",tab:"日志配置"},{default:t(()=>[e(He,{type:"info",style:{"margin-bottom":"20px"}},{default:t(()=>a[67]||(a[67]=[f(" 配置网关实例的日志记录策略，包括日志格式、输出目标、轮转策略等。 ")])),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"日志配置名称",path:"logConfig.configName"},{default:t(()=>[e(Y,{value:n.formData.logConfig.configName,"onUpdate:value":a[22]||(a[22]=o=>n.formData.logConfig.configName=o),placeholder:"请输入日志配置名称"},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"日志格式",path:"logConfig.logFormat"},{default:t(()=>[e(ue,{value:n.formData.logConfig.logFormat,"onUpdate:value":a[23]||(a[23]=o=>n.formData.logConfig.logFormat=o),options:_,placeholder:"选择日志格式"},null,8,["value"])]),_:1})]),_:1}),e(c,{span:2},{default:t(()=>[e(m,{label:"日志配置描述",path:"logConfig.configDesc"},{default:t(()=>[e(Y,{value:n.formData.logConfig.configDesc,"onUpdate:value":a[24]||(a[24]=o=>n.formData.logConfig.configDesc=o),type:"textarea",placeholder:"请输入日志配置描述",rows:2},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(H,{"title-placement":"left",style:{margin:"20px 0 16px 0"}},{default:t(()=>[e(w,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[68]||(a[68]=[f("日志内容控制")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"记录请求体",path:"logConfig.recordRequestBody"},{default:t(()=>[e(E,{value:n.formData.logConfig.recordRequestBody,"onUpdate:value":a[25]||(a[25]=o=>n.formData.logConfig.recordRequestBody=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[69]||(a[69]=[f("启用")])),unchecked:t(()=>a[70]||(a[70]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"记录响应体",path:"logConfig.recordResponseBody"},{default:t(()=>[e(E,{value:n.formData.logConfig.recordResponseBody,"onUpdate:value":a[26]||(a[26]=o=>n.formData.logConfig.recordResponseBody=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[71]||(a[71]=[f("启用")])),unchecked:t(()=>a[72]||(a[72]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"记录请求头",path:"logConfig.recordHeaders"},{default:t(()=>[e(E,{value:n.formData.logConfig.recordHeaders,"onUpdate:value":a[27]||(a[27]=o=>n.formData.logConfig.recordHeaders=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[73]||(a[73]=[f("启用")])),unchecked:t(()=>a[74]||(a[74]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"最大报文大小(字节)",path:"logConfig.maxBodySizeBytes"},{default:t(()=>[e(A,{value:n.formData.logConfig.maxBodySizeBytes,"onUpdate:value":a[28]||(a[28]=o=>n.formData.logConfig.maxBodySizeBytes=o),min:0,placeholder:"1048576",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(H,{"title-placement":"left",style:{margin:"20px 0 16px 0"}},{default:t(()=>[e(w,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[75]||(a[75]=[f("日志输出目标")])),_:1})]),_:1}),e(B,{cols:1,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"输出目标",path:"logConfig.outputTargets"},{default:t(()=>[e(ue,{value:n.formData.logConfig.outputTargets,"onUpdate:value":a[29]||(a[29]=o=>n.formData.logConfig.outputTargets=o),options:i,placeholder:"选择日志输出目标"},null,8,["value"])]),_:1})]),_:1})]),_:1}),l.value?(P(),ce("div",Ht,[e(re,{title:"文件输出配置",size:"small",style:{margin:"16px 0"}},{default:t(()=>[e(B,{cols:2,"x-gap":16,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"文件路径"},{default:t(()=>[e(Y,{value:n.formData.logConfig.fileConfig.filePath,"onUpdate:value":a[30]||(a[30]=o=>n.formData.logConfig.fileConfig.filePath=o),placeholder:"./logs/gateway.log"},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"文件保留天数"},{default:t(()=>[e(A,{value:n.formData.logConfig.logRetentionDays,"onUpdate:value":a[31]||(a[31]=o=>n.formData.logConfig.logRetentionDays=o),min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})])):G("",!0),e(H,{"title-placement":"left",style:{margin:"20px 0 16px 0"}},{default:t(()=>[e(w,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[76]||(a[76]=[f("异步和批量处理")])),_:1})]),_:1}),e(B,{cols:3,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"启用异步日志",path:"logConfig.enableAsyncLogging"},{default:t(()=>[e(E,{value:n.formData.logConfig.enableAsyncLogging,"onUpdate:value":a[32]||(a[32]=o=>n.formData.logConfig.enableAsyncLogging=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[77]||(a[77]=[f("启用")])),unchecked:t(()=>a[78]||(a[78]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"异步队列大小",path:"logConfig.asyncQueueSize"},{default:t(()=>[e(A,{value:n.formData.logConfig.asyncQueueSize,"onUpdate:value":a[33]||(a[33]=o=>n.formData.logConfig.asyncQueueSize=o),min:1,placeholder:"10000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"批处理大小",path:"logConfig.batchSize"},{default:t(()=>[e(A,{value:n.formData.logConfig.batchSize,"onUpdate:value":a[34]||(a[34]=o=>n.formData.logConfig.batchSize=o),min:1,placeholder:"100",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"异步刷新间隔(ms)",path:"logConfig.asyncFlushIntervalMs"},{default:t(()=>[e(A,{value:n.formData.logConfig.asyncFlushIntervalMs,"onUpdate:value":a[35]||(a[35]=o=>n.formData.logConfig.asyncFlushIntervalMs=o),min:100,max:6e4,placeholder:"5000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"启用批量处理",path:"logConfig.enableBatchProcessing"},{default:t(()=>[e(E,{value:n.formData.logConfig.enableBatchProcessing,"onUpdate:value":a[36]||(a[36]=o=>n.formData.logConfig.enableBatchProcessing=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[79]||(a[79]=[f("启用")])),unchecked:t(()=>a[80]||(a[80]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"批处理超时(ms)",path:"logConfig.batchTimeoutMs"},{default:t(()=>[e(A,{value:n.formData.logConfig.batchTimeoutMs,"onUpdate:value":a[37]||(a[37]=o=>n.formData.logConfig.batchTimeoutMs=o),min:1e3,max:3e5,placeholder:"30000",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(H,{"title-placement":"left",style:{margin:"20px 0 16px 0"}},{default:t(()=>[e(w,{style:{"font-size":"14px",color:"#666"}},{default:t(()=>a[81]||(a[81]=[f("敏感数据处理")])),_:1})]),_:1}),e(B,{cols:2,"x-gap":24,"y-gap":16},{default:t(()=>[e(c,null,{default:t(()=>[e(m,{label:"启用敏感数据脱敏",path:"logConfig.enableSensitiveDataMasking"},{default:t(()=>[e(E,{value:n.formData.logConfig.enableSensitiveDataMasking,"onUpdate:value":a[38]||(a[38]=o=>n.formData.logConfig.enableSensitiveDataMasking=o),"checked-value":"Y","unchecked-value":"N"},{checked:t(()=>a[82]||(a[82]=[f("启用")])),unchecked:t(()=>a[83]||(a[83]=[f("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(m,{label:"脱敏模式",path:"logConfig.maskingPattern"},{default:t(()=>[e(ue,{value:n.formData.logConfig.maskingPattern,"onUpdate:value":a[39]||(a[39]=o=>n.formData.logConfig.maskingPattern=o),options:u,placeholder:"选择脱敏模式"},null,8,["value"])]),_:1})]),_:1}),e(c,{span:2},{default:t(()=>[e(m,{label:"敏感字段",path:"logConfig.sensitiveFields"},{default:t(()=>[e(Le,{value:n.formData.logConfig.sensitiveFields,"onUpdate:value":a[40]||(a[40]=o=>n.formData.logConfig.sensitiveFields=o),placeholder:"添加敏感字段"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Kt=ve($t,[["__scopeId","data-v-29588230"]]),te=at("/gateway/hub0020");async function Gt(d){return te.post("/queryGatewayInstances",d)}async function Jt(d,h){return te.get("/gatewayInstance",{gatewayInstanceId:d,tenantId:h})}async function qt(d){return te.post("/addGatewayInstance",d)}async function Vt(d){return te.post("/editGatewayInstance",d)}async function jt(d,h){return te.post("/deleteGatewayInstance",{gatewayInstanceId:d,tenantId:h})}async function Qt(d,h,b){return te.post("/updateHealthStatus",{gatewayInstanceId:d,tenantId:h,healthStatus:b})}async function Wt(d,h){return te.post("/reloadGatewayInstance",{gatewayInstanceId:d,tenantId:h})}const ne=ot("GatewayInstance");function Xt(){const d=Ne(),h=I([]),b=I(!1),F=I({totalInstances:0,onlineInstances:0,offlineInstances:0,totalConfigs:0,activeConfigs:0}),S=nt({instanceName:"",instanceDesc:"",bindAddress:"0.0.0.0",httpPort:8080,httpsPort:8443,tlsEnabled:"N",certStorageType:"DATABASE",certFilePath:"",keyFilePath:"",certContent:"",keyContent:"",certChainContent:"",certPassword:"",maxConnections:1e4,readTimeoutMs:3e4,writeTimeoutMs:3e4,idleTimeoutMs:6e4,maxHeaderBytes:1048576,maxWorkers:1e3,keepAliveEnabled:"Y",tcpKeepAliveEnabled:"Y",gracefulShutdownTimeoutMs:3e4,enableHttp2:"Y",tlsVersion:["1.2"],tlsCipherSuites:"",disableGeneralOptionsHandler:"N",logConfigId:"",healthStatus:"Y",noteText:"",activeFlag:"Y",logConfig:{configName:"网关日志",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"Y",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e3,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"N",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}),C=I(!1),N=I(!1),z=I(""),r=I(!1),D=async(i="TENANT_001")=>{try{b.value=!0;const u=await Gt({tenantId:i}),s=we(u,[]);h.value=Array.isArray(s)?s:[],M()}catch(u){ne.error("获取网关实例列表失败",u),d.error("获取网关实例列表失败")}finally{b.value=!1}},M=()=>{const i=h.value||[],u=i.length,s=i.filter(g=>g.healthStatus==="Y").length,l=u-s;F.value={totalInstances:u,onlineInstances:s,offlineInstances:l,totalConfigs:0,activeConfigs:0}},R=se(()=>h.value.filter(i=>i.healthStatus==="Y")),O=se(()=>h.value.filter(i=>i.healthStatus==="N")),x=()=>{_(),N.value=!1,C.value=!0},Q=async i=>{try{b.value=!0;const u=await Jt(i.gatewayInstanceId,i.tenantId),s=we(u,null);if(!s){d.error("获取实例详情失败");return}Object.assign(S,{instanceName:s.instanceName||"",instanceDesc:s.instanceDesc||"",bindAddress:s.bindAddress||"0.0.0.0",httpPort:s.httpPort??8080,httpsPort:s.httpsPort??8443,tlsEnabled:s.tlsEnabled||"N",certStorageType:s.certStorageType||"DATABASE",certFilePath:s.certFilePath||"",keyFilePath:s.keyFilePath||"",certContent:s.certContent||"",keyContent:s.keyContent||"",certChainContent:s.certChainContent||"",certPassword:s.certPassword||"",maxConnections:s.maxConnections??1e4,readTimeoutMs:s.readTimeoutMs??3e4,writeTimeoutMs:s.writeTimeoutMs??3e4,idleTimeoutMs:s.idleTimeoutMs??6e4,maxHeaderBytes:s.maxHeaderBytes??1048576,maxWorkers:s.maxWorkers??1e3,keepAliveEnabled:s.keepAliveEnabled||"Y",tcpKeepAliveEnabled:s.tcpKeepAliveEnabled||"Y",gracefulShutdownTimeoutMs:s.gracefulShutdownTimeoutMs??3e4,enableHttp2:s.enableHttp2||"Y",tlsVersion:s.tlsVersion?s.tlsVersion.split(",").filter(l=>l.trim()):["1.2"],tlsCipherSuites:s.tlsCipherSuites||"",disableGeneralOptionsHandler:s.disableGeneralOptionsHandler||"N",logConfigId:s.logConfigId||"",healthStatus:s.healthStatus||"Y",noteText:s.noteText||"",activeFlag:s.activeFlag||"Y",logConfig:s.logConfig?(()=>{try{const l=typeof i.logConfig=="string"?JSON.parse(i.logConfig):i.logConfig;return{configName:l.configName||"网关日志",configDesc:l.configDesc||"",logFormat:l.logFormat||"JSON",recordRequestBody:l.recordRequestBody||"N",recordResponseBody:l.recordResponseBody||"N",recordHeaders:l.recordHeaders||"Y",maxBodySizeBytes:l.maxBodySizeBytes??1048576,outputTargets:l.outputTargets||"DATABASE",fileConfig:l.fileConfig?(()=>{try{return typeof l.fileConfig=="string"?JSON.parse(l.fileConfig):l.fileConfig}catch(g){return console.warn("Failed to parse fileConfig JSON:",g),{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30}}})():{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:l.databaseConfig?(()=>{try{return typeof l.databaseConfig=="string"?JSON.parse(l.databaseConfig):l.databaseConfig}catch(g){return console.warn("Failed to parse databaseConfig JSON:",g),{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100}}})():{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:l.mongoConfig?(()=>{try{return typeof l.mongoConfig=="string"?JSON.parse(l.mongoConfig):l.mongoConfig}catch(g){return console.warn("Failed to parse mongoConfig JSON:",g),{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100}}})():{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:l.elasticsearchConfig?(()=>{try{return typeof l.elasticsearchConfig=="string"?JSON.parse(l.elasticsearchConfig):l.elasticsearchConfig}catch(g){return console.warn("Failed to parse elasticsearchConfig JSON:",g),{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100}}})():{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:l.clickhouseConfig?(()=>{try{return typeof l.clickhouseConfig=="string"?JSON.parse(l.clickhouseConfig):l.clickhouseConfig}catch(g){return console.warn("Failed to parse clickhouseConfig JSON:",g),{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100}}})():{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:l.enableAsyncLogging||"Y",asyncQueueSize:l.asyncQueueSize??1e3,asyncFlushIntervalMs:l.asyncFlushIntervalMs??5e3,enableBatchProcessing:l.enableBatchProcessing||"Y",batchSize:l.batchSize??100,batchTimeoutMs:l.batchTimeoutMs??1e3,logRetentionDays:l.logRetentionDays??30,enableFileRotation:l.enableFileRotation||"Y",maxFileSizeMB:l.maxFileSizeMB??100,maxFileCount:l.maxFileCount??10,rotationPattern:l.rotationPattern||"DAILY",enableSensitiveDataMasking:l.enableSensitiveDataMasking||"N",sensitiveFields:l.sensitiveFields?typeof l.sensitiveFields=="string"?l.sensitiveFields.split(","):l.sensitiveFields:["password","token","key","secret"],maskingPattern:l.maskingPattern||"****",bufferSize:l.bufferSize??65536,flushThreshold:l.flushThreshold??1e3,configPriority:l.configPriority??0,activeFlag:l.activeFlag||"Y",noteText:l.noteText||""}}catch(l){return console.warn("Failed to parse logConfig JSON:",l),{configName:"网关日志",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"Y",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e3,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"N",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}})():{configName:"",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"N",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e4,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"Y",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}),z.value=i.gatewayInstanceId,N.value=!0,C.value=!0}catch(u){ne.error("获取实例详情失败",u),d.error("获取实例详情失败")}finally{b.value=!1}},L=async()=>{try{r.value=!0;const i="TENANT_001",u={...S,tlsVersion:Array.isArray(S.tlsVersion)?S.tlsVersion.join(","):S.tlsVersion};if(u.logConfig){const l={...u.logConfig};Array.isArray(l.sensitiveFields)&&(l.sensitiveFields=l.sensitiveFields.join(",")),l.fileConfig=JSON.stringify(l.fileConfig),l.databaseConfig=JSON.stringify(l.databaseConfig),l.mongoConfig=JSON.stringify(l.mongoConfig),l.elasticsearchConfig=JSON.stringify(l.elasticsearchConfig),l.clickhouseConfig=JSON.stringify(l.clickhouseConfig),u.logConfig=JSON.stringify(l)}let s;if(N.value?s=await Vt({...u,tenantId:i,gatewayInstanceId:z.value}):s=await qt({...u,tenantId:i}),de(s)){const l=q(s,N.value?"网关实例更新成功":"网关实例创建成功");d.success(l),C.value=!1,await D(i),M()}else{const l=q(s,N.value?"更新失败":"创建失败");d.error(l)}}catch(i){ne.error(N.value?"更新网关实例失败":"创建网关实例失败",i),d.error(N.value?"更新失败":"创建失败")}finally{r.value=!1}},$=async i=>{try{const u=await jt(i.gatewayInstanceId,i.tenantId);if(de(u)){const s=q(u,"网关实例删除成功");d.success(s),await D(i.tenantId)}else{const s=q(u,"删除失败");d.error(s)}}catch(u){ne.error("删除网关实例失败",u),d.error("删除失败")}},p=async(i,u)=>{try{const s=u==="start"?"Y":"N",l=await Qt(i.gatewayInstanceId,i.tenantId,s);if(de(l)){const g=q(l,`实例${u==="start"?"启动":"停止"}成功`);d.success(g),await D(i.tenantId)}else{const g=q(l,`${u==="start"?"启动":"停止"}失败`);d.error(g)}}catch(s){ne.error(`${u==="start"?"启动":"停止"}实例失败`,s),d.error(`${u==="start"?"启动":"停止"}失败`)}},T=async i=>{try{const u=await Wt(i.gatewayInstanceId,i.tenantId);if(de(u)){const s=q(u,"网关重载成功");d.success(s),await D(i.tenantId)}else{const s=q(u,"网关重载失败");d.error(s)}}catch(u){ne.error("网关重载失败",u),d.error("网关重载失败")}},_=()=>{Object.assign(S,{instanceName:"",instanceDesc:"",bindAddress:"0.0.0.0",httpPort:8080,httpsPort:8443,tlsEnabled:"N",certStorageType:"DATABASE",certFilePath:"",keyFilePath:"",certContent:"",keyContent:"",certChainContent:"",certPassword:"",maxConnections:1e4,readTimeoutMs:3e4,writeTimeoutMs:3e4,idleTimeoutMs:6e4,maxHeaderBytes:1048576,maxWorkers:1e3,keepAliveEnabled:"Y",tcpKeepAliveEnabled:"Y",gracefulShutdownTimeoutMs:3e4,enableHttp2:"Y",tlsVersion:["1.2"],tlsCipherSuites:"",disableGeneralOptionsHandler:"N",logConfigId:"",healthStatus:"Y",noteText:"",activeFlag:"Y",logConfig:{configName:"网关日志",configDesc:"",logFormat:"JSON",recordRequestBody:"N",recordResponseBody:"N",recordHeaders:"Y",maxBodySizeBytes:1048576,outputTargets:"DATABASE",fileConfig:{enabled:!1,filePath:"./logs/gateway.log",maxSize:"100MB",maxBackups:7,maxAge:30},databaseConfig:{enabled:!1,connectionString:"",tableName:"gateway_access_log",batchSize:100},mongoConfig:{enabled:!1,connectionString:"",database:"gateway_logs",collection:"access_log",batchSize:100},elasticsearchConfig:{enabled:!1,endpoints:[],indexName:"gateway-logs",batchSize:100},clickhouseConfig:{enabled:!1,dsn:"",tableName:"gateway_access_log",batchSize:100},enableAsyncLogging:"Y",asyncQueueSize:1e3,asyncFlushIntervalMs:5e3,enableBatchProcessing:"Y",batchSize:100,batchTimeoutMs:1e3,logRetentionDays:30,enableFileRotation:"Y",maxFileSizeMB:100,maxFileCount:10,rotationPattern:"DAILY",enableSensitiveDataMasking:"N",sensitiveFields:["password","token","key","secret"],maskingPattern:"****",bufferSize:65536,flushThreshold:1e3,configPriority:0,activeFlag:"Y",noteText:""}}),z.value=""};return lt(()=>{D()}),{instances:h,loading:b,statistics:F,onlineInstances:R,offlineInstances:O,instanceForm:S,showInstanceModal:C,isEditing:N,submitting:r,fetchInstances:D,showCreateModal:x,showEditModal:Q,submitForm:L,deleteInstance:$,toggleInstanceStatus:p,reloadInstance:T,resetForm:_}}const Zt={class:"gateway-instance-manager"},ea={class:"page-header"},ta={class:"title"},aa={class:"actions"},na={class:"stat-content"},la={class:"stat-number"},oa={class:"stat-icon"},sa={class:"stat-content"},ia={class:"stat-number"},ra={class:"stat-icon"},ua={class:"stat-content"},da={class:"stat-number"},fa={class:"stat-icon"},ca={style:{padding:"16px"}},ga={style:{padding:"16px"}},ma={style:{padding:"16px"}},pa={style:{padding:"16px"}},ya=fe({__name:"GatewayInstanceManager",setup(d){const{instances:h,loading:b,statistics:F,instanceForm:S,showInstanceModal:C,isEditing:N,submitting:z,fetchInstances:r,showCreateModal:D,showEditModal:M,submitForm:R,deleteInstance:O,toggleInstanceStatus:x,reloadInstance:Q}=Xt(),L=st(),$=I(!1),p=I(""),T=l=>{L.warning({title:"确认删除",content:`确定要删除实例"${l.instanceName}"吗？此操作不可恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{O(l)}})},_=l=>{L.info({title:"确认启动",content:`确定要启动实例"${l.instanceName}"吗？`,positiveText:"确定启动",negativeText:"取消",onPositiveClick:()=>{x(l,"start")}})},i=l=>{L.warning({title:"确认停止",content:`确定要停止实例"${l.instanceName}"吗？停止后将无法处理请求。`,positiveText:"确定停止",negativeText:"取消",onPositiveClick:()=>{x(l,"stop")}})},u=l=>{p.value=l.gatewayInstanceId,$.value=!0},s=l=>{L.info({title:"确认网关重载",content:`确定要对实例"${l.instanceName}"执行网关重载操作吗？`,positiveText:"确定重载",negativeText:"取消",onPositiveClick:()=>{Q(l)}})};return(l,g)=>{const J=V,ie=j,W=ze,le=Oe,me=Re,pe=Pe,ae=Ue,n=ge,a=Ie,U=Ae,X=Me;return P(),ce("div",Zt,[e(W,null,{header:t(()=>[v("div",ea,[v("div",ta,[e(J,{size:"24",class:"icon"},{default:t(()=>[e(y(ye))]),_:1}),g[3]||(g[3]=v("h2",{class:"header-title"},"网关实例配置中心",-1))]),v("div",aa,[e(ie,{type:"primary",onClick:y(D)},{icon:t(()=>[e(J,null,{default:t(()=>[e(y(kt))]),_:1})]),default:t(()=>[g[4]||(g[4]=f(" 新建实例 "))]),_:1},8,["onClick"])])])]),default:t(()=>[e(me,{cols:3,"x-gap":16,"y-gap":16,class:"stats-grid"},{default:t(()=>[e(le,null,{default:t(()=>[e(W,{class:"stat-card"},{default:t(()=>[v("div",na,[v("div",la,ee(y(F).totalInstances),1),g[5]||(g[5]=v("div",{class:"stat-label"},"总实例数",-1))]),v("div",oa,[e(J,{size:"32",color:"#18a058"},{default:t(()=>[e(y(ye))]),_:1})])]),_:1})]),_:1}),e(le,null,{default:t(()=>[e(W,{class:"stat-card"},{default:t(()=>[v("div",sa,[v("div",ia,ee(y(F).onlineInstances),1),g[6]||(g[6]=v("div",{class:"stat-label"},"在线实例",-1))]),v("div",ra,[e(J,{size:"32",color:"#2080f0"},{default:t(()=>[e(y(xe))]),_:1})])]),_:1})]),_:1}),e(le,null,{default:t(()=>[e(W,{class:"stat-card"},{default:t(()=>[v("div",ua,[v("div",da,ee(y(F).offlineInstances),1),g[7]||(g[7]=v("div",{class:"stat-label"},"离线实例",-1))]),v("div",fa,[e(J,{size:"32",color:"#d03050"},{default:t(()=>[e(y(Ye))]),_:1})])]),_:1})]),_:1})]),_:1}),e(pe),e(It,{instances:y(h),loading:y(b),onCreate:y(D),onEdit:y(M),onDelete:T,onStart:_,onStop:i,onConfig:u,onReload:s,onRefresh:y(r)},null,8,["instances","loading","onCreate","onEdit","onRefresh"]),e(Kt,{show:y(C),"onUpdate:show":g[0]||(g[0]=w=>Be(C)?C.value=w:null),"is-editing":y(N),"form-data":y(S),submitting:y(z),onSubmit:y(R)},null,8,["show","is-editing","form-data","submitting","onSubmit"]),e(X,{show:$.value,"onUpdate:show":g[2]||(g[2]=w=>$.value=w),"mask-closable":!1},{default:t(()=>[e(W,{style:{width:"1400px"},title:"实例配置管理",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":t(()=>[e(ie,{quaternary:"",circle:"",onClick:g[1]||(g[1]=w=>$.value=!1)},{icon:t(()=>[e(J,null,{default:t(()=>[e(y(Ee))]),_:1})]),_:1})]),default:t(()=>[e(U,{type:"line",animated:""},{default:t(()=>[e(a,{name:"security",tab:"安全配置"},{default:t(()=>[v("div",ca,[e(n,{vertical:"",size:"large"},{default:t(()=>[e(ae,{type:"info"},{default:t(()=>g[8]||(g[8]=[f(" 配置实例级的安全策略，包括IP访问控制、User-Agent过滤、API访问控制等。 ")])),_:1}),e(y(ht),{"gateway-instance-id":p.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1}),e(a,{name:"cors",tab:"跨域配置"},{default:t(()=>[v("div",ga,[e(n,{vertical:"",size:"large"},{default:t(()=>[e(ae,{type:"info"},{default:t(()=>g[9]||(g[9]=[f(" 配置跨域资源共享(CORS)策略，允许的源、方法、头信息等。 ")])),_:1}),e(Ct,{"gateway-instance-id":p.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1}),e(a,{name:"auth",tab:"认证配置"},{default:t(()=>[v("div",ma,[e(n,{vertical:"",size:"large"},{default:t(()=>[e(ae,{type:"info"},{default:t(()=>g[10]||(g[10]=[f(" 配置认证策略，支持JWT、API Key、OAuth2.0、Basic Auth等认证方式。 ")])),_:1}),e(_t,{"gateway-instance-id":p.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1}),e(a,{name:"rateLimit",tab:"限流配置"},{default:t(()=>[v("div",pa,[e(n,{vertical:"",size:"large"},{default:t(()=>[e(ae,{type:"info"},{default:t(()=>g[11]||(g[11]=[f(" 配置流量控制策略，包括全局限流、IP限流、用户限流等。 ")])),_:1}),e(St,{"gateway-instance-id":p.value},null,8,["gateway-instance-id"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}}),Ha=ve(ya,[["__scopeId","data-v-0a528be8"]]);export{Ha as default};

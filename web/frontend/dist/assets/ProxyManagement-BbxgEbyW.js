import{G as tt}from"./GlobeOutline-BUMYBEq0.js";import{d as de,c as V,o as P,a,d5 as at,d6 as ht,m as t,x as w,n as e,ac as L,w as l,J as h,cE as $t,I as E,v as N,_ as me,Y as he,t as ee,b as xe,f as ye,g as Q,R as le,aa as ze,ab as je,q as Z,$ as bt,r as z,al as qe,V as pe,cB as Et,B as Be,E as ue,C as A,a7 as Se,cO as He,h as Ge,U as Qe,H as rt,a0 as Rt,a1 as Ht,cD as Ft,a2 as Mt,F as ot,cU as Ae,p as At,cA as Yt,am as Bt,an as Lt,M as it,A as Te,cz as vt,cQ as xt,O as Oe,ag as I,a3 as Ce,b6 as Vt,ao as Xe,d7 as Jt,a8 as qt,a9 as Me,a4 as Kt}from"./index-CzIbiPcR.js";import{C as Ze}from"./CreateOutline-BFkdrBh9.js";import{S as Le}from"./StopCircleOutline-iTB1pYp7.js";import{C as Ie}from"./CheckmarkCircleOutline-DaZKMTJF.js";import{T as Fe}from"./TrashOutline-2R_Ts6Ka.js";import{N as et}from"./Popconfirm-Jlwr2tlU.js";import{N as jt,e as Wt,_ as ut}from"./DataTable-CMD0QL_W.js";import{_ as we}from"./Table-43iCAxnl.js";import{_ as Ct,C as Je}from"./CloseOutline-D_yIhE7x.js";import{C as Xt}from"./Close-VYvydJSP.js";import{_ as De,a as G}from"./Grid-DtPWGMN9.js";import{_ as Gt}from"./FormItemGridItem-B8BBWZsl.js";import{_ as ve,b as Qt}from"./RadioGroup-BBKwhzSS.js";import{N as ke}from"./InputNumber-DYqA-vrb.js";import{N as Pe}from"./Switch-DmPX386B.js";import{_ as Zt}from"./DynamicTags-BE01c2Nw.js";import{A as dt}from"./AddOutline-DReI0b2u.js";import{L as _t,P as el}from"./PencilOutline-nZjkWohw.js";import{N as tl,a as ll,H as al}from"./HeartOutline-DeDwNs4O.js";import{u as ol}from"./usePagination-rBGSs64l.js";import{C as We}from"./CloseCircleOutline-Dzm8Wp_s.js";import{A as Tt}from"./AlertCircleOutline-BptlU4rj.js";import{R as Ye}from"./RefreshOutline-CA3Zk8OZ.js";import{P as St}from"./PlayOutline-Cd76hMiY.js";import{T as nl}from"./TimeOutline-e6ea6nIg.js";import{S as gt}from"./SpeedometerOutline-Cb-Ie6rC.js";import{_ as Ke}from"./Statistic-BLv2tZo5.js";import{N as sl}from"./CollapseTransition-Dv8Ngul9.js";import{C as rl}from"./ChevronUpOutline-BNduPpW9.js";import{C as il}from"./ChevronDownOutline-DbTRakv4.js";import{I as lt}from"./InformationCircleOutline-DB_x5CQ_.js";import{W as yt}from"./WarningOutline-DI6XddCH.js";import{_ as Ve}from"./Alert-B2DIZRvN.js";import"./index-C9U1NGvg.js";const ul={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},dl=de({name:"CheckmarkOutline",render:function(y,p){return P(),V("svg",ul,p[0]||(p[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M416 128L192 384l-96-96"},null,-1)]))}}),cl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},pl=de({name:"CodeOutline",render:function(y,p){return P(),V("svg",cl,p[0]||(p[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M160 368L32 256l128-112"},null,-1),a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M352 368l128-112l-128-112"},null,-1)]))}}),fl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},wt=de({name:"CopyOutline",render:function(y,p){return P(),V("svg",fl,p[0]||(p[0]=[a("rect",{x:"128",y:"128",width:"336",height:"336",rx:"57",ry:"57",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("path",{d:"M383.5 128l.5-24a56.16 56.16 0 0 0-56-56H112a64.19 64.19 0 0 0-64 64v216a56.16 56.16 0 0 0 56 56h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),vl={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},gl=de({name:"EllipseOutline",render:function(y,p){return P(),V("svg",vl,p[0]||(p[0]=[a("circle",{cx:"256",cy:"256",r:"192",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}});var ce=(v=>(v.HTTP="http",v.WEBSOCKET="websocket",v.TCP="tcp",v.UDP="udp",v))(ce||{}),ge=(v=>(v[v.STATIC=0]="STATIC",v[v.DISCOVERY=1]="DISCOVERY",v))(ge||{}),ne=(v=>(v.ROUND_ROBIN="round-robin",v.RANDOM="random",v.IP_HASH="ip-hash",v.LEAST_CONN="least-conn",v.WEIGHTED_ROUND_ROBIN="weighted-round-robin",v.CONSISTENT_HASH="consistent-hash",v))(ne||{}),Re=(v=>(v.CONSUL="CONSUL",v.EUREKA="EUREKA",v.NACOS="NACOS",v.REGISTRY="REGISTRY",v))(Re||{}),be=(v=>(v[v.OFFLINE=0]="OFFLINE",v[v.ONLINE=1]="ONLINE",v[v.MAINTENANCE=2]="MAINTENANCE",v))(be||{});function kt(){function v(C){return C&&{[ce.HTTP]:"HTTP",[ce.WEBSOCKET]:"WebSocket",[ce.TCP]:"TCP",[ce.UDP]:"UDP"}[C]||"未知"}function y(C){return C?{[ce.HTTP]:tt,[ce.WEBSOCKET]:ht,[ce.TCP]:at,[ce.UDP]:at}[C]||tt:tt}function p(C){return C&&{[ce.HTTP]:"#2080f0",[ce.WEBSOCKET]:"#f0a020",[ce.TCP]:"#8a2be2",[ce.UDP]:"#d03050"}[C]||"#d0d0d0"}function i(C){return C&&{[ce.HTTP]:"info",[ce.WEBSOCKET]:"warning",[ce.TCP]:"success",[ce.UDP]:"error"}[C]||"default"}return{getProxyTypeName:v,getProxyTypeIcon:y,getProxyTypeIconColor:p,getProxyTypeTagType:i}}const yl={class:"proxy-header"},ml={class:"proxy-title"},hl={class:"proxy-title-content"},bl={class:"proxy-name-container"},xl={class:"proxy-name"},Cl={class:"proxy-actions"},_l=de({__name:"ProxyDetailHeader",props:{proxyConfig:{}},emits:["edit","delete","toggleStatus"],setup(v,{emit:y}){const p=v,i=y,{getProxyTypeName:C,getProxyTypeTagType:b}=kt();function f(){i("edit",p.proxyConfig)}function u(){i("delete",p.proxyConfig.proxyConfigId)}function r(){i("toggleStatus",p.proxyConfig)}return(T,m)=>(P(),V("div",yl,[a("div",ml,[a("div",hl,[a("div",bl,[a("span",xl,w(T.proxyConfig.proxyName),1),t(e(L),{type:e(b)(T.proxyConfig.proxyType),size:"small"},{default:l(()=>[h(w(e(C)(T.proxyConfig.proxyType)),1)]),_:1},8,["type"]),t(e(L),{type:T.proxyConfig.activeFlag==="Y"?"success":"error",size:"small"},{default:l(()=>[h(w(T.proxyConfig.activeFlag==="Y"?"已启用":"已禁用"),1)]),_:1},8,["type"])])])]),a("div",Cl,[t(e($t),null,{default:l(()=>[t(e(E),{onClick:f,secondary:""},{icon:l(()=>[t(e(N),{component:e(Ze)},null,8,["component"])]),default:l(()=>[m[0]||(m[0]=h(" 编辑 "))]),_:1}),t(e(E),{onClick:r,type:T.proxyConfig.activeFlag==="Y"?"warning":"success"},{icon:l(()=>[t(e(N),{component:T.proxyConfig.activeFlag==="Y"?e(Le):e(Ie)},null,8,["component"])]),default:l(()=>[h(" "+w(T.proxyConfig.activeFlag==="Y"?"禁用":"启用"),1)]),_:1},8,["type"]),t(e(et),{onPositiveClick:u},{trigger:l(()=>[t(e(E),{type:"error"},{icon:l(()=>[t(e(N),{component:e(Fe)},null,8,["component"])]),default:l(()=>[m[1]||(m[1]=h(" 删除 "))]),_:1})]),default:l(()=>[m[2]||(m[2]=h(" 确定要删除此代理配置吗？ "))]),_:1})]),_:1})])]))}}),Tl=me(_l,[["__scopeId","data-v-4e679762"]]),Sl={class:"proxy-basic-info"},wl={key:0},kl={colspan:"3",class:"note-cell"},Il=de({__name:"ProxyBasicInfo",props:{proxyConfig:{}},setup(v){return(y,p)=>(P(),V("div",Sl,[t(e(he),{"title-placement":"left"},{default:l(()=>p[0]||(p[0]=[h("基本信息")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[p[1]||(p[1]=a("td",{class:"table-label"},"代理ID",-1)),a("td",null,[t(e(jt),null,{default:l(()=>[h(w(y.proxyConfig.proxyConfigId),1)]),_:1})]),p[2]||(p[2]=a("td",{class:"table-label"},"优先级",-1)),a("td",null,w(y.proxyConfig.configPriority||0),1)]),a("tr",null,[p[3]||(p[3]=a("td",{class:"table-label"},"创建时间",-1)),a("td",null,w(y.proxyConfig.addTime?new Date(y.proxyConfig.addTime).toLocaleString():"-"),1),p[4]||(p[4]=a("td",{class:"table-label"},"最后修改",-1)),a("td",null,w(y.proxyConfig.editTime?new Date(y.proxyConfig.editTime).toLocaleString():"-"),1)]),y.proxyConfig.noteText?(P(),V("tr",wl,[p[5]||(p[5]=a("td",{class:"table-label"},"备注",-1)),a("td",kl,w(y.proxyConfig.noteText),1)])):ee("",!0)])]),_:1})]))}}),Nl=me(Il,[["__scopeId","data-v-9e91ac86"]]),Pl={class:"http-proxy-config"},Ol={class:"config-section"},zl={class:"config-section"},Dl={class:"config-section"},Ul={class:"config-section"},$l={key:0,class:"config-section"},El={key:0},Rl={colspan:"3"},Hl={class:"header-list"},Fl={key:1},Ml={colspan:"3"},Al={class:"header-list"},Yl={key:2},Bl={colspan:"3"},Ll={class:"header-list"},Vl={class:"config-section"},Jl={key:1,class:"config-section"},ql=de({__name:"HttpProxyConfig",props:{proxyConfig:{}},setup(v){const y=v,p=xe(),i=ye({timeout:30,followRedirects:!0,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3"}),C=Q(()=>i.setHeaders&&Object.keys(i.setHeaders).length>0||i.passHeaders&&i.passHeaders.length>0||i.hideHeaders&&i.hideHeaders.length>0),b=Q(()=>i.tlsInsecureSkipVerify!==void 0||i.tlsServerName||i.tlsMinVersion||i.tlsMaxVersion);function f(u){try{const r=typeof u=="string"?JSON.parse(u):u;Object.assign(i,{timeout:30,followRedirects:!0,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3"}),r&&Object.assign(i,r)}catch(r){p.error("解析HTTP代理配置失败"),console.error("解析HTTP代理配置失败:",r)}}return le(()=>y.proxyConfig,u=>{u&&f(u)},{immediate:!0}),(u,r)=>(P(),V("div",Pl,[t(e(he),{"title-placement":"left"},{default:l(()=>r[0]||(r[0]=[h("HTTP代理配置")])),_:1}),a("div",Ol,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[1]||(r[1]=[h("超时配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[r[2]||(r[2]=a("td",{class:"table-label"},"超时时间",-1)),a("td",null,w(i.timeout||"-")+"秒",1),r[3]||(r[3]=a("td",{class:"table-label"},"发送超时",-1)),a("td",null,w(i.sendTimeout||"-")+"秒",1)]),a("tr",null,[r[4]||(r[4]=a("td",{class:"table-label"},"读取超时",-1)),a("td",null,w(i.readTimeout||"-")+"秒",1),r[5]||(r[5]=a("td",{class:"table-label"},"连接超时",-1)),a("td",null,w(i.connectTimeout||"-")+"秒",1)]),a("tr",null,[r[6]||(r[6]=a("td",{class:"table-label"},"空闲连接超时",-1)),a("td",null,w(i.idleConnTimeout||"-")+"秒",1),r[7]||(r[7]=a("td",{class:"table-label"},"重试超时",-1)),a("td",null,w(i.retryTimeout||"-")+"秒",1)])])]),_:1})]),a("div",zl,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[8]||(r[8]=[h("连接配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[r[9]||(r[9]=a("td",{class:"table-label"},"最大空闲连接数",-1)),a("td",null,w(i.maxIdleConns!==void 0?i.maxIdleConns:"-"),1),r[10]||(r[10]=a("td",{class:"table-label"},"HTTP版本",-1)),a("td",null,w(i.httpVersion||"-"),1)]),a("tr",null,[r[11]||(r[11]=a("td",{class:"table-label"},"跟随重定向",-1)),a("td",null,[t(e(L),{type:i.followRedirects?"success":"default",size:"small"},{default:l(()=>[h(w(i.followRedirects?"是":"否"),1)]),_:1},8,["type"])]),r[12]||(r[12]=a("td",{class:"table-label"},"保持连接",-1)),a("td",null,[t(e(L),{type:i.keepAlive?"success":"default",size:"small"},{default:l(()=>[h(w(i.keepAlive?"是":"否"),1)]),_:1},8,["type"])])])])]),_:1})]),a("div",Dl,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[13]||(r[13]=[h("响应处理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[r[14]||(r[14]=a("td",{class:"table-label"},"缓冲区大小",-1)),a("td",null,w(i.bufferSize||"-")+"字节",1),r[15]||(r[15]=a("td",{class:"table-label"},"最大缓冲区大小",-1)),a("td",null,w(i.maxBufferSize||"-")+"字节",1)]),a("tr",null,[r[16]||(r[16]=a("td",{class:"table-label"},"复制响应体",-1)),a("td",null,[t(e(L),{type:i.copyResponseBody?"success":"default",size:"small"},{default:l(()=>[h(w(i.copyResponseBody?"是":"否"),1)]),_:1},8,["type"])]),r[17]||(r[17]=a("td",{class:"table-label"},"代理缓冲",-1)),a("td",null,[t(e(L),{type:i.proxyBuffering?"success":"default",size:"small"},{default:l(()=>[h(w(i.proxyBuffering?"是":"否"),1)]),_:1},8,["type"])])])])]),_:1})]),a("div",Ul,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[18]||(r[18]=[h("重试配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[r[19]||(r[19]=a("td",{class:"table-label"},"重试次数",-1)),a("td",null,w(i.retryCount!==void 0?i.retryCount:"-"),1),r[20]||(r[20]=a("td",{class:"table-label"},null,-1)),r[21]||(r[21]=a("td",null,null,-1))])])]),_:1})]),C.value?(P(),V("div",$l,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[22]||(r[22]=[h("头部配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[i.setHeaders&&Object.keys(i.setHeaders).length>0?(P(),V("tr",El,[r[23]||(r[23]=a("td",{class:"table-label"},"设置头部",-1)),a("td",Rl,[a("div",Hl,[(P(!0),V(ze,null,je(i.setHeaders,(T,m)=>(P(),Z(e(L),{key:m,size:"small",class:"header-tag"},{default:l(()=>[h(w(m)+": "+w(T),1)]),_:2},1024))),128))])])])):ee("",!0),i.passHeaders&&i.passHeaders.length>0?(P(),V("tr",Fl,[r[24]||(r[24]=a("td",{class:"table-label"},"允许传递的头部",-1)),a("td",Ml,[a("div",Al,[(P(!0),V(ze,null,je(i.passHeaders,T=>(P(),Z(e(L),{key:T,size:"small",type:"info",class:"header-tag"},{default:l(()=>[h(w(T),1)]),_:2},1024))),128))])])])):ee("",!0),i.hideHeaders&&i.hideHeaders.length>0?(P(),V("tr",Yl,[r[25]||(r[25]=a("td",{class:"table-label"},"隐藏的头部",-1)),a("td",Bl,[a("div",Ll,[(P(!0),V(ze,null,je(i.hideHeaders,T=>(P(),Z(e(L),{key:T,size:"small",type:"warning",class:"header-tag"},{default:l(()=>[h(w(T),1)]),_:2},1024))),128))])])])):ee("",!0)])]),_:1})])):ee("",!0),a("div",Vl,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[26]||(r[26]=[h("高级选项")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[r[27]||(r[27]=a("td",{class:"table-label"},"保留原始Host头部",-1)),a("td",null,[t(e(L),{type:i.preserveHost?"success":"default",size:"small"},{default:l(()=>[h(w(i.preserveHost?"是":"否"),1)]),_:1},8,["type"])]),r[28]||(r[28]=a("td",{class:"table-label"},"添加X-Forwarded-For",-1)),a("td",null,[t(e(L),{type:i.addXForwardedFor?"success":"default",size:"small"},{default:l(()=>[h(w(i.addXForwardedFor?"是":"否"),1)]),_:1},8,["type"])])]),a("tr",null,[r[29]||(r[29]=a("td",{class:"table-label"},"添加X-Real-IP",-1)),a("td",null,[t(e(L),{type:i.addXRealIP?"success":"default",size:"small"},{default:l(()=>[h(w(i.addXRealIP?"是":"否"),1)]),_:1},8,["type"])]),r[30]||(r[30]=a("td",{class:"table-label"},"添加X-Forwarded-Proto",-1)),a("td",null,[t(e(L),{type:i.addXForwardedProto?"success":"default",size:"small"},{default:l(()=>[h(w(i.addXForwardedProto?"是":"否"),1)]),_:1},8,["type"])])])])]),_:1})]),b.value?(P(),V("div",Jl,[t(e(he),{"title-placement":"left",class:"section-title"},{default:l(()=>r[31]||(r[31]=[h("TLS配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[r[32]||(r[32]=a("td",{class:"table-label"},"跳过TLS证书验证",-1)),a("td",null,[t(e(L),{type:i.tlsInsecureSkipVerify?"warning":"success",size:"small"},{default:l(()=>[h(w(i.tlsInsecureSkipVerify?"是":"否"),1)]),_:1},8,["type"])]),r[33]||(r[33]=a("td",{class:"table-label"},"TLS服务器名称",-1)),a("td",null,w(i.tlsServerName||"-"),1)]),a("tr",null,[r[34]||(r[34]=a("td",{class:"table-label"},"最小TLS版本",-1)),a("td",null,w(i.tlsMinVersion||"-"),1),r[35]||(r[35]=a("td",{class:"table-label"},"最大TLS版本",-1)),a("td",null,w(i.tlsMaxVersion||"-"),1)])])]),_:1})])):ee("",!0)]))}}),Kl=me(ql,[["__scopeId","data-v-d2351c34"]]),jl={class:"websocket-proxy-config"},Wl=de({__name:"WebSocketProxyConfig",props:{proxyConfig:{}},setup(v){const y=v,p=xe(),i=ye({pingInterval:30,pongTimeout:10,maxMessageSize:32768,enableCompression:!1});function C(b){try{const f=typeof b=="string"?JSON.parse(b):b;Object.assign(i,f)}catch{p.error("解析WebSocket代理配置失败")}}return le(()=>y.proxyConfig,b=>{b&&C(b)},{immediate:!0}),(b,f)=>(P(),V("div",jl,[t(e(he),{"title-placement":"left"},{default:l(()=>f[0]||(f[0]=[h("WebSocket代理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[f[1]||(f[1]=a("td",{class:"table-label"},"Ping间隔",-1)),a("td",null,w(i.pingInterval||"-")+"秒",1),f[2]||(f[2]=a("td",{class:"table-label"},"Pong超时",-1)),a("td",null,w(i.pongTimeout||"-")+"秒",1)]),a("tr",null,[f[3]||(f[3]=a("td",{class:"table-label"},"最大消息大小",-1)),a("td",null,w(i.maxMessageSize!==void 0?i.maxMessageSize:"-")+"字节",1),f[4]||(f[4]=a("td",{class:"table-label"},"启用压缩",-1)),a("td",null,[t(e(L),{type:i.enableCompression?"success":"default",size:"small"},{default:l(()=>[h(w(i.enableCompression?"是":"否"),1)]),_:1},8,["type"])])]),a("tr",null,[f[5]||(f[5]=a("td",{class:"table-label"},"心跳检测",-1)),a("td",null,[t(e(L),{type:i.pingInterval>0?"success":"default",size:"small"},{default:l(()=>[h(w(i.pingInterval>0?"启用":"禁用"),1)]),_:1},8,["type"])]),f[6]||(f[6]=a("td",{class:"table-label"},"-",-1)),f[7]||(f[7]=a("td",null,"-",-1))])])]),_:1})]))}}),Xl=me(Wl,[["__scopeId","data-v-9af94ff4"]]),Gl={class:"tcp-proxy-config"},Ql=de({__name:"TcpProxyConfig",props:{proxyConfig:{}},setup(v){const y=v,p=xe(),i=ye({connectTimeout:5,keepAlive:!0});function C(b){try{const f=typeof b=="string"?JSON.parse(b):b;Object.assign(i,f)}catch{p.error("解析TCP代理配置失败")}}return le(()=>y.proxyConfig,b=>{b&&C(b)},{immediate:!0}),(b,f)=>(P(),V("div",Gl,[t(e(he),{"title-placement":"left"},{default:l(()=>f[0]||(f[0]=[h("TCP代理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[f[1]||(f[1]=a("td",{class:"table-label"},"连接超时",-1)),a("td",null,w(i.connectTimeout||"-")+"秒",1),f[2]||(f[2]=a("td",{class:"table-label"},"保持连接",-1)),a("td",null,[t(e(L),{type:i.keepAlive?"success":"default",size:"small"},{default:l(()=>[h(w(i.keepAlive?"是":"否"),1)]),_:1},8,["type"])])]),a("tr",null,[f[3]||(f[3]=a("td",{class:"table-label"},"连接状态",-1)),a("td",null,[t(e(L),{type:i.connectTimeout>0?"success":"warning",size:"small"},{default:l(()=>[h(w(i.connectTimeout>0?"正常":"异常"),1)]),_:1},8,["type"])]),f[4]||(f[4]=a("td",{class:"table-label"},"-",-1)),f[5]||(f[5]=a("td",null,"-",-1))])])]),_:1})]))}}),Zl=me(Ql,[["__scopeId","data-v-4e77dd2b"]]),ea={class:"udp-proxy-config"},ta=de({__name:"UdpProxyConfig",props:{proxyConfig:{}},setup(v){const y=v,p=xe(),i=ye({bufferSize:4096});function C(b){try{const f=typeof b=="string"?JSON.parse(b):b;Object.assign(i,f)}catch{p.error("解析UDP代理配置失败")}}return le(()=>y.proxyConfig,b=>{b&&C(b)},{immediate:!0}),(b,f)=>(P(),V("div",ea,[t(e(he),{"title-placement":"left"},{default:l(()=>f[0]||(f[0]=[h("UDP代理配置")])),_:1}),t(e(we),{bordered:!1,"single-line":!1,class:"info-table"},{default:l(()=>[a("tbody",null,[a("tr",null,[f[1]||(f[1]=a("td",{class:"table-label"},"缓冲区大小",-1)),a("td",null,w(i.bufferSize!==void 0?i.bufferSize:"-")+"字节",1),f[2]||(f[2]=a("td",{class:"table-label"},"缓冲区状态",-1)),a("td",null,[t(e(L),{type:i.bufferSize>0?"success":"warning",size:"small"},{default:l(()=>[h(w(i.bufferSize>0?"正常":"异常"),1)]),_:1},8,["type"])])]),a("tr",null,[f[4]||(f[4]=a("td",{class:"table-label"},"数据包处理",-1)),a("td",null,[t(e(L),{type:"info",size:"small"},{default:l(()=>f[3]||(f[3]=[h(" 无连接协议 ")])),_:1})]),f[5]||(f[5]=a("td",{class:"table-label"},"-",-1)),f[6]||(f[6]=a("td",null,"-",-1))])])]),_:1})]))}}),la=me(ta,[["__scopeId","data-v-b048e1c2"]]),fe=bt("/gateway/hub0022"),aa=bt("/gateway/hub0020");async function oa(v){return aa.post("/queryGatewayInstances",v)}async function It(v){return fe.post("/getProxyConfigsByInstance",v)}async function na(v){return fe.post("/addProxyConfig",v)}async function Nt(v){return fe.post("/editProxyConfig",v)}async function sa(v,y){return fe.post("/deleteProxyConfig",{proxyConfigId:v,tenantId:y})}async function ra(v){return fe.post("/testProxyConnection",v)}async function ia(v){return fe.post("/queryServiceDefinitions",v)}async function ua(v,y){return fe.post("/getServiceDefinition",{serviceDefinitionId:v,tenantId:y})}async function da(v){return fe.post("/addServiceDefinition",v)}async function nt(v){return fe.post("/editServiceDefinition",v)}async function mt(v,y){return fe.post("/deleteServiceDefinition",{serviceDefinitionId:v,tenantId:y})}async function ca(v){return fe.post("/queryServiceNodes",v)}async function pa(v){return fe.post("/addServiceNode",v)}async function st(v){return fe.post("/editServiceNode",v)}async function fa(v,y){return fe.post("/deleteServiceNode",{serviceNodeId:v,tenantId:y})}async function va(v){const y=v.tenantId||"default";return fe.post("/updateServiceNodeStatus",{...v,tenantId:y})}async function ga(v){return fe.post("/batchDeleteServiceNodes",{serviceNodeIds:v,tenantId:"default"})}async function ya(v){return fe.post("/registServiceQuery",v)}const ma={class:"modal-header"},ha={class:"header-content"},ba={class:"modal-title"},xa={class:"modal-content"},Ca={class:"form-section"},_a={class:"form-section"},Ta={class:"config-group"},Sa={class:"config-group"},wa={class:"config-group"},ka={class:"config-group"},Ia={class:"config-group"},Na={style:{display:"flex","align-items":"center",width:"100%",gap:"16px"}},Pa={class:"config-group"},Oa={class:"config-group"},za={key:1,class:"config-group"},Da={key:2,class:"config-group"},Ua={key:3,class:"config-group"},$a={class:"form-section"},Ea={class:"modal-footer"},Ra=de({__name:"ProxyConfigDialog",props:{show:{type:Boolean,default:!1},formData:{default:()=>({})},mode:{default:"add"}},emits:["update:show","refresh"],setup(v,{emit:y}){const p=v,i=y,C=xe(),b=z(null),f=z(p.show),u=z(!1),r=[{label:"HTTP",value:"http"},{label:"WebSocket",value:"websocket"},{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],T=[{label:"HTTP/1.0",value:"1.0"},{label:"HTTP/1.1",value:"1.1"}],m=[{label:"TLS 1.0",value:"1.0"},{label:"TLS 1.1",value:"1.1"},{label:"TLS 1.2",value:"1.2"},{label:"TLS 1.3",value:"1.3"}],O=ye({gatewayInstanceId:"",proxyName:"",proxyType:"http",configPriority:0,proxyConfig:{},activeFlag:"Y",noteText:""}),_=ye({timeout:30,followRedirects:!1,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3",setHeaders:{},passHeaders:[],hideHeaders:[]}),K=z([]);le(K,d=>{const n={};d.forEach(q=>{q.key&&q.value&&(n[q.key]=q.value)}),_.setHeaders=n},{deep:!0});function Y(d){d&&typeof d=="object"?K.value=Object.entries(d).map(([n,q])=>({key:n,value:q})):K.value=[]}const H=ye({pingInterval:30,pongTimeout:10,maxMessageSize:32768,enableCompression:!1}),M=ye({connectTimeout:5,keepAlive:!0}),R=ye({bufferSize:4096}),j=Q({get:()=>O.activeFlag==="Y",set:d=>{O.activeFlag=d?"Y":"N"}}),S=z("{}");le(S,d=>{try{O.customConfig=JSON.parse(d)}catch(n){console.warn("JSON解析错误:",n)}});function x(d){if(d&&typeof d=="object")try{S.value=JSON.stringify(d,null,2)}catch(n){console.warn("JSON序列化错误:",n),S.value="{}"}else S.value="{}"}const $={proxyName:[{required:!0,message:"请输入代理名称",trigger:["blur","input"]},{max:50,message:"代理名称不能超过50个字符",trigger:["blur","input"]}],proxyType:[{required:!0,message:"请选择代理类型",trigger:["blur","change"]}],configPriority:[{required:!0,message:"请输入优先级",trigger:["blur","change"],validator:(d,n)=>{if(n==null||n==="")return new Error("请输入优先级");const q=Number(n);return isNaN(q)?new Error("优先级必须是数字"):q<0||q>999?new Error("优先级必须是0-999之间的数字"):!0}}],"proxyConfig.timeout":[{required:!0,message:"请输入超时时间",trigger:["blur","change"],type:"number",validator:(d,n)=>n==null?new Error("请输入超时时间"):n<1?new Error("超时时间必须大于0秒"):n>3600?new Error("超时时间不能超过3600秒"):!0}],"proxyConfig.idleConnTimeout":[{required:!0,message:"请输入空闲连接超时时间",trigger:["blur","change"],type:"number",validator:(d,n)=>n==null?new Error("请输入空闲连接超时时间"):n<1?new Error("空闲连接超时时间必须大于0秒"):n>7200?new Error("空闲连接超时时间不能超过7200秒"):!0}],"proxyConfig.retryTimeout":[{required:!0,message:"请输入重试超时时间",trigger:["blur","change"],type:"number",validator:(d,n)=>n==null?new Error("请输入重试超时时间"):n<1?new Error("重试超时时间必须大于0秒"):n>300?new Error("重试超时时间不能超过300秒"):!0}]};le(()=>p.show,d=>{var n,q,te,se,Ne,W,Ue,re,ie;f.value=d,d&&(Object.assign(O,{gatewayInstanceId:((n=p.formData)==null?void 0:n.gatewayInstanceId)||"",proxyName:((q=p.formData)==null?void 0:q.proxyName)||"",proxyType:((te=p.formData)==null?void 0:te.proxyType)||"http",configPriority:((se=p.formData)==null?void 0:se.configPriority)!==void 0?Number(p.formData.configPriority):0,activeFlag:((Ne=p.formData)==null?void 0:Ne.activeFlag)||"Y",noteText:((W=p.formData)==null?void 0:W.noteText)||"",proxyConfigId:(Ue=p.formData)==null?void 0:Ue.proxyConfigId,customConfig:D((re=p.formData)==null?void 0:re.customConfig)}),x(O.customConfig),Y(),(ie=p.formData)!=null&&ie.proxyConfig&&J(p.formData.proxyConfig))}),le(f,d=>{i("update:show",d)}),le(()=>O.proxyType,()=>{O.proxyConfig=X()},{immediate:!0}),le([_,H,M,R],()=>{O.proxyConfig=X()},{deep:!0});function ae(d){if(typeof d=="number")return d;if(typeof d=="string"){const n=d.replace(/[smhd]$/,""),q=parseFloat(n);return isNaN(q)?void 0:q}}function oe(d){const n={...d};return["timeout","sendTimeout","readTimeout","connectTimeout","idleConnTimeout","retryTimeout"].forEach(te=>{if(n[te]!==void 0){const se=ae(n[te]);se!==void 0&&(n[te]=se)}}),n}function J(d){try{const n=typeof d=="string"?JSON.parse(d):d;switch(O.proxyType){case"http":const q=oe(n);Object.assign(_,{timeout:30,followRedirects:!1,keepAlive:!0,maxIdleConns:100,idleConnTimeout:90,copyResponseBody:!1,bufferSize:4096,maxBufferSize:65536,retryCount:3,retryTimeout:10,sendTimeout:30,readTimeout:30,connectTimeout:10,httpVersion:"1.1",preserveHost:!1,addXForwardedFor:!0,addXRealIP:!0,addXForwardedProto:!0,proxyBuffering:!0,tlsInsecureSkipVerify:!1,tlsMinVersion:"1.2",tlsMaxVersion:"1.3",setHeaders:{},passHeaders:[],hideHeaders:[]},q),Y(q.setHeaders);break;case"websocket":Object.assign(H,n);break;case"tcp":const te={...n};if(te.connectTimeout!==void 0){const se=ae(te.connectTimeout);se!==void 0&&(te.connectTimeout=se)}Object.assign(M,te);break;case"udp":Object.assign(R,n);break}}catch(n){C.error("解析代理配置失败"),console.error("配置解析错误:",n)}}function D(d){if(!d)return{};try{return typeof d=="string"?JSON.parse(d):d}catch{return{}}}function B(d){O.proxyType=d}function X(){switch(O.proxyType){case"http":return _;case"websocket":return H;case"tcp":return M;case"udp":return R;default:return{}}}function F(){return{key:"",value:""}}function U(d,n,q){K.value[d]&&(K.value[d][n]=q)}function c(){f.value=!1}async function o(){var d;try{try{await((d=b.value)==null?void 0:d.validate())}catch{return}u.value=!0;const n={...O,proxyConfig:JSON.stringify(X()),customConfig:O.customConfig?JSON.stringify(O.customConfig):"{}",tenantId:"default"};p.mode==="add"?(await na(n),C.success("创建代理配置成功")):(await Nt({...n,proxyConfigId:p.formData.proxyConfigId||""}),C.success("更新代理配置成功")),c(),i("refresh")}catch(n){C.error(n.message||"操作失败")}finally{u.value=!1}}function s(){try{JSON.parse(S.value),C.success("JSON格式有效")}catch(d){console.error("JSON验证错误:",d),C.error(`JSON格式无效: ${d.message}`)}}function g(){try{const d=JSON.parse(S.value);S.value=JSON.stringify(d,null,2),C.success("JSON格式化成功")}catch(d){console.error("JSON解析错误:",d),C.error("JSON格式错误，无法格式化")}}return(d,n)=>{const q=N,te=E,se=he,Ne=ue,W=Gt,Ue=ve,re=De,ie=ke,_e=Pe,$e=A,Pt=Ct,ct=Zt,pt=Se,Ot=Be,zt=Et,Dt=pe,Ut=qe;return P(),Z(Ut,{show:f.value,"onUpdate:show":n[39]||(n[39]=k=>f.value=k),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(Dt,{style:{width:"1000px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true",class:"proxy-modal"},{header:l(()=>[a("div",ma,[t(q,{size:"24",class:"modal-icon"},{default:l(()=>[t(e(He))]),_:1}),a("div",ha,[a("h3",ba,w(d.mode==="add"?"新建代理配置":"编辑代理配置"),1),n[40]||(n[40]=a("p",{class:"modal-subtitle"},"配置代理服务的基本信息、类型和参数",-1))])])]),"header-extra":l(()=>[t(te,{quaternary:"",circle:"",onClick:c,class:"close-btn"},{icon:l(()=>[t(q,{size:"18"},{default:l(()=>[t(e(Xt))]),_:1})]),_:1})]),footer:l(()=>[a("div",Ea,[t(pt,{justify:"end"},{default:l(()=>[t(te,{onClick:c,size:"medium"},{default:l(()=>n[56]||(n[56]=[h("取消")])),_:1}),t(te,{type:"primary",loading:u.value,onClick:o,size:"medium"},{default:l(()=>[h(w(d.mode==="add"?"创建":"更新"),1)]),_:1},8,["loading"])]),_:1})])]),default:l(()=>[t(zt,{style:{"max-height":"75vh"},trigger:"hover","x-scrollable":!1},{default:l(()=>[a("div",xa,[t(Ot,{ref_key:"formRef",ref:b,model:O,rules:$,"label-placement":"left","label-width":"150px","require-mark-placement":"right-hanging",class:"proxy-form"},{default:l(()=>[a("div",Ca,[t(se,{"title-placement":"left",class:"section-divider"},{default:l(()=>n[41]||(n[41]=[h("基本信息")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"代理名称",path:"proxyName"},{default:l(()=>[t(Ne,{value:O.proxyName,"onUpdate:value":n[0]||(n[0]=k=>O.proxyName=k),placeholder:"请输入代理名称",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"代理类型",path:"proxyType"},{default:l(()=>[t(Ue,{value:O.proxyType,"onUpdate:value":[n[1]||(n[1]=k=>O.proxyType=k),B],options:r,placeholder:"请选择代理类型"},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"优先级",path:"configPriority"},{default:l(()=>[t(ie,{value:O.configPriority,"onUpdate:value":n[2]||(n[2]=k=>O.configPriority=k),placeholder:"请输入优先级",min:0,max:999,precision:0,clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"状态",path:"activeFlag"},{default:l(()=>[t(_e,{value:j.value,"onUpdate:value":n[3]||(n[3]=k=>j.value=k),"checked-value":!0,"unchecked-value":!1},{checked:l(()=>n[42]||(n[42]=[h("启用")])),unchecked:l(()=>n[43]||(n[43]=[h("禁用")])),_:1},8,["value"])]),_:1})]),_:1}),t($e,{label:"备注",path:"noteText",style:{"margin-top":"16px"}},{default:l(()=>[t(Ne,{value:O.noteText,"onUpdate:value":n[4]||(n[4]=k=>O.noteText=k),type:"textarea",placeholder:"请输入备注信息",autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1})]),a("div",_a,[t(se,{"title-placement":"left",class:"section-divider"},{default:l(()=>n[44]||(n[44]=[h("代理配置")])),_:1}),O.proxyType==="http"?(P(),V(ze,{key:0},[a("div",Ta,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[45]||(n[45]=[h("基本配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"HTTP版本",path:"proxyConfig.httpVersion"},{default:l(()=>[t(Ue,{value:_.httpVersion,"onUpdate:value":n[5]||(n[5]=k=>_.httpVersion=k),options:T,placeholder:"请选择HTTP版本",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"重试次数",path:"proxyConfig.retryCount"},{default:l(()=>[t(ie,{value:_.retryCount,"onUpdate:value":n[6]||(n[6]=k=>_.retryCount=k),placeholder:"请输入重试次数",min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t($e,{label:"最大空闲连接数",path:"proxyConfig.maxIdleConns",style:{"margin-top":"16px"}},{default:l(()=>[t(ie,{value:_.maxIdleConns,"onUpdate:value":n[7]||(n[7]=k=>_.maxIdleConns=k),placeholder:"请输入最大空闲连接数",min:0,style:{width:"300px"}},null,8,["value"])]),_:1})]),a("div",Sa,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[46]||(n[46]=[h("超时配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"超时时间（秒）",path:"proxyConfig.timeout"},{default:l(()=>[t(ie,{value:_.timeout,"onUpdate:value":n[8]||(n[8]=k=>_.timeout=k),placeholder:"请输入超时时间",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"发送超时（秒）",path:"proxyConfig.sendTimeout"},{default:l(()=>[t(ie,{value:_.sendTimeout,"onUpdate:value":n[9]||(n[9]=k=>_.sendTimeout=k),placeholder:"请输入发送超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"读取超时（秒）",path:"proxyConfig.readTimeout"},{default:l(()=>[t(ie,{value:_.readTimeout,"onUpdate:value":n[10]||(n[10]=k=>_.readTimeout=k),placeholder:"请输入读取超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"连接超时（秒）",path:"proxyConfig.connectTimeout"},{default:l(()=>[t(ie,{value:_.connectTimeout,"onUpdate:value":n[11]||(n[11]=k=>_.connectTimeout=k),placeholder:"请输入连接超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"空闲连接超时（秒）",path:"proxyConfig.idleConnTimeout"},{default:l(()=>[t(ie,{value:_.idleConnTimeout,"onUpdate:value":n[12]||(n[12]=k=>_.idleConnTimeout=k),placeholder:"请输入空闲连接超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"重试超时（秒）",path:"proxyConfig.retryTimeout"},{default:l(()=>[t(ie,{value:_.retryTimeout,"onUpdate:value":n[13]||(n[13]=k=>_.retryTimeout=k),placeholder:"请输入重试超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),a("div",wa,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[47]||(n[47]=[h("连接配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"跟随重定向",path:"proxyConfig.followRedirects"},{default:l(()=>[t(_e,{value:_.followRedirects,"onUpdate:value":n[14]||(n[14]=k=>_.followRedirects=k)},null,8,["value"])]),_:1}),t(W,{label:"保持连接",path:"proxyConfig.keepAlive"},{default:l(()=>[t(_e,{value:_.keepAlive,"onUpdate:value":n[15]||(n[15]=k=>_.keepAlive=k)},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"复制响应体",path:"proxyConfig.copyResponseBody"},{default:l(()=>[t(_e,{value:_.copyResponseBody,"onUpdate:value":n[16]||(n[16]=k=>_.copyResponseBody=k)},null,8,["value"])]),_:1}),t(W,{label:"代理缓冲",path:"proxyConfig.proxyBuffering"},{default:l(()=>[t(_e,{value:_.proxyBuffering,"onUpdate:value":n[17]||(n[17]=k=>_.proxyBuffering=k)},null,8,["value"])]),_:1})]),_:1})]),a("div",ka,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[48]||(n[48]=[h("响应处理配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"缓冲区大小（字节）",path:"proxyConfig.bufferSize"},{default:l(()=>[t(ie,{value:_.bufferSize,"onUpdate:value":n[18]||(n[18]=k=>_.bufferSize=k),placeholder:"请输入缓冲区大小",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"最大缓冲区大小（字节）",path:"proxyConfig.maxBufferSize"},{default:l(()=>[t(ie,{value:_.maxBufferSize,"onUpdate:value":n[19]||(n[19]=k=>_.maxBufferSize=k),placeholder:"请输入最大缓冲区大小",min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),a("div",Ia,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[49]||(n[49]=[h("头部配置")])),_:1}),t($e,{label:"设置头部",path:"proxyConfig.setHeaders"},{default:l(()=>[t(Pt,{value:K.value,"onUpdate:value":n[20]||(n[20]=k=>K.value=k),"on-create":F},{"create-button-default":l(()=>n[50]||(n[50]=[h(" 添加头部 ")])),default:l(({value:k,index:ft})=>[a("div",Na,[t(Ne,{value:k.key,"onUpdate:value":[Ee=>k.key=Ee,Ee=>U(ft,"key",Ee)],type:"text",placeholder:"头部名称",style:{flex:"1"}},null,8,["value","onUpdate:value"]),t(Ne,{value:k.value,"onUpdate:value":[Ee=>k.value=Ee,Ee=>U(ft,"value",Ee)],type:"text",placeholder:"头部值",style:{flex:"1"}},null,8,["value","onUpdate:value"])])]),_:1},8,["value"])]),_:1}),t($e,{label:"允许传递的头部",path:"proxyConfig.passHeaders",style:{"margin-top":"20px"}},{default:l(()=>[t(ct,{value:_.passHeaders,"onUpdate:value":n[21]||(n[21]=k=>_.passHeaders=k)},null,8,["value"])]),_:1}),t($e,{label:"隐藏的头部",path:"proxyConfig.hideHeaders",style:{"margin-top":"20px"}},{default:l(()=>[t(ct,{value:_.hideHeaders,"onUpdate:value":n[22]||(n[22]=k=>_.hideHeaders=k)},null,8,["value"])]),_:1})]),a("div",Pa,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[51]||(n[51]=[h("高级选项")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"保留原始Host",path:"proxyConfig.preserveHost"},{default:l(()=>[t(_e,{value:_.preserveHost,"onUpdate:value":n[23]||(n[23]=k=>_.preserveHost=k)},null,8,["value"])]),_:1}),t(W,{label:"添加X-Forwarded-For",path:"proxyConfig.addXForwardedFor"},{default:l(()=>[t(_e,{value:_.addXForwardedFor,"onUpdate:value":n[24]||(n[24]=k=>_.addXForwardedFor=k)},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"添加X-Real-IP",path:"proxyConfig.addXRealIP"},{default:l(()=>[t(_e,{value:_.addXRealIP,"onUpdate:value":n[25]||(n[25]=k=>_.addXRealIP=k)},null,8,["value"])]),_:1}),t(W,{label:"添加X-Forwarded-Proto",path:"proxyConfig.addXForwardedProto"},{default:l(()=>[t(_e,{value:_.addXForwardedProto,"onUpdate:value":n[26]||(n[26]=k=>_.addXForwardedProto=k)},null,8,["value"])]),_:1})]),_:1})]),a("div",Oa,[t(se,{"title-placement":"left",class:"group-divider"},{default:l(()=>n[52]||(n[52]=[h("TLS配置")])),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"最小TLS版本",path:"proxyConfig.tlsMinVersion"},{default:l(()=>[t(Ue,{value:_.tlsMinVersion,"onUpdate:value":n[27]||(n[27]=k=>_.tlsMinVersion=k),options:m,placeholder:"请选择最小TLS版本",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"最大TLS版本",path:"proxyConfig.tlsMaxVersion"},{default:l(()=>[t(Ue,{value:_.tlsMaxVersion,"onUpdate:value":n[28]||(n[28]=k=>_.tlsMaxVersion=k),options:m,placeholder:"请选择最大TLS版本",clearable:""},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"TLS服务器名称",path:"proxyConfig.tlsServerName"},{default:l(()=>[t(Ne,{value:_.tlsServerName,"onUpdate:value":n[29]||(n[29]=k=>_.tlsServerName=k),placeholder:"请输入TLS服务器名称（可选）",clearable:""},null,8,["value"])]),_:1}),t(W,{label:"跳过TLS证书验证",path:"proxyConfig.tlsInsecureSkipVerify"},{default:l(()=>[t(_e,{value:_.tlsInsecureSkipVerify,"onUpdate:value":n[30]||(n[30]=k=>_.tlsInsecureSkipVerify=k)},null,8,["value"])]),_:1})]),_:1})])],64)):ee("",!0),O.proxyType==="websocket"?(P(),V("div",za,[t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"Ping间隔（秒）",path:"proxyConfig.pingInterval"},{default:l(()=>[t(ie,{value:H.pingInterval,"onUpdate:value":n[31]||(n[31]=k=>H.pingInterval=k),placeholder:"请输入Ping间隔",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"Pong超时（秒）",path:"proxyConfig.pongTimeout"},{default:l(()=>[t(ie,{value:H.pongTimeout,"onUpdate:value":n[32]||(n[32]=k=>H.pongTimeout=k),placeholder:"请输入Pong超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(re,{cols:2,"x-gap":32,"y-gap":16,style:{"margin-top":"16px"}},{default:l(()=>[t(W,{label:"最大消息大小（字节）",path:"proxyConfig.maxMessageSize"},{default:l(()=>[t(ie,{value:H.maxMessageSize,"onUpdate:value":n[33]||(n[33]=k=>H.maxMessageSize=k),placeholder:"请输入最大消息大小",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"启用压缩",path:"proxyConfig.enableCompression"},{default:l(()=>[t(_e,{value:H.enableCompression,"onUpdate:value":n[34]||(n[34]=k=>H.enableCompression=k)},null,8,["value"])]),_:1})]),_:1})])):ee("",!0),O.proxyType==="tcp"?(P(),V("div",Da,[t(re,{cols:2,"x-gap":32,"y-gap":16},{default:l(()=>[t(W,{label:"连接超时（秒）",path:"proxyConfig.connectTimeout"},{default:l(()=>[t(ie,{value:M.connectTimeout,"onUpdate:value":n[35]||(n[35]=k=>M.connectTimeout=k),placeholder:"请输入连接超时",min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(W,{label:"保持连接",path:"proxyConfig.keepAlive"},{default:l(()=>[t(_e,{value:M.keepAlive,"onUpdate:value":n[36]||(n[36]=k=>M.keepAlive=k)},null,8,["value"])]),_:1})]),_:1})])):ee("",!0),O.proxyType==="udp"?(P(),V("div",Ua,[t($e,{label:"缓冲区大小（字节）",path:"proxyConfig.bufferSize"},{default:l(()=>[t(ie,{value:R.bufferSize,"onUpdate:value":n[37]||(n[37]=k=>R.bufferSize=k),placeholder:"请输入缓冲区大小",min:1,style:{width:"300px"}},null,8,["value"])]),_:1})])):ee("",!0)]),a("div",$a,[t(se,{"title-placement":"left",class:"section-divider"},{default:l(()=>n[53]||(n[53]=[h("自定义配置")])),_:1}),t($e,{label:"自定义配置",path:"customConfig"},{default:l(()=>[t(Ne,{value:S.value,"onUpdate:value":n[38]||(n[38]=k=>S.value=k),type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"{}"},null,8,["value"]),t(pt,{style:{"margin-top":"12px"}},{default:l(()=>[t(te,{text:"",onClick:g},{icon:l(()=>[t(q,null,{default:l(()=>[t(e(pl))]),_:1})]),default:l(()=>[n[54]||(n[54]=h(" 格式化JSON "))]),_:1}),t(te,{text:"",onClick:s},{icon:l(()=>[t(q,null,{default:l(()=>[t(e(dl))]),_:1})]),default:l(()=>[n[55]||(n[55]=h(" 验证JSON "))]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ha=me(Ra,[["__scopeId","data-v-fd24c4d5"]]),Fa={class:"single-proxy-config"},Ma={class:"proxy-content"},Aa={key:4,class:"proxy-custom-config"},Ya=de({__name:"SingleProxyConfig",props:{gatewayInstanceId:{}},emits:["refresh","proxyTypeChanged","proxyConfigChanged"],setup(v,{emit:y}){const p=v,i=y,C=xe(),b=z(!1),f=z(null),u=z(!1),r=z("add"),T=z({});function m(M){if(!M)return"{}";try{const R=typeof M=="string"?JSON.parse(M):M;return JSON.stringify(R,null,2)}catch{return typeof M=="string"?M:"{}"}}async function O(){var M;if(p.gatewayInstanceId)try{b.value=!0;const R=await It({gatewayInstanceId:p.gatewayInstanceId,pageIndex:1,pageSize:1});if(R.oK&&R.state)try{const j=JSON.parse(R.bizData||"[]");f.value=j.length>0?j[0]:null,i("proxyTypeChanged",((M=f.value)==null?void 0:M.proxyType)||null),i("proxyConfigChanged",f.value)}catch{C.error("解析代理配置数据失败"),f.value=null,i("proxyTypeChanged",null),i("proxyConfigChanged",null)}else f.value=null,i("proxyTypeChanged",null),i("proxyConfigChanged",null),C.warning("未找到代理配置")}catch{C.error("加载代理配置失败"),f.value=null,i("proxyTypeChanged",null),i("proxyConfigChanged",null)}finally{b.value=!1}}function _(){r.value="add",T.value={gatewayInstanceId:p.gatewayInstanceId,proxyName:"",proxyType:"http",configPriority:0,proxyConfig:{},activeFlag:"Y"},u.value=!0}function K(M){r.value="edit",T.value={...M},u.value=!0}async function Y(M){try{b.value=!0;const R=await sa(M,"default");R.oK&&R.state?(C.success("删除成功"),f.value=null,i("proxyConfigChanged",null),i("refresh")):C.error(R.errMsg||"删除失败")}catch{C.error("删除失败")}finally{b.value=!1}}async function H(M){try{b.value=!0;const R=M.activeFlag==="Y"?"N":"Y",j=await Nt({tenantId:"default",proxyConfigId:M.proxyConfigId,gatewayInstanceId:p.gatewayInstanceId,activeFlag:R});j.oK&&j.state?(C.success(`${R==="Y"?"启用":"禁用"}成功`),await O(),i("refresh")):C.error(j.errMsg||"操作失败")}catch{C.error("状态切换失败")}finally{b.value=!1}}return Ge(()=>{O()}),(M,R)=>(P(),V("div",Fa,[t(e(rt),{show:b.value},{default:l(()=>[f.value?(P(),Z(e(pe),{key:1,class:"proxy-detail-card"},{header:l(()=>[t(Tl,{"proxy-config":f.value,onEdit:K,onDelete:Y,onToggleStatus:H},null,8,["proxy-config"])]),default:l(()=>[a("div",Ma,[t(Nl,{"proxy-config":f.value},null,8,["proxy-config"]),f.value.proxyType==="http"?(P(),Z(Kl,{key:0,"proxy-config":f.value.proxyConfig},null,8,["proxy-config"])):f.value.proxyType==="websocket"?(P(),Z(Xl,{key:1,"proxy-config":f.value.proxyConfig},null,8,["proxy-config"])):f.value.proxyType==="tcp"?(P(),Z(Zl,{key:2,"proxy-config":f.value.proxyConfig},null,8,["proxy-config"])):f.value.proxyType==="udp"?(P(),Z(la,{key:3,"proxy-config":f.value.proxyConfig},null,8,["proxy-config"])):ee("",!0),f.value.customConfig?(P(),V("div",Aa,[t(e(he),{"title-placement":"left"},{default:l(()=>R[2]||(R[2]=[h("自定义配置")])),_:1}),t(e(tl),null,{default:l(()=>[t(e(ll),{title:"查看自定义配置",name:"1"},{default:l(()=>[t(e(ue),{type:"textarea",value:m(f.value.customConfig),autosize:{minRows:3,maxRows:10},readonly:"",class:"code-input"},null,8,["value"])]),_:1})]),_:1})])):ee("",!0)])]),_:1})):(P(),Z(e(pe),{key:0,class:"empty-proxy-card"},{default:l(()=>[t(e(Qe),{description:"当前网关实例尚未配置代理"},{icon:l(()=>[t(e(N),{size:"60",color:"#d0d0d0"},{default:l(()=>[t(e(_t))]),_:1})]),extra:l(()=>[t(e(E),{type:"primary",onClick:_},{icon:l(()=>[t(e(N),{component:e(dt)},null,8,["component"])]),default:l(()=>[R[1]||(R[1]=h(" 创建代理配置 "))]),_:1})]),_:1})]),_:1}))]),_:1},8,["show"]),t(Ha,{show:u.value,"onUpdate:show":R[0]||(R[0]=j=>u.value=j),"form-data":T.value,mode:r.value,onRefresh:O},null,8,["show","form-data","mode"])]))}}),Ba=me(Ya,[["__scopeId","data-v-a42740b5"]]),La={class:"modal-header"},Va={class:"service-search-section"},Ja={class:"search-form"},qa={class:"search-row"},Ka={class:"search-actions"},ja={key:0,class:"selected-service-section"},Wa={class:"selected-service-card"},Xa={class:"service-info"},Ga={class:"service-name"},Qa={class:"service-meta"},Za={class:"service-path"},eo={class:"services-list-section"},to={class:"section-header"},lo={key:0,class:"section-info"},ao={class:"service-cards-container"},oo=["onClick"],no={class:"card-header"},so={class:"card-title-row"},ro={class:"service-name"},io={class:"service-status"},uo={class:"card-content"},co={class:"service-info-grid"},po={class:"info-item"},fo={class:"info-item"},vo={class:"info-item"},go={class:"info-value"},yo={class:"info-item"},mo={class:"info-value"},ho={key:0,class:"pagination-wrapper"},bo=de({__name:"ServiceRegistrySelector",props:{show:{type:Boolean},currentService:{}},emits:["update:show","select"],setup(v,{emit:y}){const p=v,i=y,C=xe(),b=z(!1),f=z([]),u=z(null),r=z(""),T=z(""),{pagination:m,queryParams:O,naiveConfig:_,updatePagination:K,resetPagination:Y,setTotal:H}=ol({initialPageSize:10,pageSizes:[10,20,50],showSizePicker:!0,showQuickJumper:!0,onPageChange:(J,D)=>{R({pageIndex:J,pageSize:D})},onPageSizeChange:(J,D)=>{R({pageIndex:J,pageSize:D})}}),M=Q({get:()=>p.show,set:J=>i("update:show",J)});le(()=>p.show,J=>{J?(u.value=p.currentService||null,Y(),R()):(u.value=null,r.value="",T.value="",Y())});async function R(J={}){try{b.value=!0;const D={tenantId:"default",...O.value,...J},B=await ya(D);if(Rt(B)){const X=Ht(B,[]);f.value=Array.isArray(X)?X:[];let F=0;try{const U=Ft(B);F=U.totalCount||0,U.pageIndex&&U.pageSize?K(U):H(F)}catch(U){console.warn("解析分页信息失败，使用当前数据长度作为总数:",U),F=(X==null?void 0:X.length)||0,H(F)}console.log("获取服务列表成功:",f.value.length,"总数:",F)}else{const X=Mt(B,"获取服务列表失败");C.error(X),f.value=[],H(0)}}catch(D){console.error("获取服务列表失败:",D),C.error("获取服务列表失败: "+((D==null?void 0:D.message)||"未知错误")),f.value=[],H(0)}finally{b.value=!1}}function j(){const J={};r.value&&(J.serviceName=r.value),T.value&&(J.groupName=T.value),Y(),R({...J,pageIndex:1})}function S(){r.value="",T.value="",Y(),R()}function x(J){u.value=J,console.log("选择服务:",J.serviceName)}function $(){u.value=null}function ae(){if(!u.value){C.warning("请选择一个服务");return}i("select",u.value),C.success(`已选择服务：${u.value.serviceName}`),oe()}function oe(){i("update:show",!1)}return(J,D)=>(P(),Z(e(qe),{show:M.value,"onUpdate:show":D[3]||(D[3]=B=>M.value=B),"mask-closable":!1,"transform-origin":"center"},{default:l(()=>[t(e(pe),{style:{width:"1200px","max-width":"90vw"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",La,[t(e(N),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(Ae))]),_:1}),D[4]||(D[4]=a("div",{class:"header-content"},[a("h3",{class:"modal-title"},"选择注册服务"),a("p",{class:"modal-subtitle"},"从服务注册中心选择需要的服务")],-1))])]),"header-extra":l(()=>[t(e(E),{quaternary:"",circle:"",onClick:oe,class:"close-btn"},{icon:l(()=>[t(e(N),{size:"18"},{default:l(()=>[t(e(Je))]),_:1})]),_:1})]),action:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{onClick:oe},{default:l(()=>D[14]||(D[14]=[h("取消")])),_:1}),t(e(E),{type:"primary",onClick:ae,disabled:!u.value},{default:l(()=>D[15]||(D[15]=[h(" 确认选择 ")])),_:1},8,["disabled"])]),_:1})]),default:l(()=>[a("div",Va,[a("div",Ja,[a("div",qa,[t(e(ue),{value:r.value,"onUpdate:value":D[0]||(D[0]=B=>r.value=B),placeholder:"搜索服务名称",clearable:"",onClear:j,onKeyup:ot(j,["enter"]),style:{width:"240px"}},{prefix:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ae))]),_:1})]),_:1},8,["value"]),t(e(ue),{value:T.value,"onUpdate:value":D[1]||(D[1]=B=>T.value=B),placeholder:"搜索分组名称",clearable:"",onClear:j,onKeyup:ot(j,["enter"]),style:{width:"240px"}},{prefix:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ae))]),_:1})]),_:1},8,["value"]),a("div",Ka,[t(e(E),{onClick:j,type:"primary"},{default:l(()=>D[5]||(D[5]=[h(" 搜索 ")])),_:1}),t(e(E),{onClick:S},{default:l(()=>D[6]||(D[6]=[h(" 重置 ")])),_:1})])])])]),u.value?(P(),V("div",ja,[D[8]||(D[8]=a("div",{class:"section-title"},"当前选择的服务",-1)),a("div",Wa,[a("div",Xa,[a("div",Ga,w(u.value.serviceName),1),a("div",Qa,[t(e(L),{type:"info",size:"small"},{default:l(()=>[h(w(u.value.groupName),1)]),_:1}),t(e(L),{type:"success",size:"small"},{default:l(()=>[h(w(u.value.protocolType),1)]),_:1}),a("span",Za,w(u.value.contextPath),1)])]),t(e(E),{text:"",type:"error",onClick:$},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Je))]),_:1})]),default:l(()=>[D[7]||(D[7]=h(" 取消选择 "))]),_:1})])])):ee("",!0),a("div",eo,[a("div",to,[D[9]||(D[9]=a("div",{class:"section-title"},"可选择的服务",-1)),e(m).total>0?(P(),V("div",lo," 共 "+w(e(m).total)+" 个服务 ",1)):ee("",!0)]),t(e(rt),{show:b.value},{default:l(()=>[f.value.length>0?(P(),V(ze,{key:0},[a("div",ao,[(P(!0),V(ze,null,je(f.value,B=>{var X,F;return P(),V("div",{key:B.serviceName,class:At(["service-card",{selected:((X=u.value)==null?void 0:X.serviceName)===B.serviceName}]),onClick:U=>x(B)},[a("div",no,[a("div",so,[t(e(Qt),{checked:((F=u.value)==null?void 0:F.serviceName)===B.serviceName,onClick:D[2]||(D[2]=Yt(()=>{},["stop"])),class:"card-radio"},null,8,["checked"]),a("div",ro,w(B.serviceName),1),a("div",io,[t(e(L),{type:B.activeFlag==="Y"?"success":"error",size:"small",round:""},{default:l(()=>[h(w(B.activeFlag==="Y"?"启用":"禁用"),1)]),_:2},1032,["type"])])])]),a("div",uo,[a("div",co,[a("div",po,[D[10]||(D[10]=a("span",{class:"info-label"},"分组",-1)),t(e(L),{type:"info",size:"small"},{default:l(()=>[h(w(B.groupName||"DEFAULT"),1)]),_:2},1024)]),a("div",fo,[D[11]||(D[11]=a("span",{class:"info-label"},"协议",-1)),t(e(L),{type:"primary",size:"small"},{default:l(()=>[h(w(B.protocolType),1)]),_:2},1024)]),a("div",vo,[D[12]||(D[12]=a("span",{class:"info-label"},"路径",-1)),a("span",go,w(B.contextPath||"/"),1)]),a("div",yo,[D[13]||(D[13]=a("span",{class:"info-label"},"实例数",-1)),a("span",mo,w(B.instances?B.instances.length:"0"),1)])])])],10,oo)}),128))]),e(m).total>e(_).pageSize?(P(),V("div",ho,[t(e(Wt),Bt(Lt(e(_))),null,16)])):ee("",!0)],64)):b.value?ee("",!0):(P(),Z(e(Qe),{key:1,description:"暂无可用的注册服务",style:{padding:"40px 0"}}))]),_:1},8,["show"])])]),_:1})]),_:1},8,["show"]))}}),xo=me(bo,[["__scopeId","data-v-16cc784a"]]),Co={class:"modal-header"},_o={class:"header-content"},To={class:"modal-title"},So={class:"discovery-config-section"},wo={key:0,class:"service-selection-empty"},ko={key:1,class:"selected-service-card"},Io={class:"service-header"},No={class:"service-title"},Po={class:"service-name"},Oo={class:"service-details"},zo={class:"detail-row"},Do={class:"detail-item"},Uo={class:"detail-item"},$o={class:"detail-row"},Eo={class:"detail-item"},Ro={class:"detail-item"},Ho={key:0,class:"detail-row"},Fo={class:"detail-item"},Mo={class:"detail-item"},Ao={class:"ml-2"},Yo=de({__name:"ServiceDefinitionDialog",props:{show:{type:Boolean},formData:{},serviceDefinitionId:{},mode:{},proxyConfigId:{}},emits:["update:show","refresh"],setup(v,{emit:y}){const p=v,i=y,C=xe(),b=z(null),f=z(!1),u=z(!1),r=z(null),T=z(!1);Q(()=>m.serviceType===ge.DISCOVERY);const m=ye({proxyConfigId:p.proxyConfigId,serviceName:"",serviceDesc:"",serviceType:ge.STATIC,loadBalanceStrategy:ne.ROUND_ROBIN,sessionAffinity:"N",stickySession:"N",maxRetries:3,retryTimeoutMs:5e3,enableCircuitBreaker:"N",healthCheckEnabled:"Y",healthCheckPath:"/health",healthCheckMethod:"GET",healthCheckIntervalSeconds:30,healthCheckTimeoutMs:5e3,healthyThreshold:2,unhealthyThreshold:3,expectedStatusCodes:"200",activeFlag:"Y",noteText:""}),O=Q({get:()=>p.show,set:c=>i("update:show",c)}),_=Q({get:()=>m.sessionAffinity==="Y",set:c=>{m.sessionAffinity=c?"Y":"N"}}),K=Q({get:()=>m.stickySession==="Y",set:c=>{m.stickySession=c?"Y":"N"}}),Y=Q({get:()=>m.enableCircuitBreaker==="Y",set:c=>{m.enableCircuitBreaker=c?"Y":"N"}}),H=Q({get:()=>m.healthCheckEnabled==="Y",set:c=>{m.healthCheckEnabled=c?"Y":"N"}}),M=Q({get:()=>m.activeFlag==="Y",set:c=>{m.activeFlag=c?"Y":"N"}});Q({get:()=>m.discoveryConfig&&typeof m.discoveryConfig=="object"?JSON.stringify(m.discoveryConfig,null,2):m.discoveryConfig||"",set:c=>{try{m.discoveryConfig=c?JSON.parse(c):void 0}catch{m.discoveryConfig=c}}});const R=[{label:"静态配置",value:ge.STATIC},{label:"服务发现",value:ge.DISCOVERY}],j=[{label:"轮询算法",value:ne.ROUND_ROBIN},{label:"随机算法",value:ne.RANDOM},{label:"IP哈希算法",value:ne.IP_HASH},{label:"最少连接算法",value:ne.LEAST_CONN},{label:"加权轮询算法",value:ne.WEIGHTED_ROUND_ROBIN},{label:"一致性哈希算法",value:ne.CONSISTENT_HASH}],S=[{label:"Consul",value:Re.CONSUL},{label:"Eureka",value:Re.EUREKA},{label:"Nacos",value:Re.NACOS},{label:"服务注册",value:Re.REGISTRY}],x=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"HEAD",value:"HEAD"}],$={serviceName:[{required:!0,message:"请输入服务名称",trigger:["blur","input"]},{min:2,max:50,message:"服务名称长度在2-50个字符",trigger:["blur","input"]}],serviceType:[{required:!0,message:"请选择服务类型",trigger:["blur","change"],validator:(c,o)=>o==null||o===""?new Error("请选择服务类型"):typeof o=="number"&&(o===0||o===1)?!0:new Error("请选择有效的服务类型")}],loadBalanceStrategy:[{required:!0,message:"请选择负载均衡策略",trigger:["blur","change"],validator:(c,o)=>o==null||o===""?new Error("请选择负载均衡策略"):!0}],maxRetries:[{required:!0,message:"请输入最大重试次数",trigger:["blur","change"],validator:(c,o)=>{if(o==null||o==="")return new Error("请输入最大重试次数");const s=Number(o);return isNaN(s)?new Error("重试次数必须是数字"):s<0||s>10?new Error("重试次数必须在0-10之间"):!0}}],retryTimeoutMs:[{required:!0,message:"请输入重试超时时间",trigger:["blur","change"],validator:(c,o)=>{if(o==null||o==="")return new Error("请输入重试超时时间");const s=Number(o);return isNaN(s)?new Error("超时时间必须是数字"):s<100||s>6e4?new Error("超时时间必须在100-60000毫秒之间"):!0}}]};le(()=>p.formData,c=>{c&&p.mode==="add"&&Object.assign(m,c)},{immediate:!0,deep:!0}),le(()=>p.show,c=>{c&&(p.mode==="add"?p.formData||ae():p.mode==="edit"&&p.serviceDefinitionId&&oe())}),le(()=>p.proxyConfigId,c=>{c&&(m.proxyConfigId=c)});function ae(){Object.assign(m,{proxyConfigId:p.proxyConfigId,serviceName:"",serviceDesc:"",serviceType:ge.STATIC,loadBalanceStrategy:ne.ROUND_ROBIN,discoveryType:Re.REGISTRY,sessionAffinity:"N",stickySession:"N",maxRetries:3,retryTimeoutMs:5e3,enableCircuitBreaker:"N",healthCheckEnabled:"Y",healthCheckPath:"/health",healthCheckMethod:"GET",healthCheckIntervalSeconds:30,healthCheckTimeoutMs:5e3,healthyThreshold:2,unhealthyThreshold:3,expectedStatusCodes:"200",activeFlag:"Y",noteText:"",serviceMetadata:void 0}),r.value=null}async function oe(){if(!p.serviceDefinitionId){console.warn("编辑模式下缺少服务定义ID");return}try{u.value=!0;const c=await ua(p.serviceDefinitionId,"default");if(c.oK){const o=JSON.parse(c.bizData);if(Object.assign(m,{serviceDefinitionId:o.serviceDefinitionId,proxyConfigId:o.proxyConfigId,serviceName:o.serviceName,serviceDesc:o.serviceDesc,serviceType:o.serviceType,loadBalanceStrategy:o.loadBalanceStrategy,discoveryType:o.discoveryType,sessionAffinity:o.sessionAffinity||"N",stickySession:o.stickySession||"N",maxRetries:o.maxRetries||3,retryTimeoutMs:o.retryTimeoutMs||5e3,enableCircuitBreaker:o.enableCircuitBreaker||"N",healthCheckEnabled:o.healthCheckEnabled||"Y",healthCheckPath:o.healthCheckPath||"/health",healthCheckMethod:o.healthCheckMethod||"GET",healthCheckIntervalSeconds:o.healthCheckIntervalSeconds||30,healthCheckTimeoutMs:o.healthCheckTimeoutMs||5e3,healthyThreshold:o.healthyThreshold||2,unhealthyThreshold:o.unhealthyThreshold||3,expectedStatusCodes:o.expectedStatusCodes||"200",activeFlag:o.activeFlag,noteText:o.noteText,serviceMetadata:o.serviceMetadata}),o.serviceMetadata&&typeof o.serviceMetadata=="string")try{const s=JSON.parse(o.serviceMetadata);s.serviceName&&(r.value=s,console.log("从元数据还原选中服务:",r.value))}catch(s){console.warn("解析服务元数据失败:",s)}console.log("成功获取服务定义数据:",o.serviceName)}else C.error("获取服务定义数据失败: "+(c.messageId||"未知错误"))}catch(c){console.error("获取服务定义数据失败:",c),C.error("获取服务定义数据失败: "+((c==null?void 0:c.message)||"未知错误"))}finally{u.value=!1}}function J(c){r.value=c,D(),console.log("已选择服务:",c.serviceName)}function D(){if(r.value){const c={serviceName:r.value.serviceName,serviceGroupId:r.value.serviceGroupId,groupName:r.value.groupName,protocolType:r.value.protocolType,contextPath:r.value.contextPath,loadBalanceStrategy:r.value.loadBalanceStrategy,healthCheckUrl:r.value.healthCheckUrl,instances:r.value.instances||[]};m.serviceMetadata=JSON.stringify(c),console.log("已更新服务元数据:",c)}else m.serviceMetadata=void 0}le(()=>m.serviceType,c=>{c===ge.DISCOVERY&&(m.discoveryType=Re.REGISTRY)});function B(){T.value=!0,console.log("打开服务选择弹窗")}function X(c){return{ROUND_ROBIN:"轮询算法",RANDOM:"随机算法",IP_HASH:"IP哈希算法",LEAST_CONN:"最少连接算法",LEAST_CONNECTIONS:"最少连接算法",WEIGHTED_ROUND_ROBIN:"加权轮询算法",CONSISTENT_HASH:"一致性哈希算法"}[c]||c}function F(){i("update:show",!1)}async function U(){var c;try{await((c=b.value)==null?void 0:c.validate()),f.value=!0;const o="default",s=p.mode==="add"?await da({...m,tenantId:o}):await nt({...m,tenantId:o,serviceDefinitionId:m.serviceDefinitionId});s.oK?(C.success(p.mode==="add"?"创建成功":"保存成功"),i("refresh"),F()):C.error(s.messageId||"操作失败")}catch(o){o&&typeof o=="object"&&Array.isArray(o)?C.error("请检查表单填写是否正确"):C.error("操作失败: "+((o==null?void 0:o.message)||"未知错误"))}finally{f.value=!1}}return(c,o)=>{const s=L;return P(),V(ze,null,[t(e(qe),{show:O.value,"onUpdate:show":o[20]||(o[20]=g=>O.value=g),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(e(pe),{style:{width:"1000px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",Co,[t(e(N),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(xt))]),_:1}),a("div",_o,[a("h3",To,w(c.mode==="add"?"新建服务定义":"编辑服务定义"),1),o[22]||(o[22]=a("p",{class:"modal-subtitle"},"配置后端服务的负载均衡、健康检查等参数",-1))])])]),"header-extra":l(()=>[t(e(E),{quaternary:"",circle:"",onClick:F,class:"close-btn"},{icon:l(()=>[t(e(N),{size:"18"},{default:l(()=>[t(e(Je))]),_:1})]),_:1})]),action:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{onClick:F},{default:l(()=>o[34]||(o[34]=[h("取消")])),_:1}),t(e(E),{type:"primary",loading:f.value,onClick:U},{default:l(()=>[h(w(c.mode==="add"?"创建":"保存"),1)]),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(e(rt),{show:u.value},{default:l(()=>[t(e(Be),{ref_key:"formRef",ref:b,model:m,rules:$,"label-placement":"left","label-width":"140px"},{default:l(()=>[t(e(it),{type:"line",animated:""},{default:l(()=>[t(e(Te),{name:"basic",tab:"基本信息"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(A),{label:"服务名称",path:"serviceName"},{default:l(()=>[t(e(ue),{value:m.serviceName,"onUpdate:value":o[0]||(o[0]=g=>m.serviceName=g),placeholder:"请输入服务名称"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"服务类型",path:"serviceType"},{default:l(()=>[t(e(ve),{value:m.serviceType,"onUpdate:value":o[1]||(o[1]=g=>m.serviceType=g),options:R,placeholder:"请选择服务类型"},null,8,["value"])]),_:1})]),_:1}),t(e(G),{span:2},{default:l(()=>[t(e(A),{label:"服务描述",path:"serviceDesc"},{default:l(()=>[t(e(ue),{value:m.serviceDesc,"onUpdate:value":o[2]||(o[2]=g=>m.serviceDesc=g),type:"textarea",rows:3,placeholder:"请输入服务描述"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),m.serviceType===e(ge).STATIC?(P(),Z(e(Te),{key:0,name:"loadbalance",tab:"负载均衡"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(A),{label:"负载均衡策略",path:"loadBalanceStrategy"},{default:l(()=>[t(e(ve),{value:m.loadBalanceStrategy,"onUpdate:value":o[3]||(o[3]=g=>m.loadBalanceStrategy=g),options:j,placeholder:"请选择负载均衡策略"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"会话亲和性"},{default:l(()=>[t(e(Pe),{value:_.value,"onUpdate:value":o[4]||(o[4]=g=>_.value=g)},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"粘性会话"},{default:l(()=>[t(e(Pe),{value:K.value,"onUpdate:value":o[5]||(o[5]=g=>K.value=g)},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"最大重试次数",path:"maxRetries"},{default:l(()=>[t(e(ke),{value:m.maxRetries,"onUpdate:value":o[6]||(o[6]=g=>m.maxRetries=g),min:0,max:10},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"重试超时时间(ms)",path:"retryTimeoutMs"},{default:l(()=>[t(e(ke),{value:m.retryTimeoutMs,"onUpdate:value":o[7]||(o[7]=g=>m.retryTimeoutMs=g),min:100,max:6e4},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"启用熔断器"},{default:l(()=>[t(e(Pe),{value:Y.value,"onUpdate:value":o[8]||(o[8]=g=>Y.value=g)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):ee("",!0),m.serviceType===e(ge).STATIC?(P(),Z(e(Te),{key:1,name:"health",tab:"健康检查"},{default:l(()=>[t(e(A),{label:"启用健康检查"},{default:l(()=>[t(e(Pe),{value:H.value,"onUpdate:value":o[9]||(o[9]=g=>H.value=g)},null,8,["value"])]),_:1}),H.value?(P(),Z(e(De),{key:0,cols:2,"x-gap":24},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(A),{label:"检查路径",path:"healthCheckPath"},{default:l(()=>[t(e(ue),{value:m.healthCheckPath,"onUpdate:value":o[10]||(o[10]=g=>m.healthCheckPath=g),placeholder:"/health"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"检查方法",path:"healthCheckMethod"},{default:l(()=>[t(e(ve),{value:m.healthCheckMethod,"onUpdate:value":o[11]||(o[11]=g=>m.healthCheckMethod=g),options:x},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"检查间隔(秒)",path:"healthCheckIntervalSeconds"},{default:l(()=>[t(e(ke),{value:m.healthCheckIntervalSeconds,"onUpdate:value":o[12]||(o[12]=g=>m.healthCheckIntervalSeconds=g),min:1,max:300},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"检查超时(ms)",path:"healthCheckTimeoutMs"},{default:l(()=>[t(e(ke),{value:m.healthCheckTimeoutMs,"onUpdate:value":o[13]||(o[13]=g=>m.healthCheckTimeoutMs=g),min:100,max:3e4},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"健康阈值",path:"healthyThreshold"},{default:l(()=>[t(e(ke),{value:m.healthyThreshold,"onUpdate:value":o[14]||(o[14]=g=>m.healthyThreshold=g),min:1,max:10},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"不健康阈值",path:"unhealthyThreshold"},{default:l(()=>[t(e(ke),{value:m.unhealthyThreshold,"onUpdate:value":o[15]||(o[15]=g=>m.unhealthyThreshold=g),min:1,max:10},null,8,["value"])]),_:1})]),_:1}),t(e(G),{span:2},{default:l(()=>[t(e(A),{label:"期望状态码",path:"expectedStatusCodes"},{default:l(()=>[t(e(ue),{value:m.expectedStatusCodes,"onUpdate:value":o[16]||(o[16]=g=>m.expectedStatusCodes=g),placeholder:"200,201,204"},null,8,["value"])]),_:1})]),_:1})]),_:1})):ee("",!0)]),_:1})):ee("",!0),m.serviceType===e(ge).DISCOVERY?(P(),Z(e(Te),{key:2,name:"discovery",tab:"服务发现"},{default:l(()=>[a("div",So,[t(e(A),{label:"发现类型"},{default:l(()=>[t(e(ve),{value:m.discoveryType,"onUpdate:value":o[17]||(o[17]=g=>m.discoveryType=g),options:S,disabled:""},null,8,["value"]),o[23]||(o[23]=a("div",{class:"discovery-type-hint"}," 服务发现模式下默认使用服务注册方式 ",-1))]),_:1}),t(e(A),{label:"注册服务"},{default:l(()=>[r.value?(P(),V("div",ko,[a("div",Io,[a("div",No,[t(e(N),{size:"20",class:"service-icon"},{default:l(()=>[t(e(He))]),_:1}),a("span",Po,w(r.value.serviceName),1),t(s,{size:"small",type:"success"},{default:l(()=>o[26]||(o[26]=[h("已选择")])),_:1})]),t(e(E),{quaternary:"",type:"primary",size:"small",onClick:B},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(el))]),_:1})]),default:l(()=>[o[27]||(o[27]=h(" 重新选择 "))]),_:1})]),a("div",Oo,[a("div",zo,[a("div",Do,[o[28]||(o[28]=a("span",{class:"detail-label"},"服务分组：",-1)),t(s,{size:"small",type:"info"},{default:l(()=>[h(w(r.value.groupName),1)]),_:1})]),a("div",Uo,[o[29]||(o[29]=a("span",{class:"detail-label"},"通信协议：",-1)),t(s,{size:"small",type:r.value.protocolType==="HTTPS"?"success":"default"},{default:l(()=>[h(w(r.value.protocolType),1)]),_:1},8,["type"])])]),a("div",$o,[a("div",Eo,[o[30]||(o[30]=a("span",{class:"detail-label"},"上下文路径：",-1)),t(e(vt),{code:""},{default:l(()=>[h(w(r.value.contextPath||"/"),1)]),_:1})]),a("div",Ro,[o[31]||(o[31]=a("span",{class:"detail-label"},"负载均衡：",-1)),t(e(vt),{depth:"2"},{default:l(()=>[h(w(X(r.value.loadBalanceStrategy)),1)]),_:1})])]),r.value.instances&&r.value.instances.length>0?(P(),V("div",Ho,[a("div",Fo,[o[32]||(o[32]=a("span",{class:"detail-label"},"服务实例：",-1)),t(s,{size:"small",type:"warning"},{default:l(()=>[h(w(r.value.instances.length)+" 个实例 ",1)]),_:1})]),a("div",Mo,[o[33]||(o[33]=a("span",{class:"detail-label"},"服务状态：",-1)),t(s,{size:"small",type:r.value.activeFlag==="Y"?"success":"error"},{default:l(()=>[h(w(r.value.activeFlag==="Y"?"运行中":"已停用"),1)]),_:1},8,["type"])])])):ee("",!0)])])):(P(),V("div",wo,[t(e(E),{type:"primary",onClick:B,size:"large"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ae))]),_:1})]),default:l(()=>[o[24]||(o[24]=h(" 选择注册服务 "))]),_:1}),o[25]||(o[25]=a("div",{class:"empty-hint"},"请从服务注册中心选择一个可用的服务",-1))]))]),_:1})])]),_:1})):ee("",!0),t(e(Te),{name:"other",tab:"其他配置"},{default:l(()=>[t(e(A),{label:"状态"},{default:l(()=>[t(e(Pe),{value:M.value,"onUpdate:value":o[18]||(o[18]=g=>M.value=g)},null,8,["value"]),a("span",Ao,w(M.value?"启用":"禁用"),1)]),_:1}),t(e(A),{label:"备注信息",path:"noteText"},{default:l(()=>[t(e(ue),{value:m.noteText,"onUpdate:value":o[19]||(o[19]=g=>m.noteText=g),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1})]),_:1},8,["show"]),t(xo,{show:T.value,"onUpdate:show":o[21]||(o[21]=g=>T.value=g),currentService:r.value,onSelect:J},null,8,["show","currentService"])],64)}}}),Bo=me(Yo,[["__scopeId","data-v-a484c481"]]),Lo={class:"modal-header"},Vo={class:"header-content"},Jo={class:"modal-title"},qo={class:"ml-2"},Ko={class:"ml-2"},jo=de({__name:"ServiceNodeFormDialog",props:{show:{type:Boolean},formData:{},mode:{},serviceDefinitionId:{}},emits:["update:show","refresh","close"],setup(v,{emit:y}){const p=v,i=y,C=xe(),b=z(null),f=z(!1),u=ye({serviceDefinitionId:"",nodeUrl:"http://192.168.1.0:8080",nodeHost:"192.168.1.0",nodePort:8080,nodeProtocol:"HTTP",nodeWeight:100,healthStatus:"Y",nodeEnabled:"Y",nodeStatus:be.ONLINE,activeFlag:"Y",noteText:""}),r=Q({get:()=>p.show,set:S=>i("update:show",S)}),T=Q({get:()=>u.healthStatus==="Y",set:S=>{u.healthStatus=S?"Y":"N"}}),m=Q({get:()=>u.activeFlag==="Y",set:S=>{u.activeFlag=S?"Y":"N"}}),O=Q({get:()=>u.nodeMetadata&&typeof u.nodeMetadata=="object"?JSON.stringify(u.nodeMetadata,null,2):u.nodeMetadata||"",set:S=>{try{u.nodeMetadata=S?JSON.parse(S):void 0}catch{u.nodeMetadata=S}}}),_=[{label:"HTTP",value:"HTTP"},{label:"HTTPS",value:"HTTPS"}],K=[{label:"在线",value:be.ONLINE},{label:"下线",value:be.OFFLINE},{label:"维护",value:be.MAINTENANCE}],Y={nodeHost:[{required:!0,message:"请输入节点主机地址",trigger:["blur","input"]},{pattern:/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/,message:"请输入有效的IP地址或域名",trigger:["blur","input"]}],nodePort:[{required:!0,type:"number",message:"请输入节点端口",trigger:["blur","change"]}],nodeUrl:[{required:!0,message:"请输入节点URL",trigger:["blur","input"]},{validator:(S,x)=>{if(x&&(x.startsWith("http://")||x.startsWith("https://")))try{return new URL(x),!0}catch{return new Error("请输入有效的URL格式")}return!0},trigger:["blur","input"]}],nodeWeight:[{required:!0,type:"number",message:"请输入节点权重",trigger:["blur","change"]}],nodeProtocol:[{required:!0,message:"请选择节点协议",trigger:["blur","change"]}],nodeStatus:[{required:!0,type:"number",message:"请选择运行状态",trigger:["blur","change"]}]};le(()=>p.formData,S=>{if(p.mode==="edit"&&S){const x={...S,nodePort:S.nodePort?Number(S.nodePort):8080,nodeWeight:S.nodeWeight?Number(S.nodeWeight):100,nodeStatus:S.nodeStatus!==void 0?Number(S.nodeStatus):be.ONLINE};Object.assign(u,x)}else p.mode==="add"&&H()},{immediate:!0,deep:!0}),le(()=>p.mode,S=>{S==="add"&&H()},{immediate:!0}),le(()=>p.show,S=>{S&&(p.mode==="add"&&H(),Oe(()=>{var x;(x=b.value)==null||x.restoreValidation()}))}),le(()=>p.serviceDefinitionId,S=>{S&&p.mode==="add"&&(u.serviceDefinitionId=S)},{immediate:!0});function H(){const S=u.serviceDefinitionId||p.serviceDefinitionId||"";Object.assign(u,{serviceDefinitionId:S,nodeUrl:"http://192.168.1.0:8080",nodeHost:"192.168.1.0",nodePort:8080,nodeProtocol:"HTTP",nodeWeight:100,healthStatus:"Y",nodeEnabled:"Y",nodeStatus:be.ONLINE,activeFlag:"Y",noteText:""})}function M(){if(u.nodeHost&&u.nodePort!==void 0&&u.nodeProtocol){const S=u.nodeProtocol.toLowerCase();u.nodeUrl=`${S}://${u.nodeHost}:${u.nodePort}`}}function R(){i("update:show",!1),i("close")}async function j(){var S;try{await((S=b.value)==null?void 0:S.validate()),f.value=!0,!u.serviceDefinitionId&&p.serviceDefinitionId&&(u.serviceDefinitionId=p.serviceDefinitionId);const x={...u,serviceDefinitionId:u.serviceDefinitionId||p.serviceDefinitionId||"",nodePort:Number(u.nodePort),nodeWeight:Number(u.nodeWeight),nodeStatus:Number(u.nodeStatus),nodeUrl:u.nodeUrl,nodeHost:u.nodeHost,nodeProtocol:u.nodeProtocol,healthStatus:u.healthStatus||"Y",nodeEnabled:u.nodeEnabled||"Y",activeFlag:u.activeFlag||"Y",noteText:u.noteText||"",nodeMetadata:u.nodeMetadata};if(!x.serviceDefinitionId){C.error("服务定义ID不能为空");return}if(!x.nodeUrl||!x.nodeHost||!x.nodeProtocol){C.error("节点URL、主机地址和协议不能为空");return}const $=p.mode==="add"?await pa(x):await st({...x,serviceNodeId:u.serviceNodeId,nodeUrl:x.nodeUrl,nodeHost:x.nodeHost,nodePort:x.nodePort,nodeProtocol:x.nodeProtocol,nodeWeight:x.nodeWeight,healthStatus:x.healthStatus,nodeEnabled:x.nodeEnabled,nodeStatus:x.nodeStatus,activeFlag:x.activeFlag,noteText:x.noteText,nodeMetadata:x.nodeMetadata});$.oK?(C.success(p.mode==="add"?"创建成功":"保存成功"),i("refresh"),R()):C.error($.messageId||"操作失败")}catch(x){x&&typeof x=="object"&&Array.isArray(x)?C.error("请检查表单填写是否正确"):(C.error("操作失败: "+(x.message||"未知错误")),console.error("提交失败",x))}finally{f.value=!1}}return le(()=>u.nodeProtocol,M),le(()=>u.nodeUrl,S=>{if(S&&(S.startsWith("http://")||S.startsWith("https://")))try{const x=new URL(S);u.nodeProtocol=x.protocol==="https:"?"HTTPS":"HTTP",u.nodeHost=x.hostname,x.port?u.nodePort=parseInt(x.port,10):u.nodePort=x.protocol==="https:"?443:80}catch(x){console.warn("URL解析失败:",x)}}),(S,x)=>(P(),Z(e(qe),{show:r.value,"onUpdate:show":x[11]||(x[11]=$=>r.value=$),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(e(pe),{style:{width:"800px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",Lo,[t(e(N),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(He))]),_:1}),a("div",Vo,[a("h3",Jo,w(S.mode==="add"?"新建服务节点":"编辑服务节点"),1),x[12]||(x[12]=a("p",{class:"modal-subtitle"},"配置后端服务的具体节点实例",-1))])])]),"header-extra":l(()=>[t(e(E),{quaternary:"",circle:"",onClick:R,class:"close-btn"},{icon:l(()=>[t(e(N),{size:"18"},{default:l(()=>[t(e(Je))]),_:1})]),_:1})]),action:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{onClick:R},{default:l(()=>x[14]||(x[14]=[h("取消")])),_:1}),t(e(E),{type:"primary",loading:f.value,onClick:j},{default:l(()=>[h(w(S.mode==="add"?"创建":"保存"),1)]),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(e(Be),{ref_key:"formRef",ref:b,model:u,rules:Y,"label-placement":"left","label-width":"120px"},{default:l(()=>[t(e(it),{type:"line",animated:""},{default:l(()=>[t(e(Te),{name:"basic",tab:"基本信息"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(A),{label:"节点协议",path:"nodeProtocol"},{default:l(()=>[t(e(ve),{value:u.nodeProtocol,"onUpdate:value":x[0]||(x[0]=$=>u.nodeProtocol=$),options:_,placeholder:"请选择协议"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"节点主机",path:"nodeHost"},{default:l(()=>[t(e(ue),{value:u.nodeHost,"onUpdate:value":[x[1]||(x[1]=$=>u.nodeHost=$),M],placeholder:"请输入主机地址"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"节点端口",path:"nodePort"},{default:l(()=>[t(e(ke),{value:u.nodePort,"onUpdate:value":[x[2]||(x[2]=$=>u.nodePort=$),M],min:1,max:65535,placeholder:"请输入端口"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"节点权重",path:"nodeWeight"},{default:l(()=>[t(e(ke),{value:u.nodeWeight,"onUpdate:value":x[3]||(x[3]=$=>u.nodeWeight=$),min:1,max:1e3,placeholder:"权重值"},null,8,["value"])]),_:1})]),_:1}),t(e(G),{span:2},{default:l(()=>[t(e(A),{label:"节点URL",path:"nodeUrl"},{feedback:l(()=>x[13]||(x[13]=[a("span",{class:"helper-text"},"支持直接输入完整URL(如 https://www.example.com)，将自动解析为协议、主机和端口",-1)])),default:l(()=>[t(e(ue),{value:u.nodeUrl,"onUpdate:value":x[4]||(x[4]=$=>u.nodeUrl=$),placeholder:"输入完整URL或由上方字段自动生成"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"运行状态",path:"nodeStatus"},{default:l(()=>[t(e(ve),{value:u.nodeStatus,"onUpdate:value":x[5]||(x[5]=$=>u.nodeStatus=$),options:K,placeholder:"请选择运行状态"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Te),{name:"status",tab:"状态配置"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(A),{label:"健康状态"},{default:l(()=>[t(e(Pe),{value:T.value,"onUpdate:value":x[6]||(x[6]=$=>T.value=$)},null,8,["value"]),a("span",qo,w(T.value?"健康":"不健康"),1)]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"启用状态"},{default:l(()=>[t(e(Pe),{value:m.value,"onUpdate:value":x[7]||(x[7]=$=>m.value=$)},null,8,["value"]),a("span",Ko,w(m.value?"启用":"禁用"),1)]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"运行状态",path:"nodeStatus"},{default:l(()=>[t(e(ve),{value:u.nodeStatus,"onUpdate:value":x[8]||(x[8]=$=>u.nodeStatus=$),options:K,placeholder:"请选择运行状态"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(Te),{name:"metadata",tab:"元数据配置"},{default:l(()=>[t(e(A),{label:"节点元数据"},{default:l(()=>[t(e(ue),{value:O.value,"onUpdate:value":x[9]||(x[9]=$=>O.value=$),type:"textarea",rows:8,placeholder:"JSON格式的节点元数据配置"},null,8,["value"])]),_:1})]),_:1}),t(e(Te),{name:"other",tab:"其他配置"},{default:l(()=>[t(e(A),{label:"备注信息",path:"noteText"},{default:l(()=>[t(e(ue),{value:u.noteText,"onUpdate:value":x[10]||(x[10]=$=>u.noteText=$),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]))}}),Wo=me(jo,[["__scopeId","data-v-56953fa5"]]);function Xo(v){const y=xe(),p=z(!1),i=z([]),C=z(0),b=z([]),f=z(1),u=z(10),r=z(!1),T=z("add"),m=z(null),O=ye({serviceDefinitionId:v,nodeHost:"",healthStatus:void 0,activeFlag:void 0,nodeStatus:void 0,page:1,size:10}),_=[{label:"HTTP",value:"HTTP"},{label:"HTTPS",value:"HTTPS"}],K=[{label:"全部",value:void 0},{label:"健康",value:"Y"},{label:"不健康",value:"N"}],Y=[{label:"全部",value:void 0},{label:"启用",value:"Y"},{label:"禁用",value:"N"}],H=[{label:"全部",value:void 0},{label:"在线",value:be.ONLINE},{label:"下线",value:be.OFFLINE},{label:"维护",value:be.MAINTENANCE}],M=Q(()=>b.value.length>0),R=Q(()=>({page:f.value,pageSize:u.value,itemCount:C.value,onChange:s=>{f.value=s,O.page=s,S()},onUpdatePageSize:s=>{u.value=s,O.size=s,S()},showSizePicker:!0,pageSizes:[10,20,30,50],showQuickJumper:!0,prefix:s=>`共 ${s.itemCount||0} 条`})),j=[{type:"selection",fixed:"left"},{title:"节点ID",key:"nodeId",width:150,ellipsis:{tooltip:!0}},{title:"节点地址",key:"nodeUrl",width:200,ellipsis:{tooltip:!0},render:s=>`${s.nodeHost}:${s.nodePort}`},{title:"协议",key:"nodeProtocol",width:80,align:"center",render:s=>I(L,{type:s.nodeProtocol==="HTTPS"?"success":"info",size:"small"},()=>s.nodeProtocol)},{title:"权重",key:"nodeWeight",width:80,align:"center"},{title:"健康状态",key:"healthStatus",width:100,align:"center",render:s=>{const g=s.healthStatus==="Y";return I("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:g?"#18a058":"#d03050"}},[I(N,{size:18},()=>I(g?Ie:We)),I("span",{style:{marginLeft:"4px"}},g?"健康":"不健康")])}},{title:"运行状态",key:"nodeStatus",width:100,align:"center",render:s=>{let g=gl,d="#d9d9d9",n="未知";switch(s.nodeStatus){case be.ONLINE:g=Ie,d="#18a058",n="在线";break;case be.OFFLINE:g=We,d="#d03050",n="下线";break;case be.MAINTENANCE:g=Tt,d="#f0a020",n="维护";break}return I("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:d}},[I(N,{size:18},()=>I(g)),I("span",{style:{marginLeft:"4px"}},n)])}},{title:"启用状态",key:"activeFlag",width:100,align:"center",render:s=>{const g=s.activeFlag==="Y";return I("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:g?"#18a058":"#d03050"}},[I(N,{size:18},()=>I(g?Ie:We)),I("span",{style:{marginLeft:"4px"}},g?"启用":"禁用")])}},{title:"最后检查时间",key:"lastHealthCheckTime",width:180,align:"center",render:s=>s.lastHealthCheckTime?new Date(s.lastHealthCheckTime).toLocaleString():"-"},{title:"操作",key:"actions",width:240,align:"center",fixed:"right",render:s=>I(Se,{size:"small"},()=>[I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"primary",secondary:!0,onClick:()=>$(s)},{icon:()=>I(N,()=>I(Ze))}),default:()=>"编辑"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"info",secondary:!0,onClick:()=>X(s)},{icon:()=>I(N,()=>I(al))}),default:()=>"健康检查"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:s.activeFlag==="Y"?"warning":"success",secondary:!0,onClick:()=>D(s.serviceNodeId,s.activeFlag==="Y"?"N":"Y")},{icon:()=>I(N,()=>I(s.activeFlag==="Y"?Le:Ie))}),default:()=>s.activeFlag==="Y"?"禁用":"启用"}),I(et,{onPositiveClick:()=>oe(s.serviceNodeId,"default")},{trigger:()=>I(E,{size:"small",type:"error",secondary:!0},{icon:()=>I(N,()=>I(Fe))}),default:()=>"确认删除该节点吗？"})])}];async function S(){try{p.value=!0;const s=await ca(O);if(s.oK){if(s.bizData)try{const g=JSON.parse(s.bizData);if(Array.isArray(g)){if(i.value=g,s.pageQueryData){const d=JSON.parse(s.pageQueryData);C.value=d.totalCount||0}}else g&&g.records?(i.value=g.records,C.value=g.total||0):(i.value=[],C.value=0)}catch(g){i.value=[],C.value=0,console.error("解析数据失败",g)}}else y.error(s.messageId||"加载服务节点列表失败")}catch(s){y.error("加载服务节点列表失败: "+(s.message||"未知错误")),console.error("加载服务节点列表失败",s)}finally{p.value=!1}}function x(){T.value="add",m.value=null,Oe(()=>{m.value={serviceDefinitionId:v,nodeUrl:"http://192.168.1.0:8080",nodeHost:"192.168.1.0",nodePort:8080,nodeProtocol:"HTTP",nodeWeight:100,healthStatus:"Y",nodeEnabled:"Y",nodeStatus:be.ONLINE,activeFlag:"Y",noteText:""},console.log("添加节点，设置serviceDefinitionId:",v),r.value=!0})}function $(s){T.value="edit",m.value=null,Oe(()=>{m.value={...s},r.value=!0})}function ae(){m.value=null,r.value=!1}async function oe(s,g){try{p.value=!0;const d=await fa(s,g);d.oK?(y.success("删除成功"),await S()):y.error(d.messageId||"删除失败")}catch(d){y.error("删除失败: "+(d.message||"未知错误")),console.error("删除失败",d)}finally{p.value=!1}}async function J(){if(b.value.length===0){y.warning("请选择要删除的服务节点");return}try{p.value=!0;const s=await ga(b.value);s.oK?(y.success("批量删除成功"),b.value=[],await S()):y.error(s.messageId||"批量删除失败")}catch(s){y.error("批量删除失败: "+(s.message||"未知错误")),console.error("批量删除失败",s)}finally{p.value=!1}}async function D(s,g){const d=g==="Y"?"启用":"禁用";if(!O.serviceDefinitionId){y.error("服务定义ID不能为空");return}try{p.value=!0;const n=await st({serviceNodeId:s,serviceDefinitionId:O.serviceDefinitionId,activeFlag:g});n.oK?(y.success(`${d}成功`),await S()):y.error(n.messageId||`${d}失败`)}catch(n){y.error(`${d}失败: `+(n.message||"未知错误")),console.error(`${d}失败`,n)}finally{p.value=!1}}async function B(s){if(b.value.length===0){y.warning("请选择要操作的服务节点");return}if(!O.serviceDefinitionId){y.error("服务定义ID不能为空");return}const g=s==="Y"?"启用":"禁用";try{p.value=!0;const d=b.value.map(te=>st({serviceNodeId:te,serviceDefinitionId:O.serviceDefinitionId,activeFlag:s})),n=await Promise.all(d),q=n.filter(te=>!te.oK).length;q===0?y.success(`成功${g} ${n.length} 个服务节点`):y.warning(`部分操作失败，${n.length-q}/${n.length} 成功`),b.value=[],await S()}catch(d){y.error(`批量${g}失败: `+(d.message||"未知错误")),console.error(`批量${g}失败`,d)}finally{p.value=!1}}async function X(s){try{const g=await va({serviceNodeId:s.serviceNodeId,healthStatus:"Y"});g.oK?(y.success("健康检查完成"),await S()):y.error(g.messageId||"健康检查失败")}catch(g){y.error("健康检查失败: "+(g.message||"未知错误")),console.error("健康检查失败",g)}}function F(s){b.value=s.map(g=>String(g))}function U(){O.page=1,S()}function c(){Object.assign(O,{serviceDefinitionId:v,nodeHost:"",healthStatus:void 0,activeFlag:void 0,nodeStatus:void 0,page:1,size:10}),f.value=1,S()}function o(){S()}return{loading:p,nodeList:i,total:C,selectedRowKeys:b,queryParams:O,showDialog:r,dialogMode:T,currentFormData:m,protocolOptions:_,statusOptions:K,enabledOptions:Y,nodeStatusOptions:H,hasSelection:M,paginationProps:R,columns:j,loadNodeList:S,handleAdd:x,handleEdit:$,handleDelete:oe,handleBatchDelete:J,handleToggleEnabled:D,handleBatchToggleEnabled:B,handleHealthCheck:X,handleDialogClose:ae,handleSelectionChange:F,search:U,resetQuery:c,refresh:o}}const Go={class:"modal-header"},Qo={class:"service-node-content"},Zo={class:"query-section"},en={class:"toolbar-section"},tn={class:"table-section"},ln=de({__name:"ServiceNodeDialog",props:{show:{type:Boolean},serviceDefinitionId:{}},emits:["update:show","refresh"],setup(v,{emit:y}){const p=v,i=y,{loading:C,nodeList:b,selectedRowKeys:f,queryParams:u,showDialog:r,dialogMode:T,currentFormData:m,statusOptions:O,nodeStatusOptions:_,hasSelection:K,paginationProps:Y,columns:H,loadNodeList:M,handleAdd:R,handleBatchDelete:j,handleBatchToggleEnabled:S,handleDialogClose:x,handleSelectionChange:$,search:ae,resetQuery:oe,refresh:J}=Xo(p.serviceDefinitionId),D=Q({get:()=>p.show,set:c=>i("update:show",c)});function B(){x(),f.value=[],u.page=1,u.nodeHost="",u.healthStatus=void 0,u.nodeStatus=void 0,i("update:show",!1)}function X(){M(),i("refresh")}function F(){R()}const U=Q(()=>p.show&&p.serviceDefinitionId);return Vt(()=>{U.value&&(u.serviceDefinitionId=p.serviceDefinitionId,u.page=1,f.value=[],M())}),le(()=>p.show,c=>{c||x()}),le(r,c=>{c||x()}),(c,o)=>(P(),V(ze,null,[t(e(qe),{show:D.value,"onUpdate:show":o[5]||(o[5]=s=>D.value=s),"mask-closable":!1,"close-on-esc":!1,"transform-origin":"center"},{default:l(()=>[t(e(pe),{style:{width:"1200px"},bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{header:l(()=>[a("div",Go,[t(e(N),{size:"24",class:"modal-icon"},{default:l(()=>[t(e(He))]),_:1}),o[7]||(o[7]=a("div",{class:"header-content"},[a("h3",{class:"modal-title"},"服务节点管理"),a("p",{class:"modal-subtitle"},"管理服务的后端节点实例")],-1))])]),"header-extra":l(()=>[t(e(E),{quaternary:"",circle:"",onClick:B,class:"close-btn"},{icon:l(()=>[t(e(N),{size:"18"},{default:l(()=>[t(e(Je))]),_:1})]),_:1})]),action:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{onClick:B},{default:l(()=>o[15]||(o[15]=[h("关闭")])),_:1})]),_:1})]),default:l(()=>[a("div",Qo,[a("div",Zo,[t(e(Be),{inline:"","label-width":80,size:"small"},{default:l(()=>[t(e(A),{label:"节点主机"},{default:l(()=>[t(e(ue),{value:e(u).nodeHost,"onUpdate:value":o[0]||(o[0]=s=>e(u).nodeHost=s),placeholder:"请输入主机地址",style:{width:"180px"},onKeydown:ot(e(ae),["enter"])},null,8,["value","onKeydown"])]),_:1}),t(e(A),{label:"健康状态"},{default:l(()=>[t(e(ve),{value:e(u).healthStatus,"onUpdate:value":o[1]||(o[1]=s=>e(u).healthStatus=s),options:e(O),placeholder:"请选择",style:{width:"120px"}},null,8,["value","options"])]),_:1}),t(e(A),{label:"运行状态"},{default:l(()=>[t(e(ve),{value:e(u).nodeStatus,"onUpdate:value":o[2]||(o[2]=s=>e(u).nodeStatus=s),options:e(_),placeholder:"请选择",style:{width:"120px"}},null,8,["value","options"])]),_:1}),t(e(A),null,{default:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{type:"primary",onClick:e(ae),loading:e(C),size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ae))]),_:1})]),default:l(()=>[o[8]||(o[8]=h(" 查询 "))]),_:1},8,["onClick","loading"]),t(e(E),{onClick:e(oe),size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ye))]),_:1})]),default:l(()=>[o[9]||(o[9]=h(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),a("div",en,[t(e(Se),null,{default:l(()=>[t(e(E),{type:"primary",onClick:F,size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(dt))]),_:1})]),default:l(()=>[o[10]||(o[10]=h(" 新建节点 "))]),_:1}),t(e(E),{type:"error",disabled:!e(K),onClick:e(j),size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Fe))]),_:1})]),default:l(()=>[o[11]||(o[11]=h(" 批量删除 "))]),_:1},8,["disabled","onClick"]),t(e(E),{type:"success",disabled:!e(K),onClick:o[3]||(o[3]=()=>e(S)("Y")),size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ie))]),_:1})]),default:l(()=>[o[12]||(o[12]=h(" 批量启用 "))]),_:1},8,["disabled"]),t(e(E),{type:"warning",disabled:!e(K),onClick:o[4]||(o[4]=()=>e(S)("N")),size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Le))]),_:1})]),default:l(()=>[o[13]||(o[13]=h(" 批量禁用 "))]),_:1},8,["disabled"]),t(e(E),{onClick:e(J),size:"small"},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ye))]),_:1})]),default:l(()=>[o[14]||(o[14]=h(" 刷新 "))]),_:1},8,["onClick"])]),_:1})]),a("div",tn,[t(e(ut),{columns:e(H),data:e(b),loading:e(C),"row-key":s=>s.serviceNodeId,"checked-row-keys":e(f),"onUpdate:checkedRowKeys":e($),pagination:e(Y),"scroll-x":1400,size:"small",striped:"",class:"custom-table"},null,8,["columns","data","loading","row-key","checked-row-keys","onUpdate:checkedRowKeys","pagination"])])])]),_:1})]),_:1},8,["show"]),t(Wo,{show:e(r),"onUpdate:show":o[6]||(o[6]=s=>Xe(r)?r.value=s:null),"form-data":e(m),mode:e(T),"service-definition-id":c.serviceDefinitionId,onRefresh:X,onClose:e(x)},null,8,["show","form-data","mode","service-definition-id","onClose"])],64))}}),an=me(ln,[["__scopeId","data-v-b68e03fb"]]);function on(v){const y=xe(),p=z(!1),i=z([]),C=z(0),b=z([]),f=z(!1),u=z(!1),r=z("add"),T=z(null),m=z(""),O=z(""),_=ye({serviceName:"",serviceType:void 0,loadBalanceStrategy:void 0,activeFlag:void 0,proxyConfigId:v,pageIndex:1,pageSize:10}),K=[{label:"静态配置",value:ge.STATIC},{label:"服务发现",value:ge.DISCOVERY}],Y=[{label:"轮询算法",value:ne.ROUND_ROBIN},{label:"随机算法",value:ne.RANDOM},{label:"IP哈希算法",value:ne.IP_HASH},{label:"最少连接算法",value:ne.LEAST_CONN},{label:"加权轮询算法",value:ne.WEIGHTED_ROUND_ROBIN},{label:"一致性哈希算法",value:ne.CONSISTENT_HASH}],H=[{label:"全部",value:void 0},{label:"启用",value:"Y"},{label:"禁用",value:"N"}],M=Q(()=>b.value.length>0),R=Q(()=>({page:_.pageIndex,pageSize:_.pageSize,itemCount:C.value,showSizePicker:!0,pageSizes:[10,20,50,100],showQuickJumper:!0,prefix:s=>`共 ${s.itemCount||0} 条`,onUpdatePage:s=>{_.pageIndex=s,S()},onUpdatePageSize:s=>{_.pageSize=s,_.pageIndex=1,S()}})),j=[{type:"selection",fixed:"left"},{title:"服务名称",key:"serviceName",width:200,ellipsis:{tooltip:!0}},{title:"服务类型",key:"serviceType",width:120,align:"center",render:s=>I(L,{type:s.serviceType===ge.STATIC?"info":"success",size:"small"},()=>s.serviceType===ge.STATIC?"静态配置":"服务发现")},{title:"负载均衡策略",key:"loadBalanceStrategy",width:150,align:"center",render:s=>{const g={[ne.ROUND_ROBIN]:"轮询",[ne.RANDOM]:"随机",[ne.IP_HASH]:"IP哈希",[ne.LEAST_CONN]:"最少连接",[ne.WEIGHTED_ROUND_ROBIN]:"加权轮询",[ne.CONSISTENT_HASH]:"一致性哈希"};return I(L,{type:"default",size:"small"},()=>g[s.loadBalanceStrategy]||s.loadBalanceStrategy)}},{title:"服务节点",key:"nodeCount",width:100,align:"center",render:()=>0},{title:"健康检查",key:"healthCheckEnabled",width:120,align:"center",render:s=>I(L,{type:s.healthCheckEnabled==="Y"?"success":"default",size:"small"},()=>s.healthCheckEnabled==="Y"?"已启用":"未启用")},{title:"状态",key:"activeFlag",width:100,align:"center",render:s=>I(L,{type:s.activeFlag==="Y"?"success":"error",size:"small"},()=>s.activeFlag==="Y"?"启用":"禁用")},{title:"创建时间",key:"createTime",width:180,align:"center"},{title:"操作",key:"actions",width:280,align:"center",fixed:"right",render:s=>I(Se,{size:"small"},()=>[I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"primary",secondary:!0,onClick:()=>$(s)},()=>I(N,{size:14},()=>I(Ze))),default:()=>"编辑"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"info",secondary:!0,onClick:()=>X(s)},()=>I(N,{size:14},()=>I(xt))),default:()=>"节点管理"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:s.activeFlag==="Y"?"warning":"success",secondary:!0,onClick:()=>J(s)},()=>I(N,{size:14},()=>I(s.activeFlag==="Y"?Le:Ie))),default:()=>s.activeFlag==="Y"?"禁用":"启用"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"info",secondary:!0,onClick:()=>B(s)},()=>I(N,{size:14},()=>I(wt))),default:()=>"复制"}),I(et,{onPositiveClick:()=>ae(s),negativeText:"取消",positiveText:"确认"},{trigger:()=>I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"error",secondary:!0},()=>I(N,{size:14},()=>I(Fe))),default:()=>"删除"}),default:()=>"确认删除该服务定义吗？"})])}];async function S(){try{p.value=!0;const s=await ia(_);if(s.oK){const g=JSON.parse(s.bizData);if(Array.isArray(g)){if(i.value=g,s.pageQueryData){const d=JSON.parse(s.pageQueryData);C.value=d.totalCount||0}}else i.value=g.records||[],C.value=g.total||0}}catch(s){y.error("加载服务定义列表失败: "+(s.message||"未知错误"))}finally{p.value=!1}}function x(){r.value="add",T.value={proxyConfigId:v,serviceName:"",serviceDesc:"",serviceType:ge.STATIC,loadBalanceStrategy:ne.ROUND_ROBIN,sessionAffinity:"N",stickySession:"N",maxRetries:3,retryTimeoutMs:5e3,enableCircuitBreaker:"N",healthCheckEnabled:"Y",healthCheckPath:"/health",healthCheckMethod:"GET",healthCheckIntervalSeconds:30,healthCheckTimeoutMs:5e3,healthyThreshold:2,unhealthyThreshold:3,expectedStatusCodes:"200",activeFlag:"Y",noteText:""},f.value=!0}function $(s){r.value="edit",O.value=s.serviceDefinitionId,T.value=null,f.value=!0}async function ae(s){try{const g=await mt(s.serviceDefinitionId,"default");g.oK?(y.success("删除成功"),await S()):y.error(g.messageId||"删除失败")}catch(g){y.error("删除失败: "+(g.message||"未知错误"))}}async function oe(){if(b.value.length===0){y.warning("请选择要删除的服务定义");return}try{const s=b.value.map(n=>mt(n,"default")),d=(await Promise.all(s)).filter(n=>n.oK).length;d===b.value.length?y.success(`成功删除 ${d} 个服务定义`):y.warning(`删除了 ${d}/${b.value.length} 个服务定义`),b.value=[],await S()}catch(s){y.error("批量删除失败: "+(s.message||"未知错误"))}}async function J(s){const g=s.activeFlag==="Y"?"N":"Y",d=g==="Y"?"启用":"禁用";try{const n=await nt({serviceDefinitionId:s.serviceDefinitionId,tenantId:"default",activeFlag:g});n.oK?(y.success(`${d}成功`),await S()):y.error(n.messageId||`${d}失败`)}catch(n){y.error(`${d}失败: `+(n.message||"未知错误"))}}async function D(s){if(b.value.length===0){y.warning("请选择要操作的服务定义");return}const g=s==="Y"?"启用":"禁用";try{const d=b.value.map(te=>nt({serviceDefinitionId:te,tenantId:"default",activeFlag:s})),q=(await Promise.all(d)).filter(te=>te.oK).length;q===b.value.length?y.success(`成功${g} ${q} 个服务定义`):y.warning(`${g}了 ${q}/${b.value.length} 个服务定义`),b.value=[],await S()}catch(d){y.error(`批量${g}失败: `+(d.message||"未知错误"))}}function B(s){r.value="add",T.value={proxyConfigId:v,serviceName:`${s.serviceName}_copy`,serviceDesc:s.serviceDesc,serviceType:s.serviceType,loadBalanceStrategy:s.loadBalanceStrategy,sessionAffinity:s.sessionAffinity||"N",stickySession:s.stickySession||"N",maxRetries:s.maxRetries||3,retryTimeoutMs:s.retryTimeoutMs||5e3,enableCircuitBreaker:s.enableCircuitBreaker||"N",healthCheckEnabled:s.healthCheckEnabled||"Y",healthCheckPath:s.healthCheckPath||"/health",healthCheckMethod:s.healthCheckMethod||"GET",healthCheckIntervalSeconds:s.healthCheckIntervalSeconds||30,healthCheckTimeoutMs:s.healthCheckTimeoutMs||5e3,healthyThreshold:s.healthyThreshold||2,unhealthyThreshold:s.unhealthyThreshold||3,expectedStatusCodes:s.expectedStatusCodes||"200",discoveryType:s.discoveryType,discoveryConfig:s.discoveryConfig,activeFlag:"Y",noteText:s.noteText},f.value=!0}function X(s){u.value=!1,Oe(()=>{m.value=s.serviceDefinitionId,u.value=!0})}function F(s){b.value=s.map(g=>String(g))}function U(){_.pageIndex=1,S()}function c(){Object.assign(_,{serviceName:"",serviceType:void 0,loadBalanceStrategy:void 0,activeFlag:void 0,pageIndex:1,pageSize:10}),S()}function o(){S()}return{loading:p,serviceList:i,totalCount:C,selectedRowKeys:b,queryParams:_,showDialog:f,showNodeDialog:u,dialogMode:r,currentFormData:T,currentServiceId:m,currentServiceDefinitionId:O,serviceTypeOptions:K,loadBalanceStrategyOptions:Y,statusOptions:H,hasSelection:M,paginationProps:R,columns:j,loadServiceList:S,handleAdd:x,handleEdit:$,handleDelete:ae,handleBatchDelete:oe,handleToggleStatus:J,handleBatchToggle:D,handleCopy:B,handleManageNodes:X,handleSelectionChange:F,search:U,resetQuery:c,refresh:o}}const nn={class:"service-definition-manager"},sn=de({__name:"ServiceDefinitionManager",props:{proxyConfigId:{}},emits:["refresh"],setup(v,{emit:y}){const p=v,i=y,{loading:C,serviceList:b,selectedRowKeys:f,queryParams:u,showDialog:r,showNodeDialog:T,dialogMode:m,currentFormData:O,currentServiceId:_,currentServiceDefinitionId:K,serviceTypeOptions:Y,loadBalanceStrategyOptions:H,statusOptions:M,hasSelection:R,paginationProps:j,columns:S,loadServiceList:x,handleAdd:$,handleBatchDelete:ae,handleBatchToggle:oe,handleSelectionChange:J,search:D,resetQuery:B,refresh:X}=on(p.proxyConfigId);function F(){X(),i("refresh")}return Ge(()=>{x()}),(U,c)=>(P(),V("div",nn,[t(e(pe),{size:"small",class:"search-card"},{default:l(()=>[t(e(Be),{inline:"",model:e(u),"label-placement":"left"},{default:l(()=>[t(e(A),{label:"服务名称"},{default:l(()=>[t(e(ue),{value:e(u).serviceName,"onUpdate:value":c[0]||(c[0]=o=>e(u).serviceName=o),placeholder:"请输入服务名称",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),t(e(A),{label:"服务类型"},{default:l(()=>[t(e(ve),{value:e(u).serviceType,"onUpdate:value":c[1]||(c[1]=o=>e(u).serviceType=o),placeholder:"请选择服务类型",clearable:"",style:{width:"150px"},options:e(Y)},null,8,["value","options"])]),_:1}),t(e(A),{label:"负载均衡策略"},{default:l(()=>[t(e(ve),{value:e(u).loadBalanceStrategy,"onUpdate:value":c[2]||(c[2]=o=>e(u).loadBalanceStrategy=o),placeholder:"请选择负载均衡策略",clearable:"",style:{width:"180px"},options:e(H)},null,8,["value","options"])]),_:1}),t(e(A),{label:"状态"},{default:l(()=>[t(e(ve),{value:e(u).activeFlag,"onUpdate:value":c[3]||(c[3]=o=>e(u).activeFlag=o),placeholder:"请选择状态",style:{width:"120px"},options:e(M)},null,8,["value","options"])]),_:1}),t(e(A),null,{default:l(()=>[t(e(E),{type:"primary",onClick:e(D)},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ae))]),_:1})]),default:l(()=>[c[8]||(c[8]=h(" 搜索 "))]),_:1},8,["onClick"]),t(e(E),{onClick:e(B),style:{"margin-left":"8px"}},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ye))]),_:1})]),default:l(()=>[c[9]||(c[9]=h(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),t(e(pe),{size:"small",class:"action-card"},{default:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{type:"primary",onClick:e($)},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(dt))]),_:1})]),default:l(()=>[c[10]||(c[10]=h(" 新增服务 "))]),_:1},8,["onClick"]),t(e(E),{type:"error",disabled:!e(R),onClick:e(ae)},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Fe))]),_:1})]),default:l(()=>[c[11]||(c[11]=h(" 批量删除 "))]),_:1},8,["disabled","onClick"]),t(e(E),{type:"success",disabled:!e(R),onClick:c[4]||(c[4]=()=>e(oe)("Y"))},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ie))]),_:1})]),default:l(()=>[c[12]||(c[12]=h(" 批量启用 "))]),_:1},8,["disabled"]),t(e(E),{type:"warning",disabled:!e(R),onClick:c[5]||(c[5]=()=>e(oe)("N"))},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Le))]),_:1})]),default:l(()=>[c[13]||(c[13]=h(" 批量禁用 "))]),_:1},8,["disabled"]),t(e(E),{onClick:F},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ye))]),_:1})]),default:l(()=>[c[14]||(c[14]=h(" 刷新 "))]),_:1})]),_:1})]),_:1}),t(e(pe),null,{default:l(()=>[t(e(ut),{ref:"dataTableRef",columns:e(S),data:e(b),loading:e(C),pagination:e(j),"row-key":o=>o.serviceDefinitionId,"checked-row-keys":e(f),"onUpdate:checkedRowKeys":e(J),size:"small",striped:"",remote:""},null,8,["columns","data","loading","pagination","row-key","checked-row-keys","onUpdate:checkedRowKeys"])]),_:1}),t(Bo,{show:e(r),"onUpdate:show":c[6]||(c[6]=o=>Xe(r)?r.value=o:null),"form-data":e(O),"service-definition-id":e(K),mode:e(m),"proxy-config-id":p.proxyConfigId,onRefresh:F},null,8,["show","form-data","service-definition-id","mode","proxy-config-id"]),t(an,{show:e(T),"onUpdate:show":c[7]||(c[7]=o=>Xe(T)?T.value=o:null),"service-definition-id":e(_),onRefresh:F},null,8,["show","service-definition-id"])]))}}),rn=me(sn,[["__scopeId","data-v-32afea72"]]),un={class:"proxy-test-panel"},dn={class:"card-header"},cn={style:{display:"flex","align-items":"center",width:"100%"}},pn={class:"card-header"},fn={key:0,class:"test-statistics"},vn={class:"test-results-list"},gn=de({__name:"ProxyTestPanel",props:{gatewayInstanceId:{}},setup(v){const y=v,p=xe(),i=z(null),C=z(!1),b=z(!1),f=z(!1),u=z([]),r=z([]),T=ye({proxyConfigId:"",testUrl:"http://httpbin.org/get",method:"GET",headers:{},timeout:5e3,concurrency:1}),m=z([]),O=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"HEAD",value:"HEAD"},{label:"OPTIONS",value:"OPTIONS"}],_=Q(()=>["POST","PUT","PATCH"].includes(T.method)),K=Q(()=>{if(r.value.length===0)return 0;const F=r.value.filter(U=>U.success).length;return Math.round(F/r.value.length*100)}),Y=Q(()=>{if(r.value.length===0)return 0;const F=r.value.reduce((U,c)=>U+c.responseTime,0);return Math.round(F/r.value.length)}),H=Q(()=>r.value.length===0?0:Math.min(...r.value.map(F=>F.responseTime))),M=Q(()=>r.value.length===0?0:Math.max(...r.value.map(F=>F.responseTime))),R={proxyConfigId:[{required:!0,message:"请选择代理配置",trigger:["blur","change"]}],testUrl:[{required:!0,message:"请输入测试URL",trigger:["blur","input"]},{type:"url",message:"请输入有效的URL",trigger:["blur","input"]}],method:[{required:!0,message:"请选择请求方法",trigger:["blur","change"]}],timeout:[{required:!0,message:"请输入超时时间",trigger:["blur","change"]},{type:"number",min:100,max:6e4,message:"超时时间必须在100-60000毫秒之间",trigger:["blur","change"]}]},j=[{title:"序号",key:"testIndex",width:80,align:"center"},{title:"状态",key:"success",width:100,align:"center",render:F=>I(N,{size:20,color:F.success?"#18a058":"#d03050"},()=>I(F.success?Ie:We))},{title:"状态码",key:"statusCode",width:100,align:"center"},{title:"响应时间(ms)",key:"responseTime",width:120,align:"center"},{title:"错误信息",key:"errorMessage",ellipsis:{tooltip:!0}},{title:"测试时间",key:"testTime",width:180,align:"center"}];function S(){return{key:"",value:""}}async function x(){if(y.gatewayInstanceId)try{f.value=!0;const F=await It({gatewayInstanceId:y.gatewayInstanceId,activeFlag:"Y",pageIndex:1,pageSize:100});if(F.oK){const U=JSON.parse(F.bizData);u.value=(U.records||[]).map(c=>({label:`${c.proxyName} (${c.proxyType})`,value:c.proxyConfigId}))}}catch(F){console.error("加载代理配置失败:",F),p.error("加载代理配置失败")}finally{f.value=!1}}function $(){}async function ae(){var U;await((U=i.value)==null?void 0:U.validate())&&await J(1)}async function oe(){var U;await((U=i.value)==null?void 0:U.validate())&&await J(T.concurrency)}async function J(F){const c=F>1?b:C;try{c.value=!0;const o={proxyConfigId:T.proxyConfigId,testUrl:T.testUrl,method:T.method,headers:m.value.reduce((g,d)=>(d.key.trim()&&(g[d.key.trim()]=d.value),g),{}),body:_.value?T.body:void 0,timeout:T.timeout,tenantId:"default"},s=Array.from({length:F},(g,d)=>D(o,d+1));await Promise.all(s),p.success(`测试完成，共执行 ${F} 次`)}catch(o){p.error("测试执行失败: "+(o.message||"未知错误"))}finally{c.value=!1}}async function D(F,U){try{const c=Date.now(),o=await ra(F);let s;o.oK?s=JSON.parse(o.bizData):s={success:!1,responseTime:Date.now()-c,errorMessage:o.messageId||"测试失败"},r.value.push({...s,testTime:new Date().toLocaleString(),testIndex:r.value.length+1})}catch(c){r.value.push({success:!1,responseTime:0,errorMessage:c.message||"网络错误",testTime:new Date().toLocaleString(),testIndex:r.value.length+1})}}function B(){Object.assign(T,{proxyConfigId:"",testUrl:"http://httpbin.org/get",method:"GET",body:"",timeout:5e3,concurrency:1}),m.value=[]}function X(){r.value=[]}return Ge(()=>{y.gatewayInstanceId&&x()}),(F,U)=>(P(),V("div",un,[t(e(pe),{size:"small",class:"test-config-card"},{header:l(()=>[a("div",dn,[t(e(N),{size:"20"},{default:l(()=>[t(e(ht))]),_:1}),U[7]||(U[7]=a("span",null,"代理测试配置",-1))])]),default:l(()=>[t(e(Be),{ref_key:"formRef",ref:i,model:T,rules:R,"label-placement":"left","label-width":"120px"},{default:l(()=>[t(e(De),{cols:2,"x-gap":24},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(A),{label:"代理配置",path:"proxyConfigId"},{default:l(()=>[t(e(ve),{value:T.proxyConfigId,"onUpdate:value":[U[0]||(U[0]=c=>T.proxyConfigId=c),$],placeholder:"请选择代理配置",options:u.value,loading:f.value},null,8,["value","options","loading"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"请求方法",path:"method"},{default:l(()=>[t(e(ve),{value:T.method,"onUpdate:value":U[1]||(U[1]=c=>T.method=c),options:O},null,8,["value"])]),_:1})]),_:1}),t(e(G),{span:2},{default:l(()=>[t(e(A),{label:"测试URL",path:"testUrl"},{default:l(()=>[t(e(ue),{value:T.testUrl,"onUpdate:value":U[2]||(U[2]=c=>T.testUrl=c),placeholder:"请输入测试URL，如: http://example.com/api/test"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"超时时间(ms)",path:"timeout"},{default:l(()=>[t(e(ke),{value:T.timeout,"onUpdate:value":U[3]||(U[3]=c=>T.timeout=c),min:100,max:6e4,placeholder:"请输入超时时间"},null,8,["value"])]),_:1})]),_:1}),t(e(G),null,{default:l(()=>[t(e(A),{label:"并发数量",path:"concurrency"},{default:l(()=>[t(e(ke),{value:T.concurrency,"onUpdate:value":U[4]||(U[4]=c=>T.concurrency=c),min:1,max:100,placeholder:"请输入并发数量"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(e(A),{label:"请求头"},{default:l(()=>[t(e(Ct),{value:m.value,"onUpdate:value":U[5]||(U[5]=c=>m.value=c),"on-create":S},{default:l(({index:c,value:o})=>[a("div",cn,[t(e(ue),{value:o.key,"onUpdate:value":s=>o.key=s,placeholder:"Header名称",style:{"margin-right":"12px"}},null,8,["value","onUpdate:value"]),t(e(ue),{value:o.value,"onUpdate:value":s=>o.value=s,placeholder:"Header值"},null,8,["value","onUpdate:value"])])]),_:1},8,["value"])]),_:1}),_.value?(P(),Z(e(A),{key:0,label:"请求体"},{default:l(()=>[t(e(ue),{value:T.body,"onUpdate:value":U[6]||(U[6]=c=>T.body=c),type:"textarea",placeholder:"请输入请求体内容（JSON格式）",rows:4},null,8,["value"])]),_:1})):ee("",!0),t(e(A),null,{default:l(()=>[t(e(Se),null,{default:l(()=>[t(e(E),{type:"primary",loading:C.value,onClick:ae,disabled:!T.proxyConfigId},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(St))]),_:1})]),default:l(()=>[h(" "+w(C.value?"测试中...":"开始测试"),1)]),_:1},8,["loading","disabled"]),t(e(E),{type:"info",loading:b.value,onClick:oe,disabled:!T.proxyConfigId||T.concurrency<=1},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(at))]),_:1})]),default:l(()=>[h(" "+w(b.value?"批量测试中...":"批量测试"),1)]),_:1},8,["loading","disabled"]),t(e(E),{onClick:B},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Ye))]),_:1})]),default:l(()=>[U[8]||(U[8]=h(" 重置 "))]),_:1}),t(e(E),{onClick:X},{icon:l(()=>[t(e(N),null,{default:l(()=>[t(e(Fe))]),_:1})]),default:l(()=>[U[9]||(U[9]=h(" 清除结果 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(e(pe),{class:"test-results-card"},{header:l(()=>[a("div",pn,[t(e(N),{size:"20"},{default:l(()=>[t(e(Jt))]),_:1}),U[10]||(U[10]=a("span",null,"测试结果",-1)),r.value.length>0?(P(),Z(e(L),{key:0,type:"info",size:"small"},{default:l(()=>[h(" 共 "+w(r.value.length)+" 次测试 ",1)]),_:1})):ee("",!0)])]),default:l(()=>[r.value.length>0?(P(),V("div",fn,[t(e(De),{cols:4,"x-gap":16},{default:l(()=>[t(e(G),null,{default:l(()=>[t(e(Ke),{label:"成功率",value:K.value,suffix:"%"},{prefix:l(()=>[t(e(N),{color:"#18a058"},{default:l(()=>[t(e(Ie))]),_:1})]),_:1},8,["value"])]),_:1}),t(e(G),null,{default:l(()=>[t(e(Ke),{label:"平均响应时间",value:Y.value,suffix:"ms"},{prefix:l(()=>[t(e(N),{color:"#2080f0"},{default:l(()=>[t(e(nl))]),_:1})]),_:1},8,["value"])]),_:1}),t(e(G),null,{default:l(()=>[t(e(Ke),{label:"最快响应",value:H.value,suffix:"ms"},{prefix:l(()=>[t(e(N),{color:"#36ad6a"},{default:l(()=>[t(e(gt))]),_:1})]),_:1},8,["value"])]),_:1}),t(e(G),null,{default:l(()=>[t(e(Ke),{label:"最慢响应",value:M.value,suffix:"ms"},{prefix:l(()=>[t(e(N),{color:"#d03050"},{default:l(()=>[t(e(gt))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])):ee("",!0),a("div",vn,[r.value.length>0?(P(),Z(e(ut),{key:0,columns:j,data:r.value,pagination:!1,size:"small","max-height":"400px","virtual-scroll":""},null,8,["data"])):(P(),Z(e(Qe),{key:1,description:"暂无测试结果，请点击 开始测试 按钮进行测试"}))])]),_:1})]))}}),yn=me(gn,[["__scopeId","data-v-ec8be743"]]);function mn(v){const y=xe(),p=z(!1),i=z([]),C=z(0),b=z([]),f=Q(()=>{const d=i.value;return{total:d.length,active:d.filter(n=>n.activeFlag==="Y").length,inactive:d.filter(n=>n.activeFlag==="N").length,httpCount:d.filter(n=>n.proxyType==="http").length,websocketCount:d.filter(n=>n.proxyType==="websocket").length,tcpCount:d.filter(n=>n.proxyType==="tcp").length,udpCount:d.filter(n=>n.proxyType==="udp").length}}),u=ye({gatewayInstanceId:e(v),proxyName:"",proxyType:void 0,activeFlag:"Y",pageIndex:1,pageSize:10});le(()=>e(v),d=>{d?u.gatewayInstanceId!==d&&(u.gatewayInstanceId=d,u.proxyName="",u.proxyType=void 0,u.activeFlag="Y",u.pageIndex=1,b.value=[]):(i.value=[],C.value=0,b.value=[])},{immediate:!0});const r=z(!1),T=z(!1),m=z("add"),O=z({}),_=z(""),K=[{label:"HTTP",value:"http"},{label:"WebSocket",value:"websocket"},{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],Y=[{label:"全部",value:void 0},{label:"已启用",value:"Y"},{label:"已禁用",value:"N"}],H=Q(()=>b.value.length>0),M=Q(()=>({page:u.pageIndex,pageSize:u.pageSize,itemCount:C.value,showSizePicker:!0,pageSizes:[10,20,50,100],onUpdatePage:d=>{u.pageIndex=d,$()},onUpdatePageSize:d=>{u.pageSize=d,u.pageIndex=1,$()}}));function R(d){const q={http:{color:"info",label:"HTTP"},websocket:{color:"warning",label:"WebSocket"},tcp:{color:"success",label:"TCP"},udp:{color:"error",label:"UDP"}}[d]||{color:"default",label:d};return I(L,{type:q.color,size:"small"},()=>q.label)}function j(d){return I(L,{type:d==="Y"?"success":"error",size:"small"},()=>d==="Y"?"已启用":"已禁用")}function S(d){return I(Se,{size:"small"},()=>[I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"primary",quaternary:!0,onClick:()=>oe(d)},{default:()=>I(N,null,()=>I(Ze))}),default:()=>"编辑"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"info",quaternary:!0,onClick:()=>J(d.proxyConfigId)},{default:()=>I(N,null,()=>I(St))}),default:()=>"测试"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:d.activeFlag==="Y"?"warning":"success",quaternary:!0,onClick:()=>X(d)},{default:()=>I(N,null,()=>I(d.activeFlag==="Y"?Le:Ie))}),default:()=>d.activeFlag==="Y"?"禁用":"启用"}),I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"info",quaternary:!0,onClick:()=>U(d.proxyConfigId)},{default:()=>I(N,null,()=>I(wt))}),default:()=>"复制"}),I(et,{onPositiveClick:()=>D(d.proxyConfigId)},{trigger:()=>I(Ce,{trigger:"hover"},{trigger:()=>I(E,{size:"small",type:"error",quaternary:!0},{default:()=>I(N,null,()=>I(Fe))}),default:()=>"删除"}),default:()=>"确认删除这个代理配置吗？"})])}const x=[{type:"selection"},{title:"代理名称",key:"proxyName",width:180,ellipsis:{tooltip:!0}},{title:"代理类型",key:"proxyType",width:120,render:d=>R(d.proxyType)},{title:"优先级",key:"configPriority",width:100,align:"center"},{title:"状态",key:"activeFlag",width:100,align:"center",render:d=>j(d.activeFlag)},{title:"备注",key:"noteText",width:200,ellipsis:{tooltip:!0}},{title:"更新时间",key:"editTime",width:180,render:d=>new Date(d.editTime).toLocaleString()},{title:"操作",key:"actions",width:200,align:"center",render:d=>S(d)}];async function $(){if(!u.gatewayInstanceId){console.warn("gatewayInstanceId 为空，跳过加载");return}console.log("TODO: 实现代理配置加载API，实例ID:",u.gatewayInstanceId),i.value=[],C.value=0}function ae(){m.value="add",O.value={gatewayInstanceId:e(v),proxyName:"",proxyType:"http",configPriority:0,proxyConfig:{},activeFlag:"Y"},r.value=!0}function oe(d){m.value="edit",O.value={...d},r.value=!0}function J(d){_.value=d,T.value=!0}async function D(d){try{y.success("删除成功"),await $()}catch(n){console.error("删除代理配置失败:",n),y.error("删除失败")}}async function B(){if(b.value.length!==0)try{y.success(`成功删除 ${b.value.length} 个代理配置`),b.value=[],await $()}catch(d){console.error("批量删除失败:",d),y.error("批量删除失败")}}async function X(d){try{const n=d.activeFlag==="Y"?"N":"Y";y.success(`${n==="Y"?"启用":"禁用"}成功`),await $()}catch(n){console.error("状态切换失败:",n),y.error("状态切换失败")}}async function F(d){if(b.value.length!==0)try{const n=d==="Y"?"启用":"禁用";y.success(`批量${n}成功`),b.value=[],await $()}catch(n){console.error("批量操作失败:",n),y.error("批量操作失败")}}async function U(d){try{y.success("复制成功"),await $()}catch(n){console.error("复制失败:",n),y.error("复制失败")}}function c(d){b.value=d}function o(){u.pageIndex=1,$()}function s(){Object.assign(u,{gatewayInstanceId:e(v),proxyName:"",proxyType:void 0,activeFlag:"Y",pageIndex:1,pageSize:20}),$()}function g(){$()}return{loading:p,proxyList:i,totalCount:C,selectedRowKeys:b,queryParams:u,showDialog:r,showTestDialog:T,dialogMode:m,currentFormData:O,testProxyId:_,proxyTypeOptions:K,statusOptions:Y,hasSelection:H,paginationProps:M,columns:x,statistics:f,loadProxyList:$,handleAdd:ae,handleEdit:oe,handleTest:J,handleDelete:D,handleBatchDelete:B,handleToggleStatus:X,handleBatchToggle:F,handleCopy:U,handleSelectionChange:c,search:o,resetQuery:s,refresh:g}}function hn(){const v=xe(),y=z(!1),p=z([]),i=z(""),C=z(null),b=z(!1),f=z(null),u=Q(()=>i.value||""),r=Q(()=>!!i.value),T=Q(()=>p.value.map(Y=>{const H=Y.tlsEnabled==="Y"?Y.httpsPort:Y.httpPort;return{label:`${Y.instanceName||"未命名"} (${Y.bindAddress||"-"}:${H||"-"})`,value:Y.gatewayInstanceId,disabled:Y.activeFlag!=="Y"}}));function m(){b.value=!b.value}async function O(){try{y.value=!0;const Y=await oa({page:1,size:100,activeFlag:"Y"});if(Y.oK===!0&&Y.state===!0)try{const H=JSON.parse(Y.bizData||"[]");p.value=H||[],p.value.length>0&&_(p.value[0].gatewayInstanceId)}catch(H){console.error("解析网关实例数据失败:",H),v.error("解析网关实例数据失败")}else v.error(Y.errMsg||"获取网关实例列表失败")}catch(Y){console.error("加载网关实例失败:",Y),v.error("加载网关实例失败")}finally{y.value=!1}}function _(Y){i.value=Y,C.value=p.value.find(H=>H.gatewayInstanceId===Y)||null}function K(Y){f.value=Y}return{loadingInstances:y,instanceList:p,selectedInstanceId:i,selectedInstance:C,instanceDetailsVisible:b,instanceProxyType:f,gatewayInstanceId:u,hasSelectedInstance:r,instanceOptions:T,toggleInstanceDetails:m,loadGatewayInstances:O,handleInstanceChange:_,setInstanceProxyType:K}}const bn={class:"proxy-management"},xn={class:"instance-header"},Cn={class:"instance-selector"},_n={class:"select-empty"},Tn={class:"instance-content"},Sn={class:"instance-details"},wn={class:"tab-content"},kn={class:"tab-description"},In={class:"info-content"},Nn={class:"tab-content"},Pn={class:"tab-description"},On={class:"info-content"},zn={class:"proxy-selector-header"},Dn={class:"proxy-selector-content"},Un={class:"proxy-info"},$n={class:"warning-content"},En={class:"warning-content"},Rn={class:"tab-content"},Hn={class:"tab-description"},Fn={class:"info-content"},Mn=de({__name:"ProxyManagement",setup(v){const y=z("proxy"),p=z(null),i=z(null),{loadingInstances:C,selectedInstanceId:b,selectedInstance:f,instanceDetailsVisible:u,instanceProxyType:r,gatewayInstanceId:T,hasSelectedInstance:m,instanceOptions:O,toggleInstanceDetails:_,loadGatewayInstances:K,handleInstanceChange:Y,setInstanceProxyType:H}=hn(),{getProxyTypeName:M}=kt(),R=mn(T),j=()=>f.value?f.value.instanceName||"未命名":"";le(T,(c,o)=>{c!==o&&(S(),c&&Oe(()=>{x()}))},{immediate:!1});function S(){p.value=null,i.value=null,H(null),y.value="proxy"}async function x(){if(m.value)try{await R.loadProxyList(),Oe(()=>{oe()})}catch(c){console.error("加载代理数据失败:",c)}}function $(c){Y(c),y.value="proxy",Oe(()=>{ae()})}async function ae(){if(m.value){await Oe();try{y.value==="proxy"&&await x()}catch(c){console.error("刷新组件时发生错误:",c)}}}function oe(){i.value?(H(i.value.proxyType),p.value=i.value):(H(null),p.value=null)}function J(c){H(c)}function D(c){i.value=c,c?(H(c.proxyType),p.value=c):(H(null),p.value=null)}function B(c){y.value=c,setTimeout(()=>{ae()},200)}function X(){y.value==="proxy"?x():ae()}function F(c){p.value=c}function U(){p.value=null,i.value=null,y.value="proxy"}return Ge(()=>{K()}),(c,o)=>(P(),V("div",bn,[t(e(pe),{class:"instance-selector-card",size:"small"},{header:l(()=>[a("div",xn,[t(e(N),{size:"20",color:"#18a058"},{default:l(()=>[t(e(He))]),_:1}),o[5]||(o[5]=a("span",null,"网关实例选择",-1))])]),default:l(()=>[a("div",Cn,[t(e(ve),{value:e(b),"onUpdate:value":[o[0]||(o[0]=s=>Xe(b)?b.value=s:null),$],placeholder:"请选择网关实例",options:e(O),loading:e(C),filterable:"",clearable:""},{empty:l(()=>[a("div",_n,[t(e(N),{size:"16",color:"#d03050"},{default:l(()=>[t(e(Tt))]),_:1}),o[6]||(o[6]=a("span",null,"暂无可用的网关实例",-1))])]),_:1},8,["value","options","loading"]),t(e(E),{onClick:e(K),disabled:e(C)},{icon:l(()=>[t(e(N),{component:e(Ye)},null,8,["component"])]),default:l(()=>[o[7]||(o[7]=h(" 刷新列表 "))]),_:1},8,["onClick","disabled"])])]),_:1}),e(m)?(P(),Z(e(pe),{key:0,class:"instance-info-card",size:"small"},{header:l(()=>[a("div",{class:"instance-header",onClick:o[1]||(o[1]=(...s)=>e(_)&&e(_)(...s)),style:{cursor:"pointer"}},[t(e(N),{size:"20",color:"#18a058"},{default:l(()=>[t(e(He))]),_:1}),o[8]||(o[8]=a("span",null,"网关实例信息",-1)),o[9]||(o[9]=a("div",{class:"flex-spacer"},null,-1)),t(e(N),{size:"16",color:e(u)?"#18a058":"#999"},{default:l(()=>[(P(),Z(Kt(e(u)?e(rl):e(il))))]),_:1},8,["color"])])]),default:l(()=>[t(e(sl),{show:e(u)},{default:l(()=>[a("div",Tn,[a("div",Sn,[t(e(qt),{column:3,size:"small",bordered:""},{default:l(()=>[t(e(Me),{label:"实例ID"},{default:l(()=>[t(e(L),{type:"info",size:"small"},{default:l(()=>[h(w(e(b)),1)]),_:1})]),_:1}),t(e(Me),{label:"实例名称"},{default:l(()=>[t(e(L),{type:"success",size:"small"},{default:l(()=>[h(w(j()),1)]),_:1})]),_:1}),t(e(Me),{label:"状态"},{default:l(()=>{var s;return[t(e(L),{type:((s=e(f))==null?void 0:s.activeFlag)==="Y"?"success":"error",size:"small"},{default:l(()=>{var g;return[h(w(((g=e(f))==null?void 0:g.activeFlag)==="Y"?"运行中":"已停用"),1)]}),_:1},8,["type"])]}),_:1}),t(e(Me),{label:"绑定地址"},{default:l(()=>{var s;return[h(w(((s=e(f))==null?void 0:s.bindAddress)||"-"),1)]}),_:1}),t(e(Me),{label:"监听端口"},{default:l(()=>{var s,g,d;return[h(w(((s=e(f))==null?void 0:s.tlsEnabled)==="Y"?((g=e(f))==null?void 0:g.httpsPort)||"-":((d=e(f))==null?void 0:d.httpPort)||"-"),1)]}),_:1}),t(e(Me),{label:"健康状态"},{default:l(()=>{var s;return[t(e(L),{type:((s=e(f))==null?void 0:s.healthStatus)==="Y"?"success":"warning",size:"small"},{default:l(()=>{var g;return[h(w(((g=e(f))==null?void 0:g.healthStatus)==="Y"?"健康":"异常"),1)]}),_:1},8,["type"])]}),_:1})]),_:1})])])]),_:1},8,["show"])]),_:1})):ee("",!0),e(m)?(P(),Z(e(pe),{key:1,class:"main-content"},{default:l(()=>[t(e(it),{value:y.value,"onUpdate:value":[o[4]||(o[4]=s=>y.value=s),B],type:"segment",size:"large"},{default:l(()=>[t(e(Te),{name:"proxy",tab:"代理配置管理"},{default:l(()=>[a("div",wn,[a("div",kn,[t(e(Ve),{type:"info","show-icon":!1},{default:l(()=>[a("div",In,[t(e(N),{size:"16",color:"#2080f0"},{default:l(()=>[t(e(lt))]),_:1}),a("span",null,"当前网关实例仅支持"+w(e(M)(e(r))||"单一")+"类型的代理配置",1)])]),_:1})]),(P(),Z(Ba,{"gateway-instance-id":e(T),key:`proxy-${e(T)}`,onRefresh:X,onProxySelected:F,onProxyTypeChanged:J,onProxyConfigChanged:D},null,8,["gateway-instance-id"]))])]),_:1}),t(e(Te),{name:"service",tab:"服务定义管理"},{default:l(()=>[a("div",Nn,[a("div",Pn,[t(e(Ve),{type:"info","show-icon":!1},{default:l(()=>[a("div",On,[t(e(N),{size:"16",color:"#2080f0"},{default:l(()=>[t(e(lt))]),_:1}),o[10]||(o[10]=a("span",null,"服务定义管理后端服务配置，包括负载均衡策略、健康检查等，必须关联到已配置的代理",-1))])]),_:1})]),i.value?(P(),Z(e(pe),{key:0,size:"small",class:"proxy-selector-card"},{header:l(()=>[a("div",zn,[t(e(N),{size:"16",color:"#18a058"},{default:l(()=>[t(e(_t))]),_:1}),o[11]||(o[11]=a("span",null,"关联的代理配置",-1))])]),default:l(()=>[a("div",Dn,[a("div",Un,[t(e(L),{type:"success",size:"medium"},{default:l(()=>{var s;return[h(w(i.value.proxyName)+" ("+w((s=i.value.proxyType)==null?void 0:s.toUpperCase())+") ",1)]}),_:1}),t(e(L),{type:i.value.activeFlag==="Y"?"success":"error",size:"small"},{default:l(()=>[h(w(i.value.activeFlag==="Y"?"已启用":"已禁用"),1)]),_:1},8,["type"])]),t(e(E),{text:"",onClick:U},{default:l(()=>o[12]||(o[12]=[h(" 重新配置代理 ")])),_:1})])]),_:1})):(P(),Z(e(Ve),{key:1,type:"warning","show-icon":!1,class:"no-proxy-alert"},{default:l(()=>[a("div",$n,[t(e(N),{size:"16",color:"#f0a020"},{default:l(()=>[t(e(yt))]),_:1}),o[14]||(o[14]=a("span",null,'请先在"代理配置管理"中创建代理配置，服务定义必须关联到代理配置',-1)),t(e(E),{size:"small",onClick:o[2]||(o[2]=s=>y.value="proxy")},{default:l(()=>o[13]||(o[13]=[h(" 去配置代理 ")])),_:1})])]),_:1})),i.value&&i.value.activeFlag==="Y"?(P(),Z(rn,{"proxy-config-id":i.value.proxyConfigId,key:`service-${e(T)}-${i.value.proxyConfigId}`,onRefresh:X},null,8,["proxy-config-id"])):i.value&&i.value.activeFlag==="N"?(P(),Z(e(Ve),{key:3,type:"warning","show-icon":!1,class:"disabled-proxy-alert"},{default:l(()=>[a("div",En,[t(e(N),{size:"16",color:"#f0a020"},{default:l(()=>[t(e(yt))]),_:1}),o[16]||(o[16]=a("span",null,"当前代理配置已被禁用，请先启用代理配置后再管理服务定义",-1)),t(e(E),{size:"small",onClick:o[3]||(o[3]=s=>y.value="proxy")},{default:l(()=>o[15]||(o[15]=[h(" 去启用代理 ")])),_:1})])]),_:1})):ee("",!0)])]),_:1}),t(e(Te),{name:"test",tab:"代理测试"},{default:l(()=>[a("div",Rn,[a("div",Hn,[t(e(Ve),{type:"info","show-icon":!1},{default:l(()=>[a("div",Fn,[t(e(N),{size:"16",color:"#2080f0"},{default:l(()=>[t(e(lt))]),_:1}),a("span",null,"代理测试工具可以验证代理配置是否正常工作，支持"+w(e(M)(e(r))||"各种协议")+"的请求测试",1)])]),_:1})]),(P(),Z(yn,{"gateway-instance-id":e(T),key:`test-${e(T)}`},null,8,["gateway-instance-id"]))])]),_:1})]),_:1},8,["value"])]),_:1})):(P(),Z(e(pe),{key:2,class:"empty-state-card"},{default:l(()=>[t(e(Qe),{description:"请先选择网关实例以开始管理代理配置"},{icon:l(()=>[t(e(N),{size:"60",color:"#d0d0d0"},{default:l(()=>[t(e(He))]),_:1})]),extra:l(()=>[t(e(E),{onClick:e(K),loading:e(C)},{default:l(()=>o[17]||(o[17]=[h(" 重新加载网关实例 ")])),_:1},8,["onClick","loading"])]),_:1})]),_:1}))]))}}),Cs=me(Mn,[["__scopeId","data-v-c4a68567"]]);export{Cs as default};

import{G as X}from"./GDataFormModal-B5dffEod.js";import{c as ne,G as se,S as re,d as Te}from"./SearchForm-C0DQDEEE.js";import{G as oe}from"./GModal-xYfXS7HF.js";import{G as ue}from"./GPane-w_mkAzRd.js";import{r as k,aa as z,T as w,ag as de,d3 as Ae,af as Se,m as H,z as M,A as _,B as S,d4 as ce,d5 as R,d as Q,a7 as E,g as fe,w as D,e as h,o as Z,f as ge,b as F,am as G,aO as J,K as q,t as W,cr as ee,_ as te,G as xe,c as we,j as Ce,M as Ie,d6 as Pe,d7 as ke,ct as ae}from"./index-DVVs4J_g.js";import{N as Oe}from"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-rwsE82tp.js";import{u as pe}from"./useGDialog-DWN8tM1R.js";import{A as he}from"./AddOutline-D7WMths6.js";import{C as ye}from"./CreateOutline-DNze2007.js";import{T as be}from"./TrashOutline-dLMtYZFW.js";import{N as j}from"./DynamicTags-DDVxZ8sR.js";import{N as ie}from"./Select-DNy4pOft.js";import{W as ve}from"./WarningOutline-CPh7mSpG.js";import{N as le}from"./Alert-Dd2hqmvx.js";function De(u){const d=k(!1),t=k([]),n=k(),m={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:he,type:"primary",tooltip:"新建User-Agent访问控制配置"},{key:"edit",label:"编辑",icon:ye,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},y=(f,c)=>A=>{const v=A[f]||[];return w(j,{value:v,"onUpdate:value":e=>{A[f]=e},inputProps:{placeholder:c}})},p=[{field:"useragentAccessConfigId",label:"User-Agent访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:f=>w(de,{trigger:"hover",placement:"top"},{trigger:()=>w("div",{style:"width: 100%;"},[w(ie,{value:f.defaultPolicy,"onUpdate:value":c=>{f.defaultPolicy=c},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>w("div",{style:"max-width: 320px; line-height: 1.5;"},[w("p",{style:"margin: 0 0 8px 0;"},[w("strong","默认策略说明：")]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的User-Agent会被拒绝"]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的User-Agent才被允许"]),w("p",{style:"margin: 0; color: #f0a020;"},[w("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的User-Agent都会被拒绝"])])})},{field:"blockEmptyUserAgent",label:"阻止空User-Agent",type:"switch",span:12,defaultValue:"N",tips:"阻止没有User-Agent头的请求",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistPatterns",label:"User-Agent白名单",type:"custom",span:24,defaultValue:[],tips:"支持正则表达式匹配，如：Mozilla/.*Chrome.*，白名单中的User-Agent将被允许访问",render:y("whitelistPatterns","输入允许的User-Agent模式，如：Mozilla/.*Chrome.*"),rules:[{validator:(f,c)=>{if(!c||c.length===0)return!0;const A=Ae(c);return A.valid?!0:new Error(`无效的正则表达式：${A.invalidPatterns.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistPatterns",label:"User-Agent黑名单",type:"custom",span:24,defaultValue:[],tips:"支持正则表达式匹配，优先级高于白名单，黑名单中的User-Agent会被直接拒绝访问",render:y("blacklistPatterns","输入禁止的User-Agent模式，如：.*Bot.*"),rules:[{validator:(f,c)=>{if(!c||c.length===0)return!0;const A=Ae(c);return A.valid?!0:new Error(`无效的正则表达式：${A.invalidPatterns.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:u,loading:d,configList:t,pageInfo:n,searchFormConfig:m,formFields:p,gridConfig:{columns:[{field:"useragentAccessConfigId",title:"User-Agent访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"whitelistPatterns",title:"User-Agent白名单",align:"left",width:300,showOverflow:!0},{field:"blacklistPatterns",title:"User-Agent黑名单",align:"left",width:300,showOverflow:!0},{field:"blockEmptyUserAgent",title:"阻止空User-Agent",align:"center",width:150,slots:{default:"blockEmptyUserAgent"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?z(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?z(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},setConfigList:f=>{t.value=f},updatePagination:f=>{n.value?Object.assign(n.value,f):n.value=f},resetPagination:()=>{n.value=void 0},addConfigToList:f=>{t.value.unshift(f)},updateConfigInList:f=>{const c=t.value.findIndex(A=>A.useragentAccessConfigId===f.useragentAccessConfigId);c!==-1&&Object.assign(t.value[c],f)},removeConfigFromList:f=>{const c=t.value.findIndex(A=>A.useragentAccessConfigId===f);c!==-1&&t.value.splice(c,1)}}}const L=Se("/gateway/hubcommon002");async function Fe(u){return L.post("/ip-access/add",u)}async function Me(u){return L.post("/ip-access/get",u)}async function Le(u){return L.post("/ip-access/update",u)}async function Ve(u){return L.post("/ip-access/delete",u)}async function Ke(u){return L.post("/ip-access/query",u)}async function _e(u){return L.post("/useragent-access/add",u)}async function Ue(u){return L.post("/useragent-access/get",u)}async function Ne(u){return L.post("/useragent-access/update",u)}async function Ee(u){return L.post("/useragent-access/delete",u)}async function Ye(u){return L.post("/useragent-access/query",u)}async function He(u){return L.post("/api-access/add",u)}async function Re(u){return L.post("/api-access/get",u)}async function Je(u){return L.post("/api-access/update",u)}async function qe(u){return L.post("/api-access/delete",u)}async function We(u){return L.post("/api-access/query",u)}async function Be(u){return L.post("/domain-access/add",u)}async function je(u){return L.post("/domain-access/get",u)}async function ze(u){return L.post("/domain-access/update",u)}async function Ge(u){return L.post("/domain-access/delete",u)}async function $e(u){return L.post("/domain-access/query",u)}async function Xe(u){return L.post("/cors/add",u)}async function Qe(u){return L.post("/cors/update",u)}async function Ze(u){return L.post("/cors/query",u)}async function et(u){return L.post("/auth/add",u)}async function tt(u){return L.post("/auth/update",u)}async function at(u){return L.post("/auth/query",u)}async function lt(u){return L.post("/rate-limit/add",u)}async function it(u){return L.post("/rate-limit/update",u)}async function nt(u){return L.post("/rate-limit/query",u)}function st(u,d,t){const n=H(),m=pe(),y=De(u),{loading:p,configList:l,pageInfo:a,setConfigList:b,updatePagination:o,addConfigToList:g,updateConfigInList:i,removeConfigFromList:r}=y,f=async O=>{var I,P,x;p.value=!0;try{let U=O;!U&&((I=t==null?void 0:t.value)!=null&&I.getFormData)&&(U=t.value.getFormData()||{});const N=U?Object.fromEntries(Object.entries(U).filter(([,V])=>V!==""&&V!==null&&V!==void 0)):{},B={...N,...ne((P=a.value)==null?void 0:P.pageIndex,(x=a.value)==null?void 0:x.pageSize)};if(d!=null&&d.value)B.securityConfigId=d.value;else if(!N.securityConfigId){n.error("securityConfigId不能为空");return}const Y=await Ye(B);if(M(Y)){const V=_(Y,[]);b(V);const K=ce(Y);K&&Object.keys(K).length>0&&o(K)}else n.error(S(Y,"查询User-Agent访问控制配置列表失败"))}catch{n.error("加载User-Agent访问控制配置列表失败")}finally{p.value=!1}};return{model:y,loadConfigs:f,handleSearch:async O=>{y.resetPagination(),await f(O)},handleReset:async()=>{y.resetPagination(),await f()},handlePageChange:async({currentPage:O,pageSize:I})=>{o({pageIndex:O,pageSize:I}),await f()},handleRefresh:async()=>{await f()},addConfig:async O=>{p.value=!0;try{const I=await _e(O);if(M(I)){n.success(S(I,"新增User-Agent访问控制配置成功"));const P=_(I,null);return P?g(P):await f(),!0}else return n.error(S(I,"新增User-Agent访问控制配置失败")),!1}catch{return n.error("新增User-Agent访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async O=>{p.value=!0;try{const I=await Ne(O);if(M(I)){n.success(S(I,"编辑User-Agent访问控制配置成功"));const P=_(I,null);return P?i(P):await f(),!0}else return n.error(S(I,"编辑User-Agent访问控制配置失败")),!1}catch{return n.error("编辑User-Agent访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async O=>{if(!await m.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除User-Agent访问控制配置 "${O.configName}" 吗？`,icon:ve,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const P=await Ee({useragentAccessConfigId:O.useragentAccessConfigId,tenantId:O.tenantId});return M(P)?(n.success(S(P,"删除User-Agent访问控制配置成功")),r(O.useragentAccessConfigId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(o({pageIndex:a.value.pageIndex-1}),await f()),!0):(n.error(S(P,"删除User-Agent访问控制配置失败")),!1)}catch{return n.error("删除User-Agent访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async O=>{try{const I=await Ue({useragentAccessConfigId:O});return M(I)?_(I,{}):(n.error(S(I,"获取User-Agent访问控制配置详情失败")),null)}catch{return n.error("获取User-Agent访问控制配置详情失败"),null}}}}function rt(u,d,t,n){const m=H(),y=st(u.value,t,n),p=k(!1),l=k("create"),a=k(null),b=e=>({...e,whitelistPatterns:R(e.whitelistPatterns),blacklistPatterns:R(e.blacklistPatterns)}),o=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.useragentAccessConfigId)try{const s=await y.getConfigDetail(e.useragentAccessConfigId);if(s){l.value="edit",a.value=b(s),p.value=!0;return}}catch{}l.value="edit",a.value=b(e),p.value=!0},i=()=>{p.value=!1,a.value=null},r=async e=>{if(e.useragentAccessConfigId)try{const s=await y.getConfigDetail(e.useragentAccessConfigId);if(s){l.value="view",a.value=b(s),p.value=!0;return}}catch{}l.value="view",a.value=b(e),p.value=!0};return{service:y,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:o,openEditDialog:g,openViewDialog:r,closeFormDialog:i,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistPatterns:Array.isArray(e.whitelistPatterns)?JSON.stringify(e.whitelistPatterns):e.whitelistPatterns,blacklistPatterns:Array.isArray(e.blacklistPatterns)?JSON.stringify(e.blacklistPatterns):e.blacklistPatterns};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){m.error("安全配置ID不能为空");return}s.securityConfigId=T,await y.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await y.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){m.warning("请先选择安全配置");return}o(T);break;case"edit":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要编辑的配置");return}g(C);break}case"delete":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要删除的配置");return}await y.deleteConfig(C);break}case"search":{await y.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":r(s);break;case"edit":g(s);break;case"delete":await y.deleteConfig(s);break}},handleSearch:async e=>{await y.handleSearch(e)}}}const ot={class:"useragent-access-config-list-modal",id:"useragent-access-config-list-modal"},ut=Q({name:"UserAgentAccessConfigListModal",__name:"UserAgentAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"User-Agent访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(),y=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:b,formDialogVisible:o,formDialogMode:g,currentEditConfig:i,handleFormSubmit:r,handleToolbarClick:f,handleMenuClick:c,handleSearch:A}=rt(p,y,a,m),v=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(o.value=!1,g.value="create",i.value=null,b.model.configList.value=[],b.model.resetPagination())};return(s,T)=>(Z(),fe(h(oe),{visible:l.value,title:t.title||"User-Agent访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":v,onAfterLeave:e},{default:D(()=>[ge("div",ot,[F(h(ue),{direction:"vertical","no-resize":!0},{1:D(()=>[F(re,G({ref_key:"searchFormRef",ref:m,"module-id":h(b).model.moduleId},h(b).model.searchFormConfig,{onSearch:h(A),onToolbarClick:h(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:D(()=>[F(h(se),G({ref_key:"gridRef",ref:y,"module-id":h(b).model.moduleId,data:h(b).model.configList,loading:h(b).model.loading},h(b).model.gridConfig,{onPageChange:h(b).handlePageChange,onMenuClick:h(c)}),{defaultPolicy:D(({row:C})=>[F(h(J),{type:C.defaultPolicy==="allow"?"success":"error",size:"small"},{default:D(()=>[q(W(C.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:D(({row:C})=>[F(h(J),{type:C.activeFlag==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),blockEmptyUserAgent:D(({row:C})=>[F(h(J),{type:C.blockEmptyUserAgent==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.blockEmptyUserAgent==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),F(X,{visible:h(o),"onUpdate:visible":T[0]||(T[0]=C=>ee(o)?o.value=C:null),mode:h(g),title:h(g)==="create"?"新增User-Agent访问控制配置":h(g)==="edit"?"编辑User-Agent访问控制配置":"查看User-Agent访问控制配置详情",to:"#useragent-access-config-list-modal","form-fields":h(b).model.formFields,"initial-data":h(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(b).model.loading.value,onSubmit:h(r)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),ea=te(ut,[["__scopeId","data-v-d692cd6b"]]);function dt(u){const d=k(!1),t=k([]),n=k(),m={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:he,type:"primary",tooltip:"新建API访问控制配置"},{key:"edit",label:"编辑",icon:ye,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},y=(c,A)=>v=>{const e=v[c]||[];return w(j,{value:e,"onUpdate:value":s=>{v[c]=s},inputProps:{placeholder:A}})},p=(c,A)=>v=>{const e=v[c]||[];return w(j,{value:e,"onUpdate:value":s=>{v[c]=s},inputProps:{placeholder:A}})},l=[{field:"apiAccessConfigId",label:"API访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:c=>w(de,{trigger:"hover",placement:"top"},{trigger:()=>w("div",{style:"width: 100%;"},[w(ie,{value:c.defaultPolicy,"onUpdate:value":A=>{c.defaultPolicy=A},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>w("div",{style:"max-width: 320px; line-height: 1.5;"},[w("p",{style:"margin: 0 0 8px 0;"},[w("strong","默认策略说明：")]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的API路径会被拒绝"]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的API路径才被允许"]),w("p",{style:"margin: 0; color: #f0a020;"},[w("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的API路径都会被拒绝"])])})}]},{field:"pathConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistPaths",label:"API路径白名单",type:"custom",span:12,defaultValue:[],tips:"支持通配符匹配，如：/api/v1/*",render:y("whitelistPaths","输入允许的API路径，如：/api/v1/*")},{field:"blacklistPaths",label:"API路径黑名单",type:"custom",span:12,defaultValue:[],tips:"支持通配符匹配，优先级高于白名单",render:y("blacklistPaths","输入禁止的API路径，如：/api/admin/*")}]},{field:"methodConfig",label:"",type:"fieldset",span:24,children:[{field:"allowedMethods",label:"允许的HTTP方法",type:"custom",span:12,defaultValue:[],tips:"如：GET, POST, PUT, DELETE",render:p("allowedMethods","输入允许的HTTP方法，如：GET, POST")},{field:"blockedMethods",label:"禁止的HTTP方法",type:"custom",span:12,defaultValue:[],tips:"优先级高于允许的方法",render:p("blockedMethods","输入禁止的HTTP方法，如：DELETE")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:u,loading:d,configList:t,pageInfo:n,searchFormConfig:m,formFields:l,gridConfig:{columns:[{field:"apiAccessConfigId",title:"API访问配置ID",width:200,visible:!1},{field:"tenantId",title:"租户ID",width:200,visible:!1},{field:"securityConfigId",title:"安全配置ID",width:200,visible:!1},{field:"configName",title:"配置名称",width:200,showOverflow:!0},{field:"defaultPolicy",title:"默认策略",width:120,align:"center",slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"活动状态",width:100,align:"center",slots:{default:"activeFlag"}},{field:"whitelistPaths",title:"路径白名单",width:200,showOverflow:!0},{field:"blacklistPaths",title:"路径黑名单",width:200,showOverflow:!0},{field:"allowedMethods",title:"允许的方法",width:150,showOverflow:!0},{field:"blockedMethods",title:"禁止的方法",width:150,showOverflow:!0},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:c})=>c?z(c,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:c})=>c?z(c,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",width:120}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},resetPagination:()=>{n.value=void 0},updatePagination:c=>{n.value?Object.assign(n.value,c):n.value=c},setConfigList:c=>{t.value=c},addConfigToList:c=>{t.value.push(c)},updateConfigInList:(c,A,v)=>{const e=t.value.findIndex(s=>s.apiAccessConfigId===c&&s.tenantId===A);e!==-1&&Object.assign(t.value[e],v)},removeConfigFromList:(c,A)=>{const v=t.value.findIndex(e=>e.apiAccessConfigId===c&&e.tenantId===A);v!==-1&&t.value.splice(v,1)}}}function ct(u,d,t){const n=H(),m=pe(),y=dt(u),{loading:p,configList:l,pageInfo:a,setConfigList:b,updatePagination:o,addConfigToList:g,updateConfigInList:i,removeConfigFromList:r,resetPagination:f}=y,c=async I=>{var P,x,U;p.value=!0;try{let N=I;!N&&((P=t==null?void 0:t.value)!=null&&P.getFormData)&&(N=t.value.getFormData()||{});const B=N?Object.fromEntries(Object.entries(N).filter(([,K])=>K!==""&&K!==null&&K!==void 0)):{},Y={...B,...ne((x=a.value)==null?void 0:x.pageIndex,(U=a.value)==null?void 0:U.pageSize)};if(d!=null&&d.value)Y.securityConfigId=d.value;else if(!B.securityConfigId){n.error("securityConfigId不能为空");return}const V=await We(Y);if(M(V)){const K=_(V,[]);b(K);const $=ce(V);$&&Object.keys($).length>0&&o($)}else n.error(S(V,"查询API访问控制配置列表失败"))}catch{n.error("加载API访问控制配置列表失败")}finally{p.value=!1}};return{model:y,loadConfigs:c,handleSearch:async I=>{f(),await c(I)},handleReset:async()=>{f(),await c()},handlePageChange:async({currentPage:I,pageSize:P})=>{o({pageIndex:I,pageSize:P}),await c()},handleRefresh:async()=>{await c()},addConfig:async I=>{p.value=!0;try{const P=await He(I);if(M(P)){n.success(S(P,"新增API访问控制配置成功"));const x=_(P,null);return x?g(x):await c(),!0}else return n.error(S(P,"新增API访问控制配置失败")),!1}catch{return n.error("新增API访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async I=>{p.value=!0;try{const P=await Je(I);if(M(P)){n.success(S(P,"编辑API访问控制配置成功"));const x=_(P,null);return x?i(x.apiAccessConfigId,x.tenantId,x):await c(),!0}else return n.error(S(P,"编辑API访问控制配置失败")),!1}catch{return n.error("编辑API访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async I=>{if(!await m.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除API访问控制配置 "${I.configName}" 吗？`,icon:ve,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const x=await qe({apiAccessConfigId:I.apiAccessConfigId,tenantId:I.tenantId});return M(x)?(n.success(S(x,"删除API访问控制配置成功")),r(I.apiAccessConfigId,I.tenantId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(o({pageIndex:a.value.pageIndex-1}),await c()),!0):(n.error(S(x,"删除API访问控制配置失败")),!1)}catch{return n.error("删除API访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async I=>{try{const P=await Re({apiAccessConfigId:I});return M(P)?_(P,{}):(n.error(S(P,"获取API访问控制配置详情失败")),null)}catch{return n.error("获取API访问控制配置详情失败"),null}}}}function ft(u,d,t,n){const m=H(),y=ct(u.value,t,n),p=k(!1),l=k("create"),a=k(null),b=e=>({...e,whitelistPaths:R(e.whitelistPaths),blacklistPaths:R(e.blacklistPaths),allowedMethods:R(e.allowedMethods),blockedMethods:R(e.blockedMethods)}),o=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.apiAccessConfigId)try{const s=await y.getConfigDetail(e.apiAccessConfigId);if(s){l.value="edit",a.value=b(s),p.value=!0;return}}catch{}l.value="edit",a.value=b(e),p.value=!0},i=()=>{p.value=!1,a.value=null},r=async e=>{if(e.apiAccessConfigId)try{const s=await y.getConfigDetail(e.apiAccessConfigId);if(s){l.value="view",a.value=b(s),p.value=!0;return}}catch{}l.value="view",a.value=b(e),p.value=!0};return{service:y,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:o,openEditDialog:g,openViewDialog:r,closeFormDialog:i,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistPaths:Array.isArray(e.whitelistPaths)?JSON.stringify(e.whitelistPaths):e.whitelistPaths,blacklistPaths:Array.isArray(e.blacklistPaths)?JSON.stringify(e.blacklistPaths):e.blacklistPaths,allowedMethods:Array.isArray(e.allowedMethods)?JSON.stringify(e.allowedMethods):e.allowedMethods,blockedMethods:Array.isArray(e.blockedMethods)?JSON.stringify(e.blockedMethods):e.blockedMethods};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){m.error("安全配置ID不能为空");return}s.securityConfigId=T,await y.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await y.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){m.warning("请先选择安全配置");return}o(T);break;case"edit":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要编辑的配置");return}g(C);break}case"delete":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要删除的配置");return}await y.deleteConfig(C);break}case"search":{await y.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":r(s);break;case"edit":g(s);break;case"delete":await y.deleteConfig(s);break}},handleSearch:async e=>{await y.handleSearch(e)}}}const gt={class:"api-access-config-list-modal",id:"api-access-config-list-modal"},pt=Q({name:"ApiAccessConfigListModal",__name:"ApiAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"API访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(),y=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s}),E(()=>t.moduleId,s=>{p.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:b,formDialogVisible:o,formDialogMode:g,currentEditConfig:i,handleFormSubmit:r,handleToolbarClick:f,handleMenuClick:c,handleSearch:A}=ft(p,y,a,m),v=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(o.value=!1,g.value="create",i.value=null,b.model.configList.value=[],b.model.resetPagination())};return(s,T)=>(Z(),fe(h(oe),{visible:l.value,title:t.title||"API访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":v,onAfterLeave:e},{default:D(()=>[ge("div",gt,[F(h(ue),{direction:"vertical","no-resize":!0},{1:D(()=>[F(re,G({ref_key:"searchFormRef",ref:m,"module-id":h(b).model.moduleId},h(b).model.searchFormConfig,{onSearch:h(A),onToolbarClick:h(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:D(()=>[F(h(se),G({ref_key:"gridRef",ref:y,"module-id":h(b).model.moduleId,data:h(b).model.configList,loading:h(b).model.loading},h(b).model.gridConfig,{onPageChange:h(b).handlePageChange,onMenuClick:h(c)}),{defaultPolicy:D(({row:C})=>[F(h(J),{type:C.defaultPolicy==="allow"?"success":"error",size:"small"},{default:D(()=>[q(W(C.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:D(({row:C})=>[F(h(J),{type:C.activeFlag==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),F(X,{visible:h(o),"onUpdate:visible":T[0]||(T[0]=C=>ee(o)?o.value=C:null),mode:h(g),title:h(g)==="create"?"新增API访问控制配置":h(g)==="edit"?"编辑API访问控制配置":"查看API访问控制配置详情",to:"#api-access-config-list-modal","form-fields":h(b).model.formFields,"initial-data":h(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(b).model.loading.value,onSubmit:h(r)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),ta=te(pt,[["__scopeId","data-v-ffd5e83d"]]);function ht(u){const d=k(!1),t=(o,g)=>i=>{const r=i[o]||[];return w(j,{value:r,"onUpdate:value":f=>{i[o]=f},inputProps:{placeholder:g}})},n=[{label:"JWT认证",value:"JWT"},{label:"API Key认证",value:"API_KEY"},{label:"OAuth2认证",value:"OAUTH2"},{label:"Basic认证",value:"BASIC"}],m=[{label:"必需认证",value:"REQUIRED"},{label:"可选认证",value:"OPTIONAL"},{label:"禁用认证",value:"DISABLED"}],y=[{label:"HS256",value:"HS256"},{label:"HS384",value:"HS384"},{label:"HS512",value:"HS512"},{label:"RS256",value:"RS256"},{label:"RS384",value:"RS384"},{label:"RS512",value:"RS512"}],p=[{label:"Header",value:"header"},{label:"Query参数",value:"query"}],l=(o,g,i)=>r=>{const f=`authConfig.${o}`,c=r[f];return g==="input"?w(xe,{value:c||"",type:(i==null?void 0:i.type)||"text",placeholder:(i==null?void 0:i.placeholder)||"","onUpdate:value":A=>{r[f]=A}}):g==="select"?w(ie,{value:c||(i==null?void 0:i.defaultValue)||"",options:(i==null?void 0:i.options)||[],placeholder:(i==null?void 0:i.placeholder)||"","onUpdate:value":A=>{r[f]=A}}):g==="number"?w(Te,{value:c??(i==null?void 0:i.defaultValue)??0,min:i==null?void 0:i.min,max:i==null?void 0:i.max,placeholder:(i==null?void 0:i.placeholder)||"",style:"width: 100%;","onUpdate:value":A=>{r[f]=A??(i==null?void 0:i.defaultValue)??0}}):g==="switch"?w(Oe,{value:c??(i==null?void 0:i.defaultValue)??!1,"onUpdate:value":A=>{r[f]=A}}):g==="tags"?w(j,{value:c||[],"onUpdate:value":A=>{r[f]=A},inputProps:{placeholder:(i==null?void 0:i.placeholder)||""}}):w("div")},a=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],b=[{field:"authConfigId",label:"认证配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"authName",label:"认证配置名称",type:"input",placeholder:"请输入认证配置名称",span:12,required:!0,defaultValue:"认证配置",tabKey:"basic"},{field:"authType",label:"认证类型",type:"select",span:12,required:!0,defaultValue:"JWT",tabKey:"basic",props:{options:n,placeholder:"选择认证类型"},tips:"支持JWT、API Key、OAuth2、Basic认证"},{field:"authStrategy",label:"认证策略",type:"select",span:12,required:!0,defaultValue:"REQUIRED",tabKey:"basic",props:{options:m,placeholder:"选择认证策略"},tips:"必需：必须认证才能访问；可选：可以认证但不强制；禁用：不进行认证"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"failureStatusCode",label:"失败状态码",type:"number",placeholder:"认证失败HTTP状态码",span:12,defaultValue:401,tabKey:"basic",props:{min:400,max:599},tips:"认证失败时返回的HTTP状态码"},{field:"failureMessage",label:"失败提示消息",type:"input",placeholder:"认证失败提示消息",span:12,defaultValue:"认证失败",tabKey:"basic",tips:"认证失败时返回的错误消息"}]},{field:"authConfigDetails",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"authConfig.secret",label:"JWT密钥",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",required:!0,tips:"JWT签名密钥，用于验证和生成Token",render:l("secret","input",{type:"password",placeholder:"JWT签名密钥"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="JWT"){const r=i["authConfig.secret"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("JWT密钥不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.algorithm",label:"签名算法",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",required:!0,tips:"JWT签名算法，如HS256、RS256等",render:l("algorithm","select",{options:y,defaultValue:"HS256",placeholder:"选择签名算法"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="JWT"){const r=i["authConfig.algorithm"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("签名算法不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.issuer",label:"签发者(Issuer)",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",tips:"JWT签发者标识，可选",render:l("issuer","input",{placeholder:"JWT签发者"})},{field:"authConfig.expiration",label:"过期时间(秒)",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",defaultValue:3600,tips:"Token过期时间，默认3600秒",render:l("expiration","number",{min:60,max:86400,defaultValue:3600,placeholder:"Token过期时间"})},{field:"authConfig.verifyExpiration",label:"验证过期时间",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",tips:"是否验证Token过期时间",render:l("verifyExpiration","switch",{defaultValue:!0})},{field:"authConfig.verifyIssuer",label:"验证签发者",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",tips:"是否验证Token签发者",render:l("verifyIssuer","switch",{defaultValue:!1})},{field:"authConfig.refreshWindow",label:"刷新窗口(秒)",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",defaultValue:300,tips:"过期前多少秒可以刷新Token",render:l("refreshWindow","number",{min:0,max:3600,defaultValue:300,placeholder:"过期前多少秒可刷新"})},{field:"authConfig.includeInResponse",label:"响应包含Token",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",tips:"是否在响应头中包含生成的Token",render:l("includeInResponse","switch",{defaultValue:!1})},{field:"authConfig.responseHeaderName",label:"响应头名称",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="JWT",defaultValue:"X-Auth-Token",tips:"响应头中Token的字段名",render:l("responseHeaderName","input",{placeholder:"X-Auth-Token",defaultValue:"X-Auth-Token"})},{field:"authConfig.keyLocation",label:"API Key位置",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="API_KEY",required:!0,tips:"API Key的获取位置，Header或Query参数",render:l("keyLocation","select",{options:p,defaultValue:"header",placeholder:"API Key获取位置"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="API_KEY"){const r=i["authConfig.keyLocation"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("API Key位置不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.keyName",label:"参数名称",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="API_KEY",required:!0,tips:"API Key的参数名称，如X-API-Key",render:l("keyName","input",{placeholder:"api_key",defaultValue:"X-API-Key"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="API_KEY"){const r=i["authConfig.keyName"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("参数名称不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.validKeys",label:"有效API Keys",type:"custom",span:24,tabKey:"basic",show:o=>o.authType==="API_KEY",required:!0,tips:"允许访问的API Key列表，至少配置一个",render:l("validKeys","tags",{placeholder:"输入API Key"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="API_KEY"){const r=i["authConfig.validKeys"];if(!r||!Array.isArray(r)||r.length===0)return new Error("至少需要配置一个有效API Key")}return!0},trigger:["blur","change"]}]},{field:"authConfig.tokenEndpoint",label:"Token端点URL",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="OAUTH2",required:!0,tips:"OAuth2 Token获取端点URL",render:l("tokenEndpoint","input",{placeholder:"https://auth.example.com/oauth/token"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="OAUTH2"){const r=i["authConfig.tokenEndpoint"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("Token端点URL不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.introspectEndpoint",label:"内省端点URL",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="OAUTH2",tips:"OAuth2 Token内省端点URL，可选",render:l("introspectEndpoint","input",{placeholder:"https://auth.example.com/oauth/introspect"})},{field:"authConfig.clientID",label:"Client ID",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="OAUTH2",required:!0,tips:"OAuth2客户端ID",render:l("clientID","input",{placeholder:"客户端ID"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="OAUTH2"){const r=i["authConfig.clientID"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("Client ID不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.clientSecret",label:"Client Secret",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="OAUTH2",required:!0,tips:"OAuth2客户端密钥",render:l("clientSecret","input",{type:"password",placeholder:"客户端密钥"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="OAUTH2"){const r=i["authConfig.clientSecret"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("Client Secret不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.scope",label:"Scope",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="OAUTH2",tips:"OAuth2授权范围，多个用空格分隔",render:l("scope","input",{placeholder:"read write"})},{field:"authConfig.username",label:"用户名",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="BASIC",required:!0,tips:"Basic认证用户名",render:l("username","input",{placeholder:"认证用户名"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="BASIC"){const r=i["authConfig.username"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("用户名不能为空")}return!0},trigger:["blur","change"]}]},{field:"authConfig.password",label:"密码",type:"custom",span:12,tabKey:"basic",show:o=>o.authType==="BASIC",required:!0,tips:"Basic认证密码",render:l("password","input",{type:"password",placeholder:"认证密码"}),rules:[{validator:(o,g)=>{const i=o.source||{};if(i.authType==="BASIC"){const r=i["authConfig.password"];if(!r||typeof r=="string"&&r.trim()==="")return new Error("密码不能为空")}return!0},trigger:["blur","change"]}]}]},{field:"exemptConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"exemptPaths",label:"豁免路径",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"支持通配符，如：/public/*, /health, /api/v1/status",render:t("exemptPaths","输入豁免路径")},{field:"exemptHeaders",label:"豁免请求头",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"包含指定请求头的请求将跳过认证",render:t("exemptHeaders","输入豁免请求头")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"}];return{moduleId:u,loading:d,formTabs:a,formFields:b}}function yt(u){const d=H(),t=ht(u),{loading:n}=t;return{model:t,getConfigDetail:async l=>{try{const a=await at(l);return M(a)?_(a,null):(d.error(S(a,"获取认证配置详情失败")),null)}catch{return d.error("获取认证配置详情失败"),null}},addConfig:async l=>{n.value=!0;try{const a=await et(l);return M(a)?(d.success(S(a,"新增认证配置成功")),!0):(d.error(S(a,"新增认证配置失败")),!1)}catch{return d.error("新增认证配置失败"),!1}finally{n.value=!1}},editConfig:async l=>{n.value=!0;try{const a=await tt(l);return M(a)?(d.success(S(a,"编辑认证配置成功")),!0):(d.error(S(a,"编辑认证配置失败")),!1)}catch{return d.error("编辑认证配置失败"),!1}finally{n.value=!1}}}}function bt(u,d){H();const t=yt(u.value),n=k(!1),m=k("create"),y=k(null),p=i=>{const r=v=>{if(typeof v=="string"&&v)try{return JSON.parse(v)}catch{return v}return v},f=v=>{if(Array.isArray(v))return v;if(typeof v=="string"&&v)try{return JSON.parse(v)}catch{return[]}return[]},c=r(i.authConfig)||{},A={...i,exemptPaths:f(i.exemptPaths),exemptHeaders:f(i.exemptHeaders)};return c&&typeof c=="object"&&Object.keys(c).forEach(v=>{A[`authConfig.${v}`]=c[v]}),A},l=i=>{const r={};Object.keys(i).forEach(c=>{if(c.startsWith("authConfig.")){const A=c.replace("authConfig.","");r[A]=i[c]}});const f={};return Object.keys(i).forEach(c=>{c.startsWith("authConfig.")||(f[c]=i[c])}),{...f,authConfig:Object.keys(r).length>0?JSON.stringify(r):"{}",exemptPaths:Array.isArray(i.exemptPaths)?JSON.stringify(i.exemptPaths):i.exemptPaths||"[]",exemptHeaders:Array.isArray(i.exemptHeaders)?JSON.stringify(i.exemptHeaders):i.exemptHeaders||"[]"}},a=async()=>{var c,A;const i=(c=d.gatewayInstanceId)==null?void 0:c.value,r=(A=d.routeConfigId)==null?void 0:A.value;if(!i&&!r)return;const f=await t.getConfigDetail({gatewayInstanceId:i,routeConfigId:r});f?(y.value=p(f),m.value="edit"):(y.value=null,m.value="create")},b=async()=>{await a(),n.value=!0},o=()=>{n.value=!1,y.value=null},g=async i=>{var f,c;if(!i||m.value==="view")return;const r=l(i);if((f=d.gatewayInstanceId)!=null&&f.value&&(r.gatewayInstanceId=d.gatewayInstanceId.value),(c=d.routeConfigId)!=null&&c.value&&(r.routeConfigId=d.routeConfigId.value),m.value==="create")await t.addConfig(r)&&await a();else if(m.value==="edit"){if(!y.value)return;const A={...r,authConfigId:y.value.authConfigId,tenantId:y.value.tenantId};await t.editConfig(A)&&await a()}};return E(()=>{var i,r;return[(i=d.gatewayInstanceId)==null?void 0:i.value,(r=d.routeConfigId)==null?void 0:r.value]},()=>{n.value&&a()}),{service:t,formDialogVisible:n,formDialogMode:m,currentEditConfig:y,openDialog:b,closeFormDialog:o,handleFormSubmit:g,loadConfig:a}}const vt={class:"auth-config-form-modal",id:"auth-config-form-modal"},mt=Q({name:"AuthConfigFormModal",__name:"AuthConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(t.gatewayInstanceId),y=k(t.routeConfigId),p=k(t.moduleId),l=bt(p,{gatewayInstanceId:m,routeConfigId:y}),{service:a,formDialogVisible:b,formDialogMode:o,currentEditConfig:g,openDialog:i,closeFormDialog:r,handleFormSubmit:f}=l,c=Ce(()=>t.title?t.title:o.value==="create"?"新增认证配置":o.value==="edit"?"编辑认证配置":"查看认证配置详情");E(()=>t.visible,async v=>{v?(m.value=t.gatewayInstanceId,y.value=t.routeConfigId,b.value&&(r(),await Ie()),await i()):b.value&&r()});const A=v=>{v||(n("update:visible",!1),n("close"),n("refresh"))};return(v,e)=>(Z(),we("div",vt,[F(X,{visible:h(b),"onUpdate:visible":[e[0]||(e[0]=s=>ee(b)?b.value=s:null),A],mode:h(o),title:c.value,width:t.width||800,to:t.to||"#auth-config-form-modal","form-fields":h(a).model.formFields,"form-tabs":h(a).model.formTabs,"initial-data":h(g)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(a).model.loading.value,onSubmit:h(f)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])]))}}),aa=te(mt,[["__scopeId","data-v-688ba2ef"]]);function wt(u){const d=k(!1),t=(y,p)=>l=>{const a=l[y]||[];return w(j,{value:a,"onUpdate:value":b=>{l[y]=b},inputProps:{placeholder:p}})},n=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],m=[{field:"corsConfigId",label:"CORS配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入CORS配置名称",span:12,required:!0,defaultValue:"CORS跨域配置",tabKey:"basic"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"allowCredentials",label:"允许携带凭证",type:"switch",span:12,defaultValue:"N",tabKey:"basic",tips:"是否允许跨域请求携带Cookie、Authorization等凭证信息",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"maxAgeSeconds",label:"预检缓存时间",type:"number",placeholder:"预检请求缓存时间(秒)",span:12,defaultValue:86400,tabKey:"basic",props:{min:0,max:86400},tips:"OPTIONS预检请求的缓存时间，0表示不缓存，最大86400秒(24小时)"}]},{field:"allowOriginsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowOrigins",label:"允许的源",type:"custom",span:24,defaultValue:[],required:!0,tabKey:"basic",tips:"支持具体域名(https://example.com)、通配符(*)，建议避免使用*以提高安全性",render:t("allowOrigins","输入允许的源，如：https://example.com"),rules:[{required:!0,message:"请至少配置一个允许的源",trigger:"blur",validator:(y,p)=>!p||p.length===0?new Error("请至少配置一个允许的源"):!0}]}]},{field:"allowMethodsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowMethods",label:"允许的HTTP方法",type:"custom",span:24,defaultValue:["GET","POST","PUT","DELETE","OPTIONS"],required:!0,tabKey:"basic",tips:"常用方法：GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD",render:t("allowMethods","输入HTTP方法，如：GET, POST"),rules:[{required:!0,message:"请至少配置一个允许的HTTP方法",trigger:"blur",validator:(y,p)=>!p||p.length===0?new Error("请至少配置一个允许的HTTP方法"):!0}]}]},{field:"headersConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"allowHeaders",label:"允许的请求头",type:"custom",span:12,defaultValue:["Content-Type","Authorization","X-Requested-With"],tabKey:"basic",tips:"如：Content-Type, Authorization, X-Requested-With",render:t("allowHeaders","输入允许的请求头")},{field:"exposeHeaders",label:"暴露的响应头",type:"custom",span:12,defaultValue:[],tabKey:"basic",tips:"浏览器可以访问的自定义响应头",render:t("exposeHeaders","输入暴露的响应头")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"noteText",label:"备注",type:"textarea",span:24,disabled:!0,tabKey:"other"}];return{moduleId:u,loading:d,formTabs:n,formFields:m}}function Ct(u){const d=H(),t=wt(u),{loading:n}=t;return{model:t,getConfigDetail:async l=>{try{const a=await Ze(l);return M(a)?_(a,null):(d.error(S(a,"获取CORS配置详情失败")),null)}catch{return d.error("获取CORS配置详情失败"),null}},addConfig:async l=>{n.value=!0;try{const a=await Xe(l);return M(a)?(d.success(S(a,"新增CORS配置成功")),!0):(d.error(S(a,"新增CORS配置失败")),!1)}catch{return d.error("新增CORS配置失败"),!1}finally{n.value=!1}},editConfig:async l=>{n.value=!0;try{const a=await Qe(l);return M(a)?(d.success(S(a,"编辑CORS配置成功")),!0):(d.error(S(a,"编辑CORS配置失败")),!1)}catch{return d.error("编辑CORS配置失败"),!1}finally{n.value=!1}}}}function It(u){H();const d=Ct(u.moduleId.value),t=k(!1),n=k("create"),m=k(null),y=g=>{const i=r=>{if(Array.isArray(r))return r;if(typeof r=="string"&&r)try{return JSON.parse(r)}catch{return[]}return[]};return{...g,allowOrigins:i(g.allowOrigins),allowMethods:typeof g.allowMethods=="string"?g.allowMethods.split(",").map(r=>r.trim()).filter(r=>r):Array.isArray(g.allowMethods)?g.allowMethods:[],allowHeaders:i(g.allowHeaders),exposeHeaders:i(g.exposeHeaders)}},p=g=>({...g,allowOrigins:Array.isArray(g.allowOrigins)?JSON.stringify(g.allowOrigins):g.allowOrigins,allowMethods:Array.isArray(g.allowMethods)?g.allowMethods.join(","):g.allowMethods,allowHeaders:Array.isArray(g.allowHeaders)?JSON.stringify(g.allowHeaders):g.allowHeaders,exposeHeaders:Array.isArray(g.exposeHeaders)?JSON.stringify(g.exposeHeaders):g.exposeHeaders}),l=async()=>{var f,c;const g=(f=u.gatewayInstanceId)==null?void 0:f.value,i=(c=u.routeConfigId)==null?void 0:c.value;if(!g&&!i)return;const r=await d.getConfigDetail({gatewayInstanceId:g,routeConfigId:i});r?(m.value=y(r),n.value="edit"):(m.value=null,n.value="create")},a=async()=>{await l(),t.value=!0},b=()=>{t.value=!1,m.value=null},o=async g=>{var r,f;if(!g||n.value==="view")return;const i=p(g);if((r=u.gatewayInstanceId)!=null&&r.value&&(i.gatewayInstanceId=u.gatewayInstanceId.value),(f=u.routeConfigId)!=null&&f.value&&(i.routeConfigId=u.routeConfigId.value),n.value==="create")await d.addConfig(i)&&await l();else if(n.value==="edit"){if(!m.value)return;const c={...p(m.value),...i,corsConfigId:m.value.corsConfigId,tenantId:m.value.tenantId};await d.editConfig(c)&&await l()}};return E(()=>{var g,i;return[(g=u.gatewayInstanceId)==null?void 0:g.value,(i=u.routeConfigId)==null?void 0:i.value]},()=>{t.value&&l()}),{service:d,formDialogVisible:t,formDialogMode:n,currentEditConfig:m,openDialog:a,closeFormDialog:b,handleFormSubmit:o,loadConfig:l}}const At={class:"cors-config-form-modal",id:"cors-config-form-modal"},Pt=Q({name:"CorsConfigFormModal",__name:"CorsConfigFormModal",props:{visible:{type:Boolean,default:!1},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},moduleId:{},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(t.gatewayInstanceId),y=k(t.routeConfigId),p=k(t.moduleId),l=It({gatewayInstanceId:m,routeConfigId:y,moduleId:p}),{service:a,formDialogVisible:b,formDialogMode:o,currentEditConfig:g,openDialog:i,closeFormDialog:r,handleFormSubmit:f}=l,c=Ce(()=>t.title?t.title:o.value==="create"?"新增CORS配置":o.value==="edit"?"编辑CORS配置":"查看CORS配置详情");E(()=>t.visible,async v=>{v?(m.value=t.gatewayInstanceId,y.value=t.routeConfigId,p.value=t.moduleId,b.value&&(r(),await Ie()),await i()):b.value&&r()});const A=v=>{v||(n("update:visible",!1),n("close"),n("refresh"))};return(v,e)=>(Z(),we("div",At,[F(X,{visible:h(b),"onUpdate:visible":[e[0]||(e[0]=s=>ee(b)?b.value=s:null),A],mode:h(o),title:c.value,width:t.width||800,to:t.to||"#cors-config-form-modal","form-fields":h(a).model.formFields,"form-tabs":h(a).model.formTabs,"initial-data":h(g)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(a).model.loading.value,onSubmit:h(f)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])]))}}),la=te(Pt,[["__scopeId","data-v-03d3ceef"]]);function kt(u){const d=k(!1),t=k([]),n=k(),m={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:he,type:"primary",tooltip:"新建域名访问控制配置"},{key:"edit",label:"编辑",icon:ye,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},y=(f,c)=>A=>{const v=A[f]||[];return w(j,{value:v,"onUpdate:value":e=>{A[f]=e},inputProps:{placeholder:c}})},p=[{field:"domainAccessConfigId",label:"域名访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:f=>w(de,{trigger:"hover",placement:"top"},{trigger:()=>w("div",{style:"width: 100%;"},[w(ie,{value:f.defaultPolicy,"onUpdate:value":c=>{f.defaultPolicy=c},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>w("div",{style:"max-width: 320px; line-height: 1.5;"},[w("p",{style:"margin: 0 0 8px 0;"},[w("strong","默认策略说明：")]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的域名会被拒绝"]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的域名才被允许"]),w("p",{style:"margin: 0; color: #f0a020;"},[w("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的域名都会被拒绝"])])})},{field:"allowSubdomains",label:"允许子域名",type:"switch",span:12,defaultValue:"Y",tips:"是否允许匹配子域名（如：*.example.com）",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistDomains",label:"域名白名单",type:"custom",span:24,defaultValue:[],tips:"如：example.com, api.example.com，白名单中的域名将被允许访问",render:y("whitelistDomains","输入允许的域名，如：example.com")}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistDomains",label:"域名黑名单",type:"custom",span:24,defaultValue:[],tips:"优先级高于白名单，直接拒绝访问",render:y("blacklistDomains","输入禁止的域名，如：malicious.com")}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}];return{moduleId:u,loading:d,configList:t,pageInfo:n,searchFormConfig:m,formFields:p,gridConfig:{columns:[{field:"domainAccessConfigId",title:"域名访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"allowSubdomains",title:"允许子域名",align:"center",width:120,slots:{default:"allowSubdomains"}},{field:"whitelistDomains",title:"域名白名单",align:"left",width:300,showOverflow:!0},{field:"blacklistDomains",title:"域名黑名单",align:"left",width:300,showOverflow:!0},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?z(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:f})=>f?z(f,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},setConfigList:f=>{t.value=f},updatePagination:f=>{n.value?Object.assign(n.value,f):n.value=f},resetPagination:()=>{n.value=void 0},addConfigToList:f=>{t.value.unshift(f)},updateConfigInList:(f,c,A)=>{const v=t.value.findIndex(e=>e.domainAccessConfigId===f&&e.tenantId===c);v!==-1&&Object.assign(t.value[v],A)},removeConfigFromList:(f,c)=>{const A=t.value.findIndex(v=>v.domainAccessConfigId===f&&v.tenantId===c);A!==-1&&t.value.splice(A,1)}}}function Tt(u,d,t){const n=H(),m=pe(),y=kt(u),{loading:p,configList:l,pageInfo:a,setConfigList:b,updatePagination:o,addConfigToList:g,updateConfigInList:i,removeConfigFromList:r,resetPagination:f}=y,c=async I=>{var P,x,U;p.value=!0;try{let N=I;!N&&((P=t==null?void 0:t.value)!=null&&P.getFormData)&&(N=t.value.getFormData()||{});const B=N?Object.fromEntries(Object.entries(N).filter(([,K])=>K!==""&&K!==null&&K!==void 0)):{},Y={...B,...ne((x=a.value)==null?void 0:x.pageIndex,(U=a.value)==null?void 0:U.pageSize)};if(d!=null&&d.value)Y.securityConfigId=d.value;else if(!B.securityConfigId){n.error("securityConfigId不能为空");return}const V=await $e(Y);if(M(V)){const K=_(V,[]);b(K);const $=ce(V);$&&Object.keys($).length>0&&o($)}else n.error(S(V,"查询域名访问控制配置列表失败"))}catch{n.error("加载域名访问控制配置列表失败")}finally{p.value=!1}};return{model:y,loadConfigs:c,handleSearch:async I=>{f(),await c(I)},handleReset:async()=>{f(),await c()},handlePageChange:async({currentPage:I,pageSize:P})=>{o({pageIndex:I,pageSize:P}),await c()},handleRefresh:async()=>{await c()},addConfig:async I=>{p.value=!0;try{const P=await Be(I);if(M(P)){n.success(S(P,"新增域名访问控制配置成功"));const x=_(P,null);return x?g(x):await c(),!0}else return n.error(S(P,"新增域名访问控制配置失败")),!1}catch{return n.error("新增域名访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async I=>{p.value=!0;try{const P=await ze(I);if(M(P)){n.success(S(P,"编辑域名访问控制配置成功"));const x=_(P,null);return x?i(x.domainAccessConfigId,x.tenantId,x):await c(),!0}else return n.error(S(P,"编辑域名访问控制配置失败")),!1}catch{return n.error("编辑域名访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async I=>{if(!await m.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除域名访问控制配置 "${I.configName}" 吗？`,icon:ve,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const x=await Ge({domainAccessConfigId:I.domainAccessConfigId,tenantId:I.tenantId});return M(x)?(n.success(S(x,"删除域名访问控制配置成功")),r(I.domainAccessConfigId,I.tenantId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(o({pageIndex:a.value.pageIndex-1}),await c()),!0):(n.error(S(x,"删除域名访问控制配置失败")),!1)}catch{return n.error("删除域名访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async I=>{try{const P=await je({domainAccessConfigId:I});return M(P)?_(P,{}):(n.error(S(P,"获取域名访问控制配置详情失败")),null)}catch{return n.error("获取域名访问控制配置详情失败"),null}}}}function St(u,d,t,n){const m=H(),y=Tt(u.value,t,n),p=k(!1),l=k("create"),a=k(null),b=e=>({...e,whitelistDomains:R(e.whitelistDomains),blacklistDomains:R(e.blacklistDomains)}),o=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.domainAccessConfigId)try{const s=await y.getConfigDetail(e.domainAccessConfigId);if(s){l.value="edit",a.value=b(s),p.value=!0;return}}catch{}l.value="edit",a.value=b(e),p.value=!0},i=()=>{p.value=!1,a.value=null},r=async e=>{if(e.domainAccessConfigId)try{const s=await y.getConfigDetail(e.domainAccessConfigId);if(s){l.value="view",a.value=b(s),p.value=!0;return}}catch{}l.value="view",a.value=b(e),p.value=!0};return{service:y,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:o,openEditDialog:g,openViewDialog:r,closeFormDialog:i,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistDomains:Array.isArray(e.whitelistDomains)?JSON.stringify(e.whitelistDomains):e.whitelistDomains,blacklistDomains:Array.isArray(e.blacklistDomains)?JSON.stringify(e.blacklistDomains):e.blacklistDomains};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){m.error("安全配置ID不能为空");return}s.securityConfigId=T,await y.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await y.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){m.warning("请先选择安全配置");return}o(T);break;case"edit":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要编辑的配置");return}g(C);break}case"delete":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要删除的配置");return}await y.deleteConfig(C);break}case"search":{await y.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":r(s);break;case"edit":g(s);break;case"delete":await y.deleteConfig(s);break}},handleSearch:async e=>{await y.handleSearch(e)}}}const xt={class:"domain-access-config-list-modal",id:"domain-access-config-list-modal"},Ot=Q({name:"DomainAccessConfigListModal",__name:"DomainAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"域名访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(),y=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s}),E(()=>t.moduleId,s=>{p.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:b,formDialogVisible:o,formDialogMode:g,currentEditConfig:i,handleFormSubmit:r,handleToolbarClick:f,handleMenuClick:c,handleSearch:A}=St(p,y,a,m),v=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(o.value=!1,g.value="create",i.value=null,b.model.configList.value=[],b.model.resetPagination())};return(s,T)=>(Z(),fe(h(oe),{visible:l.value,title:t.title||"域名访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":v,onAfterLeave:e},{default:D(()=>[ge("div",xt,[F(h(ue),{direction:"vertical","no-resize":!0},{1:D(()=>[F(re,G({ref_key:"searchFormRef",ref:m,"module-id":h(b).model.moduleId},h(b).model.searchFormConfig,{onSearch:h(A),onToolbarClick:h(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:D(()=>[F(h(se),G({ref_key:"gridRef",ref:y,"module-id":h(b).model.moduleId,data:h(b).model.configList,loading:h(b).model.loading},h(b).model.gridConfig,{onPageChange:h(b).handlePageChange,onMenuClick:h(c)}),{defaultPolicy:D(({row:C})=>[F(h(J),{type:C.defaultPolicy==="allow"?"success":"error",size:"small"},{default:D(()=>[q(W(C.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:D(({row:C})=>[F(h(J),{type:C.activeFlag==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),allowSubdomains:D(({row:C})=>[F(h(J),{type:C.allowSubdomains==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.allowSubdomains==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),F(X,{visible:h(o),"onUpdate:visible":T[0]||(T[0]=C=>ee(o)?o.value=C:null),mode:h(g),title:h(g)==="create"?"新增域名访问控制配置":h(g)==="edit"?"编辑域名访问控制配置":"查看域名访问控制配置详情",to:"#domain-access-config-list-modal","form-fields":h(b).model.formFields,"initial-data":h(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(b).model.loading.value,onSubmit:h(r)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),ia=te(Ot,[["__scopeId","data-v-3cffb1cb"]]);function Dt(u){const d=k(!1),t=k([]),n=k(),m={fields:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:6,clearable:!0},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建配置",icon:he,type:"primary",tooltip:"新建IP访问控制配置"},{key:"edit",label:"编辑",icon:ye,tooltip:"编辑选中的配置"},{key:"delete",label:"删除",icon:be,type:"error",tooltip:"删除选中的配置"}],showSearchButton:!0,showResetButton:!0},y=v=>e=>{const s=e[v]||[];return w(j,{value:s,"onUpdate:value":T=>{e[v]=T},inputProps:{placeholder:"输入IP地址，如：192.168.1.100"}})},p=v=>e=>{const s=e[v]||[];return w(j,{value:s,"onUpdate:value":T=>{e[v]=T},inputProps:{placeholder:"输入CIDR网段，如：192.168.1.0/24"}})},l=[{field:"ipAccessConfigId",label:"IP访问配置ID",type:"input",span:8,show:!1},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1},{field:"securityConfigId",label:"安全配置ID",type:"input",span:8,show:!1},{field:"basicConfig",label:"",type:"fieldset",span:24,children:[{field:"configName",label:"配置名称",type:"input",placeholder:"请输入配置名称",span:12,required:!0},{field:"defaultPolicy",label:"默认策略",type:"custom",span:12,defaultValue:"allow",render:v=>w(de,{trigger:"hover",placement:"top"},{trigger:()=>w("div",{style:"width: 100%;"},[w(ie,{value:v.defaultPolicy,"onUpdate:value":e=>{v.defaultPolicy=e},placeholder:"请选择默认策略",options:[{label:"允许（白名单模式）",value:"allow"},{label:"拒绝（黑名单模式）",value:"deny"}]})]),default:()=>w("div",{style:"max-width: 320px; line-height: 1.5;"},[w("p",{style:"margin: 0 0 8px 0;"},[w("strong","默认策略说明：")]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• allow（允许）:")," 默认允许访问，只有在黑名单中的IP会被拒绝"]),w("p",{style:"margin: 0 0 8px 0;"},[w("strong","• deny（拒绝）:")," 默认拒绝访问，只有在白名单中的IP才被允许"]),w("p",{style:"margin: 0; color: #f0a020;"},[w("strong","⚠️ 重要："),"黑名单优先级高于白名单，无论默认策略如何，黑名单中的IP都会被拒绝"])])})},{field:"trustXForwardedFor",label:"信任X-Forwarded-For",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"trustXRealIp",label:"信任X-Real-IP",type:"switch",span:12,defaultValue:"N",props:{checkedValue:"Y",uncheckedValue:"N"}}]},{field:"whitelistConfig",label:"",type:"fieldset",span:24,children:[{field:"whitelistIps",label:"IP白名单",type:"custom",span:12,defaultValue:[],tips:"精确匹配单个IP地址，白名单中的IP将被允许访问",render:y("whitelistIps"),rules:[{validator:(v,e)=>{if(!e||e.length===0)return!0;const s=Pe(e);return s.valid?!0:new Error(`无效的IP地址：${s.invalidIps.join(", ")}`)},trigger:["blur","input"]}]},{field:"whitelistCidrs",label:"CIDR白名单",type:"custom",span:12,defaultValue:[],tips:"匹配网段范围，如：192.168.1.0/24（192.168.1.1-254）",render:p("whitelistCidrs"),rules:[{validator:(v,e)=>{if(!e||e.length===0)return!0;const s=ke(e);return s.valid?!0:new Error(`无效的CIDR网段：${s.invalidCidrs.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"blacklistConfig",label:"",type:"fieldset",span:24,children:[{field:"blacklistIps",label:"IP黑名单",type:"custom",span:12,defaultValue:[],tips:"精确匹配单个IP地址，黑名单优先级最高，直接拒绝访问",render:y("blacklistIps"),rules:[{validator:(v,e)=>{if(!e||e.length===0)return!0;const s=Pe(e);return s.valid?!0:new Error(`无效的IP地址：${s.invalidIps.join(", ")}`)},trigger:["blur","input"]}]},{field:"blacklistCidrs",label:"CIDR黑名单",type:"custom",span:12,defaultValue:[],tips:"匹配网段范围，黑名单优先级最高，直接拒绝访问",render:p("blacklistCidrs"),rules:[{validator:(v,e)=>{if(!e||e.length===0)return!0;const s=ke(e);return s.valid?!0:new Error(`无效的CIDR网段：${s.invalidCidrs.join(", ")}`)},trigger:["blur","input"]}]}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}}],a={columns:[{field:"ipAccessConfigId",title:"IP访问配置ID",visible:!1},{field:"tenantId",title:"租户ID",visible:!1},{field:"securityConfigId",title:"安全配置ID",visible:!1},{field:"configName",title:"配置名称",sortable:!0,align:"center",showOverflow:!0},{field:"defaultPolicy",title:"默认策略",align:"center",width:120,slots:{default:"defaultPolicy"}},{field:"activeFlag",title:"状态",align:"center",width:100,slots:{default:"activeFlag"}},{field:"whitelistIps",title:"IP白名单",align:"left",width:200,showOverflow:!0},{field:"whitelistCidrs",title:"CIDR白名单",align:"left",width:200,showOverflow:!0},{field:"blacklistIps",title:"IP黑名单",align:"left",width:200,showOverflow:!0},{field:"blacklistCidrs",title:"CIDR黑名单",align:"left",width:200,showOverflow:!0},{field:"trustXForwardedFor",title:"信任X-Forwarded-For",align:"center",width:150,slots:{default:"trustXForwardedFor"}},{field:"trustXRealIp",title:"信任X-Real-IP",align:"center",width:130,slots:{default:"trustXRealIp"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:v})=>v?z(v,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:v})=>v?z(v,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:n,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},b=()=>{n.value=void 0},o=v=>{n.value?Object.assign(n.value,v):n.value=v},g=v=>{t.value=v},i=()=>{t.value=[]},r=v=>{t.value.unshift(v)},f=(v,e,s)=>{const T=t.value.findIndex(C=>C.ipAccessConfigId===v&&C.tenantId===e);T!==-1&&Object.assign(t.value[T],s)},c=(v,e)=>{const s=t.value.findIndex(T=>T.ipAccessConfigId===v&&T.tenantId===e);s!==-1&&t.value.splice(s,1)};return{moduleId:u,loading:d,configList:t,pageInfo:n,searchFormConfig:m,formFields:l,gridConfig:a,resetPagination:b,updatePagination:o,setConfigList:g,clearConfigList:i,addConfigToList:r,updateConfigInList:f,removeConfigFromList:c,removeConfigsFromList:v=>{v.forEach(e=>{c(e.ipAccessConfigId,e.tenantId)})}}}function Ft(u,d,t){const n=H(),m=pe(),y=Dt(u),{loading:p,configList:l,pageInfo:a,setConfigList:b,updatePagination:o,addConfigToList:g,updateConfigInList:i,removeConfigFromList:r}=y,f=async O=>{var I,P,x;p.value=!0;try{let U=O;!U&&((I=t==null?void 0:t.value)!=null&&I.getFormData)&&(U=t.value.getFormData()||{});const N=U?Object.fromEntries(Object.entries(U).filter(([,V])=>V!==""&&V!==null&&V!==void 0)):{},B={...N,...ne((P=a.value)==null?void 0:P.pageIndex,(x=a.value)==null?void 0:x.pageSize)};if(d!=null&&d.value)B.securityConfigId=d.value;else if(!N.securityConfigId){n.error("securityConfigId不能为空");return}const Y=await Ke(B);if(M(Y)){const V=_(Y,[]);b(V);const K=ce(Y);K&&Object.keys(K).length>0&&o(K)}else n.error(S(Y,"查询IP访问控制配置列表失败"))}catch{n.error("加载IP访问控制配置列表失败")}finally{p.value=!1}};return{model:y,loadConfigs:f,handleSearch:async O=>{y.resetPagination(),await f(O)},handleReset:async()=>{y.resetPagination(),await f()},handlePageChange:async({currentPage:O,pageSize:I})=>{o({pageIndex:O,pageSize:I}),await f()},handleRefresh:async()=>{await f()},addConfig:async O=>{p.value=!0;try{const I=await Fe(O);if(M(I)){n.success(S(I,"新增IP访问控制配置成功"));const P=_(I,null);return P?g(P):await f(),!0}else return n.error(S(I,"新增IP访问控制配置失败")),!1}catch{return n.error("新增IP访问控制配置失败"),!1}finally{p.value=!1}},editConfig:async O=>{p.value=!0;try{const I=await Le(O);if(M(I)){n.success(S(I,"编辑IP访问控制配置成功"));const P=_(I,null);return P?i(P.ipAccessConfigId,P.tenantId,P):await f(),!0}else return n.error(S(I,"编辑IP访问控制配置失败")),!1}catch{return n.error("编辑IP访问控制配置失败"),!1}finally{p.value=!1}},deleteConfig:async O=>{if(!await m.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除IP访问控制配置 "${O.configName}" 吗？`,icon:ve,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;p.value=!0;try{const P=await Ve({ipAccessConfigId:O.ipAccessConfigId,tenantId:O.tenantId});return M(P)?(n.success(S(P,"删除IP访问控制配置成功")),r(O.ipAccessConfigId,O.tenantId),l.value.length===0&&a.value&&a.value.pageIndex>1&&(o({pageIndex:a.value.pageIndex-1}),await f()),!0):(n.error(S(P,"删除IP访问控制配置失败")),!1)}catch{return n.error("删除IP访问控制配置失败"),!1}finally{p.value=!1}},getConfigDetail:async O=>{try{const I=await Me({ipAccessConfigId:O});return M(I)?_(I,{}):(n.error(S(I,"获取IP访问控制配置详情失败")),null)}catch{return n.error("获取IP访问控制配置详情失败"),null}}}}function Mt(u,d,t,n){const m=H(),y=Ft(u.value,t,n),p=k(!1),l=k("create"),a=k(null),b=e=>({...e,whitelistIps:R(e.whitelistIps),blacklistIps:R(e.blacklistIps),whitelistCidrs:R(e.whitelistCidrs),blacklistCidrs:R(e.blacklistCidrs)}),o=e=>{l.value="create",a.value=e?{securityConfigId:e}:null,p.value=!0},g=async e=>{if(e.ipAccessConfigId)try{const s=await y.getConfigDetail(e.ipAccessConfigId);if(s){l.value="edit",a.value=b(s),p.value=!0;return}}catch{}l.value="edit",a.value=b(e),p.value=!0},i=()=>{p.value=!1,a.value=null},r=async e=>{if(e.ipAccessConfigId)try{const s=await y.getConfigDetail(e.ipAccessConfigId);if(s){l.value="view",a.value=b(s),p.value=!0;return}}catch{}l.value="view",a.value=b(e),p.value=!0};return{service:y,formDialogVisible:p,formDialogMode:l,currentEditConfig:a,openAddDialog:o,openEditDialog:g,openViewDialog:r,handleFormSubmit:async e=>{if(!e||l.value==="view")return;const s={...e,whitelistIps:Array.isArray(e.whitelistIps)?JSON.stringify(e.whitelistIps):e.whitelistIps,blacklistIps:Array.isArray(e.blacklistIps)?JSON.stringify(e.blacklistIps):e.blacklistIps,whitelistCidrs:Array.isArray(e.whitelistCidrs)?JSON.stringify(e.whitelistCidrs):e.whitelistCidrs,blacklistCidrs:Array.isArray(e.blacklistCidrs)?JSON.stringify(e.blacklistCidrs):e.blacklistCidrs};if(l.value==="create"){const T=s.securityConfigId||(t==null?void 0:t.value);if(!T){m.error("安全配置ID不能为空");return}s.securityConfigId=T,await y.addConfig(s)&&i()}else if(l.value==="edit"){if(!a.value)return;const T={...a.value,...s};await y.editConfig(T)&&i()}},handleToolbarClick:async(e,s)=>{switch(e){case"add":const T=t==null?void 0:t.value;if(!T){m.warning("请先选择安全配置");return}o(T);break;case"edit":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要编辑的配置");return}g(C);break}case"delete":{if(!(d!=null&&d.value)){m.warning("Grid 引用未设置");return}const C=d.value.getCurrentRecord();if(!C){m.warning("请先点击选择要删除的配置");return}await y.deleteConfig(C);break}case"search":{await y.handleSearch(s);break}}},handleMenuClick:async({code:e,row:s})=>{if(s)switch(e){case"view":r(s);break;case"edit":g(s);break;case"delete":await y.deleteConfig(s);break}},handleSearch:async e=>{await y.handleSearch(e)}}}const Lt={class:"ip-access-config-list-modal",id:"ip-access-config-list-modal"},Vt=Q({name:"IpAccessConfigListModal",__name:"IpAccessConfigListModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{default:"IP访问控制配置列表"},width:{default:1200},to:{type:[String,Boolean],default:void 0},securityConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(),y=k(),p=k(t.moduleId),l=k(t.visible);E(()=>t.visible,s=>{l.value=s}),E(()=>t.moduleId,s=>{p.value=s});const a=k(t.securityConfigId);E(()=>t.securityConfigId,s=>{a.value=s});const{service:b,formDialogVisible:o,formDialogMode:g,currentEditConfig:i,handleFormSubmit:r,handleToolbarClick:f,handleMenuClick:c,handleSearch:A}=Mt(p,y,a,m),v=s=>{l.value=s,n("update:visible",s),n(s?"refresh":"close")},e=()=>{l.value||(o.value=!1,g.value="create",i.value=null,b.model.configList.value=[],b.model.resetPagination())};return(s,T)=>(Z(),fe(h(oe),{visible:l.value,title:t.title||"IP访问控制配置列表",width:t.width||1200,to:t.to,"show-footer":!1,"onUpdate:visible":v,onAfterLeave:e},{default:D(()=>[ge("div",Lt,[F(h(ue),{direction:"vertical","no-resize":!0},{1:D(()=>[F(re,G({ref_key:"searchFormRef",ref:m,"module-id":h(b).model.moduleId},h(b).model.searchFormConfig,{onSearch:h(A),onToolbarClick:h(f)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:D(()=>[F(h(se),G({ref_key:"gridRef",ref:y,"module-id":h(b).model.moduleId,data:h(b).model.configList,loading:h(b).model.loading},h(b).model.gridConfig,{onPageChange:h(b).handlePageChange,onMenuClick:h(c)}),{defaultPolicy:D(({row:C})=>[F(h(J),{type:C.defaultPolicy==="allow"?"success":"error",size:"small"},{default:D(()=>[q(W(C.defaultPolicy==="allow"?"允许":"拒绝"),1)]),_:2},1032,["type"])]),activeFlag:D(({row:C})=>[F(h(J),{type:C.activeFlag==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.activeFlag==="Y"?"活动":"非活动"),1)]),_:2},1032,["type"])]),trustXForwardedFor:D(({row:C})=>[F(h(J),{type:C.trustXForwardedFor==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.trustXForwardedFor==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),trustXRealIp:D(({row:C})=>[F(h(J),{type:C.trustXRealIp==="Y"?"success":"default",size:"small"},{default:D(()=>[q(W(C.trustXRealIp==="Y"?"是":"否"),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange","onMenuClick"])]),_:1}),F(X,{visible:h(o),"onUpdate:visible":T[0]||(T[0]=C=>ee(o)?o.value=C:null),mode:h(g),title:h(g)==="create"?"新增IP访问控制配置":h(g)==="edit"?"编辑IP访问控制配置":"查看IP访问控制配置详情",to:"#ip-access-config-list-modal","form-fields":h(b).model.formFields,"initial-data":h(i)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(b).model.loading.value,onSubmit:h(r)},null,8,["visible","mode","title","form-fields","initial-data","confirm-loading","onSubmit"])])]),_:1},8,["visible","title","width","to"]))}}),na=te(Vt,[["__scopeId","data-v-5fe62d38"]]);function Kt(u){const d=k(!1),t=[{label:"IP策略",value:"ip"},{label:"用户策略",value:"user"},{label:"路径策略",value:"path"},{label:"服务策略",value:"service"},{label:"路由策略",value:"route"}],n=[{label:"令牌桶算法",value:"token-bucket"},{label:"漏桶算法",value:"leaky-bucket"},{label:"滑动窗口算法",value:"sliding-window"},{label:"固定窗口算法",value:"fixed-window"},{label:"无限流",value:"none"}],m=()=>l=>{const a=l.algorithm;return a==="token-bucket"?w(le,{type:"info"},{default:()=>w(ae,null,{default:()=>[w("strong",null,"令牌桶算法："),"以固定速率向桶中放入令牌，请求需要消耗令牌才能通过。支持突发流量，桶满时多余令牌会被丢弃。",w("br"),"• 限流速率：每秒向桶中填充的令牌数（令牌/秒）",w("br"),"• 突发容量：桶的最大容量（最大令牌数），决定了最大突发请求数"]})}):a==="leaky-bucket"?w(le,{type:"info"},{default:()=>w(ae,null,{default:()=>[w("strong",null,"漏桶算法："),"请求先进入桶中，然后以固定速率从桶中流出。能够平滑突发流量，但不支持突发处理。",w("br"),"• 限流速率：每秒从桶中漏出的请求数（处理速率）",w("br"),"• 突发容量：桶的最大容量（最大可容纳的请求数），超出时请求会被拒绝"]})}):a==="sliding-window"?w(le,{type:"info"},{default:()=>w(ae,null,{default:()=>[w("strong",null,"滑动窗口算法："),"在固定时间窗口内限制请求数量。窗口会随时间滑动，提供更精确的限流控制，避免边界突刺问题。",w("br"),"• 限流速率：时间窗口内允许的最大请求数",w("br"),"• 时间窗口：统计请求数量的时间范围（秒）"]})}):a==="fixed-window"?w(le,{type:"info"},{default:()=>w(ae,null,{default:()=>[w("strong",null,"固定窗口算法："),"在固定时间窗口内限制请求数量。窗口到期后重置计数器，可能出现边界突发（临界问题）。",w("br"),"• 限流速率：时间窗口内允许的最大请求数",w("br"),"• 时间窗口：统计请求数量的时间范围（秒）"]})}):a==="none"?w(le,{type:"warning"},{default:()=>w(ae,null,{default:()=>[w("strong",null,"无限流："),"不进行任何限流控制，所有请求都会通过。通常用于临时关闭限流或测试环境。"]})}):w("div")},y=[{key:"basic",label:"基础设置"},{key:"other",label:"其他"}],p=[{field:"rateLimitConfigId",label:"限流配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"tenantId",label:"租户ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"gatewayInstanceId",label:"网关实例ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"routeConfigId",label:"路由配置ID",type:"input",span:8,show:!1,tabKey:"basic"},{field:"basicConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"limitName",label:"限流规则名称",type:"input",placeholder:"请输入限流规则名称",span:12,required:!0,defaultValue:"限流规则",tabKey:"basic"},{field:"configPriority",label:"配置优先级",type:"number",placeholder:"数值越小优先级越高",span:12,defaultValue:1,show:!1,tabKey:"basic",props:{min:0,max:999},tips:"数值越小优先级越高，相同条件下优先级高的配置会优先生效"},{field:"keyStrategy",label:"限流键策略",type:"select",span:12,required:!0,defaultValue:"ip",tabKey:"basic",props:{options:t,placeholder:"选择限流键策略"},tips:"IP策略：按IP地址限流；用户策略：按用户ID限流；路径策略：按请求路径限流；服务策略：按服务名限流；路由策略：按路由配置限流"},{field:"algorithm",label:"限流算法",type:"select",span:12,required:!0,defaultValue:"token-bucket",tabKey:"basic",props:{options:n,placeholder:"选择限流算法"},tips:"支持令牌桶、漏桶、滑动窗口、固定窗口等限流算法"}]},{field:"limitParamsConfig",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"limitRate",label:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"填充速率(令牌/秒)":a==="leaky-bucket"?"漏出速率(请求/秒)":a==="sliding-window"||a==="fixed-window"?"窗口内最大请求数":"限流速率(次/秒)"},type:"number",placeholder:"每秒允许的请求数",span:12,required:!0,defaultValue:100,tabKey:"basic",props:{min:1,max:1e4},tips:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"每秒向桶中填充的令牌数（令牌/秒）。每个请求需要消耗一个令牌才能通过。":a==="leaky-bucket"?"每秒从桶中漏出的请求数（处理速率）。无论输入如何，输出速率都严格限制为此值。":a==="sliding-window"||a==="fixed-window"?"时间窗口内允许的最大请求数。超过此数量的请求将被拒绝。":"每秒允许通过的请求数量"}},{field:"burstCapacity",label:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"桶容量(令牌)":a==="leaky-bucket"?"桶容量(请求)":"突发容量"},type:"number",placeholder:"允许的突发请求数",span:12,required:!0,defaultValue:200,tabKey:"basic",show:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"||a==="leaky-bucket"},props:{min:0,max:1e5},tips:l=>{const a=l==null?void 0:l.algorithm;return a==="token-bucket"?"桶的最大容量（最大令牌数）。桶满时可以处理此数量的突发请求。":a==="leaky-bucket"?"桶的最大容量（最大可容纳的请求数）。超出此容量时，新请求会被拒绝。":"允许的突发请求数量，用于令牌桶和漏桶算法"}},{field:"timeWindowSeconds",label:"时间窗口(秒)",type:"number",placeholder:"限流时间窗口",span:12,required:!0,defaultValue:1,tabKey:"basic",show:l=>{const a=l==null?void 0:l.algorithm;return a==="sliding-window"||a==="fixed-window"},props:{min:1,max:3600},tips:l=>{const a=l==null?void 0:l.algorithm;return a==="sliding-window"?"滑动时间窗口的大小（秒）。窗口会随时间滑动，提供更精确的限流控制。":a==="fixed-window"?"固定时间窗口的大小（秒）。窗口到期后重置计数器，可能出现边界突发。":"限流时间窗口，用于滑动窗口和固定窗口算法"}},{field:"rejectionStatusCode",label:"拒绝状态码",type:"number",placeholder:"限流时返回的HTTP状态码",span:12,required:!0,defaultValue:429,tabKey:"basic",props:{min:400,max:599},tips:"限流时返回的HTTP状态码，通常为429（Too Many Requests）"},{field:"rejectionMessage",label:"拒绝提示消息",type:"input",placeholder:"限流时的提示消息",span:24,required:!0,defaultValue:"请求过于频繁，请稍后再试",tabKey:"basic",tips:"限流时返回给客户端的错误消息"}]},{field:"algorithmDescription",label:"",type:"fieldset",span:24,tabKey:"basic",children:[{field:"algorithmDesc",label:"算法说明",type:"custom",span:24,tabKey:"basic",show:l=>l.algorithm&&l.algorithm!=="none",render:m()}]},{field:"activeFlag",label:"活动状态",type:"switch",span:12,defaultValue:"N",tabKey:"basic",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"addTime",label:"创建时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"addWho",label:"创建人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"editTime",label:"修改时间",type:"datetime",span:8,disabled:!0,tabKey:"other"},{field:"editWho",label:"修改人",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"oprSeqFlag",label:"操作序列标识",type:"input",span:8,disabled:!0,tabKey:"other"},{field:"currentVersion",label:"当前版本号",type:"number",span:8,disabled:!0,tabKey:"other"},{field:"noteText",label:"备注",type:"textarea",span:24,tabKey:"other",placeholder:"请输入备注信息"}];return{moduleId:u,loading:d,formTabs:y,formFields:p}}function _t(u){const d=H(),t=Kt(u),{loading:n}=t;return{model:t,getConfigDetail:async l=>{try{const a=await nt(l);return M(a)?_(a,null):(d.error(S(a,"获取限流配置详情失败")),null)}catch{return d.error("获取限流配置详情失败"),null}},addConfig:async l=>{n.value=!0;try{const a=await lt(l);return M(a)?(d.success(S(a,"新增限流配置成功")),!0):(d.error(S(a,"新增限流配置失败")),!1)}catch{return d.error("新增限流配置失败"),!1}finally{n.value=!1}},editConfig:async l=>{n.value=!0;try{const a=await it(l);return M(a)?(d.success(S(a,"编辑限流配置成功")),!0):(d.error(S(a,"编辑限流配置失败")),!1)}catch{return d.error("编辑限流配置失败"),!1}finally{n.value=!1}}}}function Ut(u){H();const d=_t(u.moduleId.value),t=k(!1),n=k("create"),m=k(null),y=g=>({...g,customConfig:(r=>{if(typeof r=="string"&&r)try{return JSON.parse(r)}catch{return r}return r})(g.customConfig)||{}}),p=g=>({...g,customConfig:typeof g.customConfig=="object"?JSON.stringify(g.customConfig):g.customConfig||"{}"}),l=async()=>{var f,c;const g=(f=u.gatewayInstanceId)==null?void 0:f.value,i=(c=u.routeConfigId)==null?void 0:c.value;if(!g&&!i)return;const r=await d.getConfigDetail({gatewayInstanceId:g,routeConfigId:i});r?(m.value=y(r),n.value="edit"):(m.value=null,n.value="create")},a=async()=>{await l(),t.value=!0},b=()=>{t.value=!1,m.value=null},o=async g=>{var r,f;if(!g||n.value==="view")return;const i=p(g);if((r=u.gatewayInstanceId)!=null&&r.value&&(i.gatewayInstanceId=u.gatewayInstanceId.value),(f=u.routeConfigId)!=null&&f.value&&(i.routeConfigId=u.routeConfigId.value),n.value==="create")await d.addConfig(i)&&await l();else if(n.value==="edit"){if(!m.value)return;const c={...i,rateLimitConfigId:m.value.rateLimitConfigId,tenantId:m.value.tenantId};await d.editConfig(c)&&await l()}};return E(()=>{var g,i;return[(g=u.gatewayInstanceId)==null?void 0:g.value,(i=u.routeConfigId)==null?void 0:i.value]},()=>{t.value&&l()}),{service:d,formDialogVisible:t,formDialogMode:n,currentEditConfig:m,openDialog:a,closeFormDialog:b,handleFormSubmit:o,loadConfig:l}}const Nt={class:"rate-limit-config-form-modal",id:"rate-limit-config-form-modal"},Et=Q({name:"RateLimitConfigFormModal",__name:"RateLimitConfigFormModal",props:{visible:{type:Boolean,default:!1},moduleId:{},title:{},width:{default:800},to:{type:[String,Boolean],default:void 0},gatewayInstanceId:{default:void 0},routeConfigId:{default:void 0}},emits:["update:visible","close","refresh"],setup(u,{emit:d}){const t=u,n=d,m=k(t.gatewayInstanceId),y=k(t.routeConfigId),p=k(t.moduleId),l=Ut({gatewayInstanceId:m,routeConfigId:y,moduleId:p}),{service:a,formDialogVisible:b,formDialogMode:o,currentEditConfig:g,openDialog:i,closeFormDialog:r,handleFormSubmit:f}=l,c=Ce(()=>t.title?t.title:o.value==="create"?"新增限流配置":o.value==="edit"?"编辑限流配置":"查看限流配置详情");E(()=>t.visible,async v=>{v?(m.value=t.gatewayInstanceId,y.value=t.routeConfigId,p.value=t.moduleId,b.value&&(r(),await Ie()),await i()):b.value&&r()});const A=v=>{v||(n("update:visible",!1),n("close"),n("refresh"))};return(v,e)=>(Z(),we("div",Nt,[F(X,{visible:h(b),"onUpdate:visible":[e[0]||(e[0]=s=>ee(b)?b.value=s:null),A],mode:h(o),title:c.value,width:t.width||800,to:t.to||"#rate-limit-config-form-modal","form-fields":h(a).model.formFields,"form-tabs":h(a).model.formTabs,"initial-data":h(g)||void 0,"auto-close-on-confirm":!1,"confirm-loading":h(a).model.loading.value,onSubmit:h(f)},null,8,["visible","mode","title","width","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])]))}}),sa=te(Et,[["__scopeId","data-v-1d0aa81a"]]);export{ta as A,la as C,ia as D,na as I,sa as R,ea as U,aa as a};

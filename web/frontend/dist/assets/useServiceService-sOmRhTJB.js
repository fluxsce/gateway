import"./GPagination.vue_vue_type_style_index_0_scoped_2c35df38_lang-Cl3FsyCO.js";import{af as Y,r as D,aa as A,m as M,z as w,B as f}from"./index-bKVtVsSX.js";import{c as U}from"./SearchForm-wLSWNkX3.js";import{A as z}from"./AddOutline-e9mIKA9k.js";import{C as R}from"./CreateOutline-LmOn9niU.js";import{T as F}from"./TrashOutline-fmGjC74g.js";const y=Y("/gateway/hub0042");async function H(t){return y.post("/queryServices",t)}async function Z(t,l,i){return y.post("/getService",{namespaceId:t,groupName:l,serviceName:i})}async function $(t){return y.post("/addService",t)}async function q(t){return y.post("/editService",t)}async function B(t,l,i){return y.post("/deleteService",{namespaceId:t,groupName:l,serviceName:i})}async function V(t){return y.post("/editNode",t)}async function ae(t){return y.post("/offlineNode",{nodeId:t})}async function re(t){return V({nodeId:t,instanceStatus:"UP",healthyStatus:"HEALTHY"})}function j(){const t="hub0042",l=D(!1),i=D([]),s=D(),O={fields:[{field:"serviceName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:6,clearable:!0},{field:"groupName",label:"分组名称",type:"input",placeholder:"请输入分组名称",span:6,clearable:!0},{field:"serviceType",label:"服务类型",type:"select",placeholder:"请选择类型",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"内部服务",value:"INTERNAL"},{label:"Nacos",value:"NACOS"},{label:"Consul",value:"CONSUL"},{label:"Eureka",value:"EUREKA"},{label:"ETCD",value:"ETCD"},{label:"ZooKeeper",value:"ZOOKEEPER"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[{key:"add",label:"新建服务",icon:z,type:"primary",tooltip:"新建服务"},{key:"edit",label:"编辑",icon:R,tooltip:"编辑选中的服务"},{key:"delete",label:"删除",icon:F,type:"error",tooltip:"删除选中的服务"}],showSearchButton:!0,showResetButton:!0},c={tabs:[{key:"basic",label:"基本信息"},{key:"config",label:"服务配置"},{key:"other",label:"其它"}],fields:[{field:"namespaceId",label:"命名空间ID",type:"input",placeholder:"命名空间ID（自动填充）",span:12,tabKey:"basic",required:!0,disabled:!0,tips:"命名空间ID（主键），从上方命名空间列表自动获取"},{field:"groupName",label:"分组名称",type:"input",placeholder:"请输入分组名称，如：DEFAULT_GROUP",span:12,tabKey:"basic",required:!0,primary:!0,defaultValue:"DEFAULT_GROUP",tips:"分组名称（主键），编辑模式下不允许修改"},{field:"serviceName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:12,tabKey:"basic",required:!0,primary:!0,tips:"服务名称（主键），编辑模式下不允许修改"},{field:"serviceType",label:"服务类型",type:"select",placeholder:"请选择服务类型",span:12,tabKey:"basic",required:!0,defaultValue:"INTERNAL",options:[{label:"内部服务",value:"INTERNAL"},{label:"Nacos",value:"NACOS"},{label:"Consul",value:"CONSUL"},{label:"Eureka",value:"EUREKA"},{label:"ETCD",value:"ETCD"},{label:"ZooKeeper",value:"ZOOKEEPER"}]},{field:"serviceVersion",label:"服务版本",type:"input",placeholder:"请输入服务版本号",span:12,tabKey:"basic"},{field:"serviceDescription",label:"服务描述",type:"textarea",placeholder:"请输入服务描述",span:24,tabKey:"basic",props:{rows:3}},{field:"activeFlag",label:"活动状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"protectThreshold",label:"保护阈值",type:"number",placeholder:"0.00",span:12,tabKey:"config",defaultValue:0,tips:"服务保护阈值，范围0.00-1.00，表示健康实例比例低于该值时触发保护",props:{min:0,max:1,step:.01,precision:2}},{field:"externalServiceConfig",label:"外部服务配置",type:"textarea",placeholder:"请输入外部服务配置（JSON格式）",span:24,tabKey:"config",tips:"外部服务配置，JSON格式，存储外部注册中心的连接配置等信息",props:{rows:5}},{field:"metadataJson",label:"服务元数据",type:"textarea",placeholder:"请输入服务元数据（JSON格式）",span:24,tabKey:"config",tips:"服务元数据，JSON格式，存储服务的扩展信息",props:{rows:5}},{field:"tagsJson",label:"服务标签",type:"textarea",placeholder:"请输入服务标签（JSON格式）",span:24,tabKey:"config",tips:"服务标签，JSON格式，用于服务分类和过滤",props:{rows:3}},{field:"selectorJson",label:"服务选择器",type:"textarea",placeholder:"请输入服务选择器（JSON格式）",span:24,tabKey:"config",tips:"服务选择器，JSON格式，用于服务路由规则",props:{rows:5}},{field:"noteText",label:"备注",type:"textarea",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{rows:3}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}]},m={columns:[{field:"namespaceId",title:"命名空间ID",sortable:!0,align:"center",showOverflow:!0},{field:"groupName",title:"分组名称",sortable:!0,align:"center",showOverflow:!0,slots:{default:"groupName"}},{field:"serviceName",title:"服务名称",sortable:!0,align:"center",showOverflow:!0,slots:{default:"serviceName"}},{field:"serviceType",title:"服务类型",align:"center",showOverflow:!0,formatter:({cellValue:e})=>({INTERNAL:"内部服务",NACOS:"Nacos",CONSUL:"Consul",EUREKA:"Eureka",ETCD:"ETCD",ZOOKEEPER:"ZooKeeper"})[e]||e},{field:"serviceVersion",title:"服务版本",align:"center",showOverflow:!0,formatter:({cellValue:e})=>e||"-"},{field:"serviceDescription",title:"服务描述",align:"left",showOverflow:!0,width:200,formatter:({cellValue:e})=>e||"-"},{field:"nodeCount",title:"节点数量",align:"center",formatter:({cellValue:e})=>e||0},{field:"healthyNodeCount",title:"健康节点",align:"center",formatter:({cellValue:e})=>e||0},{field:"unhealthyNodeCount",title:"不健康节点",align:"center",formatter:({cellValue:e})=>e||0},{field:"activeFlag",title:"活动状态",align:"center",slots:{default:"activeFlag"}},{field:"addTime",title:"创建时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?A(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"addWho",title:"创建人",showOverflow:!0},{field:"editTime",title:"修改时间",sortable:!0,showOverflow:!0,formatter:({cellValue:e})=>e?A(e,"YYYY-MM-DD HH:mm:ss"):""},{field:"editWho",title:"修改人",showOverflow:!0}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:s,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]},height:"100%"},E=()=>{s.value=void 0},I=e=>{s.value?Object.assign(s.value,e):s.value=e},K=e=>{i.value=e},T=()=>{i.value=[]},L=e=>{i.value.unshift(e)},v=(e,o,h,S,g)=>{const u=i.value.findIndex(r=>r.namespaceId===e&&r.groupName===o&&r.serviceName===h&&r.tenantId===S);u!==-1&&Object.assign(i.value[u],g)},C=(e,o,h,S)=>{const g=i.value.findIndex(u=>u.namespaceId===e&&u.groupName===o&&u.serviceName===h&&u.tenantId===S);g!==-1&&i.value.splice(g,1)};return{moduleId:t,loading:l,serviceList:i,pageInfo:s,searchFormConfig:O,serviceFormConfig:c,gridConfig:m,resetPagination:E,updatePagination:I,setServiceList:K,clearServiceList:T,addServiceToList:L,updateServiceInList:v,removeServiceFromList:C,removeServicesFromList:e=>{e.forEach(o=>{C(o.namespaceId,o.groupName,o.serviceName,o.tenantId)})}}}function le(t){const l=M(),i=j(),{loading:s,serviceList:O,pageInfo:c,setServiceList:m,updatePagination:E,addServiceToList:I,updateServiceInList:K,removeServiceFromList:T,removeServicesFromList:L}=i,v=async(r,a)=>{var N,n,x;s.value=!0;try{let d=r;!d&&((N=t==null?void 0:t.value)!=null&&N.getFormData)&&(d=t.value.getFormData()||{}),a&&(d={...d,namespaceId:a});const k={...d?Object.fromEntries(Object.entries(d).filter(([,p])=>p!==""&&p!==null&&p!==void 0)):{},...U((n=c.value)==null?void 0:n.pageIndex,(x=c.value)==null?void 0:x.pageSize)},b=await H(k);if(b.oK){if(b.bizData){const p=JSON.parse(b.bizData),J=Array.isArray(p)?p:[];m(J)}if(b.pageQueryData){const p=JSON.parse(b.pageQueryData);E(p)}}else l.error(b.errMsg||f(b)),m([])}catch(d){l.error("加载服务列表失败: "+(d.message||"未知错误")),m([])}finally{s.value=!1}};return{model:i,loading:s,serviceList:O,pageInfo:c,loadServices:v,handleSearch:async r=>{i.resetPagination(),await v(void 0,r)},handleReset:async()=>{var r;(r=t==null?void 0:t.value)!=null&&r.resetForm&&t.value.resetForm(),i.resetPagination(),await v({})},handlePageChange:async(r,a)=>{c.value&&(c.value.pageIndex=r,c.value.pageSize=a),await v()},handleRefresh:async()=>{await v()},addService:async r=>{try{const a=await $(r);return w(a)?(l.success(f(a)),!0):(l.error(f(a)),!1)}catch(a){return l.error("添加服务失败: "+(a.message||"未知错误")),!1}},editService:async r=>{try{const a=await q(r);return w(a)?(l.success(f(a)),!0):(l.error(f(a)),!1)}catch(a){return l.error("编辑服务失败: "+(a.message||"未知错误")),!1}},deleteService:async r=>{try{const a=await B(r.namespaceId,r.groupName,r.serviceName);return w(a)?(l.success(f(a)),!0):(l.error(f(a)),!1)}catch(a){return l.error("删除服务失败: "+(a.message||"未知错误")),!1}},getServiceDetail:async(r,a,N)=>{try{const n=await Z(r,a,N);return w(n)?n.bizData?JSON.parse(n.bizData):null:(l.error(f(n)),null)}catch(n){return l.error("获取服务详情失败: "+(n.message||"未知错误")),null}}}}export{ae as a,V as e,Z as g,re as o,le as u};

import{u as oe,G as ie}from"./GDataFormModal-VxLcqmDu.js";import{c as ce,b as de,a as ue,S as pe,G as ye}from"./SearchForm-DVwV6nX9.js";import{X as Se,r as k,U as q,T as z,m as j,z as V,B as A,A as M,cX as ve,d as ee,P as ae,af as we,h as Te,o as Y,w as C,g as T,f as s,e as b,a4 as G,aG as $,K as U,t as O,ci as Q,_ as te,b as Z,S as D,j as E,i as Ce,J as Ie}from"./index-DtSgXHAU.js";import"./GDialog.vue_vue_type_style_index_0_scoped_82fcf09e_lang-DKtjX6Dr.js";/* empty css                                                                    */import{A as fe,T as ge}from"./TrashOutline-CwjnPq0e.js";import{N as he}from"./Switch-CVI62BKK.js";import{S as _e}from"./ServerOutline-tG4BQz29.js";import{P as me,R as Ne}from"./RefreshCircleOutline-Cjk33aR5.js";import{S as be,P as ke}from"./StopCircleOutline-BsfZctjN.js";import{L as Le}from"./LinkOutline-BRs5ZUzy.js";import{A as xe,a as Pe}from"./ArrowUpOutline--DQVO_eg.js";import{_ as Ke,a as H}from"./Grid-CX1vh2PG.js";import{S as Fe}from"./StopOutline-_kmq9KIB.js";import{R as Ve}from"./RefreshOutline-COfBkLmD.js";import{W as Oe}from"./WarningOutline-BJvpYxPW.js";import"./Scrollbar-BzLvhEeS.js";import"./OptionsOutline-Cu4SeIPE.js";import"./DatePicker-Dr1IHu9Y.js";import"./Select-DAEsThOn.js";import"./InformationCircleOutline-Bg-Spuuj.js";import"./InputNumber-CgGjzunM.js";import"./index-DR_R-bYe.js";import"./download-C2161hUv.js";const B=Se("/gateway/hub0061"),Be=async o=>B.post("/queryStaticServers",o),Ae=async o=>B.post("/getStaticServer",{tunnelStaticServerId:o}),Me=async o=>B.post("/createStaticServer",o),De=async o=>B.post("/updateStaticServer",o),le=async o=>B.post("/deleteStaticServer",{tunnelStaticServerId:o}),Ee=async()=>B.post("/getStaticServerStats",{}),He=async o=>B.post("/startStaticServer",{tunnelStaticServerId:o}),Ue=async o=>B.post("/stopStaticServer",{tunnelStaticServerId:o}),$e=async o=>B.post("/reloadStaticServer",{tunnelStaticServerId:o}),qe=async o=>B.post("/queryStaticNodes",o),ze=async o=>B.post("/getStaticNode",{tunnelStaticNodeId:o}),Ye=async o=>B.post("/createStaticNode",o),Ge=async o=>B.post("/updateStaticNode",o),se=async o=>B.post("/deleteStaticNode",{tunnelStaticNodeId:o}),W=[{label:"活跃",value:"active",type:"success"},{label:"非活跃",value:"inactive",type:"warning"},{label:"错误",value:"error",type:"error"}],ne=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],R=[{label:"健康",value:"healthy",type:"success"},{label:"不健康",value:"unhealthy",type:"error"},{label:"未知",value:"unknown",type:"default"}];function je(){const o="hub0061:static-nodes",i=k(!1),n=k([]),l=k(),c={fields:[{field:"nodeName",label:"节点名称",type:"input",placeholder:"请输入节点名称",span:6,clearable:!0},{field:"targetAddress",label:"目标地址",type:"input",placeholder:"请输入目标地址",span:6,clearable:!0},{field:"nodeStatus",label:"节点状态",type:"select",placeholder:"请选择节点状态",span:6,clearable:!0,options:[{label:"全部",value:""},...W.map(e=>({label:e.label,value:e.value}))]},{field:"healthCheckStatus",label:"健康状态",type:"select",placeholder:"请选择健康状态",span:6,clearable:!0,options:[{label:"全部",value:""},...R.map(e=>({label:e.label,value:e.value}))]}],toolbarButtons:[{key:"add",label:"新增节点",icon:fe,type:"primary",tooltip:"新增静态节点"},{key:"delete",label:"删除",icon:ge,type:"error",tooltip:"批量删除选中的节点"}],showSearchButton:!0,showResetButton:!0},g=e=>{const a=W.find(f=>f.value===e);return(a==null?void 0:a.label)||e},v=e=>{const a=W.find(f=>f.value===e);return(a==null?void 0:a.type)||"default"},I=e=>{const a=ne.find(f=>f.value===e);return(a==null?void 0:a.label)||e},m=e=>{if(!e)return"未知";const a=R.find(f=>f.value===e);return(a==null?void 0:a.label)||e},N=e=>{if(!e)return"default";const a=R.find(f=>f.value===e);return(a==null?void 0:a.type)||"default"},y={columns:[{field:"tunnelStaticNodeId",title:"节点ID",visible:!1,width:0},{field:"nodeName",title:"节点名称",align:"center",showOverflow:"tooltip",width:160},{field:"targetAddress",title:"目标地址",align:"center",showOverflow:"tooltip",width:140},{field:"targetPort",title:"目标端口",align:"center",width:100},{field:"proxyType",title:"代理类型",align:"center",width:100,slots:{default:"proxyType"}},{field:"nodeStatus",title:"节点状态",align:"center",width:100,slots:{default:"nodeStatus"}},{field:"healthCheckStatus",title:"健康状态",align:"center",width:100,slots:{default:"healthCheckStatus"}},{field:"currentConnectionCount",title:"当前连接",align:"center",width:100},{field:"totalConnectionCount",title:"总连接数",align:"center",width:100},{field:"totalBytesReceived",title:"接收流量",align:"center",width:100,formatter:({row:e})=>q(e.totalBytesReceived)},{field:"totalBytesSent",title:"发送流量",align:"center",width:100,formatter:({row:e})=>q(e.totalBytesSent)},{field:"failureCount",title:"失败次数",align:"center",width:100},{field:"lastHealthCheck",title:"最后检查",align:"center",formatter:({row:e})=>z(e.lastHealthCheck),width:160},{field:"activeFlag",title:"状态",align:"center",width:80,slots:{default:"activeFlag"}},{field:"nodeDescription",title:"描述",align:"center",showOverflow:"tooltip",width:160},{field:"addTime",title:"创建时间",align:"center",formatter:({row:e})=>z(e.addTime),width:160}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:l,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function L(e){n.value=e}function x(e){i.value=e}function P(){l.value=void 0}function F(e){l.value?Object.assign(l.value,e):l.value=e}function K(e){n.value.push(e)}function S(e,a,f){const w=n.value.findIndex(r=>r.tunnelStaticNodeId===e&&(!a||r.tenantId===a));w!==-1&&Object.assign(n.value[w],f)}function h(e){const a=n.value.findIndex(f=>f.tunnelStaticNodeId===e);a>=0&&n.value.splice(a,1)}function d(e){n.value=n.value.filter(a=>!e.includes(a.tunnelStaticNodeId))}const p=[{key:"basic",label:"基本信息"},{key:"advanced",label:"高级配置",show:!1},{key:"other",label:"其他信息"}],t=[{field:"tunnelStaticNodeId",label:"节点ID",type:"input",span:12,primary:!0,show:!1},{field:"tunnelStaticServerId",label:"服务器ID",type:"input",span:12,show:!1},{field:"nodeName",label:"节点名称",type:"input",placeholder:"请输入节点名称",span:12,tabKey:"basic",required:!0,tips:"用于标识此后端节点的唯一名称，建议使用有意义的命名便于管理",rules:[{required:!0,message:"请输入节点名称",trigger:["blur","input"]},{max:100,message:"节点名称不能超过100个字符",trigger:["blur","input"]}]},{field:"targetAddress",label:"目标地址",type:"input",placeholder:"请输入后端服务地址（IP或域名）",span:12,tabKey:"basic",required:!0,tips:"后端服务的 IP 地址或域名。支持内网地址如 192.168.1.100 或域名如 backend.local",rules:[{required:!0,message:"请输入目标地址",trigger:["blur","input"]}]},{field:"targetPort",label:"目标端口",type:"number",placeholder:"请输入后端服务端口",span:12,tabKey:"basic",required:!0,defaultValue:80,tips:"后端服务监听的端口号（1-65535）。如 SSH 服务通常是 22，HTTP 是 80",props:{min:1,max:65535,precision:0},rules:[{required:!0,type:"number",message:"请输入目标端口",trigger:["blur","change"]}]},{field:"proxyType",label:"代理类型",type:"select",placeholder:"请选择代理类型",span:12,tabKey:"basic",required:!0,defaultValue:"tcp",tips:"TCP：适用于大多数场景如 SSH、数据库连接；UDP：适用于 DNS、游戏等场景。需与服务器类型一致",options:ne.map(e=>({label:e.label,value:e.value})),rules:[{required:!0,message:"请选择代理类型",trigger:["blur","change"]}]},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",tips:"禁用后此节点将不会被负载均衡选中，不会接收新的连接请求",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"nodeDescription",label:"节点描述",type:"input",placeholder:"请输入节点描述",span:24,tabKey:"basic",props:{type:"textarea",rows:2,maxlength:500,showCount:!0}},{field:"maxConnections",label:"最大连接数",type:"number",placeholder:"请输入最大连接数，0表示不限制",span:12,tabKey:"advanced",defaultValue:0,show:!1,tips:"此节点允许的最大并发连接数。0 表示不限制",props:{min:0,precision:0}},{field:"connectionTimeout",label:"连接超时(秒)",type:"number",placeholder:"请输入连接超时时间",span:12,tabKey:"advanced",defaultValue:30,show:!1,tips:"连接到此节点的超时时间",props:{min:1,precision:0}},{field:"readTimeout",label:"读取超时(秒)",type:"number",placeholder:"请输入读取超时时间",span:12,tabKey:"advanced",defaultValue:60,show:!1,tips:"从此节点读取数据的超时时间",props:{min:1,precision:0}},{field:"writeTimeout",label:"写入超时(秒)",type:"number",placeholder:"请输入写入超时时间",span:12,tabKey:"advanced",defaultValue:60,show:!1,tips:"向此节点写入数据的超时时间",props:{min:1,precision:0}},{field:"retryCount",label:"重试次数",type:"number",placeholder:"请输入重试次数",span:12,tabKey:"advanced",defaultValue:3,show:!1,tips:"连接失败时的重试次数",props:{min:0,precision:0}},{field:"retryInterval",label:"重试间隔(秒)",type:"number",placeholder:"请输入重试间隔",span:12,tabKey:"advanced",defaultValue:1,show:!1,tips:"重试之间的等待时间",props:{min:0,precision:0}},{field:"compression",label:"启用压缩",type:"switch",span:12,tabKey:"advanced",defaultValue:"N",show:!1,tips:"启用后将压缩传输数据，可减少带宽占用但增加 CPU 开销",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"encryption",label:"启用加密",type:"switch",span:12,tabKey:"advanced",defaultValue:"N",show:!1,tips:"启用后将加密传输数据，提高安全性",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"secretKey",label:"加密密钥",type:"input",placeholder:"请输入加密密钥",span:24,tabKey:"advanced",show:!1,tips:"用于数据加密的密钥",props:{type:"password",showPasswordOn:"click"}},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}];return{moduleId:o,loading:i,nodeList:n,pageInfo:l,searchFormConfig:c,gridConfig:y,formFields:t,formTabs:p,getNodeStatusLabel:g,getNodeStatusTagType:v,getProxyTypeLabel:I,getHealthCheckStatusLabel:m,getHealthCheckStatusTagType:N,setNodeList:L,setLoading:x,resetPagination:P,updatePagination:F,addNodeToList:K,updateNodeInList:S,removeNodeFromList:h,removeNodesFromList:d}}function We(o,i){const n=j(),l=()=>typeof o=="string"?o:o==null?void 0:o.value,c=je(),{addNodeToList:g,updateNodeInList:v,removeNodeFromList:I,removeNodesFromList:m}=c,N=async S=>{var h,d,p;try{c.setLoading(!0);let t=S;!t&&((h=i==null?void 0:i.value)!=null&&h.getFormData)&&(t=i.value.getFormData()||{});const e=t?Object.fromEntries(Object.entries(t).filter(([,r])=>r!==""&&r!==null&&r!==void 0)):{},a=l(),f={...e,tunnelStaticServerId:a,...ce((d=c.pageInfo.value)==null?void 0:d.pageIndex,(p=c.pageInfo.value)==null?void 0:p.pageSize)},w=await qe(f);if(V(w)){const r=M(w,[])||[];c.setNodeList(r);const u=ve(w);u&&Object.keys(u).length>0?c.updatePagination(u):c.resetPagination()}else n.error(A(w,"加载节点列表失败")),c.setNodeList([]),c.resetPagination()}catch(t){console.error("加载节点列表失败:",t),n.error(t.message||"加载节点列表失败"),c.setNodeList([]),c.resetPagination()}finally{c.setLoading(!1)}},y=async S=>{try{const h=await ze(S);return V(h)?M(h):(n.error(A(h,"获取节点详情失败")),null)}catch(h){return console.error("获取节点详情失败:",h),n.error(h.message||"获取节点详情失败"),null}},L=async S=>{try{c.setLoading(!0);const h={...S,tenantId:"default",tunnelStaticServerId:l()},d=await Ye(h);if(V(d)){n.success("新增节点成功");const p=M(d,null);return p?g(p):await N(),!0}else return n.error(A(d,"新增节点失败")),!1}catch(h){return console.error("新增节点失败:",h),n.error(h.message||"新增节点失败"),!1}finally{c.setLoading(!1)}},x=async(S,h)=>{try{c.setLoading(!0);const d={...h,tunnelStaticNodeId:S,tenantId:"default"},p=await Ge(d);if(V(p)){n.success("编辑节点成功");const t=M(p,null);return t?v(t.tunnelStaticNodeId,t.tenantId,t):await N(),!0}else return n.error(A(p,"编辑节点失败")),!1}catch(d){return console.error("编辑节点失败:",d),n.error(d.message||"编辑节点失败"),!1}finally{c.setLoading(!1)}};return{model:c,loadNodeList:N,getNodeDetail:y,addNode:L,editNode:x,deleteNode:async S=>{try{c.setLoading(!0);const h=await se(S);return V(h)?(n.success("删除节点成功"),I(S),c.nodeList.value.length===0&&c.pageInfo.value&&c.pageInfo.value.pageIndex>1&&(c.updatePagination({pageIndex:c.pageInfo.value.pageIndex-1}),await N()),!0):(n.error(A(h,"删除节点失败")),!1)}catch(h){return console.error("删除节点失败:",h),n.error(h.message||"删除节点失败"),!1}finally{c.setLoading(!1)}},deleteNodes:async S=>{try{c.setLoading(!0);const d=(await Promise.all(S.map(p=>se(p)))).filter(p=>V(p)).length;return d===S.length?(n.success(`成功删除 ${d} 个节点`),m(S),c.nodeList.value.length===0&&c.pageInfo.value&&c.pageInfo.value.pageIndex>1&&(c.updatePagination({pageIndex:c.pageInfo.value.pageIndex-1}),await N()),!0):(n.warning(`部分删除成功：${d}/${S.length}`),await N(),!1)}catch(h){return console.error("批量删除节点失败:",h),n.error(h.message||"批量删除节点失败"),!1}finally{c.setLoading(!1)}},toggleNodeStatus:async S=>{const h=S.activeFlag==="Y"?"N":"Y";return await x(S.tunnelStaticNodeId,{...S,activeFlag:h})}}}function Re(o,i,n){const l=j(),c=oe(),g=We(i||"",n),v=k(!1),I=k("create"),m=k(null),N=(e=!0)=>(typeof i=="string"?i:i==null?void 0:i.value)?!0:(e&&l.warning("请先选择静态服务器"),!1),y=async e=>{g.model.resetPagination(),await g.loadNodeList(e)},L=async({currentPage:e,pageSize:a})=>{g.model.updatePagination({pageIndex:e,pageSize:a}),await g.loadNodeList()},x=async(e,a)=>{switch(e){case"add":P();break;case"delete":{if(!(o!=null&&o.value)){l.warning("Grid 引用未设置");return}const f=o.value.getCurrentRecord();if(!f){l.warning("请先点击选择要删除的节点");return}await p(f);break}case"search":{await y(a);break}default:console.warn("未知的工具栏按钮:",e)}},P=()=>{N()&&(I.value="create",m.value=null,v.value=!0)},F=async e=>{if(!e.tunnelStaticNodeId){l.warning("节点ID不能为空");return}try{const a=await g.getNodeDetail(e.tunnelStaticNodeId);a?(I.value="edit",m.value=a,v.value=!0):(I.value="edit",m.value=e,v.value=!0)}catch{I.value="edit",m.value=e,v.value=!0}},K=async e=>{if(!e.tunnelStaticNodeId){l.warning("节点ID不能为空");return}try{const a=await g.getNodeDetail(e.tunnelStaticNodeId);a?(I.value="view",m.value=a,v.value=!0):(I.value="view",m.value=e,v.value=!0)}catch{I.value="view",m.value=e,v.value=!0}},S=()=>{v.value=!1,m.value=null},h=async e=>{if(e){if(I.value==="view"){S();return}if(!N())return!1;try{const a={tunnelStaticNodeId:e.tunnelStaticNodeId,tunnelStaticServerId:e.tunnelStaticServerId||(typeof i=="string"?i:i==null?void 0:i.value),nodeName:e.nodeName,nodeDescription:e.nodeDescription,targetAddress:e.targetAddress,targetPort:e.targetPort,proxyType:e.proxyType,maxConnections:e.maxConnections,connectionTimeout:e.connectionTimeout,readTimeout:e.readTimeout,writeTimeout:e.writeTimeout,retryCount:e.retryCount,retryInterval:e.retryInterval,compression:e.compression,encryption:e.encryption,secretKey:e.secretKey,activeFlag:e.activeFlag,noteText:e.noteText};let f=!1;I.value==="create"?f=await g.addNode(a):I.value==="edit"&&m.value&&(f=await g.editNode(m.value.tunnelStaticNodeId,a)),f&&S()}catch(a){console.error("提交节点配置失败:",a),l.error(a.message||"提交失败，请重试")}}},d=async({menu:e,row:a})=>{switch(e.code){case"view":await K(a);break;case"edit":await F(a);break;case"toggle-status":await t(a);break;case"delete":await p(a);break;default:console.warn("未知的菜单项:",e.code)}},p=async e=>{await c.warning({title:"确认删除",content:`确定要删除节点"${e.nodeName}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消"})&&await g.deleteNode(e.tunnelStaticNodeId)},t=async e=>{await g.toggleNodeStatus(e)};return{service:g,formDialogVisible:v,formDialogMode:I,currentEditNode:m,handleSearch:y,handlePageChange:L,handleToolbarClick:x,handleMenuClick:d,openAddDialog:P,openEditDialog:F,openViewDialog:K,closeFormDialog:S,handleFormSubmit:h,handleDelete:p,handleToggleStatus:t}}const Xe=["id"],Je=ee({name:"StaticNodeListModal",__name:"StaticNodeListModal",props:{visible:{type:Boolean,default:!1},title:{default:""},width:{default:1400},to:{type:[String,Boolean],default:void 0},tunnelStaticServerId:{default:""},serverName:{default:""}},emits:["update:visible","close","refresh"],setup(o,{emit:i}){const n=o,l=i,c=k(),g=k(),v=k(n.visible),I=ae(()=>n.visible,a=>{v.value=a}),m=k(n.tunnelStaticServerId),N=ae(()=>n.tunnelStaticServerId,a=>{m.value=a});we(()=>{I(),N()});const{service:y,formDialogVisible:L,formDialogMode:x,currentEditNode:P,handleFormSubmit:F,handleToolbarClick:K,handleMenuClick:S,handleSearch:h,handlePageChange:d,handleToggleStatus:p}=Re(g,m,c),t=a=>{v.value=a,l("update:visible",a),a?(l("refresh"),y.loadNodeList()):l("close")},e=()=>{v.value||(L.value=!1,x.value="create",P.value=null,y.model.nodeList.value=[],y.model.resetPagination())};return(a,f)=>(Y(),Te(s(ye),{visible:v.value,title:n.title||`静态节点管理 - ${n.serverName||""}`,width:n.width||1400,to:n.to,"show-footer":!1,"onUpdate:visible":t,onAfterLeave:e},{default:C(()=>[T("div",{class:"static-node-list-modal",id:s(y).model.moduleId},[b(s(de),{direction:"vertical","no-resize":!0},{1:C(()=>[b(pe,G({ref_key:"searchFormRef",ref:c,"module-id":s(y).model.moduleId},s(y).model.searchFormConfig,{onSearch:s(h),onToolbarClick:s(K)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:C(()=>[b(s(ue),G({ref_key:"gridRef",ref:g,"module-id":s(y).model.moduleId,data:s(y).model.nodeList,loading:s(y).model.loading},s(y).model.gridConfig,{onPageChange:s(d),onMenuClick:f[0]||(f[0]=({code:w,row:r})=>s(S)({menu:{code:w},row:r}))}),{proxyType:C(({row:w})=>[b(s($),{type:w.proxyType==="tcp"?"primary":"info",size:"small"},{default:C(()=>[U(O(s(y).model.getProxyTypeLabel(w.proxyType)),1)]),_:2},1032,["type"])]),nodeStatus:C(({row:w})=>[b(s($),{type:s(y).model.getNodeStatusTagType(w.nodeStatus),size:"small"},{default:C(()=>[U(O(s(y).model.getNodeStatusLabel(w.nodeStatus)),1)]),_:2},1032,["type"])]),healthCheckStatus:C(({row:w})=>[b(s($),{type:s(y).model.getHealthCheckStatusTagType(w.healthCheckStatus),size:"small"},{default:C(()=>[U(O(s(y).model.getHealthCheckStatusLabel(w.healthCheckStatus)),1)]),_:2},1032,["type"])]),activeFlag:C(({row:w})=>[b(s(he),{value:w.activeFlag==="Y","onUpdate:value":()=>s(p)(w),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),b(ie,{visible:s(L),"onUpdate:visible":f[1]||(f[1]=w=>Q(L)?L.value=w:null),mode:s(x),title:s(x)==="create"?"新增静态节点":s(x)==="edit"?"编辑静态节点":"查看静态节点详情",to:`#${s(y).model.moduleId}`,"form-fields":s(y).model.formFields,"form-tabs":s(y).model.formTabs,"initial-data":s(P)||void 0,"auto-close-on-confirm":!1,"confirm-loading":s(y).model.loading.value,onSubmit:s(F)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"])],8,Xe)]),_:1},8,["visible","title","width","to"]))}}),Qe=te(Je,[["__scopeId","data-v-13e35180"]]),Ze={class:"static-server-stats"},et={class:"stat-content"},tt={class:"stat-icon total"},at={class:"stat-info"},lt={class:"stat-value"},st={class:"stat-content"},nt={class:"stat-icon running"},rt={class:"stat-info"},ot={class:"stat-value"},it={class:"stat-content"},ct={class:"stat-icon stopped"},dt={class:"stat-info"},ut={class:"stat-value"},pt={class:"stat-content"},vt={class:"stat-icon connections"},ft={class:"stat-info"},gt={class:"stat-value"},ht={class:"stat-content"},mt={class:"stat-icon received"},bt={class:"stat-info"},yt={class:"stat-value"},St={class:"stat-content"},wt={class:"stat-icon sent"},Tt={class:"stat-info"},Ct={class:"stat-value"},It=ee({__name:"StaticServerStats",props:{statistics:{}},setup(o){const i=n=>{if(!n||n===0)return"0 B";const l=1024,c=["B","KB","MB","GB","TB"],g=Math.floor(Math.log(n)/Math.log(l));return Math.round(n/Math.pow(l,g)*100)/100+" "+c[g]};return(n,l)=>(Y(),Z("div",Ze,[b(s(Ke),{cols:6,"x-gap":8,"y-gap":8,responsive:"screen"},{default:C(()=>[b(s(H),null,{default:C(()=>[b(s(D),{class:"stat-card",hoverable:""},{default:C(()=>[T("div",et,[T("div",tt,[b(s(E),{size:"18",component:s(_e)},null,8,["component"])]),T("div",at,[T("div",lt,O(n.statistics.totalServers||0),1),l[0]||(l[0]=T("div",{class:"stat-label"},"总服务数",-1))])])]),_:1})]),_:1}),b(s(H),null,{default:C(()=>[b(s(D),{class:"stat-card",hoverable:""},{default:C(()=>[T("div",st,[T("div",nt,[b(s(E),{size:"18",component:s(me)},null,8,["component"])]),T("div",rt,[T("div",ot,O(n.statistics.runningServers||0),1),l[1]||(l[1]=T("div",{class:"stat-label"},"运行中",-1))])])]),_:1})]),_:1}),b(s(H),null,{default:C(()=>[b(s(D),{class:"stat-card",hoverable:""},{default:C(()=>[T("div",it,[T("div",ct,[b(s(E),{size:"18",component:s(be)},null,8,["component"])]),T("div",dt,[T("div",ut,O(n.statistics.stoppedServers||0),1),l[2]||(l[2]=T("div",{class:"stat-label"},"已停止",-1))])])]),_:1})]),_:1}),b(s(H),null,{default:C(()=>[b(s(D),{class:"stat-card",hoverable:""},{default:C(()=>[T("div",pt,[T("div",vt,[b(s(E),{size:"18",component:s(Le)},null,8,["component"])]),T("div",ft,[T("div",gt,O(n.statistics.totalConnections||0),1),l[3]||(l[3]=T("div",{class:"stat-label"},"总连接数",-1))])])]),_:1})]),_:1}),b(s(H),null,{default:C(()=>[b(s(D),{class:"stat-card",hoverable:""},{default:C(()=>[T("div",ht,[T("div",mt,[b(s(E),{size:"18",component:s(xe)},null,8,["component"])]),T("div",bt,[T("div",yt,O(i(n.statistics.totalBytesReceived)),1),l[4]||(l[4]=T("div",{class:"stat-label"},"接收流量",-1))])])]),_:1})]),_:1}),b(s(H),null,{default:C(()=>[b(s(D),{class:"stat-card",hoverable:""},{default:C(()=>[T("div",St,[T("div",wt,[b(s(E),{size:"18",component:s(Pe)},null,8,["component"])]),T("div",Tt,[T("div",Ct,O(i(n.statistics.totalBytesSent)),1),l[5]||(l[5]=T("div",{class:"stat-label"},"发送流量",-1))])])]),_:1})]),_:1})]),_:1})]))}}),_t=te(It,[["__scopeId","data-v-2ed12491"]]),X=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"}],J=[{label:"运行中",value:"running",type:"success"},{label:"已停止",value:"stopped",type:"warning"},{label:"错误",value:"error",type:"error"}],re=[{label:"轮询",value:"roundrobin"},{label:"最少连接",value:"leastconn"},{label:"随机",value:"random"}],Nt=[{label:"TCP",value:"tcp"},{label:"HTTP",value:"http"},{label:"HTTPS",value:"https"}];function kt(){const o="hub0061:static-server",i=k(!1),n=k([]),l=k(),c={fields:[{field:"serverName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:6,clearable:!0},{field:"listenAddress",label:"监听地址",type:"input",placeholder:"请输入监听地址",span:6,clearable:!0},{field:"serverType",label:"服务类型",type:"select",placeholder:"请选择服务类型",span:6,clearable:!0,options:[{label:"全部",value:""},...X.map(t=>({label:t.label,value:t.value}))]},{field:"serverStatus",label:"服务状态",type:"select",placeholder:"请选择服务状态",span:6,clearable:!0,options:[{label:"全部",value:""},...J.map(t=>({label:t.label,value:t.value}))]}],toolbarButtons:[{key:"add",label:"新增服务",icon:fe,type:"primary",tooltip:"新增静态服务"},{key:"start",label:"启动",icon:me,type:"success",tooltip:"启动选中的服务"},{key:"stop",label:"停止",icon:Fe,type:"warning",tooltip:"停止选中的服务"},{key:"reload",label:"重载",icon:Ve,type:"info",tooltip:"重载选中的服务配置"},{key:"delete",label:"删除",icon:ge,type:"error",tooltip:"删除选中的服务"}],showSearchButton:!0,showResetButton:!0},g=t=>{const e=J.find(a=>a.value===t);return(e==null?void 0:e.label)||t},v=t=>{const e=J.find(a=>a.value===t);return(e==null?void 0:e.type)||"default"},I=t=>{const e=X.find(a=>a.value===t);return(e==null?void 0:e.label)||t},m=t=>{if(!t)return"-";const e=re.find(a=>a.value===t);return(e==null?void 0:e.label)||t},N={columns:[{field:"tunnelStaticServerId",title:"服务ID",visible:!1,width:0},{field:"serverName",title:"服务名称",align:"center",showOverflow:"tooltip",width:180},{field:"listenAddress",title:"监听地址",align:"center",width:140,slots:{default:"listenAddress"}},{field:"serverType",title:"服务类型",align:"center",width:100,slots:{default:"serverType"}},{field:"serverStatus",title:"服务状态",align:"center",width:100,slots:{default:"serverStatus"}},{field:"nodeCount",title:"节点数",align:"center",width:80,slots:{default:"nodeCount"}},{field:"currentConnectionCount",title:"当前连接",align:"center",width:100},{field:"totalConnectionCount",title:"总连接数",align:"center",width:100},{field:"totalBytesReceived",title:"接收流量",align:"center",width:100,formatter:({row:t})=>q(t.totalBytesReceived)},{field:"totalBytesSent",title:"发送流量",align:"center",width:100,formatter:({row:t})=>q(t.totalBytesSent)},{field:"loadBalanceType",title:"负载均衡",align:"center",width:100,formatter:({row:t})=>m(t.loadBalanceType)},{field:"maxConnections",title:"最大连接",align:"center",width:100},{field:"activeFlag",title:"状态",align:"center",width:80,slots:{default:"activeFlag"}},{field:"serverDescription",title:"描述",align:"center",showOverflow:"tooltip",width:160},{field:"startTime",title:"启动时间",align:"center",formatter:({row:t})=>z(t.startTime),width:160},{field:"addTime",title:"创建时间",align:"center",formatter:({row:t})=>z(t.addTime),width:160}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:l,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"edit",name:"编辑",prefixIcon:"vxe-icon-edit"},{code:"nodes",name:"管理节点",prefixIcon:"vxe-icon-setting"},{code:"start",name:"启动",prefixIcon:"vxe-icon-caret-right"},{code:"stop",name:"停止",prefixIcon:"vxe-icon-square"},{code:"reload",name:"重载配置",prefixIcon:"vxe-icon-refresh"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function y(t){n.value=t}function L(t){i.value=t}function x(){l.value=void 0}function P(t){l.value?Object.assign(l.value,t):l.value=t}function F(t){n.value.push(t)}function K(t,e,a){const f=n.value.findIndex(w=>w.tunnelStaticServerId===t&&(!e||w.tenantId===e));f!==-1&&Object.assign(n.value[f],a)}function S(t){const e=n.value.findIndex(a=>a.tunnelStaticServerId===t);e>=0&&n.value.splice(e,1)}function h(t){n.value=n.value.filter(e=>!t.includes(e.tunnelStaticServerId))}const d=[{key:"basic",label:"基本信息"},{key:"network",label:"网络配置"},{key:"loadbalance",label:"负载均衡"},{key:"tls",label:"TLS配置",show:!1},{key:"other",label:"其他信息"}],p=[{field:"tunnelStaticServerId",label:"服务ID",type:"input",span:12,primary:!0,show:!1},{field:"serverName",label:"服务名称",type:"input",placeholder:"请输入服务名称",span:12,tabKey:"basic",required:!0,tips:"用于标识此静态代理服务的唯一名称，建议使用有意义的命名便于管理",rules:[{required:!0,message:"请输入服务名称",trigger:["blur","input"]},{max:100,message:"服务名称不能超过100个字符",trigger:["blur","input"]}]},{field:"serverType",label:"服务类型",type:"select",placeholder:"请选择服务类型",span:12,tabKey:"basic",required:!0,defaultValue:"tcp",tips:"TCP：适用于大多数场景如 SSH、数据库连接；UDP：适用于 DNS、游戏等场景",options:X.map(t=>({label:t.label,value:t.value})),rules:[{required:!0,message:"请选择服务类型",trigger:["blur","change"]}]},{field:"listenAddress",label:"监听地址",type:"input",placeholder:"请输入监听地址，如: 0.0.0.0",span:12,tabKey:"basic",required:!0,defaultValue:"0.0.0.0",tips:"代理服务监听的IP地址。0.0.0.0 表示监听所有网卡，127.0.0.1 仅本机访问",rules:[{required:!0,message:"请输入监听地址",trigger:["blur","input"]}]},{field:"listenPort",label:"监听端口",type:"number",placeholder:"请输入监听端口",span:12,tabKey:"basic",required:!0,tips:"代理服务监听的端口号（1-65535）。请确保端口未被占用，修改后需要重载配置",props:{min:1,max:65535,precision:0},rules:[{required:!0,type:"number",message:"请输入监听端口",trigger:["blur","change"]}]},{field:"activeFlag",label:"启用状态",type:"switch",span:12,tabKey:"basic",defaultValue:"Y",tips:"禁用后服务将不会接受新的连接请求",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"serverDescription",label:"服务描述",type:"input",placeholder:"请输入服务描述",span:24,tabKey:"basic",props:{type:"textarea",rows:2,maxlength:500,showCount:!0}},{field:"connectionTimeout",label:"连接超时(秒)",type:"number",placeholder:"请输入连接超时时间",span:12,tabKey:"network",defaultValue:30,tips:"建立到后端节点的连接超时时间。超时后将尝试下一个节点或返回错误",props:{min:1,precision:0}},{field:"maxConnections",label:"最大连接数",type:"number",placeholder:"请输入最大连接数，0表示不限制",span:12,tabKey:"network",defaultValue:0,show:!1,tips:"服务允许的最大并发连接数。0 表示不限制，建议根据服务器性能设置",props:{min:0,precision:0}},{field:"readTimeout",label:"读取超时(秒)",type:"number",placeholder:"请输入读取超时时间",span:12,tabKey:"network",defaultValue:60,show:!1,tips:"从连接读取数据的超时时间。对于长连接场景（如 SSH）建议设置较大值",props:{min:1,precision:0}},{field:"writeTimeout",label:"写入超时(秒)",type:"number",placeholder:"请输入写入超时时间",span:12,tabKey:"network",defaultValue:60,show:!1,tips:"向连接写入数据的超时时间。对于长连接场景（如 SSH）建议设置较大值",props:{min:1,precision:0}},{field:"logLevel",label:"日志级别",type:"select",placeholder:"请选择日志级别",span:12,tabKey:"network",defaultValue:"info",show:!1,tips:"服务的日志记录级别。Debug 记录最详细，Error 只记录错误",options:[{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warn"},{label:"Error",value:"error"}]},{field:"loadBalanceType",label:"负载均衡类型",type:"select",placeholder:"请选择负载均衡类型",span:12,tabKey:"loadbalance",defaultValue:"roundrobin",tips:"轮询：依次选择节点，适合节点性能相近场景；最少连接：选择当前连接最少的节点，适合请求处理时间不均匀场景；随机：随机选择节点",options:re.map(t=>({label:t.label,value:t.value}))},{field:"healthCheckType",label:"健康检查类型",type:"select",placeholder:"请选择健康检查类型",span:12,tabKey:"loadbalance",clearable:!0,tips:"TCP：尝试建立 TCP 连接验证节点可达性；HTTP/HTTPS：发送 HTTP 请求检查响应状态码（2xx/3xx 为健康）",options:Nt.map(t=>({label:t.label,value:t.value}))},{field:"healthCheckUrl",label:"健康检查URL",type:"input",placeholder:"请输入健康检查URL，如: /health",span:24,tabKey:"loadbalance",tips:"HTTP/HTTPS 健康检查的请求路径。留空时使用节点地址和端口的根路径。支持完整 URL 或相对路径",show:t=>t.healthCheckType==="http"||t.healthCheckType==="https"},{field:"healthCheckInterval",label:"检查间隔(秒)",type:"number",placeholder:"请输入健康检查间隔",span:12,tabKey:"loadbalance",defaultValue:30,tips:"健康检查的执行间隔。建议不低于 5 秒，避免对后端节点造成过大压力",show:t=>!!t.healthCheckType,props:{min:5,precision:0}},{field:"healthCheckTimeout",label:"检查超时(秒)",type:"number",placeholder:"请输入健康检查超时",span:12,tabKey:"loadbalance",defaultValue:5,tips:"单次健康检查的超时时间。超时后节点将被标记为不健康",show:t=>!!t.healthCheckType,props:{min:1,precision:0}},{field:"healthCheckMaxFailures",label:"最大失败次数",type:"number",placeholder:"请输入最大失败次数",span:12,tabKey:"loadbalance",defaultValue:3,show:!1,tips:"连续健康检查失败达到此次数后，节点将被标记为不健康并从负载均衡中移除",props:{min:1,precision:0}},{field:"tlsEnable",label:"启用TLS",type:"switch",span:12,tabKey:"tls",defaultValue:"N",show:!1,tips:"启用后代理服务将使用 TLS 加密传输。需要配置有效的证书和私钥",props:{checkedValue:"Y",uncheckedValue:"N"}},{field:"tlsCertFile",label:"证书文件路径",type:"input",placeholder:"请输入TLS证书文件路径",span:24,tabKey:"tls",show:!1,tips:"TLS 证书文件的绝对路径，支持 PEM 格式"},{field:"tlsKeyFile",label:"私钥文件路径",type:"input",placeholder:"请输入TLS私钥文件路径",span:24,tabKey:"tls",show:!1,tips:"TLS 私钥文件的绝对路径，支持 PEM 格式"},{field:"tlsCaFile",label:"CA证书路径",type:"input",placeholder:"请输入CA证书文件路径（可选）",span:24,tabKey:"tls",show:!1,tips:"CA 证书文件路径，用于客户端证书验证（双向 TLS）。留空表示不验证客户端证书"},{field:"noteText",label:"备注信息",type:"input",placeholder:"请输入备注信息",span:24,tabKey:"other",props:{type:"textarea",rows:3,maxlength:500,showCount:!0}},{field:"addTime",label:"创建时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"addWho",label:"创建人",type:"input",span:12,tabKey:"other",disabled:!0},{field:"editTime",label:"修改时间",type:"datetime",span:12,tabKey:"other",disabled:!0},{field:"editWho",label:"修改人",type:"input",span:12,tabKey:"other",disabled:!0}];return{moduleId:o,loading:i,serverList:n,pageInfo:l,searchFormConfig:c,gridConfig:N,formFields:p,formTabs:d,getServerStatusLabel:g,getServerStatusTagType:v,getServerTypeLabel:I,getLoadBalanceLabel:m,setServerList:y,setLoading:L,resetPagination:x,updatePagination:P,addServerToList:F,updateServerInList:K,removeServerFromList:S,removeServersFromList:h}}function Lt(o){const i=j(),n=oe(),l=kt(),{addServerToList:c,updateServerInList:g,removeServerFromList:v,removeServersFromList:I}=l,m=async d=>{var p,t,e;try{l.setLoading(!0);let a=d;!a&&((p=o==null?void 0:o.value)!=null&&p.getFormData)&&(a=o.value.getFormData()||{});const w={...a?Object.fromEntries(Object.entries(a).filter(([,u])=>u!==""&&u!==null&&u!==void 0)):{},...ce((t=l.pageInfo.value)==null?void 0:t.pageIndex,(e=l.pageInfo.value)==null?void 0:e.pageSize)},r=await Be(w);if(V(r)){const u=M(r,[])||[];l.setServerList(u);const _=ve(r);_&&Object.keys(_).length>0?l.updatePagination(_):l.resetPagination()}else i.error(A(r,"加载服务列表失败")),l.setServerList([]),l.resetPagination()}catch(a){console.error("加载服务列表失败:",a),i.error(a.message||"加载服务列表失败"),l.setServerList([]),l.resetPagination()}finally{l.setLoading(!1)}},N=async d=>{try{const p=await Ae(d);return V(p)?M(p):(i.error(A(p,"获取服务详情失败")),null)}catch(p){return console.error("获取服务详情失败:",p),i.error(p.message||"获取服务详情失败"),null}},y=async d=>{try{l.setLoading(!0);const p={...d,tenantId:"default"},t=await Me(p);if(V(t)){i.success("新增服务成功");const e=M(t,null);return e?c(e):await m(),!0}else return i.error(A(t,"新增服务失败")),!1}catch(p){return console.error("新增服务失败:",p),i.error(p.message||"新增服务失败"),!1}finally{l.setLoading(!1)}},L=async(d,p)=>{try{l.setLoading(!0);const t={...p,tunnelStaticServerId:d,tenantId:"default"},e=await De(t);if(V(e)){i.success("编辑服务成功");const a=M(e,null);return a?g(a.tunnelStaticServerId,a.tenantId,a):await m(),!0}else return i.error(A(e,"编辑服务失败")),!1}catch(t){return console.error("编辑服务失败:",t),i.error(t.message||"编辑服务失败"),!1}finally{l.setLoading(!1)}};return{model:l,loadServerList:m,getServerDetail:N,addServer:y,editServer:L,deleteServer:async d=>{if(!await n.warning({title:"确认删除",subtitle:"此操作不可恢复，请谨慎操作",content:`确定要删除静态服务 "${d.serverName}" 吗？`,icon:Oe,headerStyle:"gradient",positiveText:"确定删除",negativeText:"取消",width:500}))return!1;try{l.setLoading(!0);const t=await le(d.tunnelStaticServerId);return V(t)?(i.success("删除服务成功"),v(d.tunnelStaticServerId),l.serverList.value.length===0&&l.pageInfo.value&&l.pageInfo.value.pageIndex>1&&(l.updatePagination({pageIndex:l.pageInfo.value.pageIndex-1}),await m()),!0):(i.error(A(t,"删除服务失败")),!1)}catch(t){return console.error("删除服务失败:",t),i.error(t.message||"删除服务失败"),!1}finally{l.setLoading(!1)}},deleteServers:async d=>{try{l.setLoading(!0);const t=(await Promise.all(d.map(e=>le(e)))).filter(e=>V(e)).length;return t===d.length?(i.success(`成功删除 ${t} 个服务`),I(d),l.serverList.value.length===0&&l.pageInfo.value&&l.pageInfo.value.pageIndex>1&&(l.updatePagination({pageIndex:l.pageInfo.value.pageIndex-1}),await m()),!0):(i.warning(`部分删除成功：${t}/${d.length}`),await m(),!1)}catch(p){return console.error("批量删除服务失败:",p),i.error(p.message||"批量删除服务失败"),!1}finally{l.setLoading(!1)}},toggleServerStatus:async d=>{const p=d.activeFlag==="Y"?"N":"Y";return await L(d.tunnelStaticServerId,{...d,activeFlag:p})},startServer:async d=>{if(!await n.warning({title:"确认启动",subtitle:"启动后将开始监听客户端连接",content:`确定要启动静态服务 "${d.serverName}" 吗？`,icon:ke,headerStyle:"gradient",positiveText:"确定启动",negativeText:"取消",width:500}))return!1;try{l.setLoading(!0);const t=await He(d.tunnelStaticServerId);if(V(t)){i.success("服务启动成功");const e=M(t,null);return e?g(e.tunnelStaticServerId,e.tenantId,e):await m(),!0}else return i.error(A(t,"服务启动失败")),!1}catch(t){return console.error("服务启动失败:",t),i.error(t.message||"服务启动失败"),!1}finally{l.setLoading(!1)}},stopServer:async d=>{if(!await n.warning({title:"确认停止",subtitle:"停止后将断开所有客户端连接",content:`确定要停止静态服务 "${d.serverName}" 吗？`,icon:be,headerStyle:"gradient",positiveText:"确定停止",negativeText:"取消",width:500}))return!1;try{l.setLoading(!0);const t=await Ue(d.tunnelStaticServerId);if(V(t)){i.success("服务停止成功");const e=M(t,null);return e?g(e.tunnelStaticServerId,e.tenantId,e):await m(),!0}else return i.error(A(t,"服务停止失败")),!1}catch(t){return console.error("服务停止失败:",t),i.error(t.message||"服务停止失败"),!1}finally{l.setLoading(!1)}},reloadServer:async d=>{if(!await n.warning({title:"确认重载",subtitle:"重载配置将应用最新的服务配置",content:`确定要重载静态服务 "${d.serverName}" 的配置吗？`,icon:Ne,headerStyle:"gradient",positiveText:"确定重载",negativeText:"取消",width:500}))return!1;try{l.setLoading(!0);const t=await $e(d.tunnelStaticServerId);if(V(t)){i.success("服务配置重载成功");const e=M(t,null);return e?g(e.tunnelStaticServerId,e.tenantId,e):await m(),!0}else return i.error(A(t,"服务配置重载失败")),!1}catch(t){return console.error("服务配置重载失败:",t),i.error(t.message||"服务配置重载失败"),!1}finally{l.setLoading(!1)}}}}function xt(o,i){const n=j(),l=Lt(i),c=k(!1),g=k("create"),v=k(null),I=k(!1),m=k(null),N=async r=>{l.model.resetPagination(),await l.loadServerList(r)},y=async({currentPage:r,pageSize:u})=>{l.model.updatePagination({pageIndex:r,pageSize:u}),await l.loadServerList()},L=async(r,u)=>{switch(r){case"add":x();break;case"start":{if(!(o!=null&&o.value)){n.warning("Grid 引用未设置");return}const _=o.value.getCurrentRecord();if(!_){n.warning("请先点击选择要启动的服务");return}await t(_);break}case"stop":{if(!(o!=null&&o.value)){n.warning("Grid 引用未设置");return}const _=o.value.getCurrentRecord();if(!_){n.warning("请先点击选择要停止的服务");return}await e(_);break}case"reload":{if(!(o!=null&&o.value)){n.warning("Grid 引用未设置");return}const _=o.value.getCurrentRecord();if(!_){n.warning("请先点击选择要重载的服务");return}await a(_);break}case"delete":{if(!(o!=null&&o.value)){n.warning("Grid 引用未设置");return}const _=o.value.getCurrentRecord();if(!_){n.warning("请先点击选择要删除的服务");return}await f(_);break}case"search":{await N(u);break}default:console.warn("未知的工具栏按钮:",r)}},x=()=>{g.value="create",v.value=null,c.value=!0},P=async r=>{if(!r.tunnelStaticServerId){n.warning("服务ID不能为空");return}try{const u=await l.getServerDetail(r.tunnelStaticServerId);u?(g.value="edit",v.value=u,c.value=!0):(g.value="edit",v.value=r,c.value=!0)}catch{g.value="edit",v.value=r,c.value=!0}},F=async r=>{if(!r.tunnelStaticServerId){n.warning("服务ID不能为空");return}try{const u=await l.getServerDetail(r.tunnelStaticServerId);u?(g.value="view",v.value=u,c.value=!0):(g.value="view",v.value=r,c.value=!0)}catch{g.value="view",v.value=r,c.value=!0}},K=()=>{c.value=!1,v.value=null},S=r=>{m.value=r,I.value=!0},h=()=>{I.value=!1,m.value=null},d=async r=>{if(r){if(g.value==="view"){K();return}try{const u={tunnelStaticServerId:r.tunnelStaticServerId,serverName:r.serverName,serverDescription:r.serverDescription,listenAddress:r.listenAddress,listenPort:r.listenPort,serverType:r.serverType,maxConnections:r.maxConnections,connectionTimeout:r.connectionTimeout,readTimeout:r.readTimeout,writeTimeout:r.writeTimeout,tlsEnable:r.tlsEnable,tlsCertFile:r.tlsCertFile,tlsKeyFile:r.tlsKeyFile,tlsCaFile:r.tlsCaFile,logLevel:r.logLevel,healthCheckType:r.healthCheckType,healthCheckUrl:r.healthCheckUrl,healthCheckInterval:r.healthCheckInterval,healthCheckTimeout:r.healthCheckTimeout,healthCheckMaxFailures:r.healthCheckMaxFailures,loadBalanceType:r.loadBalanceType,activeFlag:r.activeFlag,noteText:r.noteText};let _=!1;g.value==="create"?_=await l.addServer(u):g.value==="edit"&&v.value&&(_=await l.editServer(v.value.tunnelStaticServerId,u)),_&&K()}catch(u){console.error("提交服务配置失败:",u),n.error(u.message||"提交失败，请重试")}}},p=async({menu:r,row:u})=>{const _=(r==null?void 0:r.code)||r;switch(_){case"view":await F(u);break;case"edit":await P(u);break;case"nodes":S(u);break;case"start":await t(u);break;case"stop":await e(u);break;case"reload":await a(u);break;case"toggle-status":await w(u);break;case"delete":await f(u);break;default:console.warn("未知的菜单项:",_)}},t=async r=>{await l.startServer(r)},e=async r=>{await l.stopServer(r)},a=async r=>{await l.reloadServer(r)},f=async r=>{await l.deleteServer(r)},w=async r=>{await l.toggleServerStatus(r)};return{service:l,formDialogVisible:c,formDialogMode:g,currentEditServer:v,nodeDialogVisible:I,currentNodeServer:m,handleSearch:N,handlePageChange:y,handleToolbarClick:L,handleMenuClick:p,openAddDialog:x,openEditDialog:P,openViewDialog:F,closeFormDialog:K,openNodeDialog:S,closeNodeDialog:h,handleFormSubmit:d,handleStart:t,handleStop:e,handleReload:a,handleDelete:f,handleToggleStatus:w}}const Pt=["id"],Kt={class:"bottom-section"},Ft={key:0,class:"stats-section"},Vt={class:"grid-section"},Ot={class:"text-primary font-mono"},Bt=ee({name:"StaticMappingManagement",__name:"StaticMappingManagement",setup(o){const i=k(),n=k(),l=k(!0),c=k({totalServers:0,runningServers:0,stoppedServers:0,totalConnections:0,totalBytesReceived:0,totalBytesSent:0}),g=async()=>{try{const a=await Ee();if(a.oK){const f=M(a);f&&(c.value=f)}}catch(a){console.error("加载统计数据失败:",a)}},{service:v,formDialogVisible:I,formDialogMode:m,currentEditServer:N,nodeDialogVisible:y,currentNodeServer:L,handleFormSubmit:x,handleToolbarClick:P,handleMenuClick:F,handleSearch:K,handlePageChange:S,handleToggleStatus:h,openNodeDialog:d,closeNodeDialog:p}=xt(n,i),t=async a=>{await K(a),await g()},e=async()=>{await v.loadServerList(),await g()};return(a,f)=>{var w,r;return Y(),Z("div",{class:"static-server-management",id:s(v).model.moduleId},[b(s(de),{direction:"vertical","default-size":.12,min:.1,max:.5},{1:C(()=>[b(pe,G({ref_key:"searchFormRef",ref:i,"module-id":s(v).model.moduleId},s(v).model.searchFormConfig,{onSearch:t,onToolbarClick:s(P)}),null,16,["module-id","onToolbarClick"])]),2:C(()=>[T("div",Kt,[l.value?(Y(),Z("div",Ft,[b(s(_t),{statistics:c.value},null,8,["statistics"])])):Ce("",!0),T("div",Vt,[b(s(ue),G({ref_key:"gridRef",ref:n,"module-id":s(v).model.moduleId,data:s(v).model.serverList,loading:s(v).model.loading},s(v).model.gridConfig,{onPageChange:s(S),onMenuClick:f[0]||(f[0]=({code:u,row:_})=>s(F)({menu:{code:u},row:_}))}),{listenAddress:C(({row:u})=>[T("span",Ot,O(u.listenAddress)+":"+O(u.listenPort),1)]),serverType:C(({row:u})=>[b(s($),{type:u.serverType==="tcp"?"primary":"info",size:"small"},{default:C(()=>[U(O(s(v).model.getServerTypeLabel(u.serverType)),1)]),_:2},1032,["type"])]),serverStatus:C(({row:u})=>[b(s($),{type:s(v).model.getServerStatusTagType(u.serverStatus),size:"small"},{default:C(()=>[U(O(s(v).model.getServerStatusLabel(u.serverStatus)),1)]),_:2},1032,["type"])]),nodeCount:C(({row:u})=>[b(s(Ie),{text:"",type:"primary",onClick:_=>s(d)(u)},{default:C(()=>[U(O(u.nodeCount||0)+" 个节点 ",1)]),_:2},1032,["onClick"])]),activeFlag:C(({row:u})=>[b(s(he),{value:u.activeFlag==="Y","onUpdate:value":()=>s(h)(u),size:"small"},null,8,["value","onUpdate:value"])]),_:1},16,["module-id","data","loading","onPageChange"])])])]),_:1}),b(ie,{visible:s(I),"onUpdate:visible":f[1]||(f[1]=u=>Q(I)?I.value=u:null),mode:s(m),title:s(m)==="create"?"新增静态服务":s(m)==="edit"?"编辑静态服务":"查看静态服务详情",to:`#${s(v).model.moduleId}`,"form-fields":s(v).model.formFields,"form-tabs":s(v).model.formTabs,"initial-data":s(N)||void 0,"auto-close-on-confirm":!1,"confirm-loading":s(v).model.loading.value,onSubmit:s(x)},null,8,["visible","mode","title","to","form-fields","form-tabs","initial-data","confirm-loading","onSubmit"]),b(s(Qe),{visible:s(y),"onUpdate:visible":f[2]||(f[2]=u=>Q(y)?y.value=u:null),"tunnel-static-server-id":((w=s(L))==null?void 0:w.tunnelStaticServerId)||"","server-name":((r=s(L))==null?void 0:r.serverName)||"",to:`#${s(v).model.moduleId}`,onClose:s(p),onRefresh:e},null,8,["visible","tunnel-static-server-id","server-name","to","onClose"])],8,Pt)}}}),ra=te(Bt,[["__scopeId","data-v-e8279b61"]]);export{ra as default};

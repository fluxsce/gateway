import{d as G,c as q,o as M,a as n,s as ue,u as we,b as be,e as de,r as k,f as he,g as ae,h as ye,l,i as E,j as ke,k as ge,m as s,n as e,N as Ce,w as i,p as xe,q as se,t as re,v as F,x as m,y as Me,_ as fe,z as Te,D as Le,P as Se,A as Ie,B as Pe,C as Re,E as De,F as Y,S as Fe,G as qe,H as ze,I as ee,K as Ke,J as Ae,L as Be}from"./index-BWGkTP3E.js";import{S as Ne}from"./ShieldCheckmarkOutline-p2P-FjJl.js";const Ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$e=G({name:"LockClosedOutline",render:function(h,a){return M(),q("svg",Ue,a[0]||(a[0]=[n("path",{d:"M336 208v-95a80 80 0 0 0-160 0v95",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),n("rect",{x:"96",y:"208",width:"320",height:"272",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ve=G({name:"PersonOutline",render:function(h,a){return M(),q("svg",Oe,a[0]||(a[0]=[n("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),n("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ye=G({name:"PhonePortraitOutline",render:function(h,a){return M(),q("svg",Ee,a[0]||(a[0]=[n("rect",{x:"128",y:"16",width:"256",height:"480",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),n("path",{d:"M176 16h24a8 8 0 0 1 8 8h0a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16h0a8 8 0 0 1 8-8h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),pe={login(b){return ue({url:"/gateway/user/login",method:"post",data:b})},getCaptcha(){return ue({url:"/gateway/user/captcha",method:"post",params:{t:new Date().getTime()}})}};function me(b){if(b.oK&&b.state&&b.bizData)try{return JSON.parse(b.bizData)}catch{return null}return null}function Ge(){const b=we(),h=be(),{t:a}=de("hub0001"),{t:z}=de("common"),L=k(null),S=k(null),y=k(!1),p=k(!1),C=k(""),X=k(""),W=k(0),U=k(""),I=k(!1),P=k(60),J=he({userId:"",password:"",captchaCode:"",rememberMe:!1}),x=he({phone:"",code:"",rememberMe:!1}),$=ae(()=>({userId:[{required:!0,message:a("validation.userIdRequired"),trigger:"blur"},{min:3,max:20,message:a("validation.userIdLength"),trigger:"blur"}],password:[{required:!0,message:a("validation.passwordRequired"),trigger:"blur"},{min:6,max:32,message:a("validation.passwordLength"),trigger:"blur"}],captchaCode:[{required:!0,message:a("validation.captchaRequired"),trigger:"blur"},{len:6,message:a("validation.captchaLength"),trigger:"blur"}]})),te=ae(()=>({phone:[{required:!0,message:a("validation.phoneRequired"),trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:a("validation.phoneFormat"),trigger:"blur"}],code:[{required:!0,message:a("validation.codeRequired"),trigger:"blur"},{len:6,message:a("validation.codeLength"),trigger:"blur"}]})),j=async c=>new Promise(g=>{requestAnimationFrame(()=>{try{const o=document.createElement("canvas"),t=o.getContext("2d");if(!t){g("");return}o.width=140,o.height=50;const O=t.createLinearGradient(0,0,o.width,o.height);O.addColorStop(0,"#f8f9fa"),O.addColorStop(.3,"#e9ecef"),O.addColorStop(.7,"#dee2e6"),O.addColorStop(1,"#ced4da"),t.fillStyle=O,t.fillRect(0,0,o.width,o.height);for(let d=0;d<100;d++)t.fillStyle=`rgba(${Math.random()*50+200}, ${Math.random()*50+200}, ${Math.random()*50+200}, 0.1)`,t.fillRect(Math.random()*o.width,Math.random()*o.height,2,2);t.strokeStyle="rgba(78, 67, 118, 0.4)",t.lineWidth=2;for(let d=0;d<5;d++){t.beginPath();const _=Math.random()*o.width,v=Math.random()*o.height,w=Math.random()*o.width,u=Math.random()*o.height,V=Math.random()*o.width,T=Math.random()*o.height,ne=Math.random()*o.width,ve=Math.random()*o.height;t.moveTo(_,v),t.bezierCurveTo(w,u,V,T,ne,ve),t.stroke()}t.strokeStyle="rgba(78, 67, 118, 0.3)",t.lineWidth=1.5;for(let d=0;d<3;d++){t.beginPath(),t.moveTo(0,o.height/2+Math.sin(d)*10);for(let _=0;_<=o.width;_+=5){const v=o.height/2+Math.sin((_+d*50)*.02)*15+Math.random()*10-5;t.lineTo(_,v)}t.stroke()}const le=["circle","rect","triangle","star"];for(let d=0;d<15;d++){const _=le[Math.floor(Math.random()*le.length)],v=Math.random()*o.width,w=Math.random()*o.height,u=Math.random()*8+2;switch(t.fillStyle=`rgba(78, 67, 118, ${Math.random()*.3+.1})`,t.beginPath(),_){case"circle":t.arc(v,w,u,0,2*Math.PI);break;case"rect":t.rect(v-u/2,w-u/2,u,u);break;case"triangle":t.moveTo(v,w-u),t.lineTo(v-u,w+u),t.lineTo(v+u,w+u),t.closePath();break;case"star":t.moveTo(v,w-u),t.lineTo(v+u/3,w+u/3),t.lineTo(v-u,w),t.lineTo(v+u,w),t.lineTo(v-u/3,w+u/3),t.closePath();break}t.fill()}const _e=c.split(""),Z=["#4e4376","#5a4e8c","#6b5b95","#7b68a2","#8b789f","#9b88b2"],ie=["bold 24px Georgia",'bold 22px "Times New Roman"',"bold 26px Arial","bold 23px Verdana"];_e.forEach((d,_)=>{const v=15+_*20,w=o.height/2+(Math.random()-.5)*8;t.font=ie[Math.floor(Math.random()*ie.length)],t.textAlign="center",t.textBaseline="middle";const u=(Math.random()-.5)*.6;t.save(),t.translate(v,w),t.rotate(u),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillText(d,2,2),t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=3,t.strokeText(d,0,0),t.fillStyle=Z[_%Z.length],t.fillText(d,0,0),t.shadowColor=Z[_%Z.length],t.shadowBlur=3,t.fillText(d,0,0),t.restore()});const ce=t.getImageData(0,0,o.width,o.height),N=ce.data;for(let d=0;d<o.height;d++)for(let _=0;_<o.width;_++){const v=Math.sin(_*.1)*2,w=Math.min(Math.max(d+v,0),o.height-1);if(w!==d){const u=(d*o.width+_)*4,V=(Math.floor(w)*o.width+_)*4;if(V<N.length&&u<N.length)for(let T=0;T<4;T++){const ne=N[u+T];N[u+T]=N[V+T],N[V+T]=ne}}}t.putImageData(ce,0,0),l.debug("复杂验证码Canvas生成完成"),g(o.toDataURL("image/png"))}catch(o){l.error("Canvas验证码生成失败:",o),g("")}})});let K=null;const r=async()=>{K&&clearTimeout(K),K=setTimeout(async()=>{try{l.info("开始刷新验证码");const c=await pe.getCaptcha();l.debug("验证码API响应:",c);const g=me(c);if(g&&c.oK){if(X.value=g.code,C.value=g.captchaId,W.value=g.expireAt,l.info("验证码数据更新成功",{captchaId:g.captchaId,hasCode:!!g.code}),g.code){const o=async()=>{try{const t=await j(g.code);U.value=t,l.debug("验证码Canvas生成并更新完成")}catch(t){l.error("Canvas生成异常:",t),U.value=""}};"requestIdleCallback"in window?requestIdleCallback(o,{timeout:3e3}):setTimeout(o,500)}}else l.warn("验证码响应无效",c)}catch(c){l.error("刷新验证码失败:",c)}finally{K=null}},300)},A=async()=>{if(L.value)try{l.info("开始表单验证"),await L.value.validate(),l.info("表单验证通过"),await H(J)}catch(c){l.warn("表单验证失败:",c)}},H=async c=>{y.value=!0,l.info("开始执行登录",{userId:c.userId});try{const g={...c,captchaId:C.value},o=await pe.login(g),t=me(o);return t&&o.oK?(console.log("登录返回的用户对象:",t),await E.user.setLoginState({user:t,remember:c.rememberMe}),console.log("设置后的store用户信息:",E.user.userInfo),console.log("登录状态:",E.user.isLoggedIn),h.success(o.popMsg||a("login.loginSuccess")),l.info("登录成功",{userId:t.userId}),E.global.setPageTitle("首页"),b.push({path:"/dashboard"}),!0):(h.error(o.errMsg||o.popMsg||a("login.loginFailed")),l.warn("登录失败",{errMsg:o.errMsg,popMsg:o.popMsg}),r(),!1)}catch(g){return l.error("登录请求异常:",g),h.error(g.message||a("login.networkError")),r(),!1}finally{y.value=!1}},f=async()=>{if(!x.phone){h.error(a("validation.phoneRequired"));return}if(!/^1[3-9]\d{9}$/.test(x.phone)){h.error(a("validation.phoneFormat"));return}I.value=!0,l.info("发送手机验证码",{phone:x.phone});try{await new Promise(g=>setTimeout(g,500)),h.success(a("login.codeSent")),l.info("验证码发送成功"),P.value=60;const c=setInterval(()=>{P.value--,P.value<=0&&(clearInterval(c),I.value=!1)},1e3)}catch(c){l.error("验证码发送失败:",c),h.error(a("login.codeSendFailed")),I.value=!1}},R=async()=>{if(S.value)try{l.info("开始手机登录表单验证"),await S.value.validate(),await D()}catch(c){l.warn("手机登录表单验证失败:",c)}},D=async()=>{p.value=!0,l.info("开始执行手机登录",{phone:x.phone});try{return!0}catch(c){return l.error("手机登录失败:",c),h.error(c.message||a("login.loginFailed")),!1}finally{p.value=!1}},oe=()=>{l.info("尝试微信登录"),h.info(a("login.wechatRedirect"))},B=()=>{l.info("跳转到忘记密码页面"),b.push({path:"/hub0001/forgot-password"})},Q=()=>{E.user.isLoggedIn&&(l.info("用户已登录，重定向到首页"),window.location.href="/dashboard")};return ye(()=>{l.info("LoginAuth组件挂载，开始初始化"),Q(),requestAnimationFrame(()=>{setTimeout(()=>{r()},200)})}),{formRef:L,phoneFormRef:S,formData:J,phoneFormData:x,rules:$,phoneRules:te,loading:y,phoneLoading:p,captchaCode:X,captchaUrl:U,captchaExpireAt:W,codeSending:I,countdown:P,handleLogin:A,handlePhoneLogin:R,sendVerificationCode:f,handleWechatLogin:oe,refreshCaptcha:r,goToForgotPassword:B,tCommon:z,t:a}}const Xe={class:"language-switcher"},We={class:"current-language"},Je=G({__name:"LanguageSwitcher",setup(b){const h=ke(),a=k(!1),z=ae(()=>h.settings.language);function L(){const p=ge.find(C=>C.locale===z.value);return p?p.name:"Unknown"}const S=ge.map(p=>({key:p.locale,label:p.name}));async function y(p){if(p!==z.value){a.value=!0;try{await h.updateSettings({language:p}),await Me(p)}finally{a.value=!1}}}return(p,C)=>(M(),q("div",Xe,[s(e(Ce),{trigger:"click",options:e(S),onSelect:y},{default:i(()=>[n("div",{class:xe(["language-selector",{"is-loading":a.value}])},[a.value?(M(),se(e(F),{key:0,size:"16",class:"loading-icon"},{default:i(()=>C[0]||(C[0]=[n("i",{class:"fas fa-circle-notch fa-spin"},null,-1)])),_:1})):re("",!0),n("span",We,m(L()),1),s(e(F),{size:"12"},{default:i(()=>C[1]||(C[1]=[n("i",{class:"fas fa-chevron-down"},null,-1)])),_:1})],2)]),_:1},8,["options"])]))}}),je=fe(Je,[["__scopeId","data-v-ad607801"]]),He={class:"login-view"},Qe={class:"global-language-switch"},Ze={class:"welcome-area"},et={class:"welcome-content"},tt={class:"title"},ot={class:"subtitle"},nt={class:"features"},at={class:"feature-item"},st={class:"feature-icon"},rt={class:"feature-text"},lt={class:"feature-item"},it={class:"feature-icon"},ct={class:"feature-text"},ut={class:"feature-item"},dt={class:"feature-icon"},ht={class:"feature-text"},gt={class:"form-area"},pt={class:"form-container"},mt={class:"form-header"},ft={class:"captcha-area"},_t=["src"],vt={key:1,class:"captcha-loading"},wt={class:"form-options"},bt={class:"verification-area"},yt={class:"form-footer"},kt={class:"copyright"},Ct=G({__name:"LoginView",setup(b){const h=k("account");let a=null;const z=H=>{a&&clearTimeout(a),requestAnimationFrame(()=>{a=setTimeout(()=>{h.value=H,a=null,Be(()=>{})},50)})},{formRef:L,phoneFormRef:S,formData:y,phoneFormData:p,rules:C,phoneRules:X,loading:W,phoneLoading:U,captchaUrl:I,codeSending:P,countdown:J,handleLogin:x,handlePhoneLogin:$,sendVerificationCode:te,refreshCaptcha:j,goToForgotPassword:K,t:r,tCommon:A}=Ge();return(H,f)=>{const R=De,D=Re,oe=qe,B=ze,Q=Pe,c=Ie,g=Ae;return M(),q("div",He,[n("div",Qe,[s(je)]),n("div",Ze,[f[7]||(f[7]=n("div",{class:"logo-area"},[n("img",{src:Te,alt:"Logo"}),n("h3",{class:"logo-text"},"FLUX Datahub Gateway")],-1)),n("div",et,[n("h1",tt,m(e(r)("login.welcomeTitle")),1),n("p",ot,m(e(r)("login.welcomeSubtitle")),1),n("div",nt,[n("div",at,[n("div",st,[s(e(Ne))]),n("div",rt,[n("h3",null,m(e(r)("login.featureSecurityTitle")),1),n("p",null,m(e(r)("login.featureSecurityDesc")),1)])]),n("div",lt,[n("div",it,[s(e(Le))]),n("div",ct,[n("h3",null,m(e(r)("login.featureAnalyticsTitle")),1),n("p",null,m(e(r)("login.featureAnalyticsDesc")),1)])]),n("div",ut,[n("div",dt,[s(e(Se))]),n("div",ht,[n("h3",null,m(e(r)("login.featureCollaborationTitle")),1),n("p",null,m(e(r)("login.featureCollaborationDesc")),1)])])])])]),n("div",gt,[n("div",pt,[n("div",mt,[n("h2",null,m(e(r)("login.loginTitle")||e(r)("login.title")),1),n("p",null,m(e(r)("login.loginSubtitle")||e(r)("login.subtitle")),1)]),s(g,{value:h.value,"onUpdate:value":[f[6]||(f[6]=o=>h.value=o),z],animated:!1,"justify-content":"space-evenly",size:"small",class:"login-tabs",type:"line"},{default:i(()=>[s(c,{name:"account",tab:e(r)("login.accountLogin")},{default:i(()=>[h.value==="account"?(M(),se(Q,{key:0,ref_key:"formRef",ref:L,model:e(y),rules:e(C),size:"large",class:"login-form"},{default:i(()=>[s(D,{path:"userId"},{default:i(()=>[s(R,{value:e(y).userId,"onUpdate:value":f[0]||(f[0]=o=>e(y).userId=o),placeholder:e(r)("login.userId"),onKeyup:Y(e(x),["enter"])},{prefix:i(()=>[s(e(F),null,{default:i(()=>[s(e(Ve))]),_:1})]),_:1},8,["value","placeholder","onKeyup"])]),_:1}),s(D,{path:"password"},{default:i(()=>[s(R,{value:e(y).password,"onUpdate:value":f[1]||(f[1]=o=>e(y).password=o),type:"password","show-password-on":"mousedown",placeholder:e(r)("login.password"),onKeyup:Y(e(x),["enter"])},{prefix:i(()=>[s(e(F),null,{default:i(()=>[s(e($e))]),_:1})]),_:1},8,["value","placeholder","onKeyup"])]),_:1}),s(D,{path:"captcha"},{default:i(()=>[n("div",ft,[s(R,{value:e(y).captchaCode,"onUpdate:value":f[2]||(f[2]=o=>e(y).captchaCode=o),placeholder:e(r)("login.captcha"),onKeyup:Y(e(x),["enter"])},{prefix:i(()=>[s(e(F),null,{default:i(()=>[s(e(Fe))]),_:1})]),_:1},8,["value","placeholder","onKeyup"]),n("div",{class:"captcha-img",onClick:f[3]||(f[3]=(...o)=>e(j)&&e(j)(...o))},[e(I)?(M(),q("img",{key:0,src:e(I),alt:"Captcha"},null,8,_t)):(M(),q("div",vt,[s(oe,{size:"small"})]))])])]),_:1}),n("div",wt,[s(B,{text:"",onClick:e(K),class:"forgot-btn"},{default:i(()=>[ee(m(e(r)("login.forgotPassword")),1)]),_:1},8,["onClick"])]),s(B,{type:"primary",size:"large",block:"",loading:e(W),onClick:e(x),class:"login-btn"},{default:i(()=>[ee(m(e(r)("login.loginButton")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules"])):re("",!0)]),_:1},8,["tab"]),s(c,{name:"phone",tab:e(r)("login.phoneLogin")},{default:i(()=>[h.value==="phone"?(M(),se(Q,{key:0,ref_key:"phoneFormRef",ref:S,model:e(p),rules:e(X),size:"large",class:"login-form"},{default:i(()=>[s(D,{path:"phone"},{default:i(()=>[s(R,{value:e(p).phone,"onUpdate:value":f[4]||(f[4]=o=>e(p).phone=o),placeholder:e(r)("login.phoneNumber"),onKeyup:Y(e($),["enter"])},{prefix:i(()=>[s(e(F),null,{default:i(()=>[s(e(Ye))]),_:1})]),_:1},8,["value","placeholder","onKeyup"])]),_:1}),s(D,{path:"code"},{default:i(()=>[n("div",bt,[s(R,{value:e(p).code,"onUpdate:value":f[5]||(f[5]=o=>e(p).code=o),placeholder:e(r)("login.verificationCode"),onKeyup:Y(e($),["enter"])},{prefix:i(()=>[s(e(F),null,{default:i(()=>[s(e(Ke))]),_:1})]),_:1},8,["value","placeholder","onKeyup"]),s(B,{class:"verification-btn",disabled:e(P),onClick:e(te)},{default:i(()=>[ee(m(e(P)?`${e(J)}s`:e(r)("login.sendCode")),1)]),_:1},8,["disabled","onClick"])])]),_:1}),s(B,{type:"primary",size:"large",block:"",loading:e(U),onClick:e($),class:"login-btn"},{default:i(()=>[ee(m(e(r)("login.loginButton")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules"])):re("",!0)]),_:1},8,["tab"])]),_:1},8,["value"]),n("div",yt,[n("p",kt," © "+m(new Date().getFullYear())+" "+m(e(A)("common.companyName"))+". "+m(e(A)("common.copyright"))+" "+m(e(A)("common.version"))+": "+m(e(A)("common.versionNumber")),1)])])])])}}}),Tt=fe(Ct,[["__scopeId","data-v-96b5a6e2"]]);export{Tt as default};

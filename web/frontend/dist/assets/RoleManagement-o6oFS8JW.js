import{q as kt,b as Tt,d as Ct,R as ze,D as Ve,u as wt,a as xt,c as Rt,g as It,e as _t,S as Nt,f as Ot}from"./index-CAe3-ZQE.js";import{at as Pt,aq as ye,ar as be,av as Kt,d as pe,a8 as U,aT as Ft,aU as Ut,aV as At,aW as Ce,ap as Dt,aX as Et,aZ as Bt,aw as Ee,az as Lt,r as m,aA as Mt,b2 as zt,b3 as Vt,ag as Se,a$ as ke,g as P,b1 as jt,aC as je,cS as $t,aH as qt,b4 as Wt,U as Yt,b7 as Y,b5 as Ht,b6 as Jt,aI as Be,a6 as Qt,b as he,cT as Zt,f as $e,a0 as X,a1 as we,a2 as se,R as qe,q as xe,w as n,n as t,o as ce,m as a,t as Xt,C as O,E as Z,cz as Gt,J as x,B as Re,I as A,x as oe,bR as fe,co as We,O as el,cw as tl,_ as Ie,a as Te,H as ll,V as ne,bS as al,bT as ue,h as ol,c as nl,v as ae,cU as rl,cr as sl}from"./index-DKB7UIvv.js";import{N as Ye,c as il,u as dl,t as ul,a as cl}from"./Tree-BZaeKT8o.js";import{e as fl,F as vl,u as pl,_ as re,b as He,a as ve}from"./RadioGroup-Uptj_IsJ.js";import{N as hl}from"./InputNumber-C6uuw51c.js";import{N as gl}from"./DatePicker-BuSMpi88.js";import{R as ml}from"./RefreshOutline-BQaQU9jK.js";import{A as yl}from"./AddOutline-D1j_oocY.js";import{T as bl}from"./TrashOutline-DiWbiE7R.js";import{R as Sl}from"./ReloadOutline-BtO4rash.js";import{_ as kl}from"./DataTable-Zlk1n-G1.js";import"./Popconfirm-BsPxzeLw.js";const Tl=Pt([ye("tree-select",`
 z-index: auto;
 outline: none;
 width: 100%;
 position: relative;
 `),ye("tree-select-menu",`
 position: relative;
 overflow: hidden;
 margin: 4px 0;
 transition: box-shadow .3s var(--n-bezier), background-color .3s var(--n-bezier);
 border-radius: var(--n-menu-border-radius);
 box-shadow: var(--n-menu-box-shadow);
 background-color: var(--n-menu-color);
 outline: none;
 `,[ye("tree","max-height: var(--n-menu-height);"),be("empty",`
 display: flex;
 padding: 12px 32px;
 flex: 1;
 justify-content: center;
 `),be("header",`
 padding: var(--n-header-padding);
 transition: 
 color .3s var(--n-bezier);
 border-color .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-header-divider-color);
 color: var(--n-header-text-color);
 `),be("action",`
 padding: var(--n-action-padding);
 transition: 
 color .3s var(--n-bezier);
 border-color .3s var(--n-bezier);
 border-top: 1px solid var(--n-action-divider-color);
 color: var(--n-action-text-color);
 `),Kt()])]);function Le(l,y){const{rawNode:u}=l;return Object.assign(Object.assign({},u),{label:u[y],value:l.key})}function Me(l,y,u,S){const{rawNode:p}=l;return Object.assign(Object.assign({},p),{value:l.key,label:y.map(R=>R.rawNode[S]).join(u)})}const Cl=Object.assign(Object.assign(Object.assign(Object.assign({},je.props),{bordered:{type:Boolean,default:!0},cascade:Boolean,checkable:Boolean,clearable:Boolean,clearFilterAfterSelect:{type:Boolean,default:!0},consistentMenuWidth:{type:Boolean,default:!0},defaultShow:Boolean,defaultValue:{type:[String,Number,Array],default:null},disabled:{type:Boolean,default:void 0},filterable:Boolean,checkStrategy:{type:String,default:"all"},loading:Boolean,maxTagCount:[String,Number],multiple:Boolean,showPath:Boolean,separator:{type:String,default:" / "},options:{type:Array,default:()=>[]},placeholder:String,placement:{type:String,default:"bottom-start"},show:{type:Boolean,default:void 0},size:String,value:[String,Number,Array],to:Ce.propTo,menuProps:Object,virtualScroll:{type:Boolean,default:!0},status:String,renderTag:Function,ellipsisTagPopoverProps:Object}),ul),{renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,watchProps:Array,getChildren:Function,onBlur:Function,onFocus:Function,onLoad:Function,onUpdateShow:[Function,Array],onUpdateValue:[Function,Array],"onUpdate:value":[Function,Array],"onUpdate:show":[Function,Array],leafOnly:Boolean}),wl=pe({name:"TreeSelect",props:Cl,slots:Object,setup(l){const y=m(null),u=m(null),S=m(null),p=m(null),{mergedClsPrefixRef:R,namespaceRef:I,inlineThemeDisabled:T}=Mt(l),{localeRef:v}=zt("Select"),{mergedSizeRef:g,mergedDisabledRef:N,mergedStatusRef:D,nTriggerFormBlur:K,nTriggerFormChange:z,nTriggerFormFocus:E,nTriggerFormInput:c}=Vt(l),o=m(l.defaultValue),d=Se(l,"value"),C=ke(d,o),F=m(l.defaultShow),G=Se(l,"show"),B=ke(G,F),j=m(""),ee=P(()=>{const{filter:e}=l;if(e)return e;const{labelField:i}=l;return(h,f)=>h.length?f[i].toLowerCase().includes(h.toLowerCase()):!0}),L=P(()=>jt(l.options,il(l.keyField,l.childrenField,l.disabledField,void 0))),{value:$}=C,q=m(l.checkable?null:Array.isArray($)&&$.length?$[$.length-1]:null),s=P(()=>l.multiple&&l.cascade&&l.checkable),r=m(l.defaultExpandAll?void 0:l.defaultExpandedKeys||l.expandedKeys),b=Se(l,"expandedKeys"),w=ke(b,r),te=m(!1),Je=P(()=>{const{placeholder:e}=l;return e!==void 0?e:v.value.placeholder}),_e=P(()=>{const{value:e}=C;return l.multiple?Array.isArray(e)?e:[]:e===null||Array.isArray(e)?[]:[e]}),Qe=P(()=>l.checkable?[]:_e.value),Ze=P(()=>{const{multiple:e,showPath:i,separator:h,labelField:f}=l;if(e)return null;const{value:k}=C;if(!Array.isArray(k)&&k!==null){const{value:_}=L,V=_.getNode(k);if(V!==null)return i?Me(V,_.getPath(k).treeNodePath,h,f):Le(V,f)}return null}),Xe=P(()=>{const{multiple:e,showPath:i,separator:h}=l;if(!e)return null;const{value:f}=C;if(Array.isArray(f)){const k=[],{value:_}=L,{checkedKeys:V}=_.getCheckedKeys(f,{checkStrategy:l.checkStrategy,cascade:s.value,allowNotLoaded:l.allowCheckingNotLoaded}),{labelField:M}=l;return V.forEach(de=>{const le=_.getNode(de);le!==null&&k.push(i?Me(le,_.getPath(de).treeNodePath,h,M):Le(le,M))}),k}return[]});function ie(){var e;(e=u.value)===null||e===void 0||e.focus()}function Ne(){var e;(e=u.value)===null||e===void 0||e.focusInput()}function Oe(e){const{onUpdateShow:i,"onUpdate:show":h}=l;i&&Y(i,e),h&&Y(h,e),F.value=e}function H(e,i,h){const{onUpdateValue:f,"onUpdate:value":k}=l;f&&Y(f,e,i,h),k&&Y(k,e,i,h),o.value=e,c(),z()}function Ge(e,i){const{onUpdateIndeterminateKeys:h,"onUpdate:indeterminateKeys":f}=l;h&&Y(h,e,i),f&&Y(f,e,i)}function et(e,i,h){const{onUpdateExpandedKeys:f,"onUpdate:expandedKeys":k}=l;f&&Y(f,e,i,h),k&&Y(k,e,i,h),r.value=e}function Pe(e){const{onFocus:i}=l;i&&i(e),E()}function Ke(e){W();const{onBlur:i}=l;i&&i(e),K()}function W(){Oe(!1)}function ge(){N.value||(j.value="",Oe(!0),l.filterable&&Ne())}function tt(){j.value=""}function lt(e){var i;B.value&&(!((i=u.value)===null||i===void 0)&&i.$el.contains(Ht(e))||W())}function at(){N.value||(B.value?l.filterable||W():ge())}function J(e){const{value:{getNode:i}}=L;return e.map(h=>{var f;return((f=i(h))===null||f===void 0?void 0:f.rawNode)||null})}function ot(e,i,h){const f=J(e),k=h.action==="check"?"select":"unselect",_=h.node;l.multiple?(H(e,f,{node:_,action:k}),l.filterable&&(Ne(),l.clearFilterAfterSelect&&(j.value=""))):(e.length?H(e[0],f[0]||null,{node:_,action:k}):H(null,null,{node:_,action:k}),W(),ie())}function nt(e){l.checkable&&Ge(e,J(e))}function rt(e){var i;!((i=p.value)===null||i===void 0)&&i.contains(e.relatedTarget)||(te.value=!0,Pe(e))}function st(e){var i;!((i=p.value)===null||i===void 0)&&i.contains(e.relatedTarget)||(te.value=!1,Ke(e))}function it(e){var i,h,f;!((i=p.value)===null||i===void 0)&&i.contains(e.relatedTarget)||!((f=(h=u.value)===null||h===void 0?void 0:h.$el)===null||f===void 0)&&f.contains(e.relatedTarget)||(te.value=!0,Pe(e))}function dt(e){var i,h,f;!((i=p.value)===null||i===void 0)&&i.contains(e.relatedTarget)||!((f=(h=u.value)===null||h===void 0?void 0:h.$el)===null||f===void 0)&&f.contains(e.relatedTarget)||(te.value=!1,Ke(e))}function ut(e){e.stopPropagation();const{multiple:i}=l;!i&&l.filterable&&W(),i?H([],[],{node:null,action:"clear"}):H(null,null,{node:null,action:"clear"})}function ct(e){const{value:i}=C;if(Array.isArray(i)){const{value:h}=L,{checkedKeys:f}=h.getCheckedKeys(i,{cascade:s.value,allowNotLoaded:l.allowCheckingNotLoaded}),k=f.findIndex(_=>_===e.value);if(~k){const _=f[k],V=J([_])[0];if(l.checkable){const{checkedKeys:M}=h.uncheck(e.value,f,{checkStrategy:l.checkStrategy,cascade:s.value,allowNotLoaded:l.allowCheckingNotLoaded});H(M,J(M),{node:V,action:"delete"})}else{const M=Array.from(f);M.splice(k,1),H(M,J(M),{node:V,action:"delete"})}}}}function ft(e){const{value:i}=e.target;j.value=i}function Fe(e){const{value:i}=S;return i?i.handleKeydown(e):{enterBehavior:null}}function vt(e){if(e.key==="Enter"){if(B.value){const{enterBehavior:i}=Fe(e);if(!l.multiple)switch(i){case"default":case"toggleSelect":W(),ie();break}}else ge();e.preventDefault()}else e.key==="Escape"?B.value&&(Jt(e),W(),ie()):B.value?Fe(e):e.key==="ArrowDown"&&ge()}function pt(){W(),ie()}function ht(e){!Be(e,"action")&&!Be(e,"header")&&e.preventDefault()}const gt=P(()=>{const{renderTag:e}=l;if(e)return function({option:h,handleClose:f}){const{value:k}=h;if(k!==void 0){const _=L.value.getNode(k);if(_)return e({option:_.rawNode,handleClose:f})}return k}});Qt(cl,{pendingNodeKeyRef:q,dataTreeMate:L});function Ue(){var e;B.value&&((e=y.value)===null||e===void 0||e.syncPosition())}pl(p,Ue);const mt=dl(l),Ae=P(()=>{if(l.checkable){const e=C.value;return l.multiple&&Array.isArray(e)?L.value.getCheckedKeys(e,{cascade:l.cascade,checkStrategy:mt.value,allowNotLoaded:l.allowCheckingNotLoaded}):{checkedKeys:Array.isArray(e)||e===null?[]:[e],indeterminateKeys:[]}}return{checkedKeys:[],indeterminateKeys:[]}}),yt={getCheckedData:()=>{const{checkedKeys:e}=Ae.value;return{keys:e,options:J(e)}},getIndeterminateData:()=>{const{indeterminateKeys:e}=Ae.value;return{keys:e,options:J(e)}},focus:()=>{var e;return(e=u.value)===null||e===void 0?void 0:e.focus()},focusInput:()=>{var e;return(e=u.value)===null||e===void 0?void 0:e.focusInput()},blur:()=>{var e;return(e=u.value)===null||e===void 0?void 0:e.blur()},blurInput:()=>{var e;return(e=u.value)===null||e===void 0?void 0:e.blurInput()}},me=je("TreeSelect","-tree-select",Tl,$t,l,R),De=P(()=>{const{common:{cubicBezierEaseInOut:e},self:{menuBoxShadow:i,menuBorderRadius:h,menuColor:f,menuHeight:k,actionPadding:_,actionDividerColor:V,actionTextColor:M,headerDividerColor:de,headerPadding:le,headerTextColor:St}}=me.value;return{"--n-menu-box-shadow":i,"--n-menu-border-radius":h,"--n-menu-color":f,"--n-menu-height":k,"--n-bezier":e,"--n-action-padding":_,"--n-action-text-color":M,"--n-action-divider-color":V,"--n-header-padding":le,"--n-header-text-color":St,"--n-header-divider-color":de}}),Q=T?qt("tree-select",void 0,De,l):void 0,bt=P(()=>{const{self:{menuPadding:e}}=me.value;return e});return Object.assign(Object.assign({},yt),{menuElRef:p,mergedStatus:D,triggerInstRef:u,followerInstRef:y,treeInstRef:S,mergedClsPrefix:R,mergedValue:C,mergedShow:B,namespace:I,adjustedTo:Ce(l),isMounted:Wt(),focused:te,menuPadding:bt,mergedPlaceholder:Je,mergedExpandedKeys:w,treeSelectedKeys:Qe,treeCheckedKeys:_e,mergedSize:g,mergedDisabled:N,selectedOption:Ze,selectedOptions:Xe,pattern:j,pendingNodeKey:q,mergedCascade:s,mergedFilter:ee,selectionRenderTag:gt,handleTriggerOrMenuResize:Ue,doUpdateExpandedKeys:et,handleMenuLeave:tt,handleTriggerClick:at,handleMenuClickoutside:lt,handleUpdateCheckedKeys:ot,handleUpdateIndeterminateKeys:nt,handleTriggerFocus:rt,handleTriggerBlur:st,handleMenuFocusin:it,handleMenuFocusout:dt,handleClear:ut,handleDeleteOption:ct,handlePatternInput:ft,handleKeydown:vt,handleTabOut:pt,handleMenuMousedown:ht,mergedTheme:me,cssVars:T?void 0:De,themeClass:Q==null?void 0:Q.themeClass,onRender:Q==null?void 0:Q.onRender})},render(){const{mergedTheme:l,mergedClsPrefix:y,$slots:u}=this;return U("div",{class:`${y}-tree-select`},U(Ft,null,{default:()=>[U(Ut,null,{default:()=>U(fl,{ref:"triggerInstRef",onResize:this.handleTriggerOrMenuResize,status:this.mergedStatus,focused:this.focused,clsPrefix:y,theme:l.peers.InternalSelection,themeOverrides:l.peerOverrides.InternalSelection,ellipsisTagPopoverProps:this.ellipsisTagPopoverProps,renderTag:this.selectionRenderTag,selectedOption:this.selectedOption,selectedOptions:this.selectedOptions,size:this.mergedSize,bordered:this.bordered,placeholder:this.mergedPlaceholder,disabled:this.mergedDisabled,active:this.mergedShow,loading:this.loading,multiple:this.multiple,maxTagCount:this.maxTagCount,showArrow:!0,filterable:this.filterable,clearable:this.clearable,pattern:this.pattern,onPatternInput:this.handlePatternInput,onClear:this.handleClear,onClick:this.handleTriggerClick,onFocus:this.handleTriggerFocus,onBlur:this.handleTriggerBlur,onDeleteOption:this.handleDeleteOption,onKeydown:this.handleKeydown},{arrow:()=>{var S,p;return[(p=(S=this.$slots).arrow)===null||p===void 0?void 0:p.call(S)]}})}),U(At,{ref:"followerInstRef",show:this.mergedShow,placement:this.placement,to:this.adjustedTo,teleportDisabled:this.adjustedTo===Ce.tdkey,containerClass:this.namespace,width:this.consistentMenuWidth?"target":void 0,minWidth:"target"},{default:()=>U(Dt,{name:"fade-in-scale-up-transition",appear:this.isMounted,onLeave:this.handleMenuLeave},{default:()=>{var S;if(!this.mergedShow)return null;const{mergedClsPrefix:p,checkable:R,multiple:I,menuProps:T,options:v}=this;return(S=this.onRender)===null||S===void 0||S.call(this),Et(U("div",Object.assign({},T,{class:[`${p}-tree-select-menu`,T==null?void 0:T.class,this.themeClass],ref:"menuElRef",style:[(T==null?void 0:T.style)||"",this.cssVars],tabindex:0,onMousedown:this.handleMenuMousedown,onKeydown:this.handleKeydown,onFocusin:this.handleMenuFocusin,onFocusout:this.handleMenuFocusout}),Ee(u.header,g=>g?U("div",{class:`${p}-tree-select-menu__header`,"data-header":!0},g):null),U(Ye,{ref:"treeInstRef",blockLine:!0,allowCheckingNotLoaded:this.allowCheckingNotLoaded,showIrrelevantNodes:!1,animated:!1,pattern:this.pattern,getChildren:this.getChildren,filter:this.mergedFilter,data:v,cancelable:I,labelField:this.labelField,keyField:this.keyField,disabledField:this.disabledField,childrenField:this.childrenField,theme:l.peers.Tree,themeOverrides:l.peerOverrides.Tree,defaultExpandAll:this.defaultExpandAll,defaultExpandedKeys:this.defaultExpandedKeys,expandedKeys:this.mergedExpandedKeys,checkedKeys:this.treeCheckedKeys,selectedKeys:this.treeSelectedKeys,checkable:R,checkStrategy:this.checkStrategy,cascade:this.mergedCascade,leafOnly:this.leafOnly,multiple:this.multiple,renderLabel:this.renderLabel,renderPrefix:this.renderPrefix,renderSuffix:this.renderSuffix,renderSwitcherIcon:this.renderSwitcherIcon,nodeProps:this.nodeProps,watchProps:this.watchProps,virtualScroll:this.consistentMenuWidth&&this.virtualScroll,overrideDefaultNodeClickBehavior:this.overrideDefaultNodeClickBehavior,internalTreeSelect:!0,internalUnifySelectCheck:!0,internalScrollable:!0,internalScrollablePadding:this.menuPadding,internalFocusable:!1,internalCheckboxFocusable:!1,internalRenderEmpty:()=>U("div",{class:`${p}-tree-select-menu__empty`},Lt(u.empty,()=>[U(Yt,{theme:l.peers.Empty,themeOverrides:l.peerOverrides.Empty})])),onLoad:this.onLoad,onUpdateCheckedKeys:this.handleUpdateCheckedKeys,onUpdateIndeterminateKeys:this.handleUpdateIndeterminateKeys,onUpdateExpandedKeys:this.doUpdateExpandedKeys}),Ee(u.action,g=>g?U("div",{class:`${p}-tree-select-menu__action`,"data-action":!0},g):null),U(vl,{onFocus:this.handleTabOut})),[[Bt,this.handleMenuClickoutside,void 0,{capture:!0}]])}})})]}))}});function xl(){const l=he(),y=Zt(),u=$e({roleName:"",roleCode:"",roleType:void 0,roleStatus:void 0,dataScope:void 0,pageNum:1,pageSize:10}),S=m([]),p=m(!1),R=m(0),I=m([]),T=P(()=>I.value.length>0),v=P(()=>({page:u.pageNum||1,pageSize:u.pageSize||10,itemCount:R.value,showSizePicker:!0,pageSizes:[10,20,50,100],showQuickJumper:!0,onUpdatePage:o=>{u.pageNum=o,g()},onUpdatePageSize:o=>{u.pageSize=o,u.pageNum=1,g()}})),g=async()=>{try{p.value=!0;const o=await kt(u);if(X(o)){const d=we(o,[]);if(Array.isArray(d))S.value=d.filter(C=>C&&typeof C=="object"),R.value=S.value.length;else if(d&&typeof d=="object"){const C=Array.isArray(d.list)?d.list.filter(F=>F&&typeof F=="object"):[];S.value=C,R.value=typeof d.total=="number"?d.total:C.length}else S.value=[],R.value=0}else S.value=[],R.value=0,l.error(se(o,"获取角色列表失败"))}catch(o){console.error("加载角色列表失败:",o),S.value=[],R.value=0,l.error("获取角色列表失败")}finally{p.value=!1}};return{queryParams:u,roleList:S,loading:p,total:R,checkedRowKeys:I,hasSelection:T,paginationReactive:v,initialize:async()=>{try{await g()}catch(o){console.error("初始化角色管理失败:",o)}},loadRoleList:g,handleSearch:()=>{u.pageNum=1,g()},resetQuery:()=>{Object.assign(u,{roleName:"",roleCode:"",roleType:void 0,roleStatus:void 0,dataScope:void 0,pageNum:1,pageSize:10}),g()},handleRefresh:()=>{g()},handleDelete:o=>{y.warning({title:"确认删除",content:`确定要删除角色"${o.roleName}"吗？此操作不可恢复。`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const d=await Ct(o.roleId);X(d)?(l.success("删除成功"),g()):l.error(se(d,"删除失败"))}catch(d){console.error("删除角色失败:",d),l.error("删除失败")}}})},handleBatchDelete:()=>{if(I.value.length===0){l.warning("请选择要删除的角色");return}y.warning({title:"确认批量删除",content:`确定要删除选中的 ${I.value.length} 个角色吗？此操作不可恢复。`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const o=await Tt(I.value);o&&o.successCount>0?(l.success(`批量删除成功，成功删除 ${o.successCount} 个角色${o.failureCount>0?`，失败 ${o.failureCount} 个`:""}`),I.value=[],g()):l.error("批量删除失败")}catch(o){console.error("批量删除角色失败:",o),l.error("批量删除失败")}}})}}}const Rl=pe({__name:"RoleFormDialog",props:{visible:{type:Boolean,default:!1},formData:{default:null},isEdit:{type:Boolean,default:!1}},emits:["update:visible","success"],setup(l,{emit:y}){const u=l,S=y,p=he(),R=m(),I=m(!1),T=m({}),v=$e({roleName:"",roleCode:"",roleDescription:"",roleType:"CUSTOM",roleLevel:10,roleStatus:"Y",dataScope:"SELF",dataScopeDeptIds:[],noteText:""}),g=m([{key:"dept1",label:"总部",children:[{key:"dept1-1",label:"研发部"},{key:"dept1-2",label:"市场部"},{key:"dept1-3",label:"财务部"}]},{key:"dept2",label:"分公司",children:[{key:"dept2-1",label:"北京分公司"},{key:"dept2-2",label:"上海分公司"}]}]),N=P({get:()=>u.visible,set:c=>S("update:visible",c)}),D={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:100,message:"角色名称长度应在 2-100 个字符之间",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[A-Z][A-Z0-9_]*$/,message:"角色编码必须以大写字母开头，只能包含大写字母、数字和下划线",trigger:"blur"},{min:2,max:100,message:"角色编码长度应在 2-100 个字符之间",trigger:"blur"}],roleType:[{required:!0,message:"请选择角色类型",trigger:"change"}],roleLevel:[{required:!0,type:"number",message:"请输入角色级别",trigger:"blur"},{type:"number",min:1,max:999,message:"角色级别应在 1-999 之间",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限范围",trigger:"change"}],roleStatus:[{required:!0,message:"请选择角色状态",trigger:"change"}]};qe(()=>u.formData,async c=>{await el();try{if(c&&typeof c=="object"&&c!==null&&Object.keys(c).length>0&&(c.roleId||c.roleName||c.roleCode)){T.value={...c};let d=[];if(c.dataScopeDeptIds)try{typeof c.dataScopeDeptIds=="string"?d=tl(c.dataScopeDeptIds):Array.isArray(c.dataScopeDeptIds)&&(d=c.dataScopeDeptIds.filter(F=>typeof F=="string"))}catch(F){console.warn("解析部门ID数组失败:",F),d=[]}const C={roleName:String(c.roleName||""),roleCode:String(c.roleCode||""),roleDescription:String(c.roleDescription||""),roleType:c.roleType||"CUSTOM",roleLevel:typeof c.roleLevel=="number"?c.roleLevel:10,roleStatus:c.roleStatus||"Y",dataScope:c.dataScope||"SELF",dataScopeDeptIds:d,noteText:String(c.noteText||"")};Object.assign(v,C)}else K()}catch(o){console.error("解析角色表单数据失败:",o),K()}},{immediate:!0,flush:"post"});const K=()=>{Object.assign(v,{roleName:"",roleCode:"",roleDescription:"",roleType:"CUSTOM",roleLevel:10,roleStatus:"Y",dataScope:"SELF",dataScopeDeptIds:[],noteText:""}),T.value={}},z=()=>{K(),N.value=!1},E=async()=>{var c;try{await((c=R.value)==null?void 0:c.validate()),I.value=!0;const o={...v,dataScopeDeptIds:v.dataScope==="DEPT"?v.dataScopeDeptIds:void 0};u.isEdit&&T.value.roleId&&(o.roleId=T.value.roleId);let d;u.isEdit&&T.value.roleId?d=await wt(o):d=await xt(o),X(d)?(p.success(u.isEdit?"角色更新成功":"角色创建成功"),K(),S("success")):p.error(se(d,"操作失败"))}catch(o){console.error("提交角色表单失败:",o),o!=null&&o.message?p.error(o.message):p.error("操作失败")}finally{I.value=!1}};return(c,o)=>(ce(),xe(t(We),{show:N.value,"onUpdate:show":o[9]||(o[9]=d=>N.value=d),"mask-closable":!1,preset:"dialog",title:c.isEdit?"编辑角色":"新建角色",class:"role-form-dialog",style:{width:"600px"}},{action:n(()=>[a(t(fe),null,{default:n(()=>[a(t(A),{onClick:z},{default:n(()=>o[13]||(o[13]=[x("取消")])),_:1}),a(t(A),{type:"primary",loading:I.value,onClick:E},{default:n(()=>[x(oe(c.isEdit?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:n(()=>[a(t(Re),{ref_key:"formRef",ref:R,model:v,rules:D,"label-placement":"left","label-width":"120px","require-mark-placement":"right-hanging"},{default:n(()=>[a(t(O),{label:"角色名称",path:"roleName"},{default:n(()=>[a(t(Z),{value:v.roleName,"onUpdate:value":o[0]||(o[0]=d=>v.roleName=d),placeholder:"请输入角色名称",maxlength:"100","show-count":""},null,8,["value"])]),_:1}),a(t(O),{label:"角色编码",path:"roleCode"},{default:n(()=>[a(t(Z),{value:v.roleCode,"onUpdate:value":o[1]||(o[1]=d=>v.roleCode=d),placeholder:"请输入角色编码",maxlength:"100","show-count":"",disabled:c.isEdit},null,8,["value","disabled"])]),_:1}),a(t(O),{label:"角色类型",path:"roleType"},{default:n(()=>{var d;return[a(t(re),{value:v.roleType,"onUpdate:value":o[2]||(o[2]=C=>v.roleType=C),placeholder:"请选择角色类型",options:t(ze),disabled:c.isEdit&&((d=T.value)==null?void 0:d.builtInFlag)==="Y"},null,8,["value","options","disabled"])]}),_:1}),a(t(O),{label:"角色级别",path:"roleLevel"},{feedback:n(()=>[a(t(Gt),{depth:"3",style:{"font-size":"12px"}},{default:n(()=>o[10]||(o[10]=[x(" 数字越小权限越高，系统角色级别建议设置为 1-10 ")])),_:1})]),default:n(()=>[a(t(hl),{value:v.roleLevel,"onUpdate:value":o[3]||(o[3]=d=>v.roleLevel=d),placeholder:"请输入角色级别",min:1,max:999,style:{width:"100%"}},null,8,["value"])]),_:1}),a(t(O),{label:"数据权限范围",path:"dataScope"},{default:n(()=>[a(t(re),{value:v.dataScope,"onUpdate:value":o[4]||(o[4]=d=>v.dataScope=d),placeholder:"请选择数据权限范围",options:t(Ve)},null,8,["value","options"])]),_:1}),v.dataScope==="DEPT"?(ce(),xe(t(O),{key:0,label:"部门权限",path:"dataScopeDeptIds"},{default:n(()=>[a(t(wl),{value:v.dataScopeDeptIds,"onUpdate:value":o[5]||(o[5]=d=>v.dataScopeDeptIds=d),placeholder:"请选择部门",multiple:"",checkable:"",cascade:"",options:g.value,style:{width:"100%"}},null,8,["value","options"])]),_:1})):Xt("",!0),a(t(O),{label:"角色状态",path:"roleStatus"},{default:n(()=>[a(t(He),{value:v.roleStatus,"onUpdate:value":o[6]||(o[6]=d=>v.roleStatus=d)},{default:n(()=>[a(t(ve),{value:"Y"},{default:n(()=>o[11]||(o[11]=[x("启用")])),_:1}),a(t(ve),{value:"N"},{default:n(()=>o[12]||(o[12]=[x("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),a(t(O),{label:"角色描述",path:"roleDescription"},{default:n(()=>[a(t(Z),{value:v.roleDescription,"onUpdate:value":o[7]||(o[7]=d=>v.roleDescription=d),type:"textarea",placeholder:"请输入角色描述",rows:3,maxlength:"500","show-count":""},null,8,["value"])]),_:1}),a(t(O),{label:"备注信息",path:"noteText"},{default:n(()=>[a(t(Z),{value:v.noteText,"onUpdate:value":o[8]||(o[8]=d=>v.noteText=d),type:"textarea",placeholder:"请输入备注信息",rows:2,maxlength:"500","show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]))}}),Il=Ie(Rl,[["__scopeId","data-v-8116e4c5"]]),_l={class:"permission-content"},Nl={class:"permission-tree-container"},Ol={class:"tree-header"},Pl=pe({__name:"RolePermissionDialog",props:{visible:{type:Boolean,default:!1},roleInfo:{default:()=>({})}},emits:["update:visible","success"],setup(l,{emit:y}){const u=l,S=y,p=he(),R=m(),I=m(!1),T=m(!1),v=m([]),g=m([]),N=m([]),D=m("ALLOW"),K=m(null),z=P({get:()=>u.visible,set:s=>S("update:visible",s)}),E=s=>g.value.filter(b=>{const w=c(v.value,b);return(w==null?void 0:w.resourceType)===s}).length,c=(s,r)=>{for(const b of s){if(b.resourceId===r)return b;if(b.children){const w=c(b.children,r);if(w)return w}}return null},o=async()=>{try{I.value=!0;const s=await It();if(X(s)){const r=we(s,[]);v.value=r,N.value=r.map(b=>b.resourceId)}else p.error(se(s,"获取权限资源失败"))}catch(s){console.error("加载权限资源树失败:",s),p.error("获取权限资源失败")}finally{I.value=!1}},d=async s=>{try{const r=await _t(s);if(X(r)){const b=we(r,[]);g.value=b}}catch(r){console.error("加载角色权限失败:",r)}},C=s=>{g.value=s},F=s=>{N.value=s},G=()=>{const s=r=>{let b=[];return r.forEach(w=>{b.push(w.resourceId),w.children&&(b=b.concat(s(w.children)))}),b};N.value=s(v.value)},B=()=>{N.value=[]},j=()=>{const s=r=>{let b=[];return r.forEach(w=>{b.push(w.resourceId),w.children&&(b=b.concat(s(w.children)))}),b};g.value=s(v.value)},ee=()=>{g.value=[]},L=()=>{z.value=!1,$()},$=()=>{g.value=[],N.value=[],D.value="ALLOW",K.value=null},q=async()=>{var s;if(!((s=u.roleInfo)!=null&&s.roleId)){p.error("角色信息不完整");return}if(g.value.length===0){p.warning("请选择要分配的权限");return}try{T.value=!0;const r={roleId:u.roleInfo.roleId,resourceIds:g.value,permissionType:D.value,expireTime:K.value?new Date(K.value).toISOString():void 0},b=await Rt(u.roleInfo.roleId,g.value);X(b)?(p.success("权限分配成功"),S("success")):p.error(se(b,"权限分配失败"))}catch(r){console.error("权限分配失败:",r),p.error("权限分配失败")}finally{T.value=!1}};return qe(()=>u.visible,async s=>{var r;s?(await o(),(r=u.roleInfo)!=null&&r.roleId&&await d(u.roleInfo.roleId)):$()}),(s,r)=>{var b;return ce(),xe(t(We),{show:z.value,"onUpdate:show":r[2]||(r[2]=w=>z.value=w),"mask-closable":!1,preset:"dialog",title:`分配权限 - ${(b=s.roleInfo)==null?void 0:b.roleName}`,class:"role-permission-dialog",style:{width:"800px"}},{action:n(()=>[a(t(fe),null,{default:n(()=>[a(t(A),{onClick:L},{default:n(()=>r[9]||(r[9]=[x("取消")])),_:1}),a(t(A),{type:"primary",loading:T.value,onClick:q},{default:n(()=>r[10]||(r[10]=[x(" 保存权限 ")])),_:1},8,["loading"])]),_:1})]),default:n(()=>[Te("div",_l,[a(t(ll),{show:I.value},{default:n(()=>[Te("div",Nl,[Te("div",Ol,[a(t(fe),null,{default:n(()=>[a(t(A),{size:"small",onClick:G},{default:n(()=>r[3]||(r[3]=[x("全部展开")])),_:1}),a(t(A),{size:"small",onClick:B},{default:n(()=>r[4]||(r[4]=[x("全部收起")])),_:1}),a(t(A),{size:"small",onClick:j},{default:n(()=>r[5]||(r[5]=[x("全选")])),_:1}),a(t(A),{size:"small",onClick:ee},{default:n(()=>r[6]||(r[6]=[x("全不选")])),_:1})]),_:1})]),a(t(Ye),{ref_key:"treeRef",ref:R,data:v.value,"checked-keys":g.value,"expanded-keys":N.value,checkable:"",cascade:"","key-field":"resourceId","label-field":"resourceName","children-field":"children","virtual-scroll":"",style:{height:"400px"},"onUpdate:checkedKeys":C,"onUpdate:expandedKeys":F},null,8,["data","checked-keys","expanded-keys"])])]),_:1},8,["show"]),a(t(ne),{size:"small",class:"permission-settings",title:"权限设置"},{default:n(()=>[a(t(Re),{"label-placement":"left","label-width":"120px"},{default:n(()=>[a(t(O),{label:"权限类型"},{default:n(()=>[a(t(He),{value:D.value,"onUpdate:value":r[0]||(r[0]=w=>D.value=w)},{default:n(()=>[a(t(ve),{value:"ALLOW"},{default:n(()=>r[7]||(r[7]=[x("允许")])),_:1}),a(t(ve),{value:"DENY"},{default:n(()=>r[8]||(r[8]=[x("拒绝")])),_:1})]),_:1},8,["value"])]),_:1}),a(t(O),{label:"过期时间"},{default:n(()=>[a(t(gl),{value:K.value,"onUpdate:value":r[1]||(r[1]=w=>K.value=w),type:"datetime",placeholder:"选择过期时间，不选择表示永不过期",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(t(ne),{size:"small",class:"permission-summary",title:"权限统计"},{default:n(()=>[a(t(al),{column:2,size:"small"},{default:n(()=>[a(t(ue),{label:"模块权限"},{default:n(()=>[x(oe(E("MODULE")),1)]),_:1}),a(t(ue),{label:"菜单权限"},{default:n(()=>[x(oe(E("MENU")),1)]),_:1}),a(t(ue),{label:"按钮权限"},{default:n(()=>[x(oe(E("BUTTON")),1)]),_:1}),a(t(ue),{label:"API权限"},{default:n(()=>[x(oe(E("API")),1)]),_:1})]),_:1})]),_:1})])]),_:1},8,["show","title"])}}}),Kl=Ie(Pl,[["__scopeId","data-v-3493d039"]]),Fl={class:"role-management-container"},Ul=pe({__name:"RoleManagement",setup(l){const{queryParams:y,roleList:u,loading:S,checkedRowKeys:p,hasSelection:R,paginationReactive:I,initialize:T,loadRoleList:v,handleSearch:g,resetQuery:N,handleRefresh:D,handleDelete:K,handleBatchDelete:z}=xl(),E=he(),c=m(),o=m(!1),d=m(!1),C=m(void 0),F=m(!1),G=Ot(j,K,ee),B=()=>{C.value=void 0,F.value=!1,o.value=!0};function j(q){C.value={...q},F.value=!0,o.value=!0}function ee(q){C.value={...q},d.value=!0}const L=()=>{o.value=!1,v()},$=()=>{d.value=!1,E.success("权限分配成功")};return ol(async()=>{await T()}),(q,s)=>(ce(),nl("div",Fl,[a(t(ne),{size:"small",class:"search-card"},{default:n(()=>[a(t(Re),{inline:"",model:t(y),"label-placement":"left"},{default:n(()=>[a(t(O),{label:"角色名称"},{default:n(()=>[a(t(Z),{value:t(y).roleName,"onUpdate:value":s[0]||(s[0]=r=>t(y).roleName=r),placeholder:"请输入角色名称",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),a(t(O),{label:"角色编码"},{default:n(()=>[a(t(Z),{value:t(y).roleCode,"onUpdate:value":s[1]||(s[1]=r=>t(y).roleCode=r),placeholder:"请输入角色编码",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),a(t(O),{label:"角色类型"},{default:n(()=>[a(t(re),{value:t(y).roleType,"onUpdate:value":s[2]||(s[2]=r=>t(y).roleType=r),placeholder:"请选择角色类型",clearable:"",style:{width:"150px"},options:t(ze)},null,8,["value","options"])]),_:1}),a(t(O),{label:"数据权限"},{default:n(()=>[a(t(re),{value:t(y).dataScope,"onUpdate:value":s[3]||(s[3]=r=>t(y).dataScope=r),placeholder:"请选择数据权限",clearable:"",style:{width:"150px"},options:t(Ve)},null,8,["value","options"])]),_:1}),a(t(O),{label:"状态"},{default:n(()=>[a(t(re),{value:t(y).roleStatus,"onUpdate:value":s[4]||(s[4]=r=>t(y).roleStatus=r),placeholder:"请选择状态",style:{width:"120px"},options:t(Nt)},null,8,["value","options"])]),_:1}),a(t(O),null,{default:n(()=>[a(t(A),{type:"primary",onClick:t(g)},{icon:n(()=>[a(t(ae),null,{default:n(()=>[a(t(rl))]),_:1})]),default:n(()=>[s[8]||(s[8]=x(" 搜索 "))]),_:1},8,["onClick"]),a(t(A),{onClick:t(N),style:{"margin-left":"8px"}},{icon:n(()=>[a(t(ae),null,{default:n(()=>[a(t(ml))]),_:1})]),default:n(()=>[s[9]||(s[9]=x(" 重置 "))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),a(t(ne),{size:"small",class:"action-card"},{default:n(()=>[a(t(fe),null,{default:n(()=>[a(t(A),{type:"primary",onClick:B},{icon:n(()=>[a(t(ae),null,{default:n(()=>[a(t(yl))]),_:1})]),default:n(()=>[s[10]||(s[10]=x(" 新建角色 "))]),_:1}),a(t(A),{type:"error",disabled:!t(R),onClick:t(z)},{icon:n(()=>[a(t(ae),null,{default:n(()=>[a(t(bl))]),_:1})]),default:n(()=>[s[11]||(s[11]=x(" 批量删除 "))]),_:1},8,["disabled","onClick"]),a(t(A),{onClick:t(D)},{icon:n(()=>[a(t(ae),null,{default:n(()=>[a(t(Sl))]),_:1})]),default:n(()=>[s[12]||(s[12]=x(" 刷新 "))]),_:1},8,["onClick"])]),_:1})]),_:1}),a(t(ne),{size:"small",class:"table-card"},{default:n(()=>[a(t(kl),{ref_key:"dataTableRef",ref:c,columns:t(G),data:t(u),loading:t(S),pagination:t(I),"row-key":r=>r.roleId,"checked-row-keys":t(p),"onUpdate:checkedRowKeys":s[5]||(s[5]=r=>sl(p)?p.value=r:null),"flex-height":"",style:{height:"500px"}},null,8,["columns","data","loading","pagination","row-key","checked-row-keys"])]),_:1}),a(Il,{visible:o.value,"onUpdate:visible":s[6]||(s[6]=r=>o.value=r),"form-data":C.value,"is-edit":F.value,onSuccess:L},null,8,["visible","form-data","is-edit"]),a(Kl,{visible:d.value,"onUpdate:visible":s[7]||(s[7]=r=>d.value=r),"role-info":C.value,onSuccess:$},null,8,["visible","role-info"])]))}}),Yl=Ie(Ul,[["__scopeId","data-v-86d574b6"]]);export{Yl as default};

import{G as U}from"./GPane-CxOV-lpS.js";import{c as Q,G as X,S as Z}from"./SearchForm-BUIWxYo3.js";import{d as M,m as $,cm as H,c as D,b as O,o as P,a4 as V,n as se,i as z,g as I,e as s,f as n,aO as R,w as o,K as k,t as y,h as j,J as W,j as K,_ as Y,r as _,a7 as B,bP as ee,bQ as E,ab as J,af as oe,z as ie,B as re,v as te,am as x}from"./index-CWXSvzFX.js";import{G as ae}from"./GDialog-m_V1zRb5.js";import{C as ce}from"./CopyOutline-BDE44RnA.js";import{C as ue,a as de,b as ve}from"./CodeOutline-CodOe20m.js";import{N as fe}from"./Code-BUVYjq_e.js";/* empty css                                                                    */import"./index-DR_R-bYe.js";import"./RefreshOutline-h3Dp5duE.js";import"./OptionsOutline-BiDucG_b.js";import"./DatePicker-ZyhEeSPV.js";import"./Select-gKdqP2X1.js";import"./InformationCircleOutline-DBMIJYfy.js";import"./Grid-yYVEDzJ8.js";import"./InputNumber-BUl23Fx_.js";import"./Switch-QcDziDdf.js";import"./Scrollbar-CPw7NeqF.js";import"./CloseOutline-DJ_HAPet.js";const pe={key:0,class:"g-text-show__toolbar"},me={class:"g-text-show__toolbar-left"},he={class:"g-text-show__toolbar-right"},ge=M({name:"GTextShow",__name:"GTextShow",props:{content:{default:""},format:{default:"auto"},showLineNumbers:{type:Boolean,default:!1},showCopyButton:{type:Boolean,default:!0},autoFormat:{type:Boolean,default:!0},maxHeight:{},minHeight:{},class:{},style:{}},emits:["copy"],setup(p,{emit:m}){const a=p,c=m,h=$(),w={highlight:H.highlight.bind(H),getLanguage:H.getLanguage.bind(H)},v=r=>{if(!r||!r.trim())return"txt";const i=r.trim();if(i.startsWith("{")||i.startsWith("["))try{return JSON.parse(i),"json"}catch{}return i.startsWith("<?xml")||i.startsWith("<")?i.includes("soap:Envelope")||i.includes("soapenv:Envelope")?"soap":"xml":i.includes("---")||i.includes(":")&&i.split(`
`).length>1?"yaml":/^\s*(SELECT|INSERT|UPDATE|DELETE|CREATE|ALTER|DROP)\s+/i.test(i)?"sql":/<html[\s>]|<body[\s>]|<div[\s>]/i.test(i)?"html":i.includes("function")||i.includes("const ")||i.includes("let ")?i.includes(":")&&i.includes("interface")||i.includes("type ")?"typescript":"javascript":i.includes("{")&&i.includes("}")&&i.includes(":")?"css":"txt"},e=D(()=>a.format==="auto"?v(a.content):a.format),u=D(()=>{const r=e.value;return{json:"json",xml:"xml",soap:"xml",txt:"plaintext",yaml:"yaml",sql:"sql",javascript:"javascript",typescript:"typescript",css:"css",html:"html",auto:"plaintext"}[r]||"plaintext"}),b=r=>{try{const i=JSON.parse(r);return JSON.stringify(i,null,2)}catch{return r}},t=D(()=>{if(!a.content)return"";const r=e.value;return r==="json"&&a.autoFormat?b(a.content):((r==="xml"||r==="soap")&&a.autoFormat,a.content)}),C=D(()=>{const r=e.value;return{json:"success",xml:"info",soap:"primary",txt:"default",yaml:"warning",sql:"info",javascript:"success",typescript:"primary",css:"info",html:"info",auto:"default"}[r]||"default"}),l=D(()=>{const r=e.value;return{json:"JSON",xml:"XML",soap:"SOAP",txt:"TXT",yaml:"YAML",sql:"SQL",javascript:"JavaScript",typescript:"TypeScript",css:"CSS",html:"HTML",auto:"AUTO"}[r]||"TXT"}),A=D(()=>a.showCopyButton||g.value&&!a.autoFormat),g=D(()=>e.value==="json"||e.value==="xml"||e.value==="soap"),f=D(()=>{const r={};if(a.style){if(typeof a.style=="string")return a.style;Object.assign(r,a.style)}return r}),d=D(()=>{const r={};return a.maxHeight&&(r.maxHeight=typeof a.maxHeight=="number"?`${a.maxHeight}px`:a.maxHeight,r.overflow="auto"),a.minHeight&&(r.minHeight=typeof a.minHeight=="number"?`${a.minHeight}px`:a.minHeight),r}),S=async()=>{try{const r=t.value||a.content;await navigator.clipboard.writeText(r),h.success("复制成功"),c("copy",r)}catch(r){h.error("复制失败"),console.error("复制失败:",r)}},T=()=>{h.info("当前格式已自动格式化")};return(r,i)=>(P(),O("div",{class:se(["g-text-show",a.class]),style:V(f.value)},[A.value?(P(),O("div",pe,[I("div",me,[s(n(R),{size:"small",type:C.value},{default:o(()=>[k(y(l.value),1)]),_:1},8,["type"])]),I("div",he,[r.showCopyButton?(P(),j(n(W),{key:0,size:"small",quaternary:"",onClick:S},{icon:o(()=>[s(n(K),null,{default:o(()=>[s(n(ce))]),_:1})]),default:o(()=>[i[0]||(i[0]=k(" 复制 "))]),_:1})):z("",!0),g.value&&!r.autoFormat?(P(),j(n(W),{key:1,size:"small",quaternary:"",onClick:T},{icon:o(()=>[s(n(K),null,{default:o(()=>[s(n(ue))]),_:1})]),default:o(()=>[i[1]||(i[1]=k(" 格式化 "))]),_:1})):z("",!0)])])):z("",!0),I("div",{class:"g-text-show__content",style:V(d.value)},[s(n(fe),{code:t.value,language:u.value,"show-line-numbers":r.showLineNumbers,hljs:w,class:"g-text-show__code"},null,8,["code","language","show-line-numbers"])],4)],6))}}),ne=Y(ge,[["__scopeId","data-v-70793781"]]),ye={class:"cluster-event-ack-detail"},ke={class:"cluster-event-ack-detail__result"},be={class:"cluster-event-ack-detail__result-content"},we={key:0,class:"cluster-event-ack-detail__note"},Ce={class:"cluster-event-ack-detail__note-content"},Ee={key:1,class:"cluster-event-ack-detail__ext"},Ae=M({name:"ClusterEventAckDetailDialog",__name:"ClusterEventAckDetailDialog",props:{show:{type:Boolean,default:!1},ack:{default:null}},emits:["update:show","close"],setup(p,{emit:m}){const a=p,c=m,h=_(a.show);B(()=>a.show,e=>{h.value=e}),B(h,e=>{e!==a.show&&c("update:show",e)});const w=e=>e?J(e,"YYYY-MM-DD HH:mm:ss"):"-",v=()=>{h.value=!1,c("close")};return(e,u)=>(P(),j(n(ae),{show:h.value,"onUpdate:show":u[0]||(u[0]=b=>h.value=b),width:1200,title:"事件确认详情","show-footer":!0,"show-cancel":!1,"confirm-text":"关闭","mask-closable":!0,"close-on-esc":!0,onClose:v,onCancel:v,onConfirm:v},{default:o(()=>{var b,t,C;return[I("div",ye,[s(n(ee),{column:2,bordered:"","label-placement":"left","label-style":"width: 120px; font-weight: 500;",class:"cluster-event-ack-detail__info"},{default:o(()=>[s(n(E),{label:"确认ID"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.ackId)||"-"),1)]}),_:1}),s(n(E),{label:"事件ID"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.eventId)||"-"),1)]}),_:1}),s(n(E),{label:"处理节点ID"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.nodeId)||"-"),1)]}),_:1}),s(n(E),{label:"处理节点IP"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.nodeIp)||"-"),1)]}),_:1}),s(n(E),{label:"确认状态"},{default:o(()=>{var l,A,g;return[s(n(R),{type:((l=e.ack)==null?void 0:l.ackStatus)==="PENDING"?"warning":((A=e.ack)==null?void 0:A.ackStatus)==="SUCCESS"?"success":((g=e.ack)==null?void 0:g.ackStatus)==="FAILED"?"error":"default",size:"small"},{default:o(()=>{var f,d,S,T,r;return[k(y(((f=e.ack)==null?void 0:f.ackStatus)==="PENDING"?"待处理":((d=e.ack)==null?void 0:d.ackStatus)==="SUCCESS"?"成功":((S=e.ack)==null?void 0:S.ackStatus)==="FAILED"?"失败":((T=e.ack)==null?void 0:T.ackStatus)==="SKIPPED"?"跳过":((r=e.ack)==null?void 0:r.ackStatus)||"-"),1)]}),_:1},8,["type"])]}),_:1}),s(n(E),{label:"重试次数"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.retryCount)??"-"),1)]}),_:1}),s(n(E),{label:"处理时间"},{default:o(()=>{var l;return[k(y(w((l=e.ack)==null?void 0:l.processTime)||"-"),1)]}),_:1}),s(n(E),{label:"活动状态"},{default:o(()=>{var l;return[s(n(R),{type:((l=e.ack)==null?void 0:l.activeFlag)==="Y"?"success":"error",size:"small"},{default:o(()=>{var A;return[k(y(((A=e.ack)==null?void 0:A.activeFlag)==="Y"?"活动":"非活动"),1)]}),_:1},8,["type"])]}),_:1}),s(n(E),{label:"创建时间"},{default:o(()=>{var l;return[k(y(w((l=e.ack)==null?void 0:l.addTime)||"-"),1)]}),_:1}),s(n(E),{label:"创建人"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.addWho)||"-"),1)]}),_:1}),s(n(E),{label:"修改时间"},{default:o(()=>{var l;return[k(y(w((l=e.ack)==null?void 0:l.editTime)||"-"),1)]}),_:1}),s(n(E),{label:"修改人"},{default:o(()=>{var l;return[k(y(((l=e.ack)==null?void 0:l.editWho)||"-"),1)]}),_:1})]),_:1}),I("div",ke,[u[1]||(u[1]=I("div",{class:"cluster-event-ack-detail__result-title"},"结果信息",-1)),I("div",be,y(((b=e.ack)==null?void 0:b.resultMessage)||"-"),1)]),(t=e.ack)!=null&&t.noteText?(P(),O("div",we,[u[2]||(u[2]=I("div",{class:"cluster-event-ack-detail__note-title"},"备注信息",-1)),I("div",Ce,y(e.ack.noteText),1)])):z("",!0),(C=e.ack)!=null&&C.extProperty?(P(),O("div",Ee,[u[3]||(u[3]=I("div",{class:"cluster-event-ack-detail__ext-title"},"扩展属性（JSON）",-1)),s(n(ne),{content:e.ack.extProperty,format:"json","show-line-numbers":!0,"show-copy-button":!0,"auto-format":!0,"max-height":300},null,8,["content"])])):z("",!0)])]}),_:1},8,["show"]))}}),Se=Y(Ae,[["__scopeId","data-v-55530b03"]]);function _e(){const p="hub0008:event-ack",m=_(!1),a=_([]),c=_();return{moduleId:p,loading:m,ackList:a,pageInfo:c,searchFormConfig:{fields:[{field:"nodeId",label:"处理节点ID",type:"input",placeholder:"请输入处理节点ID",span:6,clearable:!0},{field:"nodeIp",label:"处理节点IP",type:"input",placeholder:"请输入处理节点IP",span:6,clearable:!0},{field:"ackStatus",label:"确认状态",type:"select",placeholder:"请选择确认状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"待处理",value:"PENDING"},{label:"成功",value:"SUCCESS"},{label:"失败",value:"FAILED"},{label:"跳过",value:"SKIPPED"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择活动状态",span:6,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],toolbarButtons:[],showSearchButton:!0,showResetButton:!0},gridConfig:{columns:[{field:"ackId",title:"确认ID",showOverflow:!0,width:200},{field:"nodeId",title:"处理节点ID",showOverflow:!0,width:180},{field:"nodeIp",title:"处理节点IP",showOverflow:!0,width:140},{field:"ackStatus",title:"确认状态",align:"center",width:120,cellRender:{name:"VxeTag",props:({row:t})=>{const l={PENDING:{type:"warning",content:"待处理"},SUCCESS:{type:"success",content:"成功"},FAILED:{type:"error",content:"失败"},SKIPPED:{type:"default",content:"跳过"}}[t.ackStatus]||{type:"default",content:t.ackStatus};return{type:l.type,content:l.content}}}},{field:"processTime",title:"处理时间",sortable:!0,showOverflow:!0,width:160,formatter:({cellValue:t})=>t?J(t,"YYYY-MM-DD HH:mm:ss"):"-"},{field:"retryCount",title:"重试次数",align:"center",width:100},{field:"resultMessage",title:"结果信息",showOverflow:"tooltip",minWidth:200},{field:"activeFlag",title:"活动状态",align:"center",width:100,cellRender:{name:"VxeTag",props:({row:t})=>({type:t.activeFlag==="Y"?"success":"error",content:t.activeFlag==="Y"?"活动":"非活动"})}}],showCheckbox:!1,paginationConfig:{show:!0,pageInfo:c,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"}]},height:"100%"},resetPagination:()=>{c.value=void 0},updatePagination:t=>{c.value?Object.assign(c.value,t):c.value=t},setAckList:t=>{a.value=t},clearAckList:()=>{a.value=[]}}}const q=oe("/gateway/hub0008");async function Ie(p){return q.post("/queryClusterEvents",p)}async function De(p){return q.post("/queryClusterEventAcks",p)}async function Te(p){return q.post("/getClusterEventAckDetail",{ackId:p})}function Pe(p,m){const a=$(),c=_e(),{loading:h,ackList:w,pageInfo:v,setAckList:e,updatePagination:u}=c,b=async f=>{var S,T,r;const d=(p==null?void 0:p.value)||(f==null?void 0:f.eventId);if(!d){e([]),v.value=void 0;return}h.value=!0;try{let i=f;!i&&((S=m==null?void 0:m.value)!=null&&S.getFormData)&&(i=m.value.getFormData()||{});const L=i?Object.fromEntries(Object.entries(i).filter(([,N])=>N!==""&&N!==null&&N!==void 0)):{},G={eventId:d,...L,...Q((T=v.value)==null?void 0:T.pageIndex,(r=v.value)==null?void 0:r.pageSize)},F=await De(G);if(F.oK){if(F.bizData){const N=JSON.parse(F.bizData),le=Array.isArray(N)?N:[];e(le)}if(F.pageQueryData){const N=JSON.parse(F.pageQueryData);u(N)}}else a.error(F.errMsg||"查询事件处理节点列表失败")}catch(i){console.error("加载事件处理节点列表失败:",i),a.error("加载事件处理节点列表失败")}finally{h.value=!1}};return{model:c,loadAcks:b,handleSearch:async f=>{c.resetPagination(),await b(f)},handleReset:async()=>{c.resetPagination(),await b()},handlePageChange:async({currentPage:f,pageSize:d})=>{u({pageIndex:f,pageSize:d}),await b()},handleRefresh:async()=>{await b()},getAckDetail:async f=>{if(!f)return a.warning("确认ID不能为空"),null;try{const d=await Te(f);return ie(d)?JSON.parse(d.bizData):(a.error(re(d,"获取事件确认详情失败")),null)}catch(d){return console.error("获取事件确认详情失败:",d),a.error("获取事件确认详情失败"),null}}}}const Le={class:"cluster-event-ack-list",id:"cluster-event-ack-list"},Ne=M({name:"ClusterEventAckList",__name:"ClusterEventAckList",props:{eventId:{default:void 0}},setup(p){const m=p,a=_(),c=_(),h=D(()=>m.eventId),w=_(!1),v=_(null),e=Pe(h,a),u=async t=>{await e.handleSearch(t)},b=async({code:t,row:C})=>{if(C)switch(t){case"view":const l=await e.getAckDetail(C.ackId);l?(v.value=l,w.value=!0):(v.value=C,w.value=!0);break}};return B(()=>m.eventId,t=>{t?(e.model.resetPagination(),e.loadAcks()):(e.model.clearAckList(),e.model.resetPagination())},{immediate:!0}),te(()=>{m.eventId&&e.loadAcks()}),(t,C)=>(P(),O("div",Le,[s(n(U),{direction:"vertical","no-resize":!0},{1:o(()=>[s(Z,x({ref_key:"searchFormRef",ref:a,"module-id":n(e).model.moduleId},n(e).model.searchFormConfig,{onSearch:u}),null,16,["module-id"])]),2:o(()=>[s(n(X),x({ref_key:"gridRef",ref:c,"module-id":n(e).model.moduleId,data:n(e).model.ackList,loading:n(e).model.loading},n(e).model.gridConfig,{onPageChange:n(e).handlePageChange,onMenuClick:b}),null,16,["module-id","data","loading","onPageChange"])]),_:1}),s(Se,{show:w.value,"onUpdate:show":C[0]||(C[0]=l=>w.value=l),ack:v.value},null,8,["show","ack"])]))}}),Re=Y(Ne,[["__scopeId","data-v-5f8f2ab7"]]),Oe={class:"cluster-event-detail"},Fe={class:"cluster-event-detail__payload"},Me=M({name:"ClusterEventDetailDialog",__name:"ClusterEventDetailDialog",props:{show:{type:Boolean,default:!1},event:{default:null}},emits:["update:show","close"],setup(p,{emit:m}){const a=p,c=m,h=_(a.show);B(()=>a.show,e=>{h.value=e}),B(h,e=>{e!==a.show&&c("update:show",e)});const w=e=>e?J(e,"YYYY-MM-DD HH:mm:ss"):"-",v=()=>{h.value=!1,c("close")};return(e,u)=>(P(),j(n(ae),{show:h.value,"onUpdate:show":u[0]||(u[0]=b=>h.value=b),width:1200,title:"事件详情","show-footer":!0,"show-cancel":!1,"confirm-text":"关闭","mask-closable":!0,"close-on-esc":!0,onClose:v,onCancel:v,onConfirm:v},{default:o(()=>{var b;return[I("div",Oe,[s(n(ee),{column:2,bordered:"","label-placement":"left","label-style":"width: 120px; font-weight: 500;",class:"cluster-event-detail__info"},{default:o(()=>[s(n(E),{label:"事件ID"},{default:o(()=>{var t;return[k(y(((t=e.event)==null?void 0:t.eventId)||"-"),1)]}),_:1}),s(n(E),{label:"事件类型"},{default:o(()=>[s(n(R),{type:"primary",size:"small"},{default:o(()=>{var t;return[k(y(((t=e.event)==null?void 0:t.eventType)||"-"),1)]}),_:1})]),_:1}),s(n(E),{label:"事件动作"},{default:o(()=>{var t,C,l,A,g,f,d,S,T;return[s(n(R),{type:((t=e.event)==null?void 0:t.eventAction)==="START"?"success":((C=e.event)==null?void 0:C.eventAction)==="STOP"?"error":((l=e.event)==null?void 0:l.eventAction)==="RELOAD"?"warning":((A=e.event)==null?void 0:A.eventAction)==="RESTART"?"info":((g=e.event)==null?void 0:g.eventAction)==="CREATE"?"success":((f=e.event)==null?void 0:f.eventAction)==="UPDATE"?"info":((d=e.event)==null?void 0:d.eventAction)==="DELETE"?"error":((S=e.event)==null?void 0:S.eventAction)==="REFRESH"||((T=e.event)==null?void 0:T.eventAction)==="INVALIDATE"?"warning":"default",size:"small"},{default:o(()=>{var r;return[k(y(((r=e.event)==null?void 0:r.eventAction)||"-"),1)]}),_:1},8,["type"])]}),_:1}),s(n(E),{label:"发布节点ID"},{default:o(()=>{var t;return[k(y(((t=e.event)==null?void 0:t.sourceNodeId)||"-"),1)]}),_:1}),s(n(E),{label:"发布节点IP"},{default:o(()=>{var t;return[k(y(((t=e.event)==null?void 0:t.sourceNodeIp)||"-"),1)]}),_:1}),s(n(E),{label:"事件时间"},{default:o(()=>{var t;return[k(y(w((t=e.event)==null?void 0:t.eventTime)||"-"),1)]}),_:1}),s(n(E),{label:"过期时间"},{default:o(()=>{var t;return[k(y(w((t=e.event)==null?void 0:t.expireTime)||"-"),1)]}),_:1}),s(n(E),{label:"活动状态"},{default:o(()=>{var t;return[s(n(R),{type:((t=e.event)==null?void 0:t.activeFlag)==="Y"?"success":"error",size:"small"},{default:o(()=>{var C;return[k(y(((C=e.event)==null?void 0:C.activeFlag)==="Y"?"活动":"非活动"),1)]}),_:1},8,["type"])]}),_:1})]),_:1}),I("div",Fe,[u[1]||(u[1]=I("div",{class:"cluster-event-detail__payload-title"},"事件负载（JSON）",-1)),s(n(ne),{content:((b=e.event)==null?void 0:b.eventPayload)||"",format:"json","show-line-numbers":!0,"show-copy-button":!0,"auto-format":!0,"max-height":500},null,8,["content"])])])]}),_:1},8,["show"]))}}),Ye=Y(Me,[["__scopeId","data-v-9ef4292c"]]);function ze(){const p="hub0008:event-list",m=_(!1),a=_([]),c=_();return{moduleId:p,loading:m,eventList:a,pageInfo:c,searchFormConfig:{fields:[{field:"eventType",label:"事件类型",type:"input",placeholder:"请输入事件类型",span:8,clearable:!0},{field:"eventAction",label:"事件动作",type:"select",placeholder:"请选择事件动作",span:8,clearable:!0,options:[{label:"全部",value:""},{label:"CREATE",value:"CREATE"},{label:"UPDATE",value:"UPDATE"},{label:"DELETE",value:"DELETE"},{label:"REFRESH",value:"REFRESH"},{label:"INVALIDATE",value:"INVALIDATE"}]},{field:"activeFlag",label:"活动状态",type:"select",placeholder:"请选择活动状态",span:8,clearable:!0,options:[{label:"全部",value:""},{label:"活动",value:"Y"},{label:"非活动",value:"N"}]}],moreFields:[{field:"sourceNodeId",label:"发布节点ID",type:"input",placeholder:"请输入发布节点ID",span:8,clearable:!0},{field:"sourceNodeIp",label:"发布节点IP",type:"input",placeholder:"请输入发布节点IP",span:8,clearable:!0}],toolbarButtons:[{key:"toggleAckList",label:"收起处理列表",type:"primary",icon:"ChevronForwardOutline",tooltip:"收起/展开处理列表",atEnd:!0}],showSearchButton:!0,showResetButton:!0},gridConfig:{columns:[{field:"eventId",title:"事件ID",showOverflow:!0,width:200},{field:"eventType",title:"事件类型",width:150,align:"center",slots:{default:"eventType"}},{field:"eventAction",title:"事件动作",align:"center",width:120,slots:{default:"eventAction"}},{field:"sourceNodeId",title:"发布节点",showOverflow:!0,width:180},{field:"sourceNodeIp",title:"发布节点IP",showOverflow:!0,width:140},{field:"eventTime",title:"事件时间",sortable:!0,showOverflow:!0,width:160,formatter:({cellValue:t})=>t?J(t,"YYYY-MM-DD HH:mm:ss"):""},{field:"activeFlag",title:"活动状态",align:"center",width:100,cellRender:{name:"VxeTag",props:({row:t})=>({type:t.activeFlag==="Y"?"success":"error",content:t.activeFlag==="Y"?"活动":"非活动"})}}],showCheckbox:!1,paginationConfig:{show:!0,pageInfo:c,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,showCopyCell:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"}]},height:"100%"},resetPagination:()=>{c.value=void 0},updatePagination:t=>{c.value?Object.assign(c.value,t):c.value=t},setEventList:t=>{a.value=t},clearEventList:()=>{a.value=[]}}}function Be(p){const m=$(),a=ze(),{loading:c,eventList:h,pageInfo:w,setEventList:v,updatePagination:e}=a,u=async A=>{var g,f,d;c.value=!0;try{let S=A;!S&&((g=p==null?void 0:p.value)!=null&&g.getFormData)&&(S=p.value.getFormData()||{});const r={...S?Object.fromEntries(Object.entries(S).filter(([,L])=>L!==""&&L!==null&&L!==void 0)):{},...Q((f=w.value)==null?void 0:f.pageIndex,(d=w.value)==null?void 0:d.pageSize)},i=await Ie(r);if(i.oK){if(i.bizData){const L=JSON.parse(i.bizData),G=Array.isArray(L)?L:[];v(G)}if(i.pageQueryData){const L=JSON.parse(i.pageQueryData);e(L)}}else m.error(i.errMsg||"查询集群事件列表失败")}catch(S){console.error("加载集群事件列表失败:",S),m.error("加载集群事件列表失败")}finally{c.value=!1}};return{model:a,loadEvents:u,handleSearch:async A=>{a.resetPagination(),await u(A)},handleReset:async()=>{a.resetPagination(),await u()},handlePageChange:async({currentPage:A,pageSize:g})=>{e({pageIndex:A,pageSize:g}),await u()},handleRefresh:async()=>{await u()}}}function He(p){const m=Be(p);return{service:m,handleSearch:async c=>{await m.handleSearch(c)}}}const je={class:"cluster-event-list",id:"cluster-event-list"},xe=M({name:"ClusterEventList",__name:"ClusterEventList",props:{selectedEventId:{default:void 0},showAckList:{type:Boolean,default:!0}},emits:["select","toggle-ack-list"],setup(p,{emit:m}){const a=p,c=m,h=_(),w=_(),v=_(!1),e=_(null),{service:u,handleSearch:b}=He(h),t=D(()=>{const g={...u.model.searchFormConfig};return g.toolbarButtons&&(g.toolbarButtons=g.toolbarButtons.map(f=>f.key==="toggleAckList"?{...f,label:a.showAckList?"收起处理列表":"展开处理列表",icon:a.showAckList?de:ve}:f)),g}),C=({row:g})=>{c("select",g.eventId)},l=g=>{g==="toggleAckList"&&c("toggle-ack-list")},A=({code:g,row:f})=>{if(f)switch(g){case"view":e.value=f,v.value=!0;break}};return te(()=>{u.loadEvents()}),(g,f)=>(P(),O("div",je,[s(n(U),{direction:"vertical","no-resize":!0},{1:o(()=>[s(Z,x({ref_key:"searchFormRef",ref:h,"module-id":n(u).model.moduleId},t.value,{onSearch:n(b),onToolbarClick:l}),null,16,["module-id","onSearch"])]),2:o(()=>[s(n(X),x({ref_key:"gridRef",ref:w,"module-id":n(u).model.moduleId,data:n(u).model.eventList,loading:n(u).model.loading},n(u).model.gridConfig,{onPageChange:n(u).handlePageChange,onRowClick:C,onMenuClick:A}),{eventType:o(({row:d})=>[s(n(R),{type:"primary",size:"small"},{default:o(()=>[k(y(d.eventType),1)]),_:2},1024)]),eventAction:o(({row:d})=>[s(n(R),{type:d.eventAction==="START"?"success":d.eventAction==="STOP"?"error":d.eventAction==="RELOAD"?"warning":d.eventAction==="RESTART"?"info":d.eventAction==="CREATE"?"success":d.eventAction==="UPDATE"?"info":d.eventAction==="DELETE"?"error":d.eventAction==="REFRESH"||d.eventAction==="INVALIDATE"?"warning":"default",size:"small"},{default:o(()=>[k(y(d.eventAction),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),s(Ye,{show:v.value,"onUpdate:show":f[0]||(f[0]=d=>v.value=d),event:e.value},null,8,["show","event"])]))}}),Je=Y(xe,[["__scopeId","data-v-900a24a7"]]),Ge="cluster-event-management",Ue=M({name:"ClusterEventManagement",__name:"ClusterEventManagement",setup(p){const m=_(""),a=_(),c=D(()=>{var v;return((v=a.value)==null?void 0:v.getPane2Visible())??!0});function h(v){m.value=v}function w(){var v;(v=a.value)==null||v.togglePane2Visible()}return(v,e)=>(P(),O("div",{class:"cluster-event-management",id:Ge},[s(n(U),{ref_key:"paneRef",ref:a,direction:"horizontal","default-size":.5},{1:o(()=>[s(Je,{"selected-event-id":m.value,"show-ack-list":c.value,onSelect:h,onToggleAckList:w},null,8,["selected-event-id","show-ack-list"])]),2:o(()=>[s(Re,{"event-id":m.value},null,8,["event-id"])]),_:1},512)]))}}),dt=Y(Ue,[["__scopeId","data-v-9f62cc83"]]);export{dt as default};

import{c as H,G as Q,S as Z}from"./SearchForm-DE-Qtsds.js";import{G as ee}from"./GPane--Prg37Qg.js";import{af as te,d as $,m as V,a7 as j,g as _,w as n,j as F,e as a,o as D,b as u,c as q,r as A,h as O,a9 as M,bW as ae,bX as L,K as w,t as b,aO as k,aa as C,f as U,ab as le,I as re,z as x,A as z,B as E,_ as K,d5 as ne,cr as oe,am as Y}from"./index-B5iwLEhr.js";import{G as se}from"./GModal-CvXv33Ng.js";import{G as R}from"./GTextShow-CATcH9GS.js";import{c as ie}from"./DatePicker-BYwGRPWG.js";import{N as ue,a as P}from"./CollapseItem-DXFot1jJ.js";/* empty css                                                                    */import{u as de}from"./useGDialog-Cwnj3s3l.js";import{T as ce}from"./TrashOutline-CSUZLE0I.js";import"./index-DR_R-bYe.js";import"./RefreshOutline-Ca-9cWyP.js";import"./OptionsOutline-B8oCHVC7.js";import"./InformationCircleOutline-v7Gk8MOG.js";import"./Grid-CNbyDJRX.js";import"./Select-DZOKbeI6.js";import"./InputNumber-DRvou0Uu.js";import"./Switch-Dznk0CX3.js";import"./ContractOutline-Ba-N9rKU.js";import"./CloseOutline-EA3x-23V.js";import"./CopyOutline-D29-WYAX.js";import"./CodeOutline-DrtOkp0s.js";import"./Code-B7-WNvvt.js";import"./GDialog-DGaxvIOE.js";import"./Scrollbar-zuiunsUR.js";const G=te("/gateway/hub0082"),ge=async f=>G.post("/queryAlertLogs",f),X=async f=>G.post("/getAlertLog",{alertLogId:f}),fe=async f=>G.post("/deleteAlertLog",{alertLogId:f}),me=async f=>G.post("/batchDeleteAlertLogs",{alertLogIds:f}),B=[{label:"信息",value:"INFO"},{label:"警告",value:"WARN"},{label:"错误",value:"ERROR"},{label:"严重",value:"CRITICAL"}],J=[{label:"待发送",value:"PENDING"},{label:"发送中",value:"SENDING"},{label:"成功",value:"SUCCESS"},{label:"失败",value:"FAILED"}],pe={key:0,class:"alert-log-detail-container"},ve={class:"content-text"},he={class:"content-text"},be=$({__name:"AlertLogDetailDialog",props:{visible:{type:Boolean,default:!1},alertLogId:{default:""}},emits:["update:visible"],setup(f,{emit:m}){const r=f,d=m,h=V(),T=A(!1),l=A(null),v=F(()=>r.alertLogId?`预警日志详情 - ${r.alertLogId}`:"预警日志详情"),o=F({get(){return r.visible},set(t){d("update:visible",t)}}),S=F(()=>{var t,i,N,W;return!!((t=l.value)!=null&&t.alertTags||(i=l.value)!=null&&i.alertExtra||(N=l.value)!=null&&N.tableData||(W=l.value)!=null&&W.sendResult)});j(()=>r.visible,t=>{t&&r.alertLogId?y():t||(l.value=null)},{immediate:!0}),j(()=>r.alertLogId,t=>{t&&r.visible&&y()});const y=async()=>{if(r.alertLogId)try{T.value=!0;const t=await X(r.alertLogId);x(t)?l.value=z(t):(h.error(E(t,"获取预警日志详情失败")),l.value=null)}catch(t){console.error("加载预警日志详情失败:",t),h.error(t.message||"加载预警日志详情失败"),l.value=null}finally{T.value=!1}},c=()=>{l.value=null},p=t=>{if(!t)return"";const i=B.find(N=>N.value===t);return(i==null?void 0:i.label)||String(t)},I=t=>t&&{INFO:"info",WARN:"warning",ERROR:"error",CRITICAL:"error"}[t]||"default",s=t=>{if(!t)return"";const i=J.find(N=>N.value===t);return(i==null?void 0:i.label)||String(t)},g=t=>t&&{PENDING:"default",SENDING:"info",SUCCESS:"success",FAILED:"error"}[t]||"default",e=t=>{if(!t)return"";try{const i=JSON.parse(t);return JSON.stringify(i,null,2)}catch{return t}};return(t,i)=>(D(),_(a(se),{visible:o.value,"onUpdate:visible":i[0]||(i[0]=N=>o.value=N),title:v.value,width:"90%",style:{maxWidth:"1200px"},preset:"dialog","mask-closable":!1,closable:!0,draggable:!0,"show-footer":!1,onAfterLeave:c},{default:n(()=>[u(a(re),{show:T.value},{default:n(()=>[l.value?(D(),q("div",pe,[u(a(M),{title:"基本信息",size:"small",class:"detail-card"},{default:n(()=>[u(a(ae),{column:3,size:"small",bordered:""},{default:n(()=>[u(a(L),{label:"日志ID"},{default:n(()=>[u(a(ie),{tooltip:!1},{default:n(()=>[w(b(l.value.alertLogId),1)]),_:1})]),_:1}),u(a(L),{label:"告警级别"},{default:n(()=>[u(a(k),{type:I(l.value.alertLevel),size:"small"},{default:n(()=>[w(b(p(l.value.alertLevel)),1)]),_:1},8,["type"])]),_:1}),u(a(L),{label:"告警类型"},{default:n(()=>[w(b(l.value.alertType||"-"),1)]),_:1}),u(a(L),{label:"渠道名称"},{default:n(()=>[w(b(l.value.channelName||"-"),1)]),_:1}),u(a(L),{label:"告警时间"},{default:n(()=>[w(b(a(C)(l.value.alertTimestamp||"")),1)]),_:1}),u(a(L),{label:"发送状态"},{default:n(()=>[u(a(k),{type:g(l.value.sendStatus),size:"small"},{default:n(()=>[w(b(s(l.value.sendStatus)),1)]),_:1},8,["type"])]),_:1}),u(a(L),{label:"发送时间"},{default:n(()=>[w(b(l.value.sendTime?a(C)(l.value.sendTime):"-"),1)]),_:1}),u(a(L),{label:"创建时间"},{default:n(()=>[w(b(a(C)(l.value.addTime)),1)]),_:1}),u(a(L),{label:"创建人"},{default:n(()=>[w(b(l.value.addWho),1)]),_:1}),u(a(L),{label:"修改时间"},{default:n(()=>[w(b(a(C)(l.value.editTime||"")),1)]),_:1}),u(a(L),{label:"修改人"},{default:n(()=>[w(b(l.value.editWho),1)]),_:1}),u(a(L),{label:"错误信息",span:3},{default:n(()=>[w(b(l.value.sendErrorMessage||"-"),1)]),_:1})]),_:1})]),_:1}),l.value.alertTitle?(D(),_(a(M),{key:0,title:"告警标题",size:"small",class:"detail-card"},{default:n(()=>[U("div",ve,b(l.value.alertTitle),1)]),_:1})):O("",!0),l.value.alertContent?(D(),_(a(M),{key:1,title:"告警内容",size:"small",class:"detail-card"},{default:n(()=>[U("div",he,b(l.value.alertContent),1)]),_:1})):O("",!0),S.value?(D(),_(a(M),{key:2,title:"扩展数据",size:"small",class:"detail-card"},{default:n(()=>[u(a(ue),null,{default:n(()=>[l.value.alertTags?(D(),_(a(P),{key:0,title:"告警标签 (JSON)",name:"tags"},{default:n(()=>[u(a(R),{content:e(l.value.alertTags),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):O("",!0),l.value.alertExtra?(D(),_(a(P),{key:1,title:"额外数据 (JSON)",name:"extra"},{default:n(()=>[u(a(R),{content:e(l.value.alertExtra),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):O("",!0),l.value.tableData?(D(),_(a(P),{key:2,title:"表格数据 (JSON)",name:"table"},{default:n(()=>[u(a(R),{content:e(l.value.tableData),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):O("",!0),l.value.sendResult?(D(),_(a(P),{key:3,title:"发送结果 (JSON)",name:"result"},{default:n(()=>[u(a(R),{content:e(l.value.sendResult),format:"json","auto-format":!0,"max-height":300},null,8,["content"])]),_:1})):O("",!0)]),_:1})]),_:1})):O("",!0)])):(D(),_(a(le),{key:1,description:"暂无日志数据"}))]),_:1},8,["show"])]),_:1},8,["visible","title"]))}}),we=K(be,[["__scopeId","data-v-3d198b7c"]]);function Le(){const f="hub0082:alert-log",m=A(!1),r=A([]),d=A(),l={fields:[{field:"timeRange",label:"时间范围",type:"datetimerange",placeholder:"请选择时间范围",span:8,clearable:!0,required:!0,rules:[{validator:(e,t)=>!t||!Array.isArray(t)||t.length!==2||!t[0]||!t[1]?new Error("请选择时间范围"):!0,trigger:["change","blur"]}],props:{shortcuts:{今天:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t.getTime(),i.getTime()]},昨天:()=>{const e=new Date;e.setDate(e.getDate()-1);const t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t.getTime(),i.getTime()]},最近1小时:()=>{const e=Date.now();return[e-36e5,e]},最近6小时:()=>{const e=Date.now();return[e-216e5,e]},最近24小时:()=>{const e=Date.now();return[e-864e5,e]},最近7天:()=>{const e=Date.now();return[e-6048e5,e]}},style:{width:"100%"}},defaultValue:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t.getTime(),i.getTime()]})()},{field:"alertLogId",label:"日志ID",type:"input",placeholder:"请输入日志ID",span:6,clearable:!0},{field:"alertLevel",label:"告警级别",type:"select",placeholder:"请选择告警级别",span:6,clearable:!0,options:[{label:"全部",value:""},...B.map(e=>({label:e.label,value:e.value}))]},{field:"alertType",label:"告警类型",type:"input",placeholder:"请输入告警类型",span:6,clearable:!0},{field:"alertTitle",label:"告警标题",type:"input",placeholder:"请输入告警标题",span:6,clearable:!0},{field:"channelName",label:"渠道名称",type:"input",placeholder:"请输入渠道名称",span:6,clearable:!0},{field:"sendStatus",label:"发送状态",type:"select",placeholder:"请选择发送状态",span:6,clearable:!0,options:[{label:"全部",value:""},...J.map(e=>({label:e.label,value:e.value}))]}],toolbarButtons:[{key:"delete",label:"删除",icon:ce,type:"error",tooltip:"批量删除选中的日志"}],showSearchButton:!0,showResetButton:!0},v=e=>{if(!e)return"";const t=B.find(i=>i.value===e);return(t==null?void 0:t.label)||String(e)},o=e=>e&&{INFO:"info",WARN:"warning",ERROR:"error",CRITICAL:"error"}[e]||"default",S=e=>{if(!e)return"";const t=J.find(i=>i.value===e);return(t==null?void 0:t.label)||String(e)},y=e=>e&&{PENDING:"default",SENDING:"info",SUCCESS:"success",FAILED:"error"}[e]||"default",c={columns:[{field:"alertLogId",title:"日志ID",align:"center",showOverflow:"tooltip",width:200},{field:"alertLevel",title:"告警级别",align:"center",width:100,slots:{default:"alertLevel"}},{field:"alertType",title:"告警类型",align:"center",showOverflow:"tooltip",width:120},{field:"alertTitle",title:"告警标题",align:"center",showOverflow:"tooltip",width:200},{field:"alertContent",title:"告警内容",align:"center",showOverflow:"tooltip",width:300},{field:"channelName",title:"渠道名称",align:"center",showOverflow:"tooltip",width:150},{field:"sendStatus",title:"发送状态",align:"center",width:100,slots:{default:"sendStatus"}},{field:"alertTimestamp",title:"告警时间",align:"center",width:160,formatter:({row:e})=>C(e.alertTimestamp)},{field:"sendTime",title:"发送时间",align:"center",width:160,formatter:({row:e})=>C(e.sendTime)},{field:"sendErrorMessage",title:"错误信息",align:"center",showOverflow:"tooltip",width:200},{field:"addTime",title:"创建时间",align:"center",width:160,formatter:({row:e})=>C(e.addTime)},{field:"addWho",title:"创建人",align:"center",width:120,showOverflow:"tooltip"},{field:"editTime",title:"修改时间",align:"center",width:160,formatter:({row:e})=>C(e.editTime)},{field:"editWho",title:"修改人",align:"center",width:120,showOverflow:"tooltip"}],showCheckbox:!0,paginationConfig:{show:!0,pageInfo:d,align:"right"},menuConfig:{enabled:!0,showCopyRow:!0,customMenus:[{code:"view",name:"查看详情",prefixIcon:"vxe-icon-eye-fill"},{code:"delete",name:"删除",prefixIcon:"vxe-icon-delete"}]}};function p(e){r.value=e}function I(e){m.value=e}function s(){d.value=void 0}function g(e){d.value?Object.assign(d.value,e):d.value=e}return{moduleId:f,loading:m,logList:r,pageInfo:d,searchFormConfig:l,gridConfig:c,getAlertLevelLabel:v,getAlertLevelTagType:o,getSendStatusLabel:S,getSendStatusTagType:y,setLogList:p,setLoading:I,resetPagination:s,updatePagination:g}}function ye(f){const m=V(),r=Le(),d=async v=>{var o,S,y;try{r.setLoading(!0);let c=v;!c&&((o=f==null?void 0:f.value)!=null&&o.getFormData)&&(c=f.value.getFormData()||{});const p={};c&&Object.keys(c).forEach(g=>{g==="timeRange"&&Array.isArray(c[g])&&c[g].length===2?(p.startTime=new Date(c[g][0]).toISOString(),p.endTime=new Date(c[g][1]).toISOString()):c[g]!==""&&c[g]!==null&&c[g]!==void 0&&(p[g]=c[g])});const I={...p,...H((S=r.pageInfo.value)==null?void 0:S.pageIndex,(y=r.pageInfo.value)==null?void 0:y.pageSize)},s=await ge(I);if(x(s)){const g=z(s,[])||[];r.setLogList(g);const e=ne(s);e&&r.updatePagination(e)}else m.error(E(s,"查询预警日志失败")),r.setLogList([])}catch(c){console.error("查询预警日志失败:",c),m.error(c.message||"查询预警日志失败"),r.setLogList([])}finally{r.setLoading(!1)}};return{model:r,loadLogList:d,getLogDetail:async v=>{try{r.setLoading(!0);const o=await X(v);return x(o)?z(o):(m.error(E(o,"获取预警日志详情失败")),null)}catch(o){return console.error("获取预警日志详情失败:",o),m.error(o.message||"获取预警日志详情失败"),null}finally{r.setLoading(!1)}},deleteLog:async v=>{try{r.setLoading(!0);const o=await fe(v);return x(o)?(m.success("删除预警日志成功"),await d(),!0):(m.error(E(o,"删除预警日志失败")),!1)}catch(o){return console.error("删除预警日志失败:",o),m.error(o.message||"删除预警日志失败"),!1}finally{r.setLoading(!1)}},batchDeleteLogs:async v=>{if(v.length===0)return m.warning("请选择要删除的日志"),!1;try{r.setLoading(!0);const o=await me(v);return x(o)?(m.success(`成功删除 ${v.length} 条预警日志`),await d(),!0):(m.error(E(o,"批量删除预警日志失败")),!1)}catch(o){return console.error("批量删除预警日志失败:",o),m.error(o.message||"批量删除预警日志失败"),!1}finally{r.setLoading(!1)}}}}function De(f,m){const r=V(),d=de(),h=ye(m),T=A(!1),l=A(""),v=async s=>{h.model.resetPagination(),await h.loadLogList(s)},o=async({currentPage:s,pageSize:g})=>{h.model.updatePagination({pageIndex:s,pageSize:g}),await h.loadLogList()},S=async(s,g)=>{switch(s){case"delete":{if(!(f!=null&&f.value)){r.warning("Grid 引用未设置");return}const e=f.value.getCheckboxRecords()||[];if(e.length===0){r.warning("请先选择要删除的日志");return}const t=e.map(i=>i.alertLogId);await I(t);break}case"search":{await v(g);break}default:console.warn("未知的工具栏按钮:",s)}},y=async s=>{if(!s.alertLogId){r.warning("日志ID不能为空");return}l.value=s.alertLogId,T.value=!0},c=async({menu:s,row:g})=>{switch(s.code){case"view":await y(g);break;case"delete":await p(g);break;default:console.warn("未知的菜单项:",s.code)}},p=async s=>{if(!s.alertLogId){r.warning("日志ID不能为空");return}await d.warning({title:"确认删除",content:`确定要删除日志"${s.alertLogId}"吗？`,positiveText:"删除",negativeText:"取消"})&&await h.deleteLog(s.alertLogId)},I=async s=>{if(s.length===0){r.warning("请选择要删除的日志");return}await d.warning({title:"确认批量删除",content:`确定要删除选中的 ${s.length} 条日志吗？`,positiveText:"删除",negativeText:"取消"})&&await h.batchDeleteLogs(s)};return{service:h,viewDialogVisible:T,selectedAlertLogId:l,handleSearch:v,handlePageChange:o,handleToolbarClick:S,handleMenuClick:c,openViewDialog:y,handleDelete:p,handleBatchDelete:I}}const Te="hub0082-alert-log",Se=$({name:"AlertLogManagement",__name:"AlertLogManagement",setup(f){const m=A(),r=A(),{service:d,viewDialogVisible:h,selectedAlertLogId:T,handleToolbarClick:l,handleMenuClick:v,handleSearch:o,handlePageChange:S}=De(r,m);return(y,c)=>(D(),q("div",{class:"alert-log-management",id:Te},[u(a(ee),{direction:"vertical","no-resize":!0},{1:n(()=>[u(Z,Y({ref_key:"searchFormRef",ref:m,"module-id":a(d).model.moduleId},a(d).model.searchFormConfig,{onSearch:a(o),onToolbarClick:a(l)}),null,16,["module-id","onSearch","onToolbarClick"])]),2:n(()=>[u(a(Q),Y({ref_key:"gridRef",ref:r,"module-id":a(d).model.moduleId,data:a(d).model.logList,loading:a(d).model.loading},a(d).model.gridConfig,{onPageChange:a(S),onMenuClick:c[0]||(c[0]=({code:p,row:I})=>a(v)({menu:{code:p},row:I}))}),{alertLevel:n(({row:p})=>[u(a(k),{type:a(d).model.getAlertLevelTagType(p.alertLevel),size:"small"},{default:n(()=>[w(b(a(d).model.getAlertLevelLabel(p.alertLevel)),1)]),_:2},1032,["type"])]),sendStatus:n(({row:p})=>[u(a(k),{type:a(d).model.getSendStatusTagType(p.sendStatus),size:"small"},{default:n(()=>[w(b(a(d).model.getSendStatusLabel(p.sendStatus)),1)]),_:2},1032,["type"])]),_:1},16,["module-id","data","loading","onPageChange"])]),_:1}),u(a(we),{visible:a(h),"onUpdate:visible":c[1]||(c[1]=p=>oe(h)?h.value=p:null),"alert-log-id":a(T)},null,8,["visible","alert-log-id"])]))}}),Xe=K(Se,[["__scopeId","data-v-da416192"]]);export{Xe as default};

<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="serverGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FFF3E0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FFE0B2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="clientGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E3F2FD;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#BBDEFB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="userGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E8F5E9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C8E6C9;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="rgba(0,0,0,0.2)"/>
    </filter>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976D2"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#F57C00"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#388E3C"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1000" height="800" fill="#FAFAFA"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#263238">内网穿透架构 - FRP Tunnel</text>
  <text x="500" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#78909C">控制与数据分离 • 静态映射 + 动态注册</text>
  
  <!-- Public Network -->
  <rect x="30" y="80" width="940" height="320" rx="10" fill="none" stroke="#90A4AE" stroke-width="2" stroke-dasharray="10,5"/>
  <text x="50" y="105" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#546E7A">公网 (Public Network)</text>
  
  <!-- Internal Network -->
  <rect x="30" y="420" width="940" height="320" rx="10" fill="none" stroke="#90A4AE" stroke-width="2" stroke-dasharray="10,5"/>
  <text x="50" y="445" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#546E7A">内网 (Internal Network)</text>
  
  <!-- Internet User -->
  <g>
    <rect x="80" y="140" width="140" height="220" rx="8" fill="url(#userGradient)" stroke="#388E3C" stroke-width="2" filter="url(#shadow)"/>
    <text x="150" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1B5E20">互联网用户</text>
    
    <ellipse cx="150" cy="200" rx="25" ry="25" fill="#FFFFFF" stroke="#388E3C" stroke-width="2"/>
    <circle cx="150" cy="195" r="8" fill="#388E3C"/>
    <path d="M150 203 L150 225 M135 213 L150 213 L165 213 M150 225 L135 245 M150 225 L165 245" stroke="#388E3C" stroke-width="3" fill="none"/>
    
    <text x="150" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#263238">访问公网地址</text>
    <text x="150" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">example.com:80</text>
    <text x="150" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">或</text>
    <text x="150" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">server.com:8080</text>
  </g>
  
  <!-- Tunnel Server -->
  <g>
    <rect x="280" y="120" width="400" height="260" rx="8" fill="url(#serverGradient)" stroke="#F57C00" stroke-width="3" filter="url(#shadow)"/>
    <text x="480" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#E65100">隧道服务端 (Tunnel Server)</text>
    <text x="480" y="162" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BF360C">公网服务器 - 负责转发流量</text>
    
    <!-- Control Port -->
    <rect x="300" y="180" width="160" height="80" rx="5" fill="#FFFFFF" stroke="#F57C00" stroke-width="2"/>
    <text x="380" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#E65100">控制端口 (7000)</text>
    <text x="380" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• 客户端注册</text>
    <text x="380" y="233" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• Token 认证</text>
    <text x="380" y="248" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• 心跳保活</text>
    
    <!-- Data Ports -->
    <rect x="480" y="180" width="180" height="80" rx="5" fill="#FFFFFF" stroke="#F57C00" stroke-width="2"/>
    <text x="570" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#E65100">数据端口</text>
    <text x="570" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">静态映射: 80, 8080, 2222...</text>
    <text x="570" y="233" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">动态分配: 随机端口</text>
    <text x="570" y="248" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">HTTP/TCP/UDP 代理</text>
    
    <!-- Core Components -->
    <rect x="300" y="275" width="110" height="35" rx="4" fill="#FFF8E1" stroke="#F57C00" stroke-width="1"/>
    <text x="355" y="297" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">会话管理</text>
    
    <rect x="425" y="275" width="110" height="35" rx="4" fill="#FFF8E1" stroke="#F57C00" stroke-width="1"/>
    <text x="480" y="297" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">服务注册</text>
    
    <rect x="550" y="275" width="110" height="35" rx="4" fill="#FFF8E1" stroke="#F57C00" stroke-width="1"/>
    <text x="605" y="297" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">连接跟踪</text>
    
    <rect x="300" y="320" width="110" height="35" rx="4" fill="#FFF8E1" stroke="#F57C00" stroke-width="1"/>
    <text x="355" y="342" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">负载均衡</text>
    
    <rect x="425" y="320" width="110" height="35" rx="4" fill="#FFF8E1" stroke="#F57C00" stroke-width="1"/>
    <text x="480" y="342" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">静态映射</text>
    
    <rect x="550" y="320" width="110" height="35" rx="4" fill="#FFF8E1" stroke="#F57C00" stroke-width="1"/>
    <text x="605" y="342" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">流量转发</text>
  </g>
  
  <!-- Database -->
  <rect x="740" y="140" width="180" height="220" rx="8" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2" filter="url(#shadow)"/>
  <text x="830" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4A148C">数据库</text>
  
  <rect x="760" y="180" width="140" height="30" rx="3" fill="#FFFFFF" stroke="#7B1FA2" stroke-width="1"/>
  <text x="830" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">服务器配置</text>
  
  <rect x="760" y="220" width="140" height="30" rx="3" fill="#FFFFFF" stroke="#7B1FA2" stroke-width="1"/>
  <text x="830" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">静态端口映射</text>
  
  <rect x="760" y="260" width="140" height="30" rx="3" fill="#FFFFFF" stroke="#7B1FA2" stroke-width="1"/>
  <text x="830" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">客户端信息</text>
  
  <rect x="760" y="300" width="140" height="30" rx="3" fill="#FFFFFF" stroke="#7B1FA2" stroke-width="1"/>
  <text x="830" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">动态服务注册</text>
  
  <!-- Tunnel Client -->
  <g>
    <rect x="280" y="480" width="400" height="220" rx="8" fill="url(#clientGradient)" stroke="#1976D2" stroke-width="3" filter="url(#shadow)"/>
    <text x="480" y="505" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#0D47A1">隧道客户端 (Tunnel Client)</text>
    <text x="480" y="522" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#01579B">内网机器 - 提供本地服务</text>
    
    <!-- Control Connection -->
    <rect x="300" y="540" width="160" height="70" rx="5" fill="#FFFFFF" stroke="#1976D2" stroke-width="2"/>
    <text x="380" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#0D47A1">控制连接</text>
    <text x="380" y="578" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• 连接服务端 7000</text>
    <text x="380" y="593" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• Token 认证</text>
    
    <!-- Service Manager -->
    <rect x="480" y="540" width="180" height="70" rx="5" fill="#FFFFFF" stroke="#1976D2" stroke-width="2"/>
    <text x="570" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#0D47A1">服务管理</text>
    <text x="570" y="578" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• 注册本地服务</text>
    <text x="570" y="593" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">• 自动重连</text>
    
    <!-- Components -->
    <rect x="300" y="625" width="110" height="35" rx="4" fill="#E1F5FE" stroke="#1976D2" stroke-width="1"/>
    <text x="355" y="647" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">心跳管理</text>
    
    <rect x="425" y="625" width="110" height="35" rx="4" fill="#E1F5FE" stroke="#1976D2" stroke-width="1"/>
    <text x="480" y="647" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">代理管理</text>
    
    <rect x="550" y="625" width="110" height="35" rx="4" fill="#E1F5FE" stroke="#1976D2" stroke-width="1"/>
    <text x="605" y="647" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">重连管理</text>
  </g>
  
  <!-- Local Services -->
  <rect x="740" y="480" width="180" height="220" rx="8" fill="#E8F5E9" stroke="#388E3C" stroke-width="2" filter="url(#shadow)"/>
  <text x="830" y="505" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1B5E20">本地服务</text>
  
  <rect x="760" y="530" width="140" height="35" rx="3" fill="#FFFFFF" stroke="#388E3C" stroke-width="1"/>
  <text x="830" y="552" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">Web 服务 :8080</text>
  
  <rect x="760" y="575" width="140" height="35" rx="3" fill="#FFFFFF" stroke="#388E3C" stroke-width="1"/>
  <text x="830" y="597" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">SSH 服务 :22</text>
  
  <rect x="760" y="620" width="140" height="35" rx="3" fill="#FFFFFF" stroke="#388E3C" stroke-width="1"/>
  <text x="830" y="642" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#263238">数据库 :3306</text>
  
  <!-- Arrows and Flow -->
  <!-- User to Server -->
  <path d="M220 250 L280 250" stroke="#388E3C" stroke-width="3" marker-end="url(#arrowGreen)"/>
  <text x="250" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1B5E20" font-weight="bold">① 访问</text>
  
  <!-- Server to Database -->
  <path d="M680 250 L740 250" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="5,3"/>
  <text x="710" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#4A148C">配置</text>
  
  <!-- Client to Server Control -->
  <path d="M380 480 L380 380" stroke="#1976D2" stroke-width="3" marker-end="url(#arrowBlue)"/>
  <text x="395" y="430" font-family="Arial, sans-serif" font-size="10" fill="#0D47A1" font-weight="bold">② 注册</text>
  <text x="395" y="443" font-family="Arial, sans-serif" font-size="9" fill="#546E7A">控制连接</text>
  
  <!-- Server to Client Data -->
  <path d="M570 380 L570 480" stroke="#F57C00" stroke-width="3" marker-end="url(#arrowOrange)"/>
  <text x="585" y="430" font-family="Arial, sans-serif" font-size="10" fill="#E65100" font-weight="bold">③ 转发</text>
  <text x="585" y="443" font-family="Arial, sans-serif" font-size="9" fill="#546E7A">数据流量</text>
  
  <!-- Client to Local Service -->
  <path d="M680 590 L740 590" stroke="#388E3C" stroke-width="3" marker-end="url(#arrowGreen)"/>
  <text x="710" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1B5E20" font-weight="bold">④ 代理</text>
  
  <!-- Legend -->
  <rect x="50" y="750" width="900" height="35" rx="5" fill="#ECEFF1" stroke="#90A4AE" stroke-width="1"/>
  <text x="70" y="772" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#263238">工作流程：</text>
  <text x="150" y="772" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">① 用户访问公网地址</text>
  <text x="310" y="772" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">② 客户端注册到服务端</text>
  <text x="480" y="772" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">③ 服务端转发流量到客户端</text>
  <text x="680" y="772" font-family="Arial, sans-serif" font-size="10" fill="#546E7A">④ 客户端代理到本地服务</text>
</svg>

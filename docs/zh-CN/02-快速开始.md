# FLUX Gateway - å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£æä¾› FLUX Gateway çš„å¼€å‘ç¯å¢ƒæ­å»ºã€ç¼–è¯‘æ„å»ºå’Œå¿«é€Ÿå¯åŠ¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹é¡¹ç›®å¼€å‘ã€‚

---

## ğŸ”§ å¼€å‘ç¯å¢ƒæ­å»º

### 1. å®‰è£… Go ç¯å¢ƒ

```bash
# æ£€æŸ¥ Go ç‰ˆæœ¬
go version  # éœ€è¦ Go 1.24+

# å¦‚æœæœªå®‰è£…ï¼Œè¯·è®¿é—® https://golang.org/dl/ ä¸‹è½½å®‰è£…
```

**å›½å†…ç”¨æˆ·é…ç½® Go ä»£ç†ï¼ˆæ¨èï¼‰**

```bash
go env -w GOPROXY=https://goproxy.cn,direct
go env -w GOSUMDB=sum.golang.google.cn
```

### 2. Windows ç¯å¢ƒç‰¹æ®Šé…ç½®

ç”±äºé¡¹ç›®ä¾èµ– CGOï¼ˆç‰¹åˆ«æ˜¯ Oracle æ”¯æŒï¼‰ï¼ŒWindows ç”¨æˆ·éœ€è¦å®‰è£… C ç¼–è¯‘å™¨ï¼š

#### å®‰è£… TDM-GCCï¼ˆæ¨èï¼‰

1. è®¿é—® [TDM-GCC ä¸‹è½½é¡µé¢](https://jmeubank.github.io/tdm-gcc/download/)
2. ä¸‹è½½ï¼š`tdm64-gcc-10.3.0-2.exe`ï¼ˆ64+32ä½ MinGW-w64 ç‰ˆæœ¬ï¼‰
3. å®‰è£…å®Œæˆå**é‡æ–°æ‰“å¼€å‘½ä»¤è¡Œçª—å£**
4. éªŒè¯å®‰è£…ï¼š
   ```cmd
   gcc --version
   ```

#### å…¶ä»–å¯é€‰ç¼–è¯‘å™¨

- **Microsoft Visual Studio Build Tools**
- **MinGW-w64**

### 3. Oracle æ”¯æŒç¯å¢ƒé…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ Oracle æ•°æ®åº“æ”¯æŒï¼Œéœ€è¦é¢å¤–é…ç½®ï¼š

#### Windows ç¯å¢ƒ

1. **ä¸‹è½½ Oracle Instant Client**
   - Basic Package: [instantclient-basic-windows.x64-21.18.0.0.0dbru.zip](https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html)
   - SDK Package: [instantclient-sdk-windows.x64-21.18.0.0.0dbru.zip](https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html)

2. **å®‰è£…æ­¥éª¤**
   ```cmd
   # åˆ›å»ºç›®æ ‡ç›®å½•
   mkdir D:\SDK\instantclient_21_18
   
   # è§£å‹ä¸¤ä¸ª zip åŒ…åˆ°åŒä¸€ç›®å½•
   # ç¡®ä¿ç›®å½•ç»“æ„ï¼š
   # D:\SDK\instantclient_21_18\
   # â”œâ”€â”€ oci.dll
   # â”œâ”€â”€ sdk\
   # â”‚   â”œâ”€â”€ include\
   # â”‚   â”‚   â””â”€â”€ oci.h
   # â”‚   â””â”€â”€ lib\
   # â”‚       â””â”€â”€ msvc\
   # â”‚           â””â”€â”€ oci.lib
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```cmd
   # è®¾ç½®ç¯å¢ƒå˜é‡
   setx ORACLE_HOME "D:\SDK\instantclient_21_18"
   setx PATH "%ORACLE_HOME%;%PATH%"
   setx CGO_ENABLED "1"
   
   # æˆ–ä½¿ç”¨å®˜æ–¹è„šæœ¬
   cd scripts\build
   setup-oracle-env.cmd
   ```

#### Linux ç¯å¢ƒ

1. **å®‰è£…ä¾èµ–å·¥å…·**
   ```bash
   # Debian/Ubuntu
   sudo apt-get update
   sudo apt-get install -y wget unzip libaio1
   
   # CentOS/RHEL
   sudo yum install -y wget unzip libaio
   ```

2. **ä¸‹è½½å¹¶å®‰è£… Oracle Instant Client**
   ```bash
   # åˆ›å»ºç›®æ ‡ç›®å½•
   sudo mkdir -p /opt/oracle
   cd /opt/oracle
   
   # ä¸‹è½½ Oracle Instant Clientï¼ˆä½¿ç”¨å®˜æ–¹ä¸‹è½½åœ°å€ï¼‰
   sudo wget https://download.oracle.com/otn_software/linux/instantclient/2118000/instantclient-basic-linux.x64-21.18.0.0.0dbru.zip
   sudo wget https://download.oracle.com/otn_software/linux/instantclient/2118000/instantclient-sdk-linux.x64-21.18.0.0.0dbru.zip
   
   # è§£å‹ä¸¤ä¸ª zip åŒ…åˆ°åŒä¸€ç›®å½•
   sudo unzip -qo instantclient-basic-linux.x64-21.18.0.0.0dbru.zip
   sudo unzip -qo instantclient-sdk-linux.x64-21.18.0.0.0dbru.zip
   
   # æ¸…ç†ä¸‹è½½çš„ zip æ–‡ä»¶
   sudo rm -f *.zip
   
   # ç¡®ä¿ç›®å½•ç»“æ„ï¼š
   # /opt/oracle/instantclient_21_18/
   # â”œâ”€â”€ libclntsh.so.21.1
   # â”œâ”€â”€ libocci.so.21.1
   # â”œâ”€â”€ sdk/
   # â”‚   â”œâ”€â”€ include/
   # â”‚   â”‚   â””â”€â”€ oci.h
   # â”‚   â””â”€â”€ lib/
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # æ–¹æ³•ä¸€ï¼šæ·»åŠ åˆ° ~/.bashrcï¼ˆæ¨èï¼Œä»…å½“å‰ç”¨æˆ·ï¼‰
   cat >> ~/.bashrc << 'EOF'
   export ORACLE_HOME=/opt/oracle/instantclient_21_18
   export LD_LIBRARY_PATH=$ORACLE_HOME:$LD_LIBRARY_PATH
   export CGO_ENABLED=1
   EOF
   
   # æ–¹æ³•äºŒï¼šæ·»åŠ åˆ° /etc/profileï¼ˆç³»ç»Ÿçº§ï¼Œæ‰€æœ‰ç”¨æˆ·ï¼‰
   sudo tee -a /etc/profile << 'EOF'
   export ORACLE_HOME=/opt/oracle/instantclient_21_18
   export LD_LIBRARY_PATH=$ORACLE_HOME:$LD_LIBRARY_PATH
   export CGO_ENABLED=1
   EOF
   
   # ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
   source ~/.bashrc
   # æˆ–
   source /etc/profile
   
   # éªŒè¯ç¯å¢ƒå˜é‡
   echo $ORACLE_HOME
   echo $LD_LIBRARY_PATH
   ```

4. **éªŒè¯å®‰è£…**
   ```bash
   # æ£€æŸ¥åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   ls -lh $ORACLE_HOME/libclntsh.so*
   ls -lh $ORACLE_HOME/sdk/include/oci.h
   
   # éªŒè¯ç¯å¢ƒå˜é‡
   echo $ORACLE_HOME
   echo $LD_LIBRARY_PATH
   ```

> ğŸ’¡ **è¯´æ˜**ï¼š
> - å¦‚æœä½¿ç”¨ wget ä¸‹è½½æ—¶é‡åˆ°è®¤è¯é—®é¢˜ï¼Œå¯ä»¥è®¿é—® [Oracle å®˜æ–¹ä¸‹è½½é¡µé¢](https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html) æ‰‹åŠ¨ä¸‹è½½
> - ä¸‹è½½å‰éœ€è¦æ¥å— Oracle è®¸å¯åè®®
> - å»ºè®®ä½¿ç”¨ `libaio1` åŒ…ï¼ˆDebian/Ubuntuï¼‰æˆ– `libaio` åŒ…ï¼ˆCentOS/RHELï¼‰ï¼Œè¿™æ˜¯ Oracle Instant Client çš„è¿è¡Œæ—¶ä¾èµ–

#### macOS ç¯å¢ƒ

```bash
# 1. ä¸‹è½½å¹¶å®‰è£… Oracle Instant Client
sudo mkdir -p /opt/oracle
cd /opt/oracle
unzip instantclient-basic-macos.x64-21.18.0.0.0dbru.zip
unzip instantclient-sdk-macos.x64-21.18.0.0.0dbru.zip

# 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæ·»åŠ åˆ° ~/.zshrc æˆ– ~/.bash_profileï¼‰
export ORACLE_HOME=/opt/oracle/instantclient_21_18
export DYLD_LIBRARY_PATH=$ORACLE_HOME:$DYLD_LIBRARY_PATH
export CGO_ENABLED=1

# 3. å®‰è£… Xcode Command Line Tools
xcode-select --install
```

---

## ğŸ“¦ è·å–æºç 

### å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/fluxsce/gateway.git
cd gateway
```

### é¡¹ç›®ç»“æ„

```
gateway/
â”œâ”€â”€ cmd/                          # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ app/                      # ä¸»åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ cache/                    # ç¼“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ gateway/                  # ç½‘å…³æœåŠ¡
â”‚   â””â”€â”€ web/                      # Webç®¡ç†ç•Œé¢
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ app.yaml                  # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ database.yaml             # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ gateway.yaml              # ç½‘å…³é…ç½®
â”‚   â”œâ”€â”€ logger.yaml               # æ—¥å¿—é…ç½®
â”‚   â””â”€â”€ web.yaml                  # WebæœåŠ¡é…ç½®
â”œâ”€â”€ internal/                     # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ gateway/                  # ç½‘å…³æ ¸å¿ƒå®ç°
â”‚   â”‚   â”œâ”€â”€ bootstrap/            # ç½‘å…³å¯åŠ¨å™¨
â”‚   â”‚   â”œâ”€â”€ config/               # ç½‘å…³é…ç½®
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”œâ”€â”€ handler/              # å¤„ç†å™¨é›†åˆ
â”‚   â”‚   â””â”€â”€ loader/               # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ tunnel/                   # éš§é“ç®¡ç†
â”‚   â”œâ”€â”€ registry/                 # æœåŠ¡æ³¨å†Œ
â”‚   â””â”€â”€ types/                    # æ•°æ®ç±»å‹
â”œâ”€â”€ pkg/                          # å…¬å…±åŒ…ï¼ˆå¯å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ cache/                    # ç¼“å­˜å·¥å…·åŒ…
â”‚   â”œâ”€â”€ config/                   # é…ç½®å·¥å…·åŒ…
â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“å·¥å…·åŒ…
â”‚   â”œâ”€â”€ logger/                   # æ—¥å¿—å·¥å…·åŒ…
â”‚   â””â”€â”€ utils/                    # é€šç”¨å·¥å…·
â”œâ”€â”€ web/                          # Webç®¡ç†å¹³å°
â”‚   â”œâ”€â”€ frontend/                 # Vue3å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ middleware/               # Webä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/                   # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ views/                    # ä¸šåŠ¡æ¨¡å—è§†å›¾
â”œâ”€â”€ scripts/                      # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ build/                    # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ deploy/                   # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ db/                       # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ test/                         # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ go.mod                        # Goæ¨¡å—å®šä¹‰
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## ğŸ”¨ ç¼–è¯‘æ„å»º

### 1. å®‰è£…ä¾èµ–

```bash
# ä¸‹è½½ä¾èµ–
go mod download

# éªŒè¯ä¾èµ–
go mod verify

# æ•´ç†ä¾èµ–
go mod tidy
```

### 2. ä½¿ç”¨å®˜æ–¹æ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰

> ğŸ’¡ **æ¨èä½¿ç”¨ `scripts/build` ç›®å½•ä¸‹çš„å®˜æ–¹æ„å»ºè„šæœ¬**  
> å®˜æ–¹è„šæœ¬å·²ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œæ”¯æŒå¤šå¹³å°ã€å¤šæ•°æ®åº“ç‰ˆæœ¬çš„è‡ªåŠ¨åŒ–æ„å»ºï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å¤æ‚çš„ç¼–è¯‘å‚æ•°ã€‚

#### Windows å¹³å°

```cmd
# è¿›å…¥æ„å»ºè„šæœ¬ç›®å½•
cd scripts\build

# Windows 10/11 ç‰ˆæœ¬ï¼ˆé»˜è®¤æ”¯æŒ Oracleï¼‰
build-win10.cmd

# æˆ–æŒ‡å®šå‚æ•°
build-win10.cmd --oracle    # å¯ç”¨ Oracle æ”¯æŒï¼ˆé»˜è®¤ï¼‰
build-win10.cmd --no-oracle # ç¦ç”¨ Oracle æ”¯æŒï¼ˆä»… MySQLï¼‰
```

**æ„å»ºäº§ç‰©**
- è¾“å‡ºç›®å½•ï¼š`dist/gateway/`
- åŒ…å«å®Œæ•´çš„éƒ¨ç½²åŒ…ç»“æ„ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€Web èµ„æºã€éƒ¨ç½²è„šæœ¬ï¼‰

#### Linux å¹³å°

```bash
# è¿›å…¥æ„å»ºè„šæœ¬ç›®å½•
cd scripts/build

# CentOS 7 å…¼å®¹ç‰ˆæœ¬ï¼ˆé»˜è®¤æ”¯æŒ Oracleï¼‰
./build-centos7.sh
```

**æ„å»ºäº§ç‰©**
- è¾“å‡ºç›®å½•ï¼š`dist/gateway/`
- åŒ…å«å®Œæ•´çš„éƒ¨ç½²åŒ…ç»“æ„ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€Web èµ„æºã€éƒ¨ç½²è„šæœ¬ï¼‰

**æ„å»ºè„šæœ¬è¯´æ˜**
- è‡ªåŠ¨æ£€æµ‹å’Œé…ç½®ç¼–è¯‘ç¯å¢ƒ
- è‡ªåŠ¨å¤„ç† CGO å’Œ Oracle ä¾èµ–
- è‡ªåŠ¨æ£€æŸ¥ Oracle ç¯å¢ƒï¼Œç¯å¢ƒä¸å®Œæ•´æ—¶åœæ­¢æ„å»ºå¹¶æç¤º
- è‡ªåŠ¨ä¼˜åŒ–äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°
- ç»Ÿä¸€è¾“å‡ºåˆ° `dist/gateway/` ç›®å½•ï¼ŒåŒ…å«å®Œæ•´éƒ¨ç½²ç»“æ„
- è¯¦ç»†çš„æ„å»ºæ—¥å¿—è¾“å‡º

> âš ï¸ **æ³¨æ„**ï¼š
> - é»˜è®¤å¯ç”¨ Oracle æ”¯æŒï¼Œéœ€è¦é¢„å…ˆå®‰è£… Oracle Instant Client å¹¶è®¾ç½® `ORACLE_HOME` ç¯å¢ƒå˜é‡
> - å¦‚æœ Oracle ç¯å¢ƒä¸å®Œæ•´ï¼Œæ„å»ºè„šæœ¬ä¼šåœæ­¢æ‰§è¡Œå¹¶æç¤ºé”™è¯¯ä¿¡æ¯
> - å¦‚éœ€ç¦ç”¨ Oracle æ”¯æŒï¼ŒWindows ä½¿ç”¨ `--no-oracle` å‚æ•°ï¼ŒLinux ä¿®æ”¹è„šæœ¬ä¸­çš„ `BUILD_TAGS` æ·»åŠ  `no_oracle` æ ‡ç­¾

### 3. å¼€å‘è°ƒè¯•ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰

å¦‚æœåªæ˜¯æœ¬åœ°å¼€å‘è°ƒè¯•ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„ `go build` å‘½ä»¤ï¼š

```bash
# å¿«é€Ÿç¼–è¯‘ï¼ˆä¸ä¼˜åŒ–ï¼‰
go build -o bin/gateway cmd/app/main.go

# Windows ç¯å¢ƒ
go build -o bin/gateway.exe cmd/app/main.go
```

> âš ï¸ **æ³¨æ„**ï¼šå¼€å‘è°ƒè¯•ç¼–è¯‘ä¸åŒ…å«ç”Ÿäº§ä¼˜åŒ–ï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

---

## ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–

### MySQL æ•°æ®åº“

```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE gateway CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 2. å¯¼å…¥è¡¨ç»“æ„
mysql -u root -p gateway < scripts/db/mysql.sql

# æˆ–ä½¿ç”¨å®Œæ•´è„šæœ¬
mysql -u root -p gateway < scripts/db/frp_tunnel_management.sql
```

### Oracle æ•°æ®åº“

```bash
# å¯¼å…¥è¡¨ç»“æ„
sqlplus username/password@host:port/service_name @scripts/db/oracle.sql

# æˆ–ä½¿ç”¨å®Œæ•´è„šæœ¬
sqlplus username/password@host:port/service_name @scripts/db/frp_tunnel_management_oracle.sql
```

### SQLite æ•°æ®åº“

```bash
# SQLite ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“æ–‡ä»¶
# å¦‚éœ€æ‰‹åŠ¨åˆå§‹åŒ–ï¼š
sqlite3 gateway.db < scripts/db/sqlite.sql

# æˆ–ä½¿ç”¨å®Œæ•´è„šæœ¬
sqlite3 gateway.db < scripts/db/frp_tunnel_management_sqlite.sql
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### 1. åº”ç”¨é…ç½® (configs/app.yaml)

```yaml
app:
  name: "Gateway"
  version: "2.0.0"
  debug: false

server:
  host: "0.0.0.0"
  port: 8080

timer:
  enabled: true
  tenant_ids: ["tenant001"]
```

### 2. æ•°æ®åº“é…ç½® (configs/database.yaml)

```yaml
database:
  type: mysql  # mysql, oracle, sqlite
  host: localhost
  port: 3306
  username: root
  password: your_password
  database: gateway
  
  # SQLite é…ç½®
  # type: sqlite
  # database: ./gateway.db
  
  # Oracle é…ç½®
  # type: oracle
  # host: localhost
  # port: 1521
  # username: gateway
  # password: your_password
  # database: XE  # æœåŠ¡åæˆ–SID
```

### 3. ç½‘å…³é…ç½® (configs/gateway.yaml)

```yaml
gateway:
  # ç›‘å¬ç«¯å£
  port: 8080
  
  # è¶…æ—¶é…ç½®
  timeout:
    read: 30s
    write: 30s
    idle: 120s
  
  # é™æµé…ç½®
  rate_limit:
    enabled: true
    rate: 1000  # æ¯ç§’è¯·æ±‚æ•°
    burst: 2000 # çªå‘æµé‡
```

### 4. Web æ§åˆ¶å°é…ç½® (configs/web.yaml)

```yaml
web:
  name: "Gateway WebæœåŠ¡"
  port: 12003
  run_mode: "debug"  # debug æˆ– release
  
  # é™æ€èµ„æºé…ç½®
  static:
    path: "./web/static"
    prefix: "/static"
  
  # Vue3å‰ç«¯é…ç½®
  frontend:
    path: "./web/frontend/dist"
    prefix: "/"
  
  # CORSè·¨åŸŸé…ç½®
  cors:
    allowed_origins: "*"
    allowed_methods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
    allowed_headers: "Origin,Content-Type,Accept,Authorization"
```

### 5. æ—¥å¿—é…ç½® (configs/logger.yaml)

```yaml
logger:
  level: debug  # debug, info, warn, error
  format: json  # json, text
  output: file  # stdout, file
  
  # æ–‡ä»¶è¾“å‡ºé…ç½®
  file:
    path: logs/
    max_size: 100  # MB
    max_backups: 10
    max_age: 30    # å¤©
```

---

## ğŸš€ å¯åŠ¨åº”ç”¨

### 1. å¼€å‘æ¨¡å¼å¯åŠ¨

```bash
# ç›´æ¥è¿è¡Œ
go run cmd/app/main.go

# æŒ‡å®šé…ç½®ç›®å½•
go run cmd/app/main.go --config ./configs

# è®¾ç½®æ—¥å¿—çº§åˆ«
export GATEWAY_LOG_LEVEL=debug
go run cmd/app/main.go
```

### 2. ä½¿ç”¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶å¯åŠ¨

```bash
# Linux/macOS
./bin/gateway

# Windows
bin\gateway.exe

# åå°è¿è¡Œï¼ˆLinux/macOSï¼‰
nohup ./bin/gateway > logs/app.log 2>&1 &
```

### 3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

å¯åŠ¨æˆåŠŸåï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```
[INFO] Gateway starting...
[INFO] Database connected successfully
[INFO] Gateway server started on :8080
[INFO] Web console started on :12003
```

### 4. è®¿é—® Web æ§åˆ¶å°

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- **æ§åˆ¶å°åœ°å€**: http://localhost:12003/gatewayweb
- **é»˜è®¤ç”¨æˆ·å**: `admin`
- **é»˜è®¤å¯†ç **: `123456`

---

## ğŸ“Š ç½‘å…³è¯·æ±‚å¤„ç†æµç¨‹

<p align="center">
  <img src="../images/gateway_flow.svg" alt="ç½‘å…³è¯·æ±‚å¤„ç†æµç¨‹" width="100%">
</p>

### å¤„ç†æµç¨‹è¯´æ˜

ç½‘å…³è¯·æ±‚å¤„ç†é‡‡ç”¨**è´£ä»»é“¾æ¨¡å¼**ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰é¡ºåºç»è¿‡ä»¥ä¸‹å¤„ç†é˜¶æ®µï¼š

1. **å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚** â†’ è¯·æ±‚åˆ°è¾¾ç½‘å…³
2. **å‰ç½®å¤„ç†** â†’ è¯·æ±‚è§£æã€å‚æ•°éªŒè¯ã€åè®®è½¬æ¢
3. **å…¨å±€å®‰å…¨æ§åˆ¶** â†’ IP é»‘ç™½åå•ã€User-Agent è¿‡æ»¤ã€åŸŸåè®¿é—®æ§åˆ¶
4. **å…¨å±€ CORS å¤„ç†** â†’ è·¨åŸŸé…ç½®ã€é¢„æ£€è¯·æ±‚
5. **å…¨å±€è®¤è¯é‰´æƒ** â†’ JWTã€OAuth2.0ã€API Key éªŒè¯
6. **å…¨å±€é™æµæ§åˆ¶** â†’ ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ã€æ»‘åŠ¨çª—å£é™æµ
7. **è·¯ç”±åŒ¹é…** â†’ æ ¹æ®è·¯å¾„ã€æ–¹æ³•åŒ¹é…å¯¹åº”è·¯ç”±
8. **è·¯ç”±çº§å¤„ç†å™¨é“¾** â†’ è·¯ç”±çº§è®¤è¯ã€é™æµã€è‡ªå®šä¹‰æ’ä»¶
9. **æœåŠ¡å‘ç°** â†’ ä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨æœåŠ¡å®ä¾‹
10. **è´Ÿè½½å‡è¡¡** â†’ é€‰æ‹©ç›®æ ‡æœåŠ¡å®ä¾‹
11. **ç†”æ–­æ£€æŸ¥** â†’ æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
12. **è¯·æ±‚è½¬å‘** â†’ è½¬å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡
13. **å“åº”å¤„ç†** â†’ å¤„ç†åç«¯å“åº”ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯

**åŸºç¡€è®¾æ–½æ”¯æ’‘**ï¼šæ—¥å¿—è®°å½•ã€ç›‘æ§æŒ‡æ ‡ã€é…ç½®ç®¡ç†ã€ç¼“å­˜æ”¯æŒã€æ•°æ®æŒä¹…åŒ–

---

## âœ… éªŒè¯å®‰è£…

### 1. å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥ç½‘å…³çŠ¶æ€
curl http://localhost:8080/health

# æ£€æŸ¥ Web æ§åˆ¶å°
curl http://localhost:12003/health
```

### 2. æŸ¥çœ‹è¿›ç¨‹

```bash
# Linux/macOS
ps aux | grep gateway

# Windows
tasklist | findstr gateway
```

### 3. æŸ¥çœ‹ç«¯å£

```bash
# Linux/macOS
netstat -tulpn | grep :8080
lsof -i :8080

# Windows
netstat -ano | findstr :8080
```

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/debug.log
tail -f logs/error.log

# Windows
type logs\debug.log
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨

```bash
# é”™è¯¯: bind: address already in use
# è§£å†³: ä¿®æ”¹ç«¯å£é…ç½®æˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹

# Linux/macOS
lsof -i :8080
kill -9 <PID>

# Windows
netstat -ano | findstr :8080
taskkill /PID <PID> /F
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# é”™è¯¯: åˆå§‹åŒ–æ•°æ®åº“å¤±è´¥
# è§£å†³: æ£€æŸ¥æ•°æ®åº“é…ç½®ã€ç½‘ç»œè¿æ¥å’Œæƒé™

# æµ‹è¯• MySQL è¿æ¥
mysql -h localhost -u root -p gateway

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat configs/database.yaml
```

### 3. æƒé™é—®é¢˜

```bash
# é”™è¯¯: permission denied
# è§£å†³: ç¡®ä¿ç¨‹åºæœ‰æ‰§è¡Œæƒé™ï¼Œæ—¥å¿—ç›®å½•æœ‰å†™æƒé™

# Linux/macOS
chmod +x bin/gateway
mkdir -p logs
chmod 755 logs

# Windows
# å³é”® -> å±æ€§ -> å®‰å…¨ -> ç¼–è¾‘æƒé™
```

### 4. CGO ç¼–è¯‘é”™è¯¯

```bash
# é”™è¯¯: cgo: C compiler "gcc" not found
# è§£å†³: å®‰è£… C ç¼–è¯‘å™¨

# Windows: å®‰è£… TDM-GCC
# Linux: sudo apt-get install build-essential
# macOS: xcode-select --install
```

### 5. Oracle ç›¸å…³é—®é¢˜

```bash
# é”™è¯¯: cannot open shared object file: libclntsh.so
# è§£å†³: æ£€æŸ¥ Oracle Instant Client å®‰è£…å’Œç¯å¢ƒå˜é‡

# Linux
export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_18:$LD_LIBRARY_PATH

# macOS
export DYLD_LIBRARY_PATH=/opt/oracle/instantclient_21_18:$DYLD_LIBRARY_PATH

# Windows
set PATH=D:\SDK\instantclient_21_18;%PATH%
```

---

## ğŸ“– ä¸‹ä¸€æ­¥

å¼€å‘ç¯å¢ƒæ­å»ºå®Œæˆåï¼Œå»ºè®®ç»§ç»­é˜…è¯»ï¼š

- [é¡¹ç›®ä»‹ç»](./01-é¡¹ç›®ä»‹ç».md) - äº†è§£é¡¹ç›®æ¶æ„å’Œæ ¸å¿ƒèƒ½åŠ›
- [å®‰è£…éƒ¨ç½²](./03-å®‰è£…éƒ¨ç½².md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- [å®¹å™¨åŒ–éƒ¨ç½²](./04-å®¹å™¨åŒ–éƒ¨ç½².md) - Docker å’Œ Kubernetes éƒ¨ç½²

---

## ğŸ¤ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š

- ğŸ“§ é‚®ç®±: fluxopensource@flux.com.cn
- ğŸ’¬ GitHub Issues: [æäº¤é—®é¢˜](https://github.com/fluxsce/gateway/issues)
- ğŸ“š æŸ¥çœ‹å®Œæ•´æ–‡æ¡£: [docs/guide/](../guide/)

---

<div align="center">

**[è¿”å›ç›®å½•](./README.md) â€¢ [ä¸‹ä¸€ç« ï¼šå®‰è£…éƒ¨ç½²](./03-å®‰è£…éƒ¨ç½².md)**

Made with â¤ï¸ by FLUX Gateway Team

</div>

# FLUX Gateway - è°ƒè¯•æŒ‡å—

æœ¬æ–‡æ¡£æä¾› FLUX Gateway é¡¹ç›®çš„è°ƒè¯•æ–¹æ³•å’ŒæŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

---

## ğŸ“‹ ç›®å½•

- [å¼€å‘ç¯å¢ƒè°ƒè¯•](#-å¼€å‘ç¯å¢ƒè°ƒè¯•)
- [æ€§èƒ½åˆ†æ](#-æ€§èƒ½åˆ†æ)
- [å¸¸è§é—®é¢˜æ’æŸ¥](#-å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ğŸ”§ å¼€å‘ç¯å¢ƒè°ƒè¯•

### VSCode è°ƒè¯•é…ç½®

é¡¹ç›®å·²é…ç½®å¥½ `.vscode/launch.json`ï¼Œæ”¯æŒä»¥ä¸‹è°ƒè¯•æ¨¡å¼ï¼š

**1. è¿è¡Œä¸»åº”ç”¨ç¨‹åº**
```json
{
  "name": "è¿è¡Œä¸»åº”ç”¨ç¨‹åº",
  "type": "go",
  "request": "launch",
  "mode": "debug",
  "program": "${workspaceFolder}/cmd/app/main.go"
}
```

**2. è¿è¡Œå¸¦è°ƒè¯•ä¿¡æ¯**
```json
{
  "name": "è¿è¡Œå¸¦è°ƒè¯•ä¿¡æ¯",
  "type": "go",
  "request": "launch",
  "mode": "debug",
  "program": "${workspaceFolder}/cmd/app/main.go",
  "env": {
    "DEBUG": "true"
  }
}
```

### ä½¿ç”¨æ–­ç‚¹

**è®¾ç½®æ–­ç‚¹ï¼š**
- ç‚¹å‡»ä»£ç è¡Œå·å·¦ä¾§ç©ºç™½å¤„ï¼ˆå‡ºç°çº¢ç‚¹ï¼‰
- å¿«æ·é”®ï¼š`F9`

**æ¡ä»¶æ–­ç‚¹ï¼š**
- å³é”®ç‚¹å‡»æ–­ç‚¹ â†’ ç¼–è¾‘æ–­ç‚¹ â†’ æ·»åŠ æ¡ä»¶è¡¨è¾¾å¼
- ç¤ºä¾‹ï¼š`userId == "123"` æˆ– `count > 10`

**æ—¥å¿—ç‚¹ï¼š**
- å³é”®ç‚¹å‡»æ–­ç‚¹ â†’ ç¼–è¾‘æ–­ç‚¹ â†’ æ·»åŠ æ¶ˆæ¯
- ä¸ä¼šæš‚åœç¨‹åºï¼Œåªè¾“å‡ºæ—¥å¿—

### è°ƒè¯•å¿«æ·é”®

| æ“ä½œ | Windows/Linux | Mac |
|------|---------------|-----|
| å¯åŠ¨è°ƒè¯• | `F5` | `F5` |
| ç»§ç»­æ‰§è¡Œ | `F5` | `F5` |
| å•æ­¥æ‰§è¡Œï¼ˆä¸è¿›å…¥å‡½æ•°ï¼‰ | `F10` | `F10` |
| å•æ­¥æ‰§è¡Œï¼ˆè¿›å…¥å‡½æ•°ï¼‰ | `F11` | `F11` |
| è·³å‡ºå½“å‰å‡½æ•° | `Shift+F11` | `Shift+F11` |
| é‡å¯è°ƒè¯• | `Ctrl+Shift+F5` | `Cmd+Shift+F5` |
| åœæ­¢è°ƒè¯• | `Shift+F5` | `Shift+F5` |

---

## ğŸ“Š æ€§èƒ½åˆ†æ

### å¯ç”¨ pprof

Gateway å†…ç½®äº† pprof æ€§èƒ½åˆ†æå·¥å…·ã€‚

**é…ç½®æ–‡ä»¶ `configs/app.yaml`ï¼š**
```yaml
pprof:
  enabled: true
  port: 6060
```

**å¯åŠ¨åè®¿é—®ï¼š**
```
http://localhost:6060/debug/pprof/
```

### CPU æ€§èƒ½åˆ†æ

```bash
# é‡‡é›† 30 ç§’ CPU æ€§èƒ½æ•°æ®
go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30

# ç”Ÿæˆç«ç„°å›¾
go tool pprof -http=:8080 http://localhost:6060/debug/pprof/profile?seconds=30
```

### å†…å­˜åˆ†æ

```bash
# æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨
go tool pprof http://localhost:6060/debug/pprof/heap

# ç”Ÿæˆå†…å­˜åˆ†ææŠ¥å‘Š
go tool pprof -http=:8080 http://localhost:6060/debug/pprof/heap
```

### Goroutine åˆ†æ

```bash
# æŸ¥çœ‹æ‰€æœ‰ goroutine
curl http://localhost:6060/debug/pprof/goroutine?debug=2

# åˆ†æ goroutine æ³„æ¼
go tool pprof http://localhost:6060/debug/pprof/goroutine
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. åº”ç”¨æ— æ³•å¯åŠ¨

**é—®é¢˜ç°è±¡ï¼š**
```
Error: failed to connect to database
```

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥æ•°æ®åº“é…ç½®**
   ```bash
   cat configs/database.yaml
   ```

2. **æµ‹è¯•æ•°æ®åº“è¿æ¥**
   ```bash
   # MySQL
   mysql -h localhost -P 3306 -u gateway -p

   # æˆ–ä½¿ç”¨ telnet
   telnet localhost 3306
   ```

3. **æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€**
   ```bash
   # æ£€æŸ¥ MySQL è¿›ç¨‹
   ps aux | grep mysql
   
   # æ£€æŸ¥ç«¯å£ç›‘å¬
   netstat -tulpn | grep 3306
   ```

---

### 2. å†…å­˜æ³„æ¼

**é—®é¢˜ç°è±¡ï¼š**
- å†…å­˜æŒç»­å¢é•¿
- OOM (Out of Memory) é”™è¯¯

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æŸ¥çœ‹å†…å­˜ä½¿ç”¨**
   ```bash
   # æŸ¥çœ‹è¿›ç¨‹å†…å­˜ä½¿ç”¨
   ps aux | grep gateway
   
   # ä½¿ç”¨ top å‘½ä»¤
   top -p $(pgrep gateway)
   ```

2. **åˆ†æå†…å­˜å¿«ç…§**
   ```bash
   go tool pprof http://localhost:6060/debug/pprof/heap
   ```

3. **æŸ¥çœ‹ goroutine æ•°é‡**
   ```bash
   curl http://localhost:6060/debug/pprof/goroutine?debug=1 | grep goroutine
   ```

---

### 3. æ€§èƒ½é—®é¢˜

**é—®é¢˜ç°è±¡ï¼š**
- å“åº”æ—¶é—´æ…¢
- CPU ä½¿ç”¨ç‡é«˜

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æŸ¥çœ‹ CPU ä½¿ç”¨**
   ```bash
   # æŸ¥çœ‹è¿›ç¨‹ CPU ä½¿ç”¨
   ps aux | grep gateway
   
   # ä½¿ç”¨ top å‘½ä»¤
   top -p $(pgrep gateway)
   ```

2. **CPU æ€§èƒ½åˆ†æ**
   ```bash
   go tool pprof -http=:8080 http://localhost:6060/debug/pprof/profile?seconds=30
   ```

3. **æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—**
   ```bash
   grep "slow query" logs/debug.log
   ```

---

### 4. ç½‘ç»œè¿æ¥é—®é¢˜

**é—®é¢˜ç°è±¡ï¼š**
```
Error: dial tcp: connect: connection refused
```

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥ç«¯å£ç›‘å¬**
   ```bash
   # æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
   netstat -tulpn | grep 8080
   
   # æˆ–ä½¿ç”¨ ss å‘½ä»¤
   ss -tulpn | grep 8080
   ```

2. **æµ‹è¯•ç«¯å£è¿é€šæ€§**
   ```bash
   telnet localhost 8080
   nc -zv localhost 8080
   ```

3. **æ£€æŸ¥é˜²ç«å¢™è§„åˆ™**
   ```bash
   # Linux
   iptables -L -n

   # æ£€æŸ¥ SELinux
   getenforce
   ```

---

### 5. é…ç½®æ–‡ä»¶é—®é¢˜

**é—®é¢˜ç°è±¡ï¼š**
```
Error: failed to load config file
```

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨**
   ```bash
   ls -la configs/
   ```

2. **éªŒè¯ YAML è¯­æ³•**
   ```bash
   # ä½¿ç”¨ yamllint
   yamllint configs/database.yaml

   # æˆ–ä½¿ç”¨ Python
   python -c "import yaml; yaml.safe_load(open('configs/database.yaml'))"
   ```

3. **æ£€æŸ¥æ–‡ä»¶æƒé™**
   ```bash
   ls -l configs/
   chmod 644 configs/*.yaml
   ```

---

## ğŸ“– ä¸‹ä¸€æ­¥

è°ƒè¯•æŠ€å·§æŒæ¡åï¼Œå»ºè®®ç»§ç»­é˜…è¯»ï¼š

- [é¡¹ç›®ä»‹ç»](./01-é¡¹ç›®ä»‹ç».md) - äº†è§£é¡¹ç›®æ¶æ„å’Œæ ¸å¿ƒèƒ½åŠ›
- [å¼€å‘æŒ‡å—](./02-å¿«é€Ÿå¼€å§‹.md) - å¼€å‘ç¯å¢ƒæ­å»ºå’Œé…ç½®è¯´æ˜
- [é”™è¯¯å¤„ç†](./07-é”™è¯¯å¤„ç†.md) - é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

---

## ğŸ¤ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°è°ƒè¯•é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š

- ğŸ“§ é‚®ç®±ï¼šfluxopensource@flux.com.cn
- ğŸ’¬ GitHub Issuesï¼š[æäº¤é—®é¢˜](https://github.com/fluxsce/gateway/issues)

---

**[è¿”å›ç›®å½•](./README.md) â€¢ [ä¸Šä¸€ç« ï¼šæ•°æ®åº“è§„èŒƒ](./05-æ•°æ®åº“è§„èŒƒ.md) â€¢ [ä¸‹ä¸€ç« ï¼šé”™è¯¯å¤„ç†](./07-é”™è¯¯å¤„ç†.md)**

---

<div align="center">

Made with â¤ï¸ by FLUX Gateway Team

</div>


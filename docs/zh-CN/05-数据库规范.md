# FLUX Gateway - 数据库设计规范

本文档定义了 FLUX Gateway 项目的数据库设计规范，包括命名规范、字段规范、索引规范等，确保数据库设计的一致性和可维护性。

---

## 📋 目录

- [命名规范](#-命名规范)
  - [数据库命名](#数据库命名)
  - [表命名规范](#表命名规范)
  - [字段命名规范](#字段命名规范)
  - [长度规范](#长度规范)
- [必须包含的通用字段](#-必须包含的通用字段)
- [字段命名语义要求](#-字段命名语义要求)
- [其他规范](#-其他规范)
- [示例](#-示例)

---

## 📝 命名规范

### 数据库命名

- 使用小写字母
- 多个单词使用下划线分隔
- 例如：`web_hub_here`、`gateway_db`

---

### 表命名规范

- 所有表名必须以 `HUB` 开头
- 表名使用大写字母
- 多个单词使用下划线分隔
- 模块前缀\_功能，例如：`HUB_USER_ACCOUNT`、`HUB_ORDER_INFO`
- 避免使用数据库关键字
- 表名应当使用单数形式

**示例：**
```
HUB_USER_ACCOUNT      # 用户账号表
HUB_GW_INSTANCE       # 网关实例表
HUB_TIMER_SCHEDULER   # 定时器调度表
```

---

### 字段命名规范

#### 基本规则

- **使用驼峰命名法(camelCase)**
- **禁止直接使用 `id` 作为字段名**，主键命名应当体现业务含义，如 `userId`、`orderId` 等
- **严格禁止使用自增字段**
- 避免使用数据库关键字作为字段名
- 字段名称必须清晰表达其用途和业务含义，避免使用缩写
- 外键字段名应当表明与其相关联的表和字段，如 `parentUserId`、`relatedOrderId` 等

#### 特殊字段规则

**① 禁止使用 `is` 前缀**
```
❌ 错误：isDeleted、isActive、isApproved
✅ 正确：activeFlag、deleteFlag、approveFlag
```

**② 日期时间字段**

统一使用 `DATETIME` 类型，时间字段应设置合适的默认值：
- `addTime`：使用 `DEFAULT CURRENT_TIMESTAMP`
- `editTime`：使用 `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP`

**③ 金额类型字段**

应以 `amount` 或 `price` 结尾：
```
totalAmount    # 总金额
unitPrice      # 单价
discountAmount # 折扣金额
```

**④ 数量类型字段**

应以 `count`、`num` 或 `quantity` 结尾：
```
visitCount     # 访问次数
stockQuantity  # 库存数量
orderNum       # 订单数量
```

**⑤ 状态标记字段**

使用 `VARCHAR(1)` 类型，值为 'Y'/'N'：
```sql
activeFlag VARCHAR(1) DEFAULT 'Y'  # 活动状态
deleteFlag VARCHAR(1) DEFAULT 'N'  # 删除标记
```

---

### 长度规范

#### 表名称长度规范

| 数据库 | 最大长度 | 建议长度 |
|--------|---------|---------|
| **Oracle** | 30 字符 | ≤ 25 字符 |
| **MySQL** | 64 字符 | ≤ 60 字符 |
| **SQLite** | 64 字符 | ≤ 60 字符 |

**说明：** 建议预留空间，避免后续修改时超出限制。

---

#### 主键名称长度规范

| 数据库 | 最大长度 |
|--------|---------|
| **Oracle** | 30 字符 |
| **MySQL** | 64 字符 |
| **SQLite** | 64 字符 |

**主键命名规范：**
- 格式：`PK_表名简写` 或 `PK_模块简写_功能简写`
- 示例：
  - `HUB_USER` → `PK_USER`
  - `HUB_GW_INSTANCE` → `PK_GW_INSTANCE`
  - `HUB_GW_ROUTER_CONFIG` → `PK_GW_ROUTER_CONFIG`

---

#### 索引名称长度规范

| 数据库 | 最大长度 |
|--------|---------|
| **Oracle** | 30 字符 |
| **MySQL** | 64 字符 |
| **SQLite** | 64 字符 |

**索引命名规范：**
- 格式：`IDX_表名简写_字段简写` 或 `IDX_模块简写_字段简写`
- 示例：
  - `HUB_USER` 表的 `tenantId` 字段 → `IDX_USER_TENANT`
  - `HUB_GW_INSTANCE` 表的 `bindAddress` 和 `httpPort` 字段 → `IDX_GW_INST_BIND_HTTP`
  - `HUB_TIMER_TASK` 表的 `taskName` 字段 → `IDX_TIMER_TASK_NAME`

---

#### 命名简写规则

为了满足长度限制，采用以下简写规则：

| 完整名称 | 简写 | 说明 |
|---------|------|------|
| HUB_GATEWAY | GW | 网关模块 |
| HUB_TIMER | TIMER | 定时器模块 |
| HUB_USER | USER | 用户模块 |
| HUB_LOGIN | LOGIN | 登录模块 |
| INSTANCE | INST | 实例 |
| CONFIG | CFG | 配置 |
| DEFINITION | DEF | 定义 |
| AUTHENTICATION | AUTH | 认证 |
| RATE_LIMIT | RATE | 限流 |
| CIRCUIT_BREAKER | CB | 熔断器 |
| SCHEDULER | SCHED | 调度器 |
| SERVICE | SVC | 服务 |

---

## 🔧 必须包含的通用字段

所有表必须包含以下字段：

| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `tablePrimaryKey` | VARCHAR(32) | - | 主键，根据表名具体命名，如 `userId`、`orderId` 等 |
| `tenantId` | VARCHAR(32) | NOT NULL | 主键，租户ID，用于多租户数据隔离 |
| `addTime` | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间，自动设置为当前时间 |
| `addWho` | VARCHAR(32) | - | 创建人ID，关联用户表 |
| `editTime` | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE... | 最后修改时间，创建时设置为当前时间，更新时自动更新 |
| `editWho` | VARCHAR(32) | - | 最后修改人ID，关联用户表 |
| `oprSeqFlag` | VARCHAR(32) | - | 操作序列标识，用于乐观锁控制 |
| `currentVersion` | INT | DEFAULT 1 | 当前版本号，初始值为1，每次更新+1 |
| `activeFlag` | VARCHAR(1) | DEFAULT 'Y' | 活动状态标记，'N'表示非活动，'Y'表示活动 |
| `noteText` | VARCHAR(500) | DEFAULT NULL | 备注信息 |
| `extProperty` | TEXT | DEFAULT NULL | 扩展属性，JSON格式 |
| `reserved1` ~ `reserved10` | VARCHAR(500) | DEFAULT NULL | 预留字段1-10，用于业务扩展 |

---

## 💡 字段命名语义要求

为确保数据库设计的可读性和可维护性，字段命名必须做到语义明确：

### 1. 业务含义明确

字段名称应直接反映其业务含义：

```
✅ 正确：customerPhone、productName、orderCode
❌ 错误：phone、name、code
```

### 2. 避免使用通用词汇

避免使用 `name`、`code`、`type`、`status` 等通用词汇：

```
✅ 正确：productName、orderCode、accountType、paymentStatus
❌ 错误：name、code、type、status
```

### 3. 使用完整词汇

避免使用不直观的缩写：

```
✅ 正确：description、address、quantity
❌ 错误：desc、addr、qty
```

### 4. 复合字段名

由多个词组成的字段名，每个部分都应体现其含义：

```
✅ 正确：deliveryAddressCity、shippingAddressState
❌ 错误：city、state
```

### 5. 字段组一致性

相关字段应使用一致的命名方式：

```
✅ 正确：
  shippingAddressCity
  shippingAddressState
  shippingAddressZipCode

❌ 错误：
  city
  shippingState
  zip
```

---

## ⚙️ 其他规范

### 数据类型选择

| 类型 | 规范 | 说明 |
|------|------|------|
| **字符串** | VARCHAR | 所有字符串字段统一使用 VARCHAR 类型 |
| **大文本** | TEXT | 大文本内容 |
| **数值** | INT | 统一使用 INT 类型，避免使用 TINYINT、SMALLINT、BIGINT |
| **时间** | DATETIME | 统一使用 DATETIME |
| **精确数值** | DECIMAL | 使用 DECIMAL，避免使用 FLOAT/DOUBLE |
| **布尔值/状态** | VARCHAR(1) | 值为 'Y'/'N' |

---

### 索引设计规范

- **主键索引**：每张表必须有主键
- **外键索引**：所有外键字段必须创建索引
- **常用查询字段**：经常作为查询条件的字段应创建索引
- **联合索引**：多字段组合查询应考虑创建联合索引
- **索引命名**：使用 `IDX_表名简写_字段简写` 格式

---

### 外键约束

- 根据实际业务需求决定是否使用外键约束
- 如使用外键，命名为：`FK_表名简写_关联表名简写`
- **一般推荐在应用层实现外键关系，数据库层不强制使用外键约束**

---

### 表注释和字段注释

- **每个表必须有表注释**，描述表的用途
- **每个字段必须有字段注释**，描述字段的含义
- 注释应详细表明业务含义，便于后期维护

---

### 多租户支持

- 所有表必须包含 `tenantId` 字段，用于多租户数据隔离
- 查询时必须加上租户ID条件，确保数据安全隔离
- 建议为 `tenantId` 字段创建索引，提高查询性能
- 租户ID应在应用层统一管理和注入

---

### 预留字段使用规范

- 所有表必须包含 `reserved1` 到 `reserved10` 共10个预留字段
- 预留字段类型统一为 `VARCHAR(500) DEFAULT NULL`
- 预留字段用于业务快速扩展，避免频繁修改表结构
- 使用预留字段时应在注释中说明具体用途

---

## 📄 示例

### 用户账号表 (HUB_USER_ACCOUNT)

```sql
CREATE TABLE `HUB_USER_ACCOUNT` (
  -- 主键和租户
  `userAccountId` VARCHAR(32) NOT NULL COMMENT '用户账号ID，主键',
  `tenantId` VARCHAR(32) NOT NULL COMMENT '租户ID',
  
  -- 业务字段
  `userName` VARCHAR(50) NOT NULL COMMENT '用户名，登录账号',
  `password` VARCHAR(100) NOT NULL COMMENT '密码，加密存储',
  `passwordSalt` VARCHAR(32) NOT NULL COMMENT '密码盐值',
  `nickName` VARCHAR(100) DEFAULT NULL COMMENT '用户昵称',
  `emailAddress` VARCHAR(100) DEFAULT NULL COMMENT '电子邮箱地址',
  `mobilePhone` VARCHAR(20) DEFAULT NULL COMMENT '手机号码',
  `avatarUrl` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `genderType` INT DEFAULT 0 COMMENT '性别类型(0未知，1男，2女)',
  `accountStatus` VARCHAR(1) NOT NULL DEFAULT 'Y' COMMENT '账号状态(N禁用,Y正常)',
  `lastLoginTime` DATETIME DEFAULT NULL COMMENT '最后登录时间',
  `lastLoginIpAddress` VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP地址',
  
  -- 通用字段
  `addTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `addWho` VARCHAR(32) NOT NULL COMMENT '创建人ID',
  `editTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后修改时间',
  `editWho` VARCHAR(32) NOT NULL COMMENT '最后修改人ID',
  `oprSeqFlag` VARCHAR(32) NOT NULL COMMENT '操作序列标识',
  `currentVersion` INT NOT NULL DEFAULT 1 COMMENT '当前版本号',
  `activeFlag` VARCHAR(1) NOT NULL DEFAULT 'Y' COMMENT '活动状态标记(N非活动,Y活动)',
  `noteText` VARCHAR(500) DEFAULT NULL COMMENT '备注信息',
  `extProperty` TEXT DEFAULT NULL COMMENT '扩展属性，JSON格式',
  
  -- 预留字段
  `reserved1` VARCHAR(500) DEFAULT NULL COMMENT '预留字段1',
  `reserved2` VARCHAR(500) DEFAULT NULL COMMENT '预留字段2',
  `reserved3` VARCHAR(500) DEFAULT NULL COMMENT '预留字段3',
  `reserved4` VARCHAR(500) DEFAULT NULL COMMENT '预留字段4',
  `reserved5` VARCHAR(500) DEFAULT NULL COMMENT '预留字段5',
  `reserved6` VARCHAR(500) DEFAULT NULL COMMENT '预留字段6',
  `reserved7` VARCHAR(500) DEFAULT NULL COMMENT '预留字段7',
  `reserved8` VARCHAR(500) DEFAULT NULL COMMENT '预留字段8',
  `reserved9` VARCHAR(500) DEFAULT NULL COMMENT '预留字段9',
  `reserved10` VARCHAR(500) DEFAULT NULL COMMENT '预留字段10',
  
  -- 主键和索引
  PRIMARY KEY (`userAccountId`),
  UNIQUE KEY `IDX_USER_ACCOUNT_USERNAME` (`userName`),
  UNIQUE KEY `IDX_USER_ACCOUNT_EMAIL` (`emailAddress`),
  UNIQUE KEY `IDX_USER_ACCOUNT_MOBILE` (`mobilePhone`),
  KEY `IDX_USER_ACCOUNT_TENANT` (`tenantId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户账号表';
```

---

### 网关实例表 (HUB_GW_INSTANCE)

```sql
CREATE TABLE `HUB_GW_INSTANCE` (
  -- 主键和租户
  `gatewayInstanceId` VARCHAR(32) NOT NULL COMMENT '网关实例ID，主键',
  `tenantId` VARCHAR(32) NOT NULL COMMENT '租户ID',
  
  -- 业务字段
  `instanceName` VARCHAR(100) NOT NULL COMMENT '实例名称',
  `bindAddress` VARCHAR(50) NOT NULL COMMENT '绑定地址',
  `httpPort` INT NOT NULL COMMENT 'HTTP端口',
  `httpsPort` INT DEFAULT NULL COMMENT 'HTTPS端口',
  `instanceStatus` VARCHAR(1) NOT NULL DEFAULT 'Y' COMMENT '实例状态(N停用,Y启用)',
  `logConfigId` VARCHAR(32) DEFAULT NULL COMMENT '日志配置ID',
  
  -- 通用字段
  `addTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `addWho` VARCHAR(32) NOT NULL COMMENT '创建人ID',
  `editTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后修改时间',
  `editWho` VARCHAR(32) NOT NULL COMMENT '最后修改人ID',
  `oprSeqFlag` VARCHAR(32) NOT NULL COMMENT '操作序列标识',
  `currentVersion` INT NOT NULL DEFAULT 1 COMMENT '当前版本号',
  `activeFlag` VARCHAR(1) NOT NULL DEFAULT 'Y' COMMENT '活动状态标记(N非活动,Y活动)',
  `noteText` VARCHAR(500) DEFAULT NULL COMMENT '备注信息',
  `extProperty` TEXT DEFAULT NULL COMMENT '扩展属性，JSON格式',
  
  -- 预留字段
  `reserved1` VARCHAR(500) DEFAULT NULL COMMENT '预留字段1',
  `reserved2` VARCHAR(500) DEFAULT NULL COMMENT '预留字段2',
  `reserved3` VARCHAR(500) DEFAULT NULL COMMENT '预留字段3',
  `reserved4` VARCHAR(500) DEFAULT NULL COMMENT '预留字段4',
  `reserved5` VARCHAR(500) DEFAULT NULL COMMENT '预留字段5',
  `reserved6` VARCHAR(500) DEFAULT NULL COMMENT '预留字段6',
  `reserved7` VARCHAR(500) DEFAULT NULL COMMENT '预留字段7',
  `reserved8` VARCHAR(500) DEFAULT NULL COMMENT '预留字段8',
  `reserved9` VARCHAR(500) DEFAULT NULL COMMENT '预留字段9',
  `reserved10` VARCHAR(500) DEFAULT NULL COMMENT '预留字段10',
  
  -- 主键和索引
  PRIMARY KEY (`gatewayInstanceId`),
  KEY `IDX_GW_INST_TENANT` (`tenantId`),
  KEY `IDX_GW_INST_BIND_HTTP` (`bindAddress`, `httpPort`),
  KEY `IDX_GW_INST_LOG` (`logConfigId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='网关实例表';
```

---

## 📖 下一步

数据库设计规范了解后，建议继续阅读：

- [项目介绍](./01-项目介绍.md) - 了解项目架构和核心能力
- [开发指南](./02-快速开始.md) - 开发环境搭建和配置说明
- [安装部署](./03-安装部署.md) - 详细的安装部署指南

---

## 🤝 获取帮助

如果对数据库设计有疑问，可以通过以下方式获取帮助：

- 📧 邮箱：fluxopensource@flux.com.cn
- 💬 GitHub Issues：[提交问题](https://github.com/fluxsce/gateway/issues)

---

**[返回目录](./README.md) • [上一章：容器化部署](./04-容器化部署.md)**

---

<div align="center">

Made with ❤️ by FLUX Gateway Team

</div>

